
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://abhishekghoshh.github.io/system-design-helper/security/oauth/">
      
      
        <link rel="prev" href="../authentication-and-authorization/">
      
      
        <link rel="next" href="../rbac/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>OAuth - System Design Helper</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  
<meta property="og:type" content="website" />
<meta property="og:title" content="OAuth - System Design Helper" />
<meta property="og:image" content="https://abhishekghoshh.github.io/system-design-helper/assets/images/social/security/oauth.png" />
<meta property="og:image:type" content="image/png" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:url" content="https://abhishekghoshh.github.io/system-design-helper/security/oauth/" />
<meta property="twitter:card" content="summary_large_image" />
<meta property="twitter:title" content="OAuth - System Design Helper" />
<meta property="twitter:image" content="https://abhishekghoshh.github.io/system-design-helper/assets/images/social/security/oauth.png" />
</head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#application-security" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="System Design Helper" class="md-header__button md-logo" aria-label="System Design Helper" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            System Design Helper
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              OAuth
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../ai-tools/" class="md-tabs__link">
        
  
  
    
  
  AI Tools

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../behavioural/" class="md-tabs__link">
        
  
  
    
  
  Behavioural

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../developer-experiences/" class="md-tabs__link">
        
  
  
    
  
  Developer Experiences

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../open-source-tools/" class="md-tabs__link">
        
  
  
    
  
  Open Source Tools

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../software-architect/" class="md-tabs__link">
        
  
  
    
  
  Software Architect

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../wisdom/" class="md-tabs__link">
        
  
  
    
  
  Wisdom

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../ai/ai/" class="md-tabs__link">
          
  
  
  AI

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../devops/" class="md-tabs__link">
          
  
  
  DevOps

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../introduction/" class="md-tabs__link">
          
  
  
  Security

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../system-design/courses/" class="md-tabs__link">
          
  
  
  System Design

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="System Design Helper" class="md-nav__button md-logo" aria-label="System Design Helper" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    System Design Helper
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AI Tools
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../behavioural/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Behavioural
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer-experiences/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Developer Experiences
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../open-source-tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Open Source Tools
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software-architect/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Software Architect
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wisdom/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Wisdom
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    AI
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    AI
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai/ai/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai/ai-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AI Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai/gen-ai/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Gen AI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai/langchain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LangChain
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai/langgraph/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LangGraph
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai/MCP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MCP
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai/RAG/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RAG
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    DevOps
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    DevOps
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" checked>
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Security
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Security
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../authentication-and-authorization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Authentication & Authorization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    OAuth
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    OAuth
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#youtube" class="md-nav__link">
    <span class="md-ellipsis">
      
        Youtube
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#udemy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Udemy
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#theory" class="md-nav__link">
    <span class="md-ellipsis">
      
        Theory
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Theory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-oauth-20" class="md-nav__link">
    <span class="md-ellipsis">
      
        What is OAuth 2.0?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oauth-20-components" class="md-nav__link">
    <span class="md-ellipsis">
      
        OAuth 2.0 Components
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#client-registration-process" class="md-nav__link">
    <span class="md-ellipsis">
      
        Client Registration Process
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Client Registration Process">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-client-registration-is-required" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why Client Registration is Required
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#client-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        Client Types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#registration-process" class="md-nav__link">
    <span class="md-ellipsis">
      
        Registration Process
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#registration-information" class="md-nav__link">
    <span class="md-ellipsis">
      
        Registration Information
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redirect-uri-security" class="md-nav__link">
    <span class="md-ellipsis">
      
        Redirect URI Security
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-registration-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Post-Registration Steps
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#client-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Client Management
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#real-world-examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Real-World Examples
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oauth-20-grant-types-flows" class="md-nav__link">
    <span class="md-ellipsis">
      
        OAuth 2.0 Grant Types (Flows)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OAuth 2.0 Grant Types (Flows)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-authorization-code-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Authorization Code Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-implicit-flow-deprecated" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Implicit Flow (Deprecated)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-resource-owner-password-credentials-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Resource Owner Password Credentials Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-client-credentials-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Client Credentials Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-device-authorization-grant-device-code-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Device Authorization Grant (Device Code Flow)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-refresh-token-grant" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Refresh Token Grant
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oauth-20-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      
        OAuth 2.0 Concepts
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OAuth 2.0 Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jwt-json-web-token" class="md-nav__link">
    <span class="md-ellipsis">
      
        JWT (JSON Web Token)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#token-exchange" class="md-nav__link">
    <span class="md-ellipsis">
      
        Token Exchange
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jwks-json-web-key-set" class="md-nav__link">
    <span class="md-ellipsis">
      
        JWKS (JSON Web Key Set)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pkce-proof-key-for-code-exchange" class="md-nav__link">
    <span class="md-ellipsis">
      
        PKCE (Proof Key for Code Exchange)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PKCE (Proof Key for Code Exchange)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-pkce" class="md-nav__link">
    <span class="md-ellipsis">
      
        What is PKCE?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-is-pkce-needed" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why is PKCE Needed?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-pkce-works" class="md-nav__link">
    <span class="md-ellipsis">
      
        How PKCE Works
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pkce-security-benefits" class="md-nav__link">
    <span class="md-ellipsis">
      
        PKCE Security Benefits
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pkce-vs-standard-oauth-20" class="md-nav__link">
    <span class="md-ellipsis">
      
        PKCE vs Standard OAuth 2.0
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-to-use-pkce" class="md-nav__link">
    <span class="md-ellipsis">
      
        When to Use PKCE
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Example
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complete-python-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Complete Python Implementation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rbac/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RBAC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sso/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SSO
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ssl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SSL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../devsecops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DevSecOps
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../firewall/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Firewall
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_9" >
        
          
          <label class="md-nav__link" for="__nav_10_9" id="__nav_10_9_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Certificate
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Certificate
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certificate/introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certificate/certificate-authority/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Certificate Authority
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certificate/client-certificates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Client Certificates
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certificate/server-certificates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Server Certificates
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certificate/self-signed-certificates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Self-Signed Certificates
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certificate/links/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Links
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_10" >
        
          
          <label class="md-nav__link" for="__nav_10_10" id="__nav_10_10_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Reverse Proxy
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reverse Proxy
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reverse-proxy/introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reverse-proxy/haproxy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HAProxy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reverse-proxy/nginx/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Nginx
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    System Design
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    System Design
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/courses/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Courses
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_2" >
        
          
          <label class="md-nav__link" for="__nav_11_2" id="__nav_11_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    High Level Design
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    High Level Design
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_2_2" >
        
          
          <label class="md-nav__link" for="__nav_11_2_2" id="__nav_11_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Concepts
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_11_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Concepts
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/concepts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Concepts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/adaptive-bitrate-streaming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Adaptive Bitrate Streaming
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/asynchronus-communication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Asynchronous Communication
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/back-of-envelope-calculation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Back of Envelope Calculation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/bloom-filters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bloom Filters
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/cap-theorm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CAP Theorem
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/cdc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CDC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/cdn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CDN
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/clean-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Clean Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/code-documentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Code Documentation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/consistent-hashing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Consistent Hashing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/cqrs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CQRS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/database-indexing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Database Indexing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/distributed-caches-and-caching-strategies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Distributed Caches & Caching Strategies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Distributed Transaction & Concurrency Control
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/event-sourcing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Event Sourcing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/hashing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hashing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/load-balancer-and-proxy-server/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Load Balancer & Proxy Server
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/microservices-patterns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Microservices Patterns
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/networking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Networking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/passwords/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Passwords
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/process/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Process
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/raft-consensus-algorithm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Raft Consensus Algorithm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/restfull-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RESTful Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/s3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    S3
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/scaling-to-one-million/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Scaling to One Million
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/sockets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sockets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Storage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/concepts/webrtc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    WebRTC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_2_3" >
        
          
          <label class="md-nav__link" for="__nav_11_2_3" id="__nav_11_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Designing
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_11_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Designing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/app-store/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    App Store
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/authentication-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Authentication System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/chat-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chat System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/chess-game/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chess Game
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/data-warehouse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Warehouse
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/distributed-geospatial-data-platform/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Distributed Geospatial Data Platform
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/distributed-messaging-queue/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Distributed Messaging Queue
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/dns-server.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DNS Server
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/e-commerce/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    E-Commerce
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/ecommerce-checkout/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    E-Commerce Checkout
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/email-automation-platform/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Email Automation Platform
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/food-delivery/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Food Delivery
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/google-drive/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Google Drive
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/hashtag-service/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hashtag Service
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/how-to-host-your-own-x/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    How to Host Your Own X
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/Image-Optimisation-on-the-fly/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Image Optimisation On The Fly
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/key-value-store/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Key Value Store
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/large-language-model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Large Language Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/leetcode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LeetCode
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/live-comments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Live Comments
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/log-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Log System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/multiplayer-game/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multiplayer Game
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/netflix/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Netflix
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/notification-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Notification System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/products/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Products
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/rate-limiter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rate Limiter
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/recomendation-engine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Recommendation Engine
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/redis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Redis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/search-engine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Search Engine
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/social-media/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Social Media
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/spotify/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Spotify
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/stock-broker-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Stock Broker System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/tiny-url/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tiny URL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/twitter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Twitter
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/uber/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Uber
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/upi-payments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UPI Payments
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/video-streaming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Video Streaming
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/vpn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    VPN
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/webhook/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Webhook
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/desgining/yelp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Yelp
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_2_4" >
        
          
          <label class="md-nav__link" for="__nav_11_2_4" id="__nav_11_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Links
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_11_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_2_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Links
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/links/udemy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Udemy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/links/websites/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Websites
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/high-level/links/youtube/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    YouTube
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_3" >
        
          
          <label class="md-nav__link" for="__nav_11_3" id="__nav_11_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Low Level Design
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Low Level Design
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_3_2" >
        
          
          <label class="md-nav__link" for="__nav_11_3_2" id="__nav_11_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Concepts
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_11_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Concepts
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/concepts/hashmap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HashMap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/concepts/solid-principles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SOLID Principles
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/concepts/technical-debt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Technical Debt
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_3_3" >
        
          
          <label class="md-nav__link" for="__nav_11_3_3" id="__nav_11_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Design Patterns
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_11_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Design Patterns
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/design-pattern/design-pattern/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Design Pattern
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_3_3_2" >
        
          
          <label class="md-nav__link" for="__nav_11_3_3_2" id="__nav_11_3_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Others
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_11_3_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_3_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Others
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/design-pattern/others/null-object-pattern/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Null Object Pattern
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_3_4" >
        
          
          <label class="md-nav__link" for="__nav_11_3_4" id="__nav_11_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Designing
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_11_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Designing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/designing/access-management-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Access Management System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/designing/account-balance-tracker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Account Balance Tracker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/designing/air-traffic-controller/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Air Traffic Controller
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/designing/atm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ATM
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/designing/cache-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cache System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/designing/car-rental-service/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Car Rental Service
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/designing/chess-game/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chess Game
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/designing/elevator-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Elevator System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/designing/locker-allocation-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Locker Allocation System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/designing/parking-lot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Parking Lot
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/designing/snake-and-ladder/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Snake and Ladder
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/designing/stock-exchange-book/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Stock Exchange Book
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/designing/tic-tac-toe/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tic Tac Toe
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-design/low-level/designing/vending-machine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Vending Machine
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="application-security">Application security</h1>
<h2 id="youtube">Youtube</h2>
<ul>
<li>
<p><a href="https://www.youtube.com/watch?v=3Gx3e3eLKrg">OAuth 2.0: Explained with API Request and Response Sample | High Level System Design</a></p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=QzntvHz23tw">Token vs Session Authentication | Authentication Explained!!!</a></p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=hpryVn8LT4E">OAuth2 Can Be Hacked Without PKCE | PKCE Explained</a></p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=-VwWitk4_s4">99% of Developers Don't Get OAuth</a></p>
</li>
</ul>
<h2 id="udemy">Udemy</h2>
<ul>
<li><a href="https://www.udemy.com/course/oauth-2-simplified/">The Nuts and Bolts of OAuth 2.0</a></li>
<li><a href="https://www.udemy.com/course/advanced-oauth-security/">Advanced OAuth Security</a></li>
<li><a href="https://www.udemy.com/course/enterprise-oauth-for-developers/">Enterprise OAuth 2.0 and OpenID Connect</a></li>
</ul>
<h2 id="theory">Theory</h2>
<h3 id="what-is-oauth-20">What is OAuth 2.0?</h3>
<p>OAuth 2.0 is an <strong>authorization framework</strong> that enables third-party applications to obtain limited access to a user's resources on another service without exposing the user's credentials. It's the industry-standard protocol for authorization.</p>
<p><strong>Key Characteristics:</strong>
- <strong>Authorization, not Authentication</strong>: OAuth 2.0 is designed for authorization (granting access to resources), not authentication (verifying identity)
- <strong>Delegated Access</strong>: Allows users to grant applications access to their data on other services
- <strong>Token-based</strong>: Uses access tokens instead of sharing passwords
- <strong>Scopes</strong>: Defines granular permissions for what the application can access</p>
<h3 id="oauth-20-components">OAuth 2.0 Components</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>                     OAuth 2.0 Architecture                   
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>  Resource Owner    (End User)
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>   (User)           - Owns the protected resources
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>  - Grants access to client application
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>         
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>          (1) Authorization Request
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>         
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>         
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>         (2) Authorization Grant         
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>     Client        Authorization    
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>  (Application)                                                  Server       
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>                                    
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>         (3) Access Token                
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>                                                              - Authenticates user
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>                                                              - Issues tokens
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>                                                              - Validates scopes
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>         
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>          (4) Access Token
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>         
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>         
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>   Resource       
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>    Server        
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>   (API Server)   
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>- Hosts protected resources
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>- Validates access tokens
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>- Serves protected data
</code></pre></div>
<p><strong>Components Explained:</strong></p>
<ol>
<li><strong>Resource Owner (User)</strong></li>
<li>The entity that owns the protected resources</li>
<li>Typically an end-user who can grant access to their data</li>
<li>
<p>Example: A user with photos on Google Photos</p>
</li>
<li>
<p><strong>Client (Application)</strong></p>
</li>
<li>The application requesting access to protected resources</li>
<li>Must be registered with the authorization server</li>
<li>Has a client ID and optionally a client secret</li>
<li>Types: Public clients (mobile/SPA) and Confidential clients (server-side)</li>
<li>
<p>Example: A photo printing service requesting access to Google Photos</p>
</li>
<li>
<p><strong>Authorization Server</strong></p>
</li>
<li>Issues access tokens after authenticating the resource owner</li>
<li>Validates client credentials</li>
<li>Manages consent and scopes</li>
<li>
<p>Example: Google's OAuth 2.0 server, Auth0, Okta</p>
</li>
<li>
<p><strong>Resource Server (API Server)</strong></p>
</li>
<li>Hosts the protected resources</li>
<li>Validates access tokens before serving requests</li>
<li>Often the same as the authorization server in simple setups</li>
<li>Example: Google Photos API</li>
</ol>
<h3 id="client-registration-process">Client Registration Process</h3>
<p>Before a client application can use OAuth 2.0, it must be registered with the <strong>Authorization Server</strong>. This registration process establishes trust and provides the client with credentials needed for authentication.</p>
<h4 id="why-client-registration-is-required">Why Client Registration is Required</h4>
<ul>
<li><strong>Identify the Application</strong>: Each client gets a unique identifier (<code>client_id</code>)</li>
<li><strong>Security</strong>: Confidential clients receive a <code>client_secret</code> for authentication</li>
<li><strong>Validate Redirects</strong>: Authorization server maintains allowed redirect URIs to prevent attacks</li>
<li><strong>Configure Permissions</strong>: Define what scopes/permissions the client can request</li>
<li><strong>Track Usage</strong>: Monitor and audit client application activity</li>
</ul>
<h4 id="client-types">Client Types</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>                     Client Types                             
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>1. CONFIDENTIAL CLIENTS
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    Can securely store credentials
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>    Have both client_id AND client_secret
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>    Run on secure servers
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>    Examples:
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>       Server-side web applications (Node.js, Django, Spring)
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>       Backend services
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>       Microservices
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>2. PUBLIC CLIENTS
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>    Cannot securely store secrets
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>    Have only client_id (NO client_secret)
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>    Code is accessible to users
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>    Examples:
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>       Single Page Applications (React, Vue, Angular)
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>       Mobile apps (iOS, Android)
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>       Desktop applications
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>       Browser-based apps
</code></pre></div>
<h4 id="registration-process">Registration Process</h4>
<p><strong>Manual Registration (Most Common)</strong>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>                                  
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>   Developer                                          Authorization   
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>                                                         Server       
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>                                                      (e.g., Google,  
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>                                                       Auth0, Okta)   
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>                                  
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>                                                              
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>      (1) Navigate to Developer Console/Portal               
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>          (e.g., console.cloud.google.com)                   
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>                                                              
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>      (2) Fill Registration Form:                            
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>          - Application Name                                 
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>          - Application Type (Web, SPA, Mobile, etc.)        
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>          - Redirect URIs                                    
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>          - Allowed Scopes                                   
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>          - Application Logo &amp; Description                   
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>       
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>                                                              
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>                                                               (3) Validate Input
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>                                                                   - Check redirect URIs
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>                                                                   - Verify application details
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>                                                              
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a>      (4) Return Client Credentials:                         
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>                   
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>           client_id: abc123xyz456                         
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>           client_secret: secret_abc123 (if conf.)|         
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a>           redirect_uris: [...]                            
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a>           allowed_scopes: [...]                           
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a>                   
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a>      
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a>                                                              
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a>      (5) Store credentials securely                         
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a>                                                              
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a>                                                              
</code></pre></div>
<p><strong>Dynamic Client Registration (RFC 7591)</strong>:</p>
<p>For automated registration via API:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>                                  
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>   Client App                                         Authorization   
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>                                                         Server       
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>                                  
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>                                                              
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>      POST /register                                         
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>      Content-Type: application/json                         
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>                                                              
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>      {                                                       
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>        &quot;redirect_uris&quot;: [                                   
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>          &quot;https://client.example.com/callback&quot;              
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>        ],                                                    
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>        &quot;client_name&quot;: &quot;My Application&quot;,                     
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>        &quot;token_endpoint_auth_method&quot;: &quot;client_secret_basic&quot;, 
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>        &quot;grant_types&quot;: [&quot;authorization_code&quot;, &quot;refresh&quot;],    
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>        &quot;response_types&quot;: [&quot;code&quot;],                          
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>        &quot;scope&quot;: &quot;read write&quot;                                
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>      }                                                       
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>       
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a>                                                              
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>                                                               Validate &amp; Create
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>                                                              
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a>      Response:                                              
<a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a>      {                                                       
<a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a>        &quot;client_id&quot;: &quot;s6BhdRkqt3&quot;,                           
<a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a>        &quot;client_secret&quot;: &quot;ZJYCqe3GGRvdrudKyZS0XhGv...&quot;,      
<a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a>        &quot;client_id_issued_at&quot;: 1234567890,                   
<a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a>        &quot;client_secret_expires_at&quot;: 1234657890,              
<a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a>        &quot;redirect_uris&quot;: [...],                              
<a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a>        &quot;grant_types&quot;: [...],                                
<a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a>        &quot;response_types&quot;: [...]                              
<a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a>      }                                                       
<a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a>      
<a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a>                                                              
<a id="__codelineno-3-35" name="__codelineno-3-35" href="#__codelineno-3-35"></a>                                                              
</code></pre></div>
<h4 id="registration-information">Registration Information</h4>
<p><strong>Required Information</strong>:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>client_id</strong></td>
<td>Unique identifier for the client</td>
<td><code>abc123xyz456</code></td>
</tr>
<tr>
<td><strong>client_secret</strong></td>
<td>Secret key (confidential clients only)</td>
<td><code>secret_abc123...</code></td>
</tr>
<tr>
<td><strong>redirect_uris</strong></td>
<td>Allowed callback URLs after authorization</td>
<td><code>["https://app.com/callback"]</code></td>
</tr>
<tr>
<td><strong>application_name</strong></td>
<td>Human-readable name</td>
<td>"My Photo App"</td>
</tr>
<tr>
<td><strong>application_type</strong></td>
<td>Type of client</td>
<td><code>web</code>, <code>native</code>, <code>spa</code></td>
</tr>
<tr>
<td><strong>grant_types</strong></td>
<td>Allowed OAuth flows</td>
<td><code>["authorization_code", "refresh_token"]</code></td>
</tr>
<tr>
<td><strong>response_types</strong></td>
<td>Allowed response types</td>
<td><code>["code"]</code></td>
</tr>
<tr>
<td><strong>scopes</strong></td>
<td>Permissions the client can request</td>
<td><code>["read:user", "write:user"]</code></td>
</tr>
</tbody>
</table>
<p><strong>Optional Information</strong>:
- <strong>logo_uri</strong>: URL to application logo
- <strong>tos_uri</strong>: Terms of service URL
- <strong>policy_uri</strong>: Privacy policy URL
- <strong>contacts</strong>: Developer contact emails
- <strong>jwks_uri</strong>: JSON Web Key Set URL for token validation</p>
<h4 id="redirect-uri-security">Redirect URI Security</h4>
<p><strong>Critical Security Requirement</strong>: Redirect URIs must be explicitly registered to prevent authorization code interception.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>Valid Redirect URIs:
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a> https://app.example.com/callback
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a> https://app.example.com/oauth/callback
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a> myapp://callback (mobile app custom scheme)
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a> http://localhost:3000/callback (development only)
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>Invalid/Risky Patterns:
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a> https://app.example.com/* (wildcard not allowed)
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a> http://app.example.com/callback (HTTP in production)
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a> https://evil.com/callback (not registered)
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a> https://app.example.com/callback?param=value (query params)
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>Attack Prevention:
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>If attacker tries: https://evil.com/steal
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a> Authorization server checks registered URIs
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a> Redirect URI doesn&#39;t match
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a> Request REJECTED
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a> Attack prevented!
</code></pre></div>
<h4 id="post-registration-steps">Post-Registration Steps</h4>
<ol>
<li>
<p><strong>Secure Storage</strong>:
   <div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>Confidential Clients (Server-side):
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>- Store client_secret in environment variables
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>- Use secret management services (AWS Secrets Manager, HashiCorp Vault)
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>- Never commit to version control
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>Public Clients:
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>- Only client_id needed
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>- Can be in client-side code
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>- Use PKCE for additional security
</code></pre></div></p>
</li>
<li>
<p><strong>Configure Application</strong>:
   <div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1">// Server-side (Confidential)</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">oauth2Config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">  </span><span class="nx">client_id</span><span class="o">:</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">OAUTH_CLIENT_ID</span><span class="p">,</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">  </span><span class="nx">client_secret</span><span class="o">:</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">OAUTH_CLIENT_SECRET</span><span class="p">,</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">  </span><span class="nx">redirect_uri</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;https://yourapp.com/callback&#39;</span><span class="p">,</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">  </span><span class="nx">authorization_endpoint</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;https://auth-server.com/oauth/authorize&#39;</span><span class="p">,</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">  </span><span class="nx">token_endpoint</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;https://auth-server.com/oauth/token&#39;</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="p">};</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="c1">// Client-side (Public)</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="kd">const</span><span class="w"> </span><span class="nx">oauth2Config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="w">  </span><span class="nx">client_id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;abc123xyz456&#39;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Public, can be in code</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="w">  </span><span class="nx">redirect_uri</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;https://yourapp.com/callback&#39;</span><span class="p">,</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="w">  </span><span class="nx">authorization_endpoint</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;https://auth-server.com/oauth/authorize&#39;</span><span class="p">,</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="w">  </span><span class="nx">token_endpoint</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;https://auth-server.com/oauth/token&#39;</span><span class="p">,</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="w">  </span><span class="nx">usePKCE</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="c1">// Always use PKCE for public clients</span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="p">};</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Test the Integration</strong>:</p>
</li>
<li>Use development/sandbox environment first</li>
<li>Verify redirect URIs work correctly</li>
<li>Test token exchange process</li>
<li>Validate scope permissions</li>
</ol>
<h4 id="client-management">Client Management</h4>
<p><strong>Update Client Configuration</strong>:
- Modify redirect URIs
- Update scopes
- Rotate client secrets (confidential clients)
- Change application metadata</p>
<p><strong>Revoke/Delete Client</strong>:
- Immediately invalidates all tokens
- Remove client from authorization server
- Users must re-authorize if client is re-registered</p>
<p><strong>Monitor Client Activity</strong>:
- Track token issuance rates
- Monitor failed authentication attempts
- Audit scope usage
- Detect suspicious patterns</p>
<h4 id="real-world-examples">Real-World Examples</h4>
<p><strong>Google OAuth Registration</strong>:
1. Go to Google Cloud Console
2. Create a new project
3. Enable OAuth 2.0 APIs
4. Configure OAuth consent screen
5. Create credentials (OAuth 2.0 Client ID)
6. Specify application type and redirect URIs
7. Receive <code>client_id</code> and <code>client_secret</code></p>
<p><strong>GitHub OAuth Registration</strong>:
1. Go to Settings  Developer settings  OAuth Apps
2. Click "New OAuth App"
3. Fill in application details and callback URL
4. Receive <code>client_id</code> and <code>client_secret</code></p>
<p><strong>Auth0 Registration</strong>:
1. Create an Auth0 account
2. Create a new application
3. Choose application type (SPA, Web, Native)
4. Configure allowed callback URLs
5. Receive <code>client_id</code> and <code>client_secret</code></p>
<h3 id="oauth-20-grant-types-flows">OAuth 2.0 Grant Types (Flows)</h3>
<h4 id="1-authorization-code-flow">1. Authorization Code Flow</h4>
<p><strong>Best for</strong>: Server-side web applications (confidential clients)</p>
<p><strong>Description</strong>: The most secure and commonly used flow. The client receives an authorization code which is then exchanged for an access token.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>                                          
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>  User                                                Authorization   
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a> (Browser)                                               Server       
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>                                          
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>                                                              
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>      (1) User clicks &quot;Login with Google&quot;                    
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>       
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>                                                              
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>      (2) Redirect to Authorization Server                   
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>         with client_id, redirect_uri, scope, state          
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>                                                              
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>      (3) User authenticates &amp; grants permission             
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>      
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>                                                              
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>      (4) Redirect to Client with authorization code         
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>                                                              
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>                                                              
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>                                          
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>   Client                                                   
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>  (Backend)                                                 
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>                                          
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>                                                              
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a>      (5) Exchange code for access token                     
<a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a>         POST with code, client_id, client_secret            
<a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a>       
<a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a>                                                              
<a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a>      (6) Return access_token &amp; refresh_token                
<a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a>      
<a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a>                                                              
<a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a>      (7) Use access token to call API                       
<a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a>                                                              
<a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a>                                                              
<a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a>
<a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a>   Resource       
<a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a>    Server        
<a id="__codelineno-7-36" name="__codelineno-7-36" href="#__codelineno-7-36"></a>
</code></pre></div>
<p><strong>Flow Steps:</strong>
1. User initiates login
2. Client redirects to authorization server with parameters
3. User authenticates and grants permission
4. Authorization server redirects back with authorization code
5. Client exchanges code for access token (server-to-server)
6. Authorization server returns access token and refresh token
7. Client uses access token to access protected resources</p>
<p><strong>Parameters:</strong>
- <code>response_type=code</code>
- <code>client_id</code>: Your application's identifier
- <code>redirect_uri</code>: Where to redirect after authorization
- <code>scope</code>: Requested permissions
- <code>state</code>: CSRF protection token</p>
<p><strong>Python Implementation Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">secrets</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlencode</span><span class="p">,</span> <span class="n">urlparse</span><span class="p">,</span> <span class="n">parse_qs</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">session</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="s1">&#39;your-secret-key&#39;</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="c1"># OAuth 2.0 Configuration</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="n">CLIENT_ID</span> <span class="o">=</span> <span class="s1">&#39;your_client_id&#39;</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="n">CLIENT_SECRET</span> <span class="o">=</span> <span class="s1">&#39;your_client_secret&#39;</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="n">AUTHORIZATION_URL</span> <span class="o">=</span> <span class="s1">&#39;https://auth-server.com/oauth/authorize&#39;</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="n">TOKEN_URL</span> <span class="o">=</span> <span class="s1">&#39;https://auth-server.com/oauth/token&#39;</span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="n">REDIRECT_URI</span> <span class="o">=</span> <span class="s1">&#39;http://localhost:5000/callback&#39;</span>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="n">SCOPE</span> <span class="o">=</span> <span class="s1">&#39;read:user write:user&#39;</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">)</span>
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="k">def</span><span class="w"> </span><span class="nf">login</span><span class="p">():</span>
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Step 1: Redirect user to authorization server&quot;&quot;&quot;</span>
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>    <span class="c1"># Generate state for CSRF protection</span>
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>    <span class="n">state</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_urlsafe</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>    <span class="n">session</span><span class="p">[</span><span class="s1">&#39;oauth_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span>
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a>    <span class="c1"># Build authorization URL</span>
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a>    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a>        <span class="s1">&#39;response_type&#39;</span><span class="p">:</span> <span class="s1">&#39;code&#39;</span><span class="p">,</span>
<a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a>        <span class="s1">&#39;client_id&#39;</span><span class="p">:</span> <span class="n">CLIENT_ID</span><span class="p">,</span>
<a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a>        <span class="s1">&#39;redirect_uri&#39;</span><span class="p">:</span> <span class="n">REDIRECT_URI</span><span class="p">,</span>
<a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a>        <span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="n">SCOPE</span><span class="p">,</span>
<a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a>        <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="n">state</span>
<a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a>    <span class="p">}</span>
<a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a>
<a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a>    <span class="n">authorization_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">AUTHORIZATION_URL</span><span class="si">}</span><span class="s2">?</span><span class="si">{</span><span class="n">urlencode</span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a>    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">authorization_url</span><span class="p">)</span>
<a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a>
<a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/callback&#39;</span><span class="p">)</span>
<a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a><span class="k">def</span><span class="w"> </span><span class="nf">callback</span><span class="p">():</span>
<a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Step 2: Handle callback and exchange code for token&quot;&quot;&quot;</span>
<a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a>    <span class="c1"># Verify state to prevent CSRF</span>
<a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a>    <span class="n">state</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">)</span>
<a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a>    <span class="k">if</span> <span class="n">state</span> <span class="o">!=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;oauth_state&#39;</span><span class="p">):</span>
<a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a>        <span class="k">return</span> <span class="s1">&#39;Invalid state parameter&#39;</span><span class="p">,</span> <span class="mi">400</span>
<a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a>
<a id="__codelineno-8-44" name="__codelineno-8-44" href="#__codelineno-8-44"></a>    <span class="c1"># Get authorization code</span>
<a id="__codelineno-8-45" name="__codelineno-8-45" href="#__codelineno-8-45"></a>    <span class="n">code</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;code&#39;</span><span class="p">)</span>
<a id="__codelineno-8-46" name="__codelineno-8-46" href="#__codelineno-8-46"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">code</span><span class="p">:</span>
<a id="__codelineno-8-47" name="__codelineno-8-47" href="#__codelineno-8-47"></a>        <span class="n">error</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown error&#39;</span><span class="p">)</span>
<a id="__codelineno-8-48" name="__codelineno-8-48" href="#__codelineno-8-48"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;Authorization failed: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="mi">400</span>
<a id="__codelineno-8-49" name="__codelineno-8-49" href="#__codelineno-8-49"></a>
<a id="__codelineno-8-50" name="__codelineno-8-50" href="#__codelineno-8-50"></a>    <span class="c1"># Exchange code for access token</span>
<a id="__codelineno-8-51" name="__codelineno-8-51" href="#__codelineno-8-51"></a>    <span class="n">token_data</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-8-52" name="__codelineno-8-52" href="#__codelineno-8-52"></a>        <span class="s1">&#39;grant_type&#39;</span><span class="p">:</span> <span class="s1">&#39;authorization_code&#39;</span><span class="p">,</span>
<a id="__codelineno-8-53" name="__codelineno-8-53" href="#__codelineno-8-53"></a>        <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="n">code</span><span class="p">,</span>
<a id="__codelineno-8-54" name="__codelineno-8-54" href="#__codelineno-8-54"></a>        <span class="s1">&#39;redirect_uri&#39;</span><span class="p">:</span> <span class="n">REDIRECT_URI</span><span class="p">,</span>
<a id="__codelineno-8-55" name="__codelineno-8-55" href="#__codelineno-8-55"></a>        <span class="s1">&#39;client_id&#39;</span><span class="p">:</span> <span class="n">CLIENT_ID</span><span class="p">,</span>
<a id="__codelineno-8-56" name="__codelineno-8-56" href="#__codelineno-8-56"></a>        <span class="s1">&#39;client_secret&#39;</span><span class="p">:</span> <span class="n">CLIENT_SECRET</span>
<a id="__codelineno-8-57" name="__codelineno-8-57" href="#__codelineno-8-57"></a>    <span class="p">}</span>
<a id="__codelineno-8-58" name="__codelineno-8-58" href="#__codelineno-8-58"></a>
<a id="__codelineno-8-59" name="__codelineno-8-59" href="#__codelineno-8-59"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">TOKEN_URL</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">token_data</span><span class="p">)</span>
<a id="__codelineno-8-60" name="__codelineno-8-60" href="#__codelineno-8-60"></a>
<a id="__codelineno-8-61" name="__codelineno-8-61" href="#__codelineno-8-61"></a>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
<a id="__codelineno-8-62" name="__codelineno-8-62" href="#__codelineno-8-62"></a>        <span class="n">tokens</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<a id="__codelineno-8-63" name="__codelineno-8-63" href="#__codelineno-8-63"></a>        <span class="n">access_token</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="s1">&#39;access_token&#39;</span><span class="p">]</span>
<a id="__codelineno-8-64" name="__codelineno-8-64" href="#__codelineno-8-64"></a>        <span class="n">refresh_token</span> <span class="o">=</span> <span class="n">tokens</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;refresh_token&#39;</span><span class="p">)</span>
<a id="__codelineno-8-65" name="__codelineno-8-65" href="#__codelineno-8-65"></a>
<a id="__codelineno-8-66" name="__codelineno-8-66" href="#__codelineno-8-66"></a>        <span class="c1"># Store tokens securely (use encrypted session/database in production)</span>
<a id="__codelineno-8-67" name="__codelineno-8-67" href="#__codelineno-8-67"></a>        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;access_token&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">access_token</span>
<a id="__codelineno-8-68" name="__codelineno-8-68" href="#__codelineno-8-68"></a>        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;refresh_token&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">refresh_token</span>
<a id="__codelineno-8-69" name="__codelineno-8-69" href="#__codelineno-8-69"></a>
<a id="__codelineno-8-70" name="__codelineno-8-70" href="#__codelineno-8-70"></a>        <span class="k">return</span> <span class="s1">&#39;Login successful! Access token obtained.&#39;</span>
<a id="__codelineno-8-71" name="__codelineno-8-71" href="#__codelineno-8-71"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-8-72" name="__codelineno-8-72" href="#__codelineno-8-72"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;Token exchange failed: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="mi">400</span>
<a id="__codelineno-8-73" name="__codelineno-8-73" href="#__codelineno-8-73"></a>
<a id="__codelineno-8-74" name="__codelineno-8-74" href="#__codelineno-8-74"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/user&#39;</span><span class="p">)</span>
<a id="__codelineno-8-75" name="__codelineno-8-75" href="#__codelineno-8-75"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_user</span><span class="p">():</span>
<a id="__codelineno-8-76" name="__codelineno-8-76" href="#__codelineno-8-76"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Step 3: Use access token to call protected API&quot;&quot;&quot;</span>
<a id="__codelineno-8-77" name="__codelineno-8-77" href="#__codelineno-8-77"></a>    <span class="n">access_token</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;access_token&#39;</span><span class="p">)</span>
<a id="__codelineno-8-78" name="__codelineno-8-78" href="#__codelineno-8-78"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">access_token</span><span class="p">:</span>
<a id="__codelineno-8-79" name="__codelineno-8-79" href="#__codelineno-8-79"></a>        <span class="k">return</span> <span class="s1">&#39;Not authenticated&#39;</span><span class="p">,</span> <span class="mi">401</span>
<a id="__codelineno-8-80" name="__codelineno-8-80" href="#__codelineno-8-80"></a>
<a id="__codelineno-8-81" name="__codelineno-8-81" href="#__codelineno-8-81"></a>    <span class="c1"># Call protected API with access token</span>
<a id="__codelineno-8-82" name="__codelineno-8-82" href="#__codelineno-8-82"></a>    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Bearer </span><span class="si">{</span><span class="n">access_token</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">}</span>
<a id="__codelineno-8-83" name="__codelineno-8-83" href="#__codelineno-8-83"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://api-server.com/user&#39;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<a id="__codelineno-8-84" name="__codelineno-8-84" href="#__codelineno-8-84"></a>
<a id="__codelineno-8-85" name="__codelineno-8-85" href="#__codelineno-8-85"></a>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
<a id="__codelineno-8-86" name="__codelineno-8-86" href="#__codelineno-8-86"></a>        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<a id="__codelineno-8-87" name="__codelineno-8-87" href="#__codelineno-8-87"></a>    <span class="k">elif</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
<a id="__codelineno-8-88" name="__codelineno-8-88" href="#__codelineno-8-88"></a>        <span class="c1"># Token expired, need to refresh</span>
<a id="__codelineno-8-89" name="__codelineno-8-89" href="#__codelineno-8-89"></a>        <span class="k">return</span> <span class="s1">&#39;Token expired&#39;</span><span class="p">,</span> <span class="mi">401</span>
<a id="__codelineno-8-90" name="__codelineno-8-90" href="#__codelineno-8-90"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-8-91" name="__codelineno-8-91" href="#__codelineno-8-91"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;API call failed: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>
<a id="__codelineno-8-92" name="__codelineno-8-92" href="#__codelineno-8-92"></a>
<a id="__codelineno-8-93" name="__codelineno-8-93" href="#__codelineno-8-93"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-8-94" name="__codelineno-8-94" href="#__codelineno-8-94"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>
</code></pre></div>
<h4 id="2-implicit-flow-deprecated">2. Implicit Flow (Deprecated)</h4>
<p><strong>Best for</strong>: Previously used for SPAs (now deprecated in favor of Authorization Code + PKCE)</p>
<p><strong>Description</strong>: Access token is returned directly in the URL fragment without an intermediate authorization code.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>                                          
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>  User                                                Authorization   
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a> (Browser)                                               Server       
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>                                          
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>                                                              
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>      (1) Redirect to Authorization Server                   
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>         with response_type=token                            
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>       
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>                                                              
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>      (2) User authenticates &amp; grants permission             
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>                                                              
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>      (3) Redirect with access token in URL fragment         
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>         http://client.com/callback#access_token=xyz         
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>      
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>                                                              
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>                                                              
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>  DEPRECATED: Not recommended due to security concerns
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>    - Tokens exposed in browser history
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>    - No refresh tokens
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a>    - Use Authorization Code + PKCE instead
</code></pre></div>
<h4 id="3-resource-owner-password-credentials-flow">3. Resource Owner Password Credentials Flow</h4>
<p><strong>Best for</strong>: Trusted first-party applications only (not recommended for third-party apps)</p>
<p><strong>Description</strong>: User provides credentials directly to the client application, which exchanges them for an access token.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>  User    
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>     
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>      (1) User enters username &amp; password directly in app
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>     
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>     
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>                                  
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>     Client                                           Authorization   
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>  (Application)                                          Server       
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>                                  
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>                                                              
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>      (2) POST request with:                                 
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>          - grant_type=password                              
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>          - username                                         
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>          - password                                         
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>          - client_id &amp; client_secret                        
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>       
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>                                                              
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a>      (3) Validate credentials                               
<a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a>                                                              
<a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a>      (4) Return access_token &amp; refresh_token                
<a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a>      
<a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a>                                                              
<a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a>                                                              
<a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a>
<a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a>  USE WITH CAUTION:
<a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a>    - Only for highly trusted applications (own company apps)
<a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a>    - User credentials exposed to client
<a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a>    - No OAuth benefits for third-party apps
</code></pre></div>
<p><strong>When to use:</strong>
- Mobile apps for your own service
- Migration from legacy authentication systems
- Testing and development</p>
<p><strong>Python Implementation Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">PasswordGrantClient</span><span class="p">:</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">client_secret</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">token_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span> <span class="o">=</span> <span class="n">client_id</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client_secret</span> <span class="o">=</span> <span class="n">client_secret</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">token_url</span> <span class="o">=</span> <span class="n">token_url</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">access_token</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_token</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">scope</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Authenticate using username and password&quot;&quot;&quot;</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>        <span class="n">token_data</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>            <span class="s1">&#39;grant_type&#39;</span><span class="p">:</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>            <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="n">password</span><span class="p">,</span>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>            <span class="s1">&#39;client_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span><span class="p">,</span>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>            <span class="s1">&#39;client_secret&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_secret</span><span class="p">,</span>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>            <span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="n">scope</span>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>        <span class="p">}</span>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a>
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">token_data</span><span class="p">)</span>
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a>
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a>        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a>            <span class="n">tokens</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">access_token</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="s1">&#39;access_token&#39;</span><span class="p">]</span>
<a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_token</span> <span class="o">=</span> <span class="n">tokens</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;refresh_token&#39;</span><span class="p">)</span>
<a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a>            <span class="k">return</span> <span class="n">tokens</span>
<a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Authentication failed: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a>
<a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">call_api</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make authenticated API request&quot;&quot;&quot;</span>
<a id="__codelineno-11-35" name="__codelineno-11-35" href="#__codelineno-11-35"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_token</span><span class="p">:</span>
<a id="__codelineno-11-36" name="__codelineno-11-36" href="#__codelineno-11-36"></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Not authenticated&#39;</span><span class="p">)</span>
<a id="__codelineno-11-37" name="__codelineno-11-37" href="#__codelineno-11-37"></a>
<a id="__codelineno-11-38" name="__codelineno-11-38" href="#__codelineno-11-38"></a>        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Bearer </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">access_token</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">}</span>
<a id="__codelineno-11-39" name="__codelineno-11-39" href="#__codelineno-11-39"></a>
<a id="__codelineno-11-40" name="__codelineno-11-40" href="#__codelineno-11-40"></a>        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>
<a id="__codelineno-11-41" name="__codelineno-11-41" href="#__codelineno-11-41"></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<a id="__codelineno-11-42" name="__codelineno-11-42" href="#__codelineno-11-42"></a>        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
<a id="__codelineno-11-43" name="__codelineno-11-43" href="#__codelineno-11-43"></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-11-44" name="__codelineno-11-44" href="#__codelineno-11-44"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-11-45" name="__codelineno-11-45" href="#__codelineno-11-45"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unsupported method: </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-11-46" name="__codelineno-11-46" href="#__codelineno-11-46"></a>
<a id="__codelineno-11-47" name="__codelineno-11-47" href="#__codelineno-11-47"></a>        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
<a id="__codelineno-11-48" name="__codelineno-11-48" href="#__codelineno-11-48"></a>        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<a id="__codelineno-11-49" name="__codelineno-11-49" href="#__codelineno-11-49"></a>
<a id="__codelineno-11-50" name="__codelineno-11-50" href="#__codelineno-11-50"></a><span class="c1"># Usage Example</span>
<a id="__codelineno-11-51" name="__codelineno-11-51" href="#__codelineno-11-51"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-11-52" name="__codelineno-11-52" href="#__codelineno-11-52"></a>    <span class="n">client</span> <span class="o">=</span> <span class="n">PasswordGrantClient</span><span class="p">(</span>
<a id="__codelineno-11-53" name="__codelineno-11-53" href="#__codelineno-11-53"></a>        <span class="n">client_id</span><span class="o">=</span><span class="s1">&#39;your_client_id&#39;</span><span class="p">,</span>
<a id="__codelineno-11-54" name="__codelineno-11-54" href="#__codelineno-11-54"></a>        <span class="n">client_secret</span><span class="o">=</span><span class="s1">&#39;your_client_secret&#39;</span><span class="p">,</span>
<a id="__codelineno-11-55" name="__codelineno-11-55" href="#__codelineno-11-55"></a>        <span class="n">token_url</span><span class="o">=</span><span class="s1">&#39;https://auth-server.com/oauth/token&#39;</span>
<a id="__codelineno-11-56" name="__codelineno-11-56" href="#__codelineno-11-56"></a>    <span class="p">)</span>
<a id="__codelineno-11-57" name="__codelineno-11-57" href="#__codelineno-11-57"></a>
<a id="__codelineno-11-58" name="__codelineno-11-58" href="#__codelineno-11-58"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-11-59" name="__codelineno-11-59" href="#__codelineno-11-59"></a>        <span class="c1"># Authenticate</span>
<a id="__codelineno-11-60" name="__codelineno-11-60" href="#__codelineno-11-60"></a>        <span class="n">tokens</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span>
<a id="__codelineno-11-61" name="__codelineno-11-61" href="#__codelineno-11-61"></a>            <span class="n">username</span><span class="o">=</span><span class="s1">&#39;user@example.com&#39;</span><span class="p">,</span>
<a id="__codelineno-11-62" name="__codelineno-11-62" href="#__codelineno-11-62"></a>            <span class="n">password</span><span class="o">=</span><span class="s1">&#39;user_password&#39;</span><span class="p">,</span>
<a id="__codelineno-11-63" name="__codelineno-11-63" href="#__codelineno-11-63"></a>            <span class="n">scope</span><span class="o">=</span><span class="s1">&#39;read write&#39;</span>
<a id="__codelineno-11-64" name="__codelineno-11-64" href="#__codelineno-11-64"></a>        <span class="p">)</span>
<a id="__codelineno-11-65" name="__codelineno-11-65" href="#__codelineno-11-65"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Access Token: </span><span class="si">{</span><span class="n">tokens</span><span class="p">[</span><span class="s1">&#39;access_token&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-11-66" name="__codelineno-11-66" href="#__codelineno-11-66"></a>
<a id="__codelineno-11-67" name="__codelineno-11-67" href="#__codelineno-11-67"></a>        <span class="c1"># Call protected API</span>
<a id="__codelineno-11-68" name="__codelineno-11-68" href="#__codelineno-11-68"></a>        <span class="n">user_data</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">call_api</span><span class="p">(</span><span class="s1">&#39;https://api-server.com/user&#39;</span><span class="p">)</span>
<a id="__codelineno-11-69" name="__codelineno-11-69" href="#__codelineno-11-69"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User Data: </span><span class="si">{</span><span class="n">user_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-11-70" name="__codelineno-11-70" href="#__codelineno-11-70"></a>
<a id="__codelineno-11-71" name="__codelineno-11-71" href="#__codelineno-11-71"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-11-72" name="__codelineno-11-72" href="#__codelineno-11-72"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h4 id="4-client-credentials-flow">4. Client Credentials Flow</h4>
<p><strong>Best for</strong>: Server-to-server (machine-to-machine) authentication</p>
<p><strong>Description</strong>: Client authenticates using its own credentials, no user involvement.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>                                  
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>     Client                                           Authorization   
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>  (Application/                                          Server       
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>   Service)                                                           
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>                                  
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>                                                              
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>      (1) POST request with:                                 
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>          - grant_type=client_credentials                    
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>          - client_id                                        
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>          - client_secret                                    
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>          - scope (optional)                                 
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>       
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>                                                              
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>      (2) Validate client credentials                        
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>                                                              
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>      (3) Return access_token                                
<a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>      
<a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a>                                                              
<a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a>      (4) Use access token to call API                       
<a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a>                                                              
<a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a>                                                              
<a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a>
<a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a>   Resource       
<a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a>    Server        
<a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a>   (API)          
<a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a>
</code></pre></div>
<p><strong>Use Cases:</strong>
- Microservices authentication
- Batch jobs accessing APIs
- Background services
- Server-to-server API calls</p>
<p><strong>Characteristics:</strong>
- No user context or refresh tokens
- Client acts on its own behalf
- Tokens typically short-lived</p>
<p><strong>Python Implementation Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">threading</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lock</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">ClientCredentialsClient</span><span class="p">:</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">client_secret</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">token_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">scope</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span> <span class="o">=</span> <span class="n">client_id</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client_secret</span> <span class="o">=</span> <span class="n">client_secret</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">token_url</span> <span class="o">=</span> <span class="n">token_url</span>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scope</span> <span class="o">=</span> <span class="n">scope</span>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">access_token</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">token_expiry</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_access_token</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get valid access token, refreshing if necessary&quot;&quot;&quot;</span>
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>            <span class="c1"># Check if token is still valid (with 60s buffer)</span>
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_token</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token_expiry</span> <span class="o">-</span> <span class="mi">60</span><span class="p">):</span>
<a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_token</span>
<a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a>
<a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a>            <span class="c1"># Request new token</span>
<a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request_token</span><span class="p">()</span>
<a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a>
<a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_request_token</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Request new access token using client credentials&quot;&quot;&quot;</span>
<a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a>        <span class="n">token_data</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a>            <span class="s1">&#39;grant_type&#39;</span><span class="p">:</span> <span class="s1">&#39;client_credentials&#39;</span><span class="p">,</span>
<a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a>            <span class="s1">&#39;client_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span><span class="p">,</span>
<a id="__codelineno-13-31" name="__codelineno-13-31" href="#__codelineno-13-31"></a>            <span class="s1">&#39;client_secret&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_secret</span><span class="p">,</span>
<a id="__codelineno-13-32" name="__codelineno-13-32" href="#__codelineno-13-32"></a>            <span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span>
<a id="__codelineno-13-33" name="__codelineno-13-33" href="#__codelineno-13-33"></a>        <span class="p">}</span>
<a id="__codelineno-13-34" name="__codelineno-13-34" href="#__codelineno-13-34"></a>
<a id="__codelineno-13-35" name="__codelineno-13-35" href="#__codelineno-13-35"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">token_data</span><span class="p">)</span>
<a id="__codelineno-13-36" name="__codelineno-13-36" href="#__codelineno-13-36"></a>
<a id="__codelineno-13-37" name="__codelineno-13-37" href="#__codelineno-13-37"></a>        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
<a id="__codelineno-13-38" name="__codelineno-13-38" href="#__codelineno-13-38"></a>            <span class="n">tokens</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<a id="__codelineno-13-39" name="__codelineno-13-39" href="#__codelineno-13-39"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">access_token</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="s1">&#39;access_token&#39;</span><span class="p">]</span>
<a id="__codelineno-13-40" name="__codelineno-13-40" href="#__codelineno-13-40"></a>            <span class="n">expires_in</span> <span class="o">=</span> <span class="n">tokens</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;expires_in&#39;</span><span class="p">,</span> <span class="mi">3600</span><span class="p">)</span>
<a id="__codelineno-13-41" name="__codelineno-13-41" href="#__codelineno-13-41"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">token_expiry</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="n">expires_in</span>
<a id="__codelineno-13-42" name="__codelineno-13-42" href="#__codelineno-13-42"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_token</span>
<a id="__codelineno-13-43" name="__codelineno-13-43" href="#__codelineno-13-43"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-13-44" name="__codelineno-13-44" href="#__codelineno-13-44"></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Token request failed: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-13-45" name="__codelineno-13-45" href="#__codelineno-13-45"></a>
<a id="__codelineno-13-46" name="__codelineno-13-46" href="#__codelineno-13-46"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">call_api</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<a id="__codelineno-13-47" name="__codelineno-13-47" href="#__codelineno-13-47"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make authenticated API request&quot;&quot;&quot;</span>
<a id="__codelineno-13-48" name="__codelineno-13-48" href="#__codelineno-13-48"></a>        <span class="n">access_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_access_token</span><span class="p">()</span>
<a id="__codelineno-13-49" name="__codelineno-13-49" href="#__codelineno-13-49"></a>        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Bearer </span><span class="si">{</span><span class="n">access_token</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">}</span>
<a id="__codelineno-13-50" name="__codelineno-13-50" href="#__codelineno-13-50"></a>
<a id="__codelineno-13-51" name="__codelineno-13-51" href="#__codelineno-13-51"></a>        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>
<a id="__codelineno-13-52" name="__codelineno-13-52" href="#__codelineno-13-52"></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<a id="__codelineno-13-53" name="__codelineno-13-53" href="#__codelineno-13-53"></a>        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
<a id="__codelineno-13-54" name="__codelineno-13-54" href="#__codelineno-13-54"></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-13-55" name="__codelineno-13-55" href="#__codelineno-13-55"></a>        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;PUT&#39;</span><span class="p">:</span>
<a id="__codelineno-13-56" name="__codelineno-13-56" href="#__codelineno-13-56"></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-13-57" name="__codelineno-13-57" href="#__codelineno-13-57"></a>        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;DELETE&#39;</span><span class="p">:</span>
<a id="__codelineno-13-58" name="__codelineno-13-58" href="#__codelineno-13-58"></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<a id="__codelineno-13-59" name="__codelineno-13-59" href="#__codelineno-13-59"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-13-60" name="__codelineno-13-60" href="#__codelineno-13-60"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unsupported method: </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-13-61" name="__codelineno-13-61" href="#__codelineno-13-61"></a>
<a id="__codelineno-13-62" name="__codelineno-13-62" href="#__codelineno-13-62"></a>        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
<a id="__codelineno-13-63" name="__codelineno-13-63" href="#__codelineno-13-63"></a>        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span> <span class="k">else</span> <span class="p">{}</span>
<a id="__codelineno-13-64" name="__codelineno-13-64" href="#__codelineno-13-64"></a>
<a id="__codelineno-13-65" name="__codelineno-13-65" href="#__codelineno-13-65"></a><span class="c1"># Usage Example - Microservice to Microservice Communication</span>
<a id="__codelineno-13-66" name="__codelineno-13-66" href="#__codelineno-13-66"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-13-67" name="__codelineno-13-67" href="#__codelineno-13-67"></a>    <span class="c1"># Initialize client</span>
<a id="__codelineno-13-68" name="__codelineno-13-68" href="#__codelineno-13-68"></a>    <span class="n">client</span> <span class="o">=</span> <span class="n">ClientCredentialsClient</span><span class="p">(</span>
<a id="__codelineno-13-69" name="__codelineno-13-69" href="#__codelineno-13-69"></a>        <span class="n">client_id</span><span class="o">=</span><span class="s1">&#39;service-a-client-id&#39;</span><span class="p">,</span>
<a id="__codelineno-13-70" name="__codelineno-13-70" href="#__codelineno-13-70"></a>        <span class="n">client_secret</span><span class="o">=</span><span class="s1">&#39;service-a-secret&#39;</span><span class="p">,</span>
<a id="__codelineno-13-71" name="__codelineno-13-71" href="#__codelineno-13-71"></a>        <span class="n">token_url</span><span class="o">=</span><span class="s1">&#39;https://auth-server.com/oauth/token&#39;</span><span class="p">,</span>
<a id="__codelineno-13-72" name="__codelineno-13-72" href="#__codelineno-13-72"></a>        <span class="n">scope</span><span class="o">=</span><span class="s1">&#39;api:read api:write&#39;</span>
<a id="__codelineno-13-73" name="__codelineno-13-73" href="#__codelineno-13-73"></a>    <span class="p">)</span>
<a id="__codelineno-13-74" name="__codelineno-13-74" href="#__codelineno-13-74"></a>
<a id="__codelineno-13-75" name="__codelineno-13-75" href="#__codelineno-13-75"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-13-76" name="__codelineno-13-76" href="#__codelineno-13-76"></a>        <span class="c1"># Call another service&#39;s API</span>
<a id="__codelineno-13-77" name="__codelineno-13-77" href="#__codelineno-13-77"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">call_api</span><span class="p">(</span><span class="s1">&#39;https://service-b.com/api/data&#39;</span><span class="p">)</span>
<a id="__codelineno-13-78" name="__codelineno-13-78" href="#__codelineno-13-78"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data from Service B: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-13-79" name="__codelineno-13-79" href="#__codelineno-13-79"></a>
<a id="__codelineno-13-80" name="__codelineno-13-80" href="#__codelineno-13-80"></a>        <span class="c1"># Create resource on another service</span>
<a id="__codelineno-13-81" name="__codelineno-13-81" href="#__codelineno-13-81"></a>        <span class="n">new_resource</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">call_api</span><span class="p">(</span>
<a id="__codelineno-13-82" name="__codelineno-13-82" href="#__codelineno-13-82"></a>            <span class="s1">&#39;https://service-b.com/api/resource&#39;</span><span class="p">,</span>
<a id="__codelineno-13-83" name="__codelineno-13-83" href="#__codelineno-13-83"></a>            <span class="n">method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
<a id="__codelineno-13-84" name="__codelineno-13-84" href="#__codelineno-13-84"></a>            <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;New Resource&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">123</span><span class="p">}</span>
<a id="__codelineno-13-85" name="__codelineno-13-85" href="#__codelineno-13-85"></a>        <span class="p">)</span>
<a id="__codelineno-13-86" name="__codelineno-13-86" href="#__codelineno-13-86"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created: </span><span class="si">{</span><span class="n">new_resource</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-13-87" name="__codelineno-13-87" href="#__codelineno-13-87"></a>
<a id="__codelineno-13-88" name="__codelineno-13-88" href="#__codelineno-13-88"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-13-89" name="__codelineno-13-89" href="#__codelineno-13-89"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h4 id="5-device-authorization-grant-device-code-flow">5. Device Authorization Grant (Device Code Flow)</h4>
<p><strong>Best for</strong>: Devices with limited input capabilities (Smart TVs, IoT devices)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>                                  
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>     Device                                           Authorization   
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>  (Smart TV)                                             Server       
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>                                  
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>                                                              
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>      (1) POST to /device/code endpoint                      
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>       
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>                                                              
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>      (2) Return device_code, user_code,                     
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>          verification_uri                                   
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>      
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>                                                              
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>      (3) Display: &quot;Go to google.com/device                  
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>                   and enter code: ABCD-1234&quot;                
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>                                                              
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>                                                 
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>                                  User                     
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>                                 (Phone)                   
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>                                                 
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>                                                            
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>                                      (4) Visit URL         
<a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>                                          Enter code        
<a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>                                      
<a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>                                                            
<a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a>                                      (5) Authenticate      
<a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>                                          &amp; authorize       
<a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a>                                                            
<a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a>      (6) Poll for token                                     
<a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a>         (every few seconds)                                 
<a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a>       
<a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a>                                                              
<a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a>      (7) Return access_token when user completes            
<a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a>      
<a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a>                                                              
<a id="__codelineno-14-35" name="__codelineno-14-35" href="#__codelineno-14-35"></a>                                                              
</code></pre></div>
<p><strong>Python Implementation Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">DeviceFlowClient</span><span class="p">:</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">device_code_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">token_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span> <span class="o">=</span> <span class="n">client_id</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device_code_url</span> <span class="o">=</span> <span class="n">device_code_url</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">token_url</span> <span class="o">=</span> <span class="n">token_url</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start_device_flow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Step 1: Request device and user codes&quot;&quot;&quot;</span>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>            <span class="s1">&#39;client_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span><span class="p">,</span>
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>            <span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="n">scope</span>
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>        <span class="p">}</span>
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device_code_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a>        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a>            <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Device code request failed: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a>
<a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">poll_for_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device_code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Step 2: Poll for access token&quot;&quot;&quot;</span>
<a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a>
<a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a>        <span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
<a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a>            <span class="n">token_data</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a>                <span class="s1">&#39;grant_type&#39;</span><span class="p">:</span> <span class="s1">&#39;urn:ietf:params:oauth:grant-type:device_code&#39;</span><span class="p">,</span>
<a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a>                <span class="s1">&#39;device_code&#39;</span><span class="p">:</span> <span class="n">device_code</span><span class="p">,</span>
<a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a>                <span class="s1">&#39;client_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span>
<a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a>            <span class="p">}</span>
<a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a>
<a id="__codelineno-15-36" name="__codelineno-15-36" href="#__codelineno-15-36"></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">token_data</span><span class="p">)</span>
<a id="__codelineno-15-37" name="__codelineno-15-37" href="#__codelineno-15-37"></a>
<a id="__codelineno-15-38" name="__codelineno-15-38" href="#__codelineno-15-38"></a>            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
<a id="__codelineno-15-39" name="__codelineno-15-39" href="#__codelineno-15-39"></a>                <span class="c1"># Success! User has authorized</span>
<a id="__codelineno-15-40" name="__codelineno-15-40" href="#__codelineno-15-40"></a>                <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<a id="__codelineno-15-41" name="__codelineno-15-41" href="#__codelineno-15-41"></a>
<a id="__codelineno-15-42" name="__codelineno-15-42" href="#__codelineno-15-42"></a>            <span class="n">error_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<a id="__codelineno-15-43" name="__codelineno-15-43" href="#__codelineno-15-43"></a>            <span class="n">error</span> <span class="o">=</span> <span class="n">error_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
<a id="__codelineno-15-44" name="__codelineno-15-44" href="#__codelineno-15-44"></a>
<a id="__codelineno-15-45" name="__codelineno-15-45" href="#__codelineno-15-45"></a>            <span class="k">if</span> <span class="n">error</span> <span class="o">==</span> <span class="s1">&#39;authorization_pending&#39;</span><span class="p">:</span>
<a id="__codelineno-15-46" name="__codelineno-15-46" href="#__codelineno-15-46"></a>                <span class="c1"># User hasn&#39;t completed authorization yet, wait and retry</span>
<a id="__codelineno-15-47" name="__codelineno-15-47" href="#__codelineno-15-47"></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Waiting for user authorization...&#39;</span><span class="p">)</span>
<a id="__codelineno-15-48" name="__codelineno-15-48" href="#__codelineno-15-48"></a>                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>
<a id="__codelineno-15-49" name="__codelineno-15-49" href="#__codelineno-15-49"></a>            <span class="k">elif</span> <span class="n">error</span> <span class="o">==</span> <span class="s1">&#39;slow_down&#39;</span><span class="p">:</span>
<a id="__codelineno-15-50" name="__codelineno-15-50" href="#__codelineno-15-50"></a>                <span class="c1"># Increase polling interval</span>
<a id="__codelineno-15-51" name="__codelineno-15-51" href="#__codelineno-15-51"></a>                <span class="n">interval</span> <span class="o">+=</span> <span class="mi">5</span>
<a id="__codelineno-15-52" name="__codelineno-15-52" href="#__codelineno-15-52"></a>                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>
<a id="__codelineno-15-53" name="__codelineno-15-53" href="#__codelineno-15-53"></a>            <span class="k">elif</span> <span class="n">error</span> <span class="o">==</span> <span class="s1">&#39;expired_token&#39;</span><span class="p">:</span>
<a id="__codelineno-15-54" name="__codelineno-15-54" href="#__codelineno-15-54"></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Device code expired. Please start over.&#39;</span><span class="p">)</span>
<a id="__codelineno-15-55" name="__codelineno-15-55" href="#__codelineno-15-55"></a>            <span class="k">elif</span> <span class="n">error</span> <span class="o">==</span> <span class="s1">&#39;access_denied&#39;</span><span class="p">:</span>
<a id="__codelineno-15-56" name="__codelineno-15-56" href="#__codelineno-15-56"></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;User denied authorization&#39;</span><span class="p">)</span>
<a id="__codelineno-15-57" name="__codelineno-15-57" href="#__codelineno-15-57"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-15-58" name="__codelineno-15-58" href="#__codelineno-15-58"></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Token request failed: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-15-59" name="__codelineno-15-59" href="#__codelineno-15-59"></a>
<a id="__codelineno-15-60" name="__codelineno-15-60" href="#__codelineno-15-60"></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Timeout waiting for user authorization&#39;</span><span class="p">)</span>
<a id="__codelineno-15-61" name="__codelineno-15-61" href="#__codelineno-15-61"></a>
<a id="__codelineno-15-62" name="__codelineno-15-62" href="#__codelineno-15-62"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<a id="__codelineno-15-63" name="__codelineno-15-63" href="#__codelineno-15-63"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Complete device flow authentication&quot;&quot;&quot;</span>
<a id="__codelineno-15-64" name="__codelineno-15-64" href="#__codelineno-15-64"></a>        <span class="c1"># Step 1: Get device code</span>
<a id="__codelineno-15-65" name="__codelineno-15-65" href="#__codelineno-15-65"></a>        <span class="n">device_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_device_flow</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span>
<a id="__codelineno-15-66" name="__codelineno-15-66" href="#__codelineno-15-66"></a>
<a id="__codelineno-15-67" name="__codelineno-15-67" href="#__codelineno-15-67"></a>        <span class="c1"># Display instructions to user</span>
<a id="__codelineno-15-68" name="__codelineno-15-68" href="#__codelineno-15-68"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">60</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-15-69" name="__codelineno-15-69" href="#__codelineno-15-69"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Please visit: </span><span class="si">{</span><span class="n">device_info</span><span class="p">[</span><span class="s1">&#39;verification_uri&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-15-70" name="__codelineno-15-70" href="#__codelineno-15-70"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;And enter code: </span><span class="si">{</span><span class="n">device_info</span><span class="p">[</span><span class="s1">&#39;user_code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-15-71" name="__codelineno-15-71" href="#__codelineno-15-71"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">60</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-15-72" name="__codelineno-15-72" href="#__codelineno-15-72"></a>
<a id="__codelineno-15-73" name="__codelineno-15-73" href="#__codelineno-15-73"></a>        <span class="c1"># Alternative: verification_uri_complete for QR codes</span>
<a id="__codelineno-15-74" name="__codelineno-15-74" href="#__codelineno-15-74"></a>        <span class="k">if</span> <span class="s1">&#39;verification_uri_complete&#39;</span> <span class="ow">in</span> <span class="n">device_info</span><span class="p">:</span>
<a id="__codelineno-15-75" name="__codelineno-15-75" href="#__codelineno-15-75"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Or scan this URL: </span><span class="si">{</span><span class="n">device_info</span><span class="p">[</span><span class="s1">&#39;verification_uri_complete&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-15-76" name="__codelineno-15-76" href="#__codelineno-15-76"></a>
<a id="__codelineno-15-77" name="__codelineno-15-77" href="#__codelineno-15-77"></a>        <span class="c1"># Step 2: Poll for token</span>
<a id="__codelineno-15-78" name="__codelineno-15-78" href="#__codelineno-15-78"></a>        <span class="n">interval</span> <span class="o">=</span> <span class="n">device_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;interval&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-15-79" name="__codelineno-15-79" href="#__codelineno-15-79"></a>        <span class="n">tokens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">poll_for_token</span><span class="p">(</span><span class="n">device_info</span><span class="p">[</span><span class="s1">&#39;device_code&#39;</span><span class="p">],</span> <span class="n">interval</span><span class="p">)</span>
<a id="__codelineno-15-80" name="__codelineno-15-80" href="#__codelineno-15-80"></a>
<a id="__codelineno-15-81" name="__codelineno-15-81" href="#__codelineno-15-81"></a>        <span class="k">return</span> <span class="n">tokens</span>
<a id="__codelineno-15-82" name="__codelineno-15-82" href="#__codelineno-15-82"></a>
<a id="__codelineno-15-83" name="__codelineno-15-83" href="#__codelineno-15-83"></a><span class="c1"># Usage Example - Smart TV or IoT Device</span>
<a id="__codelineno-15-84" name="__codelineno-15-84" href="#__codelineno-15-84"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-15-85" name="__codelineno-15-85" href="#__codelineno-15-85"></a>    <span class="n">client</span> <span class="o">=</span> <span class="n">DeviceFlowClient</span><span class="p">(</span>
<a id="__codelineno-15-86" name="__codelineno-15-86" href="#__codelineno-15-86"></a>        <span class="n">client_id</span><span class="o">=</span><span class="s1">&#39;smart-tv-client-id&#39;</span><span class="p">,</span>
<a id="__codelineno-15-87" name="__codelineno-15-87" href="#__codelineno-15-87"></a>        <span class="n">device_code_url</span><span class="o">=</span><span class="s1">&#39;https://auth-server.com/oauth/device/code&#39;</span><span class="p">,</span>
<a id="__codelineno-15-88" name="__codelineno-15-88" href="#__codelineno-15-88"></a>        <span class="n">token_url</span><span class="o">=</span><span class="s1">&#39;https://auth-server.com/oauth/token&#39;</span>
<a id="__codelineno-15-89" name="__codelineno-15-89" href="#__codelineno-15-89"></a>    <span class="p">)</span>
<a id="__codelineno-15-90" name="__codelineno-15-90" href="#__codelineno-15-90"></a>
<a id="__codelineno-15-91" name="__codelineno-15-91" href="#__codelineno-15-91"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-15-92" name="__codelineno-15-92" href="#__codelineno-15-92"></a>        <span class="c1"># Start authentication flow</span>
<a id="__codelineno-15-93" name="__codelineno-15-93" href="#__codelineno-15-93"></a>        <span class="n">tokens</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s1">&#39;tv:control media:play&#39;</span><span class="p">)</span>
<a id="__codelineno-15-94" name="__codelineno-15-94" href="#__codelineno-15-94"></a>
<a id="__codelineno-15-95" name="__codelineno-15-95" href="#__codelineno-15-95"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Authentication successful!&quot;</span><span class="p">)</span>
<a id="__codelineno-15-96" name="__codelineno-15-96" href="#__codelineno-15-96"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Access Token: </span><span class="si">{</span><span class="n">tokens</span><span class="p">[</span><span class="s1">&#39;access_token&#39;</span><span class="p">][:</span><span class="mi">20</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
<a id="__codelineno-15-97" name="__codelineno-15-97" href="#__codelineno-15-97"></a>
<a id="__codelineno-15-98" name="__codelineno-15-98" href="#__codelineno-15-98"></a>        <span class="c1"># Now use the access token to call APIs</span>
<a id="__codelineno-15-99" name="__codelineno-15-99" href="#__codelineno-15-99"></a>        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Bearer </span><span class="si">{</span><span class="n">tokens</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">}</span>
<a id="__codelineno-15-100" name="__codelineno-15-100" href="#__codelineno-15-100"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://api-server.com/user/profile&#39;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<a id="__codelineno-15-101" name="__codelineno-15-101" href="#__codelineno-15-101"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User Profile: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-15-102" name="__codelineno-15-102" href="#__codelineno-15-102"></a>
<a id="__codelineno-15-103" name="__codelineno-15-103" href="#__codelineno-15-103"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-15-104" name="__codelineno-15-104" href="#__codelineno-15-104"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Authentication failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h4 id="6-refresh-token-grant">6. Refresh Token Grant</h4>
<p><strong>Best for</strong>: Obtaining new access tokens without user re-authentication</p>
<p><strong>Description</strong>: Allows clients to obtain a new access token using a refresh token when the current access token expires, without requiring user interaction.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>                                  
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>     Client                                           Authorization   
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>  (Application)                                          Server       
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>                                  
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>                                                              
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>      Initial authorization flow completed                   
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>      Client has: access_token + refresh_token               
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>                                                              
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>      
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>                Time passes... access_token expires          
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>      
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>                                                              
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>      (1) Access token expired (401 Unauthorized)            
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>                                                              
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>      (2) POST /token with:                                  
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>          - grant_type=refresh_token                         
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a>          - refresh_token=&lt;refresh_token&gt;                    
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a>          - client_id                                        
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a>          - client_secret (for confidential clients)         
<a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a>          - scope (optional, to request reduced scope)       
<a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a>       
<a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a>                                                              
<a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a>      (3) Validate refresh token:                            
<a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a>          - Check if not expired                             
<a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a>          - Check if not revoked                             
<a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a>          - Verify client credentials                        
<a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a>          - Validate requested scope                         
<a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a>                                                              
<a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a>      (4) Return new tokens:                                 
<a id="__codelineno-16-30" name="__codelineno-16-30" href="#__codelineno-16-30"></a>          {                                                  
<a id="__codelineno-16-31" name="__codelineno-16-31" href="#__codelineno-16-31"></a>            &quot;access_token&quot;: &quot;new_access_token&quot;,              
<a id="__codelineno-16-32" name="__codelineno-16-32" href="#__codelineno-16-32"></a>            &quot;token_type&quot;: &quot;Bearer&quot;,                          
<a id="__codelineno-16-33" name="__codelineno-16-33" href="#__codelineno-16-33"></a>            &quot;expires_in&quot;: 3600,                              
<a id="__codelineno-16-34" name="__codelineno-16-34" href="#__codelineno-16-34"></a>            &quot;refresh_token&quot;: &quot;new_refresh_token&quot;,            
<a id="__codelineno-16-35" name="__codelineno-16-35" href="#__codelineno-16-35"></a>            &quot;scope&quot;: &quot;read write&quot;                            
<a id="__codelineno-16-36" name="__codelineno-16-36" href="#__codelineno-16-36"></a>          }                                                  
<a id="__codelineno-16-37" name="__codelineno-16-37" href="#__codelineno-16-37"></a>      
<a id="__codelineno-16-38" name="__codelineno-16-38" href="#__codelineno-16-38"></a>                                                              
<a id="__codelineno-16-39" name="__codelineno-16-39" href="#__codelineno-16-39"></a>      (5) Use new access_token                               
<a id="__codelineno-16-40" name="__codelineno-16-40" href="#__codelineno-16-40"></a>                                                              
<a id="__codelineno-16-41" name="__codelineno-16-41" href="#__codelineno-16-41"></a>                                                              
<a id="__codelineno-16-42" name="__codelineno-16-42" href="#__codelineno-16-42"></a>
<a id="__codelineno-16-43" name="__codelineno-16-43" href="#__codelineno-16-43"></a>   Resource       
<a id="__codelineno-16-44" name="__codelineno-16-44" href="#__codelineno-16-44"></a>    Server        
<a id="__codelineno-16-45" name="__codelineno-16-45" href="#__codelineno-16-45"></a>
</code></pre></div>
<p><strong>Key Characteristics</strong>:</p>
<ol>
<li><strong>No User Interaction</strong>: Tokens renewed silently in background</li>
<li><strong>Refresh Token Rotation</strong>: Best practice is to issue new refresh token with each use</li>
<li><strong>Reduced Scope</strong>: Can request narrower permissions than original grant</li>
<li><strong>Long-Lived</strong>: Refresh tokens typically valid for days/weeks/months</li>
<li><strong>Revocable</strong>: Can be revoked by authorization server or user</li>
</ol>
<p><strong>Security Considerations</strong>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>Refresh Token Rotation (Recommended):
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>Request 1:  refresh_token_1  new access_token + refresh_token_2
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>Request 2:  refresh_token_2  new access_token + refresh_token_3
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>Request 3:  refresh_token_3  new access_token + refresh_token_4
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>Old refresh tokens are invalidated after use.
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>If refresh_token_1 is used again after refresh_token_2 was issued:
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a> Token theft detected!
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a> Revoke entire token family
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a> User must re-authenticate
</code></pre></div>
<p><strong>Best Practices</strong>:</p>
<ul>
<li> Implement refresh token rotation</li>
<li> Store refresh tokens securely (encrypted, server-side)</li>
<li> Set appropriate expiration times</li>
<li> Implement token revocation endpoint</li>
<li> Monitor for suspicious refresh patterns</li>
<li> Limit refresh token lifetime</li>
<li> Bind refresh tokens to specific clients</li>
</ul>
<p><strong>Token Response Example</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="p">{</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">  </span><span class="nt">&quot;access_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span><span class="p">,</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="w">  </span><span class="nt">&quot;token_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Bearer&quot;</span><span class="p">,</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="w">  </span><span class="nt">&quot;expires_in&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3600</span><span class="p">,</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="w">  </span><span class="nt">&quot;refresh_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tGzv3JOkF0XG5Qx2TlKWIA&quot;</span><span class="p">,</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="w">  </span><span class="nt">&quot;scope&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;read write&quot;</span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="p">}</span>
</code></pre></div></p>
<p><strong>Error Responses</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="err">// Invalid or expired refresh token</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="err">{</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="err">  &quot;error&quot;: &quot;invalid_grant&quot;,</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="err">  &quot;error_description&quot;: &quot;The refresh token is invalid or expired&quot;</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="err">}</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="err">// Refresh token has been revoked</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="err">{</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="err">  &quot;error&quot;: &quot;invalid_grant&quot;, </span>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="err">  &quot;error_description&quot;: &quot;Token has been revoked&quot;</span>
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="err">}</span>
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="err">// Invalid scope request</span>
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="err">{</span>
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="err">  &quot;error&quot;: &quot;invalid_scope&quot;,</span>
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="err">  &quot;error_description&quot;: &quot;Requested scope exceeds original grant&quot;</span>
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="err">}</span>
</code></pre></div></p>
<p><strong>Use Cases</strong>:
- Mobile applications maintaining long-term access
- Background services that need continuous API access
- Web applications providing seamless user experience
- Reducing authentication friction for users</p>
<p><strong>Refresh Token vs Access Token</strong>:</p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Access Token</th>
<th>Refresh Token</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Purpose</strong></td>
<td>Access protected resources</td>
<td>Obtain new access tokens</td>
</tr>
<tr>
<td><strong>Lifetime</strong></td>
<td>Short (minutes to hours)</td>
<td>Long (days to months)</td>
</tr>
<tr>
<td><strong>Sent to Resource Server</strong></td>
<td>Yes</td>
<td>No (only to auth server)</td>
</tr>
<tr>
<td><strong>Exposure Risk</strong></td>
<td>Higher (frequent use)</td>
<td>Lower (infrequent use)</td>
</tr>
<tr>
<td><strong>Can be Revoked</strong></td>
<td>Usually not individually</td>
<td>Yes</td>
</tr>
<tr>
<td><strong>Storage</strong></td>
<td>Memory/session storage</td>
<td>Secure persistent storage</td>
</tr>
</tbody>
</table>
<p><strong>Python Implementation Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">TokenManager</span><span class="p">:</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">client_secret</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">token_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span> <span class="o">=</span> <span class="n">client_id</span>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client_secret</span> <span class="o">=</span> <span class="n">client_secret</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">token_url</span> <span class="o">=</span> <span class="n">token_url</span>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">access_token</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_token</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">token_expiry</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">access_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">refresh_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">expires_in</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3600</span><span class="p">):</span>
<a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set initial tokens (from authorization code flow)&quot;&quot;&quot;</span>
<a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">access_token</span> <span class="o">=</span> <span class="n">access_token</span>
<a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_token</span> <span class="o">=</span> <span class="n">refresh_token</span>
<a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">token_expiry</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="n">expires_in</span>
<a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a>
<a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">refresh_access_token</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Refresh the access token using refresh token&quot;&quot;&quot;</span>
<a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_token</span><span class="p">:</span>
<a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;No refresh token available&#39;</span><span class="p">)</span>
<a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a>
<a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a>        <span class="n">token_data</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a>            <span class="s1">&#39;grant_type&#39;</span><span class="p">:</span> <span class="s1">&#39;refresh_token&#39;</span><span class="p">,</span>
<a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a>            <span class="s1">&#39;refresh_token&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_token</span><span class="p">,</span>
<a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a>            <span class="s1">&#39;client_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span><span class="p">,</span>
<a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a>            <span class="s1">&#39;client_secret&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_secret</span>
<a id="__codelineno-20-31" name="__codelineno-20-31" href="#__codelineno-20-31"></a>        <span class="p">}</span>
<a id="__codelineno-20-32" name="__codelineno-20-32" href="#__codelineno-20-32"></a>
<a id="__codelineno-20-33" name="__codelineno-20-33" href="#__codelineno-20-33"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">token_data</span><span class="p">)</span>
<a id="__codelineno-20-34" name="__codelineno-20-34" href="#__codelineno-20-34"></a>
<a id="__codelineno-20-35" name="__codelineno-20-35" href="#__codelineno-20-35"></a>        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
<a id="__codelineno-20-36" name="__codelineno-20-36" href="#__codelineno-20-36"></a>            <span class="n">tokens</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<a id="__codelineno-20-37" name="__codelineno-20-37" href="#__codelineno-20-37"></a>
<a id="__codelineno-20-38" name="__codelineno-20-38" href="#__codelineno-20-38"></a>            <span class="c1"># Update tokens</span>
<a id="__codelineno-20-39" name="__codelineno-20-39" href="#__codelineno-20-39"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">access_token</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="s1">&#39;access_token&#39;</span><span class="p">]</span>
<a id="__codelineno-20-40" name="__codelineno-20-40" href="#__codelineno-20-40"></a>            <span class="c1"># Server may issue new refresh token (rotation)</span>
<a id="__codelineno-20-41" name="__codelineno-20-41" href="#__codelineno-20-41"></a>            <span class="k">if</span> <span class="s1">&#39;refresh_token&#39;</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
<a id="__codelineno-20-42" name="__codelineno-20-42" href="#__codelineno-20-42"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">refresh_token</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="s1">&#39;refresh_token&#39;</span><span class="p">]</span>
<a id="__codelineno-20-43" name="__codelineno-20-43" href="#__codelineno-20-43"></a>
<a id="__codelineno-20-44" name="__codelineno-20-44" href="#__codelineno-20-44"></a>            <span class="n">expires_in</span> <span class="o">=</span> <span class="n">tokens</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;expires_in&#39;</span><span class="p">,</span> <span class="mi">3600</span><span class="p">)</span>
<a id="__codelineno-20-45" name="__codelineno-20-45" href="#__codelineno-20-45"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">token_expiry</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="n">expires_in</span>
<a id="__codelineno-20-46" name="__codelineno-20-46" href="#__codelineno-20-46"></a>
<a id="__codelineno-20-47" name="__codelineno-20-47" href="#__codelineno-20-47"></a>            <span class="k">return</span> <span class="n">tokens</span>
<a id="__codelineno-20-48" name="__codelineno-20-48" href="#__codelineno-20-48"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-20-49" name="__codelineno-20-49" href="#__codelineno-20-49"></a>            <span class="n">error</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<a id="__codelineno-20-50" name="__codelineno-20-50" href="#__codelineno-20-50"></a>            <span class="k">if</span> <span class="n">error</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;invalid_grant&#39;</span><span class="p">:</span>
<a id="__codelineno-20-51" name="__codelineno-20-51" href="#__codelineno-20-51"></a>                <span class="c1"># Refresh token expired or revoked</span>
<a id="__codelineno-20-52" name="__codelineno-20-52" href="#__codelineno-20-52"></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Refresh token invalid. Please re-authenticate.&#39;</span><span class="p">)</span>
<a id="__codelineno-20-53" name="__codelineno-20-53" href="#__codelineno-20-53"></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Token refresh failed: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-20-54" name="__codelineno-20-54" href="#__codelineno-20-54"></a>
<a id="__codelineno-20-55" name="__codelineno-20-55" href="#__codelineno-20-55"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_valid_access_token</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-20-56" name="__codelineno-20-56" href="#__codelineno-20-56"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get valid access token, automatically refreshing if needed&quot;&quot;&quot;</span>
<a id="__codelineno-20-57" name="__codelineno-20-57" href="#__codelineno-20-57"></a>        <span class="c1"># Check if token is expired or about to expire (60s buffer)</span>
<a id="__codelineno-20-58" name="__codelineno-20-58" href="#__codelineno-20-58"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_token</span> <span class="ow">or</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token_expiry</span> <span class="o">-</span> <span class="mi">60</span><span class="p">):</span>
<a id="__codelineno-20-59" name="__codelineno-20-59" href="#__codelineno-20-59"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_token</span><span class="p">:</span>
<a id="__codelineno-20-60" name="__codelineno-20-60" href="#__codelineno-20-60"></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Access token expired, refreshing...&#39;</span><span class="p">)</span>
<a id="__codelineno-20-61" name="__codelineno-20-61" href="#__codelineno-20-61"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">refresh_access_token</span><span class="p">()</span>
<a id="__codelineno-20-62" name="__codelineno-20-62" href="#__codelineno-20-62"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-20-63" name="__codelineno-20-63" href="#__codelineno-20-63"></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;No valid access token and no refresh token&#39;</span><span class="p">)</span>
<a id="__codelineno-20-64" name="__codelineno-20-64" href="#__codelineno-20-64"></a>
<a id="__codelineno-20-65" name="__codelineno-20-65" href="#__codelineno-20-65"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_token</span>
<a id="__codelineno-20-66" name="__codelineno-20-66" href="#__codelineno-20-66"></a>
<a id="__codelineno-20-67" name="__codelineno-20-67" href="#__codelineno-20-67"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">call_api_with_retry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span> 
<a id="__codelineno-20-68" name="__codelineno-20-68" href="#__codelineno-20-68"></a>                           <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<a id="__codelineno-20-69" name="__codelineno-20-69" href="#__codelineno-20-69"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Call API with automatic token refresh on 401 errors&quot;&quot;&quot;</span>
<a id="__codelineno-20-70" name="__codelineno-20-70" href="#__codelineno-20-70"></a>        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-20-71" name="__codelineno-20-71" href="#__codelineno-20-71"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-20-72" name="__codelineno-20-72" href="#__codelineno-20-72"></a>                <span class="n">access_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_valid_access_token</span><span class="p">()</span>
<a id="__codelineno-20-73" name="__codelineno-20-73" href="#__codelineno-20-73"></a>                <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Bearer </span><span class="si">{</span><span class="n">access_token</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">}</span>
<a id="__codelineno-20-74" name="__codelineno-20-74" href="#__codelineno-20-74"></a>
<a id="__codelineno-20-75" name="__codelineno-20-75" href="#__codelineno-20-75"></a>                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>
<a id="__codelineno-20-76" name="__codelineno-20-76" href="#__codelineno-20-76"></a>                    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<a id="__codelineno-20-77" name="__codelineno-20-77" href="#__codelineno-20-77"></a>                <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
<a id="__codelineno-20-78" name="__codelineno-20-78" href="#__codelineno-20-78"></a>                    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-20-79" name="__codelineno-20-79" href="#__codelineno-20-79"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-20-80" name="__codelineno-20-80" href="#__codelineno-20-80"></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unsupported method: </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-20-81" name="__codelineno-20-81" href="#__codelineno-20-81"></a>
<a id="__codelineno-20-82" name="__codelineno-20-82" href="#__codelineno-20-82"></a>                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">401</span> <span class="ow">and</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="n">max_retries</span><span class="p">:</span>
<a id="__codelineno-20-83" name="__codelineno-20-83" href="#__codelineno-20-83"></a>                    <span class="c1"># Token might be invalid, try refreshing</span>
<a id="__codelineno-20-84" name="__codelineno-20-84" href="#__codelineno-20-84"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Received 401, attempting to refresh token...&#39;</span><span class="p">)</span>
<a id="__codelineno-20-85" name="__codelineno-20-85" href="#__codelineno-20-85"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">refresh_access_token</span><span class="p">()</span>
<a id="__codelineno-20-86" name="__codelineno-20-86" href="#__codelineno-20-86"></a>                    <span class="k">continue</span>
<a id="__codelineno-20-87" name="__codelineno-20-87" href="#__codelineno-20-87"></a>
<a id="__codelineno-20-88" name="__codelineno-20-88" href="#__codelineno-20-88"></a>                <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
<a id="__codelineno-20-89" name="__codelineno-20-89" href="#__codelineno-20-89"></a>                <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span> <span class="k">else</span> <span class="p">{}</span>
<a id="__codelineno-20-90" name="__codelineno-20-90" href="#__codelineno-20-90"></a>
<a id="__codelineno-20-91" name="__codelineno-20-91" href="#__codelineno-20-91"></a>            <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-20-92" name="__codelineno-20-92" href="#__codelineno-20-92"></a>                <span class="k">if</span> <span class="n">attempt</span> <span class="o">&gt;=</span> <span class="n">max_retries</span><span class="p">:</span>
<a id="__codelineno-20-93" name="__codelineno-20-93" href="#__codelineno-20-93"></a>                    <span class="k">raise</span>
<a id="__codelineno-20-94" name="__codelineno-20-94" href="#__codelineno-20-94"></a>
<a id="__codelineno-20-95" name="__codelineno-20-95" href="#__codelineno-20-95"></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Max retries exceeded&#39;</span><span class="p">)</span>
<a id="__codelineno-20-96" name="__codelineno-20-96" href="#__codelineno-20-96"></a>
<a id="__codelineno-20-97" name="__codelineno-20-97" href="#__codelineno-20-97"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-20-98" name="__codelineno-20-98" href="#__codelineno-20-98"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Save tokens to file (encrypt in production!)&quot;&quot;&quot;</span>
<a id="__codelineno-20-99" name="__codelineno-20-99" href="#__codelineno-20-99"></a>        <span class="n">tokens</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-20-100" name="__codelineno-20-100" href="#__codelineno-20-100"></a>            <span class="s1">&#39;access_token&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_token</span><span class="p">,</span>
<a id="__codelineno-20-101" name="__codelineno-20-101" href="#__codelineno-20-101"></a>            <span class="s1">&#39;refresh_token&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_token</span><span class="p">,</span>
<a id="__codelineno-20-102" name="__codelineno-20-102" href="#__codelineno-20-102"></a>            <span class="s1">&#39;token_expiry&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">token_expiry</span>
<a id="__codelineno-20-103" name="__codelineno-20-103" href="#__codelineno-20-103"></a>        <span class="p">}</span>
<a id="__codelineno-20-104" name="__codelineno-20-104" href="#__codelineno-20-104"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-20-105" name="__codelineno-20-105" href="#__codelineno-20-105"></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
<a id="__codelineno-20-106" name="__codelineno-20-106" href="#__codelineno-20-106"></a>
<a id="__codelineno-20-107" name="__codelineno-20-107" href="#__codelineno-20-107"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-20-108" name="__codelineno-20-108" href="#__codelineno-20-108"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Load tokens from file&quot;&quot;&quot;</span>
<a id="__codelineno-20-109" name="__codelineno-20-109" href="#__codelineno-20-109"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-20-110" name="__codelineno-20-110" href="#__codelineno-20-110"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-20-111" name="__codelineno-20-111" href="#__codelineno-20-111"></a>                <span class="n">tokens</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a id="__codelineno-20-112" name="__codelineno-20-112" href="#__codelineno-20-112"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">access_token</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="s1">&#39;access_token&#39;</span><span class="p">]</span>
<a id="__codelineno-20-113" name="__codelineno-20-113" href="#__codelineno-20-113"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">refresh_token</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="s1">&#39;refresh_token&#39;</span><span class="p">]</span>
<a id="__codelineno-20-114" name="__codelineno-20-114" href="#__codelineno-20-114"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">token_expiry</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="s1">&#39;token_expiry&#39;</span><span class="p">]</span>
<a id="__codelineno-20-115" name="__codelineno-20-115" href="#__codelineno-20-115"></a>        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
<a id="__codelineno-20-116" name="__codelineno-20-116" href="#__codelineno-20-116"></a>            <span class="k">pass</span>
<a id="__codelineno-20-117" name="__codelineno-20-117" href="#__codelineno-20-117"></a>
<a id="__codelineno-20-118" name="__codelineno-20-118" href="#__codelineno-20-118"></a><span class="c1"># Usage Example</span>
<a id="__codelineno-20-119" name="__codelineno-20-119" href="#__codelineno-20-119"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-20-120" name="__codelineno-20-120" href="#__codelineno-20-120"></a>    <span class="n">token_manager</span> <span class="o">=</span> <span class="n">TokenManager</span><span class="p">(</span>
<a id="__codelineno-20-121" name="__codelineno-20-121" href="#__codelineno-20-121"></a>        <span class="n">client_id</span><span class="o">=</span><span class="s1">&#39;your_client_id&#39;</span><span class="p">,</span>
<a id="__codelineno-20-122" name="__codelineno-20-122" href="#__codelineno-20-122"></a>        <span class="n">client_secret</span><span class="o">=</span><span class="s1">&#39;your_client_secret&#39;</span><span class="p">,</span>
<a id="__codelineno-20-123" name="__codelineno-20-123" href="#__codelineno-20-123"></a>        <span class="n">token_url</span><span class="o">=</span><span class="s1">&#39;https://auth-server.com/oauth/token&#39;</span>
<a id="__codelineno-20-124" name="__codelineno-20-124" href="#__codelineno-20-124"></a>    <span class="p">)</span>
<a id="__codelineno-20-125" name="__codelineno-20-125" href="#__codelineno-20-125"></a>
<a id="__codelineno-20-126" name="__codelineno-20-126" href="#__codelineno-20-126"></a>    <span class="c1"># Set initial tokens (from authorization code flow)</span>
<a id="__codelineno-20-127" name="__codelineno-20-127" href="#__codelineno-20-127"></a>    <span class="n">token_manager</span><span class="o">.</span><span class="n">set_tokens</span><span class="p">(</span>
<a id="__codelineno-20-128" name="__codelineno-20-128" href="#__codelineno-20-128"></a>        <span class="n">access_token</span><span class="o">=</span><span class="s1">&#39;initial_access_token&#39;</span><span class="p">,</span>
<a id="__codelineno-20-129" name="__codelineno-20-129" href="#__codelineno-20-129"></a>        <span class="n">refresh_token</span><span class="o">=</span><span class="s1">&#39;initial_refresh_token&#39;</span><span class="p">,</span>
<a id="__codelineno-20-130" name="__codelineno-20-130" href="#__codelineno-20-130"></a>        <span class="n">expires_in</span><span class="o">=</span><span class="mi">3600</span>
<a id="__codelineno-20-131" name="__codelineno-20-131" href="#__codelineno-20-131"></a>    <span class="p">)</span>
<a id="__codelineno-20-132" name="__codelineno-20-132" href="#__codelineno-20-132"></a>
<a id="__codelineno-20-133" name="__codelineno-20-133" href="#__codelineno-20-133"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-20-134" name="__codelineno-20-134" href="#__codelineno-20-134"></a>        <span class="c1"># Make API calls - tokens will be automatically refreshed</span>
<a id="__codelineno-20-135" name="__codelineno-20-135" href="#__codelineno-20-135"></a>        <span class="n">user_data</span> <span class="o">=</span> <span class="n">token_manager</span><span class="o">.</span><span class="n">call_api_with_retry</span><span class="p">(</span>
<a id="__codelineno-20-136" name="__codelineno-20-136" href="#__codelineno-20-136"></a>            <span class="s1">&#39;https://api-server.com/user/profile&#39;</span>
<a id="__codelineno-20-137" name="__codelineno-20-137" href="#__codelineno-20-137"></a>        <span class="p">)</span>
<a id="__codelineno-20-138" name="__codelineno-20-138" href="#__codelineno-20-138"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User Profile: </span><span class="si">{</span><span class="n">user_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-20-139" name="__codelineno-20-139" href="#__codelineno-20-139"></a>
<a id="__codelineno-20-140" name="__codelineno-20-140" href="#__codelineno-20-140"></a>        <span class="c1"># Save tokens for later use</span>
<a id="__codelineno-20-141" name="__codelineno-20-141" href="#__codelineno-20-141"></a>        <span class="n">token_manager</span><span class="o">.</span><span class="n">save_tokens</span><span class="p">(</span><span class="s1">&#39;tokens.json&#39;</span><span class="p">)</span>
<a id="__codelineno-20-142" name="__codelineno-20-142" href="#__codelineno-20-142"></a>
<a id="__codelineno-20-143" name="__codelineno-20-143" href="#__codelineno-20-143"></a>        <span class="c1"># Simulate token expiration</span>
<a id="__codelineno-20-144" name="__codelineno-20-144" href="#__codelineno-20-144"></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-20-145" name="__codelineno-20-145" href="#__codelineno-20-145"></a>        <span class="n">token_manager</span><span class="o">.</span><span class="n">token_expiry</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="mi">100</span>  <span class="c1"># Force expiry</span>
<a id="__codelineno-20-146" name="__codelineno-20-146" href="#__codelineno-20-146"></a>
<a id="__codelineno-20-147" name="__codelineno-20-147" href="#__codelineno-20-147"></a>        <span class="c1"># This will automatically refresh the token</span>
<a id="__codelineno-20-148" name="__codelineno-20-148" href="#__codelineno-20-148"></a>        <span class="n">posts</span> <span class="o">=</span> <span class="n">token_manager</span><span class="o">.</span><span class="n">call_api_with_retry</span><span class="p">(</span>
<a id="__codelineno-20-149" name="__codelineno-20-149" href="#__codelineno-20-149"></a>            <span class="s1">&#39;https://api-server.com/user/posts&#39;</span>
<a id="__codelineno-20-150" name="__codelineno-20-150" href="#__codelineno-20-150"></a>        <span class="p">)</span>
<a id="__codelineno-20-151" name="__codelineno-20-151" href="#__codelineno-20-151"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User Posts: </span><span class="si">{</span><span class="n">posts</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-20-152" name="__codelineno-20-152" href="#__codelineno-20-152"></a>
<a id="__codelineno-20-153" name="__codelineno-20-153" href="#__codelineno-20-153"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-20-154" name="__codelineno-20-154" href="#__codelineno-20-154"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="oauth-20-concepts">OAuth 2.0 Concepts</h3>
<h4 id="jwt-json-web-token">JWT (JSON Web Token)</h4>
<p><strong>Description</strong>: A compact, URL-safe token format for representing claims between two parties.</p>
<p><strong>Structure</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a> Header     Payload     Signature 
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>                                                                                                    
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a> {                                     .  {                                    .  HMACSHA256(       
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>   &quot;alg&quot;: &quot;HS256&quot;,                          &quot;sub&quot;: &quot;1234567890&quot;,                    base64(header)  
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>   &quot;typ&quot;: &quot;JWT&quot;                             &quot;name&quot;: &quot;John Doe&quot;,                     + &quot;.&quot; +         
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a> }                                          &quot;iat&quot;: 1516239022,                      base64(payload),
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>                                            &quot;exp&quot;: 1516242622,                      secret          
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>      &quot;scope&quot;: &quot;read:user&quot;                  )                 
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>                                             }                                                         
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>                                               
</code></pre></div></p>
<p><strong>Parts</strong>:
1. <strong>Header</strong>: Algorithm and token type
2. <strong>Payload</strong>: Claims (user data, permissions, expiration)
3. <strong>Signature</strong>: Ensures token integrity</p>
<p><strong>Benefits</strong>:
- Self-contained: Contains all necessary information
- Stateless: No server-side session storage needed
- Verifiable: Signature prevents tampering</p>
<p><strong>Common Claims</strong>:
- <code>iss</code> (issuer): Who created the token
- <code>sub</code> (subject): Who the token is about
- <code>aud</code> (audience): Who the token is intended for
- <code>exp</code> (expiration): When the token expires
- <code>iat</code> (issued at): When the token was created
- <code>scope</code>: Permissions granted</p>
<h4 id="token-exchange">Token Exchange</h4>
<p><strong>Description</strong>: Process of exchanging one type of token for another, or refreshing an expired access token.</p>
<p><strong>Access Token vs Refresh Token</strong>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>                    Token Lifecycle                          
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>Initial Authorization:
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>Authorization Server returns both tokens:
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>   Access Token  (short-lived: 1 hour)
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>   Refresh Token (long-lived: 30 days)
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>Using Access Token:
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a>Client  Resource Server
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a>  Header: Authorization: Bearer &lt;access_token&gt;
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a>
<a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a>Access Token Expires:
<a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a>
<a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a>                              
<a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a>     Client                                       Authorization   
<a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a>                                   Server       
<a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a>                                                 
<a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a>      POST /token                                         
<a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a>       grant_type=refresh_token                          
<a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a>       refresh_token=&lt;refresh_token&gt;                     
<a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a>       client_id &amp; client_secret                         
<a id="__codelineno-22-26" name="__codelineno-22-26" href="#__codelineno-22-26"></a>       
<a id="__codelineno-22-27" name="__codelineno-22-27" href="#__codelineno-22-27"></a>                                                          
<a id="__codelineno-22-28" name="__codelineno-22-28" href="#__codelineno-22-28"></a>      New access_token &amp; refresh_token                   
<a id="__codelineno-22-29" name="__codelineno-22-29" href="#__codelineno-22-29"></a>       
<a id="__codelineno-22-30" name="__codelineno-22-30" href="#__codelineno-22-30"></a>                                                          
<a id="__codelineno-22-31" name="__codelineno-22-31" href="#__codelineno-22-31"></a>                                                          
</code></pre></div>
<p><strong>Token Refresh Flow</strong>:
1. Access token expires
2. Client sends refresh token to authorization server
3. Server validates refresh token
4. Server issues new access token (and optionally new refresh token)
5. Client uses new access token</p>
<h4 id="jwks-json-web-key-set">JWKS (JSON Web Key Set)</h4>
<p><strong>Description</strong>: A set of public keys used to verify JWT signatures.</p>
<p><strong>Purpose</strong>:
- Allows resource servers to verify tokens without sharing secrets
- Enables key rotation without service interruption
- Supports multiple keys simultaneously</p>
<p><strong>Structure</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="p">{</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="w">  </span><span class="nt">&quot;keys&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="w">      </span><span class="nt">&quot;kty&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RSA&quot;</span><span class="p">,</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">      </span><span class="nt">&quot;use&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sig&quot;</span><span class="p">,</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w">      </span><span class="nt">&quot;kid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;key-id-1&quot;</span><span class="p">,</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w">      </span><span class="nt">&quot;n&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0vx7agoebGcQSuuPiLJXZptN9nndrQmbXEps2aiAFbWhM78LhWx...&quot;</span><span class="p">,</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w">      </span><span class="nt">&quot;e&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AQAB&quot;</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="w">      </span><span class="nt">&quot;kty&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RSA&quot;</span><span class="p">,</span>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="w">      </span><span class="nt">&quot;use&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sig&quot;</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="w">      </span><span class="nt">&quot;kid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;key-id-2&quot;</span><span class="p">,</span>
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="w">      </span><span class="nt">&quot;n&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;xjlCRBqkQxrXLhAz4rCuYn8FaEH3xPFgPAp1cYcPwzPnHdkN...&quot;</span><span class="p">,</span>
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="w">      </span><span class="nt">&quot;e&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AQAB&quot;</span>
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a><span class="w">  </span><span class="p">]</span>
<a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a><span class="p">}</span>
</code></pre></div></p>
<p><strong>How It Works</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>                              
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>  Authorization                                    Resource       
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>     Server                                         Server        
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>                              
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>                                                          
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>      (1) Publishes JWKS at                              
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>          /.well-known/jwks.json                         
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>      
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>                                                          
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>      (2) Resource server fetches                        
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>          public keys &amp; caches them                      
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>                                                          
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a>                                                          
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a>                                                           
<a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a>                                      
<a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a>     Client                                             
<a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a>                                      
<a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a>                                                          
<a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a>      (3) Request with JWT                               
<a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a>         Authorization: Bearer &lt;jwt&gt;                     
<a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a>       
<a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a>                                                          
<a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a>      (4) Resource server:                               
<a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a>          - Extracts &#39;kid&#39; from JWT header               
<a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a>          - Finds matching key in JWKS                   
<a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a>          - Verifies signature                           
<a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a>          - Validates claims (exp, aud, etc.)            
<a id="__codelineno-24-28" name="__codelineno-24-28" href="#__codelineno-24-28"></a>                                                          
<a id="__codelineno-24-29" name="__codelineno-24-29" href="#__codelineno-24-29"></a>      (5) Returns protected resource                     
<a id="__codelineno-24-30" name="__codelineno-24-30" href="#__codelineno-24-30"></a>       
<a id="__codelineno-24-31" name="__codelineno-24-31" href="#__codelineno-24-31"></a>                                                          
<a id="__codelineno-24-32" name="__codelineno-24-32" href="#__codelineno-24-32"></a>                                                          
</code></pre></div></p>
<p><strong>Benefits</strong>:
- No shared secrets between services
- Supports asymmetric encryption (public/private keys)
- Enables distributed token verification
- Allows key rotation</p>
<h3 id="pkce-proof-key-for-code-exchange">PKCE (Proof Key for Code Exchange)</h3>
<h4 id="what-is-pkce">What is PKCE?</h4>
<p><strong>PKCE</strong> (pronounced "pixy") is an extension to OAuth 2.0 Authorization Code Flow that provides additional security, especially for public clients (mobile apps, SPAs) that cannot securely store client secrets.</p>
<p><strong>Pronunciation</strong>: "pixy"<br />
<strong>RFC</strong>: RFC 7636</p>
<h4 id="why-is-pkce-needed">Why is PKCE Needed?</h4>
<p><strong>Security Vulnerabilities in Standard OAuth 2.0</strong>:</p>
<ol>
<li><strong>Authorization Code Interception</strong>: </li>
<li>Mobile apps use custom URL schemes (e.g., <code>myapp://callback</code>)</li>
<li>Malicious apps can register the same URL scheme</li>
<li>
<p>Attacker can intercept the authorization code</p>
</li>
<li>
<p><strong>No Client Secret Protection</strong>:</p>
</li>
<li>Public clients (SPAs, mobile apps) cannot securely store secrets</li>
<li>Client secrets embedded in apps can be extracted</li>
<li>Compromised secrets affect all users</li>
</ol>
<p><strong>Attack Scenario Without PKCE</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>                                          
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>  User                                                Authorization   
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a> (Mobile)                                                Server       
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>                                          
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>                                                              
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>      (1) Login request                                      
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>       
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>                                                              
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>      (2) Redirect: myapp://callback?code=AUTH_CODE          
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>      
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>                                                              
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>     X  INTERCEPTED BY MALICIOUS APP!                         
<a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a>                                                              
<a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a>                                          
<a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a>  Malicious App                                             
<a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a>  (registered                                               
<a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a>   myapp://)                                                
<a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a>                                          
<a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a>                                                              
<a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a>      (3) Exchange code for token                            
<a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a>         (no secret needed for public clients)               
<a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a>       
<a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a>                                                              
<a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a>      (4) Access token (COMPROMISED!)                        
<a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a>      
<a id="__codelineno-25-26" name="__codelineno-25-26" href="#__codelineno-25-26"></a>                                                              
<a id="__codelineno-25-27" name="__codelineno-25-27" href="#__codelineno-25-27"></a>                                                              
</code></pre></div></p>
<h4 id="how-pkce-works">How PKCE Works</h4>
<p>PKCE adds a cryptographic challenge to the authorization flow:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>                     PKCE Flow                                
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>     Client       
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>  (Mobile App)    
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>     
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>      (1) Generate code_verifier (random string)
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>          code_verifier = &quot;dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk&quot;
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>     
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>      (2) Generate code_challenge
<a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a>          code_challenge = BASE64URL(SHA256(code_verifier))
<a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>          code_challenge = &quot;E9Melhoa2OwvFrEMTJguCHaoeK1t8URWbuGJSstw-cM&quot;
<a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a>     
<a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a>      (3) Authorization request with code_challenge
<a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a>          /authorize?
<a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a>            response_type=code
<a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a>            &amp;client_id=CLIENT_ID
<a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a>            &amp;redirect_uri=myapp://callback
<a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a>            &amp;code_challenge=E9Melhoa2OwvFrEMTJguCHaoeK1t8URWbuGJSstw-cM
<a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a>            &amp;code_challenge_method=S256
<a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a>     
<a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a>     
<a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a>                              
<a id="__codelineno-26-27" name="__codelineno-26-27" href="#__codelineno-26-27"></a>  User (Browser)                                  Authorization   
<a id="__codelineno-26-28" name="__codelineno-26-28" href="#__codelineno-26-28"></a>                                   Server       
<a id="__codelineno-26-29" name="__codelineno-26-29" href="#__codelineno-26-29"></a>                                                 
<a id="__codelineno-26-30" name="__codelineno-26-30" href="#__codelineno-26-30"></a>                                                          
<a id="__codelineno-26-31" name="__codelineno-26-31" href="#__codelineno-26-31"></a>         
<a id="__codelineno-26-32" name="__codelineno-26-32" href="#__codelineno-26-32"></a>                                                          
<a id="__codelineno-26-33" name="__codelineno-26-33" href="#__codelineno-26-33"></a>                                                           (4) Store code_challenge
<a id="__codelineno-26-34" name="__codelineno-26-34" href="#__codelineno-26-34"></a>                                                               with authorization code
<a id="__codelineno-26-35" name="__codelineno-26-35" href="#__codelineno-26-35"></a>                                                          
<a id="__codelineno-26-36" name="__codelineno-26-36" href="#__codelineno-26-36"></a>      (5) Redirect: myapp://callback?code=AUTH_CODE      
<a id="__codelineno-26-37" name="__codelineno-26-37" href="#__codelineno-26-37"></a>       
<a id="__codelineno-26-38" name="__codelineno-26-38" href="#__codelineno-26-38"></a>                                                          
<a id="__codelineno-26-39" name="__codelineno-26-39" href="#__codelineno-26-39"></a>                                                          
<a id="__codelineno-26-40" name="__codelineno-26-40" href="#__codelineno-26-40"></a>                                      
<a id="__codelineno-26-41" name="__codelineno-26-41" href="#__codelineno-26-41"></a>     Client                                             
<a id="__codelineno-26-42" name="__codelineno-26-42" href="#__codelineno-26-42"></a>  (Mobile App)                                          
<a id="__codelineno-26-43" name="__codelineno-26-43" href="#__codelineno-26-43"></a>                                      
<a id="__codelineno-26-44" name="__codelineno-26-44" href="#__codelineno-26-44"></a>                                                          
<a id="__codelineno-26-45" name="__codelineno-26-45" href="#__codelineno-26-45"></a>      (6) Token request with original code_verifier      
<a id="__codelineno-26-46" name="__codelineno-26-46" href="#__codelineno-26-46"></a>          POST /token                                    
<a id="__codelineno-26-47" name="__codelineno-26-47" href="#__codelineno-26-47"></a>            grant_type=authorization_code                
<a id="__codelineno-26-48" name="__codelineno-26-48" href="#__codelineno-26-48"></a>            &amp;code=AUTH_CODE                              
<a id="__codelineno-26-49" name="__codelineno-26-49" href="#__codelineno-26-49"></a>            &amp;redirect_uri=myapp://callback               
<a id="__codelineno-26-50" name="__codelineno-26-50" href="#__codelineno-26-50"></a>            &amp;client_id=CLIENT_ID                         
<a id="__codelineno-26-51" name="__codelineno-26-51" href="#__codelineno-26-51"></a>            &amp;code_verifier=dBjftJeZ4CVP-mB92K27uhbUJU... 
<a id="__codelineno-26-52" name="__codelineno-26-52" href="#__codelineno-26-52"></a>       
<a id="__codelineno-26-53" name="__codelineno-26-53" href="#__codelineno-26-53"></a>                                                          
<a id="__codelineno-26-54" name="__codelineno-26-54" href="#__codelineno-26-54"></a>                                                           (7) Verify:
<a id="__codelineno-26-55" name="__codelineno-26-55" href="#__codelineno-26-55"></a>                                                               SHA256(code_verifier)
<a id="__codelineno-26-56" name="__codelineno-26-56" href="#__codelineno-26-56"></a>                                                               == code_challenge
<a id="__codelineno-26-57" name="__codelineno-26-57" href="#__codelineno-26-57"></a>                                                          
<a id="__codelineno-26-58" name="__codelineno-26-58" href="#__codelineno-26-58"></a>      (8) Return access_token (only if verified!)        
<a id="__codelineno-26-59" name="__codelineno-26-59" href="#__codelineno-26-59"></a>       
<a id="__codelineno-26-60" name="__codelineno-26-60" href="#__codelineno-26-60"></a>                                                          
<a id="__codelineno-26-61" name="__codelineno-26-61" href="#__codelineno-26-61"></a>                                                          
</code></pre></div>
<p><strong>PKCE Parameters</strong>:</p>
<ol>
<li><strong>code_verifier</strong>: </li>
<li>Random cryptographic string (43-128 characters)</li>
<li>Created by client, kept secret</li>
<li>
<p>Example: <code>dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk</code></p>
</li>
<li>
<p><strong>code_challenge</strong>:</p>
</li>
<li>Derived from code_verifier</li>
<li>Sent in authorization request</li>
<li>Method: <code>plain</code> or <code>S256</code> (SHA-256 hash)</li>
<li>
<p>Example: <code>BASE64URL(SHA256(code_verifier))</code></p>
</li>
<li>
<p><strong>code_challenge_method</strong>:</p>
</li>
<li><code>S256</code>: SHA-256 hash (recommended)</li>
<li><code>plain</code>: Use verifier as-is (not recommended)</li>
</ol>
<h4 id="pkce-security-benefits">PKCE Security Benefits</h4>
<p><strong>Protection Against Interception</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>Even if authorization code is intercepted:
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>  Malicious App     
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>  (has auth code)   
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>     
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>      (1) Tries to exchange code for token
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>          POST /token
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>            code=INTERCEPTED_CODE
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a>            client_id=CLIENT_ID
<a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>            (no code_verifier!)
<a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a>     
<a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a>     
<a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a>
<a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a>  Authorization   
<a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a>     Server       
<a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a>
<a id="__codelineno-27-19" name="__codelineno-27-19" href="#__codelineno-27-19"></a>     
<a id="__codelineno-27-20" name="__codelineno-27-20" href="#__codelineno-27-20"></a>      (2) REJECTED!
<a id="__codelineno-27-21" name="__codelineno-27-21" href="#__codelineno-27-21"></a>          - Missing code_verifier
<a id="__codelineno-27-22" name="__codelineno-27-22" href="#__codelineno-27-22"></a>          - OR wrong code_verifier
<a id="__codelineno-27-23" name="__codelineno-27-23" href="#__codelineno-27-23"></a>          - Cannot generate valid code_challenge
<a id="__codelineno-27-24" name="__codelineno-27-24" href="#__codelineno-27-24"></a>     
<a id="__codelineno-27-25" name="__codelineno-27-25" href="#__codelineno-27-25"></a>     
<a id="__codelineno-27-26" name="__codelineno-27-26" href="#__codelineno-27-26"></a>     X  Attack prevented!
</code></pre></div></p>
<p><strong>Key Security Properties</strong>:</p>
<ol>
<li><strong>Dynamic Secret</strong>: </li>
<li>New code_verifier for each authorization flow</li>
<li>
<p>Cannot be pre-computed or reused</p>
</li>
<li>
<p><strong>One-way Function</strong>:</p>
</li>
<li>code_challenge derived from code_verifier (SHA-256)</li>
<li>
<p>Cannot reverse-engineer verifier from challenge</p>
</li>
<li>
<p><strong>Client Binding</strong>:</p>
</li>
<li>Only the client that started the flow can complete it</li>
<li>
<p>Intercepted code is useless without verifier</p>
</li>
<li>
<p><strong>No Shared Secrets</strong>:</p>
</li>
<li>No client_secret needed</li>
<li>Perfect for public clients</li>
</ol>
<h4 id="pkce-vs-standard-oauth-20">PKCE vs Standard OAuth 2.0</h4>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Standard OAuth 2.0</th>
<th>OAuth 2.0 + PKCE</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Client Secret</strong></td>
<td>Required for confidential clients</td>
<td>Not required</td>
</tr>
<tr>
<td><strong>Code Interception</strong></td>
<td>Vulnerable</td>
<td>Protected</td>
</tr>
<tr>
<td><strong>Public Clients</strong></td>
<td>Less secure</td>
<td>Highly secure</td>
</tr>
<tr>
<td><strong>Mobile Apps</strong></td>
<td>Risky</td>
<td>Recommended</td>
</tr>
<tr>
<td><strong>SPAs</strong></td>
<td>Implicit flow (deprecated)</td>
<td>Authorization Code + PKCE</td>
</tr>
<tr>
<td><strong>Complexity</strong></td>
<td>Simpler</td>
<td>Slightly more complex</td>
</tr>
<tr>
<td><strong>Security</strong></td>
<td>Good for confidential clients</td>
<td>Excellent for all clients</td>
</tr>
</tbody>
</table>
<h4 id="when-to-use-pkce">When to Use PKCE</h4>
<p> <strong>Always Use PKCE For</strong>:
- Mobile applications (iOS, Android)
- Single Page Applications (SPAs)
- Desktop applications
- Any public client that cannot securely store secrets</p>
<p> <strong>Recommended Even For</strong>:
- Server-side web applications (defense in depth)
- All new OAuth 2.0 implementations</p>
<p> <strong>Not Applicable For</strong>:
- Client Credentials flow (no user interaction)
- Resource Owner Password flow (deprecated)</p>
<h4 id="implementation-example">Implementation Example</h4>
<p><strong>Step 1: Generate Code Verifier and Challenge</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c1">// Generate code_verifier (random string)</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="kd">function</span><span class="w"> </span><span class="nx">generateCodeVerifier</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">array</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Uint8Array</span><span class="p">(</span><span class="mf">32</span><span class="p">);</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="w">  </span><span class="nx">crypto</span><span class="p">.</span><span class="nx">getRandomValues</span><span class="p">(</span><span class="nx">array</span><span class="p">);</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">base64URLEncode</span><span class="p">(</span><span class="nx">array</span><span class="p">);</span>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="p">}</span>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="c1">// Generate code_challenge from verifier</span>
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">generateCodeChallenge</span><span class="p">(</span><span class="nx">verifier</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">encoder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">TextEncoder</span><span class="p">();</span>
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">encoder</span><span class="p">.</span><span class="nx">encode</span><span class="p">(</span><span class="nx">verifier</span><span class="p">);</span>
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">crypto</span><span class="p">.</span><span class="nx">subtle</span><span class="p">.</span><span class="nx">digest</span><span class="p">(</span><span class="s1">&#39;SHA-256&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">);</span>
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">base64URLEncode</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nb">Uint8Array</span><span class="p">(</span><span class="nx">hash</span><span class="p">));</span>
<a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a><span class="p">}</span>
</code></pre></div></p>
<p><strong>Step 2: Authorization Request</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="err">GET /authorize?</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="err">  response_type=code&amp;</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="err">  client_id=YOUR_CLIENT_ID&amp;</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="err">  redirect_uri=https://yourapp.com/callback&amp;</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="err">  scope=read:user&amp;</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="err">  state=random_state&amp;</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="err">  code_challenge=E9Melhoa2OwvFrEMTJguCHaoeK1t8URWbuGJSstw-cM&amp;</span>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="err">  code_challenge_method=S256</span>
</code></pre></div></p>
<p><strong>Step 3: Token Request</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="err">POST /token</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="err">Content-Type: application/x-www-form-urlencoded</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="err">grant_type=authorization_code&amp;</span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="err">code=AUTHORIZATION_CODE&amp;</span>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="err">redirect_uri=https://yourapp.com/callback&amp;</span>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a><span class="err">client_id=YOUR_CLIENT_ID&amp;</span>
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a><span class="err">code_verifier=dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk</span>
</code></pre></div></p>
<h4 id="summary">Summary</h4>
<p>PKCE is a critical security enhancement for OAuth 2.0 that:
-  Prevents authorization code interception attacks
-  Eliminates need for client secrets in public clients
-  Provides cryptographic binding between authorization and token requests
-  Is now recommended for ALL OAuth 2.0 clients
-  Is mandatory for SPAs and mobile apps</p>
<p><strong>Best Practice</strong>: Always use PKCE with Authorization Code flow for modern applications.</p>
<h4 id="complete-python-implementation">Complete Python Implementation</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">secrets</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlencode</span><span class="p">,</span> <span class="n">urlparse</span><span class="p">,</span> <span class="n">parse_qs</span>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">jsonify</span>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_hex</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a>
<a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a><span class="c1"># OAuth 2.0 Configuration</span>
<a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a><span class="n">CLIENT_ID</span> <span class="o">=</span> <span class="s1">&#39;your_client_id&#39;</span>
<a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a><span class="n">AUTHORIZATION_URL</span> <span class="o">=</span> <span class="s1">&#39;https://auth-server.com/oauth/authorize&#39;</span>
<a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a><span class="n">TOKEN_URL</span> <span class="o">=</span> <span class="s1">&#39;https://auth-server.com/oauth/token&#39;</span>
<a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a><span class="n">REDIRECT_URI</span> <span class="o">=</span> <span class="s1">&#39;http://localhost:5000/callback&#39;</span>
<a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a><span class="n">SCOPE</span> <span class="o">=</span> <span class="s1">&#39;read:user write:user&#39;</span>
<a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a>
<a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a><span class="k">class</span><span class="w"> </span><span class="nc">PKCEHelper</span><span class="p">:</span>
<a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper class for PKCE implementation&quot;&quot;&quot;</span>
<a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a>
<a id="__codelineno-31-21" name="__codelineno-31-21" href="#__codelineno-31-21"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-31-22" name="__codelineno-31-22" href="#__codelineno-31-22"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_code_verifier</span><span class="p">(</span><span class="n">length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-31-23" name="__codelineno-31-23" href="#__codelineno-31-23"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a cryptographically random code verifier.</span>
<a id="__codelineno-31-24" name="__codelineno-31-24" href="#__codelineno-31-24"></a>
<a id="__codelineno-31-25" name="__codelineno-31-25" href="#__codelineno-31-25"></a><span class="sd">        Args:</span>
<a id="__codelineno-31-26" name="__codelineno-31-26" href="#__codelineno-31-26"></a><span class="sd">            length: Length of verifier (43-128 characters)</span>
<a id="__codelineno-31-27" name="__codelineno-31-27" href="#__codelineno-31-27"></a>
<a id="__codelineno-31-28" name="__codelineno-31-28" href="#__codelineno-31-28"></a><span class="sd">        Returns:</span>
<a id="__codelineno-31-29" name="__codelineno-31-29" href="#__codelineno-31-29"></a><span class="sd">            URL-safe base64 encoded string</span>
<a id="__codelineno-31-30" name="__codelineno-31-30" href="#__codelineno-31-30"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-31-31" name="__codelineno-31-31" href="#__codelineno-31-31"></a>        <span class="k">if</span> <span class="n">length</span> <span class="o">&lt;</span> <span class="mi">43</span> <span class="ow">or</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="mi">128</span><span class="p">:</span>
<a id="__codelineno-31-32" name="__codelineno-31-32" href="#__codelineno-31-32"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Code verifier length must be between 43 and 128&#39;</span><span class="p">)</span>
<a id="__codelineno-31-33" name="__codelineno-31-33" href="#__codelineno-31-33"></a>
<a id="__codelineno-31-34" name="__codelineno-31-34" href="#__codelineno-31-34"></a>        <span class="c1"># Generate random bytes</span>
<a id="__codelineno-31-35" name="__codelineno-31-35" href="#__codelineno-31-35"></a>        <span class="n">random_bytes</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_bytes</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
<a id="__codelineno-31-36" name="__codelineno-31-36" href="#__codelineno-31-36"></a>
<a id="__codelineno-31-37" name="__codelineno-31-37" href="#__codelineno-31-37"></a>        <span class="c1"># Base64 URL encode (without padding)</span>
<a id="__codelineno-31-38" name="__codelineno-31-38" href="#__codelineno-31-38"></a>        <span class="n">code_verifier</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">urlsafe_b64encode</span><span class="p">(</span><span class="n">random_bytes</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<a id="__codelineno-31-39" name="__codelineno-31-39" href="#__codelineno-31-39"></a>        <span class="n">code_verifier</span> <span class="o">=</span> <span class="n">code_verifier</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
<a id="__codelineno-31-40" name="__codelineno-31-40" href="#__codelineno-31-40"></a>
<a id="__codelineno-31-41" name="__codelineno-31-41" href="#__codelineno-31-41"></a>        <span class="c1"># Ensure length is within bounds</span>
<a id="__codelineno-31-42" name="__codelineno-31-42" href="#__codelineno-31-42"></a>        <span class="k">return</span> <span class="n">code_verifier</span><span class="p">[:</span><span class="n">length</span><span class="p">]</span>
<a id="__codelineno-31-43" name="__codelineno-31-43" href="#__codelineno-31-43"></a>
<a id="__codelineno-31-44" name="__codelineno-31-44" href="#__codelineno-31-44"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-31-45" name="__codelineno-31-45" href="#__codelineno-31-45"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_code_challenge</span><span class="p">(</span><span class="n">code_verifier</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;S256&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-31-46" name="__codelineno-31-46" href="#__codelineno-31-46"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate code challenge from verifier.</span>
<a id="__codelineno-31-47" name="__codelineno-31-47" href="#__codelineno-31-47"></a>
<a id="__codelineno-31-48" name="__codelineno-31-48" href="#__codelineno-31-48"></a><span class="sd">        Args:</span>
<a id="__codelineno-31-49" name="__codelineno-31-49" href="#__codelineno-31-49"></a><span class="sd">            code_verifier: The code verifier string</span>
<a id="__codelineno-31-50" name="__codelineno-31-50" href="#__codelineno-31-50"></a><span class="sd">            method: &#39;S256&#39; (SHA-256) or &#39;plain&#39;</span>
<a id="__codelineno-31-51" name="__codelineno-31-51" href="#__codelineno-31-51"></a>
<a id="__codelineno-31-52" name="__codelineno-31-52" href="#__codelineno-31-52"></a><span class="sd">        Returns:</span>
<a id="__codelineno-31-53" name="__codelineno-31-53" href="#__codelineno-31-53"></a><span class="sd">            Code challenge string</span>
<a id="__codelineno-31-54" name="__codelineno-31-54" href="#__codelineno-31-54"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-31-55" name="__codelineno-31-55" href="#__codelineno-31-55"></a>        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;S256&#39;</span><span class="p">:</span>
<a id="__codelineno-31-56" name="__codelineno-31-56" href="#__codelineno-31-56"></a>            <span class="c1"># SHA-256 hash</span>
<a id="__codelineno-31-57" name="__codelineno-31-57" href="#__codelineno-31-57"></a>            <span class="n">digest</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">code_verifier</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
<a id="__codelineno-31-58" name="__codelineno-31-58" href="#__codelineno-31-58"></a>            <span class="c1"># Base64 URL encode (without padding)</span>
<a id="__codelineno-31-59" name="__codelineno-31-59" href="#__codelineno-31-59"></a>            <span class="n">code_challenge</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">urlsafe_b64encode</span><span class="p">(</span><span class="n">digest</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<a id="__codelineno-31-60" name="__codelineno-31-60" href="#__codelineno-31-60"></a>            <span class="k">return</span> <span class="n">code_challenge</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
<a id="__codelineno-31-61" name="__codelineno-31-61" href="#__codelineno-31-61"></a>        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;plain&#39;</span><span class="p">:</span>
<a id="__codelineno-31-62" name="__codelineno-31-62" href="#__codelineno-31-62"></a>            <span class="c1"># Use verifier as-is (not recommended)</span>
<a id="__codelineno-31-63" name="__codelineno-31-63" href="#__codelineno-31-63"></a>            <span class="k">return</span> <span class="n">code_verifier</span>
<a id="__codelineno-31-64" name="__codelineno-31-64" href="#__codelineno-31-64"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-31-65" name="__codelineno-31-65" href="#__codelineno-31-65"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unsupported method: </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-31-66" name="__codelineno-31-66" href="#__codelineno-31-66"></a>
<a id="__codelineno-31-67" name="__codelineno-31-67" href="#__codelineno-31-67"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">)</span>
<a id="__codelineno-31-68" name="__codelineno-31-68" href="#__codelineno-31-68"></a><span class="k">def</span><span class="w"> </span><span class="nf">login</span><span class="p">():</span>
<a id="__codelineno-31-69" name="__codelineno-31-69" href="#__codelineno-31-69"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initiate OAuth 2.0 with PKCE flow&quot;&quot;&quot;</span>
<a id="__codelineno-31-70" name="__codelineno-31-70" href="#__codelineno-31-70"></a>    <span class="c1"># Generate PKCE parameters</span>
<a id="__codelineno-31-71" name="__codelineno-31-71" href="#__codelineno-31-71"></a>    <span class="n">code_verifier</span> <span class="o">=</span> <span class="n">PKCEHelper</span><span class="o">.</span><span class="n">generate_code_verifier</span><span class="p">()</span>
<a id="__codelineno-31-72" name="__codelineno-31-72" href="#__codelineno-31-72"></a>    <span class="n">code_challenge</span> <span class="o">=</span> <span class="n">PKCEHelper</span><span class="o">.</span><span class="n">generate_code_challenge</span><span class="p">(</span><span class="n">code_verifier</span><span class="p">,</span> <span class="s1">&#39;S256&#39;</span><span class="p">)</span>
<a id="__codelineno-31-73" name="__codelineno-31-73" href="#__codelineno-31-73"></a>
<a id="__codelineno-31-74" name="__codelineno-31-74" href="#__codelineno-31-74"></a>    <span class="c1"># Store code_verifier in session (needed for token exchange)</span>
<a id="__codelineno-31-75" name="__codelineno-31-75" href="#__codelineno-31-75"></a>    <span class="n">session</span><span class="p">[</span><span class="s1">&#39;code_verifier&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">code_verifier</span>
<a id="__codelineno-31-76" name="__codelineno-31-76" href="#__codelineno-31-76"></a>
<a id="__codelineno-31-77" name="__codelineno-31-77" href="#__codelineno-31-77"></a>    <span class="c1"># Generate state for CSRF protection</span>
<a id="__codelineno-31-78" name="__codelineno-31-78" href="#__codelineno-31-78"></a>    <span class="n">state</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_urlsafe</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
<a id="__codelineno-31-79" name="__codelineno-31-79" href="#__codelineno-31-79"></a>    <span class="n">session</span><span class="p">[</span><span class="s1">&#39;oauth_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span>
<a id="__codelineno-31-80" name="__codelineno-31-80" href="#__codelineno-31-80"></a>
<a id="__codelineno-31-81" name="__codelineno-31-81" href="#__codelineno-31-81"></a>    <span class="c1"># Build authorization URL with PKCE parameters</span>
<a id="__codelineno-31-82" name="__codelineno-31-82" href="#__codelineno-31-82"></a>    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-31-83" name="__codelineno-31-83" href="#__codelineno-31-83"></a>        <span class="s1">&#39;response_type&#39;</span><span class="p">:</span> <span class="s1">&#39;code&#39;</span><span class="p">,</span>
<a id="__codelineno-31-84" name="__codelineno-31-84" href="#__codelineno-31-84"></a>        <span class="s1">&#39;client_id&#39;</span><span class="p">:</span> <span class="n">CLIENT_ID</span><span class="p">,</span>
<a id="__codelineno-31-85" name="__codelineno-31-85" href="#__codelineno-31-85"></a>        <span class="s1">&#39;redirect_uri&#39;</span><span class="p">:</span> <span class="n">REDIRECT_URI</span><span class="p">,</span>
<a id="__codelineno-31-86" name="__codelineno-31-86" href="#__codelineno-31-86"></a>        <span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="n">SCOPE</span><span class="p">,</span>
<a id="__codelineno-31-87" name="__codelineno-31-87" href="#__codelineno-31-87"></a>        <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="n">state</span><span class="p">,</span>
<a id="__codelineno-31-88" name="__codelineno-31-88" href="#__codelineno-31-88"></a>        <span class="s1">&#39;code_challenge&#39;</span><span class="p">:</span> <span class="n">code_challenge</span><span class="p">,</span>
<a id="__codelineno-31-89" name="__codelineno-31-89" href="#__codelineno-31-89"></a>        <span class="s1">&#39;code_challenge_method&#39;</span><span class="p">:</span> <span class="s1">&#39;S256&#39;</span>
<a id="__codelineno-31-90" name="__codelineno-31-90" href="#__codelineno-31-90"></a>    <span class="p">}</span>
<a id="__codelineno-31-91" name="__codelineno-31-91" href="#__codelineno-31-91"></a>
<a id="__codelineno-31-92" name="__codelineno-31-92" href="#__codelineno-31-92"></a>    <span class="n">authorization_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">AUTHORIZATION_URL</span><span class="si">}</span><span class="s2">?</span><span class="si">{</span><span class="n">urlencode</span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-31-93" name="__codelineno-31-93" href="#__codelineno-31-93"></a>    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">authorization_url</span><span class="p">)</span>
<a id="__codelineno-31-94" name="__codelineno-31-94" href="#__codelineno-31-94"></a>
<a id="__codelineno-31-95" name="__codelineno-31-95" href="#__codelineno-31-95"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/callback&#39;</span><span class="p">)</span>
<a id="__codelineno-31-96" name="__codelineno-31-96" href="#__codelineno-31-96"></a><span class="k">def</span><span class="w"> </span><span class="nf">callback</span><span class="p">():</span>
<a id="__codelineno-31-97" name="__codelineno-31-97" href="#__codelineno-31-97"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Handle OAuth callback and exchange code for token with PKCE&quot;&quot;&quot;</span>
<a id="__codelineno-31-98" name="__codelineno-31-98" href="#__codelineno-31-98"></a>    <span class="c1"># Verify state parameter</span>
<a id="__codelineno-31-99" name="__codelineno-31-99" href="#__codelineno-31-99"></a>    <span class="n">state</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">)</span>
<a id="__codelineno-31-100" name="__codelineno-31-100" href="#__codelineno-31-100"></a>    <span class="k">if</span> <span class="n">state</span> <span class="o">!=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;oauth_state&#39;</span><span class="p">):</span>
<a id="__codelineno-31-101" name="__codelineno-31-101" href="#__codelineno-31-101"></a>        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Invalid state parameter&#39;</span><span class="p">}),</span> <span class="mi">400</span>
<a id="__codelineno-31-102" name="__codelineno-31-102" href="#__codelineno-31-102"></a>
<a id="__codelineno-31-103" name="__codelineno-31-103" href="#__codelineno-31-103"></a>    <span class="c1"># Get authorization code</span>
<a id="__codelineno-31-104" name="__codelineno-31-104" href="#__codelineno-31-104"></a>    <span class="n">code</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;code&#39;</span><span class="p">)</span>
<a id="__codelineno-31-105" name="__codelineno-31-105" href="#__codelineno-31-105"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">code</span><span class="p">:</span>
<a id="__codelineno-31-106" name="__codelineno-31-106" href="#__codelineno-31-106"></a>        <span class="n">error</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown error&#39;</span><span class="p">)</span>
<a id="__codelineno-31-107" name="__codelineno-31-107" href="#__codelineno-31-107"></a>        <span class="n">error_description</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error_description&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-31-108" name="__codelineno-31-108" href="#__codelineno-31-108"></a>        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
<a id="__codelineno-31-109" name="__codelineno-31-109" href="#__codelineno-31-109"></a>            <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="n">error</span><span class="p">,</span>
<a id="__codelineno-31-110" name="__codelineno-31-110" href="#__codelineno-31-110"></a>            <span class="s1">&#39;error_description&#39;</span><span class="p">:</span> <span class="n">error_description</span>
<a id="__codelineno-31-111" name="__codelineno-31-111" href="#__codelineno-31-111"></a>        <span class="p">}),</span> <span class="mi">400</span>
<a id="__codelineno-31-112" name="__codelineno-31-112" href="#__codelineno-31-112"></a>
<a id="__codelineno-31-113" name="__codelineno-31-113" href="#__codelineno-31-113"></a>    <span class="c1"># Retrieve code_verifier from session</span>
<a id="__codelineno-31-114" name="__codelineno-31-114" href="#__codelineno-31-114"></a>    <span class="n">code_verifier</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;code_verifier&#39;</span><span class="p">)</span>
<a id="__codelineno-31-115" name="__codelineno-31-115" href="#__codelineno-31-115"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">code_verifier</span><span class="p">:</span>
<a id="__codelineno-31-116" name="__codelineno-31-116" href="#__codelineno-31-116"></a>        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Missing code verifier&#39;</span><span class="p">}),</span> <span class="mi">400</span>
<a id="__codelineno-31-117" name="__codelineno-31-117" href="#__codelineno-31-117"></a>
<a id="__codelineno-31-118" name="__codelineno-31-118" href="#__codelineno-31-118"></a>    <span class="c1"># Exchange authorization code for access token with code_verifier</span>
<a id="__codelineno-31-119" name="__codelineno-31-119" href="#__codelineno-31-119"></a>    <span class="n">token_data</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-31-120" name="__codelineno-31-120" href="#__codelineno-31-120"></a>        <span class="s1">&#39;grant_type&#39;</span><span class="p">:</span> <span class="s1">&#39;authorization_code&#39;</span><span class="p">,</span>
<a id="__codelineno-31-121" name="__codelineno-31-121" href="#__codelineno-31-121"></a>        <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="n">code</span><span class="p">,</span>
<a id="__codelineno-31-122" name="__codelineno-31-122" href="#__codelineno-31-122"></a>        <span class="s1">&#39;redirect_uri&#39;</span><span class="p">:</span> <span class="n">REDIRECT_URI</span><span class="p">,</span>
<a id="__codelineno-31-123" name="__codelineno-31-123" href="#__codelineno-31-123"></a>        <span class="s1">&#39;client_id&#39;</span><span class="p">:</span> <span class="n">CLIENT_ID</span><span class="p">,</span>
<a id="__codelineno-31-124" name="__codelineno-31-124" href="#__codelineno-31-124"></a>        <span class="s1">&#39;code_verifier&#39;</span><span class="p">:</span> <span class="n">code_verifier</span>  <span class="c1"># PKCE parameter</span>
<a id="__codelineno-31-125" name="__codelineno-31-125" href="#__codelineno-31-125"></a>    <span class="p">}</span>
<a id="__codelineno-31-126" name="__codelineno-31-126" href="#__codelineno-31-126"></a>
<a id="__codelineno-31-127" name="__codelineno-31-127" href="#__codelineno-31-127"></a>    <span class="c1"># Note: No client_secret needed for public clients with PKCE!</span>
<a id="__codelineno-31-128" name="__codelineno-31-128" href="#__codelineno-31-128"></a>
<a id="__codelineno-31-129" name="__codelineno-31-129" href="#__codelineno-31-129"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">TOKEN_URL</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">token_data</span><span class="p">)</span>
<a id="__codelineno-31-130" name="__codelineno-31-130" href="#__codelineno-31-130"></a>
<a id="__codelineno-31-131" name="__codelineno-31-131" href="#__codelineno-31-131"></a>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
<a id="__codelineno-31-132" name="__codelineno-31-132" href="#__codelineno-31-132"></a>        <span class="n">tokens</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<a id="__codelineno-31-133" name="__codelineno-31-133" href="#__codelineno-31-133"></a>
<a id="__codelineno-31-134" name="__codelineno-31-134" href="#__codelineno-31-134"></a>        <span class="c1"># Clear PKCE parameters from session</span>
<a id="__codelineno-31-135" name="__codelineno-31-135" href="#__codelineno-31-135"></a>        <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;code_verifier&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-31-136" name="__codelineno-31-136" href="#__codelineno-31-136"></a>        <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;oauth_state&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-31-137" name="__codelineno-31-137" href="#__codelineno-31-137"></a>
<a id="__codelineno-31-138" name="__codelineno-31-138" href="#__codelineno-31-138"></a>        <span class="c1"># Store tokens securely</span>
<a id="__codelineno-31-139" name="__codelineno-31-139" href="#__codelineno-31-139"></a>        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;access_token&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="s1">&#39;access_token&#39;</span><span class="p">]</span>
<a id="__codelineno-31-140" name="__codelineno-31-140" href="#__codelineno-31-140"></a>        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;refresh_token&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tokens</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;refresh_token&#39;</span><span class="p">)</span>
<a id="__codelineno-31-141" name="__codelineno-31-141" href="#__codelineno-31-141"></a>
<a id="__codelineno-31-142" name="__codelineno-31-142" href="#__codelineno-31-142"></a>        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
<a id="__codelineno-31-143" name="__codelineno-31-143" href="#__codelineno-31-143"></a>            <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Authentication successful&#39;</span><span class="p">,</span>
<a id="__codelineno-31-144" name="__codelineno-31-144" href="#__codelineno-31-144"></a>            <span class="s1">&#39;access_token&#39;</span><span class="p">:</span> <span class="n">tokens</span><span class="p">[</span><span class="s1">&#39;access_token&#39;</span><span class="p">][:</span><span class="mi">20</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;...&#39;</span><span class="p">,</span>  <span class="c1"># Truncated for display</span>
<a id="__codelineno-31-145" name="__codelineno-31-145" href="#__codelineno-31-145"></a>            <span class="s1">&#39;token_type&#39;</span><span class="p">:</span> <span class="n">tokens</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;token_type&#39;</span><span class="p">,</span> <span class="s1">&#39;Bearer&#39;</span><span class="p">),</span>
<a id="__codelineno-31-146" name="__codelineno-31-146" href="#__codelineno-31-146"></a>            <span class="s1">&#39;expires_in&#39;</span><span class="p">:</span> <span class="n">tokens</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;expires_in&#39;</span><span class="p">)</span>
<a id="__codelineno-31-147" name="__codelineno-31-147" href="#__codelineno-31-147"></a>        <span class="p">})</span>
<a id="__codelineno-31-148" name="__codelineno-31-148" href="#__codelineno-31-148"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-31-149" name="__codelineno-31-149" href="#__codelineno-31-149"></a>        <span class="n">error_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<a id="__codelineno-31-150" name="__codelineno-31-150" href="#__codelineno-31-150"></a>        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
<a id="__codelineno-31-151" name="__codelineno-31-151" href="#__codelineno-31-151"></a>            <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Token exchange failed&#39;</span><span class="p">,</span>
<a id="__codelineno-31-152" name="__codelineno-31-152" href="#__codelineno-31-152"></a>            <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="n">error_data</span>
<a id="__codelineno-31-153" name="__codelineno-31-153" href="#__codelineno-31-153"></a>        <span class="p">}),</span> <span class="mi">400</span>
<a id="__codelineno-31-154" name="__codelineno-31-154" href="#__codelineno-31-154"></a>
<a id="__codelineno-31-155" name="__codelineno-31-155" href="#__codelineno-31-155"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/protected&#39;</span><span class="p">)</span>
<a id="__codelineno-31-156" name="__codelineno-31-156" href="#__codelineno-31-156"></a><span class="k">def</span><span class="w"> </span><span class="nf">protected_resource</span><span class="p">():</span>
<a id="__codelineno-31-157" name="__codelineno-31-157" href="#__codelineno-31-157"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Access protected resource using access token&quot;&quot;&quot;</span>
<a id="__codelineno-31-158" name="__codelineno-31-158" href="#__codelineno-31-158"></a>    <span class="n">access_token</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;access_token&#39;</span><span class="p">)</span>
<a id="__codelineno-31-159" name="__codelineno-31-159" href="#__codelineno-31-159"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">access_token</span><span class="p">:</span>
<a id="__codelineno-31-160" name="__codelineno-31-160" href="#__codelineno-31-160"></a>        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Not authenticated&#39;</span><span class="p">}),</span> <span class="mi">401</span>
<a id="__codelineno-31-161" name="__codelineno-31-161" href="#__codelineno-31-161"></a>
<a id="__codelineno-31-162" name="__codelineno-31-162" href="#__codelineno-31-162"></a>    <span class="c1"># Call protected API</span>
<a id="__codelineno-31-163" name="__codelineno-31-163" href="#__codelineno-31-163"></a>    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Bearer </span><span class="si">{</span><span class="n">access_token</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">}</span>
<a id="__codelineno-31-164" name="__codelineno-31-164" href="#__codelineno-31-164"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://api-server.com/user&#39;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<a id="__codelineno-31-165" name="__codelineno-31-165" href="#__codelineno-31-165"></a>
<a id="__codelineno-31-166" name="__codelineno-31-166" href="#__codelineno-31-166"></a>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
<a id="__codelineno-31-167" name="__codelineno-31-167" href="#__codelineno-31-167"></a>        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<a id="__codelineno-31-168" name="__codelineno-31-168" href="#__codelineno-31-168"></a>    <span class="k">elif</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
<a id="__codelineno-31-169" name="__codelineno-31-169" href="#__codelineno-31-169"></a>        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Token expired or invalid&#39;</span><span class="p">}),</span> <span class="mi">401</span>
<a id="__codelineno-31-170" name="__codelineno-31-170" href="#__codelineno-31-170"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-31-171" name="__codelineno-31-171" href="#__codelineno-31-171"></a>        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;API call failed&#39;</span><span class="p">}),</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>
<a id="__codelineno-31-172" name="__codelineno-31-172" href="#__codelineno-31-172"></a>
<a id="__codelineno-31-173" name="__codelineno-31-173" href="#__codelineno-31-173"></a><span class="c1"># Standalone PKCE Client for Mobile/Desktop Apps</span>
<a id="__codelineno-31-174" name="__codelineno-31-174" href="#__codelineno-31-174"></a><span class="k">class</span><span class="w"> </span><span class="nc">PKCEOAuthClient</span><span class="p">:</span>
<a id="__codelineno-31-175" name="__codelineno-31-175" href="#__codelineno-31-175"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Complete PKCE OAuth 2.0 client for public applications&quot;&quot;&quot;</span>
<a id="__codelineno-31-176" name="__codelineno-31-176" href="#__codelineno-31-176"></a>
<a id="__codelineno-31-177" name="__codelineno-31-177" href="#__codelineno-31-177"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">authorization_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-31-178" name="__codelineno-31-178" href="#__codelineno-31-178"></a>                 <span class="n">token_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">redirect_uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-31-179" name="__codelineno-31-179" href="#__codelineno-31-179"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span> <span class="o">=</span> <span class="n">client_id</span>
<a id="__codelineno-31-180" name="__codelineno-31-180" href="#__codelineno-31-180"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">authorization_url</span> <span class="o">=</span> <span class="n">authorization_url</span>
<a id="__codelineno-31-181" name="__codelineno-31-181" href="#__codelineno-31-181"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">token_url</span> <span class="o">=</span> <span class="n">token_url</span>
<a id="__codelineno-31-182" name="__codelineno-31-182" href="#__codelineno-31-182"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">redirect_uri</span> <span class="o">=</span> <span class="n">redirect_uri</span>
<a id="__codelineno-31-183" name="__codelineno-31-183" href="#__codelineno-31-183"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">code_verifier</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-31-184" name="__codelineno-31-184" href="#__codelineno-31-184"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">access_token</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-31-185" name="__codelineno-31-185" href="#__codelineno-31-185"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_token</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-31-186" name="__codelineno-31-186" href="#__codelineno-31-186"></a>
<a id="__codelineno-31-187" name="__codelineno-31-187" href="#__codelineno-31-187"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_authorization_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-31-188" name="__codelineno-31-188" href="#__codelineno-31-188"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate authorization URL with PKCE parameters&quot;&quot;&quot;</span>
<a id="__codelineno-31-189" name="__codelineno-31-189" href="#__codelineno-31-189"></a>        <span class="c1"># Generate PKCE parameters</span>
<a id="__codelineno-31-190" name="__codelineno-31-190" href="#__codelineno-31-190"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">code_verifier</span> <span class="o">=</span> <span class="n">PKCEHelper</span><span class="o">.</span><span class="n">generate_code_verifier</span><span class="p">()</span>
<a id="__codelineno-31-191" name="__codelineno-31-191" href="#__codelineno-31-191"></a>        <span class="n">code_challenge</span> <span class="o">=</span> <span class="n">PKCEHelper</span><span class="o">.</span><span class="n">generate_code_challenge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code_verifier</span><span class="p">)</span>
<a id="__codelineno-31-192" name="__codelineno-31-192" href="#__codelineno-31-192"></a>
<a id="__codelineno-31-193" name="__codelineno-31-193" href="#__codelineno-31-193"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">state</span><span class="p">:</span>
<a id="__codelineno-31-194" name="__codelineno-31-194" href="#__codelineno-31-194"></a>            <span class="n">state</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_urlsafe</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
<a id="__codelineno-31-195" name="__codelineno-31-195" href="#__codelineno-31-195"></a>
<a id="__codelineno-31-196" name="__codelineno-31-196" href="#__codelineno-31-196"></a>        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-31-197" name="__codelineno-31-197" href="#__codelineno-31-197"></a>            <span class="s1">&#39;response_type&#39;</span><span class="p">:</span> <span class="s1">&#39;code&#39;</span><span class="p">,</span>
<a id="__codelineno-31-198" name="__codelineno-31-198" href="#__codelineno-31-198"></a>            <span class="s1">&#39;client_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span><span class="p">,</span>
<a id="__codelineno-31-199" name="__codelineno-31-199" href="#__codelineno-31-199"></a>            <span class="s1">&#39;redirect_uri&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">redirect_uri</span><span class="p">,</span>
<a id="__codelineno-31-200" name="__codelineno-31-200" href="#__codelineno-31-200"></a>            <span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="n">scope</span><span class="p">,</span>
<a id="__codelineno-31-201" name="__codelineno-31-201" href="#__codelineno-31-201"></a>            <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="n">state</span><span class="p">,</span>
<a id="__codelineno-31-202" name="__codelineno-31-202" href="#__codelineno-31-202"></a>            <span class="s1">&#39;code_challenge&#39;</span><span class="p">:</span> <span class="n">code_challenge</span><span class="p">,</span>
<a id="__codelineno-31-203" name="__codelineno-31-203" href="#__codelineno-31-203"></a>            <span class="s1">&#39;code_challenge_method&#39;</span><span class="p">:</span> <span class="s1">&#39;S256&#39;</span>
<a id="__codelineno-31-204" name="__codelineno-31-204" href="#__codelineno-31-204"></a>        <span class="p">}</span>
<a id="__codelineno-31-205" name="__codelineno-31-205" href="#__codelineno-31-205"></a>
<a id="__codelineno-31-206" name="__codelineno-31-206" href="#__codelineno-31-206"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">authorization_url</span><span class="si">}</span><span class="s2">?</span><span class="si">{</span><span class="n">urlencode</span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">state</span>
<a id="__codelineno-31-207" name="__codelineno-31-207" href="#__codelineno-31-207"></a>
<a id="__codelineno-31-208" name="__codelineno-31-208" href="#__codelineno-31-208"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">exchange_code_for_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">authorization_code</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-31-209" name="__codelineno-31-209" href="#__codelineno-31-209"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Exchange authorization code for access token using PKCE&quot;&quot;&quot;</span>
<a id="__codelineno-31-210" name="__codelineno-31-210" href="#__codelineno-31-210"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">code_verifier</span><span class="p">:</span>
<a id="__codelineno-31-211" name="__codelineno-31-211" href="#__codelineno-31-211"></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;No code verifier available. Call get_authorization_url first.&#39;</span><span class="p">)</span>
<a id="__codelineno-31-212" name="__codelineno-31-212" href="#__codelineno-31-212"></a>
<a id="__codelineno-31-213" name="__codelineno-31-213" href="#__codelineno-31-213"></a>        <span class="n">token_data</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-31-214" name="__codelineno-31-214" href="#__codelineno-31-214"></a>            <span class="s1">&#39;grant_type&#39;</span><span class="p">:</span> <span class="s1">&#39;authorization_code&#39;</span><span class="p">,</span>
<a id="__codelineno-31-215" name="__codelineno-31-215" href="#__codelineno-31-215"></a>            <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="n">authorization_code</span><span class="p">,</span>
<a id="__codelineno-31-216" name="__codelineno-31-216" href="#__codelineno-31-216"></a>            <span class="s1">&#39;redirect_uri&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">redirect_uri</span><span class="p">,</span>
<a id="__codelineno-31-217" name="__codelineno-31-217" href="#__codelineno-31-217"></a>            <span class="s1">&#39;client_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span><span class="p">,</span>
<a id="__codelineno-31-218" name="__codelineno-31-218" href="#__codelineno-31-218"></a>            <span class="s1">&#39;code_verifier&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">code_verifier</span>
<a id="__codelineno-31-219" name="__codelineno-31-219" href="#__codelineno-31-219"></a>        <span class="p">}</span>
<a id="__codelineno-31-220" name="__codelineno-31-220" href="#__codelineno-31-220"></a>
<a id="__codelineno-31-221" name="__codelineno-31-221" href="#__codelineno-31-221"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">token_data</span><span class="p">)</span>
<a id="__codelineno-31-222" name="__codelineno-31-222" href="#__codelineno-31-222"></a>
<a id="__codelineno-31-223" name="__codelineno-31-223" href="#__codelineno-31-223"></a>        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
<a id="__codelineno-31-224" name="__codelineno-31-224" href="#__codelineno-31-224"></a>            <span class="n">tokens</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<a id="__codelineno-31-225" name="__codelineno-31-225" href="#__codelineno-31-225"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">access_token</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="s1">&#39;access_token&#39;</span><span class="p">]</span>
<a id="__codelineno-31-226" name="__codelineno-31-226" href="#__codelineno-31-226"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_token</span> <span class="o">=</span> <span class="n">tokens</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;refresh_token&#39;</span><span class="p">)</span>
<a id="__codelineno-31-227" name="__codelineno-31-227" href="#__codelineno-31-227"></a>            <span class="k">return</span> <span class="n">tokens</span>
<a id="__codelineno-31-228" name="__codelineno-31-228" href="#__codelineno-31-228"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-31-229" name="__codelineno-31-229" href="#__codelineno-31-229"></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Token exchange failed: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-31-230" name="__codelineno-31-230" href="#__codelineno-31-230"></a>
<a id="__codelineno-31-231" name="__codelineno-31-231" href="#__codelineno-31-231"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">call_api</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-31-232" name="__codelineno-31-232" href="#__codelineno-31-232"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make authenticated API request&quot;&quot;&quot;</span>
<a id="__codelineno-31-233" name="__codelineno-31-233" href="#__codelineno-31-233"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_token</span><span class="p">:</span>
<a id="__codelineno-31-234" name="__codelineno-31-234" href="#__codelineno-31-234"></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Not authenticated&#39;</span><span class="p">)</span>
<a id="__codelineno-31-235" name="__codelineno-31-235" href="#__codelineno-31-235"></a>
<a id="__codelineno-31-236" name="__codelineno-31-236" href="#__codelineno-31-236"></a>        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Bearer </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">access_token</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">}</span>
<a id="__codelineno-31-237" name="__codelineno-31-237" href="#__codelineno-31-237"></a>
<a id="__codelineno-31-238" name="__codelineno-31-238" href="#__codelineno-31-238"></a>        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>
<a id="__codelineno-31-239" name="__codelineno-31-239" href="#__codelineno-31-239"></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<a id="__codelineno-31-240" name="__codelineno-31-240" href="#__codelineno-31-240"></a>        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
<a id="__codelineno-31-241" name="__codelineno-31-241" href="#__codelineno-31-241"></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-31-242" name="__codelineno-31-242" href="#__codelineno-31-242"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-31-243" name="__codelineno-31-243" href="#__codelineno-31-243"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unsupported method: </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-31-244" name="__codelineno-31-244" href="#__codelineno-31-244"></a>
<a id="__codelineno-31-245" name="__codelineno-31-245" href="#__codelineno-31-245"></a>        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
<a id="__codelineno-31-246" name="__codelineno-31-246" href="#__codelineno-31-246"></a>        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<a id="__codelineno-31-247" name="__codelineno-31-247" href="#__codelineno-31-247"></a>
<a id="__codelineno-31-248" name="__codelineno-31-248" href="#__codelineno-31-248"></a><span class="c1"># Usage Example for Mobile/Desktop App</span>
<a id="__codelineno-31-249" name="__codelineno-31-249" href="#__codelineno-31-249"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-31-250" name="__codelineno-31-250" href="#__codelineno-31-250"></a>    <span class="c1"># Example 1: Flask Web App</span>
<a id="__codelineno-31-251" name="__codelineno-31-251" href="#__codelineno-31-251"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting Flask app with PKCE support...&quot;</span><span class="p">)</span>
<a id="__codelineno-31-252" name="__codelineno-31-252" href="#__codelineno-31-252"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Visit http://localhost:5000/login to test&quot;</span><span class="p">)</span>
<a id="__codelineno-31-253" name="__codelineno-31-253" href="#__codelineno-31-253"></a>    <span class="c1"># app.run(debug=True, port=5000)</span>
<a id="__codelineno-31-254" name="__codelineno-31-254" href="#__codelineno-31-254"></a>
<a id="__codelineno-31-255" name="__codelineno-31-255" href="#__codelineno-31-255"></a>    <span class="c1"># Example 2: Standalone Client (Mobile/Desktop)</span>
<a id="__codelineno-31-256" name="__codelineno-31-256" href="#__codelineno-31-256"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-31-257" name="__codelineno-31-257" href="#__codelineno-31-257"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Standalone PKCE Client Example&quot;</span><span class="p">)</span>
<a id="__codelineno-31-258" name="__codelineno-31-258" href="#__codelineno-31-258"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-31-259" name="__codelineno-31-259" href="#__codelineno-31-259"></a>
<a id="__codelineno-31-260" name="__codelineno-31-260" href="#__codelineno-31-260"></a>    <span class="n">client</span> <span class="o">=</span> <span class="n">PKCEOAuthClient</span><span class="p">(</span>
<a id="__codelineno-31-261" name="__codelineno-31-261" href="#__codelineno-31-261"></a>        <span class="n">client_id</span><span class="o">=</span><span class="s1">&#39;mobile-app-client-id&#39;</span><span class="p">,</span>
<a id="__codelineno-31-262" name="__codelineno-31-262" href="#__codelineno-31-262"></a>        <span class="n">authorization_url</span><span class="o">=</span><span class="s1">&#39;https://auth-server.com/oauth/authorize&#39;</span><span class="p">,</span>
<a id="__codelineno-31-263" name="__codelineno-31-263" href="#__codelineno-31-263"></a>        <span class="n">token_url</span><span class="o">=</span><span class="s1">&#39;https://auth-server.com/oauth/token&#39;</span><span class="p">,</span>
<a id="__codelineno-31-264" name="__codelineno-31-264" href="#__codelineno-31-264"></a>        <span class="n">redirect_uri</span><span class="o">=</span><span class="s1">&#39;myapp://callback&#39;</span>
<a id="__codelineno-31-265" name="__codelineno-31-265" href="#__codelineno-31-265"></a>    <span class="p">)</span>
<a id="__codelineno-31-266" name="__codelineno-31-266" href="#__codelineno-31-266"></a>
<a id="__codelineno-31-267" name="__codelineno-31-267" href="#__codelineno-31-267"></a>    <span class="c1"># Step 1: Generate authorization URL</span>
<a id="__codelineno-31-268" name="__codelineno-31-268" href="#__codelineno-31-268"></a>    <span class="n">auth_url</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_authorization_url</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s1">&#39;read:user write:user&#39;</span><span class="p">)</span>
<a id="__codelineno-31-269" name="__codelineno-31-269" href="#__codelineno-31-269"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">1. Open this URL in browser:</span><span class="se">\n</span><span class="si">{</span><span class="n">auth_url</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-31-270" name="__codelineno-31-270" href="#__codelineno-31-270"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;State (store this): </span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-31-271" name="__codelineno-31-271" href="#__codelineno-31-271"></a>
<a id="__codelineno-31-272" name="__codelineno-31-272" href="#__codelineno-31-272"></a>    <span class="c1"># Step 2: After user authorizes, get the code from redirect</span>
<a id="__codelineno-31-273" name="__codelineno-31-273" href="#__codelineno-31-273"></a>    <span class="c1"># In a real app, this would come from the redirect handler</span>
<a id="__codelineno-31-274" name="__codelineno-31-274" href="#__codelineno-31-274"></a>    <span class="n">authorization_code</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;2. Enter the authorization code from redirect: &quot;</span><span class="p">)</span>
<a id="__codelineno-31-275" name="__codelineno-31-275" href="#__codelineno-31-275"></a>
<a id="__codelineno-31-276" name="__codelineno-31-276" href="#__codelineno-31-276"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-31-277" name="__codelineno-31-277" href="#__codelineno-31-277"></a>        <span class="c1"># Step 3: Exchange code for token</span>
<a id="__codelineno-31-278" name="__codelineno-31-278" href="#__codelineno-31-278"></a>        <span class="n">tokens</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">exchange_code_for_token</span><span class="p">(</span><span class="n">authorization_code</span><span class="p">)</span>
<a id="__codelineno-31-279" name="__codelineno-31-279" href="#__codelineno-31-279"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Authentication successful!&quot;</span><span class="p">)</span>
<a id="__codelineno-31-280" name="__codelineno-31-280" href="#__codelineno-31-280"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Access Token: </span><span class="si">{</span><span class="n">tokens</span><span class="p">[</span><span class="s1">&#39;access_token&#39;</span><span class="p">][:</span><span class="mi">20</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
<a id="__codelineno-31-281" name="__codelineno-31-281" href="#__codelineno-31-281"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Token Type: </span><span class="si">{</span><span class="n">tokens</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;token_type&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-31-282" name="__codelineno-31-282" href="#__codelineno-31-282"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expires In: </span><span class="si">{</span><span class="n">tokens</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;expires_in&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<a id="__codelineno-31-283" name="__codelineno-31-283" href="#__codelineno-31-283"></a>
<a id="__codelineno-31-284" name="__codelineno-31-284" href="#__codelineno-31-284"></a>        <span class="c1"># Step 4: Call protected API</span>
<a id="__codelineno-31-285" name="__codelineno-31-285" href="#__codelineno-31-285"></a>        <span class="n">user_data</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">call_api</span><span class="p">(</span><span class="s1">&#39;https://api-server.com/user&#39;</span><span class="p">)</span>
<a id="__codelineno-31-286" name="__codelineno-31-286" href="#__codelineno-31-286"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">User Data: </span><span class="si">{</span><span class="n">user_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-31-287" name="__codelineno-31-287" href="#__codelineno-31-287"></a>
<a id="__codelineno-31-288" name="__codelineno-31-288" href="#__codelineno-31-288"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-31-289" name="__codelineno-31-289" href="#__codelineno-31-289"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<p><strong>Key Security Features in Implementation:</strong></p>
<ol>
<li><strong>Cryptographically Random Verifier</strong>: Uses <code>secrets</code> module for secure random generation</li>
<li><strong>SHA-256 Challenge</strong>: One-way hash prevents reverse engineering</li>
<li><strong>No Client Secret</strong>: Safe for public clients (mobile/SPA)</li>
<li><strong>State Parameter</strong>: CSRF protection</li>
<li><strong>Session Security</strong>: Secure storage of code_verifier during flow</li>
<li><strong>URL-Safe Encoding</strong>: Proper base64 URL encoding without padding</li>
</ol>
<p><strong>Testing the Implementation:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="c1"># Unit tests for PKCE functions</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">unittest</span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">TestPKCE</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_code_verifier_length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>        <span class="n">verifier</span> <span class="o">=</span> <span class="n">PKCEHelper</span><span class="o">.</span><span class="n">generate_code_verifier</span><span class="p">()</span>
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="mi">43</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">verifier</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">128</span><span class="p">)</span>
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>
<a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_code_challenge_s256</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a>        <span class="n">verifier</span> <span class="o">=</span> <span class="s2">&quot;dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk&quot;</span>
<a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a>        <span class="n">challenge</span> <span class="o">=</span> <span class="n">PKCEHelper</span><span class="o">.</span><span class="n">generate_code_challenge</span><span class="p">(</span><span class="n">verifier</span><span class="p">,</span> <span class="s1">&#39;S256&#39;</span><span class="p">)</span>
<a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a>        <span class="n">expected</span> <span class="o">=</span> <span class="s2">&quot;E9Melhoa2OwvFrEMTJguCHaoeK1t8URWbuGJSstw-cM&quot;</span>
<a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">challenge</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>
<a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a>
<a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_code_challenge_plain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a>        <span class="n">verifier</span> <span class="o">=</span> <span class="s2">&quot;test_verifier&quot;</span>
<a id="__codelineno-32-17" name="__codelineno-32-17" href="#__codelineno-32-17"></a>        <span class="n">challenge</span> <span class="o">=</span> <span class="n">PKCEHelper</span><span class="o">.</span><span class="n">generate_code_challenge</span><span class="p">(</span><span class="n">verifier</span><span class="p">,</span> <span class="s1">&#39;plain&#39;</span><span class="p">)</span>
<a id="__codelineno-32-18" name="__codelineno-32-18" href="#__codelineno-32-18"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">challenge</span><span class="p">,</span> <span class="n">verifier</span><span class="p">)</span>
<a id="__codelineno-32-19" name="__codelineno-32-19" href="#__codelineno-32-19"></a>
<a id="__codelineno-32-20" name="__codelineno-32-20" href="#__codelineno-32-20"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_url_safe_encoding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-32-21" name="__codelineno-32-21" href="#__codelineno-32-21"></a>        <span class="n">verifier</span> <span class="o">=</span> <span class="n">PKCEHelper</span><span class="o">.</span><span class="n">generate_code_verifier</span><span class="p">()</span>
<a id="__codelineno-32-22" name="__codelineno-32-22" href="#__codelineno-32-22"></a>        <span class="c1"># Should not contain +, /, or =</span>
<a id="__codelineno-32-23" name="__codelineno-32-23" href="#__codelineno-32-23"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">verifier</span><span class="p">)</span>
<a id="__codelineno-32-24" name="__codelineno-32-24" href="#__codelineno-32-24"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">verifier</span><span class="p">)</span>
<a id="__codelineno-32-25" name="__codelineno-32-25" href="#__codelineno-32-25"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">verifier</span><span class="p">)</span>
<a id="__codelineno-32-26" name="__codelineno-32-26" href="#__codelineno-32-26"></a>
<a id="__codelineno-32-27" name="__codelineno-32-27" href="#__codelineno-32-27"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-32-28" name="__codelineno-32-28" href="#__codelineno-32-28"></a>    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</code></pre></div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2025 <a href="https://github.com/abhishekghoshh"  target="_blank" rel="noopener">Abhishek Ghosh</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/abhishekghoshh" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M202.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M496 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://x.com/abhishek_ghoshh" target="_blank" rel="noopener" title="x.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/abhishek-ghosh-220679132/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>